import{n as e,a1 as Y,a2 as Z,a3 as V,a4 as ee,a5 as te,a6 as ne,a7 as re,a8 as se,c as j,j as H,a9 as oe,m as D,aa as ie,$ as M,q as l,E as x,I as F,H as y,ab as $,K as ae,ac as W,ad as le,X as T,ae as N,af as B,Y as S,L as A,r as p,ag as ce,N as U,O as de,J as he,W as pe,G as C,ah as ue,F as _,ai as me,aj as ge,ak as fe,al as ye,am as xe}from"./index-5naVL-wa.js";import{u as P,C as Ce}from"./useForceUpdate-F95cshwJ.js";import{M as O,D as q}from"./DropdownButton-CVSuCb6_.js";import{c as be,d as ve,S as we,b as J,E as ke,D as Q,G as Se}from"./LocationAutocomplete-DFU5q9Q8.js";import{u as Le,a as De}from"./useInfScroll-CTVCqJcH.js";import{d as Ie}from"./Add-lVRt6Jo0.js";import{s as Me,l as $e}from"./index-C9CI--oE.js";function Ae(n,s,i,o=[]){return(a,h)=>{for(const c of n){let u=0;const t=i[c],d=t(a),m=t(h);if(typeof d=="string"&&typeof m=="string"?u=d.localeCompare(m):u=m-d,u!==0)return o.includes(c)?u:(s?-1:1)*u}return 0}}function Ke({pathKey:n,iconProps:s={}}){switch(n){case"Abundance":return e(re,{...s});case"Destruction":return e(ne,{...s});case"Erudition":return e(te,{...s});case"Harmony":return e(ee,{...s});case"Nihility":return e(V,{...s});case"Preservation":return e(Z,{...s});case"TheHunt":return e(Y,{...s})}}const Ne=["level","name","rarity"];function je(){return{level:n=>n.level*(n.ascension+1),name:n=>`lightConeNames_gen:${n.key}`,rarity:n=>se.lightCone[n.key].rarity}}const He={name:["name"],level:["level","rarity","name"],rarity:["rarity","level","name"]},G=j(H.jsx("path",{d:"M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"}),"Add"),Te=j(H.jsx("path",{d:"M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"}),"Close"),ze=j(H.jsx("path",{d:"M21 10.12h-6.78l2.74-2.82c-2.73-2.7-7.15-2.8-9.88-.1-2.73 2.71-2.73 7.08 0 9.79s7.15 2.71 9.88 0C18.32 15.65 19 14.08 19 12.1h2c0 1.98-.88 4.55-2.64 6.29-3.51 3.48-9.21 3.48-12.72 0-3.5-3.47-3.53-9.11-.02-12.58s9.14-3.47 12.65 0L21 3v7.12zM12.5 8v4.25l3.5 2.08-.72 1.21L11 13V8h1.5z"}),"Update");function We({lcKey:n}){return e(oe,{ns:"lightConeNames_gen",key18:n})}function Be({lightCone:n,onClick:s,onEdit:i,onDelete:o,onLockToggle:a,canEquip:h=!1,setLocation:c,extraButtons:u}){const{t}=D("lightCone"),{key:d,level:m,ascension:b,superimpose:L,location:f="",lock:g}=n,v=Me($e(n)),w=ie(d);return e(p.Suspense,{fallback:e(M,{variant:"rectangular",sx:{width:"100%",height:"100%",minHeight:350}}),children:l(A,{bgt:"light",sx:{height:"100%",display:"flex",flexDirection:"column"},children:[l(x,{className:`grad-${w.rarity}star`,sx:{position:"relative",width:"100%"},children:[!s&&!!a&&e(F,{color:"primary",onClick:a,sx:{position:"absolute",right:0,bottom:0,zIndex:2},children:g?e(be,{}):e(ve,{})}),l(x,{sx:{pt:2,px:2,position:"relative",zIndex:1},children:[l(x,{component:"div",sx:{display:"flex",alignItems:"center",gap:1,mb:1},children:[e(Ke,{iconProps:{fontSize:"inherit"},pathKey:w.path}),e(y,{noWrap:!0,sx:{textAlign:"center",backgroundColor:"rgba(100,100,100,0.35)",borderRadius:"1em",px:1},children:e("strong",{children:e(We,{lcKey:d})})})]}),l(y,{component:"span",variant:"h5",children:[t("level")," ",m]}),l(y,{component:"span",variant:"h5",color:"text.secondary",children:["/",$[b]]}),e(y,{variant:"h6",children:e(ae,{t,i18nKey:"superimpose",children:{rank:L}})}),e(we,{stars:w.rarity,colored:!0})]}),e(x,{sx:{height:"100%",position:"absolute",right:0,top:0},children:e(x,{component:W?W:"img",alt:"Light Cone Image",src:le(d,"icon"),sx:{width:"auto",height:"90%",float:"right",marginBottom:"5%",marginTop:"5%",marginRight:"5%"}})})]}),l(T,{sx:{flexGrow:1,display:"flex",flexDirection:"column",pt:1,pb:"0!important",width:"100%"},children:[l(y,{children:["HP: ",v.compute(N.base.hp.with("sheet","lightCone")).val]}),l(y,{children:["ATK: ",v.compute(N.base.atk.with("sheet","lightCone")).val]}),l(y,{children:["DEF: ",v.compute(N.base.def.with("sheet","lightCone")).val]})]}),l(x,{sx:{p:1,display:"flex",gap:1,justifyContent:"space-between",alignItems:"center"},children:[e(x,{sx:{flexGrow:1},children:h&&c?e(J,{locKey:f,setLocKey:c,getOptionDisabled:r=>!r.key,disableClearable:!0}):e(y,{children:f})}),l(x,{display:"flex",gap:1,alignItems:"stretch",height:"100%",sx:{"& .MuiButton-root":{minWidth:0,height:"100%"}},children:[!!i&&e(B,{title:e(y,{children:t("lightCone:edit")}),placement:"top",arrow:!0,children:e(S,{color:"info",size:"small",onClick:i,children:e(ke,{})})}),!!o&&e(B,{title:g?t("lightCone:cantDeleteLock"):"",placement:"top",children:e("span",{children:e(S,{color:"error",size:"small",onClick:o,disabled:!!f||g,sx:{top:"1px"},children:e(Q,{})})})}),u]})]})]})})}function Ge(n,s){const o=(()=>{switch(s.type){case"reset":return;case"overwrite":return s.lightCone;case"update":return{...n,...s.lightCone}}})();return o&&ce(o)}const R={superimpose:[1,2,3,4,5]};function Re({lightConeIdToEdit:n="new",cancelEdit:s}){const{t:i}=D("lightCone"),{database:o}=U(),[a,h]=P();p.useEffect(()=>o.lightCones.followAny(h),[o,h]);const[c,u]=p.useState(!1);p.useEffect(()=>{n==="new"&&(u(!0),d({type:"reset"}));const r=n&&a&&o.lightCones.get(n);r&&(u(!0),d({type:"overwrite",lightCone:de(r)}))},[n,o,a]);const[t,d]=p.useReducer(Ge,void 0),m=t?R:void 0,{prev:b,prevEditType:L}=p.useMemo(()=>{const r=a&&n&&o.lightCones.get(n);return r?{prev:r,prevEditType:"edit"}:{prev:void 0,prevEditType:""}},[n,o,a]),f=p.useCallback(r=>{const k=r.key?R:m;function K(I,z,X){return I&&z.includes(I)?I:X??z[0]}r.key&&(r.superimpose=K(t==null?void 0:t.superimpose,k.superimpose,Math.min(...k.superimpose))),r.level&&(r.level=he(r.level,0,fe)),d({type:"update",lightCone:r})},[t,m,d]),g=p.useCallback(()=>{s==null||s(),d({type:"reset"})},[s,d]),v=p.useCallback(r=>{if(!n&&t&&!window.confirm(i("editor.clearPrompt"))){r==null||r.preventDefault();return}u(!1),g()},[i,n,t,u,g]),w=n!=="new"&&n||(b==null?void 0:b.id);return e(p.Suspense,{fallback:!1,children:e(pe,{open:c,onClose:v,children:l(A,{bgt:"dark",children:[e(Ce,{title:"Light Cone Editor",action:e(F,{onClick:v,children:e(Te,{})})}),l(T,{sx:{display:"flex",flexDirection:"column",gap:1},children:[l(C,{container:!0,spacing:1,columns:{xs:1,md:2},children:[e(C,{item:!0,xs:1,md:!0,display:"flex",flexDirection:"column",children:e(Ee,{lcKey:(t==null?void 0:t.key)??"",setLCKey:r=>f({key:r}),label:t!=null&&t.key?"":i("editor.unknownLightCone")})}),e(C,{item:!0,xs:!0,md:"auto",display:"flex",children:e(Fe,{superimpose:(t==null?void 0:t.superimpose)??1,setSuperimposition:r=>f({superimpose:r}),disabled:!t})})]}),l(C,{container:!0,spacing:1,columns:{xs:1,md:4},marginBottom:1,children:[e(C,{item:!0,xs:1,display:"flex",flexDirection:"row",gap:1,children:e(Ue,{level:t==null?void 0:t.level,ascension:t==null?void 0:t.ascension,setLevelAscension:(r,k)=>{f({level:r,ascension:k})},disabled:!t})}),e(C,{item:!0,xs:1,display:"flex",gap:1,children:e(A,{bgt:"light",sx:{p:1,flexGrow:1,alignContent:"center"},children:e(p.Suspense,{fallback:e(M,{width:"60%"}),children:l(y,{color:"text.secondary",align:"center",children:["Ascension ",(t==null?void 0:t.ascension)||0]})})})}),e(C,{item:!0,xs:1,md:2,display:"flex",flexDirection:"column",gap:1,children:e(J,{locKey:(t==null?void 0:t.location)??"",setLocKey:r=>f({location:r})})})]}),l(x,{display:"flex",gap:2,children:[L==="edit"?e(S,{startIcon:e(G,{}),onClick:()=>{t&&o.lightCones.set(b.id,t),g()},disabled:!t,color:"primary",children:i("editor.btnSave")}):e(S,{startIcon:e(G,{}),onClick:()=>{o.lightCones.new(t),g()},disabled:!t,color:"primary",children:i("editor.btnAdd")}),b&&L!=="edit"&&e(S,{startIcon:e(ze,{}),onClick:()=>{t&&o.lightCones.set(b.id,t),g()},disabled:!t,color:"success",children:i("editor.btnUpdate")}),!!w&&e(S,{startIcon:e(Q,{}),onClick:()=>{window.confirm(i("editor.confirmDelete"))&&(o.lightCones.remove(w),g())},disabled:!t,color:"error",sx:{top:"2px"},children:i("editor.delete")})]})]})]})})})}function Ee({lcKey:n,setLCKey:s,label:i=""}){const{t:o}=D(["lightCone","lightConeNames_gen"]);i=i||o("editor.lightConeName");const a=p.useMemo(()=>ue.map(c=>({key:c,label:o(`lightConeNames_gen:${c}`)})),[o]),h=p.useCallback(c=>s(c??""),[s]);return e(p.Suspense,{fallback:e(M,{variant:"text",width:100}),children:e(Se,{options:a,valueKey:n,onChange:h,toImg:()=>e(_,{children:" "}),label:i})})}function Fe({superimpose:n,setSuperimposition:s,disabled:i=!1}){const{t:o}=D("lightCone");return e(q,{title:o("superimpose",{rank:n}),color:"primary",disabled:i,fullWidth:!0,children:me.map(a=>e(O,{selected:n===a,disabled:n===a,onClick:()=>s(a),children:o("superimpose",{rank:a})},a))})}function Ue({level:n,ascension:s,setLevelAscension:i,disabled:o=!1}){const{t:a}=D("lightCone");return e(q,{title:n?`${a("level")} ${n}/${$[s]}`:a("editor.levelSelect"),color:"primary",disabled:o,fullWidth:!0,children:ge.map(([h,c])=>e(O,{selected:n===h&&s===c,disabled:n===h&&s===c,onClick:()=>i(h,c),children:h===$[c]?`${a("level")} ${h}`:`${a("level")} ${h}/${$[c]}`},`${h}/${c}`))})}const E={xs:1,sm:2,md:3,lg:3,xl:4},_e={xs:10,sm:12,md:24,lg:24,xl:24};function Pe({onAdd:n,onEdit:s}){const{t:i}=D("lightCone"),{database:o}=U(),[a,h]=P(),c=()=>({sortType:Ne[0],ascending:!1,rarity:[...ye],path:[...xe]}),{sortType:u,ascending:t}=c();p.useEffect(()=>o.lightCones.followAny(h),[o,h]);const{lightConeIds:d,totalLightConeNum:m}=p.useMemo(()=>{const r=o.lightCones.values,k=r.length,K=r.sort(Ae(He[u]??[],t,je())).map(I=>I.id);return a&&{lightConeIds:K,totalLightConeNum:k}},[o,a,u,t]),b=Le(),L=d.length!==m?`${d.length}/${m}`:`${m}`,{numShow:f,setTriggerElement:g}=De(_e[b],d.length),v=p.useMemo(()=>d.slice(0,f),[d,f]),w={numShowing:v.length,total:L};return l(_,{children:[e(A,{bgt:"dark",children:e(T,{children:e(x,{pb:2,display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",children:l(y,{color:"text.secondary",children:["Showing ",e("b",{children:w.numShowing})," out of"," ",w.total," Items"]})})})}),e(C,{container:!0,columns:E,spacing:1,children:e(C,{item:!0,xs:!0,children:e(S,{fullWidth:!0,onClick:n,color:"info",startIcon:e(Ie,{}),children:i("addNew")})})}),l(p.Suspense,{fallback:e(M,{variant:"rectangular",sx:{width:"100%",height:"100%",minHeight:300}}),children:[e(C,{container:!0,columns:E,spacing:1,children:v.map(r=>e(C,{item:!0,xs:1,children:e(Be,{lightCone:o.lightCones.get(r),onEdit:()=>s==null?void 0:s(r),onDelete:()=>o.lightCones.remove(r),setLocation:k=>o.lightCones.set(r,{location:k}),canEquip:!0})},r))}),d.length!==v.length&&e(M,{ref:r=>{r&&g(r)},sx:{borderRadius:1},variant:"rectangular",width:"100%",height:100})]})]})}function Ve(){const[n,s]=p.useState("");return l(x,{display:"flex",flexDirection:"column",gap:1,my:1,children:[e(Re,{lightConeIdToEdit:n,cancelEdit:()=>s("")}),e(Pe,{onAdd:()=>s("new"),onEdit:s})]})}export{Ve as default};
