import{aq as E,ar as j,as as I,at as B,au as F,av as P,aw as R,J as n,T as l,a6 as g,ag as w,a8 as v,c as H,j as N,ax as W,L as D,ab as A,ac as _,r as u,ad as G,a7 as z,a5 as p,am as b,ak as U,ay as q,az as J,ap as $,aA as O,N as M,O as K,aB as L,aC as Q,aD as X,a3 as T,aE as Y,aF as Z}from"./index-CqdAtvwe.js";import{C as V,L as ee,u as te,a as ne}from"./LocationAutocomplete-Cd9qw6nP.js";function se(t,o,i,s=[]){return(c,e)=>{for(const a of t){let h=0;const m=i[a],f=m(c),r=m(e);if(typeof f=="string"&&typeof r=="string"?h=f.localeCompare(r):h=r-f,h!==0)return s.includes(a)?h:(o?-1:1)*h}return 0}}const oe=["level","name","rarity"];function re(){return{level:t=>t.level*(t.ascension+1),name:t=>`lightConeNames_gen:${t.key}`,rarity:t=>E.lightCone[t.key].rarity}}const ie={name:["name"],level:["level","rarity","name"],rarity:["rarity","level","name"]};function ae({lightConeId:t}){const o=j(t),i=I(B,{member:"member0",et:"self"}),s=F(P("member0",...R(o)));return o?n(v,{children:l(w,{children:[l(g,{children:["Key: ",o.key]}),l(g,{children:["Level: ",o.level]}),l(g,{children:["Ascension: ",o.ascension]}),l(g,{children:["Superimpose: ",o.superimpose]}),l(g,{children:["ATK: ",s==null?void 0:s.compute(i.base.atk.src("lightCone")).val]}),l(g,{children:["HP: ",s==null?void 0:s.compute(i.base.hp.src("lightCone")).val]}),l(g,{children:["DEF: ",s==null?void 0:s.compute(i.base.def.src("lightCone")).val]})]})}):null}const le=H(N.jsx("path",{d:"M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"}),"Add");function ce(t,o){const s=(()=>{switch(o.type){case"reset":return;case"overwrite":return o.lightCone;case"update":return{...t,...o.lightCone}}})();return s&&W(s)}const k={superimpose:[1,2,3,4,5]};function ue({lightConeIdToEdit:t="new"}){const{t:o}=D("lightCone"),{database:i}=A(),[s,c]=_();u.useEffect(()=>i.lightCones.followAny(c),[i,c]),u.useEffect(()=>{t==="new"&&a({type:"reset"});const r=t&&s&&i.lightCones.get(t);r&&a({type:"overwrite",lightCone:G(r)})},[t,i,s]);const[e,a]=u.useReducer(ce,void 0),h=e?k:void 0,m=u.useCallback(r=>{const y=r.key?k:h;function x(d,C,S){return d&&C.includes(d)?d:S??C[0]}r.key&&(r.superimpose=x(e==null?void 0:e.superimpose,y.superimpose,Math.min(...y.superimpose))),r.level&&(r.level=z(r.level,0,X)),a({type:"update",lightCone:r})},[e,h,a]),f=u.useCallback(()=>{a({type:"reset"})},[]);return u.useEffect(()=>{t==="new"&&a({type:"reset"})},[t]),n(u.Suspense,{fallback:!1,children:l(v,{bgt:"dark",children:[n(V,{title:"Light Cone Editor"}),l(w,{sx:{display:"flex",flexDirection:"column",gap:1},children:[l(p,{container:!0,spacing:1,columns:{xs:1,md:2},children:[n(p,{item:!0,xs:1,md:!0,display:"flex",flexDirection:"column",children:n(de,{lcKey:(e==null?void 0:e.key)??"",setLCKey:r=>m({key:r}),label:e!=null&&e.key?"":o("editor.unknownLightCone")})}),n(p,{item:!0,xs:!0,md:"auto",display:"flex",children:n(he,{superimpose:e==null?void 0:e.superimpose,setSuperimposition:r=>m({superimpose:r}),disabled:!e})})]}),l(p,{container:!0,spacing:1,columns:{xs:1,md:4},marginBottom:1,children:[n(p,{item:!0,xs:1,display:"flex",flexDirection:"row",gap:1,children:n(pe,{level:e==null?void 0:e.level,ascension:e==null?void 0:e.ascension,setLevelAscension:(r,y)=>{m({level:r,ascension:y})},disabled:!e})}),n(p,{item:!0,xs:1,display:"flex",gap:1,children:n(v,{bgt:"light",sx:{p:1,flexGrow:1,alignContent:"center"},children:n(u.Suspense,{fallback:n(b,{width:"60%"}),children:l(g,{color:"text.secondary",align:"center",children:["Ascension ",(e==null?void 0:e.ascension)||0]})})})}),n(p,{item:!0,xs:1,md:2,display:"flex",flexDirection:"column",gap:1,children:n(ee,{locKey:(e==null?void 0:e.location)??"",setLocKey:r=>m({location:r})})})]}),n(p,{children:n(U,{startIcon:n(le,{}),onClick:()=>{i.lightCones.new(e),f()},disabled:!e,color:"primary",children:o`editor.btnAdd`})})]})]})})}function de({lcKey:t,setLCKey:o,label:i=""}){const{t:s}=D(["lightCone","lightConeNames_gen"]);i=i||s("lightCone:autocompleteLabels.key");const c=u.useMemo(()=>q.map(a=>({key:a,label:s(`lightConeNames_gen:${a}`)})),[s]),e=u.useCallback(a=>o(a??""),[o]);return n(u.Suspense,{fallback:n(b,{variant:"text",width:100}),children:n(J,{options:c,valueKey:t,onChange:e,toImg:()=>n($,{children:" "}),label:i})})}function he({superimpose:t,setSuperimposition:o,disabled:i=!1}){return n(K,{title:t?`Superimposition ${t}`:"Superimposition 1",color:"primary",disabled:i,fullWidth:!0,children:O.map(s=>l(M,{selected:t===s,disabled:t===s,onClick:()=>o(s),children:["Superimposition ",s]},s))})}function pe({level:t,ascension:o,setLevelAscension:i,disabled:s=!1}){return n(K,{title:t?`Lv. ${t}/${L[o]}`:"Select Level",color:"primary",disabled:s,fullWidth:!0,children:Q.map(([c,e])=>n(M,{selected:t===c&&o===e,disabled:t===c&&o===e,onClick:()=>i(c,e),children:c===L[e]?`Lv. ${c}`:`Lv. ${c}/${L[e]}`},`${c}/${e}`))})}const me={xs:1,sm:2,md:3,lg:3,xl:4},ge={xs:10,sm:12,md:24,lg:24,xl:24};function fe(){const{database:t}=A(),[o,i]=u.useState(t.lightCones.values.length),s=()=>({sortType:oe[0],ascending:!1,rarity:[...Y],path:[...Z]}),{sortType:c,ascending:e}=s();u.useEffect(()=>t.lightCones.followAny((d,C)=>["new","remove"].includes(C)&&i(t.lightCones.values.length)),[t]);const a=u.useMemo(()=>t.lightCones.values.sort(se(ie[c]??[],e,re())).map(S=>S.id),[t.lightCones.values,c,e]),h=te(),m=a.length!==o?`${a.length}/${o}`:`${o}`,{numShow:f,setTriggerElement:r}=ne(ge[h],a.length),y=u.useMemo(()=>a.slice(0,f),[a,f]),x={numShowing:y.length,total:m};return l($,{children:[n(v,{bgt:"dark",children:n(w,{children:n(T,{pb:2,display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",children:l(g,{color:"text.secondary",children:["Showing ",n("b",{children:x.numShowing})," out of"," ",x.total," Items"]})})})}),l(u.Suspense,{fallback:n(b,{variant:"rectangular",sx:{width:"100%",height:"100%",minHeight:300}}),children:[n(p,{container:!0,spacing:1,columns:me,children:y.map(d=>n(p,{item:!0,xs:1,children:n(ae,{lightConeId:d})},d))}),a.length!==y.length&&n(b,{ref:d=>{d&&r(d)},sx:{borderRadius:1},variant:"rectangular",width:"100%",height:100})]})]})}function xe(){return l(T,{display:"flex",flexDirection:"column",gap:1,my:1,children:[n(ue,{}),n(fe,{})]})}export{xe as default};
