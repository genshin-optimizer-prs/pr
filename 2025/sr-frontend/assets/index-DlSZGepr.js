import{L as w,aq as I,ar as B,as as F,at as P,au as R,av as H,aw as W,J as t,T as l,a6 as g,ag as k,a8 as b,c as _,j as G,ax as z,ab as A,ac as $,r as d,ad as U,a7 as q,a5 as p,am as v,ak as J,ay as O,az as Q,ap as M,aA as X,N as K,O as N,aB as S,aC as Y,aD as Z,a3 as E,aE as V,aF as ee}from"./index-fOoOOFJi.js";import{C as te,L as ne,u as se,a as oe}from"./LocationAutocomplete-zyHC0Mf5.js";function re(o,n,a,s=[]){return(c,e)=>{for(const i of o){let u=0;const m=a[i],f=m(c),r=m(e);if(typeof f=="string"&&typeof r=="string"?u=f.localeCompare(r):u=r-f,u!==0)return s.includes(i)?u:(n?-1:1)*u}return 0}}const ae=["level","name","rarity"];function ie(){const{t:o}=w("lightConeNames_gen");return{level:n=>n.level*(n.ascension+1),name:n=>o(`lightConeNames_gen:${n.key}`),rarity:n=>I.lightCone[n.key].rarity}}const le={name:["name"],level:["level","rarity","name"],rarity:["rarity","level","name"]};function ce({lightConeId:o}){const n=B(o),a=F(P,{member:"member0",et:"self"}),s=R(H("member0",...W(n)));return n?t(b,{children:l(k,{children:[l(g,{children:["Key: ",n.key]}),l(g,{children:["Level: ",n.level]}),l(g,{children:["Ascension: ",n.ascension]}),l(g,{children:["Superimpose: ",n.superimpose]}),l(g,{children:["ATK: ",s==null?void 0:s.compute(a.base.atk.src("lightCone")).val]}),l(g,{children:["HP: ",s==null?void 0:s.compute(a.base.hp.src("lightCone")).val]}),l(g,{children:["DEF: ",s==null?void 0:s.compute(a.base.def.src("lightCone")).val]})]})}):null}const de=_(G.jsx("path",{d:"M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"}),"Add");function ue(o,n){const s=(()=>{switch(n.type){case"reset":return;case"overwrite":return n.lightCone;case"update":return{...o,...n.lightCone}}})();return s&&z(s)}const D={superimpose:[1,2,3,4,5]};function he({lightConeIdToEdit:o="new"}){const{t:n}=w("lightCone"),{database:a}=A(),[s,c]=$();d.useEffect(()=>a.lightCones.followAny(c),[a,c]),d.useEffect(()=>{o==="new"&&i({type:"reset"});const r=o&&s&&a.lightCones.get(o);r&&i({type:"overwrite",lightCone:U(r)})},[o,a,s]);const[e,i]=d.useReducer(ue,void 0),u=e?D:void 0,m=d.useCallback(r=>{const y=r.key?D:u;function x(C,h,L){return C&&h.includes(C)?C:L??h[0]}r.key&&(r.superimpose=x(e==null?void 0:e.superimpose,y.superimpose,Math.min(...y.superimpose))),r.level&&(r.level=q(r.level,0,Z)),i({type:"update",lightCone:r})},[e,u,i]),f=d.useCallback(()=>{i({type:"reset"})},[]);return d.useEffect(()=>{o==="new"&&i({type:"reset"})},[o]),t(d.Suspense,{fallback:!1,children:l(b,{bgt:"dark",children:[t(te,{title:"Light Cone Editor"}),l(k,{sx:{display:"flex",flexDirection:"column",gap:1},children:[l(p,{container:!0,spacing:1,columns:{xs:1,md:2},children:[t(p,{item:!0,xs:1,md:!0,display:"flex",flexDirection:"column",children:t(pe,{lcKey:(e==null?void 0:e.key)??"",setLCKey:r=>m({key:r}),label:e!=null&&e.key?"":n("editor.unknownLightCone")})}),t(p,{item:!0,xs:!0,md:"auto",display:"flex",children:t(me,{superimpose:e==null?void 0:e.superimpose,setSuperimposition:r=>m({superimpose:r}),disabled:!e})})]}),l(p,{container:!0,spacing:1,columns:{xs:1,md:4},marginBottom:1,children:[t(p,{item:!0,xs:1,display:"flex",flexDirection:"row",gap:1,children:t(ge,{level:e==null?void 0:e.level,ascension:e==null?void 0:e.ascension,setLevelAscension:(r,y)=>{m({level:r,ascension:y})},disabled:!e})}),t(p,{item:!0,xs:1,display:"flex",gap:1,children:t(b,{bgt:"light",sx:{p:1,flexGrow:1,alignContent:"center"},children:t(d.Suspense,{fallback:t(v,{width:"60%"}),children:l(g,{color:"text.secondary",align:"center",children:["Ascension ",(e==null?void 0:e.ascension)||0]})})})}),t(p,{item:!0,xs:1,md:2,display:"flex",flexDirection:"column",gap:1,children:t(ne,{locKey:(e==null?void 0:e.location)??"",setLocKey:r=>m({location:r})})})]}),t(p,{children:t(J,{startIcon:t(de,{}),onClick:()=>{a.lightCones.new(e),f()},disabled:!e,color:"primary",children:n`editor.btnAdd`})})]})]})})}function pe({lcKey:o,setLCKey:n,label:a=""}){const{t:s}=w(["lightCone","lightConeNames_gen"]);a=a||s("lightCone:autocompleteLabels.key");const c=d.useMemo(()=>O.map(i=>({key:i,label:s(`lightConeNames_gen:${i}`)})),[s]),e=d.useCallback(i=>n(i??""),[n]);return t(d.Suspense,{fallback:t(v,{variant:"text",width:100}),children:t(Q,{options:c,valueKey:o,onChange:e,toImg:()=>t(M,{children:" "}),label:a})})}function me({superimpose:o,setSuperimposition:n,disabled:a=!1}){return t(N,{title:o?`Superimposition ${o}`:"Superimposition 1",color:"primary",disabled:a,fullWidth:!0,children:X.map(s=>l(K,{selected:o===s,disabled:o===s,onClick:()=>n(s),children:["Superimposition ",s]},s))})}function ge({level:o,ascension:n,setLevelAscension:a,disabled:s=!1}){return t(N,{title:o?`Lv. ${o}/${S[n]}`:"Select Level",color:"primary",disabled:s,fullWidth:!0,children:Y.map(([c,e])=>t(K,{selected:o===c&&n===e,disabled:o===c&&n===e,onClick:()=>a(c,e),children:c===S[e]?`Lv. ${c}`:`Lv. ${c}/${S[e]}`},`${c}/${e}`))})}const fe={xs:1,sm:2,md:3,lg:3,xl:4},ye={xs:10,sm:12,md:24,lg:24,xl:24};function Ce(){const{database:o}=A(),[n,a]=$(),s=()=>({sortType:ae[0],ascending:!1,rarity:[...V],path:[...ee]}),{sortType:c,ascending:e}=s();d.useEffect(()=>o.lightCones.followAny(a),[o,a]);const{lightConeIds:i,totalLightConeNum:u}=d.useMemo(()=>{const h=o.lightCones.values,L=h.length,T=h.sort(re(le[c]??[],e,ie())).map(j=>j.id);return n&&{lightConeIds:T,totalLightConeNum:L}},[o,n,c,e]),m=se(),f=i.length!==u?`${i.length}/${u}`:`${u}`,{numShow:r,setTriggerElement:y}=oe(ye[m],i.length),x=d.useMemo(()=>i.slice(0,r),[i,r]),C={numShowing:x.length,total:f};return l(M,{children:[t(b,{bgt:"dark",children:t(k,{children:t(E,{pb:2,display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",children:l(g,{color:"text.secondary",children:["Showing ",t("b",{children:C.numShowing})," out of"," ",C.total," Items"]})})})}),l(d.Suspense,{fallback:t(v,{variant:"rectangular",sx:{width:"100%",height:"100%",minHeight:300}}),children:[t(p,{container:!0,spacing:1,columns:fe,children:x.map(h=>t(p,{item:!0,xs:1,children:t(ce,{lightConeId:h})},h))}),i.length!==x.length&&t(v,{ref:h=>{h&&y(h)},sx:{borderRadius:1},variant:"rectangular",width:"100%",height:100})]})]})}function ve(){return l(E,{display:"flex",flexDirection:"column",gap:1,my:1,children:[t(he,{}),t(Ce,{})]})}export{ve as default};
