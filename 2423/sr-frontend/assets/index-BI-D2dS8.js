import{a as Z,g as ee,s as _,_ as k,r as l,u as te,aq as Tt,ar as Dt,e as oe,a7 as Ce,as as _t,m as Pt,j as M,f as U,h as re,at as Le,P as It,i as At,au as Nt,av as ke,b as E,aw as $e,x as Bt,l as zt,d as Et,H as v,D as a,Z as w,W as S,C as T,ax as be,a3 as I,ay as Lt,ac as rt,az as je,aa as O,a1 as L,Y as P,aA as jt,ad as Se,G as me,aB as Ot,aC as Wt,aD as Me,aE as Kt,aF as ue,ag as we,aG as qt,aH as Vt,ab as pe,R as Oe,Q as We,L as Gt,aI as at,aJ as nt,aK as ie,aL as Ut,z as Re,A as Te,ap as st,a8 as it,aM as Ht,aN as ge,I as Jt,a9 as Ft,aO as Xt,aP as Ke,aQ as Qt,F as Yt,aR as De,aS as qe,aT as Zt,aU as eo,aV as to,aW as oo,aX as ro,aY as ao,aZ as no,a_ as Ve}from"./index-DEBGZ8wG.js";import{u as lt,S as ve,C as so,a as io}from"./CharacterEditor-B-D_GU2m.js";import{u as lo,C as co}from"./useForceUpdate-tICSStRQ.js";import{s as uo,t as po,w as mo,c as fo,l as ho,r as go,a as bo,d as vo}from"./index-Dtu4JXgN.js";import{u as xo}from"./useLightCone-Y-HDVU2M.js";import{T as yo,d as Co,M as _e,D as Pe}from"./DropdownButton-aKbSrMFm.js";import{G as ko,d as ct}from"./LocationAutocomplete-DsSEDExU.js";import{C as dt}from"./CardActionArea-CdMOM3pg.js";import{u as $o,R as So,D as Mo}from"./RelicCard-BNJQ0CtV.js";import{I as wo}from"./InfoTooltip-Do_IqeWi.js";function Ro(e){return Z("MuiCollapse",e)}ee("MuiCollapse",["root","horizontal","vertical","entered","hidden","wrapper","wrapperInner"]);const To=["addEndListener","children","className","collapsedSize","component","easing","in","onEnter","onEntered","onEntering","onExit","onExited","onExiting","orientation","style","timeout","TransitionComponent"],Do=e=>{const{orientation:t,classes:o}=e,r={root:["root",`${t}`],entered:["entered"],hidden:["hidden"],wrapper:["wrapper",`${t}`],wrapperInner:["wrapperInner",`${t}`]};return re(r,Ro,o)},_o=_("div",{name:"MuiCollapse",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:o}=e;return[t.root,t[o.orientation],o.state==="entered"&&t.entered,o.state==="exited"&&!o.in&&o.collapsedSize==="0px"&&t.hidden]}})(({theme:e,ownerState:t})=>k({height:0,overflow:"hidden",transition:e.transitions.create("height")},t.orientation==="horizontal"&&{height:"auto",width:0,transition:e.transitions.create("width")},t.state==="entered"&&k({height:"auto",overflow:"visible"},t.orientation==="horizontal"&&{width:"auto"}),t.state==="exited"&&!t.in&&t.collapsedSize==="0px"&&{visibility:"hidden"})),Po=_("div",{name:"MuiCollapse",slot:"Wrapper",overridesResolver:(e,t)=>t.wrapper})(({ownerState:e})=>k({display:"flex",width:"100%"},e.orientation==="horizontal"&&{width:"auto",height:"100%"})),Io=_("div",{name:"MuiCollapse",slot:"WrapperInner",overridesResolver:(e,t)=>t.wrapperInner})(({ownerState:e})=>k({width:"100%"},e.orientation==="horizontal"&&{width:"auto",height:"100%"})),ut=l.forwardRef(function(t,o){const r=te({props:t,name:"MuiCollapse"}),{addEndListener:n,children:s,className:i,collapsedSize:d="0px",component:c,easing:u,in:p,onEnter:m,onEntered:h,onEntering:f,onExit:b,onExited:g,onExiting:C,orientation:$="vertical",style:R,timeout:y=Tt.standard,TransitionComponent:A=Dt}=r,J=oe(r,To),W=k({},r,{orientation:$,collapsedSize:d}),N=Do(W),F=Ce(),fe=_t(),B=l.useRef(null),X=l.useRef(),K=typeof d=="number"?`${d}px`:d,j=$==="horizontal",Q=j?"width":"height",ne=l.useRef(null),yt=Pt(o,ne),q=x=>D=>{if(x){const z=ne.current;D===void 0?x(z):x(z,D)}},he=()=>B.current?B.current[j?"clientWidth":"clientHeight"]:0,Ct=q((x,D)=>{B.current&&j&&(B.current.style.position="absolute"),x.style[Q]=K,m&&m(x,D)}),kt=q((x,D)=>{const z=he();B.current&&j&&(B.current.style.position="");const{duration:Y,easing:se}=Le({style:R,timeout:y,easing:u},{mode:"enter"});if(y==="auto"){const Ee=F.transitions.getAutoHeightDuration(z);x.style.transitionDuration=`${Ee}ms`,X.current=Ee}else x.style.transitionDuration=typeof Y=="string"?Y:`${Y}ms`;x.style[Q]=`${z}px`,x.style.transitionTimingFunction=se,f&&f(x,D)}),$t=q((x,D)=>{x.style[Q]="auto",h&&h(x,D)}),St=q(x=>{x.style[Q]=`${he()}px`,b&&b(x)}),Mt=q(g),wt=q(x=>{const D=he(),{duration:z,easing:Y}=Le({style:R,timeout:y,easing:u},{mode:"exit"});if(y==="auto"){const se=F.transitions.getAutoHeightDuration(D);x.style.transitionDuration=`${se}ms`,X.current=se}else x.style.transitionDuration=typeof z=="string"?z:`${z}ms`;x.style[Q]=K,x.style.transitionTimingFunction=Y,C&&C(x)}),Rt=x=>{y==="auto"&&fe.start(X.current||0,x),n&&n(ne.current,x)};return M.jsx(A,k({in:p,onEnter:Ct,onEntered:$t,onEntering:kt,onExit:St,onExited:Mt,onExiting:wt,addEndListener:Rt,nodeRef:ne,timeout:y==="auto"?null:y},J,{children:(x,D)=>M.jsx(_o,k({as:c,className:U(N.root,i,{entered:N.entered,exited:!p&&K==="0px"&&N.hidden}[x]),style:k({[j?"minWidth":"minHeight"]:K},R),ref:yt},D,{ownerState:k({},W,{state:x}),children:M.jsx(Po,{ownerState:k({},W,{state:x}),className:N.wrapper,ref:B,children:M.jsx(Io,{ownerState:k({},W,{state:x}),className:N.wrapperInner,children:s})})}))}))});ut.muiSupportAuto=!0;const pt=ut,Ao=l.createContext({}),mt=Ao;function No(e){return Z("MuiAccordion",e)}const Bo=ee("MuiAccordion",["root","rounded","expanded","disabled","gutters","region"]),le=Bo,zo=["children","className","defaultExpanded","disabled","disableGutters","expanded","onChange","square","slots","slotProps","TransitionComponent","TransitionProps"],Eo=e=>{const{classes:t,square:o,expanded:r,disabled:n,disableGutters:s}=e;return re({root:["root",!o&&"rounded",r&&"expanded",n&&"disabled",!s&&"gutters"],region:["region"]},No,t)},Lo=_(It,{name:"MuiAccordion",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:o}=e;return[{[`& .${le.region}`]:t.region},t.root,!o.square&&t.rounded,!o.disableGutters&&t.gutters]}})(({theme:e})=>{const t={duration:e.transitions.duration.shortest};return{position:"relative",transition:e.transitions.create(["margin"],t),overflowAnchor:"none","&::before":{position:"absolute",left:0,top:-1,right:0,height:1,content:'""',opacity:1,backgroundColor:(e.vars||e).palette.divider,transition:e.transitions.create(["opacity","background-color"],t)},"&:first-of-type":{"&::before":{display:"none"}},[`&.${le.expanded}`]:{"&::before":{opacity:0},"&:first-of-type":{marginTop:0},"&:last-of-type":{marginBottom:0},"& + &":{"&::before":{display:"none"}}},[`&.${le.disabled}`]:{backgroundColor:(e.vars||e).palette.action.disabledBackground}}},({theme:e})=>({variants:[{props:t=>!t.square,style:{borderRadius:0,"&:first-of-type":{borderTopLeftRadius:(e.vars||e).shape.borderRadius,borderTopRightRadius:(e.vars||e).shape.borderRadius},"&:last-of-type":{borderBottomLeftRadius:(e.vars||e).shape.borderRadius,borderBottomRightRadius:(e.vars||e).shape.borderRadius,"@supports (-ms-ime-align: auto)":{borderBottomLeftRadius:0,borderBottomRightRadius:0}}}},{props:t=>!t.disableGutters,style:{[`&.${le.expanded}`]:{margin:"16px 0"}}}]})),jo=l.forwardRef(function(t,o){const r=te({props:t,name:"MuiAccordion"}),{children:n,className:s,defaultExpanded:i=!1,disabled:d=!1,disableGutters:c=!1,expanded:u,onChange:p,square:m=!1,slots:h={},slotProps:f={},TransitionComponent:b,TransitionProps:g}=r,C=oe(r,zo),[$,R]=At({controlled:u,default:i,name:"Accordion",state:"expanded"}),y=l.useCallback(j=>{R(!$),p&&p(j,!$)},[$,p,R]),[A,...J]=l.Children.toArray(n),W=l.useMemo(()=>({expanded:$,disabled:d,disableGutters:c,toggle:y}),[$,d,c,y]),N=k({},r,{square:m,disabled:d,disableGutters:c,expanded:$}),F=Eo(N),fe=k({transition:b},h),B=k({transition:g},f),[X,K]=$o("transition",{elementType:pt,externalForwardedProps:{slots:fe,slotProps:B},ownerState:N});return M.jsxs(Lo,k({className:U(F.root,s),ref:o,ownerState:N,square:m},C,{children:[M.jsx(mt.Provider,{value:W,children:A}),M.jsx(X,k({in:$,timeout:"auto"},K,{children:M.jsx("div",{"aria-labelledby":A.props.id,id:A.props["aria-controls"],role:"region",className:F.region,children:J})}))]}))}),Ge=jo;function Oo(e){return Z("MuiAccordionDetails",e)}ee("MuiAccordionDetails",["root"]);const Wo=["className"],Ko=e=>{const{classes:t}=e;return re({root:["root"]},Oo,t)},qo=_("div",{name:"MuiAccordionDetails",slot:"Root",overridesResolver:(e,t)=>t.root})(({theme:e})=>({padding:e.spacing(1,2,2)})),Vo=l.forwardRef(function(t,o){const r=te({props:t,name:"MuiAccordionDetails"}),{className:n}=r,s=oe(r,Wo),i=r,d=Ko(i);return M.jsx(qo,k({className:U(d.root,n),ref:o,ownerState:i},s))}),Ue=Vo;function Go(e){return Z("MuiAccordionSummary",e)}const Uo=ee("MuiAccordionSummary",["root","expanded","focusVisible","disabled","gutters","contentGutters","content","expandIconWrapper"]),V=Uo,Ho=["children","className","expandIcon","focusVisibleClassName","onClick"],Jo=e=>{const{classes:t,expanded:o,disabled:r,disableGutters:n}=e;return re({root:["root",o&&"expanded",r&&"disabled",!n&&"gutters"],focusVisible:["focusVisible"],content:["content",o&&"expanded",!n&&"contentGutters"],expandIconWrapper:["expandIconWrapper",o&&"expanded"]},Go,t)},Fo=_(Nt,{name:"MuiAccordionSummary",slot:"Root",overridesResolver:(e,t)=>t.root})(({theme:e})=>{const t={duration:e.transitions.duration.shortest};return{display:"flex",minHeight:48,padding:e.spacing(0,2),transition:e.transitions.create(["min-height","background-color"],t),[`&.${V.focusVisible}`]:{backgroundColor:(e.vars||e).palette.action.focus},[`&.${V.disabled}`]:{opacity:(e.vars||e).palette.action.disabledOpacity},[`&:hover:not(.${V.disabled})`]:{cursor:"pointer"},variants:[{props:o=>!o.disableGutters,style:{[`&.${V.expanded}`]:{minHeight:64}}}]}}),Xo=_("div",{name:"MuiAccordionSummary",slot:"Content",overridesResolver:(e,t)=>t.content})(({theme:e})=>({display:"flex",flexGrow:1,margin:"12px 0",variants:[{props:t=>!t.disableGutters,style:{transition:e.transitions.create(["margin"],{duration:e.transitions.duration.shortest}),[`&.${V.expanded}`]:{margin:"20px 0"}}}]})),Qo=_("div",{name:"MuiAccordionSummary",slot:"ExpandIconWrapper",overridesResolver:(e,t)=>t.expandIconWrapper})(({theme:e})=>({display:"flex",color:(e.vars||e).palette.action.active,transform:"rotate(0deg)",transition:e.transitions.create("transform",{duration:e.transitions.duration.shortest}),[`&.${V.expanded}`]:{transform:"rotate(180deg)"}})),Yo=l.forwardRef(function(t,o){const r=te({props:t,name:"MuiAccordionSummary"}),{children:n,className:s,expandIcon:i,focusVisibleClassName:d,onClick:c}=r,u=oe(r,Ho),{disabled:p=!1,disableGutters:m,expanded:h,toggle:f}=l.useContext(mt),b=$=>{f&&f($),c&&c($)},g=k({},r,{expanded:h,disabled:p,disableGutters:m}),C=Jo(g);return M.jsxs(Fo,k({focusRipple:!1,disableRipple:!0,disabled:p,component:"div","aria-expanded":h,className:U(C.root,s),focusVisibleClassName:U(C.focusVisible,d),onClick:b,ref:o,ownerState:g},u,{children:[M.jsx(Xo,{className:C.content,ownerState:g,children:n}),i&&M.jsx(Qo,{className:C.expandIconWrapper,ownerState:g,children:i})]}))}),He=Yo;function Zo(e){return Z("MuiLinearProgress",e)}ee("MuiLinearProgress",["root","colorPrimary","colorSecondary","determinate","indeterminate","buffer","query","dashed","dashedColorPrimary","dashedColorSecondary","bar","barColorPrimary","barColorSecondary","bar1Indeterminate","bar1Determinate","bar1Buffer","bar2Indeterminate","bar2Buffer"]);const er=["className","color","value","valueBuffer","variant"];let H=e=>e,Je,Fe,Xe,Qe,Ye,Ze;const xe=4,tr=ke(Je||(Je=H`
  0% {
    left: -35%;
    right: 100%;
  }

  60% {
    left: 100%;
    right: -90%;
  }

  100% {
    left: 100%;
    right: -90%;
  }
`)),or=ke(Fe||(Fe=H`
  0% {
    left: -200%;
    right: 100%;
  }

  60% {
    left: 107%;
    right: -8%;
  }

  100% {
    left: 107%;
    right: -8%;
  }
`)),rr=ke(Xe||(Xe=H`
  0% {
    opacity: 1;
    background-position: 0 -23px;
  }

  60% {
    opacity: 0;
    background-position: 0 -23px;
  }

  100% {
    opacity: 1;
    background-position: -200px -23px;
  }
`)),ar=e=>{const{classes:t,variant:o,color:r}=e,n={root:["root",`color${E(r)}`,o],dashed:["dashed",`dashedColor${E(r)}`],bar1:["bar",`barColor${E(r)}`,(o==="indeterminate"||o==="query")&&"bar1Indeterminate",o==="determinate"&&"bar1Determinate",o==="buffer"&&"bar1Buffer"],bar2:["bar",o!=="buffer"&&`barColor${E(r)}`,o==="buffer"&&`color${E(r)}`,(o==="indeterminate"||o==="query")&&"bar2Indeterminate",o==="buffer"&&"bar2Buffer"]};return re(n,Zo,t)},Ie=(e,t)=>t==="inherit"?"currentColor":e.vars?e.vars.palette.LinearProgress[`${t}Bg`]:e.palette.mode==="light"?zt(e.palette[t].main,.62):Et(e.palette[t].main,.5),nr=_("span",{name:"MuiLinearProgress",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:o}=e;return[t.root,t[`color${E(o.color)}`],t[o.variant]]}})(({ownerState:e,theme:t})=>k({position:"relative",overflow:"hidden",display:"block",height:4,zIndex:0,"@media print":{colorAdjust:"exact"},backgroundColor:Ie(t,e.color)},e.color==="inherit"&&e.variant!=="buffer"&&{backgroundColor:"none","&::before":{content:'""',position:"absolute",left:0,top:0,right:0,bottom:0,backgroundColor:"currentColor",opacity:.3}},e.variant==="buffer"&&{backgroundColor:"transparent"},e.variant==="query"&&{transform:"rotate(180deg)"})),sr=_("span",{name:"MuiLinearProgress",slot:"Dashed",overridesResolver:(e,t)=>{const{ownerState:o}=e;return[t.dashed,t[`dashedColor${E(o.color)}`]]}})(({ownerState:e,theme:t})=>{const o=Ie(t,e.color);return k({position:"absolute",marginTop:0,height:"100%",width:"100%"},e.color==="inherit"&&{opacity:.3},{backgroundImage:`radial-gradient(${o} 0%, ${o} 16%, transparent 42%)`,backgroundSize:"10px 10px",backgroundPosition:"0 -23px"})},$e(Qe||(Qe=H`
    animation: ${0} 3s infinite linear;
  `),rr)),ir=_("span",{name:"MuiLinearProgress",slot:"Bar1",overridesResolver:(e,t)=>{const{ownerState:o}=e;return[t.bar,t[`barColor${E(o.color)}`],(o.variant==="indeterminate"||o.variant==="query")&&t.bar1Indeterminate,o.variant==="determinate"&&t.bar1Determinate,o.variant==="buffer"&&t.bar1Buffer]}})(({ownerState:e,theme:t})=>k({width:"100%",position:"absolute",left:0,bottom:0,top:0,transition:"transform 0.2s linear",transformOrigin:"left",backgroundColor:e.color==="inherit"?"currentColor":(t.vars||t).palette[e.color].main},e.variant==="determinate"&&{transition:`transform .${xe}s linear`},e.variant==="buffer"&&{zIndex:1,transition:`transform .${xe}s linear`}),({ownerState:e})=>(e.variant==="indeterminate"||e.variant==="query")&&$e(Ye||(Ye=H`
      width: auto;
      animation: ${0} 2.1s cubic-bezier(0.65, 0.815, 0.735, 0.395) infinite;
    `),tr)),lr=_("span",{name:"MuiLinearProgress",slot:"Bar2",overridesResolver:(e,t)=>{const{ownerState:o}=e;return[t.bar,t[`barColor${E(o.color)}`],(o.variant==="indeterminate"||o.variant==="query")&&t.bar2Indeterminate,o.variant==="buffer"&&t.bar2Buffer]}})(({ownerState:e,theme:t})=>k({width:"100%",position:"absolute",left:0,bottom:0,top:0,transition:"transform 0.2s linear",transformOrigin:"left"},e.variant!=="buffer"&&{backgroundColor:e.color==="inherit"?"currentColor":(t.vars||t).palette[e.color].main},e.color==="inherit"&&{opacity:.3},e.variant==="buffer"&&{backgroundColor:Ie(t,e.color),transition:`transform .${xe}s linear`}),({ownerState:e})=>(e.variant==="indeterminate"||e.variant==="query")&&$e(Ze||(Ze=H`
      width: auto;
      animation: ${0} 2.1s cubic-bezier(0.165, 0.84, 0.44, 1) 1.15s infinite;
    `),or)),cr=l.forwardRef(function(t,o){const r=te({props:t,name:"MuiLinearProgress"}),{className:n,color:s="primary",value:i,valueBuffer:d,variant:c="indeterminate"}=r,u=oe(r,er),p=k({},r,{color:s,variant:c}),m=ar(p),h=Bt(),f={},b={bar1:{},bar2:{}};if((c==="determinate"||c==="buffer")&&i!==void 0){f["aria-valuenow"]=Math.round(i),f["aria-valuemin"]=0,f["aria-valuemax"]=100;let g=i-100;h&&(g=-g),b.bar1.transform=`translateX(${g}%)`}if(c==="buffer"&&d!==void 0){let g=(d||0)-100;h&&(g=-g),b.bar2.transform=`translateX(${g}%)`}return M.jsxs(nr,k({className:U(m.root,n),ownerState:p,role:"progressbar"},f,{ref:o},u,{children:[c==="buffer"?M.jsx(sr,{className:m.dashed,ownerState:p}):null,M.jsx(ir,{className:m.bar1,ownerState:p,style:b.bar1}),c==="determinate"?null:M.jsx(lr,{className:m.bar2,ownerState:p,style:b.bar2})]}))}),dr=cr;function ur({avatar:e,title:t,action:o}){return v(S,{display:"flex",gap:1,p:2,alignItems:"center",children:[e,a(w,{variant:"subtitle1",sx:{flexGrow:1},children:t}),o&&a(w,{variant:"caption",children:o})]})}function pr({condition:e,wrapper:t,falseWrapper:o,children:r}){return e?t(r):o?o(r):r}function et({value:e,onChange:t,...o}){const[r,n]=l.useState(e);l.useEffect(()=>{n(e)},[e]);const s=()=>t(r);return a(yo,{value:r,onChange:i=>n(i.target.value),onBlur:s,onKeyDown:i=>i.key==="Enter"&&!o.multiline&&s(),...o})}function mr(e){const{t}=T("ui"),o=be({path:"/:page/*"}),r=t("pageTitle"),n=e??((o==null?void 0:o.params.page)&&t(`tabs.${o==null?void 0:o.params.page}`));l.useEffect(()=>{n?document.title=`${n} - ${r}`:document.title=r},[t,r,n])}function Ae(e,t){const[o,r]=lo(),n=l.useMemo(()=>o&&e.get(t),[o,e,t]);return l.useEffect(()=>e.follow(t,r),[e,t,r]),n}function fr(e){const{database:t}=I();return Ae(t.builds,e??"")}function ft(e){const t=l.useMemo(()=>e||Lt(rt,()=>""),[e]),{database:o}=I(),[r,n]=l.useState(()=>je(t,s=>o.relics.get(s)));return l.useEffect(()=>{n(je(t,i=>o.relics.get(i)));const s=Object.values(t).map(i=>o.relics.follow(i,(d,c,u)=>{c==="update"&&n(p=>({...p,[u.slotKey]:u})),c==="remove"&&n(p=>({...p,[u.slotKey]:void 0}))}));return()=>s.forEach(i=>i())},[o,t]),r}function G(e){const{database:t}=I();return Ae(t.loadouts,e??"")}function ht(e){const{database:t}=I();return Ae(t.teams,e)}function hr({slot:e}){const{t}=T("relic");return a(L,{sx:{height:"100%"},children:v(O,{children:[v(w,{children:[t("slot"),": ",e]}),a(w,{children:t("empty")})]})})}function gr({build:e}){const t=ft(e);return a(P,{container:!0,columns:3,spacing:1,children:rt.map(o=>{const r=t[o];return a(P,{item:!0,xs:1,children:r?a(So,{relic:r}):a(hr,{slot:o})},`${o}_${r==null?void 0:r.id}`)})})}function br({charKey:e,setCharKey:t}){const{t:o}=T(["character","charNames_gen"]),{database:r}=I(),n=l.useCallback(d=>!!r.chars.get(d),[r.chars]),s=l.useCallback(d=>r.charMeta.get(d).favorite,[r.charMeta]),i=l.useMemo(()=>[{key:"",label:o("character:autocomplete.none")},...jt.map(d=>({key:d,label:o(`charNames_gen:${d}`),favorite:s(d),color:n(d)?void 0:"secondary"}))],[n,s,o]);return a(l.Suspense,{fallback:a(Se,{variant:"text",width:100}),children:a(ko,{options:i,toImg:()=>a(me,{children:" "}),valueKey:e,onChange:d=>t(d??"")})})}const vr={RuanMei:Ot};function xr({document:e,bgt:t="normal",collapse:o=!1}){switch(e.type){case"fields":return a(yr,{fieldsDocument:e,bgt:t});case"text":return o?a(Cr,{textDocument:e}):a(gt,{textDocument:e});case"conditional":return null;default:return null}}function yr({fieldsDocument:e,bgt:t="normal"}){return v(L,{bgt:t,children:[e.header&&a(kr,{header:e.header,hideDivider:e.fields.length===0}),a(Wt,{bgt:t,fields:e.fields})]})}function gt({textDocument:e}){const t=l.useContext(Me);return t?a("div",{children:Kt(e.text,t)}):null}function Cr({textDocument:e}){const[t,o]=l.useState(!1),[r,n]=l.useState(!1);return v(S,{sx:{position:"relative"},children:[!t&&a(S,{sx:{pointerEvents:"none",position:"absolute",mx:"auto",width:"100%",display:"flex",justifyContent:"center",height:"100%",alignItems:"flex-end",zIndex:"10",transition:"transform 0.3s ease",transform:r?"translate(0,-5px)":void 0},children:a(Co,{})}),a(pt,{onMouseEnter:()=>n(!0),onMouseLeave:()=>n(!1),collapsedSize:55,onClick:()=>o(s=>!s),in:t,sx:{cursor:"pointer",position:"relative",maskImage:t?void 0:"linear-gradient(to bottom, black 0%, transparent 100%)","&:hover":{maskImage:t?void 0:"linear-gradient(to bottom, black 50%, transparent 100%)"}},children:a(gt,{textDocument:e})})]})}function kr({header:e,hideDivider:t}){const{icon:o,text:r,additional:n}=e;return v(me,{children:[a(ur,{avatar:o,title:r,action:n}),!t&&a(ue,{})]})}function ae(){return l.useContext(Me)}function bt({optTarget:e,setOptTarget:t}){const{t:o}=T("optimize"),r=ae();return a(Pe,{title:`${o("optTarget")}${e?`: ${e.tag.name||e.tag.q}`:""}`,children:r==null?void 0:r.listFormulas(we.listing.formulas).map((n,s)=>a(_e,{onClick:()=>t(n),children:n.tag.name||n.tag.q},`${s}_${n.tag.name||n.tag.q}`))})}function $r({statFilters:e,setStatFilters:t,disabled:o=!1}){const r=l.useCallback((c,u,p)=>{const m={...e},h=JSON.stringify(u),f=u?[...e[h]]:void 0,b=JSON.stringify(c),g=[...e[b]??[]];p!==void 0&&f?g.push(f[p]):g.push({minValue:0,maxValue:0,disabled:!1}),m[b]=g,p!==void 0&&f&&(f.splice(p,1),f.length?m[h]=f:delete m[h]),t({...m})},[t,e]),n=l.useCallback((c,u)=>{const p={...e},m=JSON.stringify(c),h=[...e[m]];h.splice(u,1),h.length?p[m]=h:delete p[m],t({...p})},[t,e]),s=l.useCallback((c,u,p)=>{const m={...e},h=JSON.stringify(c),f=[...e[h]];f[u]={...f[u],minValue:p},m[h]=f,t({...m})},[t,e]),i=l.useCallback((c,u,p)=>{const m={...e},h=JSON.stringify(c),f=[...e[h]];f[u]={...f[u],maxValue:p},m[h]=f,t({...m})},[t,e]),d=l.useCallback((c,u,p)=>{const m={...e},h=JSON.stringify(c),f=[...e[h]];f[u]={...f[u],disabled:p},m[h]=f,t({...m})},[t,e]);return v(me,{children:[Object.entries(e).flatMap(([c,u])=>u==null?void 0:u.map((p,m)=>a(tt,{path:JSON.parse(c),setting:p,index:m,setTarget:r,delTarget:n,setMinValue:s,setMaxValue:i,setDisabled:d,disabled:o},c+m))),a(tt,{delTarget:n,setTarget:r,setMinValue:s,setMaxValue:i,setDisabled:d,disabled:o})]})}function tt({path:e,setting:t,index:o,delTarget:r,setMinValue:n,setMaxValue:s,setDisabled:i,disabled:d}){const{t:c}=T("page_character_optimize"),u=l.useCallback(b=>e&&o!==void 0&&n(e,o,b??0),[n,e,o]),p=l.useCallback(b=>e&&o!==void 0&&s(e,o,b??1/0),[s,e,o]),[m,h]=l.useState(void 0),f={p:1,flexBasis:30,flexGrow:0,flexShrink:0};return v(Gt,{sx:{"& .MuiButtonGroup-grouped":{minWidth:24},width:"100%"},children:[!!t&&!!e&&o!==void 0&&a(pe,{sx:f,color:t.disabled?"secondary":"success",onClick:()=>i(e,o,!t.disabled),disabled:d,children:t.disabled?a(qt,{}):a(Vt,{})}),a(We,{sx:{flexBasis:150,flexGrow:1},children:a(Oe,{float:!0,disabled:!e||d,value:t==null?void 0:t.minValue,placeholder:c("buildConstraint.minStatValue"),onChange:u,sx:{px:1},inputProps:{sx:{"& + .MuiOutlinedInput-notchedOutline":{borderRadius:0},textAlign:"right"}}})}),a(bt,{optTarget:m,setOptTarget:h}),a(We,{sx:{flexBasis:150,flexGrow:1},children:a(Oe,{float:!0,disabled:!e||d,value:t==null?void 0:t.maxValue,placeholder:c("buildConstraint.maxStatValue"),onChange:p,sx:{px:1},inputProps:{sx:{"& + .MuiOutlinedInput-notchedOutline":{borderRadius:0},textAlign:"left"}}})}),!!e&&o!==void 0&&a(pe,{sx:f,color:"error",onClick:()=>r(e,o),disabled:d,children:a(Mo,{fontSize:"small"})})]})}function Sr({disabled:e=!1}){const{t}=T("page_character_optimize"),[o,r]=l.useState({});return a(S,{children:v(L,{bgt:"light",children:[a(O,{sx:{display:"flex",gap:1,justifyContent:"space-between",flexDirection:"column"},children:v(S,{display:"flex",justifyContent:"space-between",children:[a(w,{sx:{fontWeight:"bold"},children:t`constraintFilter.title`}),a(wo,{title:a(w,{children:t`constraintFilter.tooltip`})})]})}),a(ue,{}),a(S,{display:"flex",flexDirection:"column",gap:.5,children:a($r,{statFilters:o,setStatFilters:r,disabled:e})})]})})}function Mr({numWorkers:e,setNumWorkers:t}){const{t:o}=T("optimize"),r=navigator.hardwareConcurrency||8;return a(Pe,{title:`${o("numWorkers")}: ${e}`,children:at(1,r).map(n=>a(_e,{onClick:()=>t(n),children:o("workers",{count:n})},n))})}function wr({teamId:e,src:t,children:o}){var g,C,$,R;const r=ht(e),n=G((g=r.loadoutMetadata[0])==null?void 0:g.loadoutId),s=G((C=r.loadoutMetadata[1])==null?void 0:C.loadoutId),i=G(($=r.loadoutMetadata[2])==null?void 0:$.loadoutId),d=G((R=r.loadoutMetadata[3])==null?void 0:R.loadoutId),c=l.useMemo(()=>{const y={all:"all"};return n&&(y[n.key]="0"),s&&(y[s.key]="1"),i&&(y[i.key]="2"),d&&(y[d.key]="3"),y},[n,s,i,d]),u=ce(r.loadoutMetadata[0],c),p=ce(r.loadoutMetadata[1],c),m=ce(r.loadoutMetadata[2],c),h=ce(r.loadoutMetadata[3],c),f=l.useMemo(()=>uo([...po(r.loadoutMetadata.map((y,A)=>y===void 0?void 0:nt[A]).filter(y=>!!y)),...u?de(0,u):[],...p?de(1,p):[],...m?de(2,m):[],...h?de(3,h):[],ie.common.lvl.add(80),ie.common.res.add(.1),ie.common.isBroken.add(0),ie.common.maxToughness.add(100),Ut.common.critMode.add("avg")]),[u,p,m,h,r.loadoutMetadata]),b=l.useMemo(()=>(f==null?void 0:f.withTag({src:t}))??null,[f,t]);return a(Me.Provider,{value:b,children:o})}function ce(e,t){const o=G(e==null?void 0:e.loadoutId),r=lt(o==null?void 0:o.key),n=fr(e==null?void 0:e.buildId),s=xo(n==null?void 0:n.lightConeId),i=ft(n==null?void 0:n.relicIds),d=l.useMemo(()=>Object.fromEntries(Object.entries((o==null?void 0:o.conditional)??{}).map(([c,u])=>[t[c],u])),[o,t]);return l.useMemo(()=>({character:r,lightCone:s,relics:i,conditionals:d}),[r,s,d,i])}function de(e,{character:t,lightCone:o,relics:r,conditionals:n}){return t?[...mo(`${e}`,...fo(t),...ho(o),...go(Object.values(r).filter(s=>!!s).map(s=>({set:s.setKey,stats:[...s.substats.filter(({key:i})=>i!=="").map(i=>({key:i.key,value:i.accurateValue})),{key:s.mainStatKey,value:s.mainStatVal}]})))),...bo(`${e}`,n)]:[]}var Ne={},Rr=Te;Object.defineProperty(Ne,"__esModule",{value:!0});var vt=Ne.default=void 0,Tr=Rr(Re()),Dr=M,_r=(0,Tr.default)((0,Dr.jsx)("path",{d:"M22 24H2v-4h20v4zM13.06 5.19l3.75 3.75L7.75 18H4v-3.75l9.06-9.06zm4.82 2.68-3.75-3.75 1.83-1.83c.39-.39 1.02-.39 1.41 0l2.34 2.34c.39.39.39 1.02 0 1.41l-1.83 1.83z"}),"BorderColor");vt=Ne.default=_r;function Pr({teamId:e,charKey:t,tab:o=""}){const{t:r}=T("page_team"),n=st(),{database:s}=I(),i=s.teams.get(e),{loadoutMetadata:d}=i,c=Ce(),u=it(c.breakpoints.down("md")),[p,m]=l.useState(!1),h=b=>{s.teams.set(e,{name:b})},f=b=>{s.teams.set(e,{description:b})};return v(S,{sx:()=>({borderBottom:"1px rgb(200,200,200,0.3) solid","& .MuiTab-root:hover":{transition:"background-color 0.25s ease",backgroundColor:"rgba(255,255,255,0.1)"},"& .Mui-selected":{color:"white !important"},"& .MuiTabs-indicator":{height:"4px",backgroundColor:"rgb(200,200,200,0.5)"}}),children:[a(dt,{onClick:()=>m(!0),children:a(Ht,{placement:"top",title:v(S,{children:[v(S,{sx:{display:"flex",color:"info.light",gap:1},children:[a(vt,{}),a(w,{children:a("strong",{children:r`team.editNameDesc`})})]}),!!i.description&&a(w,{children:i.description})]}),children:a(O,{sx:{display:"flex",justifyContent:"center","&:hover":{color:"info.light"}},children:v(w,{variant:"h5",sx:{display:"flex",gap:1,alignItems:"center",justifyContent:"center",textShadow:"#000 0 0 10px !important"},children:[a(ge,{}),i.name]})})})}),a(Ft,{open:p,onClose:()=>m(!1),children:v(L,{children:[a(co,{title:r`team.editNameDesc`,avatar:a(ge,{}),titleTypographyProps:{variant:"h6"},action:a(Jt,{onClick:()=>m(!1),children:a(ct,{})})}),a(ue,{}),a(O,{children:v(S,{display:"flex",flexDirection:"column",gap:2,sx:{mt:2},children:[a(et,{label:r`team.name`,value:i.name,onChange:b=>h(b),autoFocus:!0}),a(et,{label:r`team.desc`,value:i.description,onChange:b=>f(b),multiline:!0,minRows:4})]})})]})}),a(ue,{}),v(Xt,{variant:"fullWidth",value:t??"team",orientation:u?"vertical":"horizontal",children:[a(Ke,{icon:a(ge,{}),iconPosition:"start",value:"team",label:"Team Settings",onClick:()=>n(`/teams/${e}/`)}),d.map((b,g)=>{var $;const C=b&&(($=s.loadouts.get(b==null?void 0:b.loadoutId))==null?void 0:$.key);return a(Ke,{icon:a(Qt,{}),iconPosition:"start",value:C??g,disabled:!d[g],label:C?a(w,{children:r(`charNames_gen:${C}`)}):`Character ${g+1}`,onClick:()=>C&&n(`/teams/${e}/${C}/${o}`)},g)})]})]})}function Ir({teamId:e}){const{database:t}=I(),o=t.teams.get(e);return v(S,{children:[e,o.loadoutMetadata.map((r,n)=>a(Ar,{loadoutMetadataIndex:n,teamId:e},`${n}_${r==null?void 0:r.loadoutId}`))]})}function Ar({loadoutMetadataIndex:e,teamId:t}){var d;const{database:o}=I(),r=o.teams.get(t),n=(d=r.loadoutMetadata[e])==null?void 0:d.loadoutId,s=o.loadouts.get(n);function i(c){if(c===""){o.teams.set(t,p=>p.loadoutMetadata[e]=void 0);return}o.chars.getOrCreate(c);const u=r.loadoutMetadata.findIndex(p=>{var m;return p&&((m=o.loadouts.get(p.loadoutId))==null?void 0:m.key)===c});if(u===-1){let p=o.loadouts.keys.find(m=>o.loadouts.get(m).key===c);p||(p=o.loadouts.new(c)),o.teams.set(t,m=>{m.loadoutMetadata[e]={loadoutId:p}})}else{if(u===e)return;const p=r.loadoutMetadata[u],m=r.loadoutMetadata[e];o.teams.set(t,h=>{h.loadoutMetadata[e]=p,h.loadoutMetadata[u]=m})}}return a(br,{charKey:(s==null?void 0:s.key)??"",setCharKey:i})}var Be={},Nr=Te;Object.defineProperty(Be,"__esModule",{value:!0});var ye=Be.default=void 0,Br=Nr(Re()),zr=M,Er=(0,Br.default)((0,zr.jsx)("path",{d:"M16.59 8.59 12 13.17 7.41 8.59 6 10l6 6 6-6z"}),"ExpandMore");ye=Be.default=Er;const Lr=5e4;class jr{constructor(t,o,r,n,s){this.calc=t,this.optTarget=o,this.relicsBySlot=r,this.numWorkers=n,this.setProgress=s,this.worker=new Worker(new URL(""+new URL("parentWorker-CAAYnoOP.js",import.meta.url).href,import.meta.url),{type:"module"})}async optimize(){return await new Promise((o,r)=>{this.worker.onmessage=({data:s})=>{switch(s.resultType){case"progress":this.setProgress(s.progress);break;case"done":o(s.buildResults);break;case"err":console.log(s),r();break}};const n={command:"start",relicsBySlot:this.relicsBySlot,detachedNodes:this.detachNodes(),numWorkers:this.numWorkers};this.worker.postMessage(n)})}async terminate(){const t={command:"terminate"};this.worker.postMessage(t),await new Promise((o,r)=>{this.worker.onmessage=({data:n})=>{switch(n.resultType){case"terminated":o();break;case"err":console.log(n),r();break}}}),this.worker.terminate()}detachNodes(){const t=new Set(Yt);return vo([this.optTarget],this.calc,r=>{if(r.src==="0"&&r.et==="own"){if(r.sheet==="dyn"&&r.qt==="premod")return{q:r.q};if(r.q==="count"&&t.has(r.sheet))return{q:r.sheet}}})}}var ze={},Or=Te;Object.defineProperty(ze,"__esModule",{value:!0});var xt=ze.default=void 0,Wr=Or(Re()),Kr=M,qr=(0,Wr.default)((0,Kr.jsx)("path",{d:"m16 6 2.29 2.29-4.88 4.88-4-4L2 16.59 3.41 18l6-6 4 4 6.3-6.29L22 12V6z"}),"TrendingUp");xt=ze.default=qr;function Vr(){const{t:e}=T("optimize"),{database:t}=I(),o=ae(),[r,n]=l.useState(8),[s,i]=l.useState(void 0),[d,c]=l.useState(void 0),u=l.useMemo(()=>t.relics.values.reduce((R,y)=>(R[y.slotKey].push(y),R),{head:[],hands:[],feet:[],body:[],sphere:[],rope:[]}),[t.relics.values]),p=Object.values(u).reduce((R,y)=>R*y.length,1),[m,h]=l.useState(void 0),[f,b]=l.useState(!1),g=l.useRef(()=>{});l.useEffect(()=>()=>g.current(),[]);const C=l.useCallback(async()=>{if(!d||!o)return;const R=new Promise(J=>g.current=J);i(void 0),b(!0);const y=new jr(o,d,u,r,i);R.then(async()=>await y.terminate());const A=await y.optimize();await y.terminate(),g.current=()=>{},b(!1),h(A[0])},[o,r,d,u]),$=l.useCallback(()=>{g.current(),b(!1)},[g]);return a(L,{bgt:"dark",children:v(O,{children:[a(Sr,{}),v(ve,{children:[a(w,{variant:"h5",children:e("optimize")}),v(S,{children:[a(bt,{optTarget:d,setOptTarget:c}),a(Mr,{numWorkers:r,setNumWorkers:n}),a(pe,{onClick:f?$:C,color:f?"error":"primary",startIcon:f?a(ct,{}):a(xt,{}),children:e(f?"cancel":"optimize")})]}),s&&a(Gr,{progress:s,totalPermutations:p}),m&&v(S,{children:[v(w,{children:["Best: ",m.value]}),a(gr,{build:m.ids})]})]})]})})}function Gr({progress:e,totalPermutations:t}){const{t:o}=T("optimize");return v(S,{children:[v(w,{children:[o("totalProgress"),": ",e.numBuildsComputed.toLocaleString()," /"," ",t.toLocaleString()]}),v(w,{children:[o("buildsKept"),": ",e.numBuildsKept.toLocaleString()," /"," ",Lr.toLocaleString()]}),a(dr,{variant:"determinate",value:e.numBuildsComputed/t*100})]})}const Ur={xs:12,sm:6,md:4};function Hr(){const{loadout:{key:e}}=De(),t=ae(),{t:o}=T("sheet_gen"),r=[["basic",o("talents.basic")],["skill",o("talents.skill")],["ultimate",o("talents.ultimate")]],n=Ce(),s=it(n.breakpoints.up("lg")),i=vr[e];if(console.log({characterSheet:i,calc:t}),!(!i||!t))return a(me,{children:v(P,{container:!0,spacing:1,children:[s&&a(P,{item:!0,xs:12,md:12,lg:3,sx:{display:"flex",flexDirection:"column",gap:1},children:a(ot,{})}),a(P,{item:!0,xs:12,md:12,lg:9,container:!0,spacing:1,children:r.map(([d,c])=>{const u=i[d];return u?a(P,{item:!0,...Ur,children:a(Jr,{talentKey:d,subtitle:c,sheetElement:u})},d):null})}),!s&&a(P,{item:!0,xs:12,md:12,lg:3,container:!0,spacing:1,children:a(P,{item:!0,xs:12,children:a(ot,{})})})]})})}function Jr({sheetElement:e,subtitle:t,onClickTitle:o}){const r=l.useCallback(s=>a(dt,{onClick:o,children:s}),[o]);let n=null;return n=null,v(L,{bgt:"light",sx:{height:"100%"},children:[n,v(O,{children:[a(pr,{condition:!!o,wrapper:r,children:v(P,{container:!0,sx:{flexWrap:"nowrap"},children:[a(P,{item:!0,children:a(S,{component:qe?qe:"img",src:e==null?void 0:e.img,sx:{width:60,height:"auto"}})}),v(P,{item:!0,flexGrow:1,sx:{pl:1},children:[a(w,{variant:"h6",children:e==null?void 0:e.name}),a(w,{variant:"subtitle1",children:t})]})]})}),e.documents.map((s,i)=>a(xr,{document:s,collapse:!0},i))]})]})}function ot(){const{t:e}=T("sheet_gen"),t=ae();if(!t)return null;const o=t.compute(we.char.eidolon).val;return a(Pe,{fullWidth:!0,title:e("constellationLvl",{level:o}),color:"primary",children:at(0,Zt).map(r=>a(_e,{selected:o===r,disabled:o===r,onClick:()=>{},children:e("constellationLvl",{level:r})},r))})}function Fr({tab:e}){const{loadout:{key:t}}=De(),{character:o}=eo(),r=ae(),[n,s]=l.useState(void 0);return v(S,{children:[e,a(so,{characterKey:n,onClose:()=>s(void 0)}),a(io,{character:o}),v(ve,{gap:1,pt:1,children:[a(L,{bgt:"dark",children:v(O,{children:[a(pe,{disabled:!t,onClick:()=>t&&s(t),children:"Edit Character"}),v(Ge,{children:[a(He,{expandIcon:a(ye,{}),children:"All target values, if sheet is created"}),a(Ue,{children:a(ve,{children:r==null?void 0:r.listFormulas(we.listing.formulas).map((i,d)=>{const c=r.compute(i),u=i.tag.name||i.tag.q;return v(S,{children:[v(w,{children:[u,": ",c.val]}),v(Ge,{children:[v(He,{expandIcon:a(ye,{}),children:["debug for ",u]}),a(Ue,{children:a(w,{component:"pre",children:JSON.stringify(r.toDebug().compute(i),void 0,2)})})]})]},`${u}${d}`)})})})]})]})}),a(Hr,{}),a(Vr,{})]})]})}const Xr=a(Se,{variant:"rectangular",width:"100%",height:1e3});function ca(){const{database:e}=I(),{teamId:t}=to(),o=!t||!e.teams.keys.includes(t);return l.useEffect(()=>{o||e.teams.set(t,{lastEdit:Date.now()})},[t,e.teams,o]),o?a(ao,{to:"/teams"}):a(S,{display:"flex",flexDirection:"column",gap:1,children:a(l.Suspense,{fallback:Xr,children:t&&a(Qr,{teamId:t})})})}function Qr({teamId:e}){var b;const{database:t}=I(),o=st(),r=ht(e),{loadoutMetadata:n}=r,{params:{characterKey:s}}=be({path:"/teams/:teamId/:characterKey",end:!1})??{params:{}},{params:{tab:i}}=be({path:"/teams/:teamId/:characterKey/:tab"})??{params:{}},d=l.useMemo(()=>n.findIndex(g=>{var C;return(g==null?void 0:g.loadoutId)&&((C=t.loadouts.get(g.loadoutId))==null?void 0:C.key)===s}),[n,t.loadouts,s]),c=l.useMemo(()=>n[d],[n,d]);l.useEffect(()=>{window.scrollTo({top:0})},[]),l.useEffect(()=>{c||o("",{replace:!0})},[c,o]);const u=c==null?void 0:c.loadoutId,p=(b=t.loadouts.get(u))==null?void 0:b.key,{t:m}=T(["charNames_gen","page_character"]);mr(l.useMemo(()=>{const g=m(p?"charNames_gen:Character":"Team Settings"),C=i?m(`page_character:tabs.${i}`):p?m("Loadout/Build"):i;return`${r.name} - ${g}${C?` - ${C}`:""}`},[p,m,i,r.name]));const h=G(u??""),f=l.useMemo(()=>{if(!(!u||!h||!c))return{teamId:e,team:r,loadoutId:u,loadout:h,loadoutMetadatum:c}},[c,r,h,u,e]);return a(wr,{teamId:e,src:nt[d],children:v(S,{sx:{display:"flex",gap:1,flexDirection:"column",mx:1,mt:2},children:[a(L,{children:a(Pr,{teamId:e,charKey:p,tab:i})}),a(S,{children:f?a(oo.Provider,{value:f,children:a(Yr,{})}):a(Ir,{teamId:e})})]})})}function Yr({tab:e}){const{loadout:{key:t}}=De(),o=lt(t),r=l.useMemo(()=>o&&{character:o},[o]);return r?a(ro.Provider,{value:r,children:a(no,{children:a(Ve,{path:":characterKey",children:a(Ve,{path:"*",index:!0,element:a(Fr,{tab:e})})})})}):a(Se,{variant:"rectangular",width:"100%",height:1e3})}export{ca as default};
