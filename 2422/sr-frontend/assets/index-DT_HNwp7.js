import{r as m,g as J,a as X,s as D,P as dt,u as Q,e as Y,i as ut,_ as S,ao as pt,j as k,f as L,h as Z,ap as mt,aq as se,b as T,ar as ie,x as ft,l as ht,d as gt,D as o,C as _,as as te,a1 as w,at as bt,aa as qe,au as ke,H as v,X as $,a8 as B,$ as I,W as P,av as vt,ab as ce,G as le,aw as Ct,z as O,A as q,ax as Ke,ae as de,ay as xt,az as yt,a9 as H,O as Me,N as $e,L as kt,U as M,aA as ae,aB as Ve,aC as We,aD as V,aE as Mt,an as Ge,a5 as Ee,a6 as Ue,aF as $t,I as St,a7 as _t,aG as Rt,aH as Se,F as wt,aI as ue,aJ as He,aK as Pt,aL as _e,aM as Tt,aN as Dt,aO as At,aP as Bt,aQ as It,aR as Nt,aS as jt,aT as Re}from"./index-nhwQ9u8m.js";import{u as Je,S as re,C as zt,a as Lt}from"./CharacterEditor-CHrOYVY6.js";import{u as Ot,C as qt}from"./useForceUpdate-CP8uQNu6.js";import{s as Kt,t as Vt,w as Wt,c as Gt,l as Et,r as Ut,a as Ht,d as Jt}from"./index-DEYZBSBj.js";import{u as Xt}from"./useLightCone-CqkyIGOz.js";import{T as Qt,M as pe,D as me}from"./DropdownButton-BJzY9COf.js";import{G as Yt,d as Xe}from"./LocationAutocomplete-91d8Qav7.js";import{C as Qe}from"./CardActionArea-xxWG-u96.js";import{u as Zt,R as Ft,D as ea}from"./RelicCard-sKoY8l1T.js";import{I as ta}from"./InfoTooltip-JJqHKXsL.js";const aa=m.createContext({}),Ye=aa;function ra(e){return X("MuiAccordion",e)}const oa=J("MuiAccordion",["root","rounded","expanded","disabled","gutters","region"]),W=oa,na=["children","className","defaultExpanded","disabled","disableGutters","expanded","onChange","square","slots","slotProps","TransitionComponent","TransitionProps"],sa=e=>{const{classes:t,square:a,expanded:r,disabled:n,disableGutters:s}=e;return Z({root:["root",!a&&"rounded",r&&"expanded",n&&"disabled",!s&&"gutters"],region:["region"]},ra,t)},ia=D(dt,{name:"MuiAccordion",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:a}=e;return[{[`& .${W.region}`]:t.region},t.root,!a.square&&t.rounded,!a.disableGutters&&t.gutters]}})(({theme:e})=>{const t={duration:e.transitions.duration.shortest};return{position:"relative",transition:e.transitions.create(["margin"],t),overflowAnchor:"none","&::before":{position:"absolute",left:0,top:-1,right:0,height:1,content:'""',opacity:1,backgroundColor:(e.vars||e).palette.divider,transition:e.transitions.create(["opacity","background-color"],t)},"&:first-of-type":{"&::before":{display:"none"}},[`&.${W.expanded}`]:{"&::before":{opacity:0},"&:first-of-type":{marginTop:0},"&:last-of-type":{marginBottom:0},"& + &":{"&::before":{display:"none"}}},[`&.${W.disabled}`]:{backgroundColor:(e.vars||e).palette.action.disabledBackground}}},({theme:e})=>({variants:[{props:t=>!t.square,style:{borderRadius:0,"&:first-of-type":{borderTopLeftRadius:(e.vars||e).shape.borderRadius,borderTopRightRadius:(e.vars||e).shape.borderRadius},"&:last-of-type":{borderBottomLeftRadius:(e.vars||e).shape.borderRadius,borderBottomRightRadius:(e.vars||e).shape.borderRadius,"@supports (-ms-ime-align: auto)":{borderBottomLeftRadius:0,borderBottomRightRadius:0}}}},{props:t=>!t.disableGutters,style:{[`&.${W.expanded}`]:{margin:"16px 0"}}}]})),ca=m.forwardRef(function(t,a){const r=Q({props:t,name:"MuiAccordion"}),{children:n,className:s,defaultExpanded:i=!1,disabled:p=!1,disableGutters:c=!1,expanded:l,onChange:d,square:u=!1,slots:f={},slotProps:h={},TransitionComponent:b,TransitionProps:g}=r,C=Y(r,na),[y,R]=ut({controlled:l,default:i,name:"Accordion",state:"expanded"}),x=m.useCallback(lt=>{R(!y),d&&d(lt,!y)},[y,d,R]),[A,...F]=m.Children.toArray(n),ot=m.useMemo(()=>({expanded:y,disabled:p,disableGutters:c,toggle:x}),[y,p,c,x]),ee=S({},r,{square:u,disabled:p,disableGutters:c,expanded:y}),ye=sa(ee),nt=S({transition:b},f),st=S({transition:g},h),[it,ct]=Zt("transition",{elementType:pt,externalForwardedProps:{slots:nt,slotProps:st},ownerState:ee});return k.jsxs(ia,S({className:L(ye.root,s),ref:a,ownerState:ee,square:u},C,{children:[k.jsx(Ye.Provider,{value:ot,children:A}),k.jsx(it,S({in:y,timeout:"auto"},ct,{children:k.jsx("div",{"aria-labelledby":A.props.id,id:A.props["aria-controls"],role:"region",className:ye.region,children:F})}))]}))}),we=ca;function la(e){return X("MuiAccordionDetails",e)}J("MuiAccordionDetails",["root"]);const da=["className"],ua=e=>{const{classes:t}=e;return Z({root:["root"]},la,t)},pa=D("div",{name:"MuiAccordionDetails",slot:"Root",overridesResolver:(e,t)=>t.root})(({theme:e})=>({padding:e.spacing(1,2,2)})),ma=m.forwardRef(function(t,a){const r=Q({props:t,name:"MuiAccordionDetails"}),{className:n}=r,s=Y(r,da),i=r,p=ua(i);return k.jsx(pa,S({className:L(p.root,n),ref:a,ownerState:i},s))}),Pe=ma;function fa(e){return X("MuiAccordionSummary",e)}const ha=J("MuiAccordionSummary",["root","expanded","focusVisible","disabled","gutters","contentGutters","content","expandIconWrapper"]),N=ha,ga=["children","className","expandIcon","focusVisibleClassName","onClick"],ba=e=>{const{classes:t,expanded:a,disabled:r,disableGutters:n}=e;return Z({root:["root",a&&"expanded",r&&"disabled",!n&&"gutters"],focusVisible:["focusVisible"],content:["content",a&&"expanded",!n&&"contentGutters"],expandIconWrapper:["expandIconWrapper",a&&"expanded"]},fa,t)},va=D(mt,{name:"MuiAccordionSummary",slot:"Root",overridesResolver:(e,t)=>t.root})(({theme:e})=>{const t={duration:e.transitions.duration.shortest};return{display:"flex",minHeight:48,padding:e.spacing(0,2),transition:e.transitions.create(["min-height","background-color"],t),[`&.${N.focusVisible}`]:{backgroundColor:(e.vars||e).palette.action.focus},[`&.${N.disabled}`]:{opacity:(e.vars||e).palette.action.disabledOpacity},[`&:hover:not(.${N.disabled})`]:{cursor:"pointer"},variants:[{props:a=>!a.disableGutters,style:{[`&.${N.expanded}`]:{minHeight:64}}}]}}),Ca=D("div",{name:"MuiAccordionSummary",slot:"Content",overridesResolver:(e,t)=>t.content})(({theme:e})=>({display:"flex",flexGrow:1,margin:"12px 0",variants:[{props:t=>!t.disableGutters,style:{transition:e.transitions.create(["margin"],{duration:e.transitions.duration.shortest}),[`&.${N.expanded}`]:{margin:"20px 0"}}}]})),xa=D("div",{name:"MuiAccordionSummary",slot:"ExpandIconWrapper",overridesResolver:(e,t)=>t.expandIconWrapper})(({theme:e})=>({display:"flex",color:(e.vars||e).palette.action.active,transform:"rotate(0deg)",transition:e.transitions.create("transform",{duration:e.transitions.duration.shortest}),[`&.${N.expanded}`]:{transform:"rotate(180deg)"}})),ya=m.forwardRef(function(t,a){const r=Q({props:t,name:"MuiAccordionSummary"}),{children:n,className:s,expandIcon:i,focusVisibleClassName:p,onClick:c}=r,l=Y(r,ga),{disabled:d=!1,disableGutters:u,expanded:f,toggle:h}=m.useContext(Ye),b=y=>{h&&h(y),c&&c(y)},g=S({},r,{expanded:f,disabled:d,disableGutters:u}),C=ba(g);return k.jsxs(va,S({focusRipple:!1,disableRipple:!0,disabled:d,component:"div","aria-expanded":f,className:L(C.root,s),focusVisibleClassName:L(C.focusVisible,p),onClick:b,ref:a,ownerState:g},l,{children:[k.jsx(Ca,{className:C.content,ownerState:g,children:n}),i&&k.jsx(xa,{className:C.expandIconWrapper,ownerState:g,children:i})]}))}),Te=ya;function ka(e){return X("MuiLinearProgress",e)}J("MuiLinearProgress",["root","colorPrimary","colorSecondary","determinate","indeterminate","buffer","query","dashed","dashedColorPrimary","dashedColorSecondary","bar","barColorPrimary","barColorSecondary","bar1Indeterminate","bar1Determinate","bar1Buffer","bar2Indeterminate","bar2Buffer"]);const Ma=["className","color","value","valueBuffer","variant"];let z=e=>e,De,Ae,Be,Ie,Ne,je;const oe=4,$a=se(De||(De=z`
  0% {
    left: -35%;
    right: 100%;
  }

  60% {
    left: 100%;
    right: -90%;
  }

  100% {
    left: 100%;
    right: -90%;
  }
`)),Sa=se(Ae||(Ae=z`
  0% {
    left: -200%;
    right: 100%;
  }

  60% {
    left: 107%;
    right: -8%;
  }

  100% {
    left: 107%;
    right: -8%;
  }
`)),_a=se(Be||(Be=z`
  0% {
    opacity: 1;
    background-position: 0 -23px;
  }

  60% {
    opacity: 0;
    background-position: 0 -23px;
  }

  100% {
    opacity: 1;
    background-position: -200px -23px;
  }
`)),Ra=e=>{const{classes:t,variant:a,color:r}=e,n={root:["root",`color${T(r)}`,a],dashed:["dashed",`dashedColor${T(r)}`],bar1:["bar",`barColor${T(r)}`,(a==="indeterminate"||a==="query")&&"bar1Indeterminate",a==="determinate"&&"bar1Determinate",a==="buffer"&&"bar1Buffer"],bar2:["bar",a!=="buffer"&&`barColor${T(r)}`,a==="buffer"&&`color${T(r)}`,(a==="indeterminate"||a==="query")&&"bar2Indeterminate",a==="buffer"&&"bar2Buffer"]};return Z(n,ka,t)},fe=(e,t)=>t==="inherit"?"currentColor":e.vars?e.vars.palette.LinearProgress[`${t}Bg`]:e.palette.mode==="light"?ht(e.palette[t].main,.62):gt(e.palette[t].main,.5),wa=D("span",{name:"MuiLinearProgress",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:a}=e;return[t.root,t[`color${T(a.color)}`],t[a.variant]]}})(({ownerState:e,theme:t})=>S({position:"relative",overflow:"hidden",display:"block",height:4,zIndex:0,"@media print":{colorAdjust:"exact"},backgroundColor:fe(t,e.color)},e.color==="inherit"&&e.variant!=="buffer"&&{backgroundColor:"none","&::before":{content:'""',position:"absolute",left:0,top:0,right:0,bottom:0,backgroundColor:"currentColor",opacity:.3}},e.variant==="buffer"&&{backgroundColor:"transparent"},e.variant==="query"&&{transform:"rotate(180deg)"})),Pa=D("span",{name:"MuiLinearProgress",slot:"Dashed",overridesResolver:(e,t)=>{const{ownerState:a}=e;return[t.dashed,t[`dashedColor${T(a.color)}`]]}})(({ownerState:e,theme:t})=>{const a=fe(t,e.color);return S({position:"absolute",marginTop:0,height:"100%",width:"100%"},e.color==="inherit"&&{opacity:.3},{backgroundImage:`radial-gradient(${a} 0%, ${a} 16%, transparent 42%)`,backgroundSize:"10px 10px",backgroundPosition:"0 -23px"})},ie(Ie||(Ie=z`
    animation: ${0} 3s infinite linear;
  `),_a)),Ta=D("span",{name:"MuiLinearProgress",slot:"Bar1",overridesResolver:(e,t)=>{const{ownerState:a}=e;return[t.bar,t[`barColor${T(a.color)}`],(a.variant==="indeterminate"||a.variant==="query")&&t.bar1Indeterminate,a.variant==="determinate"&&t.bar1Determinate,a.variant==="buffer"&&t.bar1Buffer]}})(({ownerState:e,theme:t})=>S({width:"100%",position:"absolute",left:0,bottom:0,top:0,transition:"transform 0.2s linear",transformOrigin:"left",backgroundColor:e.color==="inherit"?"currentColor":(t.vars||t).palette[e.color].main},e.variant==="determinate"&&{transition:`transform .${oe}s linear`},e.variant==="buffer"&&{zIndex:1,transition:`transform .${oe}s linear`}),({ownerState:e})=>(e.variant==="indeterminate"||e.variant==="query")&&ie(Ne||(Ne=z`
      width: auto;
      animation: ${0} 2.1s cubic-bezier(0.65, 0.815, 0.735, 0.395) infinite;
    `),$a)),Da=D("span",{name:"MuiLinearProgress",slot:"Bar2",overridesResolver:(e,t)=>{const{ownerState:a}=e;return[t.bar,t[`barColor${T(a.color)}`],(a.variant==="indeterminate"||a.variant==="query")&&t.bar2Indeterminate,a.variant==="buffer"&&t.bar2Buffer]}})(({ownerState:e,theme:t})=>S({width:"100%",position:"absolute",left:0,bottom:0,top:0,transition:"transform 0.2s linear",transformOrigin:"left"},e.variant!=="buffer"&&{backgroundColor:e.color==="inherit"?"currentColor":(t.vars||t).palette[e.color].main},e.color==="inherit"&&{opacity:.3},e.variant==="buffer"&&{backgroundColor:fe(t,e.color),transition:`transform .${oe}s linear`}),({ownerState:e})=>(e.variant==="indeterminate"||e.variant==="query")&&ie(je||(je=z`
      width: auto;
      animation: ${0} 2.1s cubic-bezier(0.165, 0.84, 0.44, 1) 1.15s infinite;
    `),Sa)),Aa=m.forwardRef(function(t,a){const r=Q({props:t,name:"MuiLinearProgress"}),{className:n,color:s="primary",value:i,valueBuffer:p,variant:c="indeterminate"}=r,l=Y(r,Ma),d=S({},r,{color:s,variant:c}),u=Ra(d),f=ft(),h={},b={bar1:{},bar2:{}};if((c==="determinate"||c==="buffer")&&i!==void 0){h["aria-valuenow"]=Math.round(i),h["aria-valuemin"]=0,h["aria-valuemax"]=100;let g=i-100;f&&(g=-g),b.bar1.transform=`translateX(${g}%)`}if(c==="buffer"&&p!==void 0){let g=(p||0)-100;f&&(g=-g),b.bar2.transform=`translateX(${g}%)`}return k.jsxs(wa,S({className:L(u.root,n),ownerState:d,role:"progressbar"},h,{ref:a},l,{children:[c==="buffer"?k.jsx(Pa,{className:u.dashed,ownerState:d}):null,k.jsx(Ta,{className:u.bar1,ownerState:d,style:b.bar1}),c==="determinate"?null:k.jsx(Da,{className:u.bar2,ownerState:d,style:b.bar2})]}))}),Ba=Aa;function Ia({condition:e,wrapper:t,falseWrapper:a,children:r}){return e?t(r):a?a(r):r}function ze({value:e,onChange:t,...a}){const[r,n]=m.useState(e);m.useEffect(()=>{n(e)},[e]);const s=()=>t(r);return o(Qt,{value:r,onChange:i=>n(i.target.value),onBlur:s,onKeyDown:i=>i.key==="Enter"&&!a.multiline&&s(),...a})}function Na(e){const{t}=_("ui"),a=te({path:"/:page/*"}),r=t("pageTitle"),n=e??((a==null?void 0:a.params.page)&&t(`tabs.${a==null?void 0:a.params.page}`));m.useEffect(()=>{n?document.title=`${n} - ${r}`:document.title=r},[t,r,n])}function he(e,t){const[a,r]=Ot(),n=m.useMemo(()=>a&&e.get(t),[a,e,t]);return m.useEffect(()=>e.follow(t,r),[e,t,r]),n}function ja(e){const{database:t}=w();return he(t.builds,e??"")}function Ze(e){const t=m.useMemo(()=>e||bt(qe,()=>""),[e]),{database:a}=w(),[r,n]=m.useState(()=>ke(t,s=>a.relics.get(s)));return m.useEffect(()=>{n(ke(t,i=>a.relics.get(i)));const s=Object.values(t).map(i=>a.relics.follow(i,(p,c,l)=>{c==="update"&&n(d=>({...d,[l.slotKey]:l})),c==="remove"&&n(d=>({...d,[l.slotKey]:void 0}))}));return()=>s.forEach(i=>i())},[a,t]),r}function j(e){const{database:t}=w();return he(t.loadouts,e??"")}function Fe(e){const{database:t}=w();return he(t.teams,e)}function za({slot:e}){const{t}=_("relic");return o(I,{sx:{height:"100%"},children:v(B,{children:[v($,{children:[t("slot"),": ",e]}),o($,{children:t("empty")})]})})}function La({build:e}){const t=Ze(e);return o(P,{container:!0,columns:3,spacing:1,children:qe.map(a=>{const r=t[a];return o(P,{item:!0,xs:1,children:r?o(Ft,{relic:r}):o(za,{slot:a})},`${a}_${r==null?void 0:r.id}`)})})}function Oa({charKey:e,setCharKey:t}){const{t:a}=_(["character","charNames_gen"]),{database:r}=w(),n=m.useCallback(p=>!!r.chars.get(p),[r.chars]),s=m.useCallback(p=>r.charMeta.get(p).favorite,[r.charMeta]),i=m.useMemo(()=>[{key:"",label:a("character:autocomplete.none")},...vt.map(p=>({key:p,label:a(`charNames_gen:${p}`),favorite:s(p),color:n(p)?void 0:"secondary"}))],[n,s,a]);return o(m.Suspense,{fallback:o(ce,{variant:"text",width:100}),children:o(Yt,{options:i,toImg:()=>o(le,{children:" "}),valueKey:e,onChange:p=>t(p??"")})})}const qa={RuanMei:Ct};var ge={},Ka=q;Object.defineProperty(ge,"__esModule",{value:!0});var U=ge.default=void 0,Va=Ka(O()),Wa=k,Ga=(0,Va.default)((0,Wa.jsx)("path",{d:"M12 12.75c1.63 0 3.07.39 4.24.9 1.08.48 1.76 1.56 1.76 2.73V18H6v-1.61c0-1.18.68-2.26 1.76-2.73 1.17-.52 2.61-.91 4.24-.91zM4 13c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2zm1.13 1.1c-.37-.06-.74-.1-1.13-.1-.99 0-1.93.21-2.78.58C.48 14.9 0 15.62 0 16.43V18h4.5v-1.61c0-.83.23-1.61.63-2.29zM20 13c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2zm4 3.43c0-.81-.48-1.53-1.22-1.85-.85-.37-1.79-.58-2.78-.58-.39 0-.76.04-1.13.1.4.68.63 1.46.63 2.29V18H24v-1.57zM12 6c1.66 0 3 1.34 3 3s-1.34 3-3 3-3-1.34-3-3 1.34-3 3-3z"}),"Groups");U=ge.default=Ga;function K(){return m.useContext(Ke)}function et({optTarget:e,setOptTarget:t}){const{t:a}=_("optimize"),r=K();return o(me,{title:`${a("optTarget")}${e?`: ${e.tag.name||e.tag.q}`:""}`,children:r==null?void 0:r.listFormulas(de.listing.formulas).map((n,s)=>o(pe,{onClick:()=>t(n),children:n.tag.name||n.tag.q},`${s}_${n.tag.name||n.tag.q}`))})}function Ea({statFilters:e,setStatFilters:t,disabled:a=!1}){const r=m.useCallback((c,l,d)=>{const u={...e},f=JSON.stringify(l),h=l?[...e[f]]:void 0,b=JSON.stringify(c),g=[...e[b]??[]];d!==void 0&&h?g.push(h[d]):g.push({minValue:0,maxValue:0,disabled:!1}),u[b]=g,d!==void 0&&h&&(h.splice(d,1),h.length?u[f]=h:delete u[f]),t({...u})},[t,e]),n=m.useCallback((c,l)=>{const d={...e},u=JSON.stringify(c),f=[...e[u]];f.splice(l,1),f.length?d[u]=f:delete d[u],t({...d})},[t,e]),s=m.useCallback((c,l,d)=>{const u={...e},f=JSON.stringify(c),h=[...e[f]];h[l]={...h[l],minValue:d},u[f]=h,t({...u})},[t,e]),i=m.useCallback((c,l,d)=>{const u={...e},f=JSON.stringify(c),h=[...e[f]];h[l]={...h[l],maxValue:d},u[f]=h,t({...u})},[t,e]),p=m.useCallback((c,l,d)=>{const u={...e},f=JSON.stringify(c),h=[...e[f]];h[l]={...h[l],disabled:d},u[f]=h,t({...u})},[t,e]);return v(le,{children:[Object.entries(e).flatMap(([c,l])=>l==null?void 0:l.map((d,u)=>o(Le,{path:JSON.parse(c),setting:d,index:u,setTarget:r,delTarget:n,setMinValue:s,setMaxValue:i,setDisabled:p,disabled:a},c+u))),o(Le,{delTarget:n,setTarget:r,setMinValue:s,setMaxValue:i,setDisabled:p,disabled:a})]})}function Le({path:e,setting:t,index:a,delTarget:r,setMinValue:n,setMaxValue:s,setDisabled:i,disabled:p}){const{t:c}=_("page_character_optimize"),l=m.useCallback(b=>e&&a!==void 0&&n(e,a,b??0),[n,e,a]),d=m.useCallback(b=>e&&a!==void 0&&s(e,a,b??1/0),[s,e,a]),[u,f]=m.useState(void 0),h={p:1,flexBasis:30,flexGrow:0,flexShrink:0};return v(kt,{sx:{"& .MuiButtonGroup-grouped":{minWidth:24},width:"100%"},children:[!!t&&!!e&&a!==void 0&&o(H,{sx:h,color:t.disabled?"secondary":"success",onClick:()=>i(e,a,!t.disabled),disabled:p,children:t.disabled?o(xt,{}):o(yt,{})}),o($e,{sx:{flexBasis:150,flexGrow:1},children:o(Me,{float:!0,disabled:!e||p,value:t==null?void 0:t.minValue,placeholder:c("buildConstraint.minStatValue"),onChange:l,sx:{px:1},inputProps:{sx:{"& + .MuiOutlinedInput-notchedOutline":{borderRadius:0},textAlign:"right"}}})}),o(et,{optTarget:u,setOptTarget:f}),o($e,{sx:{flexBasis:150,flexGrow:1},children:o(Me,{float:!0,disabled:!e||p,value:t==null?void 0:t.maxValue,placeholder:c("buildConstraint.maxStatValue"),onChange:d,sx:{px:1},inputProps:{sx:{"& + .MuiOutlinedInput-notchedOutline":{borderRadius:0},textAlign:"left"}}})}),!!e&&a!==void 0&&o(H,{sx:h,color:"error",onClick:()=>r(e,a),disabled:p,children:o(ea,{fontSize:"small"})})]})}function Ua({disabled:e=!1}){const{t}=_("page_character_optimize"),[a,r]=m.useState({});return o(M,{children:v(I,{bgt:"light",children:[o(B,{sx:{display:"flex",gap:1,justifyContent:"space-between",flexDirection:"column"},children:v(M,{display:"flex",justifyContent:"space-between",children:[o($,{sx:{fontWeight:"bold"},children:t`constraintFilter.title`}),o(ta,{title:o($,{children:t`constraintFilter.tooltip`})})]})}),o(ae,{}),o(M,{display:"flex",flexDirection:"column",gap:.5,children:o(Ea,{statFilters:a,setStatFilters:r,disabled:e})})]})})}function Ha({numWorkers:e,setNumWorkers:t}){const{t:a}=_("optimize"),r=navigator.hardwareConcurrency||8;return o(me,{title:`${a("numWorkers")}: ${e}`,children:Ve(1,r).map(n=>o(pe,{onClick:()=>t(n),children:a("workers",{count:n})},n))})}function Ja({teamId:e,src:t,children:a}){var g,C,y,R;const r=Fe(e),n=j((g=r.loadoutMetadata[0])==null?void 0:g.loadoutId),s=j((C=r.loadoutMetadata[1])==null?void 0:C.loadoutId),i=j((y=r.loadoutMetadata[2])==null?void 0:y.loadoutId),p=j((R=r.loadoutMetadata[3])==null?void 0:R.loadoutId),c=m.useMemo(()=>{const x={all:"all"};return n&&(x[n.key]="0"),s&&(x[s.key]="1"),i&&(x[i.key]="2"),p&&(x[p.key]="3"),x},[n,s,i,p]),l=G(r.loadoutMetadata[0],c),d=G(r.loadoutMetadata[1],c),u=G(r.loadoutMetadata[2],c),f=G(r.loadoutMetadata[3],c),h=m.useMemo(()=>Kt([...Vt(r.loadoutMetadata.map((x,A)=>x===void 0?void 0:We[A]).filter(x=>!!x)),...l?E(0,l):[],...d?E(1,d):[],...u?E(2,u):[],...f?E(3,f):[],V.common.lvl.add(80),V.common.res.add(.1),V.common.isBroken.add(0),V.common.maxToughness.add(100),Mt.common.critMode.add("avg")]),[l,d,u,f,r.loadoutMetadata]),b=m.useMemo(()=>(h==null?void 0:h.withTag({src:t}))??null,[h,t]);return o(Ke.Provider,{value:b,children:a})}function G(e,t){const a=j(e==null?void 0:e.loadoutId),r=Je(a==null?void 0:a.key),n=ja(e==null?void 0:e.buildId),s=Xt(n==null?void 0:n.lightConeId),i=Ze(n==null?void 0:n.relicIds),p=m.useMemo(()=>Object.fromEntries(Object.entries((a==null?void 0:a.conditional)??{}).map(([c,l])=>[t[c],l])),[a,t]);return m.useMemo(()=>({character:r,lightCone:s,relics:i,conditionals:p}),[r,s,p,i])}function E(e,{character:t,lightCone:a,relics:r,conditionals:n}){return t?[...Wt(`${e}`,...Gt(t),...Et(a),...Ut(Object.values(r).filter(s=>!!s).map(s=>({set:s.setKey,stats:[...s.substats.filter(({key:i})=>i!=="").map(i=>({key:i.key,value:i.accurateValue})),{key:s.mainStatKey,value:s.mainStatVal}]})))),...Ht(`${e}`,n)]:[]}var be={},Xa=q;Object.defineProperty(be,"__esModule",{value:!0});var tt=be.default=void 0,Qa=Xa(O()),Ya=k,Za=(0,Qa.default)((0,Ya.jsx)("path",{d:"M22 24H2v-4h20v4zM13.06 5.19l3.75 3.75L7.75 18H4v-3.75l9.06-9.06zm4.82 2.68-3.75-3.75 1.83-1.83c.39-.39 1.02-.39 1.41 0l2.34 2.34c.39.39.39 1.02 0 1.41l-1.83 1.83z"}),"BorderColor");tt=be.default=Za;var ve={},Fa=q;Object.defineProperty(ve,"__esModule",{value:!0});var at=ve.default=void 0,er=Fa(O()),tr=k,ar=(0,er.default)((0,tr.jsx)("path",{d:"M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"}),"Person");at=ve.default=ar;function rr({teamId:e,charKey:t,tab:a=""}){const{t:r}=_("page_team"),n=Ge(),{database:s}=w(),i=s.teams.get(e),{loadoutMetadata:p}=i,c=Ee(),l=Ue(c.breakpoints.down("md")),[d,u]=m.useState(!1),f=b=>{s.teams.set(e,{name:b})},h=b=>{s.teams.set(e,{description:b})};return v(M,{sx:()=>({borderBottom:"1px rgb(200,200,200,0.3) solid","& .MuiTab-root:hover":{transition:"background-color 0.25s ease",backgroundColor:"rgba(255,255,255,0.1)"},"& .Mui-selected":{color:"white !important"},"& .MuiTabs-indicator":{height:"4px",backgroundColor:"rgb(200,200,200,0.5)"}}),children:[o(Qe,{onClick:()=>u(!0),children:o($t,{placement:"top",title:v(M,{children:[v(M,{sx:{display:"flex",color:"info.light",gap:1},children:[o(tt,{}),o($,{children:o("strong",{children:r`team.editNameDesc`})})]}),!!i.description&&o($,{children:i.description})]}),children:o(B,{sx:{display:"flex",justifyContent:"center","&:hover":{color:"info.light"}},children:v($,{variant:"h5",sx:{display:"flex",gap:1,alignItems:"center",justifyContent:"center",textShadow:"#000 0 0 10px !important"},children:[o(U,{}),i.name]})})})}),o(_t,{open:d,onClose:()=>u(!1),children:v(I,{children:[o(qt,{title:r`team.editNameDesc`,avatar:o(U,{}),titleTypographyProps:{variant:"h6"},action:o(St,{onClick:()=>u(!1),children:o(Xe,{})})}),o(ae,{}),o(B,{children:v(M,{display:"flex",flexDirection:"column",gap:2,sx:{mt:2},children:[o(ze,{label:r`team.name`,value:i.name,onChange:b=>f(b),autoFocus:!0}),o(ze,{label:r`team.desc`,value:i.description,onChange:b=>h(b),multiline:!0,minRows:4})]})})]})}),o(ae,{}),v(Rt,{variant:"fullWidth",value:t??"team",orientation:l?"vertical":"horizontal",children:[o(Se,{icon:o(U,{}),iconPosition:"start",value:"team",label:"Team Settings",onClick:()=>n(`/teams/${e}/`)}),p.map((b,g)=>{var y;const C=b&&((y=s.loadouts.get(b==null?void 0:b.loadoutId))==null?void 0:y.key);return o(Se,{icon:o(at,{}),iconPosition:"start",value:C??g,disabled:!p[g],label:C?o($,{children:r(`charNames_gen:${C}`)}):`Character ${g+1}`,onClick:()=>C&&n(`/teams/${e}/${C}/${a}`)},g)})]})]})}function or({teamId:e}){const{database:t}=w(),a=t.teams.get(e);return v(M,{children:[e,a.loadoutMetadata.map((r,n)=>o(nr,{loadoutMetadataIndex:n,teamId:e},`${n}_${r==null?void 0:r.loadoutId}`))]})}function nr({loadoutMetadataIndex:e,teamId:t}){var p;const{database:a}=w(),r=a.teams.get(t),n=(p=r.loadoutMetadata[e])==null?void 0:p.loadoutId,s=a.loadouts.get(n);function i(c){if(c===""){a.teams.set(t,d=>d.loadoutMetadata[e]=void 0);return}a.chars.getOrCreate(c);const l=r.loadoutMetadata.findIndex(d=>{var u;return d&&((u=a.loadouts.get(d.loadoutId))==null?void 0:u.key)===c});if(l===-1){let d=a.loadouts.keys.find(u=>a.loadouts.get(u).key===c);d||(d=a.loadouts.new(c)),a.teams.set(t,u=>{u.loadoutMetadata[e]={loadoutId:d}})}else{if(l===e)return;const d=r.loadoutMetadata[l],u=r.loadoutMetadata[e];a.teams.set(t,f=>{f.loadoutMetadata[e]=d,f.loadoutMetadata[l]=u})}}return o(Oa,{charKey:(s==null?void 0:s.key)??"",setCharKey:i})}var Ce={},sr=q;Object.defineProperty(Ce,"__esModule",{value:!0});var ne=Ce.default=void 0,ir=sr(O()),cr=k,lr=(0,ir.default)((0,cr.jsx)("path",{d:"M16.59 8.59 12 13.17 7.41 8.59 6 10l6 6 6-6z"}),"ExpandMore");ne=Ce.default=lr;const dr=5e4;class ur{constructor(t,a,r,n,s){this.calc=t,this.optTarget=a,this.relicsBySlot=r,this.numWorkers=n,this.setProgress=s,this.worker=new Worker(new URL(""+new URL("parentWorker-CAAYnoOP.js",import.meta.url).href,import.meta.url),{type:"module"})}async optimize(){return await new Promise((a,r)=>{this.worker.onmessage=({data:s})=>{switch(s.resultType){case"progress":this.setProgress(s.progress);break;case"done":a(s.buildResults);break;case"err":console.log(s),r();break}};const n={command:"start",relicsBySlot:this.relicsBySlot,detachedNodes:this.detachNodes(),numWorkers:this.numWorkers};this.worker.postMessage(n)})}async terminate(){const t={command:"terminate"};this.worker.postMessage(t),await new Promise((a,r)=>{this.worker.onmessage=({data:n})=>{switch(n.resultType){case"terminated":a();break;case"err":console.log(n),r();break}}}),this.worker.terminate()}detachNodes(){const t=new Set(wt);return Jt([this.optTarget],this.calc,r=>{if(r.src==="0"&&r.et==="own"){if(r.sheet==="dyn"&&r.qt==="premod")return{q:r.q};if(r.q==="count"&&t.has(r.sheet))return{q:r.sheet}}})}}var xe={},pr=q;Object.defineProperty(xe,"__esModule",{value:!0});var rt=xe.default=void 0,mr=pr(O()),fr=k,hr=(0,mr.default)((0,fr.jsx)("path",{d:"m16 6 2.29 2.29-4.88 4.88-4-4L2 16.59 3.41 18l6-6 4 4 6.3-6.29L22 12V6z"}),"TrendingUp");rt=xe.default=hr;function gr(){const{t:e}=_("optimize"),{database:t}=w(),a=K(),[r,n]=m.useState(8),[s,i]=m.useState(void 0),[p,c]=m.useState(void 0),l=m.useMemo(()=>t.relics.values.reduce((R,x)=>(R[x.slotKey].push(x),R),{head:[],hands:[],feet:[],body:[],sphere:[],rope:[]}),[t.relics.values]),d=Object.values(l).reduce((R,x)=>R*x.length,1),[u,f]=m.useState(void 0),[h,b]=m.useState(!1),g=m.useRef(()=>{});m.useEffect(()=>()=>g.current(),[]);const C=m.useCallback(async()=>{if(!p||!a)return;const R=new Promise(F=>g.current=F);i(void 0),b(!0);const x=new ur(a,p,l,r,i);R.then(async()=>await x.terminate());const A=await x.optimize();await x.terminate(),g.current=()=>{},b(!1),f(A[0])},[a,r,p,l]),y=m.useCallback(()=>{g.current(),b(!1)},[g]);return o(I,{bgt:"dark",children:v(B,{children:[o(Ua,{}),v(re,{children:[o($,{variant:"h5",children:e("optimize")}),v(M,{children:[o(et,{optTarget:p,setOptTarget:c}),o(Ha,{numWorkers:r,setNumWorkers:n}),o(H,{onClick:h?y:C,color:h?"error":"primary",startIcon:h?o(Xe,{}):o(rt,{}),children:e(h?"cancel":"optimize")})]}),s&&o(br,{progress:s,totalPermutations:d}),u&&v(M,{children:[v($,{children:["Best: ",u.value]}),o(La,{build:u.ids})]})]})]})})}function br({progress:e,totalPermutations:t}){const{t:a}=_("optimize");return v(M,{children:[v($,{children:[a("totalProgress"),": ",e.numBuildsComputed.toLocaleString()," /"," ",t.toLocaleString()]}),v($,{children:[a("buildsKept"),": ",e.numBuildsKept.toLocaleString()," /"," ",dr.toLocaleString()]}),o(Ba,{variant:"determinate",value:e.numBuildsComputed/t*100})]})}const vr={xs:12,sm:6,md:4};function Cr(){const{loadout:{key:e}}=ue(),t=K(),{t:a}=_("sheet_gen"),r=[["basic",a("talents.basic")],["skill",a("talents.skill")],["ultimate",a("talents.ultimate")]],n=Ee(),s=Ue(n.breakpoints.up("lg")),i=qa[e];if(!(!i||!t))return o(le,{children:v(P,{container:!0,spacing:1,children:[s&&o(P,{item:!0,xs:12,md:12,lg:3,sx:{display:"flex",flexDirection:"column",gap:1},children:o(Oe,{})}),o(P,{item:!0,xs:12,md:12,lg:9,container:!0,spacing:1,children:r.map(([p,c])=>{const l=i[p];return l?o(P,{item:!0,...vr,children:o(xr,{talentKey:p,subtitle:c,sheetElement:l})},p):null})}),!s&&o(P,{item:!0,xs:12,md:12,lg:3,container:!0,spacing:1,children:o(P,{item:!0,xs:12,children:o(Oe,{})})})]})})}function xr({sheetElement:e,subtitle:t,onClickTitle:a}){const r=m.useCallback(c=>o(Qe,{onClick:a,children:c}),[a]);let n=null;n=null;const{loadoutId:s}=m.useContext(He),{database:i}=w(),p=m.useCallback((c,l,d,u)=>{i.loadouts.set(s,f=>(f=structuredClone(f),Pt(f.conditional,[c,l,d],u),f))},[i,s]);return v(I,{bgt:"light",sx:{height:"100%"},children:[n,v(B,{children:[o(Ia,{condition:!!a,wrapper:r,children:v(P,{container:!0,sx:{flexWrap:"nowrap"},children:[o(P,{item:!0,children:o(M,{component:_e?_e:"img",src:e==null?void 0:e.img,sx:{width:60,height:"auto"}})}),v(P,{item:!0,flexGrow:1,sx:{pl:1},children:[o($,{variant:"h6",children:e==null?void 0:e.name}),o($,{variant:"subtitle1",children:t})]})]})}),e.documents.map((c,l)=>o(Tt,{document:c,collapse:!0,setConditional:p},l))]})]})}function Oe(){const{t:e}=_("sheet_gen"),t=K();if(!t)return null;const a=t.compute(de.char.eidolon).val;return o(me,{fullWidth:!0,title:e("constellationLvl",{level:a}),color:"primary",children:Ve(0,Dt).map(r=>o(pe,{selected:a===r,disabled:a===r,onClick:()=>{},children:e("constellationLvl",{level:r})},r))})}function yr({tab:e}){const{loadout:{key:t}}=ue(),{character:a}=At(),r=K(),[n,s]=m.useState(void 0);return v(M,{children:[e,o(zt,{characterKey:n,onClose:()=>s(void 0)}),o(Lt,{character:a}),v(re,{gap:1,pt:1,children:[o(I,{bgt:"dark",children:v(B,{children:[o(H,{disabled:!t,onClick:()=>t&&s(t),children:"Edit Character"}),v(we,{children:[o(Te,{expandIcon:o(ne,{}),children:"All target values, if sheet is created"}),o(Pe,{children:o(re,{children:r==null?void 0:r.listFormulas(de.listing.formulas).map((i,p)=>{const c=r.compute(i),l=i.tag.name||i.tag.q;return v(M,{children:[v($,{children:[l,": ",c.val]}),v(we,{children:[v(Te,{expandIcon:o(ne,{}),children:["debug for ",l]}),o(Pe,{children:o($,{component:"pre",children:JSON.stringify(r.toDebug().compute(i),void 0,2)})})]})]},`${l}${p}`)})})})]})]})}),o(Cr,{}),o(gr,{})]})]})}const kr=o(ce,{variant:"rectangular",width:"100%",height:1e3});function Nr(){const{database:e}=w(),{teamId:t}=Bt(),a=!t||!e.teams.keys.includes(t);return m.useEffect(()=>{a||e.teams.set(t,{lastEdit:Date.now()})},[t,e.teams,a]),a?o(Nt,{to:"/teams"}):o(M,{display:"flex",flexDirection:"column",gap:1,children:o(m.Suspense,{fallback:kr,children:t&&o(Mr,{teamId:t})})})}function Mr({teamId:e}){var b;const{database:t}=w(),a=Ge(),r=Fe(e),{loadoutMetadata:n}=r,{params:{characterKey:s}}=te({path:"/teams/:teamId/:characterKey",end:!1})??{params:{}},{params:{tab:i}}=te({path:"/teams/:teamId/:characterKey/:tab"})??{params:{}},p=m.useMemo(()=>n.findIndex(g=>{var C;return(g==null?void 0:g.loadoutId)&&((C=t.loadouts.get(g.loadoutId))==null?void 0:C.key)===s}),[n,t.loadouts,s]),c=m.useMemo(()=>n[p],[n,p]);m.useEffect(()=>{window.scrollTo({top:0})},[]),m.useEffect(()=>{c||a("",{replace:!0})},[c,a]);const l=c==null?void 0:c.loadoutId,d=(b=t.loadouts.get(l))==null?void 0:b.key,{t:u}=_(["charNames_gen","page_character"]);Na(m.useMemo(()=>{const g=u(d?"charNames_gen:Character":"Team Settings"),C=i?u(`page_character:tabs.${i}`):d?u("Loadout/Build"):i;return`${r.name} - ${g}${C?` - ${C}`:""}`},[d,u,i,r.name]));const f=j(l??""),h=m.useMemo(()=>{if(!(!l||!f||!c))return{teamId:e,team:r,loadoutId:l,loadout:f,loadoutMetadatum:c}},[c,r,f,l,e]);return o(Ja,{teamId:e,src:We[p],children:v(M,{sx:{display:"flex",gap:1,flexDirection:"column",mx:1,mt:2},children:[o(I,{children:o(rr,{teamId:e,charKey:d,tab:i})}),o(M,{children:h?o(He.Provider,{value:h,children:o($r,{})}):o(or,{teamId:e})})]})})}function $r({tab:e}){const{loadout:{key:t}}=ue(),a=Je(t),r=m.useMemo(()=>a&&{character:a},[a]);return r?o(It.Provider,{value:r,children:o(jt,{children:o(Re,{path:":characterKey",children:o(Re,{path:"*",index:!0,element:o(yr,{tab:e})})})})}):o(ce,{variant:"rectangular",width:"100%",height:1e3})}export{Nr as default};
