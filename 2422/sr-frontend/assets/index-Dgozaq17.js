import{a as ee,g as te,s as _,_ as k,r as l,u as oe,aq as _t,ar as It,e as ae,a7 as ke,as as Pt,m as At,j as w,f as U,h as re,at as je,P as Bt,i as Nt,au as zt,av as $e,b as E,aw as Se,x as Et,l as jt,d as Lt,J as g,C as r,Y as M,V as S,B as T,ax as ve,a3 as P,ay as Ot,ac as at,az as Le,aa as O,a0 as j,X as I,aA as Wt,ad as we,F as me,aB as Kt,aC as rt,aD as fe,aE as qt,aF as pe,aG as Vt,ab as Z,ag as Me,aH as Gt,aI as Ut,Q as Oe,O as We,K as Ht,aJ as nt,aK as st,aL as le,aM as Jt,z as Re,A as Te,ap as it,a8 as lt,aN as Ft,aO as be,I as Xt,a9 as Qt,aP as Yt,aQ as Ke,aR as Zt,E as eo,aS as De,aT as qe,aU as to,aV as oo,aW as ao,aX as ro,aY as no,aZ as so,a_ as io,a$ as Ve}from"./index-Bv9vWr84.js";import{d as lo,b as co,u as ct,S as xe,C as uo,a as po}from"./CharacterEditor-CZRciNjG.js";import{u as mo,C as fo}from"./useForceUpdate-6xbgvJkI.js";import{s as ho,t as go,w as bo,c as vo,l as xo,r as Co,a as yo,d as ko}from"./index-B7DLhLkg.js";import{u as $o}from"./useLightCone-9WteZlQI.js";import{T as So,d as wo,M as _e,D as Ie}from"./DropdownButton-CanZHvrh.js";import{G as Mo,d as dt}from"./LocationAutocomplete-jpjARrTR.js";import{C as ut}from"./CardActionArea-hk0bPu8p.js";import{u as Ro,R as To,D as Do}from"./RelicCard-DWCosNRo.js";import{I as _o}from"./InfoTooltip-CAb5oqiU.js";function Io(e){return ee("MuiCollapse",e)}te("MuiCollapse",["root","horizontal","vertical","entered","hidden","wrapper","wrapperInner"]);const Po=["addEndListener","children","className","collapsedSize","component","easing","in","onEnter","onEntered","onEntering","onExit","onExited","onExiting","orientation","style","timeout","TransitionComponent"],Ao=e=>{const{orientation:t,classes:o}=e,a={root:["root",`${t}`],entered:["entered"],hidden:["hidden"],wrapper:["wrapper",`${t}`],wrapperInner:["wrapperInner",`${t}`]};return re(a,Io,o)},Bo=_("div",{name:"MuiCollapse",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:o}=e;return[t.root,t[o.orientation],o.state==="entered"&&t.entered,o.state==="exited"&&!o.in&&o.collapsedSize==="0px"&&t.hidden]}})(({theme:e,ownerState:t})=>k({height:0,overflow:"hidden",transition:e.transitions.create("height")},t.orientation==="horizontal"&&{height:"auto",width:0,transition:e.transitions.create("width")},t.state==="entered"&&k({height:"auto",overflow:"visible"},t.orientation==="horizontal"&&{width:"auto"}),t.state==="exited"&&!t.in&&t.collapsedSize==="0px"&&{visibility:"hidden"})),No=_("div",{name:"MuiCollapse",slot:"Wrapper",overridesResolver:(e,t)=>t.wrapper})(({ownerState:e})=>k({display:"flex",width:"100%"},e.orientation==="horizontal"&&{width:"auto",height:"100%"})),zo=_("div",{name:"MuiCollapse",slot:"WrapperInner",overridesResolver:(e,t)=>t.wrapperInner})(({ownerState:e})=>k({width:"100%"},e.orientation==="horizontal"&&{width:"auto",height:"100%"})),pt=l.forwardRef(function(t,o){const a=oe({props:t,name:"MuiCollapse"}),{addEndListener:n,children:s,className:i,collapsedSize:d="0px",component:c,easing:u,in:p,onEnter:m,onEntered:h,onEntering:f,onExit:v,onExited:b,onExiting:y,orientation:$="vertical",style:R,timeout:C=_t.standard,TransitionComponent:A=It}=a,J=ae(a,Po),W=k({},a,{orientation:$,collapsedSize:d}),B=Ao(W),F=ke(),he=Pt(),N=l.useRef(null),X=l.useRef(),K=typeof d=="number"?`${d}px`:d,L=$==="horizontal",Q=L?"width":"height",se=l.useRef(null),kt=At(o,se),q=x=>D=>{if(x){const z=se.current;D===void 0?x(z):x(z,D)}},ge=()=>N.current?N.current[L?"clientWidth":"clientHeight"]:0,$t=q((x,D)=>{N.current&&L&&(N.current.style.position="absolute"),x.style[Q]=K,m&&m(x,D)}),St=q((x,D)=>{const z=ge();N.current&&L&&(N.current.style.position="");const{duration:Y,easing:ie}=je({style:R,timeout:C,easing:u},{mode:"enter"});if(C==="auto"){const Ee=F.transitions.getAutoHeightDuration(z);x.style.transitionDuration=`${Ee}ms`,X.current=Ee}else x.style.transitionDuration=typeof Y=="string"?Y:`${Y}ms`;x.style[Q]=`${z}px`,x.style.transitionTimingFunction=ie,f&&f(x,D)}),wt=q((x,D)=>{x.style[Q]="auto",h&&h(x,D)}),Mt=q(x=>{x.style[Q]=`${ge()}px`,v&&v(x)}),Rt=q(b),Tt=q(x=>{const D=ge(),{duration:z,easing:Y}=je({style:R,timeout:C,easing:u},{mode:"exit"});if(C==="auto"){const ie=F.transitions.getAutoHeightDuration(D);x.style.transitionDuration=`${ie}ms`,X.current=ie}else x.style.transitionDuration=typeof z=="string"?z:`${z}ms`;x.style[Q]=K,x.style.transitionTimingFunction=Y,y&&y(x)}),Dt=x=>{C==="auto"&&he.start(X.current||0,x),n&&n(se.current,x)};return w.jsx(A,k({in:p,onEnter:$t,onEntered:wt,onEntering:St,onExit:Mt,onExited:Rt,onExiting:Tt,addEndListener:Dt,nodeRef:se,timeout:C==="auto"?null:C},J,{children:(x,D)=>w.jsx(Bo,k({as:c,className:U(B.root,i,{entered:B.entered,exited:!p&&K==="0px"&&B.hidden}[x]),style:k({[L?"minWidth":"minHeight"]:K},R),ref:kt},D,{ownerState:k({},W,{state:x}),children:w.jsx(No,{ownerState:k({},W,{state:x}),className:B.wrapper,ref:N,children:w.jsx(zo,{ownerState:k({},W,{state:x}),className:B.wrapperInner,children:s})})}))}))});pt.muiSupportAuto=!0;const mt=pt,Eo=l.createContext({}),ft=Eo;function jo(e){return ee("MuiAccordion",e)}const Lo=te("MuiAccordion",["root","rounded","expanded","disabled","gutters","region"]),ce=Lo,Oo=["children","className","defaultExpanded","disabled","disableGutters","expanded","onChange","square","slots","slotProps","TransitionComponent","TransitionProps"],Wo=e=>{const{classes:t,square:o,expanded:a,disabled:n,disableGutters:s}=e;return re({root:["root",!o&&"rounded",a&&"expanded",n&&"disabled",!s&&"gutters"],region:["region"]},jo,t)},Ko=_(Bt,{name:"MuiAccordion",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:o}=e;return[{[`& .${ce.region}`]:t.region},t.root,!o.square&&t.rounded,!o.disableGutters&&t.gutters]}})(({theme:e})=>{const t={duration:e.transitions.duration.shortest};return{position:"relative",transition:e.transitions.create(["margin"],t),overflowAnchor:"none","&::before":{position:"absolute",left:0,top:-1,right:0,height:1,content:'""',opacity:1,backgroundColor:(e.vars||e).palette.divider,transition:e.transitions.create(["opacity","background-color"],t)},"&:first-of-type":{"&::before":{display:"none"}},[`&.${ce.expanded}`]:{"&::before":{opacity:0},"&:first-of-type":{marginTop:0},"&:last-of-type":{marginBottom:0},"& + &":{"&::before":{display:"none"}}},[`&.${ce.disabled}`]:{backgroundColor:(e.vars||e).palette.action.disabledBackground}}},({theme:e})=>({variants:[{props:t=>!t.square,style:{borderRadius:0,"&:first-of-type":{borderTopLeftRadius:(e.vars||e).shape.borderRadius,borderTopRightRadius:(e.vars||e).shape.borderRadius},"&:last-of-type":{borderBottomLeftRadius:(e.vars||e).shape.borderRadius,borderBottomRightRadius:(e.vars||e).shape.borderRadius,"@supports (-ms-ime-align: auto)":{borderBottomLeftRadius:0,borderBottomRightRadius:0}}}},{props:t=>!t.disableGutters,style:{[`&.${ce.expanded}`]:{margin:"16px 0"}}}]})),qo=l.forwardRef(function(t,o){const a=oe({props:t,name:"MuiAccordion"}),{children:n,className:s,defaultExpanded:i=!1,disabled:d=!1,disableGutters:c=!1,expanded:u,onChange:p,square:m=!1,slots:h={},slotProps:f={},TransitionComponent:v,TransitionProps:b}=a,y=ae(a,Oo),[$,R]=Nt({controlled:u,default:i,name:"Accordion",state:"expanded"}),C=l.useCallback(L=>{R(!$),p&&p(L,!$)},[$,p,R]),[A,...J]=l.Children.toArray(n),W=l.useMemo(()=>({expanded:$,disabled:d,disableGutters:c,toggle:C}),[$,d,c,C]),B=k({},a,{square:m,disabled:d,disableGutters:c,expanded:$}),F=Wo(B),he=k({transition:v},h),N=k({transition:b},f),[X,K]=Ro("transition",{elementType:mt,externalForwardedProps:{slots:he,slotProps:N},ownerState:B});return w.jsxs(Ko,k({className:U(F.root,s),ref:o,ownerState:B,square:m},y,{children:[w.jsx(ft.Provider,{value:W,children:A}),w.jsx(X,k({in:$,timeout:"auto"},K,{children:w.jsx("div",{"aria-labelledby":A.props.id,id:A.props["aria-controls"],role:"region",className:F.region,children:J})}))]}))}),Ge=qo;function Vo(e){return ee("MuiAccordionDetails",e)}te("MuiAccordionDetails",["root"]);const Go=["className"],Uo=e=>{const{classes:t}=e;return re({root:["root"]},Vo,t)},Ho=_("div",{name:"MuiAccordionDetails",slot:"Root",overridesResolver:(e,t)=>t.root})(({theme:e})=>({padding:e.spacing(1,2,2)})),Jo=l.forwardRef(function(t,o){const a=oe({props:t,name:"MuiAccordionDetails"}),{className:n}=a,s=ae(a,Go),i=a,d=Uo(i);return w.jsx(Ho,k({className:U(d.root,n),ref:o,ownerState:i},s))}),Ue=Jo;function Fo(e){return ee("MuiAccordionSummary",e)}const Xo=te("MuiAccordionSummary",["root","expanded","focusVisible","disabled","gutters","contentGutters","content","expandIconWrapper"]),V=Xo,Qo=["children","className","expandIcon","focusVisibleClassName","onClick"],Yo=e=>{const{classes:t,expanded:o,disabled:a,disableGutters:n}=e;return re({root:["root",o&&"expanded",a&&"disabled",!n&&"gutters"],focusVisible:["focusVisible"],content:["content",o&&"expanded",!n&&"contentGutters"],expandIconWrapper:["expandIconWrapper",o&&"expanded"]},Fo,t)},Zo=_(zt,{name:"MuiAccordionSummary",slot:"Root",overridesResolver:(e,t)=>t.root})(({theme:e})=>{const t={duration:e.transitions.duration.shortest};return{display:"flex",minHeight:48,padding:e.spacing(0,2),transition:e.transitions.create(["min-height","background-color"],t),[`&.${V.focusVisible}`]:{backgroundColor:(e.vars||e).palette.action.focus},[`&.${V.disabled}`]:{opacity:(e.vars||e).palette.action.disabledOpacity},[`&:hover:not(.${V.disabled})`]:{cursor:"pointer"},variants:[{props:o=>!o.disableGutters,style:{[`&.${V.expanded}`]:{minHeight:64}}}]}}),ea=_("div",{name:"MuiAccordionSummary",slot:"Content",overridesResolver:(e,t)=>t.content})(({theme:e})=>({display:"flex",flexGrow:1,margin:"12px 0",variants:[{props:t=>!t.disableGutters,style:{transition:e.transitions.create(["margin"],{duration:e.transitions.duration.shortest}),[`&.${V.expanded}`]:{margin:"20px 0"}}}]})),ta=_("div",{name:"MuiAccordionSummary",slot:"ExpandIconWrapper",overridesResolver:(e,t)=>t.expandIconWrapper})(({theme:e})=>({display:"flex",color:(e.vars||e).palette.action.active,transform:"rotate(0deg)",transition:e.transitions.create("transform",{duration:e.transitions.duration.shortest}),[`&.${V.expanded}`]:{transform:"rotate(180deg)"}})),oa=l.forwardRef(function(t,o){const a=oe({props:t,name:"MuiAccordionSummary"}),{children:n,className:s,expandIcon:i,focusVisibleClassName:d,onClick:c}=a,u=ae(a,Qo),{disabled:p=!1,disableGutters:m,expanded:h,toggle:f}=l.useContext(ft),v=$=>{f&&f($),c&&c($)},b=k({},a,{expanded:h,disabled:p,disableGutters:m}),y=Yo(b);return w.jsxs(Zo,k({focusRipple:!1,disableRipple:!0,disabled:p,component:"div","aria-expanded":h,className:U(y.root,s),focusVisibleClassName:U(y.focusVisible,d),onClick:v,ref:o,ownerState:b},u,{children:[w.jsx(ea,{className:y.content,ownerState:b,children:n}),i&&w.jsx(ta,{className:y.expandIconWrapper,ownerState:b,children:i})]}))}),He=oa;function aa(e){return ee("MuiLinearProgress",e)}te("MuiLinearProgress",["root","colorPrimary","colorSecondary","determinate","indeterminate","buffer","query","dashed","dashedColorPrimary","dashedColorSecondary","bar","barColorPrimary","barColorSecondary","bar1Indeterminate","bar1Determinate","bar1Buffer","bar2Indeterminate","bar2Buffer"]);const ra=["className","color","value","valueBuffer","variant"];let H=e=>e,Je,Fe,Xe,Qe,Ye,Ze;const Ce=4,na=$e(Je||(Je=H`
  0% {
    left: -35%;
    right: 100%;
  }

  60% {
    left: 100%;
    right: -90%;
  }

  100% {
    left: 100%;
    right: -90%;
  }
`)),sa=$e(Fe||(Fe=H`
  0% {
    left: -200%;
    right: 100%;
  }

  60% {
    left: 107%;
    right: -8%;
  }

  100% {
    left: 107%;
    right: -8%;
  }
`)),ia=$e(Xe||(Xe=H`
  0% {
    opacity: 1;
    background-position: 0 -23px;
  }

  60% {
    opacity: 0;
    background-position: 0 -23px;
  }

  100% {
    opacity: 1;
    background-position: -200px -23px;
  }
`)),la=e=>{const{classes:t,variant:o,color:a}=e,n={root:["root",`color${E(a)}`,o],dashed:["dashed",`dashedColor${E(a)}`],bar1:["bar",`barColor${E(a)}`,(o==="indeterminate"||o==="query")&&"bar1Indeterminate",o==="determinate"&&"bar1Determinate",o==="buffer"&&"bar1Buffer"],bar2:["bar",o!=="buffer"&&`barColor${E(a)}`,o==="buffer"&&`color${E(a)}`,(o==="indeterminate"||o==="query")&&"bar2Indeterminate",o==="buffer"&&"bar2Buffer"]};return re(n,aa,t)},Pe=(e,t)=>t==="inherit"?"currentColor":e.vars?e.vars.palette.LinearProgress[`${t}Bg`]:e.palette.mode==="light"?jt(e.palette[t].main,.62):Lt(e.palette[t].main,.5),ca=_("span",{name:"MuiLinearProgress",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:o}=e;return[t.root,t[`color${E(o.color)}`],t[o.variant]]}})(({ownerState:e,theme:t})=>k({position:"relative",overflow:"hidden",display:"block",height:4,zIndex:0,"@media print":{colorAdjust:"exact"},backgroundColor:Pe(t,e.color)},e.color==="inherit"&&e.variant!=="buffer"&&{backgroundColor:"none","&::before":{content:'""',position:"absolute",left:0,top:0,right:0,bottom:0,backgroundColor:"currentColor",opacity:.3}},e.variant==="buffer"&&{backgroundColor:"transparent"},e.variant==="query"&&{transform:"rotate(180deg)"})),da=_("span",{name:"MuiLinearProgress",slot:"Dashed",overridesResolver:(e,t)=>{const{ownerState:o}=e;return[t.dashed,t[`dashedColor${E(o.color)}`]]}})(({ownerState:e,theme:t})=>{const o=Pe(t,e.color);return k({position:"absolute",marginTop:0,height:"100%",width:"100%"},e.color==="inherit"&&{opacity:.3},{backgroundImage:`radial-gradient(${o} 0%, ${o} 16%, transparent 42%)`,backgroundSize:"10px 10px",backgroundPosition:"0 -23px"})},Se(Qe||(Qe=H`
    animation: ${0} 3s infinite linear;
  `),ia)),ua=_("span",{name:"MuiLinearProgress",slot:"Bar1",overridesResolver:(e,t)=>{const{ownerState:o}=e;return[t.bar,t[`barColor${E(o.color)}`],(o.variant==="indeterminate"||o.variant==="query")&&t.bar1Indeterminate,o.variant==="determinate"&&t.bar1Determinate,o.variant==="buffer"&&t.bar1Buffer]}})(({ownerState:e,theme:t})=>k({width:"100%",position:"absolute",left:0,bottom:0,top:0,transition:"transform 0.2s linear",transformOrigin:"left",backgroundColor:e.color==="inherit"?"currentColor":(t.vars||t).palette[e.color].main},e.variant==="determinate"&&{transition:`transform .${Ce}s linear`},e.variant==="buffer"&&{zIndex:1,transition:`transform .${Ce}s linear`}),({ownerState:e})=>(e.variant==="indeterminate"||e.variant==="query")&&Se(Ye||(Ye=H`
      width: auto;
      animation: ${0} 2.1s cubic-bezier(0.65, 0.815, 0.735, 0.395) infinite;
    `),na)),pa=_("span",{name:"MuiLinearProgress",slot:"Bar2",overridesResolver:(e,t)=>{const{ownerState:o}=e;return[t.bar,t[`barColor${E(o.color)}`],(o.variant==="indeterminate"||o.variant==="query")&&t.bar2Indeterminate,o.variant==="buffer"&&t.bar2Buffer]}})(({ownerState:e,theme:t})=>k({width:"100%",position:"absolute",left:0,bottom:0,top:0,transition:"transform 0.2s linear",transformOrigin:"left"},e.variant!=="buffer"&&{backgroundColor:e.color==="inherit"?"currentColor":(t.vars||t).palette[e.color].main},e.color==="inherit"&&{opacity:.3},e.variant==="buffer"&&{backgroundColor:Pe(t,e.color),transition:`transform .${Ce}s linear`}),({ownerState:e})=>(e.variant==="indeterminate"||e.variant==="query")&&Se(Ze||(Ze=H`
      width: auto;
      animation: ${0} 2.1s cubic-bezier(0.165, 0.84, 0.44, 1) 1.15s infinite;
    `),sa)),ma=l.forwardRef(function(t,o){const a=oe({props:t,name:"MuiLinearProgress"}),{className:n,color:s="primary",value:i,valueBuffer:d,variant:c="indeterminate"}=a,u=ae(a,ra),p=k({},a,{color:s,variant:c}),m=la(p),h=Et(),f={},v={bar1:{},bar2:{}};if((c==="determinate"||c==="buffer")&&i!==void 0){f["aria-valuenow"]=Math.round(i),f["aria-valuemin"]=0,f["aria-valuemax"]=100;let b=i-100;h&&(b=-b),v.bar1.transform=`translateX(${b}%)`}if(c==="buffer"&&d!==void 0){let b=(d||0)-100;h&&(b=-b),v.bar2.transform=`translateX(${b}%)`}return w.jsxs(ca,k({className:U(m.root,n),ownerState:p,role:"progressbar"},f,{ref:o},u,{children:[c==="buffer"?w.jsx(da,{className:m.dashed,ownerState:p}):null,w.jsx(ua,{className:m.bar1,ownerState:p,style:v.bar1}),c==="determinate"?null:w.jsx(pa,{className:m.bar2,ownerState:p,style:v.bar2})]}))}),fa=ma;function ha({avatar:e,title:t,action:o}){return g(S,{display:"flex",gap:1,p:2,alignItems:"center",children:[e,r(M,{variant:"subtitle1",sx:{flexGrow:1},children:t}),o&&r(M,{variant:"caption",children:o})]})}function ga({condition:e,wrapper:t,falseWrapper:o,children:a}){return e?t(a):o?o(a):a}function et({value:e,onChange:t,...o}){const[a,n]=l.useState(e);l.useEffect(()=>{n(e)},[e]);const s=()=>t(a);return r(So,{value:a,onChange:i=>n(i.target.value),onBlur:s,onKeyDown:i=>i.key==="Enter"&&!o.multiline&&s(),...o})}function ba(e){const{t}=T("ui"),o=ve({path:"/:page/*"}),a=t("pageTitle"),n=e??((o==null?void 0:o.params.page)&&t(`tabs.${o==null?void 0:o.params.page}`));l.useEffect(()=>{n?document.title=`${n} - ${a}`:document.title=a},[t,a,n])}function Ae(e,t){const[o,a]=mo(),n=l.useMemo(()=>o&&e.get(t),[o,e,t]);return l.useEffect(()=>e.follow(t,a),[e,t,a]),n}function va(e){const{database:t}=P();return Ae(t.builds,e??"")}function ht(e){const t=l.useMemo(()=>e||Ot(at,()=>""),[e]),{database:o}=P(),[a,n]=l.useState(()=>Le(t,s=>o.relics.get(s)));return l.useEffect(()=>{n(Le(t,i=>o.relics.get(i)));const s=Object.values(t).map(i=>o.relics.follow(i,(d,c,u)=>{c==="update"&&n(p=>({...p,[u.slotKey]:u})),c==="remove"&&n(p=>({...p,[u.slotKey]:void 0}))}));return()=>s.forEach(i=>i())},[o,t]),a}function G(e){const{database:t}=P();return Ae(t.loadouts,e??"")}function gt(e){const{database:t}=P();return Ae(t.teams,e)}function xa({slot:e}){const{t}=T("relic");return r(j,{sx:{height:"100%"},children:g(O,{children:[g(M,{children:[t("slot"),": ",e]}),r(M,{children:t("empty")})]})})}function Ca({build:e}){const t=ht(e);return r(I,{container:!0,columns:3,spacing:1,children:at.map(o=>{const a=t[o];return r(I,{item:!0,xs:1,children:a?r(To,{relic:a}):r(xa,{slot:o})},`${o}_${a==null?void 0:a.id}`)})})}function ya({charKey:e,setCharKey:t}){const{t:o}=T(["character","charNames_gen"]),{database:a}=P(),n=l.useCallback(d=>!!a.chars.get(d),[a.chars]),s=l.useCallback(d=>a.charMeta.get(d).favorite,[a.charMeta]),i=l.useMemo(()=>[{key:"",label:o("character:autocomplete.none")},...Wt.map(d=>({key:d,label:o(`charNames_gen:${d}`),favorite:s(d),color:n(d)?void 0:"secondary"}))],[n,s,o]);return r(l.Suspense,{fallback:r(we,{variant:"text",width:100}),children:r(Mo,{options:i,toImg:()=>r(me,{children:" "}),valueKey:e,onChange:d=>t(d??"")})})}const ka={RuanMei:Kt};function $a({document:e,bgt:t="normal",collapse:o=!1}){switch(e.type){case"fields":return r(Sa,{fieldsDocument:e,bgt:t});case"text":return o?r(wa,{textDocument:e}):r(bt,{textDocument:e});case"conditional":return r(Ma,{conditional:e.conditional,bgt:t});default:return null}}function Sa({fieldsDocument:e,bgt:t="normal"}){return g(j,{bgt:t,children:[e.header&&r(vt,{header:e.header,hideDivider:e.fields.length===0}),r(rt,{bgt:t,fields:e.fields})]})}function bt({textDocument:e}){const t=l.useContext(fe);return t?r("div",{children:qt(e.text,t)}):null}function wa({textDocument:e}){const[t,o]=l.useState(!1),[a,n]=l.useState(!1);return g(S,{sx:{position:"relative"},children:[!t&&r(S,{sx:{pointerEvents:"none",position:"absolute",mx:"auto",width:"100%",display:"flex",justifyContent:"center",height:"100%",alignItems:"flex-end",zIndex:"10",transition:"transform 0.3s ease",transform:a?"translate(0,-5px)":void 0},children:r(wo,{})}),r(mt,{onMouseEnter:()=>n(!0),onMouseLeave:()=>n(!1),collapsedSize:55,onClick:()=>o(s=>!s),in:t,sx:{cursor:"pointer",position:"relative",maskImage:t?void 0:"linear-gradient(to bottom, black 0%, transparent 100%)","&:hover":{maskImage:t?void 0:"linear-gradient(to bottom, black 50%, transparent 100%)"}},children:r(bt,{textDocument:e})})]})}function vt({header:e,hideDivider:t}){const{icon:o,text:a,additional:n}=e;return g(me,{children:[r(ha,{avatar:o,title:a,action:n}),!t&&r(pe,{})]})}function Ma({conditional:e,bgt:t="normal"}){const{header:o,fields:a}=e;return g(j,{bgt:t,children:[!!o&&r(vt,{header:o}),r(Ra,{conditional:e}),!!a&&r(rt,{bgt:t,fields:a})]})}function Ra({conditional:e}){return r(Ta,{conditional:e})}function Ta({conditional:e}){const t=l.useContext(fe),{label:o,badge:a}=e,n=t==null?void 0:t.compute(Vt({et:"own",qt:"cond",sheet:e.metadata.sheet,q:e.metadata.name,src:"all",dst:t.cache.tag.src},"max")).val;return g(Z,{fullWidth:!0,size:"small",sx:{borderRadius:0},color:n?"success":"primary",startIcon:n?r(lo,{}):r(co,{}),children:[o," ",a]})}function ne(){return l.useContext(fe)}function xt({optTarget:e,setOptTarget:t}){const{t:o}=T("optimize"),a=ne();return r(Ie,{title:`${o("optTarget")}${e?`: ${e.tag.name||e.tag.q}`:""}`,children:a==null?void 0:a.listFormulas(Me.listing.formulas).map((n,s)=>r(_e,{onClick:()=>t(n),children:n.tag.name||n.tag.q},`${s}_${n.tag.name||n.tag.q}`))})}function Da({statFilters:e,setStatFilters:t,disabled:o=!1}){const a=l.useCallback((c,u,p)=>{const m={...e},h=JSON.stringify(u),f=u?[...e[h]]:void 0,v=JSON.stringify(c),b=[...e[v]??[]];p!==void 0&&f?b.push(f[p]):b.push({minValue:0,maxValue:0,disabled:!1}),m[v]=b,p!==void 0&&f&&(f.splice(p,1),f.length?m[h]=f:delete m[h]),t({...m})},[t,e]),n=l.useCallback((c,u)=>{const p={...e},m=JSON.stringify(c),h=[...e[m]];h.splice(u,1),h.length?p[m]=h:delete p[m],t({...p})},[t,e]),s=l.useCallback((c,u,p)=>{const m={...e},h=JSON.stringify(c),f=[...e[h]];f[u]={...f[u],minValue:p},m[h]=f,t({...m})},[t,e]),i=l.useCallback((c,u,p)=>{const m={...e},h=JSON.stringify(c),f=[...e[h]];f[u]={...f[u],maxValue:p},m[h]=f,t({...m})},[t,e]),d=l.useCallback((c,u,p)=>{const m={...e},h=JSON.stringify(c),f=[...e[h]];f[u]={...f[u],disabled:p},m[h]=f,t({...m})},[t,e]);return g(me,{children:[Object.entries(e).flatMap(([c,u])=>u==null?void 0:u.map((p,m)=>r(tt,{path:JSON.parse(c),setting:p,index:m,setTarget:a,delTarget:n,setMinValue:s,setMaxValue:i,setDisabled:d,disabled:o},c+m))),r(tt,{delTarget:n,setTarget:a,setMinValue:s,setMaxValue:i,setDisabled:d,disabled:o})]})}function tt({path:e,setting:t,index:o,delTarget:a,setMinValue:n,setMaxValue:s,setDisabled:i,disabled:d}){const{t:c}=T("page_character_optimize"),u=l.useCallback(v=>e&&o!==void 0&&n(e,o,v??0),[n,e,o]),p=l.useCallback(v=>e&&o!==void 0&&s(e,o,v??1/0),[s,e,o]),[m,h]=l.useState(void 0),f={p:1,flexBasis:30,flexGrow:0,flexShrink:0};return g(Ht,{sx:{"& .MuiButtonGroup-grouped":{minWidth:24},width:"100%"},children:[!!t&&!!e&&o!==void 0&&r(Z,{sx:f,color:t.disabled?"secondary":"success",onClick:()=>i(e,o,!t.disabled),disabled:d,children:t.disabled?r(Gt,{}):r(Ut,{})}),r(We,{sx:{flexBasis:150,flexGrow:1},children:r(Oe,{float:!0,disabled:!e||d,value:t==null?void 0:t.minValue,placeholder:c("buildConstraint.minStatValue"),onChange:u,sx:{px:1},inputProps:{sx:{"& + .MuiOutlinedInput-notchedOutline":{borderRadius:0},textAlign:"right"}}})}),r(xt,{optTarget:m,setOptTarget:h}),r(We,{sx:{flexBasis:150,flexGrow:1},children:r(Oe,{float:!0,disabled:!e||d,value:t==null?void 0:t.maxValue,placeholder:c("buildConstraint.maxStatValue"),onChange:p,sx:{px:1},inputProps:{sx:{"& + .MuiOutlinedInput-notchedOutline":{borderRadius:0},textAlign:"left"}}})}),!!e&&o!==void 0&&r(Z,{sx:f,color:"error",onClick:()=>a(e,o),disabled:d,children:r(Do,{fontSize:"small"})})]})}function _a({disabled:e=!1}){const{t}=T("page_character_optimize"),[o,a]=l.useState({});return r(S,{children:g(j,{bgt:"light",children:[r(O,{sx:{display:"flex",gap:1,justifyContent:"space-between",flexDirection:"column"},children:g(S,{display:"flex",justifyContent:"space-between",children:[r(M,{sx:{fontWeight:"bold"},children:t`constraintFilter.title`}),r(_o,{title:r(M,{children:t`constraintFilter.tooltip`})})]})}),r(pe,{}),r(S,{display:"flex",flexDirection:"column",gap:.5,children:r(Da,{statFilters:o,setStatFilters:a,disabled:e})})]})})}function Ia({numWorkers:e,setNumWorkers:t}){const{t:o}=T("optimize"),a=navigator.hardwareConcurrency||8;return r(Ie,{title:`${o("numWorkers")}: ${e}`,children:nt(1,a).map(n=>r(_e,{onClick:()=>t(n),children:o("workers",{count:n})},n))})}function Pa({teamId:e,src:t,children:o}){var b,y,$,R;const a=gt(e),n=G((b=a.loadoutMetadata[0])==null?void 0:b.loadoutId),s=G((y=a.loadoutMetadata[1])==null?void 0:y.loadoutId),i=G(($=a.loadoutMetadata[2])==null?void 0:$.loadoutId),d=G((R=a.loadoutMetadata[3])==null?void 0:R.loadoutId),c=l.useMemo(()=>{const C={all:"all"};return n&&(C[n.key]="0"),s&&(C[s.key]="1"),i&&(C[i.key]="2"),d&&(C[d.key]="3"),C},[n,s,i,d]),u=de(a.loadoutMetadata[0],c),p=de(a.loadoutMetadata[1],c),m=de(a.loadoutMetadata[2],c),h=de(a.loadoutMetadata[3],c),f=l.useMemo(()=>ho([...go(a.loadoutMetadata.map((C,A)=>C===void 0?void 0:st[A]).filter(C=>!!C)),...u?ue(0,u):[],...p?ue(1,p):[],...m?ue(2,m):[],...h?ue(3,h):[],le.common.lvl.add(80),le.common.res.add(.1),le.common.isBroken.add(0),le.common.maxToughness.add(100),Jt.common.critMode.add("avg")]),[u,p,m,h,a.loadoutMetadata]),v=l.useMemo(()=>(f==null?void 0:f.withTag({src:t}))??null,[f,t]);return r(fe.Provider,{value:v,children:o})}function de(e,t){const o=G(e==null?void 0:e.loadoutId),a=ct(o==null?void 0:o.key),n=va(e==null?void 0:e.buildId),s=$o(n==null?void 0:n.lightConeId),i=ht(n==null?void 0:n.relicIds),d=l.useMemo(()=>Object.fromEntries(Object.entries((o==null?void 0:o.conditional)??{}).map(([c,u])=>[t[c],u])),[o,t]);return l.useMemo(()=>({character:a,lightCone:s,relics:i,conditionals:d}),[a,s,d,i])}function ue(e,{character:t,lightCone:o,relics:a,conditionals:n}){return t?[...bo(`${e}`,...vo(t),...xo(o),...Co(Object.values(a).filter(s=>!!s).map(s=>({set:s.setKey,stats:[...s.substats.filter(({key:i})=>i!=="").map(i=>({key:i.key,value:i.accurateValue})),{key:s.mainStatKey,value:s.mainStatVal}]})))),...yo(`${e}`,n)]:[]}var Be={},Aa=Te;Object.defineProperty(Be,"__esModule",{value:!0});var Ct=Be.default=void 0,Ba=Aa(Re()),Na=w,za=(0,Ba.default)((0,Na.jsx)("path",{d:"M22 24H2v-4h20v4zM13.06 5.19l3.75 3.75L7.75 18H4v-3.75l9.06-9.06zm4.82 2.68-3.75-3.75 1.83-1.83c.39-.39 1.02-.39 1.41 0l2.34 2.34c.39.39.39 1.02 0 1.41l-1.83 1.83z"}),"BorderColor");Ct=Be.default=za;function Ea({teamId:e,charKey:t,tab:o=""}){const{t:a}=T("page_team"),n=it(),{database:s}=P(),i=s.teams.get(e),{loadoutMetadata:d}=i,c=ke(),u=lt(c.breakpoints.down("md")),[p,m]=l.useState(!1),h=v=>{s.teams.set(e,{name:v})},f=v=>{s.teams.set(e,{description:v})};return g(S,{sx:()=>({borderBottom:"1px rgb(200,200,200,0.3) solid","& .MuiTab-root:hover":{transition:"background-color 0.25s ease",backgroundColor:"rgba(255,255,255,0.1)"},"& .Mui-selected":{color:"white !important"},"& .MuiTabs-indicator":{height:"4px",backgroundColor:"rgb(200,200,200,0.5)"}}),children:[r(ut,{onClick:()=>m(!0),children:r(Ft,{placement:"top",title:g(S,{children:[g(S,{sx:{display:"flex",color:"info.light",gap:1},children:[r(Ct,{}),r(M,{children:r("strong",{children:a`team.editNameDesc`})})]}),!!i.description&&r(M,{children:i.description})]}),children:r(O,{sx:{display:"flex",justifyContent:"center","&:hover":{color:"info.light"}},children:g(M,{variant:"h5",sx:{display:"flex",gap:1,alignItems:"center",justifyContent:"center",textShadow:"#000 0 0 10px !important"},children:[r(be,{}),i.name]})})})}),r(Qt,{open:p,onClose:()=>m(!1),children:g(j,{children:[r(fo,{title:a`team.editNameDesc`,avatar:r(be,{}),titleTypographyProps:{variant:"h6"},action:r(Xt,{onClick:()=>m(!1),children:r(dt,{})})}),r(pe,{}),r(O,{children:g(S,{display:"flex",flexDirection:"column",gap:2,sx:{mt:2},children:[r(et,{label:a`team.name`,value:i.name,onChange:v=>h(v),autoFocus:!0}),r(et,{label:a`team.desc`,value:i.description,onChange:v=>f(v),multiline:!0,minRows:4})]})})]})}),r(pe,{}),g(Yt,{variant:"fullWidth",value:t??"team",orientation:u?"vertical":"horizontal",children:[r(Ke,{icon:r(be,{}),iconPosition:"start",value:"team",label:"Team Settings",onClick:()=>n(`/teams/${e}/`)}),d.map((v,b)=>{var $;const y=v&&(($=s.loadouts.get(v==null?void 0:v.loadoutId))==null?void 0:$.key);return r(Ke,{icon:r(Zt,{}),iconPosition:"start",value:y??b,disabled:!d[b],label:y?r(M,{children:a(`charNames_gen:${y}`)}):`Character ${b+1}`,onClick:()=>y&&n(`/teams/${e}/${y}/${o}`)},b)})]})]})}function ja({teamId:e}){const{database:t}=P(),o=t.teams.get(e);return g(S,{children:[e,o.loadoutMetadata.map((a,n)=>r(La,{loadoutMetadataIndex:n,teamId:e},`${n}_${a==null?void 0:a.loadoutId}`))]})}function La({loadoutMetadataIndex:e,teamId:t}){var d;const{database:o}=P(),a=o.teams.get(t),n=(d=a.loadoutMetadata[e])==null?void 0:d.loadoutId,s=o.loadouts.get(n);function i(c){if(c===""){o.teams.set(t,p=>p.loadoutMetadata[e]=void 0);return}o.chars.getOrCreate(c);const u=a.loadoutMetadata.findIndex(p=>{var m;return p&&((m=o.loadouts.get(p.loadoutId))==null?void 0:m.key)===c});if(u===-1){let p=o.loadouts.keys.find(m=>o.loadouts.get(m).key===c);p||(p=o.loadouts.new(c)),o.teams.set(t,m=>{m.loadoutMetadata[e]={loadoutId:p}})}else{if(u===e)return;const p=a.loadoutMetadata[u],m=a.loadoutMetadata[e];o.teams.set(t,h=>{h.loadoutMetadata[e]=p,h.loadoutMetadata[u]=m})}}return r(ya,{charKey:(s==null?void 0:s.key)??"",setCharKey:i})}var Ne={},Oa=Te;Object.defineProperty(Ne,"__esModule",{value:!0});var ye=Ne.default=void 0,Wa=Oa(Re()),Ka=w,qa=(0,Wa.default)((0,Ka.jsx)("path",{d:"M16.59 8.59 12 13.17 7.41 8.59 6 10l6 6 6-6z"}),"ExpandMore");ye=Ne.default=qa;const Va=5e4;class Ga{constructor(t,o,a,n,s){this.calc=t,this.optTarget=o,this.relicsBySlot=a,this.numWorkers=n,this.setProgress=s,this.worker=new Worker(new URL(""+new URL("parentWorker-CAAYnoOP.js",import.meta.url).href,import.meta.url),{type:"module"})}async optimize(){return await new Promise((o,a)=>{this.worker.onmessage=({data:s})=>{switch(s.resultType){case"progress":this.setProgress(s.progress);break;case"done":o(s.buildResults);break;case"err":console.log(s),a();break}};const n={command:"start",relicsBySlot:this.relicsBySlot,detachedNodes:this.detachNodes(),numWorkers:this.numWorkers};this.worker.postMessage(n)})}async terminate(){const t={command:"terminate"};this.worker.postMessage(t),await new Promise((o,a)=>{this.worker.onmessage=({data:n})=>{switch(n.resultType){case"terminated":o();break;case"err":console.log(n),a();break}}}),this.worker.terminate()}detachNodes(){const t=new Set(eo);return ko([this.optTarget],this.calc,a=>{if(a.src==="0"&&a.et==="own"){if(a.sheet==="dyn"&&a.qt==="premod")return{q:a.q};if(a.q==="count"&&t.has(a.sheet))return{q:a.sheet}}})}}var ze={},Ua=Te;Object.defineProperty(ze,"__esModule",{value:!0});var yt=ze.default=void 0,Ha=Ua(Re()),Ja=w,Fa=(0,Ha.default)((0,Ja.jsx)("path",{d:"m16 6 2.29 2.29-4.88 4.88-4-4L2 16.59 3.41 18l6-6 4 4 6.3-6.29L22 12V6z"}),"TrendingUp");yt=ze.default=Fa;function Xa(){const{t:e}=T("optimize"),{database:t}=P(),o=ne(),[a,n]=l.useState(8),[s,i]=l.useState(void 0),[d,c]=l.useState(void 0),u=l.useMemo(()=>t.relics.values.reduce((R,C)=>(R[C.slotKey].push(C),R),{head:[],hands:[],feet:[],body:[],sphere:[],rope:[]}),[t.relics.values]),p=Object.values(u).reduce((R,C)=>R*C.length,1),[m,h]=l.useState(void 0),[f,v]=l.useState(!1),b=l.useRef(()=>{});l.useEffect(()=>()=>b.current(),[]);const y=l.useCallback(async()=>{if(!d||!o)return;const R=new Promise(J=>b.current=J);i(void 0),v(!0);const C=new Ga(o,d,u,a,i);R.then(async()=>await C.terminate());const A=await C.optimize();await C.terminate(),b.current=()=>{},v(!1),h(A[0])},[o,a,d,u]),$=l.useCallback(()=>{b.current(),v(!1)},[b]);return r(j,{bgt:"dark",children:g(O,{children:[r(_a,{}),g(xe,{children:[r(M,{variant:"h5",children:e("optimize")}),g(S,{children:[r(xt,{optTarget:d,setOptTarget:c}),r(Ia,{numWorkers:a,setNumWorkers:n}),r(Z,{onClick:f?$:y,color:f?"error":"primary",startIcon:f?r(dt,{}):r(yt,{}),children:e(f?"cancel":"optimize")})]}),s&&r(Qa,{progress:s,totalPermutations:p}),m&&g(S,{children:[g(M,{children:["Best: ",m.value]}),r(Ca,{build:m.ids})]})]})]})})}function Qa({progress:e,totalPermutations:t}){const{t:o}=T("optimize");return g(S,{children:[g(M,{children:[o("totalProgress"),": ",e.numBuildsComputed.toLocaleString()," /"," ",t.toLocaleString()]}),g(M,{children:[o("buildsKept"),": ",e.numBuildsKept.toLocaleString()," /"," ",Va.toLocaleString()]}),r(fa,{variant:"determinate",value:e.numBuildsComputed/t*100})]})}const Ya={xs:12,sm:6,md:4};function Za(){const{loadout:{key:e}}=De(),t=ne(),{t:o}=T("sheet_gen"),a=[["basic",o("talents.basic")],["skill",o("talents.skill")],["ultimate",o("talents.ultimate")]],n=ke(),s=lt(n.breakpoints.up("lg")),i=ka[e];if(console.log({characterSheet:i,calc:t}),!(!i||!t))return r(me,{children:g(I,{container:!0,spacing:1,children:[s&&r(I,{item:!0,xs:12,md:12,lg:3,sx:{display:"flex",flexDirection:"column",gap:1},children:r(ot,{})}),r(I,{item:!0,xs:12,md:12,lg:9,container:!0,spacing:1,children:a.map(([d,c])=>{const u=i[d];return u?r(I,{item:!0,...Ya,children:r(er,{talentKey:d,subtitle:c,sheetElement:u})},d):null})}),!s&&r(I,{item:!0,xs:12,md:12,lg:3,container:!0,spacing:1,children:r(I,{item:!0,xs:12,children:r(ot,{})})})]})})}function er({sheetElement:e,subtitle:t,onClickTitle:o}){const a=l.useCallback(s=>r(ut,{onClick:o,children:s}),[o]);let n=null;return n=null,g(j,{bgt:"light",sx:{height:"100%"},children:[n,g(O,{children:[r(ga,{condition:!!o,wrapper:a,children:g(I,{container:!0,sx:{flexWrap:"nowrap"},children:[r(I,{item:!0,children:r(S,{component:qe?qe:"img",src:e==null?void 0:e.img,sx:{width:60,height:"auto"}})}),g(I,{item:!0,flexGrow:1,sx:{pl:1},children:[r(M,{variant:"h6",children:e==null?void 0:e.name}),r(M,{variant:"subtitle1",children:t})]})]})}),e.documents.map((s,i)=>r($a,{document:s,collapse:!0},i))]})]})}function ot(){const{t:e}=T("sheet_gen"),t=ne();if(!t)return null;const o=t.compute(Me.char.eidolon).val;return r(Ie,{fullWidth:!0,title:e("constellationLvl",{level:o}),color:"primary",children:nt(0,to).map(a=>r(_e,{selected:o===a,disabled:o===a,onClick:()=>{},children:e("constellationLvl",{level:a})},a))})}function tr({tab:e}){const{loadout:{key:t}}=De(),{character:o}=oo(),a=ne(),[n,s]=l.useState(void 0);return g(S,{children:[e,r(uo,{characterKey:n,onClose:()=>s(void 0)}),r(po,{character:o}),g(xe,{gap:1,pt:1,children:[r(j,{bgt:"dark",children:g(O,{children:[r(Z,{disabled:!t,onClick:()=>t&&s(t),children:"Edit Character"}),g(Ge,{children:[r(He,{expandIcon:r(ye,{}),children:"All target values, if sheet is created"}),r(Ue,{children:r(xe,{children:a==null?void 0:a.listFormulas(Me.listing.formulas).map((i,d)=>{const c=a.compute(i),u=i.tag.name||i.tag.q;return g(S,{children:[g(M,{children:[u,": ",c.val]}),g(Ge,{children:[g(He,{expandIcon:r(ye,{}),children:["debug for ",u]}),r(Ue,{children:r(M,{component:"pre",children:JSON.stringify(a.toDebug().compute(i),void 0,2)})})]})]},`${u}${d}`)})})})]})]})}),r(Za,{}),r(Xa,{})]})]})}const or=r(we,{variant:"rectangular",width:"100%",height:1e3});function hr(){const{database:e}=P(),{teamId:t}=ao(),o=!t||!e.teams.keys.includes(t);return l.useEffect(()=>{o||e.teams.set(t,{lastEdit:Date.now()})},[t,e.teams,o]),o?r(so,{to:"/teams"}):r(S,{display:"flex",flexDirection:"column",gap:1,children:r(l.Suspense,{fallback:or,children:t&&r(ar,{teamId:t})})})}function ar({teamId:e}){var v;const{database:t}=P(),o=it(),a=gt(e),{loadoutMetadata:n}=a,{params:{characterKey:s}}=ve({path:"/teams/:teamId/:characterKey",end:!1})??{params:{}},{params:{tab:i}}=ve({path:"/teams/:teamId/:characterKey/:tab"})??{params:{}},d=l.useMemo(()=>n.findIndex(b=>{var y;return(b==null?void 0:b.loadoutId)&&((y=t.loadouts.get(b.loadoutId))==null?void 0:y.key)===s}),[n,t.loadouts,s]),c=l.useMemo(()=>n[d],[n,d]);l.useEffect(()=>{window.scrollTo({top:0})},[]),l.useEffect(()=>{c||o("",{replace:!0})},[c,o]);const u=c==null?void 0:c.loadoutId,p=(v=t.loadouts.get(u))==null?void 0:v.key,{t:m}=T(["charNames_gen","page_character"]);ba(l.useMemo(()=>{const b=m(p?"charNames_gen:Character":"Team Settings"),y=i?m(`page_character:tabs.${i}`):p?m("Loadout/Build"):i;return`${a.name} - ${b}${y?` - ${y}`:""}`},[p,m,i,a.name]));const h=G(u??""),f=l.useMemo(()=>{if(!(!u||!h||!c))return{teamId:e,team:a,loadoutId:u,loadout:h,loadoutMetadatum:c}},[c,a,h,u,e]);return r(Pa,{teamId:e,src:st[d],children:g(S,{sx:{display:"flex",gap:1,flexDirection:"column",mx:1,mt:2},children:[r(j,{children:r(Ea,{teamId:e,charKey:p,tab:i})}),r(S,{children:f?r(ro.Provider,{value:f,children:r(rr,{})}):r(ja,{teamId:e})})]})})}function rr({tab:e}){const{loadout:{key:t}}=De(),o=ct(t),a=l.useMemo(()=>o&&{character:o},[o]);return a?r(no.Provider,{value:a,children:r(io,{children:r(Ve,{path:":characterKey",children:r(Ve,{path:"*",index:!0,element:r(tr,{tab:e})})})})}):r(we,{variant:"rectangular",width:"100%",height:1e3})}export{hr as default};
