import{N as v,n as e,E as g,m as _,ak as Z,U as ee,V as te,r as f,q as c,ac as be,H as C,X as S,L as M,I as ae,at as w,W as ne,av as xe,au as Ce,aY as ye,ap as N,aq as ve,aZ as Se,as as Me,ar as Te,Y as oe,F as re,S as se,ax as ke,ay as De,ab as T,aB as j,G as y,aa as R,aE as ce,aF as ie,aG as _e,aH as we,aI as Be,aJ as $e,$ as le,aK as Ie,aL as Ke,aM as V}from"./index-BJwvpkBM.js";import{u as Ne,C as Pe,d as Oe,e as G,T as H,f as Ae,b as qe,c as Ee,a as We,t as de,N as Fe,I as Le,g as je,h as ze,j as ue,i as Je,D as Re,k as Ve,A as P,l as O,m as A,n as q,o as Ge}from"./util-ZNGsUkj9.js";import{u as he,S as F,b as B,C as He,a as Xe}from"./CharacterEditor-xUvGc_Oh.js";import{d as Ye}from"./Close-PXg9g64q.js";import{C as z}from"./CardActionArea-CvlzuLQB.js";import{C as L}from"./useForceUpdate-Bnzq9yf0.js";import{s as Qe,t as Ue,b as X,w as Ze,c as et,l as tt,r as at}from"./index-D4GWyoOv.js";import{u as nt}from"./useBoolState-UBwnvhN3.js";import{M as D,D as $}from"./DropdownButton-CLgPB5dW.js";import{D as ot,a as rt}from"./DeleteForever-CyU_aAC4.js";import"./index-N00VXk70.js";function I(t){const{database:n}=v();return Ne(n.combos,t)}function st({comboId:t}){const n=I(t);return e(g,{display:"flex",flexDirection:"column",gap:1,children:n.comboMetadata.map((a,o)=>e(ct,{comboMetadataIndex:o,comboId:t},`${o}_${a==null?void 0:a.characterKey}`))})}function ct({comboMetadataIndex:t,comboId:n}){var r;const{database:a}=v(),o=I(n);function s(d){if(d===""){a.teams.set(n,i=>i.loadoutMetadata[t]=void 0);return}a.chars.getOrCreate(d);const l=o.comboMetadata.findIndex(i=>(i==null?void 0:i.characterKey)===d);if(l===-1)a.combos.set(n,i=>{i.comboMetadata[t]={characterKey:d}});else{if(l===t)return;const i=o.comboMetadata[l],u=o.comboMetadata[t];a.combos.set(n,m=>{m.comboMetadata[t]=i,m.comboMetadata[l]=u})}}return e(Pe,{charKey:((r=o.comboMetadata[t])==null?void 0:r.characterKey)??"",setCharKey:s})}function it({comboId:t,charKey:n}){const{t:a}=_("page_team"),o=Z(),{database:s}=v(),r=I(t),d=ee(),l=te(d.breakpoints.down("md")),[i,u]=f.useState(!1),m=p=>{s.combos.set(t,{name:p})},h=p=>{s.combos.set(t,{description:p})};return c(g,{sx:()=>({borderBottom:"1px rgb(200,200,200,0.3) solid","& .MuiTab-root:hover":{transition:"background-color 0.25s ease",backgroundColor:"rgba(255,255,255,0.1)"},"& .Mui-selected":{color:"white !important"},"& .MuiTabs-indicator":{height:"4px",backgroundColor:"rgb(200,200,200,0.5)"}}),children:[e(z,{onClick:()=>u(!0),children:e(be,{placement:"top",title:c(g,{children:[c(g,{sx:{display:"flex",color:"info.light",gap:1},children:[e(Oe,{}),e(C,{children:e("strong",{children:a`team.editNameDesc`})})]}),!!r.description&&e(C,{children:r.description})]}),children:e(S,{sx:{display:"flex",justifyContent:"center","&:hover":{color:"info.light"}},children:c(C,{variant:"h5",sx:{display:"flex",gap:1,alignItems:"center",justifyContent:"center",textShadow:"#000 0 0 10px !important"},children:[e(G,{}),r.name]})})})}),e(ne,{open:i,onClose:()=>u(!1),children:c(M,{children:[e(L,{title:a`team.editNameDesc`,avatar:e(G,{}),titleTypographyProps:{variant:"h6"},action:e(ae,{onClick:()=>u(!1),children:e(Ye,{})})}),e(w,{}),e(S,{children:c(g,{display:"flex",flexDirection:"column",gap:2,sx:{mt:2},children:[e(H,{label:a`team.name`,value:r.name,onChange:p=>m(p),autoFocus:!0}),e(H,{label:a`team.desc`,value:r.description,onChange:p=>h(p),multiline:!0,minRows:4}),e(st,{comboId:t})]})})]})}),e(w,{}),e(Ce,{variant:"fullWidth",value:n??"team",orientation:l?"vertical":"horizontal",children:r.comboMetadata.map((p,b)=>{const x=p==null?void 0:p.characterKey;return e(xe,{icon:e(Ae,{}),iconPosition:"start",value:x??b,disabled:!p,label:x?e(C,{children:a(`charNames_gen:${x}`)}):`Character ${b+1}`,onClick:()=>x&&o(`/combos/${t}/${x}`)},b)})})]})}const J=f.createContext({});function k(){return f.useContext(J)}const K=f.createContext({presetIndex:0,setPresetIndex:()=>{}});function lt({comboId:t,currentChar:n,children:a}){const o=I(t),{presetIndex:s}=f.useContext(K),r=E(o.comboMetadata[0]),d=E(o.comboMetadata[1]),l=E(o.comboMetadata[2]),i=E(o.comboMetadata[3]),u=f.useMemo(()=>Qe([...Ue(o.comboMetadata.map((h,p)=>h===void 0?void 0:ye[p]).filter(h=>!!h)),...r?W(r):[],...d?W(d):[],...l?W(l):[],...i?W(i):[],N.common.lvl.add(80),N.common.res.add(.1),N.common.isBroken.add(0),N.common.maxToughness.add(100),ve.common.critMode.add("avg"),...o.conditionals.flatMap(({sheet:h,src:p,dst:b,condKey:x,condValues:pe})=>pe.flatMap((fe,ge)=>X(`preset${ge}`,Se(h,p,b)(x,fe)))),...o.bonusStats.flatMap(({tag:h,values:p})=>p.flatMap((b,x)=>X(`preset${x}`,{tag:{...h},value:Me(b)})))]),[o,r,d,l,i]),m=f.useMemo(()=>(n&&(u==null?void 0:u.withTag({src:n,dst:n,preset:`preset${s}`})))??null,[u,n,s]);return e(Te.Provider,{value:m,children:a})}function E(t){const n=he(t==null?void 0:t.characterKey),a=qe(t==null?void 0:t.buildId),o=Ee(a==null?void 0:a.lightConeId),s=We(a==null?void 0:a.relicIds);return f.useMemo(()=>({character:n,lightCone:o,relics:s}),[n,o,s])}function W({character:t,lightCone:n,relics:a}){return t?Ze(t.key,...et(t),...tt(n),...at(Object.values(a).filter(o=>!!o).map(o=>({set:o.setKey,stats:[...o.substats.filter(({key:s})=>s!=="").map(s=>({key:s.key,value:s.accurateValue})),{key:o.mainStatKey,value:o.mainStatVal}]})))):[]}function dt(){const[t,n,a]=nt();return c(re,{children:[e(oe,{onClick:n,children:"Bonus Stats"}),e(ut,{open:t,onClose:a})]})}function ut({open:t,onClose:n}){const{database:a}=v(),{presetIndex:o}=f.useContext(K),{comboId:s,combo:{bonusStats:r},comboMetadatum:{characterKey:d}}=k(),l=i=>{const u=ht(i,d);a.combos.setBonusStat(s,u,0,o)};return e(ne,{open:t,onClose:n,children:c(M,{children:[e(L,{title:"Bonus Stats"}),e(w,{}),e(S,{children:c(F,{spacing:1,children:[r.map(({tag:i,values:u},m)=>e(ft,{tag:i,value:u[o],setValue:h=>a.combos.setBonusStat(s,i,h,o),onDelete:()=>a.combos.setBonusStat(s,i,0,o),setTag:h=>a.combos.setBonusStat(s,h,0,o)},JSON.stringify(i)+m)),e(pt,{onSelect:l})]})})]})})}function ht(t,n){return{src:n,dst:n,et:"own",q:t,qt:"premod",sheet:"agg"}}const mt=["hp","hp_","def","def_","atk","atk_","spd","spd_","dmg_","enerRegen_","brEffect_","crit_","crit_dmg_","eff_","eff_res_","heal_"];function pt({tag:t={},onSelect:n}){var a;return e($,{title:(t&&((a=de.subset(t)[0])==null?void 0:a.title))??"Add Bonus Stat",children:mt.map(o=>e(D,{onClick:()=>n(o),children:o},o))})}function ft({tag:t,setTag:n,value:a,setValue:o,onDelete:s}){var d;const r=(d=t.name||t.q)==null?void 0:d.endsWith("_");return e(M,{bgt:"light",children:c(S,{sx:{display:"flex",gap:1,justifyContent:"space-around"},children:[e(se,{sx:{m:"auto"},children:t.q}),t.q==="dmg_"&&e(gt,{tag:t,setElementalType:l=>{const{elementalType:i,...u}=t;n(l?{...u,elementalType:l}:u)}}),e(Fe,{float:!0,value:a,sx:{flexBasis:150,flexGrow:1,height:"100%"},onChange:o,placeholder:"Stat Value",size:"small",inputProps:{sx:{textAlign:"right"}},InputProps:{endAdornment:c(Le,{position:"end",sx:{ml:0},children:[r?"%":void 0," ",e(ae,{"aria-label":"Delete Bonus Stat",onClick:s,edge:"end",children:e(ot,{fontSize:"small"})})]})}})]})})}function gt({tag:t,setElementalType:n}){return c($,{title:t.elementalType??"No Element",children:[e(D,{onClick:()=>n(null),children:"No Element"}),ke.map(a=>e(D,{onClick:()=>n(a),children:a},a))]})}function Y({tag:t}){var n;return e(De,{color:je(t),children:((n=de.subset(t)[0])==null?void 0:n.title)||t.name||t.q})}function me({optTarget:t,setOptTarget:n,buttonProps:a={}}){const{t:o}=_("optimize"),s=B();return e($,{title:c(g,{sx:{display:"flex",gap:1},children:[o("optTarget"),t?e(Y,{tag:t.tag}):null]}),...a,children:s==null?void 0:s.listFormulas(T.listing.formulas).map((r,d)=>c(D,{onClick:()=>n(r),children:[e(rt,{children:e(Y,{tag:r.tag})}),e(g,{sx:{display:"flex",gap:1,ml:1},children:ze(r.tag).map(l=>e(se,{children:l}))})]},`${d}_${r.tag.sheet||r.tag.q}_${r.tag.name}`))})}function bt(){const{database:t}=v(),{combo:n,comboId:a}=k();return c(M,{children:[e(L,{title:"Combo Editor"}),e(w,{}),c(S,{sx:{display:"flex",gap:1,overflowX:"auto"},children:[n.frames.map((o,s)=>e(xt,{read:o,index:s,setTarget:r=>t.combos.set(a,d=>{const l=structuredClone(d.frames);l[s]=r,d.frames=l})},s+JSON.stringify(o??{}))),e(g,{sx:{flexShrink:0},children:e(me,{setOptTarget:o=>t.combos.set(a,s=>{s.frames=[...s.frames,o]})})})]})]})}function xt({read:t,index:n,setTarget:a}){const{presetIndex:o,setPresetIndex:s}=f.useContext(K);return c(M,{bgt:"light",sx:r=>({flexShrink:0,outline:o===n?`solid ${r.palette.success.main}`:void 0}),children:[e(ue,{condition:o!==n,wrapper:r=>e(z,{onClick:()=>s(n),children:r}),children:e(L,{title:`Combo ${n+1}`})}),e(w,{}),e(S,{children:e(me,{optTarget:t,setOptTarget:a})})]})}const Ct={xs:12,sm:6,md:4};function yt(){const{comboMetadatum:{characterKey:t}}=k(),n=B(),{t:a}=_("sheet_gen"),{database:o}=v(),s=[["basic",a("ability.basic")],["skill",a("ability.skill")],["ult",a("ability.ult")],["talent",a("ability.talent")]],r=ee(),d=te(r.breakpoints.up("lg")),l=Je[t],i=(n==null?void 0:n.compute(T.char.eidolon).val)??0,u=f.useMemo(()=>l&&j(1,ce).map(m=>{const h=l[`eidolon${m}`];return h?e(Q,{talentKey:`eidolon${m}`,subtitle:c("span",{children:[a("eidolonLvl")," ",m]}),sheetElement:h,onClickTitle:()=>o.chars.set(t,{eidolon:m===i?m-1:m})}):null}),[t,l,o.chars,i,a]);if(!(!l||!n))return e(re,{children:c(y,{container:!0,spacing:1,children:[d&&c(y,{item:!0,xs:12,md:12,lg:3,sx:{display:"flex",flexDirection:"column",gap:1},children:[e(U,{}),u&&u.map((m,h)=>e(g,{sx:{opacity:i>=h+1?1:.5},children:m},h))]}),e(y,{item:!0,xs:12,md:12,lg:9,container:!0,spacing:1,children:s.map(([m,h])=>{const p=l[m];return p?e(y,{item:!0,...Ct,children:e(Q,{talentKey:m,subtitle:h,sheetElement:p})},m):null})}),!d&&e(y,{item:!0,xs:12,md:12,lg:3,container:!0,spacing:1,children:e(y,{item:!0,xs:12,children:e(U,{})})})]})})}function Q({sheetElement:t,talentKey:n,subtitle:a,onClickTitle:o}){const{comboMetadatum:{characterKey:s}}=k(),r=f.useCallback(h=>e(z,{onClick:o,children:h}),[o]);let d=null;d=null,Ve(n)&&(d=e(vt,{talentKey:n,dropDownButtonProps:{sx:{borderRadius:0}},setTalent:h=>u.chars.set(s,p=>{p[n]=h})}));const{comboId:l}=f.useContext(J),{presetIndex:i}=f.useContext(K),{database:u}=v(),m=f.useCallback((h,p,b,x)=>u.combos.setConditional(l,p,h,s,b,x,i),[l,u.combos,s,i]);return c(M,{bgt:"light",sx:{height:"100%"},children:[d,c(S,{children:[e(ue,{condition:!!o,wrapper:r,children:c(y,{container:!0,sx:{flexWrap:"nowrap"},children:[e(y,{item:!0,children:e(g,{component:R?R:"img",src:t==null?void 0:t.img,sx:{width:60,height:"auto"}})}),c(y,{item:!0,flexGrow:1,sx:{pl:1},children:[e(C,{variant:"h6",children:t==null?void 0:t.title}),t.subtitle&&e(C,{variant:"subtitle1",children:t.subtitle})]})]})}),t.documents.map((h,p)=>e(Re,{document:h,collapse:!0,setConditional:m},p))]})]})}function U(){const{t}=_("sheet_gen"),n=B(),{comboMetadatum:{characterKey:a}}=k(),{database:o}=v();if(!n)return null;const s=n.compute(T.char.eidolon).val;return e($,{fullWidth:!0,title:c("span",{children:[t("eidolonLvl")," ",s]}),color:"primary",children:j(0,ce).map(r=>e(D,{selected:s===r,disabled:s===r,onClick:()=>o.chars.set(a,{eidolon:r}),children:c("span",{children:[t("eidolonLvl")," ",r]})},r))})}function vt({talentKey:t,setTalent:n,dropDownButtonProps:a}){const{t:o}=_("sheet_gen"),{character:s}=ie(),r=B();if(!r||!s)return null;const d=0,l=r.compute(T.char[t]).val,i=r.compute(T.char.ascension).val;return e($,{fullWidth:!0,title:c("span",{children:[o("lvl")," ",l]}),color:"primary",...a,children:j(1,_e[i]).map(u=>e(D,{selected:s[t]===u,disabled:s[t]===u,onClick:()=>n(u),children:c("span",{children:[o("lvl")," ",u+d]})},u))})}function St(){const{comboMetadatum:{characterKey:t}}=k(),{character:n}=ie(),a=B(),[o,s]=f.useState(void 0);return c(g,{children:[e(He,{characterKey:o,onClose:()=>s(void 0)}),e(Xe,{character:n}),c(F,{gap:1,pt:1,children:[e(bt,{}),e(M,{bgt:"dark",children:c(S,{children:[e(oe,{disabled:!t,onClick:()=>t&&s(t),children:"Edit Character"}),e(dt,{}),c(P,{children:[e(O,{expandIcon:e(A,{}),children:"All target listings"}),e(q,{children:e(F,{children:a==null?void 0:a.listFormulas(T.listing.formulas).map((r,d)=>{const l=a.compute(r),i=r.tag.name||r.tag.q;return c(g,{children:[c(C,{children:[i,": ",l.val]}),c(P,{children:[c(O,{expandIcon:e(A,{}),children:["debug for ",i]}),c(q,{children:["conds:"," ",JSON.stringify(l.meta.conds,void 0,2),e(C,{component:"pre",children:JSON.stringify(a.toDebug().compute(r),void 0,2)})]})]})]},`${i}${d}`)})})})]}),c(P,{children:[e(O,{expandIcon:e(A,{}),children:"All target buffs"}),e(q,{children:e(F,{children:a==null?void 0:a.listFormulas(T.listing.buffs).map((r,d)=>{const l=a.compute(r),i=r.tag.name||r.tag.q;return c(g,{children:[c(C,{children:[i,": ",l.val]}),c(P,{children:[c(O,{expandIcon:e(A,{}),children:["debug for ",i]}),c(q,{children:["conds:"," ",JSON.stringify(l.meta.conds,void 0,2),e(C,{component:"pre",children:JSON.stringify(a.toDebug().compute(r),void 0,2)})]})]})]},`${i}${d}`)})})})]})]})}),e(yt,{})]})]})}const Mt=e(le,{variant:"rectangular",width:"100%",height:1e3});function qt(){const{database:t}=v(),{teamId:n}=we(),a=!n||!t.combos.keys.includes(n);return f.useEffect(()=>{a||t.combos.set(n,{lastEdit:Date.now()})},[n,t.combos,a]),a?e(Ie,{to:"/combos"}):e(g,{display:"flex",flexDirection:"column",gap:1,children:e(f.Suspense,{fallback:Mt,children:n&&e(Tt,{comboId:n})})})}function Tt({comboId:t}){const n=Z(),[a,o]=f.useState(0),s=f.useMemo(()=>({presetIndex:a,setPresetIndex:o}),[a,o]),r=I(t),{comboMetadata:d}=r,{params:{characterKey:l}}=Be({path:"/combos/:teamId/:characterKey",end:!1})??{params:{}},i=f.useMemo(()=>{const b=d.findIndex(x=>x&&x.characterKey===l);return b===-1?0:b},[d,l]),u=f.useMemo(()=>d[i],[d,i]),m=u==null?void 0:u.characterKey;f.useEffect(()=>{m&&m!==l&&n(`${m}`,{replace:!0})},[m,l,u,n]);const{t:h}=_(["charNames_gen","page_character"]);Ge(f.useMemo(()=>{const b=h(m?"charNames_gen:Character":"Combo Settings");return`${r.name} - ${b}`},[m,h,r.name]));const p=f.useMemo(()=>{if(!(!t||!r||!u))return{comboId:t,combo:r,comboMetadatum:u}},[u,r,t]);return e(K.Provider,{value:s,children:e(lt,{comboId:t,currentChar:m,children:c(g,{sx:{display:"flex",gap:1,flexDirection:"column",mx:1,mt:2},children:[e(M,{sx:{overflow:"visible",top:0,position:"sticky",zIndex:100},children:e(it,{comboId:t,charKey:m})}),e(g,{children:p&&e(J.Provider,{value:p,children:e(kt,{})})})]})})})}function kt(){const{comboMetadatum:{characterKey:t}}=k(),n=he(t),a=f.useMemo(()=>n&&{character:n},[n]);return a?e($e.Provider,{value:a,children:e(Ke,{children:e(V,{path:":characterKey",children:e(V,{path:"*",index:!0,element:e(St,{})})})})}):e(le,{variant:"rectangular",width:"100%",height:1e3})}export{qt as default};
