import{N as v,n as e,E as g,m as _,ak as Z,U as ee,V as te,r as m,q as l,ac as xe,H as C,X as S,L as M,I as ae,at as w,W as ne,av as be,au as Ce,aY as ye,ap as N,aq as ve,aZ as Se,as as Me,ar as Te,Y as oe,F as re,S as se,ax as ke,ay as De,ab as T,aB as j,G as y,aa as R,aE as ce,aF as ie,aG as _e,aH as we,aI as Be,aJ as $e,$ as le,aK as Ie,aL as Ke,aM as V}from"./index-DIRSThOp.js";import{u as Ne,C as Pe,d as Oe,e as G,T as H,f as Ae,b as qe,c as Ee,a as We,t as de,N as Fe,I as Le,g as je,h as ze,j as ue,i as Je,D as Re,k as Ve,A as P,l as O,m as A,n as q,o as Ge}from"./util-DVcD4GWV.js";import{u as he,S as F,b as B,C as He,a as Xe}from"./CharacterEditor-nMR4NRma.js";import{d as Ye}from"./Close-xyCes9rF.js";import{C as z}from"./CardActionArea-BrCMf7Wc.js";import{C as L}from"./useForceUpdate-Ce-o1cJQ.js";import{s as Qe,t as Ue,b as X,w as Ze,c as et,l as tt,r as at}from"./index-C62tMbqD.js";import{u as nt}from"./useBoolState-BVDPDqn2.js";import{M as D,D as $}from"./DropdownButton-Cf9Zw7_D.js";import{D as ot,a as rt}from"./DeleteForever-I94wLgRd.js";import"./index-Dm1c70M8.js";function I(t){const{database:n}=v();return Ne(n.combos,t)}function st({comboId:t}){const n=I(t);return e(g,{display:"flex",flexDirection:"column",gap:1,children:n.comboMetadata.map((a,o)=>e(ct,{comboMetadataIndex:o,comboId:t},`${o}_${a==null?void 0:a.characterKey}`))})}function ct({comboMetadataIndex:t,comboId:n}){var r;const{database:a}=v(),o=I(n);function s(u){if(u===""){a.teams.set(n,i=>i.loadoutMetadata[t]=void 0);return}a.chars.getOrCreate(u);const d=o.comboMetadata.findIndex(i=>(i==null?void 0:i.characterKey)===u);if(d===-1)a.combos.set(n,i=>{i.comboMetadata[t]={characterKey:u}});else{if(d===t)return;const i=o.comboMetadata[d],c=o.comboMetadata[t];a.combos.set(n,h=>{h.comboMetadata[t]=i,h.comboMetadata[d]=c})}}return e(Pe,{charKey:((r=o.comboMetadata[t])==null?void 0:r.characterKey)??"",setCharKey:s})}function it({comboId:t,charKey:n}){const{t:a}=_("page_team"),o=Z(),{database:s}=v(),r=I(t),u=ee(),d=te(u.breakpoints.down("md")),[i,c]=m.useState(!1),h=f=>{s.combos.set(t,{name:f})},p=f=>{s.combos.set(t,{description:f})};return l(g,{sx:()=>({borderBottom:"1px rgb(200,200,200,0.3) solid","& .MuiTab-root:hover":{transition:"background-color 0.25s ease",backgroundColor:"rgba(255,255,255,0.1)"},"& .Mui-selected":{color:"white !important"},"& .MuiTabs-indicator":{height:"4px",backgroundColor:"rgb(200,200,200,0.5)"}}),children:[e(z,{onClick:()=>c(!0),children:e(xe,{placement:"top",title:l(g,{children:[l(g,{sx:{display:"flex",color:"info.light",gap:1},children:[e(Oe,{}),e(C,{children:e("strong",{children:a`team.editNameDesc`})})]}),!!r.description&&e(C,{children:r.description})]}),children:e(S,{sx:{display:"flex",justifyContent:"center","&:hover":{color:"info.light"}},children:l(C,{variant:"h5",sx:{display:"flex",gap:1,alignItems:"center",justifyContent:"center",textShadow:"#000 0 0 10px !important"},children:[e(G,{}),r.name]})})})}),e(ne,{open:i,onClose:()=>c(!1),children:l(M,{children:[e(L,{title:a`team.editNameDesc`,avatar:e(G,{}),titleTypographyProps:{variant:"h6"},action:e(ae,{onClick:()=>c(!1),children:e(Ye,{})})}),e(w,{}),e(S,{children:l(g,{display:"flex",flexDirection:"column",gap:2,sx:{mt:2},children:[e(H,{label:a`team.name`,value:r.name,onChange:f=>h(f),autoFocus:!0}),e(H,{label:a`team.desc`,value:r.description,onChange:f=>p(f),multiline:!0,minRows:4}),e(st,{comboId:t})]})})]})}),e(w,{}),e(Ce,{variant:"fullWidth",value:n??"team",orientation:d?"vertical":"horizontal",children:r.comboMetadata.map((f,x)=>{const b=f==null?void 0:f.characterKey;return e(be,{icon:e(Ae,{}),iconPosition:"start",value:b??x,disabled:!f,label:b?e(C,{children:a(`charNames_gen:${b}`)}):`Character ${x+1}`,onClick:()=>b&&o(`/combos/${t}/${b}`)},x)})})]})}const J=m.createContext({});function k(){return m.useContext(J)}const K=m.createContext({presetIndex:0,setPresetIndex:()=>{}});function lt({comboId:t,currentChar:n,children:a}){const o=I(t),{presetIndex:s}=m.useContext(K),r=E(o.comboMetadata[0]),u=E(o.comboMetadata[1]),d=E(o.comboMetadata[2]),i=E(o.comboMetadata[3]),c=m.useMemo(()=>Qe([...Ue(o.comboMetadata.map((p,f)=>p===void 0?void 0:ye[f]).filter(p=>!!p)),...r?W(r):[],...u?W(u):[],...d?W(d):[],...i?W(i):[],N.common.lvl.add(80),N.common.res.add(.1),N.common.isBroken.add(0),N.common.maxToughness.add(100),ve.common.critMode.add("avg"),...o.conditionals.flatMap(({sheet:p,src:f,dst:x,condKey:b,condValues:pe})=>pe.flatMap((fe,ge)=>X(`preset${ge}`,Se(p,f,x)(b,fe)))),...o.bonusStats.flatMap(({tag:p,values:f})=>f.flatMap((x,b)=>X(`preset${b}`,{tag:{...p},value:Me(x)})))]),[o,r,u,d,i]),h=m.useMemo(()=>(n&&(c==null?void 0:c.withTag({src:n,dst:n,preset:`preset${s}`})))??null,[c,n,s]);return e(Te.Provider,{value:h,children:a})}function E(t){const n=he(t==null?void 0:t.characterKey),a=qe(t==null?void 0:t.buildId),o=Ee(a==null?void 0:a.lightConeId),s=We(a==null?void 0:a.relicIds);return m.useMemo(()=>({character:n,lightCone:o,relics:s}),[n,o,s])}function W({character:t,lightCone:n,relics:a}){return t?Ze(t.key,...et(t),...tt(n),...at(Object.values(a).filter(o=>!!o).map(o=>({set:o.setKey,stats:[...o.substats.filter(({key:s})=>s!=="").map(s=>({key:s.key,value:s.accurateValue})),{key:o.mainStatKey,value:o.mainStatVal}]})))):[]}function dt(){const[t,n,a]=nt();return l(re,{children:[e(oe,{onClick:n,children:"Bonus Stats"}),e(ut,{open:t,onClose:a})]})}function ut({open:t,onClose:n}){const{database:a}=v(),{presetIndex:o}=m.useContext(K),{comboId:s,combo:{bonusStats:r},comboMetadatum:{characterKey:u}}=k(),d=i=>{const c=ht(i,u);a.combos.setBonusStat(s,c,0,o)};return e(ne,{open:t,onClose:n,children:l(M,{children:[e(L,{title:"Bonus Stats"}),e(w,{}),e(S,{children:l(F,{spacing:1,children:[r.map(({tag:i,values:c},h)=>e(ft,{tag:i,value:c[o],setValue:p=>a.combos.setBonusStat(s,i,p,o),onDelete:()=>a.combos.setBonusStat(s,i,0,o),setTag:p=>a.combos.setBonusStat(s,p,0,o)},JSON.stringify(i)+h)),e(pt,{onSelect:d})]})})]})})}function ht(t,n){return{src:n,dst:n,et:"own",q:t,qt:"premod",sheet:"agg"}}const mt=["hp","hp_","def","def_","atk","atk_","spd","spd_","dmg_","enerRegen_","brEffect_","crit_","crit_dmg_","eff_","eff_res_","heal_"];function pt({tag:t={},onSelect:n}){var a;return e($,{title:(t&&((a=de.subset(t)[0])==null?void 0:a.title))??"Add Bonus Stat",children:mt.map(o=>e(D,{onClick:()=>n(o),children:o},o))})}function ft({tag:t,setTag:n,value:a,setValue:o,onDelete:s}){var u;const r=(u=t.name||t.q)==null?void 0:u.endsWith("_");return e(M,{bgt:"light",children:l(S,{sx:{display:"flex",gap:1,justifyContent:"space-around"},children:[e(se,{sx:{m:"auto"},children:t.q}),t.q==="dmg_"&&e(gt,{tag:t,setElementalType:d=>{const{elementalType:i,...c}=t;n(d?{...c,elementalType:d}:c)}}),e(Fe,{float:!0,value:a,sx:{flexBasis:150,flexGrow:1,height:"100%"},onChange:o,placeholder:"Stat Value",size:"small",inputProps:{sx:{textAlign:"right"}},InputProps:{endAdornment:l(Le,{position:"end",sx:{ml:0},children:[r?"%":void 0," ",e(ae,{"aria-label":"Delete Bonus Stat",onClick:s,edge:"end",children:e(ot,{fontSize:"small"})})]})}})]})})}function gt({tag:t,setElementalType:n}){return l($,{title:t.elementalType??"No Element",children:[e(D,{onClick:()=>n(null),children:"No Element"}),ke.map(a=>e(D,{onClick:()=>n(a),children:a},a))]})}function Y({tag:t}){var n;return e(De,{color:je(t),children:((n=de.subset(t)[0])==null?void 0:n.title)||t.name||t.q})}function me({optTarget:t,setOptTarget:n,buttonProps:a={}}){const{t:o}=_("optimize"),s=B();return e($,{title:l(g,{sx:{display:"flex",gap:1},children:[o("optTarget"),t?e(Y,{tag:t.tag}):null]}),...a,children:s==null?void 0:s.listFormulas(T.listing.formulas).map((r,u)=>l(D,{onClick:()=>n(r),children:[e(rt,{children:e(Y,{tag:r.tag})}),e(g,{sx:{display:"flex",gap:1,ml:1},children:ze(r.tag).map(d=>e(se,{children:d},d))})]},`${u}_${r.tag.sheet||r.tag.q}_${r.tag.name}`))})}function xt(){const{database:t}=v(),{combo:n,comboId:a}=k();return l(M,{children:[e(L,{title:"Combo Editor"}),e(w,{}),l(S,{sx:{display:"flex",gap:1,overflowX:"auto"},children:[n.frames.map((o,s)=>e(bt,{read:o,index:s,setTarget:r=>t.combos.set(a,u=>{const d=structuredClone(u.frames);d[s]=r,u.frames=d})},s+JSON.stringify(o??{}))),e(g,{sx:{flexShrink:0},children:e(me,{setOptTarget:o=>t.combos.set(a,s=>{s.frames=[...s.frames,o]})})})]})]})}function bt({read:t,index:n,setTarget:a}){const{presetIndex:o,setPresetIndex:s}=m.useContext(K);return l(M,{bgt:"light",sx:r=>({flexShrink:0,outline:o===n?`solid ${r.palette.success.main}`:void 0}),children:[e(ue,{condition:o!==n,wrapper:r=>e(z,{onClick:()=>s(n),children:r}),children:e(L,{title:`Combo ${n+1}`})}),e(w,{}),e(S,{children:e(me,{optTarget:t,setOptTarget:a})})]})}const Ct={xs:12,sm:6,md:4};function yt(){const{comboMetadatum:{characterKey:t}}=k(),n=B();_("sheet_gen");const{database:a}=v(),o=["basic","skill","ult","talent"],s=ee(),r=te(s.breakpoints.up("lg")),u=Je[t],d=(n==null?void 0:n.compute(T.char.eidolon).val)??0,i=m.useMemo(()=>u&&j(1,ce).map(c=>{const h=u[`eidolon${c}`];return h?e(Q,{talentKey:`eidolon${c}`,sheetElement:h,onClickTitle:()=>a.chars.set(t,{eidolon:c===d?c-1:c})}):null}),[t,u,a.chars,d]);if(!(!u||!n))return e(re,{children:l(y,{container:!0,spacing:1,children:[r&&l(y,{item:!0,xs:12,md:12,lg:3,sx:{display:"flex",flexDirection:"column",gap:1},children:[e(U,{}),i&&i.map((c,h)=>e(g,{sx:{opacity:d>=h+1?1:.5},children:c},h))]}),e(y,{item:!0,xs:12,md:12,lg:9,container:!0,spacing:1,children:o.map(c=>{const h=u[c];return h?e(y,{item:!0,...Ct,children:e(Q,{talentKey:c,sheetElement:h})},c):null})}),!r&&e(y,{item:!0,xs:12,md:12,lg:3,container:!0,spacing:1,children:e(y,{item:!0,xs:12,children:e(U,{})})})]})})}function Q({sheetElement:t,talentKey:n,onClickTitle:a}){const{comboMetadatum:{characterKey:o}}=k(),s=m.useCallback(h=>e(z,{onClick:a,children:h}),[a]);let r=null;r=null,Ve(n)&&(r=e(vt,{talentKey:n,dropDownButtonProps:{sx:{borderRadius:0}},setTalent:h=>i.chars.set(o,p=>{p[n]=h})}));const{comboId:u}=m.useContext(J),{presetIndex:d}=m.useContext(K),{database:i}=v(),c=m.useCallback((h,p,f,x)=>i.combos.setConditional(u,p,h,o,f,x,d),[u,i.combos,o,d]);return l(M,{bgt:"light",sx:{height:"100%"},children:[r,l(S,{children:[e(ue,{condition:!!a,wrapper:s,children:l(y,{container:!0,sx:{flexWrap:"nowrap"},children:[e(y,{item:!0,children:e(g,{component:R?R:"img",src:t==null?void 0:t.img,sx:{width:60,height:"auto"}})}),l(y,{item:!0,flexGrow:1,sx:{pl:1},children:[e(C,{variant:"h6",children:t==null?void 0:t.title}),t.subtitle&&e(C,{variant:"subtitle1",children:t.subtitle})]})]})}),t.documents.map((h,p)=>e(Re,{document:h,collapse:!0,setConditional:c},p))]})]})}function U(){const{t}=_("sheet_gen"),n=B(),{comboMetadatum:{characterKey:a}}=k(),{database:o}=v();if(!n)return null;const s=n.compute(T.char.eidolon).val;return e($,{fullWidth:!0,title:l("span",{children:[t("eidolonLvl")," ",s]}),color:"primary",children:j(0,ce).map(r=>e(D,{selected:s===r,disabled:s===r,onClick:()=>o.chars.set(a,{eidolon:r}),children:l("span",{children:[t("eidolonLvl")," ",r]})},r))})}function vt({talentKey:t,setTalent:n,dropDownButtonProps:a}){const{t:o}=_("sheet_gen"),{character:s}=ie(),r=B();if(!r||!s)return null;const u=0,d=r.compute(T.char[t]).val,i=r.compute(T.char.ascension).val;return e($,{fullWidth:!0,title:l("span",{children:[o("lvl")," ",d]}),color:"primary",...a,children:j(1,_e[i]).map(c=>e(D,{selected:s[t]===c,disabled:s[t]===c,onClick:()=>n(c),children:l("span",{children:[o("lvl")," ",c+u]})},c))})}function St(){const{comboMetadatum:{characterKey:t}}=k(),{character:n}=ie(),a=B(),[o,s]=m.useState(void 0);return l(g,{children:[e(He,{characterKey:o,onClose:()=>s(void 0)}),e(Xe,{character:n}),l(F,{gap:1,pt:1,children:[e(xt,{}),e(M,{bgt:"dark",children:l(S,{children:[e(oe,{disabled:!t,onClick:()=>t&&s(t),children:"Edit Character"}),e(dt,{}),l(P,{children:[e(O,{expandIcon:e(A,{}),children:"All target listings"}),e(q,{children:e(F,{children:a==null?void 0:a.listFormulas(T.listing.formulas).map((r,u)=>{const d=a.compute(r),i=r.tag.name||r.tag.q;return l(g,{children:[l(C,{children:[i,": ",d.val]}),l(P,{children:[l(O,{expandIcon:e(A,{}),children:["debug for ",i]}),l(q,{children:["conds:"," ",JSON.stringify(d.meta.conds,void 0,2),e(C,{component:"pre",children:JSON.stringify(a.toDebug().compute(r),void 0,2)})]})]})]},`${i}${u}`)})})})]}),l(P,{children:[e(O,{expandIcon:e(A,{}),children:"All target buffs"}),e(q,{children:e(F,{children:a==null?void 0:a.listFormulas(T.listing.buffs).map((r,u)=>{const d=a.compute(r),i=r.tag.name||r.tag.q;return l(g,{children:[l(C,{children:[i,": ",d.val]}),l(P,{children:[l(O,{expandIcon:e(A,{}),children:["debug for ",i]}),l(q,{children:["conds:"," ",JSON.stringify(d.meta.conds,void 0,2),e(C,{component:"pre",children:JSON.stringify(a.toDebug().compute(r),void 0,2)})]})]})]},`${i}${u}`)})})})]})]})}),e(yt,{})]})]})}const Mt=e(le,{variant:"rectangular",width:"100%",height:1e3});function qt(){const{database:t}=v(),{teamId:n}=we(),a=!n||!t.combos.keys.includes(n);return m.useEffect(()=>{a||t.combos.set(n,{lastEdit:Date.now()})},[n,t.combos,a]),a?e(Ie,{to:"/combos"}):e(g,{display:"flex",flexDirection:"column",gap:1,children:e(m.Suspense,{fallback:Mt,children:n&&e(Tt,{comboId:n})})})}function Tt({comboId:t}){const n=Z(),[a,o]=m.useState(0),s=m.useMemo(()=>({presetIndex:a,setPresetIndex:o}),[a,o]),r=I(t),{comboMetadata:u}=r,{params:{characterKey:d}}=Be({path:"/combos/:teamId/:characterKey",end:!1})??{params:{}},i=m.useMemo(()=>{const x=u.findIndex(b=>b&&b.characterKey===d);return x===-1?0:x},[u,d]),c=m.useMemo(()=>u[i],[u,i]),h=c==null?void 0:c.characterKey;m.useEffect(()=>{h&&h!==d&&n(`${h}`,{replace:!0})},[h,d,c,n]);const{t:p}=_(["charNames_gen","page_character"]);Ge(m.useMemo(()=>{const x=p(h?"charNames_gen:Character":"Combo Settings");return`${r.name} - ${x}`},[h,p,r.name]));const f=m.useMemo(()=>{if(!(!t||!r||!c))return{comboId:t,combo:r,comboMetadatum:c}},[c,r,t]);return e(K.Provider,{value:s,children:e(lt,{comboId:t,currentChar:h,children:l(g,{sx:{display:"flex",gap:1,flexDirection:"column",mx:1,mt:2},children:[e(M,{sx:{overflow:"visible",top:0,position:"sticky",zIndex:100},children:e(it,{comboId:t,charKey:h})}),e(g,{children:f&&e(J.Provider,{value:f,children:e(kt,{})})})]})})})}function kt(){const{comboMetadatum:{characterKey:t}}=k(),n=he(t),a=m.useMemo(()=>n&&{character:n},[n]);return a?e($e.Provider,{value:a,children:e(Ke,{children:e(V,{path:":characterKey",children:e(V,{path:"*",index:!0,element:e(St,{})})})})}):e(le,{variant:"rectangular",width:"100%",height:1e3})}export{qt as default};
