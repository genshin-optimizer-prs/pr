import{N as y,n as e,E as g,m as T,ak as de,U as ue,V as he,r as p,q as l,ac as ze,H as x,X as k,L as v,I as Z,aq as D,W as me,as as Oe,ar as $e,aK as Pe,am as j,an as Ke,aL as Ne,ap as We,ao as Le,Y as O,F as pe,S as fe,au as Ae,av as Ee,ab as w,ay as X,G as S,aa as ne,aB as ge,aC as Ce,aD as qe,B as je,aw as Ve,ax as Ge,aE as Re,aF as Je,aG as Fe,$ as be,aH as He,aI as Xe,aJ as ae}from"./index-BNUVtFgu.js";import{u as xe,C as Ue,d as Qe,e as oe,T as re,f as Ye,a as Ze,b as et,c as tt,t as ye,N as ve,I as ke,g as nt,h as at,k as Se,j as ot,D as rt,l as st,S as ct,i as it,B as lt,M as dt,L as ut,A as V,m as G,n as R,o as J,p as ht}from"./TrendingUp-CKjL-2_G.js";import{u as Te,S as L,b as $,C as mt,a as pt}from"./CharacterEditor-CVyrAqQt.js";import{d as Me}from"./Close-CtYFUzYT.js";import{C as ee}from"./CardActionArea-Bw59FHrZ.js";import{C as P}from"./useForceUpdate-Cdwt2_AT.js";import{s as ft,t as gt,b as se,w as Ct,c as bt,l as xt,r as yt}from"./index-q41FP7U9.js";import{u as vt}from"./useBoolState-DR3cjVQy.js";import{M as B,D as K}from"./DropdownButton-BdP4lxDm.js";import{D as De,a as kt}from"./LocationAutocomplete-CeXLGtdU.js";import{I as St}from"./InfoTooltip-Bv6OlKh6.js";import"./index-R3yLrV8M.js";function A(t){const{database:n}=y();return xe(n.combos,t)}function Tt({comboId:t}){const n=A(t);return e(g,{display:"flex",flexDirection:"column",gap:1,children:n.comboMetadata.map((a,o)=>e(Mt,{comboMetadataIndex:o,comboId:t},`${o}_${a==null?void 0:a.characterKey}`))})}function Mt({comboMetadataIndex:t,comboId:n}){var r;const{database:a}=y(),o=A(n);function s(u){if(u===""){a.teams.set(n,h=>h.loadoutMetadata[t]=void 0);return}a.chars.getOrCreate(u);const d=o.comboMetadata.findIndex(h=>(h==null?void 0:h.characterKey)===u);if(d===-1)a.combos.set(n,h=>{h.comboMetadata[t]={characterKey:u}});else{if(d===t)return;const h=o.comboMetadata[d],c=o.comboMetadata[t];a.combos.set(n,i=>{i.comboMetadata[t]=h,i.comboMetadata[d]=c})}}return e(Ue,{charKey:((r=o.comboMetadata[t])==null?void 0:r.characterKey)??"",setCharKey:s})}function Dt({comboId:t,charKey:n}){const{t:a}=T("page_team"),o=de(),{database:s}=y(),r=A(t),u=ue(),d=he(u.breakpoints.down("md")),[h,c]=p.useState(!1),i=f=>{s.combos.set(t,{name:f})},m=f=>{s.combos.set(t,{description:f})};return l(g,{sx:()=>({borderBottom:"1px rgb(200,200,200,0.3) solid","& .MuiTab-root:hover":{transition:"background-color 0.25s ease",backgroundColor:"rgba(255,255,255,0.1)"},"& .Mui-selected":{color:"white !important"},"& .MuiTabs-indicator":{height:"4px",backgroundColor:"rgb(200,200,200,0.5)"}}),children:[e(ee,{onClick:()=>c(!0),children:e(ze,{placement:"top",title:l(g,{children:[l(g,{sx:{display:"flex",color:"info.light",gap:1},children:[e(Qe,{}),e(x,{children:e("strong",{children:a`team.editNameDesc`})})]}),!!r.description&&e(x,{children:r.description})]}),children:e(k,{sx:{display:"flex",justifyContent:"center","&:hover":{color:"info.light"}},children:l(x,{variant:"h5",sx:{display:"flex",gap:1,alignItems:"center",justifyContent:"center",textShadow:"#000 0 0 10px !important"},children:[e(oe,{}),r.name]})})})}),e(me,{open:h,onClose:()=>c(!1),children:l(v,{children:[e(P,{title:a`team.editNameDesc`,avatar:e(oe,{}),titleTypographyProps:{variant:"h6"},action:e(Z,{onClick:()=>c(!1),children:e(Me,{})})}),e(D,{}),e(k,{children:l(g,{display:"flex",flexDirection:"column",gap:2,sx:{mt:2},children:[e(re,{label:a`team.name`,value:r.name,onChange:f=>i(f),autoFocus:!0}),e(re,{label:a`team.desc`,value:r.description,onChange:f=>m(f),multiline:!0,minRows:4}),e(Tt,{comboId:t})]})})]})}),e(D,{}),e($e,{variant:"fullWidth",value:n??"team",orientation:d?"vertical":"horizontal",children:r.comboMetadata.map((f,b)=>{const C=f==null?void 0:f.characterKey;return e(Oe,{icon:e(Ye,{}),iconPosition:"start",value:C??b,disabled:!f,label:C?e(x,{children:a(`charNames_gen:${C}`)}):`Character ${b+1}`,onClick:()=>C&&o(`/combos/${t}/${C}`)},b)})})]})}const E=p.createContext({});function _(){return p.useContext(E)}const q=p.createContext({presetIndex:0,setPresetIndex:()=>{}});function wt({comboId:t,currentChar:n,children:a}){const o=A(t),{presetIndex:s}=p.useContext(q),r=F(o.comboMetadata[0]),u=F(o.comboMetadata[1]),d=F(o.comboMetadata[2]),h=F(o.comboMetadata[3]),c=p.useMemo(()=>ft([...gt(o.comboMetadata.map((m,f)=>m===void 0?void 0:Pe[f]).filter(m=>!!m)),...r?H(r):[],...u?H(u):[],...d?H(d):[],...h?H(h):[],j.common.lvl.add(80),j.common.res.add(.1),j.common.isBroken.add(0),j.common.maxToughness.add(100),Ke.common.critMode.add("avg"),...o.conditionals.flatMap(({sheet:m,src:f,dst:b,condKey:C,condValues:N})=>N.flatMap((M,Q)=>se(`preset${Q}`,Ne(m,f,b)(C,M)))),...o.bonusStats.flatMap(({tag:m,values:f})=>f.flatMap((b,C)=>se(`preset${C}`,{tag:{...m},value:We(b)})))]),[o,r,u,d,h]),i=p.useMemo(()=>(n&&(c==null?void 0:c.withTag({src:n,dst:n,preset:`preset${s}`})))??null,[c,n,s]);return e(Le.Provider,{value:i,children:a})}function F(t){const n=Te(t==null?void 0:t.characterKey),a=Ze(t==null?void 0:t.buildId),o=et(a==null?void 0:a.lightConeId),s=tt(a==null?void 0:a.relicIds);return p.useMemo(()=>({character:n,lightCone:o,relics:s}),[n,o,s])}function H({character:t,lightCone:n,relics:a}){return t?Ct(t.key,...bt(t),...xt(n),...yt(Object.values(a).filter(o=>!!o).map(o=>({set:o.setKey,stats:[...o.substats.filter(({key:s})=>s!=="").map(s=>({key:s.key,value:s.accurateValue})),{key:o.mainStatKey,value:o.mainStatVal}]})))):[]}function Bt(){const[t,n,a]=vt();return l(pe,{children:[e(O,{onClick:n,children:"Bonus Stats"}),e(_t,{open:t,onClose:a})]})}function _t({open:t,onClose:n}){const{database:a}=y(),{presetIndex:o}=p.useContext(q),{comboId:s,combo:{bonusStats:r},comboMetadatum:{characterKey:u}}=_(),d=h=>{const c=It(h,u);a.combos.setBonusStat(s,c,0,o)};return e(me,{open:t,onClose:n,children:l(v,{children:[e(P,{title:"Bonus Stats"}),e(D,{}),e(k,{children:l(L,{spacing:1,children:[r.map(({tag:h,values:c},i)=>e($t,{tag:h,value:c[o],setValue:m=>a.combos.setBonusStat(s,h,m,o),onDelete:()=>a.combos.setBonusStat(s,h,0,o),setTag:m=>a.combos.setBonusStat(s,m,0,o)},JSON.stringify(h)+i)),e(Ot,{onSelect:d})]})})]})})}function It(t,n){return{src:n,dst:n,et:"own",q:t,qt:"premod",sheet:"agg"}}const zt=["hp","hp_","def","def_","atk","atk_","spd","spd_","dmg_","enerRegen_","brEffect_","crit_","crit_dmg_","eff_","eff_res_","heal_"];function Ot({tag:t={},onSelect:n}){var a;return e(K,{title:(t&&((a=ye.subset(t)[0])==null?void 0:a.title))??"Add Bonus Stat",children:zt.map(o=>e(B,{onClick:()=>n(o),children:o},o))})}function $t({tag:t,setTag:n,value:a,setValue:o,onDelete:s}){var u;const r=(u=t.name||t.q)==null?void 0:u.endsWith("_");return e(v,{bgt:"light",children:l(k,{sx:{display:"flex",gap:1,justifyContent:"space-around"},children:[e(fe,{sx:{m:"auto"},children:t.q}),t.q==="dmg_"&&e(Pt,{tag:t,setElementalType:d=>{const{elementalType:h,...c}=t;n(d?{...c,elementalType:d}:c)}}),e(ve,{float:!0,value:a,sx:{flexBasis:150,flexGrow:1,height:"100%"},onChange:o,placeholder:"Stat Value",size:"small",inputProps:{sx:{textAlign:"right"}},InputProps:{endAdornment:l(ke,{position:"end",sx:{ml:0},children:[r?"%":void 0," ",e(Z,{"aria-label":"Delete Bonus Stat",onClick:s,edge:"end",children:e(De,{fontSize:"small"})})]})}})]})})}function Pt({tag:t,setElementalType:n}){return l(K,{title:t.elementalType??"No Element",children:[e(B,{onClick:()=>n(null),children:"No Element"}),Ae.map(a=>e(B,{onClick:()=>n(a),children:a},a))]})}function ce({tag:t}){var n;return e(Ee,{color:nt(t),children:((n=ye.subset(t)[0])==null?void 0:n.title)||t.name||t.q})}function U({optTarget:t,setOptTarget:n,buttonProps:a={}}){const{t:o}=T("optimize"),s=$();return e(K,{title:l(g,{sx:{display:"flex",gap:1},children:[o("optTarget"),t?e(ce,{tag:t.tag}):null]}),...a,children:s==null?void 0:s.listFormulas(w.listing.formulas).map((r,u)=>l(B,{onClick:()=>n(r),children:[e(kt,{children:e(ce,{tag:r.tag})}),e(g,{sx:{display:"flex",gap:1,ml:1},children:at(r.tag).map(d=>e(fe,{children:d},d))})]},`${u}_${r.tag.sheet||r.tag.q}_${r.tag.name}`))})}function Kt(){const{database:t}=y(),{combo:n,comboId:a}=_();return l(v,{sx:{overflow:"visible",top:137,position:"sticky",zIndex:101},children:[e(P,{title:"Combo Editor"}),e(D,{}),l(k,{sx:{display:"flex",gap:1,overflowX:"auto"},children:[n.frames.map((o,s)=>e(Nt,{read:o,index:s,setTarget:r=>t.combos.set(a,u=>{const d=structuredClone(u.frames);d[s]=r,u.frames=d})},s+JSON.stringify(o??{}))),e(g,{sx:{flexShrink:0},children:e(U,{setOptTarget:o=>t.combos.set(a,s=>{s.frames=[...s.frames,o]})})})]})]})}function Nt({read:t,index:n,setTarget:a}){const{presetIndex:o,setPresetIndex:s}=p.useContext(q);return l(v,{bgt:"light",sx:r=>({flexShrink:0,outline:o===n?`solid ${r.palette.success.main}`:void 0}),children:[e(Se,{condition:o!==n,wrapper:r=>e(ee,{onClick:()=>s(n),children:r}),children:e(P,{title:`Combo ${n+1}`})}),e(D,{}),e(k,{children:e(U,{optTarget:t,setOptTarget:a})})]})}const Wt={xs:12,sm:6,md:4};function Lt(){const{comboMetadatum:{characterKey:t}}=_(),n=$(),{database:a}=y(),o=["basic","skill","ult","talent"],s=ue(),r=he(s.breakpoints.up("lg")),u=ot[t],d=(n==null?void 0:n.compute(w.char.eidolon).val)??0,h=p.useMemo(()=>u&&X(1,ge).map(c=>{const i=u[`eidolon${c}`];return i?e(ie,{talentKey:`eidolon${c}`,sheetElement:i,onClickTitle:()=>a.chars.set(t,{eidolon:c===d?c-1:c})}):null}),[t,u,a.chars,d]);if(!(!u||!n))return e(pe,{children:l(S,{container:!0,spacing:1,children:[r&&l(S,{item:!0,xs:12,md:12,lg:3,sx:{display:"flex",flexDirection:"column",gap:1},children:[e(le,{}),h&&h.map((c,i)=>e(g,{sx:{opacity:d>=i+1?1:.5},children:c},i))]}),e(S,{item:!0,xs:12,md:12,lg:9,container:!0,spacing:1,children:o.map(c=>{const i=u[c];return i?e(S,{item:!0,...Wt,children:e(ie,{talentKey:c,sheetElement:i})},c):null})}),!r&&e(S,{item:!0,xs:12,md:12,lg:3,container:!0,spacing:1,children:e(S,{item:!0,xs:12,children:e(le,{})})})]})})}function ie({sheetElement:t,talentKey:n,onClickTitle:a}){const{comboMetadatum:{characterKey:o}}=_(),s=p.useCallback(i=>e(ee,{onClick:a,children:i}),[a]);let r=null;r=null,st(n)&&(r=e(At,{talentKey:n,dropDownButtonProps:{sx:{borderRadius:0}},setTalent:i=>h.chars.set(o,m=>{m[n]=i})}));const{comboId:u}=p.useContext(E),{presetIndex:d}=p.useContext(q),{database:h}=y(),c=p.useCallback((i,m,f,b)=>h.combos.setConditional(u,m,i,o,f,b,d),[u,h.combos,o,d]);return l(v,{bgt:"light",sx:{height:"100%"},children:[r,l(k,{children:[e(Se,{condition:!!a,wrapper:s,children:l(S,{container:!0,sx:{flexWrap:"nowrap"},children:[e(S,{item:!0,children:e(g,{component:ne?ne:"img",src:t==null?void 0:t.img,sx:{width:60,height:"auto"}})}),l(S,{item:!0,flexGrow:1,sx:{pl:1},children:[e(x,{variant:"h6",children:t==null?void 0:t.title}),t.subtitle&&e(x,{variant:"subtitle1",children:t.subtitle})]})]})}),t.documents.map((i,m)=>e(rt,{document:i,collapse:!0,setConditional:c},m))]})]})}function le(){const{t}=T("sheet_gen"),n=$(),{comboMetadatum:{characterKey:a}}=_(),{database:o}=y();if(!n)return null;const s=n.compute(w.char.eidolon).val;return e(K,{fullWidth:!0,title:l("span",{children:[t("eidolonLvl")," ",s]}),color:"primary",children:X(0,ge).map(r=>e(B,{selected:s===r,disabled:s===r,onClick:()=>o.chars.set(a,{eidolon:r}),children:l("span",{children:[t("eidolonLvl")," ",r]})},r))})}function At({talentKey:t,setTalent:n,dropDownButtonProps:a}){const{t:o}=T("sheet_gen"),{character:s}=Ce(),r=$();if(!r||!s)return null;const u=0,d=r.compute(w.char[t]).val,h=r.compute(w.char.ascension).val;return e(K,{fullWidth:!0,title:l("span",{children:[o("lvl")," ",d]}),color:"primary",...a,children:X(1,qe[h]).map(c=>e(B,{selected:s[t]===c,disabled:s[t]===c,onClick:()=>n(c),children:l("span",{children:[o("lvl")," ",c+u]})},c))})}const te=p.createContext({optConfigId:"",optConfig:{}});function Et({optConfigId:t,children:n}){const{database:a}=y(),o=xe(a.optConfigs,t),s=p.useMemo(()=>({optConfigId:t,optConfig:o}),[t,o]);return e(te.Provider,{value:s,children:n})}function qt({statFilters:t,setStatFilters:n,disabled:a=!1}){const o=p.useCallback((c,i)=>{const m=structuredClone(t);typeof i>"u"?m.push({read:c,value:0,isMax:!1,disabled:!1}):m[i].read=c,n(m)},[n,t]),s=p.useCallback(c=>{const i=structuredClone(t);i.splice(c,1),n(i)},[n,t]),r=p.useCallback((c,i)=>{const m=structuredClone(t);m[c].value=i,n(m)},[n,t]),u=p.useCallback((c,i)=>{const m=structuredClone(t);m[c].isMax=i,n(m)},[n,t]),d=p.useCallback((c,i)=>{const m=structuredClone(t);m[c].disabled=i,n(m)},[n,t]),h=p.useMemo(()=>t.map(({read:c,value:i,isMax:m,disabled:f})=>({read:c,value:i,isMax:m,disabled:f})),[t]);return l(g,{display:"flex",flexDirection:"column",gap:1,children:[h.map((c,i)=>e(jt,{statFilter:c,setTarget:m=>o(m,i),delTarget:()=>s(i),setTargetValue:m=>r(i,m),setTargetisMax:m=>u(i,m),setDisabled:m=>d(i,m),disabled:a},i+JSON.stringify(c))),e(U,{setOptTarget:c=>o(c)})]})}function jt({statFilter:t,setTarget:n,delTarget:a,setTargetValue:o,setTargetisMax:s,setDisabled:r,disabled:u}){var f;const{read:d,value:h,isMax:c,disabled:i}=t,m=(f=d.tag.name||d.tag.q)==null?void 0:f.endsWith("_");return l(g,{sx:{display:"flex",gap:1},children:[l(je,{sx:{"& .MuiButtonGroup-grouped":{minWidth:24},width:"100%",flexGrow:1},children:[e(O,{color:i?"secondary":"success",onClick:()=>r(!i),disabled:u,size:"small",children:i?e(Ve,{}):e(Ge,{})}),e(U,{optTarget:d,setOptTarget:n,buttonProps:{sx:{flexGrow:1},size:"small"}}),e(O,{onClick:()=>s(!c),size:"small",children:e("strong",{children:c?"<=":">="})})]}),e(ve,{float:!0,value:h,sx:{flexBasis:150,flexGrow:1,height:"100%"},disabled:u,onChange:o,placeholder:"Stat Value",size:"small",inputProps:{sx:{textAlign:"right"}},InputProps:{endAdornment:l(ke,{position:"end",sx:{ml:0},children:[m?"%":void 0," ",e(Z,{"aria-label":"Delete Stat Constraint",onClick:a,edge:"end",children:e(De,{fontSize:"small"})})]})}})]})}function Vt({disabled:t=!1}){const{t:n}=T("page_character_optimize"),{optConfigId:a,optConfig:{statFilters:o}}=p.useContext(te),{database:s}=y(),r=p.useCallback(u=>s.optConfigs.set(a,{statFilters:u}),[s,a]);return e(g,{children:l(v,{bgt:"light",children:[e(k,{sx:{display:"flex",gap:1,justifyContent:"space-between",flexDirection:"column"},children:l(g,{display:"flex",justifyContent:"space-between",children:[e(x,{sx:{fontWeight:"bold"},children:n`constraintFilter.title`}),e(St,{title:e(x,{children:n`constraintFilter.tooltip`})})]})}),e(D,{}),e(qt,{statFilters:o,setStatFilters:r,disabled:t})]})})}function Gt({numWorkers:t,setNumWorkers:n}){const{t:a}=T("optimize"),o=navigator.hardwareConcurrency||8;return e(K,{title:`${a("numWorkers")}: ${t}`,children:X(1,o).map(s=>e(B,{onClick:()=>n(s),children:a("workers",{count:s})},s))})}function Rt(){const{database:t}=y(),{comboMetadatum:n,comboId:a}=p.useContext(E),o=n.optConfigId,s=p.useCallback(()=>{o||t.combos.set(a,r=>{const u=r.comboMetadata.find(d=>(d==null?void 0:d.characterKey)===n.characterKey);if(u){const d=t.optConfigs.new();u.optConfigId=d}})},[a,n.characterKey,t,o]);return o?e(Et,{optConfigId:o,children:e(Jt,{})}):e(v,{children:e(P,{title:l("span",{children:["Optimize this combo for ",n.characterKey]}),action:e(O,{onClick:s,children:"Optimize"})})})}function Jt(){const{t}=T("optimize"),{database:n}=y(),a=$(),{combo:o,comboMetadatum:{characterKey:s}}=p.useContext(E),[r,u]=p.useState(8),[d,h]=p.useState(void 0),{optConfig:c}=p.useContext(te),i=p.useMemo(()=>n.relics.values.reduce((I,z)=>(I[z.slotKey].push(z),I),{head:[],hands:[],feet:[],body:[],sphere:[],rope:[]}),[n.relics.values]),m=Object.values(i).reduce((I,z)=>I*z.length,1),[f,b]=p.useState(void 0),[C,N]=p.useState(!1),M=p.useRef(()=>{});p.useEffect(()=>()=>M.current(),[]);const Q=p.useCallback(async()=>{if(!a)return;const I=new Promise(W=>M.current=W);h(void 0),N(!0);const z=(c.statFilters??[]).filter(({disabled:W})=>!W).map(({read:W,value:_e,isMax:Ie})=>({read:W,value:_e,isMax:Ie})),Y=new ct(s,a,o.frames,z,i,r,h);I.then(async()=>await Y.terminate());const Be=await Y.optimize();await Y.terminate(),M.current=()=>{},N(!1),b(Be[0])},[a,s,o,r,c.statFilters,i]),we=p.useCallback(()=>{M.current(),N(!1)},[M]);return l(v,{children:[e(P,{title:t("optimize"),action:l(g,{children:[e(Gt,{numWorkers:r,setNumWorkers:u}),e(O,{onClick:C?we:Q,color:C?"error":"primary",startIcon:C?e(Me,{}):e(it,{}),children:t(C?"cancel":"optimize")})]})}),e(D,{}),l(k,{children:[e(Vt,{}),l(L,{children:[d&&e(Ft,{progress:d,totalPermutations:m}),f&&l(g,{children:[l(x,{children:["Best: ",f.value]}),e(lt,{build:f.ids})]})]})]})]})}function Ft({progress:t,totalPermutations:n}){const{t:a}=T("optimize");return l(g,{children:[l(x,{children:[a("totalProgress"),": ",t.numBuildsComputed.toLocaleString()," /"," ",n.toLocaleString()]}),l(x,{children:[a("buildsKept"),": ",t.numBuildsKept.toLocaleString()," /"," ",dt.toLocaleString()]}),e(ut,{variant:"determinate",value:t.numBuildsComputed/n*100})]})}function Ht(){const{comboMetadatum:{characterKey:t}}=_(),{character:n}=Ce(),a=$(),[o,s]=p.useState(void 0);return l(g,{children:[e(mt,{characterKey:o,onClose:()=>s(void 0)}),e(pt,{character:n}),l(L,{gap:1,pt:1,children:[e(Kt,{}),e(v,{bgt:"dark",children:l(k,{children:[e(O,{disabled:!t,onClick:()=>t&&s(t),children:"Edit Character"}),e(Bt,{}),l(V,{children:[e(G,{expandIcon:e(R,{}),children:"All target listings"}),e(J,{children:e(L,{children:a==null?void 0:a.listFormulas(w.listing.formulas).map((r,u)=>{const d=a.compute(r),h=r.tag.name||r.tag.q;return l(g,{children:[l(x,{children:[h,": ",d.val]}),l(V,{children:[l(G,{expandIcon:e(R,{}),children:["debug for ",h]}),l(J,{children:["conds:"," ",JSON.stringify(d.meta.conds,void 0,2),e(x,{component:"pre",children:JSON.stringify(a.toDebug().compute(r),void 0,2)})]})]})]},`${h}${u}`)})})})]}),l(V,{children:[e(G,{expandIcon:e(R,{}),children:"All target buffs"}),e(J,{children:e(L,{children:a==null?void 0:a.listFormulas(w.listing.buffs).map((r,u)=>{const d=a.compute(r),h=r.tag.name||r.tag.q;return l(g,{children:[l(x,{children:[h,": ",d.val]}),l(V,{children:[l(G,{expandIcon:e(R,{}),children:["debug for ",h]}),l(J,{children:["conds:"," ",JSON.stringify(d.meta.conds,void 0,2),e(x,{component:"pre",children:JSON.stringify(a.toDebug().compute(r),void 0,2)})]})]})]},`${h}${u}`)})})})]})]})}),e(Lt,{}),e(Rt,{})]})]})}const Xt=e(be,{variant:"rectangular",width:"100%",height:1e3});function un(){const{database:t}=y(),{teamId:n}=Re(),a=!n||!t.combos.keys.includes(n);return p.useEffect(()=>{a||t.combos.set(n,{lastEdit:Date.now()})},[n,t.combos,a]),a?e(He,{to:"/combos"}):e(g,{display:"flex",flexDirection:"column",gap:1,children:e(p.Suspense,{fallback:Xt,children:n&&e(Ut,{comboId:n})})})}function Ut({comboId:t}){const n=de(),[a,o]=p.useState(0),s=p.useMemo(()=>({presetIndex:a,setPresetIndex:o}),[a,o]),r=A(t),{comboMetadata:u}=r,{params:{characterKey:d}}=Je({path:"/combos/:teamId/:characterKey",end:!1})??{params:{}},h=p.useMemo(()=>{const b=u.findIndex(C=>C&&C.characterKey===d);return b===-1?0:b},[u,d]),c=p.useMemo(()=>u[h],[u,h]),i=c==null?void 0:c.characterKey;p.useEffect(()=>{i&&i!==d&&n(`${i}`,{replace:!0})},[i,d,c,n]);const{t:m}=T(["charNames_gen","page_character"]);ht(p.useMemo(()=>{const b=m(i?"charNames_gen:Character":"Combo Settings");return`${r.name} - ${b}`},[i,m,r.name]));const f=p.useMemo(()=>{if(!(!t||!r||!c))return{comboId:t,combo:r,comboMetadatum:c}},[c,r,t]);return e(q.Provider,{value:s,children:e(wt,{comboId:t,currentChar:i,children:l(g,{sx:{display:"flex",gap:1,flexDirection:"column",mx:1,mt:2},children:[e(v,{sx:{overflow:"visible",top:0,position:"sticky",zIndex:100},children:e(Dt,{comboId:t,charKey:i})}),e(g,{children:f&&e(E.Provider,{value:f,children:e(Qt,{})})})]})})})}function Qt(){const{comboMetadatum:{characterKey:t}}=_(),n=Te(t),a=p.useMemo(()=>n&&{character:n},[n]);return a?e(Fe.Provider,{value:a,children:e(Xe,{children:e(ae,{path:":characterKey",children:e(ae,{path:"*",index:!0,element:e(Ht,{})})})})}):e(be,{variant:"rectangular",width:"100%",height:1e3})}export{un as default};
