import{a as Xe,g as He,al as re,s as Q,b as _,_ as L,am as ne,r as p,u as Qe,e as Ye,an as Ze,j as O,f as et,h as tt,l as at,d as rt,N as k,m as S,n as a,q as m,H as x,X as D,L as w,Z as nt,G as T,ao as ot,ap as E,aq as st,ar as it,as as lt,ak as Te,U as Se,V as _e,ac as ct,E as C,I as oe,at as H,W as De,au as dt,av as ce,Y as j,F as we,aw as A,S as Be,ax as ut,p as mt,i as ht,k as pt,ay as ft,ab as M,B as gt,az as bt,aA as Ct,aB as Y,aC as K,aD as vt,aa as de,aE as $e,aF as Me,aG as xt,aH as yt,aI as ue,aJ as kt,$ as Pe,aK as Tt,aL as St,aM as me}from"./index-BJwvpkBM.js";import{u as Z,a as Ie,b as _t,c as Dt,d as wt,e as te,T as he,f as Bt,C as $t,t as Le,N as ze,I as Ne,g as Mt,h as Pt,i as It,j as Lt,D as zt,k as Nt,A as U,l as V,m as G,n as F,o as Rt}from"./util-ZNGsUkj9.js";import{c as qt,u as Re,S as W,b as z,C as Ot,a as Wt}from"./CharacterEditor-xUvGc_Oh.js";import{s as jt,t as At,w as Kt,c as Et,l as Ut,r as Vt,a as Gt,d as Ft}from"./index-D4GWyoOv.js";import{d as qe}from"./Close-PXg9g64q.js";import{C as Oe}from"./CardActionArea-CvlzuLQB.js";import{C as We}from"./useForceUpdate-Bnzq9yf0.js";import{u as Jt}from"./useBoolState-UBwnvhN3.js";import{M as P,D as N}from"./DropdownButton-CLgPB5dW.js";import{D as je,a as Xt}from"./DeleteForever-CyU_aAC4.js";import{R as Ht}from"./RelicCard-DDYirh_D.js";import{I as Qt}from"./InfoTooltip-Bnb2mlOq.js";import"./index-N00VXk70.js";import"./LocationAutocomplete-D_eFnzdn.js";const Yt=qt(),Zt=Yt;function ea(e){return Xe("MuiLinearProgress",e)}He("MuiLinearProgress",["root","colorPrimary","colorSecondary","determinate","indeterminate","buffer","query","dashed","dashedColorPrimary","dashedColorSecondary","bar","barColorPrimary","barColorSecondary","bar1Indeterminate","bar1Determinate","bar1Buffer","bar2Indeterminate","bar2Buffer"]);const ta=["className","color","value","valueBuffer","variant"];let R=e=>e,pe,fe,ge,be,Ce,ve;const ae=4,aa=re(pe||(pe=R`
  0% {
    left: -35%;
    right: 100%;
  }

  60% {
    left: 100%;
    right: -90%;
  }

  100% {
    left: 100%;
    right: -90%;
  }
`)),ra=re(fe||(fe=R`
  0% {
    left: -200%;
    right: 100%;
  }

  60% {
    left: 107%;
    right: -8%;
  }

  100% {
    left: 107%;
    right: -8%;
  }
`)),na=re(ge||(ge=R`
  0% {
    opacity: 1;
    background-position: 0 -23px;
  }

  60% {
    opacity: 0;
    background-position: 0 -23px;
  }

  100% {
    opacity: 1;
    background-position: -200px -23px;
  }
`)),oa=e=>{const{classes:t,variant:r,color:n}=e,i={root:["root",`color${_(n)}`,r],dashed:["dashed",`dashedColor${_(n)}`],bar1:["bar",`barColor${_(n)}`,(r==="indeterminate"||r==="query")&&"bar1Indeterminate",r==="determinate"&&"bar1Determinate",r==="buffer"&&"bar1Buffer"],bar2:["bar",r!=="buffer"&&`barColor${_(n)}`,r==="buffer"&&`color${_(n)}`,(r==="indeterminate"||r==="query")&&"bar2Indeterminate",r==="buffer"&&"bar2Buffer"]};return tt(i,ea,t)},se=(e,t)=>t==="inherit"?"currentColor":e.vars?e.vars.palette.LinearProgress[`${t}Bg`]:e.palette.mode==="light"?at(e.palette[t].main,.62):rt(e.palette[t].main,.5),sa=Q("span",{name:"MuiLinearProgress",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:r}=e;return[t.root,t[`color${_(r.color)}`],t[r.variant]]}})(({ownerState:e,theme:t})=>L({position:"relative",overflow:"hidden",display:"block",height:4,zIndex:0,"@media print":{colorAdjust:"exact"},backgroundColor:se(t,e.color)},e.color==="inherit"&&e.variant!=="buffer"&&{backgroundColor:"none","&::before":{content:'""',position:"absolute",left:0,top:0,right:0,bottom:0,backgroundColor:"currentColor",opacity:.3}},e.variant==="buffer"&&{backgroundColor:"transparent"},e.variant==="query"&&{transform:"rotate(180deg)"})),ia=Q("span",{name:"MuiLinearProgress",slot:"Dashed",overridesResolver:(e,t)=>{const{ownerState:r}=e;return[t.dashed,t[`dashedColor${_(r.color)}`]]}})(({ownerState:e,theme:t})=>{const r=se(t,e.color);return L({position:"absolute",marginTop:0,height:"100%",width:"100%"},e.color==="inherit"&&{opacity:.3},{backgroundImage:`radial-gradient(${r} 0%, ${r} 16%, transparent 42%)`,backgroundSize:"10px 10px",backgroundPosition:"0 -23px"})},ne(be||(be=R`
    animation: ${0} 3s infinite linear;
  `),na)),la=Q("span",{name:"MuiLinearProgress",slot:"Bar1",overridesResolver:(e,t)=>{const{ownerState:r}=e;return[t.bar,t[`barColor${_(r.color)}`],(r.variant==="indeterminate"||r.variant==="query")&&t.bar1Indeterminate,r.variant==="determinate"&&t.bar1Determinate,r.variant==="buffer"&&t.bar1Buffer]}})(({ownerState:e,theme:t})=>L({width:"100%",position:"absolute",left:0,bottom:0,top:0,transition:"transform 0.2s linear",transformOrigin:"left",backgroundColor:e.color==="inherit"?"currentColor":(t.vars||t).palette[e.color].main},e.variant==="determinate"&&{transition:`transform .${ae}s linear`},e.variant==="buffer"&&{zIndex:1,transition:`transform .${ae}s linear`}),({ownerState:e})=>(e.variant==="indeterminate"||e.variant==="query")&&ne(Ce||(Ce=R`
      width: auto;
      animation: ${0} 2.1s cubic-bezier(0.65, 0.815, 0.735, 0.395) infinite;
    `),aa)),ca=Q("span",{name:"MuiLinearProgress",slot:"Bar2",overridesResolver:(e,t)=>{const{ownerState:r}=e;return[t.bar,t[`barColor${_(r.color)}`],(r.variant==="indeterminate"||r.variant==="query")&&t.bar2Indeterminate,r.variant==="buffer"&&t.bar2Buffer]}})(({ownerState:e,theme:t})=>L({width:"100%",position:"absolute",left:0,bottom:0,top:0,transition:"transform 0.2s linear",transformOrigin:"left"},e.variant!=="buffer"&&{backgroundColor:e.color==="inherit"?"currentColor":(t.vars||t).palette[e.color].main},e.color==="inherit"&&{opacity:.3},e.variant==="buffer"&&{backgroundColor:se(t,e.color),transition:`transform .${ae}s linear`}),({ownerState:e})=>(e.variant==="indeterminate"||e.variant==="query")&&ne(ve||(ve=R`
      width: auto;
      animation: ${0} 2.1s cubic-bezier(0.165, 0.84, 0.44, 1) 1.15s infinite;
    `),ra)),da=p.forwardRef(function(t,r){const n=Qe({props:t,name:"MuiLinearProgress"}),{className:i,color:c="primary",value:s,valueBuffer:h,variant:d="indeterminate"}=n,o=Ye(n,ta),l=L({},n,{color:c,variant:d}),u=oa(l),g=Ze(),v={},b={bar1:{},bar2:{}};if((d==="determinate"||d==="buffer")&&s!==void 0){v["aria-valuenow"]=Math.round(s),v["aria-valuemin"]=0,v["aria-valuemax"]=100;let f=s-100;g&&(f=-f),b.bar1.transform=`translateX(${f}%)`}if(d==="buffer"&&h!==void 0){let f=(h||0)-100;g&&(f=-f),b.bar2.transform=`translateX(${f}%)`}return O.jsxs(sa,L({className:et(u.root,i),ownerState:l,role:"progressbar"},v,{ref:r},o,{children:[d==="buffer"?O.jsx(ia,{className:u.dashed,ownerState:l}):null,O.jsx(la,{className:u.bar1,ownerState:l,style:b.bar1}),d==="determinate"?null:O.jsx(ca,{className:u.bar2,ownerState:l,style:b.bar2})]}))}),ua=da;function Ae(e){const{database:t}=k();return Z(t.loadouts,e??"")}function Ke(e){const{database:t}=k();return Z(t.teams,e)}function ma({slot:e}){const{t}=S("relic");return a(w,{sx:{height:"100%"},children:m(D,{children:[m(x,{children:[t("slot"),": ",e]}),a(x,{children:t("empty")})]})})}function ha({build:e}){const t=Ie(e);return a(T,{container:!0,columns:3,spacing:1,children:nt.map(r=>{const n=t[r];return a(T,{item:!0,xs:1,children:n?a(Ht,{relic:n}):a(ma,{slot:r})},`${r}_${n==null?void 0:n.id}`)})})}function pa({teamId:e,currentChar:t,children:r}){const{database:n}=k(),i=Ke(e),c=J(i.loadoutMetadata[0]),s=J(i.loadoutMetadata[1]),h=J(i.loadoutMetadata[2]),d=J(i.loadoutMetadata[3]),o=p.useMemo(()=>jt([...At(i.loadoutMetadata.map(u=>{var g;return((g=n.loadouts.get(u==null?void 0:u.loadoutId))==null?void 0:g.key)??void 0}).filter(ot)),...c?X(c):[],...s?X(s):[],...h?X(h):[],...d?X(d):[],E.common.lvl.add(80),E.common.res.add(.1),E.common.isBroken.add(0),E.common.maxToughness.add(100),st.common.critMode.add("avg")]),[c,s,h,d,i.loadoutMetadata,n]),l=p.useMemo(()=>(t&&(o==null?void 0:o.withTag({src:t,dst:t})))??null,[o,t]);return a(it.Provider,{value:l,children:r})}function J(e){const t=Ae(e==null?void 0:e.loadoutId),r=Re(t==null?void 0:t.key),n=_t(e==null?void 0:e.buildId),i=Dt(n==null?void 0:n.lightConeId),c=Ie(n==null?void 0:n.relicIds),s=p.useMemo(()=>Object.fromEntries(Object.entries((t==null?void 0:t.conditional)??{}).map(([h,d])=>[h,d])),[t]);return p.useMemo(()=>({character:r,lightCone:i,relics:c,conditionals:s,bonusStats:(t==null?void 0:t.bonusStats)??[]}),[r,i,c,s,t])}function X({character:e,lightCone:t,relics:r,conditionals:n,bonusStats:i}){return e?[...Kt(e.key,...Et(e),...Ut(t),...Vt(Object.values(r).filter(s=>!!s).map(s=>({set:s.setKey,stats:[...s.substats.filter(({key:h})=>h!=="").map(h=>({key:h.key,value:h.accurateValue})),{key:s.mainStatKey,value:s.mainStatVal}]}))),...i.map(({tag:s,value:h})=>({tag:{...s},value:lt(h)}))),...Gt(e.key,n)]:[]}function fa({teamId:e,charKey:t,tab:r=""}){const{t:n}=S("page_team"),i=Te(),{database:c}=k(),s=c.teams.get(e),{loadoutMetadata:h}=s,d=Se(),o=_e(d.breakpoints.down("md")),[l,u]=p.useState(!1),g=b=>{c.teams.set(e,{name:b})},v=b=>{c.teams.set(e,{description:b})};return m(C,{sx:()=>({borderBottom:"1px rgb(200,200,200,0.3) solid","& .MuiTab-root:hover":{transition:"background-color 0.25s ease",backgroundColor:"rgba(255,255,255,0.1)"},"& .Mui-selected":{color:"white !important"},"& .MuiTabs-indicator":{height:"4px",backgroundColor:"rgb(200,200,200,0.5)"}}),children:[a(Oe,{onClick:()=>u(!0),children:a(ct,{placement:"top",title:m(C,{children:[m(C,{sx:{display:"flex",color:"info.light",gap:1},children:[a(wt,{}),a(x,{children:a("strong",{children:n`team.editNameDesc`})})]}),!!s.description&&a(x,{children:s.description})]}),children:a(D,{sx:{display:"flex",justifyContent:"center","&:hover":{color:"info.light"}},children:m(x,{variant:"h5",sx:{display:"flex",gap:1,alignItems:"center",justifyContent:"center",textShadow:"#000 0 0 10px !important"},children:[a(te,{}),s.name]})})})}),a(De,{open:l,onClose:()=>u(!1),children:m(w,{children:[a(We,{title:n`team.editNameDesc`,avatar:a(te,{}),titleTypographyProps:{variant:"h6"},action:a(oe,{onClick:()=>u(!1),children:a(qe,{})})}),a(H,{}),a(D,{children:m(C,{display:"flex",flexDirection:"column",gap:2,sx:{mt:2},children:[a(he,{label:n`team.name`,value:s.name,onChange:b=>g(b),autoFocus:!0}),a(he,{label:n`team.desc`,value:s.description,onChange:b=>v(b),multiline:!0,minRows:4})]})})]})}),a(H,{}),m(dt,{variant:"fullWidth",value:t??"team",orientation:o?"vertical":"horizontal",children:[a(ce,{icon:a(te,{}),iconPosition:"start",value:"team",label:"Team Settings",onClick:()=>i(`/teams/${e}/`)}),h.map((b,f)=>{var B;const y=b&&((B=c.loadouts.get(b==null?void 0:b.loadoutId))==null?void 0:B.key);return a(ce,{icon:a(Bt,{}),iconPosition:"start",value:y??f,disabled:!h[f],label:y?a(x,{children:n(`charNames_gen:${y}`)}):`Character ${f+1}`,onClick:()=>y&&i(`/teams/${e}/${y}/${r}`)},f)})]})]})}function ga({teamId:e}){const{database:t}=k(),r=t.teams.get(e);return m(C,{children:[e,r.loadoutMetadata.map((n,i)=>a(ba,{loadoutMetadataIndex:i,teamId:e},`${i}_${n==null?void 0:n.loadoutId}`))]})}function ba({loadoutMetadataIndex:e,teamId:t}){var h;const{database:r}=k(),n=r.teams.get(t),i=(h=n.loadoutMetadata[e])==null?void 0:h.loadoutId,c=r.loadouts.get(i);function s(d){if(d===""){r.teams.set(t,l=>l.loadoutMetadata[e]=void 0);return}r.chars.getOrCreate(d);const o=n.loadoutMetadata.findIndex(l=>{var u;return l&&((u=r.loadouts.get(l.loadoutId))==null?void 0:u.key)===d});if(o===-1){let l=r.loadouts.keys.find(u=>r.loadouts.get(u).key===d);l||(l=r.loadouts.new(d)),r.teams.set(t,u=>{u.loadoutMetadata[e]={loadoutId:l}})}else{if(o===e)return;const l=n.loadoutMetadata[o],u=n.loadoutMetadata[e];r.teams.set(t,g=>{g.loadoutMetadata[e]=l,g.loadoutMetadata[o]=u})}}return a($t,{charKey:(c==null?void 0:c.key)??"",setCharKey:s})}function Ca(){const[e,t,r]=Jt();return m(we,{children:[a(j,{onClick:t,children:"Bonus Stats"}),a(va,{open:e,onClose:r})]})}function va({open:e,onClose:t}){const{database:r}=k(),{loadout:{bonusStats:n},loadoutId:i}=p.useContext(A),c=s=>{const h=xa(s);r.loadouts.set(i,d=>{d.bonusStats.push({tag:h,value:0})})};return a(De,{open:e,onClose:t,children:m(w,{children:[a(We,{title:"Bonus Stats"}),a(H,{}),a(D,{children:m(W,{spacing:1,children:[n.map(({tag:s,value:h},d)=>a(Ta,{tag:s,value:h,setValue:o=>{r.loadouts.set(i,l=>{l.bonusStats[d].value=o})},onDelete:()=>{r.loadouts.set(i,o=>{o.bonusStats.splice(d,1)})},setTag:o=>{r.loadouts.set(i,l=>{l.bonusStats[d].tag=o})}},JSON.stringify(s)+d)),a(ka,{onSelect:c})]})})]})})}function xa(e){return{et:"own",q:e,qt:"premod",sheet:"agg"}}const ya=["hp","hp_","def","def_","atk","atk_","spd","spd_","dmg_","enerRegen_","brEffect_","crit_","crit_dmg_","eff_","eff_res_","heal_"];function ka({tag:e={},onSelect:t}){var r;return a(N,{title:(e&&((r=Le.subset(e)[0])==null?void 0:r.title))??"Add Bonus Stat",children:ya.map(n=>a(P,{onClick:()=>t(n),children:n},n))})}function Ta({tag:e,setTag:t,value:r,setValue:n,onDelete:i}){var s;const c=(s=e.name||e.q)==null?void 0:s.endsWith("_");return a(w,{bgt:"light",children:m(D,{sx:{display:"flex",gap:1,justifyContent:"space-around"},children:[a(Be,{sx:{m:"auto"},children:e.q}),e.q==="dmg_"&&a(Sa,{tag:e,setElementalType:h=>{const{elementalType:d,...o}=e;t(h?{...o,elementalType:h}:o)}}),a(ze,{float:!0,value:r,sx:{flexBasis:150,flexGrow:1,height:"100%"},onChange:n,placeholder:"Stat Value",size:"small",inputProps:{sx:{textAlign:"right"}},InputProps:{endAdornment:m(Ne,{position:"end",sx:{ml:0},children:[c?"%":void 0," ",a(oe,{"aria-label":"Delete Bonus Stat",onClick:i,edge:"end",children:a(je,{fontSize:"small"})})]})}})]})})}function Sa({tag:e,setElementalType:t}){return m(N,{title:e.elementalType??"No Element",children:[a(P,{onClick:()=>t(null),children:"No Element"}),ut.map(r=>a(P,{onClick:()=>t(r),children:r},r))]})}const _a=5e4;class Da{constructor(t,r,n,i,c,s){this.calc=t,this.optTarget=r,this.statFilters=n,this.relicsBySlot=i,this.numWorkers=c,this.setProgress=s,this.worker=new Worker(new URL(""+new URL("parentWorker-BvAmnB8D.js",import.meta.url).href,import.meta.url),{type:"module"})}async optimize(){return await new Promise((r,n)=>{this.worker.onmessage=({data:c})=>{switch(c.resultType){case"progress":this.setProgress(c.progress);break;case"done":r(c.buildResults);break;case"err":console.log(c),n();break}};const i={command:"start",relicsBySlot:this.relicsBySlot,detachedNodes:this.detachNodes(),constraints:this.statFilters.map(({value:c,isMax:s})=>({value:c,isMax:s})),numWorkers:this.numWorkers};this.worker.postMessage(i)})}async terminate(){const t={command:"terminate"};this.worker.postMessage(t),await new Promise((r,n)=>{this.worker.onmessage=({data:i})=>{switch(i.resultType){case"terminated":r();break;case"err":console.log(i),n();break}}}),this.worker.terminate()}detachNodes(){const t=new Set(mt);return Ft([this.optTarget,...this.statFilters.map(({read:n})=>n)],this.calc,n=>{if(n.src==="0"&&n.et==="own"){if(n.sheet==="dyn"&&n.qt==="premod")return{q:n.q};if(n.q==="count"&&t.has(n.sheet))return{q:n.sheet}}})}}var ie={},wa=pt;Object.defineProperty(ie,"__esModule",{value:!0});var Ee=ie.default=void 0,Ba=wa(ht()),$a=O,Ma=(0,Ba.default)((0,$a.jsx)("path",{d:"m16 6 2.29 2.29-4.88 4.88-4-4L2 16.59 3.41 18l6-6 4 4 6.3-6.29L22 12V6z"}),"TrendingUp");Ee=ie.default=Ma;function xe({tag:e}){var t;return a(ft,{color:Mt(e),children:((t=Le.subset(e)[0])==null?void 0:t.title)||e.name||e.q})}function le({optTarget:e,setOptTarget:t,buttonProps:r={}}){const{t:n}=S("optimize"),i=z();return a(N,{title:m(C,{sx:{display:"flex",gap:1},children:[n("optTarget"),e?a(xe,{tag:e.tag}):null]}),...r,children:i==null?void 0:i.listFormulas(M.listing.formulas).map((c,s)=>m(P,{onClick:()=>t(c),children:[a(Xt,{children:a(xe,{tag:c.tag})}),a(C,{sx:{display:"flex",gap:1,ml:1},children:Pt(c.tag).map(h=>a(Be,{children:h}))})]},`${s}_${c.tag.sheet||c.tag.q}_${c.tag.name}`))})}function Pa({statFilters:e,setStatFilters:t,disabled:r=!1}){const n=p.useCallback((o,l)=>{const u=structuredClone(e);typeof l>"u"?u.push({read:o,value:0,isMax:!1,disabled:!1}):u[l].read=o,t(u)},[t,e]),i=p.useCallback(o=>{const l=structuredClone(e);l.splice(o,1),t(l)},[t,e]),c=p.useCallback((o,l)=>{const u=structuredClone(e);u[o].value=l,t(u)},[t,e]),s=p.useCallback((o,l)=>{const u=structuredClone(e);u[o].isMax=l,t(u)},[t,e]),h=p.useCallback((o,l)=>{const u=structuredClone(e);u[o].disabled=l,t(u)},[t,e]),d=p.useMemo(()=>e.map(({read:o,value:l,isMax:u,disabled:g})=>({read:o,value:l,isMax:u,disabled:g})),[e]);return m(C,{display:"flex",flexDirection:"column",gap:1,children:[d.map((o,l)=>a(Ia,{statFilter:o,setTarget:u=>n(u,l),delTarget:()=>i(l),setTargetValue:u=>c(l,u),setTargetisMax:u=>s(l,u),setDisabled:u=>h(l,u),disabled:r},l+JSON.stringify(o))),a(le,{setOptTarget:o=>n(o)})]})}function Ia({statFilter:e,setTarget:t,delTarget:r,setTargetValue:n,setTargetisMax:i,setDisabled:c,disabled:s}){var g;const{read:h,value:d,isMax:o,disabled:l}=e,u=(g=h.tag.name||h.tag.q)==null?void 0:g.endsWith("_");return m(C,{sx:{display:"flex",gap:1},children:[m(gt,{sx:{"& .MuiButtonGroup-grouped":{minWidth:24},width:"100%",flexGrow:1},children:[a(j,{color:l?"secondary":"success",onClick:()=>c(!l),disabled:s,size:"small",children:l?a(bt,{}):a(Ct,{})}),a(le,{optTarget:h,setOptTarget:t,buttonProps:{sx:{flexGrow:1},size:"small"}}),a(j,{onClick:()=>i(!o),size:"small",children:a("strong",{children:o?"<=":">="})})]}),a(ze,{float:!0,value:d,sx:{flexBasis:150,flexGrow:1,height:"100%"},disabled:s,onChange:n,placeholder:"Stat Value",size:"small",inputProps:{sx:{textAlign:"right"}},InputProps:{endAdornment:m(Ne,{position:"end",sx:{ml:0},children:[u?"%":void 0," ",a(oe,{"aria-label":"Delete Stat Constraint",onClick:r,edge:"end",children:a(je,{fontSize:"small"})})]})}})]})}function La({disabled:e=!1}){const{t}=S("page_character_optimize"),{loadout:{optConfigId:r}}=p.useContext(A),{database:n}=k(),{statFilters:i}=Z(n.optConfigs,r),c=p.useCallback(s=>n.optConfigs.set(r,{statFilters:s}),[n,r]);return a(C,{children:m(w,{bgt:"light",children:[a(D,{sx:{display:"flex",gap:1,justifyContent:"space-between",flexDirection:"column"},children:m(C,{display:"flex",justifyContent:"space-between",children:[a(x,{sx:{fontWeight:"bold"},children:t`constraintFilter.title`}),a(Qt,{title:a(x,{children:t`constraintFilter.tooltip`})})]})}),a(H,{}),a(Pa,{statFilters:i,setStatFilters:c,disabled:e})]})})}function za({numWorkers:e,setNumWorkers:t}){const{t:r}=S("optimize"),n=navigator.hardwareConcurrency||8;return a(N,{title:`${r("numWorkers")}: ${e}`,children:Y(1,n).map(i=>a(P,{onClick:()=>t(i),children:r("workers",{count:i})},i))})}function Na(){const{t:e}=S("optimize"),{database:t}=k(),r=z(),[n,i]=p.useState(8),[c,s]=p.useState(void 0),{loadout:h}=p.useContext(A),d=Z(t.optConfigs,h.optConfigId),o=d==null?void 0:d.optimizationTarget,l=p.useCallback($=>{t.optConfigs.set(h.optConfigId,{optimizationTarget:$})},[t.optConfigs,h.optConfigId]),u=p.useMemo(()=>t.relics.values.reduce(($,I)=>($[I.slotKey].push(I),$),{head:[],hands:[],feet:[],body:[],sphere:[],rope:[]}),[t.relics.values]),g=Object.values(u).reduce(($,I)=>$*I.length,1),[v,b]=p.useState(void 0),[f,y]=p.useState(!1),B=p.useRef(()=>{});p.useEffect(()=>()=>B.current(),[]);const Ue=p.useCallback(async()=>{if(!o||!r)return;const $=new Promise(q=>B.current=q);s(void 0),y(!0);const I=((d==null?void 0:d.statFilters)??[]).filter(({disabled:q})=>!q).map(({read:q,value:Fe,isMax:Je})=>({read:q,value:Fe,isMax:Je})),ee=new Da(r,o,I,u,n,s);$.then(async()=>await ee.terminate());const Ge=await ee.optimize();await ee.terminate(),B.current=()=>{},y(!1),b(Ge[0])},[r,n,d==null?void 0:d.statFilters,o,u]),Ve=p.useCallback(()=>{B.current(),y(!1)},[B]);return a(w,{bgt:"dark",children:m(D,{children:[a(La,{}),m(W,{children:[a(x,{variant:"h5",children:e("optimize")}),m(C,{children:[a(le,{optTarget:o,setOptTarget:l}),a(za,{numWorkers:n,setNumWorkers:i}),a(j,{onClick:f?Ve:Ue,color:f?"error":"primary",startIcon:f?a(qe,{}):a(Ee,{}),children:e(f?"cancel":"optimize")})]}),c&&a(Ra,{progress:c,totalPermutations:g}),v&&m(C,{children:[m(x,{children:["Best: ",v.value]}),a(ha,{build:v.ids})]})]})]})})}function Ra({progress:e,totalPermutations:t}){const{t:r}=S("optimize");return m(C,{children:[m(x,{children:[r("totalProgress"),": ",e.numBuildsComputed.toLocaleString()," /"," ",t.toLocaleString()]}),m(x,{children:[r("buildsKept"),": ",e.numBuildsKept.toLocaleString()," /"," ",_a.toLocaleString()]}),a(ua,{variant:"determinate",value:e.numBuildsComputed/t*100})]})}const qa={xs:12,sm:6,md:4};function Oa(){const{loadout:{key:e}}=K(),t=z(),{database:r}=k(),n=["basic","skill","ult","talent"],i=Se(),c=_e(i.breakpoints.up("lg")),s=It[e],h=(t==null?void 0:t.compute(M.char.eidolon).val)??0,d=p.useMemo(()=>s&&Y(1,$e).map(o=>{const l=s[`eidolon${o}`];return l?a(ye,{talentKey:`eidolon${o}`,sheetElement:l,onClickTitle:()=>r.chars.set(e,{eidolon:o===h?o-1:o})}):null}),[e,s,r.chars,h]);if(!(!s||!t))return a(we,{children:m(T,{container:!0,spacing:1,children:[c&&m(T,{item:!0,xs:12,md:12,lg:3,sx:{display:"flex",flexDirection:"column",gap:1},children:[a(ke,{}),d&&d.map((o,l)=>a(C,{sx:{opacity:h>=l+1?1:.5},children:o},l))]}),a(T,{item:!0,xs:12,md:12,lg:9,container:!0,spacing:1,children:n.map(o=>{const l=s[o];return l?a(T,{item:!0,...qa,children:a(ye,{talentKey:o,sheetElement:l})},o):null})}),!c&&a(T,{item:!0,xs:12,md:12,lg:3,container:!0,spacing:1,children:a(T,{item:!0,xs:12,children:a(ke,{})})})]})})}function ye({sheetElement:e,talentKey:t,onClickTitle:r}){const{loadout:{key:n}}=K(),i=p.useCallback(o=>a(Oe,{onClick:r,children:o}),[r]);let c=null;c=null,Nt(t)&&(c=a(Wa,{talentKey:t,dropDownButtonProps:{sx:{borderRadius:0}},setTalent:o=>h.chars.set(n,l=>{l[t]=o})}));const{loadoutId:s}=p.useContext(A),{database:h}=k(),d=p.useCallback((o,l,u,g)=>{h.loadouts.set(s,v=>(v=structuredClone(v),vt(v.conditional,[o,l,u],g),v))},[h,s]);return m(w,{bgt:"light",sx:{height:"100%"},children:[c,m(D,{children:[a(Lt,{condition:!!r,wrapper:i,children:m(T,{container:!0,sx:{flexWrap:"nowrap"},children:[a(T,{item:!0,children:a(C,{component:de?de:"img",src:e==null?void 0:e.img,sx:{width:60,height:"auto"}})}),m(T,{item:!0,flexGrow:1,sx:{pl:1},children:[a(x,{variant:"h6",children:e==null?void 0:e.title}),e.subtitle&&a(x,{variant:"subtitle1",children:e.subtitle})]})]})}),a(Zt,{spacing:1,children:e.documents.map((o,l)=>a(zt,{document:o,collapse:!0,setConditional:d},l))})]})]})}function ke(){const{t:e}=S("sheet_gen"),t=z(),{loadout:{key:r}}=K(),{database:n}=k();if(!t)return null;const i=t.compute(M.char.eidolon).val;return a(N,{fullWidth:!0,title:m("span",{children:[e("eidolonLvl")," ",i]}),color:"primary",children:Y(0,$e).map(c=>a(P,{selected:i===c,disabled:i===c,onClick:()=>n.chars.set(r,{eidolon:c}),children:m("span",{children:[e("eidolonLvl")," ",c]})},c))})}function Wa({talentKey:e,setTalent:t,dropDownButtonProps:r}){const{t:n}=S("sheet_gen"),{character:i}=Me(),c=z();if(!c||!i)return null;const s=0,h=c.compute(M.char[e]).val,d=c.compute(M.char.ascension).val;return a(N,{fullWidth:!0,title:m("span",{children:[n("lvl")," ",h]}),color:"primary",...r,children:Y(1,xt[d]).map(o=>a(P,{selected:i[e]===o,disabled:i[e]===o,onClick:()=>t(o),children:m("span",{children:[n("lvl")," ",o+s]})},o))})}function ja({tab:e}){const{loadout:{key:t}}=K(),{character:r}=Me(),n=z(),[i,c]=p.useState(void 0);return m(C,{children:[e,a(Ot,{characterKey:i,onClose:()=>c(void 0)}),a(Wt,{character:r}),m(W,{gap:1,pt:1,children:[a(w,{bgt:"dark",children:m(D,{children:[a(j,{disabled:!t,onClick:()=>t&&c(t),children:"Edit Character"}),a(Ca,{}),m(U,{children:[a(V,{expandIcon:a(G,{}),children:"All target listings"}),a(F,{children:a(W,{children:n==null?void 0:n.listFormulas(M.listing.formulas).map((s,h)=>{const d=n.compute(s),o=s.tag.name||s.tag.q;return m(C,{children:[m(x,{children:[o,": ",d.val]}),m(U,{children:[m(V,{expandIcon:a(G,{}),children:["debug for ",o]}),m(F,{children:["conds:"," ",JSON.stringify(d.meta.conds,void 0,2),a(x,{component:"pre",children:JSON.stringify(n.toDebug().compute(s),void 0,2)})]})]})]},`${o}${h}`)})})})]}),m(U,{children:[a(V,{expandIcon:a(G,{}),children:"All target buffs"}),a(F,{children:a(W,{children:n==null?void 0:n.listFormulas(M.listing.buffs).map((s,h)=>{const d=n.compute(s),o=s.tag.name||s.tag.q;return m(C,{children:[m(x,{children:[o,": ",d.val]}),m(U,{children:[m(V,{expandIcon:a(G,{}),children:["debug for ",o]}),m(F,{children:["conds:"," ",JSON.stringify(d.meta.conds,void 0,2),a(x,{component:"pre",children:JSON.stringify(n.toDebug().compute(s),void 0,2)})]})]})]},`${o}${h}`)})})})]})]})}),a(Oa,{}),a(Na,{})]})]})}const Aa=a(Pe,{variant:"rectangular",width:"100%",height:1e3});function nr(){const{database:e}=k(),{teamId:t}=yt(),r=!t||!e.teams.keys.includes(t);return p.useEffect(()=>{r||e.teams.set(t,{lastEdit:Date.now()})},[t,e.teams,r]),r?a(Tt,{to:"/teams"}):a(C,{display:"flex",flexDirection:"column",gap:1,children:a(p.Suspense,{fallback:Aa,children:t&&a(Ka,{teamId:t})})})}function Ka({teamId:e}){var b;const{database:t}=k(),r=Te(),n=Ke(e),{loadoutMetadata:i}=n,{params:{characterKey:c}}=ue({path:"/teams/:teamId/:characterKey",end:!1})??{params:{}},{params:{tab:s}}=ue({path:"/teams/:teamId/:characterKey/:tab"})??{params:{}},h=p.useMemo(()=>i.findIndex(f=>{var y;return(f==null?void 0:f.loadoutId)&&((y=t.loadouts.get(f.loadoutId))==null?void 0:y.key)===c}),[i,t.loadouts,c]),d=p.useMemo(()=>i[h],[i,h]);p.useEffect(()=>{window.scrollTo({top:0})},[]),p.useEffect(()=>{d||r("",{replace:!0})},[d,r]);const o=d==null?void 0:d.loadoutId,l=(b=t.loadouts.get(o))==null?void 0:b.key,{t:u}=S(["charNames_gen","page_character"]);Rt(p.useMemo(()=>{const f=u(l?"charNames_gen:Character":"Team Settings"),y=s?u(`page_character:tabs.${s}`):l?u("Loadout/Build"):s;return`${n.name} - ${f}${y?` - ${y}`:""}`},[l,u,s,n.name]));const g=Ae(o??""),v=p.useMemo(()=>{if(!(!o||!g||!d))return{teamId:e,team:n,loadoutId:o,loadout:g,loadoutMetadatum:d}},[o,g,d,n,e]);return a(pa,{teamId:e,currentChar:l,children:m(C,{sx:{display:"flex",gap:1,flexDirection:"column",mx:1,mt:2},children:[a(w,{children:a(fa,{teamId:e,charKey:l,tab:s})}),a(C,{children:v?a(A.Provider,{value:v,children:a(Ea,{})}):a(ga,{teamId:e})})]})})}function Ea({tab:e}){const{loadout:{key:t}}=K(),r=Re(t),n=p.useMemo(()=>r&&{character:r},[r]);return n?a(kt.Provider,{value:n,children:a(St,{children:a(me,{path:":characterKey",children:a(me,{path:"*",index:!0,element:a(ja,{tab:e})})})})}):a(Pe,{variant:"rectangular",width:"100%",height:1e3})}export{nr as default};
