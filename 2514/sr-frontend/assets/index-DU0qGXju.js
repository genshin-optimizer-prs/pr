import{N as y,n as e,E as g,m as T,ak as de,U as ue,V as he,r as p,q as d,ac as ze,H as x,X as k,L as v,I as Z,aq as D,W as pe,as as Oe,ar as $e,aK as Pe,am as j,an as Ke,aL as Ne,ap as We,ao as Le,Y as O,F as me,S as fe,au as Ae,av as Ee,ab as w,ay as X,G as S,aa as ne,aB as ge,aC as Ce,aD as qe,B as je,aw as Ve,ax as Ge,aE as Je,aF as Re,aG as Fe,$ as be,aH as He,aI as Xe,aJ as ae}from"./index-DmKSsOiz.js";import{u as xe,C as Ue,d as Qe,e as oe,T as re,f as Ye,a as Ze,b as et,c as tt,t as ye,N as ve,I as ke,g as nt,h as at,k as Se,j as ot,D as rt,l as st,S as ct,i as it,B as lt,M as dt,L as ut,A as V,m as G,n as J,o as R,p as ht}from"./TrendingUp-DNCvAftj.js";import{u as Te,S as L,b as $,C as pt,a as mt}from"./CharacterEditor-BNb-RfFK.js";import{d as Me}from"./Close-CJWERuBR.js";import{C as ee}from"./CardActionArea-f5uXYp6j.js";import{C as P}from"./useForceUpdate-CMXwZ7hf.js";import{s as ft,t as gt,b as se,w as Ct,c as bt,l as xt,r as yt}from"./index-BvCLiwi-.js";import{u as vt}from"./useBoolState-Znd4gpyK.js";import{M as B,D as K}from"./DropdownButton-BL3_ie1Q.js";import{D as De,a as kt}from"./LocationAutocomplete-_6haSHfn.js";import{I as St}from"./InfoTooltip-CtcH4gbg.js";import"./index-DqGSnlAP.js";function A(t){const{database:n}=y();return xe(n.combos,t)}function Tt({comboId:t}){const n=A(t);return e(g,{display:"flex",flexDirection:"column",gap:1,children:n.comboMetadata.map((a,o)=>e(Mt,{comboMetadataIndex:o,comboId:t},`${o}_${a==null?void 0:a.characterKey}`))})}function Mt({comboMetadataIndex:t,comboId:n}){var r;const{database:a}=y(),o=A(n);function s(h){if(h===""){a.teams.set(n,i=>i.loadoutMetadata[t]=void 0);return}a.chars.getOrCreate(h);const u=o.comboMetadata.findIndex(i=>(i==null?void 0:i.characterKey)===h);if(u===-1)a.combos.set(n,i=>{i.comboMetadata[t]={characterKey:h}});else{if(u===t)return;const i=o.comboMetadata[u],c=o.comboMetadata[t];a.combos.set(n,l=>{l.comboMetadata[t]=i,l.comboMetadata[u]=c})}}return e(Ue,{charKey:((r=o.comboMetadata[t])==null?void 0:r.characterKey)??"",setCharKey:s})}function Dt({comboId:t,charKey:n}){const{t:a}=T("page_team"),o=de(),{database:s}=y(),r=A(t),h=ue(),u=he(h.breakpoints.down("md")),[i,c]=p.useState(!1),l=m=>{s.combos.set(t,{name:m})},f=m=>{s.combos.set(t,{description:m})};return d(g,{sx:()=>({borderBottom:"1px rgb(200,200,200,0.3) solid","& .MuiTab-root:hover":{transition:"background-color 0.25s ease",backgroundColor:"rgba(255,255,255,0.1)"},"& .Mui-selected":{color:"white !important"},"& .MuiTabs-indicator":{height:"4px",backgroundColor:"rgb(200,200,200,0.5)"}}),children:[e(ee,{onClick:()=>c(!0),children:e(ze,{placement:"top",title:d(g,{children:[d(g,{sx:{display:"flex",color:"info.light",gap:1},children:[e(Qe,{}),e(x,{children:e("strong",{children:a`team.editNameDesc`})})]}),!!r.description&&e(x,{children:r.description})]}),children:e(k,{sx:{display:"flex",justifyContent:"center","&:hover":{color:"info.light"}},children:d(x,{variant:"h5",sx:{display:"flex",gap:1,alignItems:"center",justifyContent:"center",textShadow:"#000 0 0 10px !important"},children:[e(oe,{}),r.name]})})})}),e(pe,{open:i,onClose:()=>c(!1),children:d(v,{children:[e(P,{title:a`team.editNameDesc`,avatar:e(oe,{}),titleTypographyProps:{variant:"h6"},action:e(Z,{onClick:()=>c(!1),children:e(Me,{})})}),e(D,{}),e(k,{children:d(g,{display:"flex",flexDirection:"column",gap:2,sx:{mt:2},children:[e(re,{label:a`team.name`,value:r.name,onChange:m=>l(m),autoFocus:!0}),e(re,{label:a`team.desc`,value:r.description,onChange:m=>f(m),multiline:!0,minRows:4}),e(Tt,{comboId:t})]})})]})}),e(D,{}),e($e,{variant:"fullWidth",value:n??"team",orientation:u?"vertical":"horizontal",children:r.comboMetadata.map((m,b)=>{const C=m==null?void 0:m.characterKey;return e(Oe,{icon:e(Ye,{}),iconPosition:"start",value:C??b,disabled:!m,label:C?e(x,{children:a(`charNames_gen:${C}`)}):`Character ${b+1}`,onClick:()=>C&&o(`/combos/${t}/${C}`)},b)})})]})}const E=p.createContext({});function _(){return p.useContext(E)}const q=p.createContext({presetIndex:0,setPresetIndex:()=>{}});function wt({comboId:t,currentChar:n,children:a}){const o=A(t),{presetIndex:s}=p.useContext(q),r=F(o.comboMetadata[0]),h=F(o.comboMetadata[1]),u=F(o.comboMetadata[2]),i=F(o.comboMetadata[3]),c=p.useMemo(()=>ft([...gt(o.comboMetadata.map((f,m)=>f===void 0?void 0:Pe[m]).filter(f=>!!f)),...r?H(r):[],...h?H(h):[],...u?H(u):[],...i?H(i):[],j.common.lvl.add(80),j.common.res.add(.1),j.common.isBroken.add(0),j.common.maxToughness.add(100),Ke.common.critMode.add("avg"),...o.conditionals.flatMap(({sheet:f,src:m,dst:b,condKey:C,condValues:N})=>N.flatMap((M,Q)=>se(`preset${Q}`,Ne(f,m,b)(C,M)))),...o.bonusStats.flatMap(({tag:f,values:m})=>m.flatMap((b,C)=>se(`preset${C}`,{tag:{...f},value:We(b)})))]),[o,r,h,u,i]),l=p.useMemo(()=>(n&&(c==null?void 0:c.withTag({src:n,dst:n,preset:`preset${s}`})))??null,[c,n,s]);return e(Le.Provider,{value:l,children:a})}function F(t){const n=Te(t==null?void 0:t.characterKey),a=Ze(t==null?void 0:t.buildId),o=et(a==null?void 0:a.lightConeId),s=tt(a==null?void 0:a.relicIds);return p.useMemo(()=>({character:n,lightCone:o,relics:s}),[n,o,s])}function H({character:t,lightCone:n,relics:a}){return t?Ct(t.key,...bt(t),...xt(n),...yt(Object.values(a).filter(o=>!!o).map(o=>({set:o.setKey,stats:[...o.substats.filter(({key:s})=>s!=="").map(s=>({key:s.key,value:s.accurateValue})),{key:o.mainStatKey,value:o.mainStatVal}]})))):[]}function Bt(){const[t,n,a]=vt();return d(me,{children:[e(O,{onClick:n,children:"Bonus Stats"}),e(_t,{open:t,onClose:a})]})}function _t({open:t,onClose:n}){const{database:a}=y(),{presetIndex:o}=p.useContext(q),{comboId:s,combo:{bonusStats:r},comboMetadatum:{characterKey:h}}=_(),u=i=>{const c=It(i,h);a.combos.setBonusStat(s,c,0,o)};return e(pe,{open:t,onClose:n,children:d(v,{children:[e(P,{title:"Bonus Stats"}),e(D,{}),e(k,{children:d(L,{spacing:1,children:[r.map(({tag:i,values:c},l)=>e($t,{tag:i,value:c[o],setValue:f=>a.combos.setBonusStat(s,i,f,o),onDelete:()=>a.combos.setBonusStat(s,i,0,o),setTag:f=>a.combos.setBonusStat(s,f,0,o)},JSON.stringify(i)+l)),e(Ot,{onSelect:u})]})})]})})}function It(t,n){return{src:n,dst:n,et:"own",q:t,qt:"premod",sheet:"agg"}}const zt=["hp","hp_","def","def_","atk","atk_","spd","spd_","dmg_","enerRegen_","brEffect_","crit_","crit_dmg_","eff_","eff_res_","heal_"];function Ot({tag:t={},onSelect:n}){var a;return e(K,{title:(t&&((a=ye.subset(t)[0])==null?void 0:a.title))??"Add Bonus Stat",children:zt.map(o=>e(B,{onClick:()=>n(o),children:o},o))})}function $t({tag:t,setTag:n,value:a,setValue:o,onDelete:s}){var h;const r=(h=t.name||t.q)==null?void 0:h.endsWith("_");return e(v,{bgt:"light",children:d(k,{sx:{display:"flex",gap:1,justifyContent:"space-around"},children:[e(fe,{sx:{m:"auto"},children:t.q}),t.q==="dmg_"&&e(Pt,{tag:t,setElementalType:u=>{const{elementalType:i,...c}=t;n(u?{...c,elementalType:u}:c)}}),e(ve,{float:!0,value:a,sx:{flexBasis:150,flexGrow:1,height:"100%"},onChange:o,placeholder:"Stat Value",size:"small",inputProps:{sx:{textAlign:"right"}},InputProps:{endAdornment:d(ke,{position:"end",sx:{ml:0},children:[r?"%":void 0," ",e(Z,{"aria-label":"Delete Bonus Stat",onClick:s,edge:"end",children:e(De,{fontSize:"small"})})]})}})]})})}function Pt({tag:t,setElementalType:n}){return d(K,{title:t.elementalType??"No Element",children:[e(B,{onClick:()=>n(null),children:"No Element"}),Ae.map(a=>e(B,{onClick:()=>n(a),children:a},a))]})}function ce({tag:t}){var n;return e(Ee,{color:nt(t),children:((n=ye.subset(t)[0])==null?void 0:n.title)||t.name||t.q})}function U({optTarget:t,setOptTarget:n,buttonProps:a={}}){const{t:o}=T("optimize"),s=$();return e(K,{title:d(g,{sx:{display:"flex",gap:1},children:[o("optTarget"),t?e(ce,{tag:t}):null]}),...a,children:s==null?void 0:s.listFormulas(w.listing.formulas).map((r,h)=>d(B,{onClick:()=>n(r.tag),children:[e(kt,{children:e(ce,{tag:r.tag})}),e(g,{sx:{display:"flex",gap:1,ml:1},children:at(r.tag).map(u=>e(fe,{children:u},u))})]},`${h}_${r.tag.sheet||r.tag.q}_${r.tag.name}`))})}function Kt(){const{database:t}=y(),{combo:n,comboId:a}=_();return d(v,{sx:{overflow:"visible",top:137,position:"sticky",zIndex:101},children:[e(P,{title:"Combo Editor"}),e(D,{}),d(k,{sx:{display:"flex",gap:1,overflowX:"auto"},children:[n.frames.map((o,s)=>e(Nt,{tag:o,index:s,setTarget:r=>t.combos.set(a,h=>{const u=structuredClone(h.frames);u[s]=r,h.frames=u})},s+JSON.stringify(o??{}))),e(g,{sx:{flexShrink:0},children:e(U,{setOptTarget:o=>t.combos.set(a,s=>{s.frames=[...s.frames,o]})})})]})]})}function Nt({tag:t,index:n,setTarget:a}){const{presetIndex:o,setPresetIndex:s}=p.useContext(q);return d(v,{bgt:"light",sx:r=>({flexShrink:0,outline:o===n?`solid ${r.palette.success.main}`:void 0}),children:[e(Se,{condition:o!==n,wrapper:r=>e(ee,{onClick:()=>s(n),children:r}),children:e(P,{title:`Combo ${n+1}`})}),e(D,{}),e(k,{children:e(U,{optTarget:t,setOptTarget:a})})]})}const Wt={xs:12,sm:6,md:4};function Lt(){const{comboMetadatum:{characterKey:t}}=_(),n=$(),{database:a}=y(),o=["basic","skill","ult","talent"],s=ue(),r=he(s.breakpoints.up("lg")),h=ot[t],u=(n==null?void 0:n.compute(w.char.eidolon).val)??0,i=p.useMemo(()=>h&&X(1,ge).map(c=>{const l=h[`eidolon${c}`];return l?e(ie,{talentKey:`eidolon${c}`,sheetElement:l,onClickTitle:()=>a.chars.set(t,{eidolon:c===u?c-1:c})}):null}),[t,h,a.chars,u]);if(!(!h||!n))return e(me,{children:d(S,{container:!0,spacing:1,children:[r&&d(S,{item:!0,xs:12,md:12,lg:3,sx:{display:"flex",flexDirection:"column",gap:1},children:[e(le,{}),i&&i.map((c,l)=>e(g,{sx:{opacity:u>=l+1?1:.5},children:c},l))]}),e(S,{item:!0,xs:12,md:12,lg:9,container:!0,spacing:1,children:o.map(c=>{const l=h[c];return l?e(S,{item:!0,...Wt,children:e(ie,{talentKey:c,sheetElement:l})},c):null})}),!r&&e(S,{item:!0,xs:12,md:12,lg:3,container:!0,spacing:1,children:e(S,{item:!0,xs:12,children:e(le,{})})})]})})}function ie({sheetElement:t,talentKey:n,onClickTitle:a}){const{comboMetadatum:{characterKey:o}}=_(),s=p.useCallback(l=>e(ee,{onClick:a,children:l}),[a]);let r=null;r=null,st(n)&&(r=e(At,{talentKey:n,dropDownButtonProps:{sx:{borderRadius:0}},setTalent:l=>i.chars.set(o,f=>{f[n]=l})}));const{comboId:h}=p.useContext(E),{presetIndex:u}=p.useContext(q),{database:i}=y(),c=p.useCallback((l,f,m,b)=>i.combos.setConditional(h,f,l,o,m,b,u),[h,i.combos,o,u]);return d(v,{bgt:"light",sx:{height:"100%"},children:[r,d(k,{children:[e(Se,{condition:!!a,wrapper:s,children:d(S,{container:!0,sx:{flexWrap:"nowrap"},children:[e(S,{item:!0,children:e(g,{component:ne?ne:"img",src:t==null?void 0:t.img,sx:{width:60,height:"auto"}})}),d(S,{item:!0,flexGrow:1,sx:{pl:1},children:[e(x,{variant:"h6",children:t==null?void 0:t.title}),t.subtitle&&e(x,{variant:"subtitle1",children:t.subtitle})]})]})}),t.documents.map((l,f)=>e(rt,{document:l,collapse:!0,setConditional:c},f))]})]})}function le(){const{t}=T("sheet_gen"),n=$(),{comboMetadatum:{characterKey:a}}=_(),{database:o}=y();if(!n)return null;const s=n.compute(w.char.eidolon).val;return e(K,{fullWidth:!0,title:d("span",{children:[t("eidolonLvl")," ",s]}),color:"primary",children:X(0,ge).map(r=>e(B,{selected:s===r,disabled:s===r,onClick:()=>o.chars.set(a,{eidolon:r}),children:d("span",{children:[t("eidolonLvl")," ",r]})},r))})}function At({talentKey:t,setTalent:n,dropDownButtonProps:a}){const{t:o}=T("sheet_gen"),{character:s}=Ce(),r=$();if(!r||!s)return null;const h=0,u=r.compute(w.char[t]).val,i=r.compute(w.char.ascension).val;return e(K,{fullWidth:!0,title:d("span",{children:[o("lvl")," ",u]}),color:"primary",...a,children:X(1,qe[i]).map(c=>e(B,{selected:s[t]===c,disabled:s[t]===c,onClick:()=>n(c),children:d("span",{children:[o("lvl")," ",c+h]})},c))})}const te=p.createContext({optConfigId:"",optConfig:{}});function Et({optConfigId:t,children:n}){const{database:a}=y(),o=xe(a.optConfigs,t),s=p.useMemo(()=>({optConfigId:t,optConfig:o}),[t,o]);return e(te.Provider,{value:s,children:n})}function qt({statFilters:t,setStatFilters:n,disabled:a=!1}){const o=p.useCallback((i,c)=>{const l=structuredClone(t);typeof c>"u"?l.push({tag:i,value:0,isMax:!1,disabled:!1}):l[c].tag=i,n(l)},[n,t]),s=p.useCallback(i=>{const c=structuredClone(t);c.splice(i,1),n(c)},[n,t]),r=p.useCallback((i,c)=>{const l=structuredClone(t);l[i].value=c,n(l)},[n,t]),h=p.useCallback((i,c)=>{const l=structuredClone(t);l[i].isMax=c,n(l)},[n,t]),u=p.useCallback((i,c)=>{const l=structuredClone(t);l[i].disabled=c,n(l)},[n,t]);return d(g,{display:"flex",flexDirection:"column",gap:1,children:[t.map((i,c)=>e(jt,{statFilter:i,setTarget:l=>o(l,c),delTarget:()=>s(c),setTargetValue:l=>r(c,l),setTargetisMax:l=>h(c,l),setDisabled:l=>u(c,l),disabled:a},c+JSON.stringify(i))),e(U,{setOptTarget:i=>o(i)})]})}function jt({statFilter:t,setTarget:n,delTarget:a,setTargetValue:o,setTargetisMax:s,setDisabled:r,disabled:h}){var m;const{tag:u,value:i,isMax:c,disabled:l}=t,f=(m=u.name||u.q)==null?void 0:m.endsWith("_");return d(g,{sx:{display:"flex",gap:1},children:[d(je,{sx:{"& .MuiButtonGroup-grouped":{minWidth:24},width:"100%",flexGrow:1},children:[e(O,{color:l?"secondary":"success",onClick:()=>r(!l),disabled:h,size:"small",children:l?e(Ve,{}):e(Ge,{})}),e(U,{optTarget:u,setOptTarget:n,buttonProps:{sx:{flexGrow:1},size:"small"}}),e(O,{onClick:()=>s(!c),size:"small",children:e("strong",{children:c?"<=":">="})})]}),e(ve,{float:!0,value:i,sx:{flexBasis:150,flexGrow:1,height:"100%"},disabled:h,onChange:o,placeholder:"Stat Value",size:"small",inputProps:{sx:{textAlign:"right"}},InputProps:{endAdornment:d(ke,{position:"end",sx:{ml:0},children:[f?"%":void 0," ",e(Z,{"aria-label":"Delete Stat Constraint",onClick:a,edge:"end",children:e(De,{fontSize:"small"})})]})}})]})}function Vt({disabled:t=!1}){const{t:n}=T("page_character_optimize"),{optConfigId:a,optConfig:{statFilters:o}}=p.useContext(te),{database:s}=y(),r=p.useCallback(h=>s.optConfigs.set(a,{statFilters:h}),[s,a]);return e(g,{children:d(v,{bgt:"light",children:[e(k,{sx:{display:"flex",gap:1,justifyContent:"space-between",flexDirection:"column"},children:d(g,{display:"flex",justifyContent:"space-between",children:[e(x,{sx:{fontWeight:"bold"},children:n`constraintFilter.title`}),e(St,{title:e(x,{children:n`constraintFilter.tooltip`})})]})}),e(D,{}),e(qt,{statFilters:o,setStatFilters:r,disabled:t})]})})}function Gt({numWorkers:t,setNumWorkers:n}){const{t:a}=T("optimize"),o=navigator.hardwareConcurrency||8;return e(K,{title:`${a("numWorkers")}: ${t}`,children:X(1,o).map(s=>e(B,{onClick:()=>n(s),children:a("workers",{count:s})},s))})}function Jt(){const{database:t}=y(),{comboMetadatum:n,comboId:a}=p.useContext(E),o=n.optConfigId,s=p.useCallback(()=>{o||t.combos.set(a,r=>{const h=r.comboMetadata.find(u=>(u==null?void 0:u.characterKey)===n.characterKey);if(h){const u=t.optConfigs.new();h.optConfigId=u}})},[a,n.characterKey,t,o]);return o?e(Et,{optConfigId:o,children:e(Rt,{})}):e(v,{children:e(P,{title:d("span",{children:["Optimize this combo for ",n.characterKey]}),action:e(O,{onClick:s,children:"Optimize"})})})}function Rt(){const{t}=T("optimize"),{database:n}=y(),a=$(),{combo:o,comboMetadatum:{characterKey:s}}=p.useContext(E),[r,h]=p.useState(8),[u,i]=p.useState(void 0),{optConfig:c}=p.useContext(te),l=p.useMemo(()=>n.relics.values.reduce((I,z)=>(I[z.slotKey].push(z),I),{head:[],hands:[],feet:[],body:[],sphere:[],rope:[]}),[n.relics.values]),f=Object.values(l).reduce((I,z)=>I*z.length,1),[m,b]=p.useState(void 0),[C,N]=p.useState(!1),M=p.useRef(()=>{});p.useEffect(()=>()=>M.current(),[]);const Q=p.useCallback(async()=>{if(!a)return;const I=new Promise(W=>M.current=W);i(void 0),N(!0);const z=(c.statFilters??[]).filter(({disabled:W})=>!W).map(({tag:W,value:_e,isMax:Ie})=>({tag:W,value:_e,isMax:Ie})),Y=new ct(s,a,o.frames,z,l,r,i);I.then(async()=>await Y.terminate());const Be=await Y.optimize();await Y.terminate(),M.current=()=>{},N(!1),b(Be[0])},[a,s,o,r,c.statFilters,l]),we=p.useCallback(()=>{M.current(),N(!1)},[M]);return d(v,{children:[e(P,{title:t("optimize"),action:d(g,{children:[e(Gt,{numWorkers:r,setNumWorkers:h}),e(O,{onClick:C?we:Q,color:C?"error":"primary",startIcon:C?e(Me,{}):e(it,{}),children:t(C?"cancel":"optimize")})]})}),e(D,{}),d(k,{children:[e(Vt,{}),d(L,{children:[u&&e(Ft,{progress:u,totalPermutations:f}),m&&d(g,{children:[d(x,{children:["Best: ",m.value]}),e(lt,{build:m.ids})]})]})]})]})}function Ft({progress:t,totalPermutations:n}){const{t:a}=T("optimize");return d(g,{children:[d(x,{children:[a("totalProgress"),": ",t.numBuildsComputed.toLocaleString()," /"," ",n.toLocaleString()]}),d(x,{children:[a("buildsKept"),": ",t.numBuildsKept.toLocaleString()," /"," ",dt.toLocaleString()]}),e(ut,{variant:"determinate",value:t.numBuildsComputed/n*100})]})}function Ht(){const{comboMetadatum:{characterKey:t}}=_(),{character:n}=Ce(),a=$(),[o,s]=p.useState(void 0);return d(g,{children:[e(pt,{characterKey:o,onClose:()=>s(void 0)}),e(mt,{character:n}),d(L,{gap:1,pt:1,children:[e(Kt,{}),e(v,{bgt:"dark",children:d(k,{children:[e(O,{disabled:!t,onClick:()=>t&&s(t),children:"Edit Character"}),e(Bt,{}),d(V,{children:[e(G,{expandIcon:e(J,{}),children:"All target listings"}),e(R,{children:e(L,{children:a==null?void 0:a.listFormulas(w.listing.formulas).map((r,h)=>{const u=a.compute(r),i=r.tag.name||r.tag.q;return d(g,{children:[d(x,{children:[i,": ",u.val]}),d(V,{children:[d(G,{expandIcon:e(J,{}),children:["debug for ",i]}),d(R,{children:["conds:"," ",JSON.stringify(u.meta.conds,void 0,2),e(x,{component:"pre",children:JSON.stringify(a.toDebug().compute(r),void 0,2)})]})]})]},`${i}${h}`)})})})]}),d(V,{children:[e(G,{expandIcon:e(J,{}),children:"All target buffs"}),e(R,{children:e(L,{children:a==null?void 0:a.listFormulas(w.listing.buffs).map((r,h)=>{const u=a.compute(r),i=r.tag.name||r.tag.q;return d(g,{children:[d(x,{children:[i,": ",u.val]}),d(V,{children:[d(G,{expandIcon:e(J,{}),children:["debug for ",i]}),d(R,{children:["conds:"," ",JSON.stringify(u.meta.conds,void 0,2),e(x,{component:"pre",children:JSON.stringify(a.toDebug().compute(r),void 0,2)})]})]})]},`${i}${h}`)})})})]})]})}),e(Lt,{}),e(Jt,{})]})]})}const Xt=e(be,{variant:"rectangular",width:"100%",height:1e3});function un(){const{database:t}=y(),{teamId:n}=Je(),a=!n||!t.combos.keys.includes(n);return p.useEffect(()=>{a||t.combos.set(n,{lastEdit:Date.now()})},[n,t.combos,a]),a?e(He,{to:"/combos"}):e(g,{display:"flex",flexDirection:"column",gap:1,children:e(p.Suspense,{fallback:Xt,children:n&&e(Ut,{comboId:n})})})}function Ut({comboId:t}){const n=de(),[a,o]=p.useState(0),s=p.useMemo(()=>({presetIndex:a,setPresetIndex:o}),[a,o]),r=A(t),{comboMetadata:h}=r,{params:{characterKey:u}}=Re({path:"/combos/:teamId/:characterKey",end:!1})??{params:{}},i=p.useMemo(()=>{const b=h.findIndex(C=>C&&C.characterKey===u);return b===-1?0:b},[h,u]),c=p.useMemo(()=>h[i],[h,i]),l=c==null?void 0:c.characterKey;p.useEffect(()=>{l&&l!==u&&n(`${l}`,{replace:!0})},[l,u,c,n]);const{t:f}=T(["charNames_gen","page_character"]);ht(p.useMemo(()=>{const b=f(l?"charNames_gen:Character":"Combo Settings");return`${r.name} - ${b}`},[l,f,r.name]));const m=p.useMemo(()=>{if(!(!t||!r||!c))return{comboId:t,combo:r,comboMetadatum:c}},[c,r,t]);return e(q.Provider,{value:s,children:e(wt,{comboId:t,currentChar:l,children:d(g,{sx:{display:"flex",gap:1,flexDirection:"column",mx:1,mt:2},children:[e(v,{sx:{overflow:"visible",top:0,position:"sticky",zIndex:100},children:e(Dt,{comboId:t,charKey:l})}),e(g,{children:m&&e(E.Provider,{value:m,children:e(Qt,{})})})]})})})}function Qt(){const{comboMetadatum:{characterKey:t}}=_(),n=Te(t),a=p.useMemo(()=>n&&{character:n},[n]);return a?e(Fe.Provider,{value:a,children:e(Xe,{children:e(ae,{path:":characterKey",children:e(ae,{path:"*",index:!0,element:e(Ht,{})})})})}):e(be,{variant:"rectangular",width:"100%",height:1e3})}export{un as default};
