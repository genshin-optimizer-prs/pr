import{a as Z,g as ee,s as _,_ as C,r as u,u as te,as as _t,at as It,e as oe,a8 as ye,au as Pt,m as At,j as S,f as U,h as re,av as je,P as Nt,i as zt,aw as Bt,ax as ke,b as B,ay as Se,x as Et,l as Lt,d as jt,K as v,B as r,Z as w,W as $,D,az as be,a4 as I,aA as Ot,ad as at,aB as Oe,ab as O,a1 as E,Y as P,aC as Wt,ae as $e,G as me,c as Kt,aD as Vt,aE as qt,aF as Me,aG as nt,aH as Gt,aI as ue,ah as we,ai as Re,aJ as Ut,aK as Ht,ac as pe,R as We,Q as Ke,L as Jt,aL as st,aM as it,aN as ie,aO as Ft,z as De,A as Te,ar as lt,a9 as ct,aP as Xt,aQ as ge,I as Qt,aa as Yt,aR as Zt,aS as Ve,aT as eo,F as to,aU as _e,aV as qe,aW as oo,aX as ro,aY as ao,aZ as no,a_ as so,a$ as io,b0 as lo,b1 as Ge}from"./index-DItwh30y.js";import{u as dt,S as ve,C as co,a as uo}from"./CharacterEditor-CmQI92kC.js";import{u as po,C as mo}from"./useForceUpdate-C81ibi3t.js";import{s as fo,t as ho,w as go,c as bo,l as vo,r as xo,a as Co,d as yo}from"./index-B09gK5Fa.js";import{u as ko}from"./useLightCone-K07GKUtq.js";import{T as So,d as $o,M as Ie,D as Pe}from"./DropdownButton-CzXN54ly.js";import{G as Mo,d as ut}from"./LocationAutocomplete-Dkv1m9Pk.js";import{C as pt}from"./CardActionArea-CKXzBt9E.js";import{u as wo,R as Ro}from"./RelicCard-Cjgwsfxc.js";import{I as Do}from"./InfoTooltip-CjbNqI3j.js";function To(e){return Z("MuiCollapse",e)}ee("MuiCollapse",["root","horizontal","vertical","entered","hidden","wrapper","wrapperInner"]);const _o=["addEndListener","children","className","collapsedSize","component","easing","in","onEnter","onEntered","onEntering","onExit","onExited","onExiting","orientation","style","timeout","TransitionComponent"],Io=e=>{const{orientation:t,classes:o}=e,a={root:["root",`${t}`],entered:["entered"],hidden:["hidden"],wrapper:["wrapper",`${t}`],wrapperInner:["wrapperInner",`${t}`]};return re(a,To,o)},Po=_("div",{name:"MuiCollapse",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:o}=e;return[t.root,t[o.orientation],o.state==="entered"&&t.entered,o.state==="exited"&&!o.in&&o.collapsedSize==="0px"&&t.hidden]}})(({theme:e,ownerState:t})=>C({height:0,overflow:"hidden",transition:e.transitions.create("height")},t.orientation==="horizontal"&&{height:"auto",width:0,transition:e.transitions.create("width")},t.state==="entered"&&C({height:"auto",overflow:"visible"},t.orientation==="horizontal"&&{width:"auto"}),t.state==="exited"&&!t.in&&t.collapsedSize==="0px"&&{visibility:"hidden"})),Ao=_("div",{name:"MuiCollapse",slot:"Wrapper",overridesResolver:(e,t)=>t.wrapper})(({ownerState:e})=>C({display:"flex",width:"100%"},e.orientation==="horizontal"&&{width:"auto",height:"100%"})),No=_("div",{name:"MuiCollapse",slot:"WrapperInner",overridesResolver:(e,t)=>t.wrapperInner})(({ownerState:e})=>C({width:"100%"},e.orientation==="horizontal"&&{width:"auto",height:"100%"})),mt=u.forwardRef(function(t,o){const a=te({props:t,name:"MuiCollapse"}),{addEndListener:n,children:s,className:c,collapsedSize:l="0px",component:p,easing:m,in:i,onEnter:d,onEntered:h,onEntering:f,onExit:b,onExited:g,onExiting:y,orientation:k="vertical",style:R,timeout:M=_t.standard,TransitionComponent:L=It}=a,J=oe(a,_o),W=C({},a,{orientation:k,collapsedSize:l}),A=Io(W),F=ye(),fe=Pt(),N=u.useRef(null),X=u.useRef(),K=typeof l=="number"?`${l}px`:l,j=k==="horizontal",Q=j?"width":"height",ne=u.useRef(null),kt=At(o,ne),V=x=>T=>{if(x){const z=ne.current;T===void 0?x(z):x(z,T)}},he=()=>N.current?N.current[j?"clientWidth":"clientHeight"]:0,St=V((x,T)=>{N.current&&j&&(N.current.style.position="absolute"),x.style[Q]=K,d&&d(x,T)}),$t=V((x,T)=>{const z=he();N.current&&j&&(N.current.style.position="");const{duration:Y,easing:se}=je({style:R,timeout:M,easing:m},{mode:"enter"});if(M==="auto"){const Le=F.transitions.getAutoHeightDuration(z);x.style.transitionDuration=`${Le}ms`,X.current=Le}else x.style.transitionDuration=typeof Y=="string"?Y:`${Y}ms`;x.style[Q]=`${z}px`,x.style.transitionTimingFunction=se,f&&f(x,T)}),Mt=V((x,T)=>{x.style[Q]="auto",h&&h(x,T)}),wt=V(x=>{x.style[Q]=`${he()}px`,b&&b(x)}),Rt=V(g),Dt=V(x=>{const T=he(),{duration:z,easing:Y}=je({style:R,timeout:M,easing:m},{mode:"exit"});if(M==="auto"){const se=F.transitions.getAutoHeightDuration(T);x.style.transitionDuration=`${se}ms`,X.current=se}else x.style.transitionDuration=typeof z=="string"?z:`${z}ms`;x.style[Q]=K,x.style.transitionTimingFunction=Y,y&&y(x)}),Tt=x=>{M==="auto"&&fe.start(X.current||0,x),n&&n(ne.current,x)};return S.jsx(L,C({in:i,onEnter:St,onEntered:Mt,onEntering:$t,onExit:wt,onExited:Rt,onExiting:Dt,addEndListener:Tt,nodeRef:ne,timeout:M==="auto"?null:M},J,{children:(x,T)=>S.jsx(Po,C({as:p,className:U(A.root,c,{entered:A.entered,exited:!i&&K==="0px"&&A.hidden}[x]),style:C({[j?"minWidth":"minHeight"]:K},R),ref:kt},T,{ownerState:C({},W,{state:x}),children:S.jsx(Ao,{ownerState:C({},W,{state:x}),className:A.wrapper,ref:N,children:S.jsx(No,{ownerState:C({},W,{state:x}),className:A.wrapperInner,children:s})})}))}))});mt.muiSupportAuto=!0;const ft=mt,zo=u.createContext({}),ht=zo;function Bo(e){return Z("MuiAccordion",e)}const Eo=ee("MuiAccordion",["root","rounded","expanded","disabled","gutters","region"]),le=Eo,Lo=["children","className","defaultExpanded","disabled","disableGutters","expanded","onChange","square","slots","slotProps","TransitionComponent","TransitionProps"],jo=e=>{const{classes:t,square:o,expanded:a,disabled:n,disableGutters:s}=e;return re({root:["root",!o&&"rounded",a&&"expanded",n&&"disabled",!s&&"gutters"],region:["region"]},Bo,t)},Oo=_(Nt,{name:"MuiAccordion",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:o}=e;return[{[`& .${le.region}`]:t.region},t.root,!o.square&&t.rounded,!o.disableGutters&&t.gutters]}})(({theme:e})=>{const t={duration:e.transitions.duration.shortest};return{position:"relative",transition:e.transitions.create(["margin"],t),overflowAnchor:"none","&::before":{position:"absolute",left:0,top:-1,right:0,height:1,content:'""',opacity:1,backgroundColor:(e.vars||e).palette.divider,transition:e.transitions.create(["opacity","background-color"],t)},"&:first-of-type":{"&::before":{display:"none"}},[`&.${le.expanded}`]:{"&::before":{opacity:0},"&:first-of-type":{marginTop:0},"&:last-of-type":{marginBottom:0},"& + &":{"&::before":{display:"none"}}},[`&.${le.disabled}`]:{backgroundColor:(e.vars||e).palette.action.disabledBackground}}},({theme:e})=>({variants:[{props:t=>!t.square,style:{borderRadius:0,"&:first-of-type":{borderTopLeftRadius:(e.vars||e).shape.borderRadius,borderTopRightRadius:(e.vars||e).shape.borderRadius},"&:last-of-type":{borderBottomLeftRadius:(e.vars||e).shape.borderRadius,borderBottomRightRadius:(e.vars||e).shape.borderRadius,"@supports (-ms-ime-align: auto)":{borderBottomLeftRadius:0,borderBottomRightRadius:0}}}},{props:t=>!t.disableGutters,style:{[`&.${le.expanded}`]:{margin:"16px 0"}}}]})),Wo=u.forwardRef(function(t,o){const a=te({props:t,name:"MuiAccordion"}),{children:n,className:s,defaultExpanded:c=!1,disabled:l=!1,disableGutters:p=!1,expanded:m,onChange:i,square:d=!1,slots:h={},slotProps:f={},TransitionComponent:b,TransitionProps:g}=a,y=oe(a,Lo),[k,R]=zt({controlled:m,default:c,name:"Accordion",state:"expanded"}),M=u.useCallback(j=>{R(!k),i&&i(j,!k)},[k,i,R]),[L,...J]=u.Children.toArray(n),W=u.useMemo(()=>({expanded:k,disabled:l,disableGutters:p,toggle:M}),[k,l,p,M]),A=C({},a,{square:d,disabled:l,disableGutters:p,expanded:k}),F=jo(A),fe=C({transition:b},h),N=C({transition:g},f),[X,K]=wo("transition",{elementType:ft,externalForwardedProps:{slots:fe,slotProps:N},ownerState:A});return S.jsxs(Oo,C({className:U(F.root,s),ref:o,ownerState:A,square:d},y,{children:[S.jsx(ht.Provider,{value:W,children:L}),S.jsx(X,C({in:k,timeout:"auto"},K,{children:S.jsx("div",{"aria-labelledby":L.props.id,id:L.props["aria-controls"],role:"region",className:F.region,children:J})}))]}))}),Ue=Wo;function Ko(e){return Z("MuiAccordionDetails",e)}ee("MuiAccordionDetails",["root"]);const Vo=["className"],qo=e=>{const{classes:t}=e;return re({root:["root"]},Ko,t)},Go=_("div",{name:"MuiAccordionDetails",slot:"Root",overridesResolver:(e,t)=>t.root})(({theme:e})=>({padding:e.spacing(1,2,2)})),Uo=u.forwardRef(function(t,o){const a=te({props:t,name:"MuiAccordionDetails"}),{className:n}=a,s=oe(a,Vo),c=a,l=qo(c);return S.jsx(Go,C({className:U(l.root,n),ref:o,ownerState:c},s))}),He=Uo;function Ho(e){return Z("MuiAccordionSummary",e)}const Jo=ee("MuiAccordionSummary",["root","expanded","focusVisible","disabled","gutters","contentGutters","content","expandIconWrapper"]),q=Jo,Fo=["children","className","expandIcon","focusVisibleClassName","onClick"],Xo=e=>{const{classes:t,expanded:o,disabled:a,disableGutters:n}=e;return re({root:["root",o&&"expanded",a&&"disabled",!n&&"gutters"],focusVisible:["focusVisible"],content:["content",o&&"expanded",!n&&"contentGutters"],expandIconWrapper:["expandIconWrapper",o&&"expanded"]},Ho,t)},Qo=_(Bt,{name:"MuiAccordionSummary",slot:"Root",overridesResolver:(e,t)=>t.root})(({theme:e})=>{const t={duration:e.transitions.duration.shortest};return{display:"flex",minHeight:48,padding:e.spacing(0,2),transition:e.transitions.create(["min-height","background-color"],t),[`&.${q.focusVisible}`]:{backgroundColor:(e.vars||e).palette.action.focus},[`&.${q.disabled}`]:{opacity:(e.vars||e).palette.action.disabledOpacity},[`&:hover:not(.${q.disabled})`]:{cursor:"pointer"},variants:[{props:o=>!o.disableGutters,style:{[`&.${q.expanded}`]:{minHeight:64}}}]}}),Yo=_("div",{name:"MuiAccordionSummary",slot:"Content",overridesResolver:(e,t)=>t.content})(({theme:e})=>({display:"flex",flexGrow:1,margin:"12px 0",variants:[{props:t=>!t.disableGutters,style:{transition:e.transitions.create(["margin"],{duration:e.transitions.duration.shortest}),[`&.${q.expanded}`]:{margin:"20px 0"}}}]})),Zo=_("div",{name:"MuiAccordionSummary",slot:"ExpandIconWrapper",overridesResolver:(e,t)=>t.expandIconWrapper})(({theme:e})=>({display:"flex",color:(e.vars||e).palette.action.active,transform:"rotate(0deg)",transition:e.transitions.create("transform",{duration:e.transitions.duration.shortest}),[`&.${q.expanded}`]:{transform:"rotate(180deg)"}})),er=u.forwardRef(function(t,o){const a=te({props:t,name:"MuiAccordionSummary"}),{children:n,className:s,expandIcon:c,focusVisibleClassName:l,onClick:p}=a,m=oe(a,Fo),{disabled:i=!1,disableGutters:d,expanded:h,toggle:f}=u.useContext(ht),b=k=>{f&&f(k),p&&p(k)},g=C({},a,{expanded:h,disabled:i,disableGutters:d}),y=Xo(g);return S.jsxs(Qo,C({focusRipple:!1,disableRipple:!0,disabled:i,component:"div","aria-expanded":h,className:U(y.root,s),focusVisibleClassName:U(y.focusVisible,l),onClick:b,ref:o,ownerState:g},m,{children:[S.jsx(Yo,{className:y.content,ownerState:g,children:n}),c&&S.jsx(Zo,{className:y.expandIconWrapper,ownerState:g,children:c})]}))}),Je=er;function tr(e){return Z("MuiLinearProgress",e)}ee("MuiLinearProgress",["root","colorPrimary","colorSecondary","determinate","indeterminate","buffer","query","dashed","dashedColorPrimary","dashedColorSecondary","bar","barColorPrimary","barColorSecondary","bar1Indeterminate","bar1Determinate","bar1Buffer","bar2Indeterminate","bar2Buffer"]);const or=["className","color","value","valueBuffer","variant"];let H=e=>e,Fe,Xe,Qe,Ye,Ze,et;const xe=4,rr=ke(Fe||(Fe=H`
  0% {
    left: -35%;
    right: 100%;
  }

  60% {
    left: 100%;
    right: -90%;
  }

  100% {
    left: 100%;
    right: -90%;
  }
`)),ar=ke(Xe||(Xe=H`
  0% {
    left: -200%;
    right: 100%;
  }

  60% {
    left: 107%;
    right: -8%;
  }

  100% {
    left: 107%;
    right: -8%;
  }
`)),nr=ke(Qe||(Qe=H`
  0% {
    opacity: 1;
    background-position: 0 -23px;
  }

  60% {
    opacity: 0;
    background-position: 0 -23px;
  }

  100% {
    opacity: 1;
    background-position: -200px -23px;
  }
`)),sr=e=>{const{classes:t,variant:o,color:a}=e,n={root:["root",`color${B(a)}`,o],dashed:["dashed",`dashedColor${B(a)}`],bar1:["bar",`barColor${B(a)}`,(o==="indeterminate"||o==="query")&&"bar1Indeterminate",o==="determinate"&&"bar1Determinate",o==="buffer"&&"bar1Buffer"],bar2:["bar",o!=="buffer"&&`barColor${B(a)}`,o==="buffer"&&`color${B(a)}`,(o==="indeterminate"||o==="query")&&"bar2Indeterminate",o==="buffer"&&"bar2Buffer"]};return re(n,tr,t)},Ae=(e,t)=>t==="inherit"?"currentColor":e.vars?e.vars.palette.LinearProgress[`${t}Bg`]:e.palette.mode==="light"?Lt(e.palette[t].main,.62):jt(e.palette[t].main,.5),ir=_("span",{name:"MuiLinearProgress",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:o}=e;return[t.root,t[`color${B(o.color)}`],t[o.variant]]}})(({ownerState:e,theme:t})=>C({position:"relative",overflow:"hidden",display:"block",height:4,zIndex:0,"@media print":{colorAdjust:"exact"},backgroundColor:Ae(t,e.color)},e.color==="inherit"&&e.variant!=="buffer"&&{backgroundColor:"none","&::before":{content:'""',position:"absolute",left:0,top:0,right:0,bottom:0,backgroundColor:"currentColor",opacity:.3}},e.variant==="buffer"&&{backgroundColor:"transparent"},e.variant==="query"&&{transform:"rotate(180deg)"})),lr=_("span",{name:"MuiLinearProgress",slot:"Dashed",overridesResolver:(e,t)=>{const{ownerState:o}=e;return[t.dashed,t[`dashedColor${B(o.color)}`]]}})(({ownerState:e,theme:t})=>{const o=Ae(t,e.color);return C({position:"absolute",marginTop:0,height:"100%",width:"100%"},e.color==="inherit"&&{opacity:.3},{backgroundImage:`radial-gradient(${o} 0%, ${o} 16%, transparent 42%)`,backgroundSize:"10px 10px",backgroundPosition:"0 -23px"})},Se(Ye||(Ye=H`
    animation: ${0} 3s infinite linear;
  `),nr)),cr=_("span",{name:"MuiLinearProgress",slot:"Bar1",overridesResolver:(e,t)=>{const{ownerState:o}=e;return[t.bar,t[`barColor${B(o.color)}`],(o.variant==="indeterminate"||o.variant==="query")&&t.bar1Indeterminate,o.variant==="determinate"&&t.bar1Determinate,o.variant==="buffer"&&t.bar1Buffer]}})(({ownerState:e,theme:t})=>C({width:"100%",position:"absolute",left:0,bottom:0,top:0,transition:"transform 0.2s linear",transformOrigin:"left",backgroundColor:e.color==="inherit"?"currentColor":(t.vars||t).palette[e.color].main},e.variant==="determinate"&&{transition:`transform .${xe}s linear`},e.variant==="buffer"&&{zIndex:1,transition:`transform .${xe}s linear`}),({ownerState:e})=>(e.variant==="indeterminate"||e.variant==="query")&&Se(Ze||(Ze=H`
      width: auto;
      animation: ${0} 2.1s cubic-bezier(0.65, 0.815, 0.735, 0.395) infinite;
    `),rr)),dr=_("span",{name:"MuiLinearProgress",slot:"Bar2",overridesResolver:(e,t)=>{const{ownerState:o}=e;return[t.bar,t[`barColor${B(o.color)}`],(o.variant==="indeterminate"||o.variant==="query")&&t.bar2Indeterminate,o.variant==="buffer"&&t.bar2Buffer]}})(({ownerState:e,theme:t})=>C({width:"100%",position:"absolute",left:0,bottom:0,top:0,transition:"transform 0.2s linear",transformOrigin:"left"},e.variant!=="buffer"&&{backgroundColor:e.color==="inherit"?"currentColor":(t.vars||t).palette[e.color].main},e.color==="inherit"&&{opacity:.3},e.variant==="buffer"&&{backgroundColor:Ae(t,e.color),transition:`transform .${xe}s linear`}),({ownerState:e})=>(e.variant==="indeterminate"||e.variant==="query")&&Se(et||(et=H`
      width: auto;
      animation: ${0} 2.1s cubic-bezier(0.165, 0.84, 0.44, 1) 1.15s infinite;
    `),ar)),ur=u.forwardRef(function(t,o){const a=te({props:t,name:"MuiLinearProgress"}),{className:n,color:s="primary",value:c,valueBuffer:l,variant:p="indeterminate"}=a,m=oe(a,or),i=C({},a,{color:s,variant:p}),d=sr(i),h=Et(),f={},b={bar1:{},bar2:{}};if((p==="determinate"||p==="buffer")&&c!==void 0){f["aria-valuenow"]=Math.round(c),f["aria-valuemin"]=0,f["aria-valuemax"]=100;let g=c-100;h&&(g=-g),b.bar1.transform=`translateX(${g}%)`}if(p==="buffer"&&l!==void 0){let g=(l||0)-100;h&&(g=-g),b.bar2.transform=`translateX(${g}%)`}return S.jsxs(ir,C({className:U(d.root,n),ownerState:i,role:"progressbar"},f,{ref:o},m,{children:[p==="buffer"?S.jsx(lr,{className:d.dashed,ownerState:i}):null,S.jsx(cr,{className:d.bar1,ownerState:i,style:b.bar1}),p==="determinate"?null:S.jsx(dr,{className:d.bar2,ownerState:i,style:b.bar2})]}))}),pr=ur;function mr({avatar:e,title:t,action:o}){return v($,{display:"flex",gap:1,p:2,alignItems:"center",children:[e,r(w,{variant:"subtitle1",sx:{flexGrow:1},children:t}),o&&r(w,{variant:"caption",children:o})]})}function fr({condition:e,wrapper:t,falseWrapper:o,children:a}){return e?t(a):o?o(a):a}function tt({value:e,onChange:t,...o}){const[a,n]=u.useState(e);u.useEffect(()=>{n(e)},[e]);const s=()=>t(a);return r(So,{value:a,onChange:c=>n(c.target.value),onBlur:s,onKeyDown:c=>c.key==="Enter"&&!o.multiline&&s(),...o})}function hr(e){const{t}=D("ui"),o=be({path:"/:page/*"}),a=t("pageTitle"),n=e??((o==null?void 0:o.params.page)&&t(`tabs.${o==null?void 0:o.params.page}`));u.useEffect(()=>{n?document.title=`${n} - ${a}`:document.title=a},[t,a,n])}function Ne(e,t){const[o,a]=po(),n=u.useMemo(()=>o&&e.get(t),[o,e,t]);return u.useEffect(()=>e.follow(t,a),[e,t,a]),n}function gr(e){const{database:t}=I();return Ne(t.builds,e??"")}function gt(e){const t=u.useMemo(()=>e||Ot(at,()=>""),[e]),{database:o}=I(),[a,n]=u.useState(()=>Oe(t,s=>o.relics.get(s)));return u.useEffect(()=>{n(Oe(t,c=>o.relics.get(c)));const s=Object.values(t).map(c=>o.relics.follow(c,(l,p,m)=>{p==="update"&&n(i=>({...i,[m.slotKey]:m})),p==="remove"&&n(i=>({...i,[m.slotKey]:void 0}))}));return()=>s.forEach(c=>c())},[o,t]),a}function G(e){const{database:t}=I();return Ne(t.loadouts,e??"")}function bt(e){const{database:t}=I();return Ne(t.teams,e)}function br({slot:e}){const{t}=D("relic");return r(E,{sx:{height:"100%"},children:v(O,{children:[v(w,{children:[t("slot"),": ",e]}),r(w,{children:t("empty")})]})})}function vr({build:e}){const t=gt(e);return r(P,{container:!0,columns:3,spacing:1,children:at.map(o=>{const a=t[o];return r(P,{item:!0,xs:1,children:a?r(Ro,{relic:a}):r(br,{slot:o})},`${o}_${a==null?void 0:a.id}`)})})}function xr({charKey:e,setCharKey:t}){const{t:o}=D(["character","charNames_gen"]),{database:a}=I(),n=u.useCallback(l=>!!a.chars.get(l),[a.chars]),s=u.useCallback(l=>a.charMeta.get(l).favorite,[a.charMeta]),c=u.useMemo(()=>[{key:"",label:o("character:autocomplete.none")},...Wt.map(l=>({key:l,label:o(`charNames_gen:${l}`),favorite:s(l),color:n(l)?void 0:"secondary"}))],[n,s,o]);return r(u.Suspense,{fallback:r($e,{variant:"text",width:100}),children:r(Mo,{options:c,toImg:()=>r(me,{children:" "}),valueKey:e,onChange:l=>t(l??"")})})}const Cr=Kt(S.jsx("path",{d:"M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zm2.46-7.12 1.41-1.41L12 12.59l2.12-2.12 1.41 1.41L13.41 14l2.12 2.12-1.41 1.41L12 15.41l-2.12 2.12-1.41-1.41L10.59 14l-2.13-2.12zM15.5 4l-1-1h-5l-1 1H5v2h14V4z"}),"DeleteForever"),yr={RuanMei:Vt};function kr({document:e,bgt:t="normal",collapse:o=!1}){switch(e.type){case"fields":return r(Sr,{fieldsDocument:e,bgt:t});case"text":return o?r($r,{textDocument:e}):r(vt,{textDocument:e});case"conditional":return null;default:return null}}function Sr({fieldsDocument:e,bgt:t="normal"}){return v(E,{bgt:t,children:[e.header&&r(Mr,{header:e.header,hideDivider:e.fields.length===0}),r(qt,{bgt:t,fields:e.fields})]})}function vt({textDocument:e}){const t=u.useContext(Me),o=u.useContext(nt);return!o||!t?null:r("div",{children:Gt(e.text,t,o)})}function $r({textDocument:e}){const[t,o]=u.useState(!1),[a,n]=u.useState(!1);return v($,{sx:{position:"relative"},children:[!t&&r($,{sx:{pointerEvents:"none",position:"absolute",mx:"auto",width:"100%",display:"flex",justifyContent:"center",height:"100%",alignItems:"flex-end",zIndex:"10",transition:"transform 0.3s ease",transform:a?"translate(0,-5px)":void 0},children:r($o,{})}),r(ft,{onMouseEnter:()=>n(!0),onMouseLeave:()=>n(!1),collapsedSize:55,onClick:()=>o(s=>!s),in:t,sx:{cursor:"pointer",position:"relative",maskImage:t?void 0:"linear-gradient(to bottom, black 0%, transparent 100%)","&:hover":{maskImage:t?void 0:"linear-gradient(to bottom, black 50%, transparent 100%)"}},children:r(vt,{textDocument:e})})]})}function Mr({header:e,hideDivider:t}){const{icon:o,text:a,additional:n}=e;return v(me,{children:[r(mr,{avatar:o,title:a,action:n}),!t&&r(ue,{})]})}function ae(){return u.useContext(Me)}function xt({optTarget:e,setOptTarget:t}){const{t:o}=D("optimize"),a=ae(),n=we(Re,{et:"self",src:"0"});return r(Pe,{title:`${o("optTarget")}${e?`: ${e.tag.name||e.tag.q}`:""}`,children:a==null?void 0:a.listFormulas(n.listing.formulas).map((s,c)=>r(Ie,{onClick:()=>t(s),children:s.tag.name||s.tag.q},`${c}_${s.tag.name||s.tag.q}`))})}function wr({statFilters:e,setStatFilters:t,disabled:o=!1}){const a=u.useCallback((p,m,i)=>{const d={...e},h=JSON.stringify(m),f=m?[...e[h]]:void 0,b=JSON.stringify(p),g=[...e[b]??[]];i!==void 0&&f?g.push(f[i]):g.push({minValue:0,maxValue:0,disabled:!1}),d[b]=g,i!==void 0&&f&&(f.splice(i,1),f.length?d[h]=f:delete d[h]),t({...d})},[t,e]),n=u.useCallback((p,m)=>{const i={...e},d=JSON.stringify(p),h=[...e[d]];h.splice(m,1),h.length?i[d]=h:delete i[d],t({...i})},[t,e]),s=u.useCallback((p,m,i)=>{const d={...e},h=JSON.stringify(p),f=[...e[h]];f[m]={...f[m],minValue:i},d[h]=f,t({...d})},[t,e]),c=u.useCallback((p,m,i)=>{const d={...e},h=JSON.stringify(p),f=[...e[h]];f[m]={...f[m],maxValue:i},d[h]=f,t({...d})},[t,e]),l=u.useCallback((p,m,i)=>{const d={...e},h=JSON.stringify(p),f=[...e[h]];f[m]={...f[m],disabled:i},d[h]=f,t({...d})},[t,e]);return v(me,{children:[Object.entries(e).flatMap(([p,m])=>m==null?void 0:m.map((i,d)=>r(ot,{path:JSON.parse(p),setting:i,index:d,setTarget:a,delTarget:n,setMinValue:s,setMaxValue:c,setDisabled:l,disabled:o},p+d))),r(ot,{delTarget:n,setTarget:a,setMinValue:s,setMaxValue:c,setDisabled:l,disabled:o})]})}function ot({path:e,setting:t,index:o,delTarget:a,setMinValue:n,setMaxValue:s,setDisabled:c,disabled:l}){const{t:p}=D("page_character_optimize"),m=u.useCallback(b=>e&&o!==void 0&&n(e,o,b??0),[n,e,o]),i=u.useCallback(b=>e&&o!==void 0&&s(e,o,b??1/0),[s,e,o]),[d,h]=u.useState(void 0),f={p:1,flexBasis:30,flexGrow:0,flexShrink:0};return v(Jt,{sx:{"& .MuiButtonGroup-grouped":{minWidth:24},width:"100%"},children:[!!t&&!!e&&o!==void 0&&r(pe,{sx:f,color:t.disabled?"secondary":"success",onClick:()=>c(e,o,!t.disabled),disabled:l,children:t.disabled?r(Ut,{}):r(Ht,{})}),r(Ke,{sx:{flexBasis:150,flexGrow:1},children:r(We,{float:!0,disabled:!e||l,value:t==null?void 0:t.minValue,placeholder:p("buildConstraint.minStatValue"),onChange:m,sx:{px:1},inputProps:{sx:{"& + .MuiOutlinedInput-notchedOutline":{borderRadius:0},textAlign:"right"}}})}),r(xt,{optTarget:d,setOptTarget:h}),r(Ke,{sx:{flexBasis:150,flexGrow:1},children:r(We,{float:!0,disabled:!e||l,value:t==null?void 0:t.maxValue,placeholder:p("buildConstraint.maxStatValue"),onChange:i,sx:{px:1},inputProps:{sx:{"& + .MuiOutlinedInput-notchedOutline":{borderRadius:0},textAlign:"left"}}})}),!!e&&o!==void 0&&r(pe,{sx:f,color:"error",onClick:()=>a(e,o),disabled:l,children:r(Cr,{fontSize:"small"})})]})}function Rr({disabled:e=!1}){const{t}=D("page_character_optimize"),[o,a]=u.useState({});return r($,{children:v(E,{bgt:"light",children:[r(O,{sx:{display:"flex",gap:1,justifyContent:"space-between",flexDirection:"column"},children:v($,{display:"flex",justifyContent:"space-between",children:[r(w,{sx:{fontWeight:"bold"},children:t`constraintFilter.title`}),r(Do,{title:r(w,{children:t`constraintFilter.tooltip`})})]})}),r(ue,{}),r($,{display:"flex",flexDirection:"column",gap:.5,children:r(wr,{statFilters:o,setStatFilters:a,disabled:e})})]})})}function Dr({numWorkers:e,setNumWorkers:t}){const{t:o}=D("optimize"),a=navigator.hardwareConcurrency||8;return r(Pe,{title:`${o("numWorkers")}: ${e}`,children:st(1,a).map(n=>r(Ie,{onClick:()=>t(n),children:o("workers",{count:n})},n))})}function Tr({teamId:e,children:t}){var f,b,g,y;const o=bt(e),a=G((f=o.loadoutMetadata[0])==null?void 0:f.loadoutId),n=G((b=o.loadoutMetadata[1])==null?void 0:b.loadoutId),s=G((g=o.loadoutMetadata[2])==null?void 0:g.loadoutId),c=G((y=o.loadoutMetadata[3])==null?void 0:y.loadoutId),l={all:"all"};a&&(l[a.key]="0"),n&&(l[n.key]="1"),s&&(l[s.key]="2"),c&&(l[c.key]="3");const p=ce(o.loadoutMetadata[0],l),m=ce(o.loadoutMetadata[1],l),i=ce(o.loadoutMetadata[2],l),d=ce(o.loadoutMetadata[3],l),h=u.useMemo(()=>fo([...ho(o.loadoutMetadata.map((k,R)=>k===void 0?void 0:it[R]).filter(k=>!!k)),...p?de(0,p):[],...m?de(1,m):[],...i?de(2,i):[],...d?de(3,d):[],ie.common.lvl.add(80),ie.common.res.add(.1),ie.common.isBroken.add(0),ie.common.maxToughness.add(100),Ft.common.critMode.add("avg")]),[p,m,i,d,o.loadoutMetadata]);return r(Me.Provider,{value:h,children:t})}function ce(e,t){const o=G(e==null?void 0:e.loadoutId),a=dt(o==null?void 0:o.key),n=gr(e==null?void 0:e.buildId),s=ko(n==null?void 0:n.lightConeId),c=gt(n==null?void 0:n.relicIds),l=o==null?void 0:o.conditional,p=Object.fromEntries(Object.entries(l??{}).map(([m,i])=>[t[m],i]));return{character:a,lightCone:s,relics:c,conditionals:p}}function de(e,{character:t,lightCone:o,relics:a,conditionals:n}){return t?[...go(`${e}`,...bo(t),...vo(o),...xo(Object.values(a).filter(s=>!!s).map(s=>({set:s.setKey,stats:[...s.substats.filter(({key:c})=>c!=="").map(c=>({key:c.key,value:c.accurateValue})),{key:s.mainStatKey,value:s.mainStatVal}]})))),...Co(`${e}`,n)]:[]}var ze={},_r=Te;Object.defineProperty(ze,"__esModule",{value:!0});var Ct=ze.default=void 0,Ir=_r(De()),Pr=S,Ar=(0,Ir.default)((0,Pr.jsx)("path",{d:"M22 24H2v-4h20v4zM13.06 5.19l3.75 3.75L7.75 18H4v-3.75l9.06-9.06zm4.82 2.68-3.75-3.75 1.83-1.83c.39-.39 1.02-.39 1.41 0l2.34 2.34c.39.39.39 1.02 0 1.41l-1.83 1.83z"}),"BorderColor");Ct=ze.default=Ar;function Nr({teamId:e,charKey:t,tab:o=""}){const{t:a}=D("page_team"),n=lt(),{database:s}=I(),c=s.teams.get(e),{loadoutMetadata:l}=c,p=ye(),m=ct(p.breakpoints.down("md")),[i,d]=u.useState(!1),h=b=>{s.teams.set(e,{name:b})},f=b=>{s.teams.set(e,{description:b})};return v($,{sx:()=>({borderBottom:"1px rgb(200,200,200,0.3) solid","& .MuiTab-root:hover":{transition:"background-color 0.25s ease",backgroundColor:"rgba(255,255,255,0.1)"},"& .Mui-selected":{color:"white !important"},"& .MuiTabs-indicator":{height:"4px",backgroundColor:"rgb(200,200,200,0.5)"}}),children:[r(pt,{onClick:()=>d(!0),children:r(Xt,{placement:"top",title:v($,{children:[v($,{sx:{display:"flex",color:"info.light",gap:1},children:[r(Ct,{}),r(w,{children:r("strong",{children:a`team.editNameDesc`})})]}),!!c.description&&r(w,{children:c.description})]}),children:r(O,{sx:{display:"flex",justifyContent:"center","&:hover":{color:"info.light"}},children:v(w,{variant:"h5",sx:{display:"flex",gap:1,alignItems:"center",justifyContent:"center",textShadow:"#000 0 0 10px !important"},children:[r(ge,{}),c.name]})})})}),r(Yt,{open:i,onClose:()=>d(!1),children:v(E,{children:[r(mo,{title:a`team.editNameDesc`,avatar:r(ge,{}),titleTypographyProps:{variant:"h6"},action:r(Qt,{onClick:()=>d(!1),children:r(ut,{})})}),r(ue,{}),r(O,{children:v($,{display:"flex",flexDirection:"column",gap:2,sx:{mt:2},children:[r(tt,{label:a`team.name`,value:c.name,onChange:b=>h(b),autoFocus:!0}),r(tt,{label:a`team.desc`,value:c.description,onChange:b=>f(b),multiline:!0,minRows:4})]})})]})}),r(ue,{}),v(Zt,{variant:"fullWidth",value:t??"team",orientation:m?"vertical":"horizontal",children:[r(Ve,{icon:r(ge,{}),iconPosition:"start",value:"team",label:"Team Settings",onClick:()=>n(`/teams/${e}/`)}),l.map((b,g)=>{var k;const y=b&&((k=s.loadouts.get(b==null?void 0:b.loadoutId))==null?void 0:k.key);return r(Ve,{icon:r(eo,{}),iconPosition:"start",value:y??g,disabled:!l[g],label:y?r(w,{children:a(`charNames_gen:${y}`)}):`Character ${g+1}`,onClick:()=>y&&n(`/teams/${e}/${y}/${o}`)},g)})]})]})}function zr({teamId:e}){const{database:t}=I(),o=t.teams.get(e);return v($,{children:[e,o.loadoutMetadata.map((a,n)=>r(Br,{loadoutMetadataIndex:n,teamId:e},`${n}_${a==null?void 0:a.loadoutId}`))]})}function Br({loadoutMetadataIndex:e,teamId:t}){var l;const{database:o}=I(),a=o.teams.get(t),n=(l=a.loadoutMetadata[e])==null?void 0:l.loadoutId,s=o.loadouts.get(n);function c(p){if(p===""){o.teams.set(t,i=>i.loadoutMetadata[e]=void 0);return}o.chars.getOrCreate(p);const m=a.loadoutMetadata.findIndex(i=>{var d;return i&&((d=o.loadouts.get(i.loadoutId))==null?void 0:d.key)===p});if(m===-1){let i=o.loadouts.keys.find(d=>o.loadouts.get(d).key===p);i||(i=o.loadouts.new(p)),o.teams.set(t,d=>{d.loadoutMetadata[e]={loadoutId:i}})}else{if(m===e)return;const i=a.loadoutMetadata[m],d=a.loadoutMetadata[e];o.teams.set(t,h=>{h.loadoutMetadata[e]=i,h.loadoutMetadata[m]=d})}}return r(xr,{charKey:(s==null?void 0:s.key)??"",setCharKey:c})}var Be={},Er=Te;Object.defineProperty(Be,"__esModule",{value:!0});var Ce=Be.default=void 0,Lr=Er(De()),jr=S,Or=(0,Lr.default)((0,jr.jsx)("path",{d:"M16.59 8.59 12 13.17 7.41 8.59 6 10l6 6 6-6z"}),"ExpandMore");Ce=Be.default=Or;const Wr=5e4;class Kr{constructor(t,o,a,n,s){this.calc=t,this.optTarget=o,this.relicsBySlot=a,this.numWorkers=n,this.setProgress=s,this.worker=new Worker(new URL(""+new URL("parentWorker-CE4m1G7S.js",import.meta.url).href,import.meta.url),{type:"module"})}async optimize(){return await new Promise((o,a)=>{this.worker.onmessage=({data:s})=>{switch(s.resultType){case"progress":this.setProgress(s.progress);break;case"done":o(s.buildResults);break;case"err":console.log(s),a();break}};const n={command:"start",relicsBySlot:this.relicsBySlot,detachedNodes:this.detachNodes(),numWorkers:this.numWorkers};this.worker.postMessage(n)})}async terminate(){const t={command:"terminate"};this.worker.postMessage(t),await new Promise((o,a)=>{this.worker.onmessage=({data:n})=>{switch(n.resultType){case"terminated":o();break;case"err":console.log(n),a();break}}}),this.worker.terminate()}detachNodes(){const t=new Set(to);return yo([this.optTarget],this.calc,a=>{if(a.src==="0"&&a.et==="self"){if(a.sheet==="dyn"&&a.qt==="premod")return{q:a.q};if(a.q==="count"&&t.has(a.sheet))return{q:a.sheet}}})}}var Ee={},Vr=Te;Object.defineProperty(Ee,"__esModule",{value:!0});var yt=Ee.default=void 0,qr=Vr(De()),Gr=S,Ur=(0,qr.default)((0,Gr.jsx)("path",{d:"m16 6 2.29 2.29-4.88 4.88-4-4L2 16.59 3.41 18l6-6 4 4 6.3-6.29L22 12V6z"}),"TrendingUp");yt=Ee.default=Ur;function Hr(){const{t:e}=D("optimize"),{database:t}=I(),o=ae(),[a,n]=u.useState(8),[s,c]=u.useState(void 0),[l,p]=u.useState(void 0),m=u.useMemo(()=>t.relics.values.reduce((R,M)=>(R[M.slotKey].push(M),R),{head:[],hand:[],feet:[],body:[],sphere:[],rope:[]}),[t.relics.values]),i=Object.values(m).reduce((R,M)=>R*M.length,1),[d,h]=u.useState(void 0),[f,b]=u.useState(!1),g=u.useRef(()=>{});u.useEffect(()=>()=>g.current(),[]);const y=u.useCallback(async()=>{if(!l||!o)return;const R=new Promise(J=>g.current=J);c(void 0),b(!0);const M=new Kr(o,l,m,a,c);R.then(async()=>await M.terminate());const L=await M.optimize();await M.terminate(),g.current=()=>{},b(!1),h(L[0])},[o,a,l,m]),k=u.useCallback(()=>{g.current(),b(!1)},[g]);return r(E,{bgt:"dark",children:v(O,{children:[r(Rr,{}),v(ve,{children:[r(w,{variant:"h5",children:e("optimize")}),v($,{children:[r(xt,{optTarget:l,setOptTarget:p}),r(Dr,{numWorkers:a,setNumWorkers:n}),r(pe,{onClick:f?k:y,color:f?"error":"primary",startIcon:f?r(ut,{}):r(yt,{}),children:e(f?"cancel":"optimize")})]}),s&&r(Jr,{progress:s,totalPermutations:i}),d&&v($,{children:[v(w,{children:["Best: ",d.value]}),r(vr,{build:d.ids})]})]})]})})}function Jr({progress:e,totalPermutations:t}){const{t:o}=D("optimize");return v($,{children:[v(w,{children:[o("totalProgress"),": ",e.numBuildsComputed.toLocaleString()," /"," ",t.toLocaleString()]}),v(w,{children:[o("buildsKept"),": ",e.numBuildsKept.toLocaleString()," /"," ",Wr.toLocaleString()]}),r(pr,{variant:"determinate",value:e.numBuildsComputed/t*100})]})}const Fr={xs:12,sm:6,md:4};function Xr(){const{loadout:{key:e}}=_e(),t=ae(),{t:o}=D("sheet_gen"),a=[["basic",o("talents.basic")],["skill",o("talents.skill")],["ultimate",o("talents.ultimate")]],n=ye(),s=ct(n.breakpoints.up("lg")),c=yr[e];if(console.log({characterSheet:c,calc:t}),!(!c||!t))return r(me,{children:v(P,{container:!0,spacing:1,children:[s&&r(P,{item:!0,xs:12,md:12,lg:3,sx:{display:"flex",flexDirection:"column",gap:1},children:r(rt,{})}),r(P,{item:!0,xs:12,md:12,lg:9,container:!0,spacing:1,children:a.map(([l,p])=>{const m=c[l];return m?r(P,{item:!0,...Fr,children:r(Qr,{talentKey:l,subtitle:p,sheetElement:m})},l):null})}),!s&&r(P,{item:!0,xs:12,md:12,lg:3,container:!0,spacing:1,children:r(P,{item:!0,xs:12,children:r(rt,{})})})]})})}function Qr({sheetElement:e,subtitle:t,onClickTitle:o}){const a=u.useCallback(s=>r(pt,{onClick:o,children:s}),[o]);let n=null;return n=null,v(E,{bgt:"light",sx:{height:"100%"},children:[n,v(O,{children:[r(fr,{condition:!!o,wrapper:a,children:v(P,{container:!0,sx:{flexWrap:"nowrap"},children:[r(P,{item:!0,children:r($,{component:qe?qe:"img",src:e==null?void 0:e.img,sx:{width:60,height:"auto"}})}),v(P,{item:!0,flexGrow:1,sx:{pl:1},children:[r(w,{variant:"h6",children:e==null?void 0:e.name}),r(w,{variant:"subtitle1",children:t})]})]})}),e.documents.map((s,c)=>r(kr,{document:s,collapse:!0},c))]})]})}function rt(){const{t:e}=D("sheet_gen"),t=ae();if(!t)return null;const o=we(Re,{et:"self",src:"0"}),a=t.compute(o.char.eidolon).val;return r(Pe,{fullWidth:!0,title:e("constellationLvl",{level:a}),color:"primary",children:st(0,oo).map(n=>r(Ie,{selected:a===n,disabled:a===n,onClick:()=>{},children:e("constellationLvl",{level:n})},n))})}function Yr({tab:e}){const{team:t,loadout:{key:o}}=_e(),{database:a}=I(),{character:n}=ro(),s=ae(),[c,l]=u.useState(void 0),p=t.loadoutMetadata.findIndex(i=>{var d;return((d=a.loadouts.get(i==null?void 0:i.loadoutId))==null?void 0:d.key)===o}),m=we(Re,{et:"self",src:it[p]});return r(nt.Provider,{value:m,children:v($,{children:[e,r(co,{characterKey:c,onClose:()=>l(void 0)}),r(uo,{character:n}),v(ve,{gap:1,pt:1,children:[r(E,{bgt:"dark",children:v(O,{children:[r(pe,{disabled:!o,onClick:()=>o&&l(o),children:"Edit Character"}),v(Ue,{children:[r(Je,{expandIcon:r(Ce,{}),children:"All target values, if sheet is created"}),r(He,{children:r(ve,{children:s==null?void 0:s.listFormulas(m.listing.formulas).map((i,d)=>{const h=s.compute(i),f=i.tag.name||i.tag.q;return v($,{children:[v(w,{children:[f,": ",h.val]}),v(Ue,{children:[v(Je,{expandIcon:r(Ce,{}),children:["debug for ",f]}),r(He,{children:r(w,{component:"pre",children:JSON.stringify(s.toDebug().compute(i),void 0,2)})})]})]},`${f}${d}`)})})})]})]})}),r(Xr,{}),r(Hr,{})]})]})})}const Zr=r($e,{variant:"rectangular",width:"100%",height:1e3});function pa(){const{database:e}=I(),{teamId:t}=ao(),o=!t||!e.teams.keys.includes(t);return u.useEffect(()=>{o||e.teams.set(t,{lastEdit:Date.now()})},[t,e.teams,o]),o?r(io,{to:"/teams"}):r($,{display:"flex",flexDirection:"column",gap:1,children:r(u.Suspense,{fallback:Zr,children:t&&r(ea,{teamId:t})})})}function ea({teamId:e}){var f;const{database:t}=I(),o=lt(),a=bt(e),{loadoutMetadata:n}=a,{params:{characterKey:s}}=be({path:"/teams/:teamId/:characterKey",end:!1})??{params:{}},{params:{tab:c}}=be({path:"/teams/:teamId/:characterKey/:tab"})??{params:{}},l=u.useMemo(()=>n.find(g=>{var y;return(g==null?void 0:g.loadoutId)&&((y=t.loadouts.get(g.loadoutId))==null?void 0:y.key)===s}),[n,t.loadouts,s]);u.useEffect(()=>{window.scrollTo({top:0})},[]),u.useEffect(()=>{l||o("",{replace:!0})},[l,o]);const p=l==null?void 0:l.loadoutId,m=(f=t.loadouts.get(p))==null?void 0:f.key,{t:i}=D(["charNames_gen","page_character"]);hr(u.useMemo(()=>{const b=i(m?"charNames_gen:Character":"Team Settings"),g=c?i(`page_character:tabs.${c}`):m?i("Loadout/Build"):c;return`${a.name} - ${b}${g?` - ${g}`:""}`},[m,i,c,a.name]));const d=G(p??""),h=u.useMemo(()=>{if(!(!p||!d||!l))return{teamId:e,team:a,loadoutId:p,loadout:d,loadoutMetadatum:l}},[l,a,d,p,e]);return r(Tr,{teamId:e,children:v($,{sx:{display:"flex",gap:1,flexDirection:"column",mx:1,mt:2},children:[r(E,{children:r(Nr,{teamId:e,charKey:m,tab:c})}),r($,{children:h?r(no.Provider,{value:h,children:r(ta,{})}):r(zr,{teamId:e})})]})})}function ta({tab:e}){const{loadout:{key:t}}=_e(),o=dt(t),a=u.useMemo(()=>o&&{character:o},[o]);return a?r(so.Provider,{value:a,children:r(lo,{children:r(Ge,{path:":characterKey",children:r(Ge,{path:"*",index:!0,element:r(Yr,{tab:e})})})})}):r($e,{variant:"rectangular",width:"100%",height:1e3})}export{pa as default};
