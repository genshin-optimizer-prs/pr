(function(){"use strict";function E(e){throw new Error(`Should not reach this with value ${e}`)}function w(e,a){const r=new Set;function o(i){r.has(i)||(a(i,o),r.add(i))}e.forEach(o)}function x(e,a,r,o,i=""){let m=1,t="'use strict';"+i+";const x0=0";const l=new Map;return w(e,(s,f)=>{const c=`x${m++}`;l.set(s,c);const{op:u,x:S,br:k}=s;S.forEach(f),k.forEach(f);const n=S.map(h=>l.get(h)),d=k.map(h=>l.get(h));switch(u){case"const":l.set(s,typeof s.ex!="string"?`(${s.ex})`:`('${s.ex}')`);break;case"sum":case"prod":t+=`,${c}=`,n.length?t+=n.join(u=="sum"?"+":"*"):t+=u=="sum"?0:1;break;case"min":case"max":t+=`,${c}=Math.${u}(${n})`;break;case"sumfrac":t+=`,${c}=${n[0]}/(${n[0]} + ${n[1]})`;break;case"match":t+=`,${c}=${d[0]}===${d[1]}?${n[0]}:${n[1]}`;break;case"thres":t+=`,${c}=${d[0]}>=${d[1]}?${n[0]}:${n[1]}`;break;case"subscript":t+=`,${c}=${JSON.stringify(s.ex)}[${d[0]}]`;break;case"read":{const h=s.tag[a];let p=[...new Array(r)].map((_,T)=>`(b[${T}]['${h}'] ?? 0)`);o[h]&&(p=[o[h].toString(),...p]),t+=`,${c}=${p.join("+")}`;break}case"custom":t+=`,${c}=${s.ex}(${n})`;break;case"lookup":t+=`,${c}=([${n}])[(${JSON.stringify(s.ex)})[${d[0]}] ?? 0]`;break;default:E(u)}}),t+=`;return [${e.map(s=>l.get(s))}]`,new Function("b",t)}const g=5e4,M=2e5;let b,$,y=[];onmessage=async e=>{try{await N(e)}catch(a){console.log(a),postMessage({resultType:"err",message:JSON.stringify(a)})}};async function N(e){const{data:a}=e,{command:r}=a;switch(r){case"init":v(a);break;case"start":await B();break}}async function v({relicStatsBySlot:e,detachedNodes:a,constraints:r}){b=x(a,"q",6,{}),$=e,y=r,postMessage({resultType:"initialized"})}async function B(){let e=[];function a(){const r=e.length;e.length>g&&(e.sort((o,i)=>i.value-o.value),e=e.slice(0,g)),postMessage({resultType:"results",builds:e,numBuildsComputed:r}),e=[]}$.head.forEach(r=>{$.hands.forEach(o=>{$.feet.forEach(i=>{$.body.forEach(m=>{$.sphere.forEach(t=>{$.rope.forEach(l=>{const s=b([r.stats,o.stats,i.stats,m.stats,t.stats,l.stats]);y.every(({value:f,isMax:c},u)=>c?s[u+1]<=f:s[u+1]>=f)&&e.push({value:s[0],ids:{head:r.id,hands:o.id,feet:i.id,body:m.id,sphere:t.id,rope:l.id}}),e.length>M&&a()})})})})})}),e.length>0&&a(),postMessage({resultType:"done"})}})();
