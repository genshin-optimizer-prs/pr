(function(){"use strict";function E(e){throw new Error(`Should not reach this with value ${e}`)}function w(e,a){const r=new Set;function o(i){r.has(i)||(a(i,o),r.add(i))}e.forEach(o)}function x(e,a,r,o,i=""){let h=1,t="'use strict';"+i+";const x0=0";const l=new Map;return w(e,(s,p)=>{const c=`x${h++}`;l.set(s,c);const{op:$,x:m,br:S}=s;m.forEach(p),S.forEach(p);const n=m.map(d=>l.get(d)),f=S.map(d=>l.get(d));switch($){case"const":l.set(s,typeof s.ex!="string"?`(${s.ex})`:`('${s.ex}')`);break;case"sum":case"prod":t+=`,${c}=`,n.length?t+=n.join($=="sum"?"+":"*"):t+=$=="sum"?0:1;break;case"min":case"max":t+=`,${c}=Math.${$}(${n})`;break;case"sumfrac":t+=`,${c}=${n[0]}/(${n[0]} + ${n[1]})`;break;case"match":t+=`,${c}=${f[0]}===${f[1]}?${n[0]}:${n[1]}`;break;case"thres":t+=`,${c}=${f[0]}>=${f[1]}?${n[0]}:${n[1]}`;break;case"subscript":t+=`,${c}=${JSON.stringify(s.ex)}[${f[0]}]`;break;case"read":{const d=s.tag[a];let g=[...new Array(r)].map((_,T)=>`(b[${T}]['${d}'] ?? 0)`);o[d]&&(g=[o[d].toString(),...g]),t+=`,${c}=${g.join("+")}`;break}case"custom":t+=`,${c}=${s.ex}(${n})`;break;case"lookup":t+=`,${c}=([${n}])[(${JSON.stringify(s.ex)})[${f[0]}] ?? 0]`;break;default:E($)}}),t+=`;return [${e.map(s=>l.get(s))}]`,new Function("b",t)}const b=5e4,M=2e5;let y,u,k=[];onmessage=async e=>{try{await B(e)}catch(a){console.log(a),postMessage({resultType:"err",message:JSON.stringify(a)})}};async function B(e){const{data:a}=e,{command:r}=a;switch(r){case"init":N(a);break;case"start":await v();break}}async function N({relicStatsBySlot:e,detachedNodes:a,constraints:r}){y=x(a,"q",6,{}),u=e,k=r,postMessage({resultType:"initialized"})}async function v(){let e=[];function a(r=0){const o=e.length;e.length>b&&(e.sort((i,h)=>h.value-i.value),e=e.slice(0,b)),postMessage({resultType:"results",builds:e,numBuildsComputed:o+r}),e=[]}u.head.forEach(r=>{u.hands.forEach(o=>{u.feet.forEach(i=>{u.body.forEach(h=>{u.sphere.forEach(t=>{u.rope.forEach(l=>{const s=y([r.stats,o.stats,i.stats,h.stats,t.stats,l.stats]);let p=0;k.every(({value:c,isMax:$},m)=>$?s[m+1]<=c:s[m+1]>=c)?e.push({value:s[0],ids:{head:r.id,hands:o.id,feet:i.id,body:h.id,sphere:t.id,rope:l.id}}):p++,e.length>M&&a(p)})})})})})}),e.length>0&&a(),postMessage({resultType:"done"})}})();
