import{e as o,p as e,n as x,aL as Q,aM as R,Z as D,aN as V,aO as z,q as W,u as L,af as X,b as j,d as Z,av as Y,aP as _,a2 as ee,aI as ae,V as te,aQ as re,N as $,M as P,C as A,X as F,B as E,D as se,T as oe,_ as ne,aR as le}from"./index-a2dacf6b.js";import{T as O,b as ie,A as ce,C as me,f as ue,s as he,u as de,a as pe,S as fe,d as ge}from"./StarDisplay-f7fbc231.js";import{d as B}from"./Upload-fde9b68f.js";import{M as ye}from"./DropdownButton-e8834a21.js";import{g as Ce}from"./index-a80b2b70.js";import{b as Te}from"./totalUtils-81a304f4.js";import{T as xe}from"./TeamCard-6fa89041.js";import{C as ve}from"./StatIcon-5bff85ee.js";import"./ColoredText-9debc5f5.js";import"./SqBadge-70ebca68.js";import"./BootstrapTooltip-e4219c0d.js";import"./DataContext-38e67df3.js";import"./util-3e22b532.js";import"./SlotIcon-72aba85c.js";import"./index-2b0eca61.js";import"./useWeapon-1b4d47b9.js";import"./index-13f8784a.js";import"./CardActionArea-e1f9225b.js";function we({options:c,valueKeys:a,label:d,onChange:u,toImg:p,toExItemLabel:g,toExLabel:l,chipProps:f,...C}){const b=o.useMemo(()=>a.map(n=>c.find(r=>r.key===n)).filter(n=>n),[c,a]);return e(ce,{autoHighlight:!0,options:c,multiple:!0,disableCloseOnSelect:!0,value:b,onChange:(n,r,m)=>m==="clear"?u([]):r!==null&&u(r.map(i=>i.key)),isOptionEqualToValue:(n,r)=>n.key===r.key,renderInput:n=>e(O,{...n,label:d,inputProps:{...n.inputProps,autoComplete:"new-password"},color:a.length?"success":"primary"}),renderOption:(n,r)=>x(ye,{value:r.key,...n,children:[e(Q,{children:p(r.key)}),e(R,{children:e(o.Suspense,{fallback:e(D,{variant:"text",width:100}),children:x(V,{color:r.color,sx:{display:"flex",gap:1},children:[a.includes(r.key)?e("strong",{children:r.label}):e("span",{children:r.label}),g==null?void 0:g(r.key)]})})}),!!r.favorite&&e(ie,{})]}),renderTags:(n,r)=>n.map(({key:m,label:i,color:T},v)=>z(W,{...f,...r({index:v}),key:`${v}${m}${i}`,icon:p(m),label:l?x("span",{children:[i," ",l(m)]}):i,color:T})),filterOptions:(n,{inputValue:r})=>n.filter(m=>{var i;return m.label.toLowerCase().includes(r.toLowerCase())||((i=m.alternateNames)==null?void 0:i.some(T=>T.toLowerCase().includes(r.toLowerCase())))}),...C})}function Se({teamIds:c,charKeys:a,setCharKey:d,acProps:u}){const{t:p}=L(["sillyWisher_charNames","charNames_gen"]),{silly:g}=o.useContext(X),l=j(),{gender:f}=Z(),C=o.useCallback(t=>l.charMeta.get(t).favorite,[l.charMeta]),b=o.useCallback(t=>e(me,{characterKey:t}),[]),n=o.useCallback((t,h)=>p(`${h?"sillyWisher_charNames":"charNames_gen"}:${Y(t,f)}`),[f,p]),r=o.useCallback(t=>Ce(t,f).elementKey??void 0,[f]),m=o.useMemo(()=>l.chars.keys,[l]),{characterTeamTotal:i}=o.useMemo(()=>Te({characterTeamTotal:m},h=>{l.teams.values.forEach(y=>{const{loadoutData:w}=y;w.filter(_).forEach(({teamCharId:N})=>{const k=l.teamChars.get(N);if(!k)return;const I=k.key;h.characterTeamTotal[I].total++})}),c.forEach(y=>{const w=l.teams.get(y);if(!w)return;const{loadoutData:N}=w;N.filter(_).forEach(({teamCharId:k})=>{const I=l.teamChars.get(k);if(!I)return;const M=I.key;h.characterTeamTotal[M].current++})})}),[l,m,c]),T=o.useCallback(t=>e("strong",{children:i[t]}),[i]),v=o.useCallback(t=>e(W,{size:"small",label:i[t]}),[i]),K=o.useMemo(()=>m.map(t=>({key:t,label:n(t,g),alternateNames:g?[n(t,!g)]:void 0,favorite:C(t),color:r(t)})).sort((t,h)=>t.favorite&&!h.favorite?-1:!t.favorite&&h.favorite?1:t.label.localeCompare(h.label)),[g,n,r,C,m]);return e(o.Suspense,{fallback:e(D,{variant:"text",width:100}),children:e(we,{label:"Characters",options:K,toImg:b,valueKeys:a,onChange:t=>d(t),toExLabel:T,toExItemLabel:v,chipProps:{variant:"outlined"},...u})})}function be(){return{name:c=>c.name??"",lastEdit:c=>c.lastEdit??0}}const ke={name:["name","lastEdit"],lastEdit:["lastEdit"]};function Ie(c){return{charKeys:(a,d)=>{var l;if(!d.length)return!0;const u=(l=c.teams.get(a))==null?void 0:l.loadoutData.filter(_),p=u==null?void 0:u.map(({teamCharId:f})=>{var C;return(C=c.teamChars.get(f))==null?void 0:C.key}).filter(_);return d.every(f=>p==null?void 0:p.includes(f))},name:(a,d)=>{var u;return!d||!!((u=c.teams.get(a))!=null&&u.name.toLowerCase().includes(d.toLowerCase()))}}}const Ne={xs:1,sm:2,md:3,lg:3,xl:3},Me={xs:6,sm:12,md:18,lg:24,xl:24};function Qe(){const{t:c}=L(["page_teams","sillyWisher_charNames","charNames_gen"]),a=j(),[d,u]=ee(),p=ae();o.useEffect(()=>a.teams.followAny((s,S)=>(S==="new"||S==="remove"||S==="update")&&u()),[u,a]);const g=()=>{const s=a.teams.new();p(s)},[l,f,C]=te(),[b,n]=o.useState(""),r=()=>{try{const s=JSON.parse(b);a.teams.import(s)||window.alert("Data verification failed."),C()}catch(s){window.alert(`Data Import failed. ${s}`);return}},m=re(a.displayTeam),{sortType:i,ascending:T,charKeys:v}=m,[K,t]=o.useState(m.searchTerm),h=o.useDeferredValue(K);o.useEffect(()=>{a.displayTeam.set({searchTerm:h})},[a,h]);const{teamIds:y,totalTeamNum:w}=o.useMemo(()=>{const s=a.teams.keys.length,S=a.teams.keys.filter(ue({charKeys:v,name:h},Ie(a))).sort((U,q)=>he(ke[i],T,be())(a.teams.get(U),a.teams.get(q)));return d&&{teamIds:S,totalTeamNum:s}},[d,a,v,h,i,T]),N=de(),{numShow:k,setTriggerElement:I}=pe(Me[N],y.length),M=o.useMemo(()=>y.slice(0,k),[y,k]),G=y.length!==w?`${y.length}/${w}`:`${w}`,H={numShowing:M.length,total:G,t:c,namespace:"page_teams"},J={sortKeys:[...le],value:i,onChange:s=>a.displayTeam.set({sortType:s}),ascending:T,onChangeAsc:s=>a.displayTeam.set({ascending:s})};return x($,{my:1,display:"flex",flexDirection:"column",gap:1,children:[e(F,{children:x(A,{sx:{display:"flex",flexDirection:"column",gap:1},children:[x($,{display:"flex",gap:1,alignItems:"stretch",children:[e(Se,{teamIds:y,charKeys:v,setCharKey:s=>a.displayTeam.set({charKeys:s}),acProps:{sx:{flexGrow:1}}}),e(O,{autoFocus:!0,value:K,onChange:s=>t(s.target.value),label:"Team Name",sx:{height:"100%",flexGrow:1},InputProps:{sx:{height:"100%"}}})]}),e($,{display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",children:e(fe,{showingTextProps:H,sortByButtonProps:J})})]})}),x($,{sx:{display:"flex",gap:1},children:[e(E,{fullWidth:!0,onClick:g,color:"info",startIcon:e(ge,{}),children:"Add Team"}),e(ne,{open:l,onClose:C,children:x(F,{children:[e(ve,{title:"Import Team"}),e(se,{}),x(A,{sx:{display:"flex",flexDirection:"column",gap:2},children:[e(oe,{children:"Import a team in JSON form below."}),e(O,{fullWidth:!0,label:"JSON Data",placeholder:"Paste your Team JSON here",value:b,onChange:s=>n(s.target.value),multiline:!0,rows:4}),e(E,{startIcon:e(B,{}),disabled:!b,onClick:r,children:"Import"})]})]})}),e(E,{fullWidth:!0,onClick:f,color:"info",startIcon:e(B,{}),children:"Import Team"})]}),e(o.Suspense,{fallback:e(D,{variant:"rectangular",sx:{width:"100%",height:"100%",minHeight:5e3}}),children:e(P,{container:!0,spacing:1,columns:Ne,children:M.map(s=>e(P,{item:!0,xs:1,children:e(o.Suspense,{fallback:e(D,{variant:"rectangular",width:"100%",height:150}),children:e(xe,{teamId:s,bgt:"light",onClick:S=>p(`${s}${S?`/${S}`:""}`),hoverCard:!0})})},s))})}),y.length!==M.length&&e(D,{ref:s=>{s&&I(s)},sx:{borderRadius:1},variant:"rectangular",width:"100%",height:100})]})}export{Qe as default};
