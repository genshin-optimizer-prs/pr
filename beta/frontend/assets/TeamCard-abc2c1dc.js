import{b as D,u as nt,bq as $t,bp as Tt,n as u,p as e,bK as P,c0 as E,T as m,r as H,i as N,j as q,e as b,a4 as It,d as $,c2 as kt,ac as j,dd as wt,c3 as R,cS as _t,de as Ot,cm as st,cU as zt,b4 as M,c9 as Mt,cJ as At,a1 as C,ab as Wt,O as g,_ as V,t as k,b$ as Bt,bn as Pt,I as Rt,cl as Et,bB as Z,cn as Ht,be as Nt,bf as qt,N as S,bV as v,k as Vt,aw as F,bk as Ft,df as Lt,cv as rt,aj as ot,bj as L,bh as it,q as T,ck as ct,a7 as Ut,dg as Gt,bw as Jt,o as lt,cA as Yt,a8 as dt,ci as ut,cb as Qt,cj as Xt,dh as Zt,bd as z,br as Kt,bI as K,bE as te,cr as ee,cc as ae,cd as ne,W as se,Y as ht}from"./index-c8569605.js";import{d as re}from"./Info-725c56a9.js";import{e as A,i as U,l as oe,C as pt,h as ie}from"./LocationName-c1489fc4.js";import{g as w,a as ft,W as mt,c as ce,e as le,b as de}from"./index-5995a685.js";import{D as W}from"./DataContext-94ff1ee9.js";import{b as gt}from"./util-3e22b532.js";import{S as ue}from"./SlotIcon-ff8f6228.js";import{i as G}from"./index-1be28e80.js";import{u as he}from"./useWeapon-f2f5002c.js";import{C as I}from"./CardActionArea-bf6cc40f.js";function pe(t){const a=/^#?([a-f\d])([a-f\d])([a-f\d])$/i;t=t.replace(a,(s,o,r,i)=>o+o+r+r+i+i);const n=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return n?{r:parseInt(n[1],16),g:parseInt(n[2],16),b:parseInt(n[3],16)}:null}function da(t,a){if(t)return`rgba(${t.r},${t.g},${t.b},${a})`}function fe(t){const a=D();return A(a.charMeta,t)}function xt(t){const a=D();return A(a.chars,t)}function me(t){const a=D();return A(a.teams,t)}function ge(t){const a=D();return A(a.teamChars,t)}function xe({statKey:t,value:a,color:n,prefix:s="",typographyProps:o={}}){const{t:r}=nt("statKey_gen"),i=$t(t),c=Tt(a,i);return u(m,{color:n?`${n}.main`:void 0,...o,children:[e(E,{statKey:t,iconProps:P})," ",r(t)," ",e("strong",{children:`${s}${c}${i}`})]},t)}var J={},be=N;Object.defineProperty(J,"__esModule",{value:!0});var bt=J.default=void 0,ve=be(H()),ye=q,Ce=(0,ve.default)((0,ye.jsx)("path",{d:"M16.5 3c-1.74 0-3.41.81-4.5 2.09C10.91 3.81 9.24 3 7.5 3 4.42 3 2 5.42 2 8.5c0 3.78 3.4 6.86 8.55 11.54L12 21.35l1.45-1.32C18.6 15.36 22 12.28 22 8.5 22 5.42 19.58 3 16.5 3zm-4.4 15.55-.1.1-.1-.1C7.14 14.24 4 11.39 4 8.5 4 6.5 5.5 5 7.5 5c1.54 0 3.04.99 3.57 2.36h1.87C13.46 5.99 14.96 5 16.5 5c2 0 3.5 1.5 3.5 3.5 0 2.89-3.14 5.74-7.9 10.05z"}),"FavoriteBorder");bt=J.default=Ce;const Se=b.createContext({});function De(t,a=0,n,s){const o=D(),[r,i]=It(),c=b.useDeferredValue(r),{gender:l}=$(),h=b.useMemo(()=>c&&$e(o,t,a,l,n,s),[c,l,t,o,a,n,s]);return b.useEffect(()=>t?o.chars.follow(t,i):void 0,[t,i,o]),h}class je{constructor(a){this.data={},a.chars.followAny(n=>{this.removeData(n)})}getData(a){return this.data[a]}cacheData(a,n){this.data[a]=n}removeData(a){delete this.data[a]}}const B=new Map,tt=t=>{if(B.has(t))return B.get(t);const a=new je(t);return B.set(t,a),a};function $e(t,a,n=0,s,o,r){if(!a)return;if(!n&&!o&&!r){const p=tt(t).getData(a);if(p)return p}const{teamData:i,teamBundle:c}=Te(t,a,n,o,r)??{};if(!i||!c)return;const l=kt(i,s,a),h=j(l,(p,d)=>{const{data:f,...x}=c[d];return{...p,...x}});return!n&&!o&&!r&&tt(t).cacheData(a,h),h}function Te(t,a,n=0,s,o){if(!a)return;const r=t.chars.get(a);if(!r)return;const i=Ie(t,!0,n,r,o||(t.weapons.get(r.equippedWeapon)??wt()),s??Object.values(r.equippedArtifacts).map(h=>t.arts.get(h)).filter(h=>h));if(!i)return;const c={[a]:i};return{teamData:{[a]:i.data},teamBundle:c}}function Ie(t,a=!1,n,s,o,r){const i=w(s.key,t.gender);if(!i)return;const c=ft(o.key);if(!c)return;const l=mt.getAllDataOfType(i.weaponTypeKey),h=a?(()=>{const{display:x,...y}=c.data;return R([y,l])})():c.data,p=R([i.data,h,ce]),f=[...Array.isArray(r)?r.map(x=>_t(x,n)):[r],Ot(s),st(o),p,zt,le];return{character:s,weapon:o,characterSheet:i,weaponSheet:c,data:f}}function ke({art:t,children:a}){const n=e(g,{children:e(V,{variant:"rectangular",width:100,height:100})}),s=e(b.Suspense,{fallback:n,children:e(we,{art:t})});return e(M,{placement:"top",title:s,disableInteractive:!0,children:a})}function we({art:t}){const{t:a}=nt("statKey_gen"),n=de(t.setKey),{slotKey:s,level:o,rarity:r,mainStatKey:i,substats:c}=t,l=n.getSlotName(s),h=Mt.getVariant(i);return u(g,{p:1,children:[u(m,{variant:"h6",children:[e(ue,{slotKey:s,iconProps:P})," ",l]}),u(m,{variant:"subtitle1",color:`${h}.main`,children:[e(E,{statKey:i,iconProps:P})," ",a(i)," ",At(i,r,o)]}),u(m,{variant:"subtitle2",sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e(U,{stars:r}),u(C,{color:gt(o),children:["+",o]})," "]}),e(g,{py:1,children:c.map(({value:p,key:d,rolls:f})=>!!(p&&d)&&e(xe,{statKey:d,value:p,color:`roll${Wt(f.length,1,6)}`,prefix:"+"},d))}),e(m,{color:"success.main",children:n.name}),e(oe,{color:"secondary.main",location:t.location})]})}function _e({artifactObj:t,slotKey:a}){if(!t)return e(k,{sx:{display:"flex",flexDirection:"column",height:"100%"},children:e(g,{sx:{width:"100%",pb:"100%",position:"relative"},children:e(g,{sx:{position:"absolute",width:"70%",height:"70%",left:"50%",top:"50%",transform:"translate(-50%, -50%)",opacity:.7},component:"img",src:G.slot[a]})})});const{mainStatKey:n,rarity:s,level:o}=t,i=Bt.find(c=>t.mainStatKey.includes(c))??"secondary";return e(ke,{art:t,children:u(k,{sx:{display:"flex",flexDirection:"column",position:"relative"},children:[e(g,{component:"img",className:`grad-${s}star`,src:Pt(t.setKey,t.slotKey),maxWidth:"100%",maxHeight:"100%"}),e(m,{sx:{position:"absolute",fontSize:"0.75rem",lineHeight:1,opacity:.85,pointerEvents:"none"},children:e("strong",{children:e(C,{sx:{p:.5},color:gt(o),children:u("strong",{children:["+",o]})})})}),e(m,{sx:{position:"absolute",fontSize:"0.75rem",lineHeight:1,opacity:.85,pointerEvents:"none",bottom:0,right:0},children:e(C,{color:i,sx:{p:.5},children:e(E,{statKey:n,iconProps:{fontSize:"inherit"}})})})]})})}function Oe({sheet:t,addlText:a,children:n}){const s=u(b.Suspense,{fallback:e(V,{variant:"text",width:100}),children:[u(m,{children:[e(Rt,{src:G.weaponTypes[t.weaponType],size:1.5})," ",t.name]}),a]});return e(M,{placement:"top",title:s,disableInteractive:!0,children:n})}function ze({weaponId:t}){const a=he(t);return a?e(vt,{weapon:a}):null}function vt({weapon:t}){const a=(t==null?void 0:t.key)&&ft(t.key),n=b.useMemo(()=>a&&t&&Et([a.data,st(t)]),[a,t]);if(!t||!a||!n)return null;const s=u(g,{children:[e(et,{node:n.get(Z.weapon.main)}),e(et,{node:n.get(Z.weapon.sub)})]});return u(k,{sx:{height:"100%",maxWidth:128,position:"relative",display:"flex",flexDirection:"column"},children:[e(g,{display:"flex",flexDirection:"column",alignContent:"flex-end",className:`grad-${a.rarity}star`,children:e(Oe,{sheet:a,addlText:s,children:e(g,{component:"img",src:Ht(t.key,t.ascension>=2),maxWidth:"100%",maxHeight:"100%",sx:{mt:"auto"}})})}),e(m,{sx:{position:"absolute",fontSize:"0.75rem",lineHeight:1,opacity:.85,pointerEvents:"none"},children:e("strong",{children:e(C,{color:"primary",children:mt.getLevelString(t)})})}),a.hasRefinement&&e(m,{sx:{position:"absolute",fontSize:"0.75rem",lineHeight:1,opacity:.85,pointerEvents:"none",bottom:0,right:0},children:e("strong",{children:u(C,{color:"secondary",children:["R",t.refinement]})})})]})}function et({node:t}){const{icon:a}=Nt(t.info);return u(m,{children:[a," ",qt(t)]})}function Me({hideWeapon:t=!1}){var n;const{data:a}=b.useContext(W);return e(g,{children:u(S,{container:!0,columns:t?5:6,spacing:.5,children:[!t&&e(S,{item:!0,xs:1,height:"100%",children:e(ze,{weaponId:((n=a.get(v.weapon.id).value)==null?void 0:n.toString())??""})}),e(Ae,{})]})})}function Ae(){const t=D(),{data:a}=b.useContext(W),n=Vt.map(s=>{var o;return[s,t.arts.get(((o=a.get(v.art[s].id).value)==null?void 0:o.toString())??"")]});return e(F,{children:n.map(([s,o])=>e(S,{item:!0,xs:1,children:e(_e,{artifactObj:o,slotKey:s})},s))})}function We({weapon:t}){return e(g,{children:u(S,{container:!0,columns:t?6:5,spacing:.5,sx:{},children:[t&&e(S,{item:!0,xs:1,height:"100%",children:e(vt,{weapon:t})}),e(S,{item:!0,xs:5,children:e(Ft,{sx:{backgroundColor:"info.main",height:"44px",display:"flex",justifyContent:"center",alignItems:"center"},children:e(m,{children:"TC Build"})})})]})})}function yt(t,a,n){const s=Lt(t,a),o=rt(t,"icon",a);return n&&s?s:o||""}function Be({children:t,characterKey:a,onClick:n}){const{gender:s}=$(),{silly:o}=b.useContext(ot),r=L(a),i=b.useCallback(l=>e(I,{onClick:n,sx:{flexGrow:1,display:"flex",flexDirection:"column"},children:l}),[n]),c=rt(a,"banner",s);return e(pt,{condition:!!n,wrapper:i,children:u(g,{display:"flex",position:"relative",className:c?void 0:`grad-${r.rarity}star`,sx:{"&::before":{content:'""',display:"block",position:"absolute",left:0,top:0,width:"100%",height:"100%",opacity:.5,backgroundImage:`url(${c})`,backgroundPosition:"center",backgroundSize:"cover"}},width:"100%",children:[e(g,{flexShrink:1,component:"img",src:yt(a,s,o),sx:{maxWidth:"40%"},alignSelf:"flex-end",display:"flex",flexDirection:"column",zIndex:1}),e(g,{flexGrow:1,sx:{py:1,pr:1},display:"flex",flexDirection:"column",zIndex:1,justifyContent:"space-between",children:t})]})})}function Pe({characterKey:t}){const{gender:a}=$(),{data:n}=b.useContext(W),s=n.get(v.charEle).value,o=n.get(v.lvl).value,r=n.get(v.constellation).value,i=n.get(v.asc).value,c=n.get(v.total.autoBoost).value,l=n.get(v.total.skillBoost).value,h=n.get(v.total.burstBoost).value,p=n.get(v.total.auto).value,d=n.get(v.total.skill).value,f=n.get(v.total.burst).value,x=L(t);return u(F,{children:[e(T,{label:e(m,{variant:"subtitle1",children:e(it,{characterKey:t,gender:a})}),size:"small",color:s,sx:{opacity:.85}}),u(g,{display:"flex",gap:1,sx:{textShadow:"0 0 5px gray"},alignItems:"center",children:[u(g,{children:[u(m,{component:"span",variant:"h6",whiteSpace:"nowrap",children:["Lv. ",o]}),u(m,{component:"span",variant:"h6",color:"text.secondary",children:["/",ct[i]]})]}),e(m,{component:"span",whiteSpace:"nowrap",sx:{opacity:.85},children:e(C,{color:`roll${r<3?3:r}`,children:e(Ut,{color:"white",children:u("strong",{children:["C",r]})})})})]}),u(g,{display:"flex",gap:1,sx:{opacity:.85},children:[e(T,{size:"small",color:c?"info":"secondary",label:e("strong",{children:p})}),e(T,{size:"small",color:l?"info":"secondary",label:e("strong",{children:d})}),e(T,{size:"small",color:h?"info":"secondary",label:e("strong",{children:f})})]}),e(m,{variant:"h6",lineHeight:1,children:e(U,{stars:x.rarity,colored:!0,inline:!0})})]})}function ua({characterKey:t}){const{gender:a}=$(),n=L(t),s=w(t,a);return u(F,{children:[e(T,{label:e(m,{variant:"subtitle1",children:e(it,{characterKey:t,gender:a})}),size:"small",color:s.elementKey,sx:{opacity:.85}}),e(g,{mt:1,children:e(m,{variant:"h4",children:e(C,{children:"NEW"})})}),e(m,{mt:1.5,children:e(U,{stars:n.rarity,colored:!0})})]})}var Y={},Re=N;Object.defineProperty(Y,"__esModule",{value:!0});var Ct=Y.default=void 0,Ee=Re(H()),He=q,Ne=(0,Ee.default)((0,He.jsx)("path",{d:"M21.6 18.2 13 11.75v-.91c1.65-.49 2.8-2.17 2.43-4.05-.26-1.31-1.3-2.4-2.61-2.7C10.54 3.57 8.5 5.3 8.5 7.5h2c0-.83.67-1.5 1.5-1.5s1.5.67 1.5 1.5c0 .84-.69 1.52-1.53 1.5-.54-.01-.97.45-.97.99v1.76L2.4 18.2c-.77.58-.36 1.8.6 1.8h18c.96 0 1.37-1.22.6-1.8zM6 18l6-4.5 6 4.5H6z"}),"Checkroom");Ct=Y.default=Ne;const at=Gt(Jt({dyn:{...v.art,...v.artSet}})),qe={art:lt([...Yt,...dt],t=>at.dyn[t]),artSet:j(v.artSet,(t,a)=>at.dyn[a])};function ha(t,a,n){const s={base:{},values:{flower:[],plume:[],goblet:[],circlet:[],sands:[]}},o=new Set;for(const r of t){const i=ut(r.mainStatKey,r.rarity,Math.max(Math.min(a,Qt[r.rarity]),r.level)),c={id:r.id,set:r.setKey,values:{[r.setKey]:1,[r.mainStatKey]:i,...Object.fromEntries(r.substats.map(l=>[l.key,l.key.endsWith("_")?l.accurateValue/100:l.accurateValue]))}};delete c.values[""],s.values[r.slotKey].push(c),Object.keys(c.values).forEach(l=>o.add(l))}if(s.base=lt([...o],r=>0),n)for(const r of Object.values(s.values))r.push({id:"",values:{}});return s}function pa(t,a,n){var p;const{artifact:{sets:s},optimization:{target:o,minTotal:r}}=n;if(!o)return{};const i=(p=t[a])==null?void 0:p.target.data[0];if(!i)return{};Object.assign(i,R([i,qe]));const c=Kt(i.display??{},o);if(!c)return{};const l=Object.keys(r).map(d=>i.total[d]).filter(d=>d);let h=K([c,...l],i,({path:[d]})=>d!=="dyn");return h=te(h,d=>{if(d.operation==="read"&&d.path[0]==="dyn"){const f=s[d.path[1]];if(f)return z(f);if(!dt.includes(d.path[1]))return z(0)}return d},d=>d),h=K(h,{},d=>!1),{nodes:h}}function fa(t){const a=new Set;return ee(t,{},n=>{const s=n.path[1];return a.add(s),s},1),a}function ma(t){const{artifact:{slots:a,substats:{stats:n,type:s,rarity:o}}}=t,r=j(n,(l,h)=>Math.ceil(n[h]/ae(h,o,s))),i=Le(a),c=Fe(a);return{minSubLines:c,minOtherRolls:Ve(Object.entries(r),i,c)}}function Ve(t,a,n=4*5){const s=t.reduce((o,[r,i])=>{const c=5-(a[r]??0);return o+Math.min(i,c)},0);return n-s}function Fe(t){return Object.values(t).reduce((a,{rarity:n,level:s})=>{const{high:o,low:r}=ne[n];return a+(s>=4?o:r)},0)}function Le(t){const a={};return Object.values(t).forEach(({statKey:n})=>{a[n]=(a[n]??0)+1},0),a}function Ue(t){const{artifact:{slots:a,substats:{stats:n},sets:s}}=t,o=j(n,(r,i)=>Xt(r,i));return Object.values(a).forEach(({statKey:r,rarity:i,level:c})=>o[r]=(o[r]??0)+ut(r,i,c)),{art:j(o,(r,i)=>i.endsWith("_")?Zt(r):z(r)),artSet:j(s,r=>z(r))}}function ga(t){const{weapon:{key:a,level:n,ascension:s,refinement:o}}=t;return{id:"",location:"",key:a,level:n,ascension:s,refinement:o,lock:!1}}var Q={},Ge=N;Object.defineProperty(Q,"__esModule",{value:!0});var St=Q.default=void 0,Je=Ge(H()),Ye=q,Qe=(0,Je.default)((0,Ye.jsx)("path",{d:"M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"}),"Person");St=Q.default=Qe;function Xe({characterKey:t,onClick:a,onMouseDown:n,onMouseEnter:s,hoverChild:o,hideFav:r}){const i=xt(t),{favorite:c}=fe(t),{gender:l}=$(),{silly:h}=b.useContext(ot),p=w(t,l),d=b.useCallback(()=>a==null?void 0:a(t),[t,a]),f=b.useCallback(O=>e(I,{onClick:d,onMouseDown:n,onMouseEnter:s,children:O}),[d,n,s]),[x,y,_]=se();return e(M,{enterNextDelay:500,enterTouchDelay:500,placement:"top",open:!!o&&x,onClose:_,onOpen:y,title:o,children:e(k,{sx:{maxWidth:128,position:"relative",display:"flex",flexDirection:"column"},children:u(pt,{condition:!!a||!!n||!!s,wrapper:f,children:[e(g,{display:"flex",className:`grad-${p.rarity}star`,children:e(g,{component:"img",src:yt(t,l,h),maxWidth:"100%",maxHeight:"100%",draggable:!1})}),i&&e(m,{sx:{position:"absolute",fontSize:"0.75rem",lineHeight:1,opacity:.85,pointerEvents:"none",top:0},children:e("strong",{children:u(C,{color:"primary",children:[i.level,"/",ct[i.ascension]]})})}),!r&&e(g,{sx:{position:"absolute",top:0,right:0},children:c?e(ie,{fontSize:"small"}):e(bt,{fontSize:"small"})}),i&&e(m,{sx:{position:"absolute",fontSize:"0.75rem",lineHeight:1,opacity:.85,pointerEvents:"none",bottom:0,right:0},children:e("strong",{children:u(C,{color:"secondary",children:["C",i.constellation]})})})]})})})}function Ze({index:t}){return e(k,{sx:{display:"flex",alignItems:"center",justifyContent:"center",py:"12.5%"},children:e(g,{component:"img",src:G.team[`team${t+1}`],sx:{width:"75%",height:"auto",opacity:.7}})})}function xa({teamId:t,onClick:a,hoverCard:n=!1,bgt:s}){const o=me(t),{name:r,description:i,loadoutData:c}=o,l=D(),h=c.map(p=>{if(!p)return;const d=l.teamChars.get(p.teamCharId);if(d)return w(d.key).elementKey});return e(ht,{bgt:s,sx:{height:"100%"},children:u(g,{sx:p=>({height:"100%",display:"flex",flexDirection:"column",background:`linear-gradient(to right, ${h.map(f=>{if(!f)return"rgba(0,0,0,0)";const x=p.palette[f].main,y=pe(x);return y?`rgba(${y.r},${y.g},${y.b},0.25)`:"rgba(0,0,0,0)"}).map((f,x)=>`${f} ${x*25+12.5}%`).join(", ")})`}),children:[e(I,{onClick:()=>a(),sx:{p:1},children:u(m,{sx:{display:"flex",gap:1},children:[e("span",{children:r})," ",i&&e(M,{title:e(m,{children:i}),children:e(re,{})})]})}),e(g,{sx:{p:1,marginTop:"auto"},children:e(S,{container:!0,columns:4,spacing:1,children:c.map((p,d)=>{var y;const f=p==null?void 0:p.teamCharId,x=f&&((y=l.teamChars.get(f))==null?void 0:y.key);return e(S,{item:!0,xs:1,height:"100%",children:x?e(I,{onClick:()=>a(x),children:e(Xe,{characterKey:x,hoverChild:n&&e(Ke,{characterKey:x,teamCharId:f,teamId:t}),hideFav:!0})}):e(I,{onClick:()=>a(),children:e(Ze,{index:d})})},d)})})})]})})}function Ke({characterKey:t,teamId:a,teamCharId:n}){var O;const s=D(),o=xt(t),{gender:r}=$(),i=w(t,r),{name:c}=ge(n),l=s.teams.getLoadoutDatum(a,n),h=s.teams.getActiveBuildName(l),p=(()=>s.teams.getLoadoutWeapon(l))(),d=(()=>{const{buildType:Dt,buildTcId:X}=l;return Dt==="tc"&&X?Ue(s.buildTcs.get(X)):Object.values(s.teams.getLoadoutArtifacts(l)).filter(jt=>jt)})(),f=De(t,void 0,d,p),x=(O=f==null?void 0:f[t])==null?void 0:O.target,y=b.useMemo(()=>o&&i&&{character:o,characterSheet:i},[o,i]),_=b.useMemo(()=>x&&f&&{data:x,teamData:f},[x,f]);return!y||!_?null:e(Se.Provider,{value:y,children:e(W.Provider,{value:_,children:e(g,{sx:{width:300,m:-1},children:e(b.Suspense,{fallback:e(V,{variant:"rectangular",width:"100%",height:300}),children:u(ht,{children:[e(Be,{characterKey:t,children:e(Pe,{characterKey:t})}),u(g,{sx:{p:1,display:"flex",flexDirection:"column",gap:1},children:[u(m,{sx:{display:"flex",gap:1,alignItems:"center"},children:[e(St,{}),e("span",{children:c})]}),u(m,{sx:{display:"flex",gap:1,alignItems:"center"},children:[e(Ct,{}),e("span",{children:h})]}),(l==null?void 0:l.buildType)==="tc"&&(l!=null&&l.buildTcId)?e(We,{weapon:p}):e(Me,{})]})]})})})})})}export{_e as A,Se as C,ua as H,xa as T,ze as W,Ct as a,Xe as b,Be as c,St as d,Pe as e,Me as f,Ue as g,ha as h,qe as i,ma as j,fa as k,ga as l,pe as m,da as n,pa as o,ge as p,xt as q,De as r,fe as s,bt as t,me as u,ke as v,Oe as w,yt as x};
