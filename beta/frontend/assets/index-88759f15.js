import{e as o,p as e,n as T,aH as X,aI as Y,U as _,aJ as Z,aK as ee,q as H,r as ae,i as te,j as re,u as J,a9 as se,b as U,d as oe,ap as ne,X as le,aE as ie,Q as ce,aL as me,K as N,J as L,C as W,aA as F,B as $,D as ue,T as he,aM as de,aN as pe}from"./index-8d5969d3.js";import{T as P,A as fe,C as ge,f as ye,s as Ce,u as Te,a as ve,S as xe}from"./StarDisplay-bf7c6627.js";import{a as Se,T as we,d as be}from"./TeamCard-0eaa15df.js";import{M as Ie}from"./DropdownButton-c5bcbe74.js";import{g as ke}from"./index-548418c9.js";import{b as Me}from"./totalUtils-e9fb0ed1.js";import{C as Ee}from"./CardHeader-6a63393b.js";import"./ColoredText-0cb06309.js";import"./BootstrapTooltip-55061d81.js";import"./SqBadge-4bd34da3.js";import"./FieldDisplay-fb4dff4e.js";import"./Groups-c257e319.js";import"./index-b60b78be.js";import"./index-b60a5cc2.js";import"./Artifact-0be55870.js";import"./SlotIcon-bfd9540b.js";import"./useWeapon-eb84b896.js";import"./CardActionArea-ba58fb3c.js";function Ne({options:i,valueKeys:a,label:p,onChange:u,toImg:g,toExItemLabel:f,toExLabel:m,chipProps:v,...I}){const k=o.useMemo(()=>a.map(n=>i.find(r=>r.key===n)).filter(n=>n),[i,a]);return e(fe,{autoHighlight:!0,options:i,multiple:!0,disableCloseOnSelect:!0,value:k,onChange:(n,r,c)=>c==="clear"?u([]):r!==null&&u(r.map(l=>l.key)),isOptionEqualToValue:(n,r)=>n.key===r.key,renderInput:n=>e(P,{...n,label:p,inputProps:{...n.inputProps,autoComplete:"new-password"},color:a.length?"success":"primary"}),renderOption:(n,r)=>T(Ie,{value:r.key,...n,children:[e(X,{children:g(r.key)}),e(Y,{children:e(o.Suspense,{fallback:e(_,{variant:"text",width:100}),children:T(Z,{color:r.color,sx:{display:"flex",gap:1},children:[a.includes(r.key)?e("strong",{children:r.label}):e("span",{children:r.label}),f==null?void 0:f(r.key)]})})}),!!r.favorite&&e(Se,{})]}),renderTags:(n,r)=>n.map(({key:c,label:l,color:y},x)=>ee(H,{...v,...r({index:x}),key:`${x}${c}${l}`,icon:g(c),label:m?T("span",{children:[l," ",m(c)]}):l,color:y})),filterOptions:(n,{inputValue:r})=>n.filter(c=>{var l;return c.label.toLowerCase().includes(r.toLowerCase())||((l=c.alternateNames)==null?void 0:l.some(y=>y.toLowerCase().includes(r.toLowerCase())))}),...I})}var A={},_e=te;Object.defineProperty(A,"__esModule",{value:!0});var j=A.default=void 0,De=_e(ae()),Ke=re,$e=(0,De.default)((0,Ke.jsx)("path",{d:"M5 20h14v-2H5v2zm0-10h4v6h6v-6h4l-7-7-7 7z"}),"Upload");j=A.default=$e;function Oe({teamIds:i,charKeys:a,setCharKey:p,acProps:u}){const{t:g}=J(["sillyWisher_charNames","charNames_gen"]),{silly:f}=o.useContext(se),m=U(),{gender:v}=oe(),I=o.useCallback(s=>m.charMeta.get(s).favorite,[m.charMeta]),k=o.useCallback(s=>e(ge,{characterKey:s}),[]),n=o.useCallback((s,h)=>g(`${h?"sillyWisher_charNames":"charNames_gen"}:${ne(s,v)}`),[v,g]),r=o.useCallback(s=>ke(s,v).elementKey??void 0,[v]),c=o.useMemo(()=>m.chars.keys,[m]),{characterTeamTotal:l}=o.useMemo(()=>Me({characterTeamTotal:c},h=>{m.teams.values.forEach(d=>{const{teamCharIds:S}=d;S.forEach(C=>{const w=m.teamChars.get(C);if(!w)return;const M=w.key;h.characterTeamTotal[M].total++})}),i.forEach(d=>{const S=m.teams.get(d);if(!S)return;const{teamCharIds:C}=S;C.forEach(w=>{const M=m.teamChars.get(w);if(!M)return;const D=M.key;h.characterTeamTotal[D].current++})})}),[m,c,i]),y=o.useCallback(s=>e("strong",{children:l[s]}),[l]),x=o.useCallback(s=>e(H,{size:"small",label:l[s]}),[l]),E=o.useMemo(()=>c.map(s=>({key:s,label:n(s,f),favorite:I(s),color:r(s)})).sort((s,h)=>s.favorite&&!h.favorite?-1:!s.favorite&&h.favorite?1:s.label.localeCompare(h.label)),[f,n,r,I,c]);return e(o.Suspense,{fallback:e(_,{variant:"text",width:100}),children:e(Ne,{label:"Characters",options:E,toImg:k,valueKeys:a,onChange:s=>p(s),toExLabel:y,toExItemLabel:x,chipProps:{variant:"outlined"},...u})})}function Pe(){return{name:i=>i.name??"",lastEdit:i=>i.lastEdit??0}}const je={name:["name","lastEdit"],lastEdit:["lastEdit"]};function Ae(i){return{charKeys:(a,p)=>{var u;return!p.length||!!((u=i.teams.get(a))!=null&&u.teamCharIds.some(g=>{var f;return p.includes((f=i.teamChars.get(g))==null?void 0:f.key)}))},name:(a,p)=>{var u;return!p||!!((u=i.teams.get(a))!=null&&u.name.toLowerCase().includes(p.toLowerCase()))}}}const Be={xs:1,sm:2,md:3,lg:3,xl:3},O={xs:6,sm:12,md:18,lg:24,xl:24};function sa(){const{t:i}=J(["page_teams","sillyWisher_charNames","charNames_gen"]),a=U(),[p,u]=le(),g=ie();o.useEffect(()=>a.teams.followAny((t,b)=>(b==="new"||b==="remove"||b==="update")&&u()),[u,a]);const f=()=>{const t=a.teams.new();g(t)},[m,v,I]=ce(),[k,n]=o.useState(""),r=()=>{try{const t=JSON.parse(k);a.teams.import(t)||window.alert("Data verification failed."),I()}catch(t){window.alert(`Data Import failed. ${t}`);return}},c=me(a.displayTeam),{sortType:l,ascending:y,charKeys:x}=c,[E,s]=o.useState(c.searchTerm),h=o.useDeferredValue(E);o.useEffect(()=>{a.displayTeam.set({searchTerm:h})},[a,h]);const{teamIds:d,totalTeamNum:S}=o.useMemo(()=>{const t=a.teams.keys.length,b=a.teams.keys.filter(ye({charKeys:x,name:h},Ae(a))).sort((Q,V)=>Ce(je[l],y,Pe())(a.teams.get(Q),a.teams.get(V)));return p&&{teamIds:b,totalTeamNum:t}},[p,a,x,h,l,y]),C=Te(),[w,M]=o.useState(O[C]);o.useEffect(()=>{d&&M(O[C])},[d,C]);const[D,q]=o.useState(),B=ve(D)&&w<d.length;o.useEffect(()=>{B&&M(t=>t+O[C])},[B,C]);const K=o.useMemo(()=>d.slice(0,w),[d,w]),G=d.length!==S?`${d.length}/${S}`:`${S}`,R={numShowing:K.length,total:G,t:i,namespace:"page_teams"},z={sortKeys:[...pe],value:l,onChange:t=>a.displayTeam.set({sortType:t}),ascending:y,onChangeAsc:t=>a.displayTeam.set({ascending:t})};return T(N,{my:1,display:"flex",flexDirection:"column",gap:1,children:[e(F,{children:T(W,{sx:{display:"flex",flexDirection:"column",gap:1},children:[T(N,{display:"flex",gap:1,alignItems:"stretch",children:[e(Oe,{teamIds:d,charKeys:x,setCharKey:t=>a.displayTeam.set({charKeys:t}),acProps:{sx:{flexGrow:1}}}),e(P,{autoFocus:!0,value:E,onChange:t=>s(t.target.value),label:"Team Name",sx:{height:"100%",flexGrow:1},InputProps:{sx:{height:"100%"}}})]}),e(N,{display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",children:e(xe,{showingTextProps:R,sortByButtonProps:z})})]})}),T(N,{sx:{display:"flex",gap:1},children:[e($,{fullWidth:!0,onClick:f,color:"info",startIcon:e(be,{}),children:"Add Team"}),e(de,{open:m,onClose:I,children:T(F,{children:[e(Ee,{title:"Import Team"}),e(ue,{}),T(W,{sx:{display:"flex",flexDirection:"column",gap:2},children:[e(he,{children:"Import a team in JSON form below."}),e(P,{fullWidth:!0,label:"JSON Data",placeholder:"Paste your Team JSON here",value:k,onChange:t=>n(t.target.value),multiline:!0,rows:4}),e($,{startIcon:e(j,{}),disabled:!k,onClick:r,children:"Import"})]})]})}),e($,{fullWidth:!0,onClick:v,color:"info",startIcon:e(j,{}),children:"Import Team"})]}),e(o.Suspense,{fallback:e(_,{variant:"rectangular",sx:{width:"100%",height:"100%",minHeight:5e3}}),children:e(L,{container:!0,spacing:1,columns:Be,children:K.map(t=>e(L,{item:!0,xs:1,children:e(we,{teamId:t,bgt:"light",onClick:b=>g(`${t}${b?`/${b}`:""}`)})},t))})}),d.length!==K.length&&e(_,{ref:t=>{t&&q(t)},sx:{borderRadius:1},variant:"rectangular",width:"100%",height:100})]})}export{sa as default};
