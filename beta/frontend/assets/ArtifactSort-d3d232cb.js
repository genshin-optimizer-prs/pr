import{b as le,q as n,bG as $,r as Se,i as ke,j as Ee,$ as B,d as x,u as F,p as d,T as y,a2 as fe,Y as we,Q as h,a7 as _e,ac as G,db as M,a9 as Z,c3 as Ce,t as Ae,a8 as Q,cO as Re,bo as Ke,C as Me,B as se,a3 as Te,a1 as De,cg as ue,dc as $e,br as ce,bN as Ie,c4 as de,bq as Le,dd as je,de as qe,_ as Oe,s as Ve,bp as ze,df as Pe,aD as Be,d7 as Fe,dg as Ge,cx as Ne,dh as We,l as He}from"./index-741fa0d4.js";import{j as Ue,b as Qe,C as Ye,m as Je,v as Xe}from"./LocationName-02e91412.js";import{d as he}from"./Info-8916b4da.js";import{S as Ze}from"./SlotIcon-68d3b4e2.js";import{b as et}from"./util-3e22b532.js";import{d as tt,L as nt,a as rt,b as it}from"./LocationAutocomplete-9a2d3a8b.js";import{C as at}from"./CardActionArea-c934cb54.js";function ot(t=""){const r=le();return Ue(r.arts,t)}function st(t){return n($,{placement:"top",...t,children:n(he,{sx:{cursor:"help"}})})}function ct(t){return n($,{placement:"top",...t,children:n(he,{fontSize:"inherit",sx:{cursor:"help",verticalAlign:"-10%"}})})}var ee={},lt=ke;Object.defineProperty(ee,"__esModule",{value:!0});var ft=ee.default=void 0,ut=lt(Se()),dt=Ee,ht=(0,ut.default)((0,dt.jsx)("path",{d:"M18 23H4c-1.1 0-2-.9-2-2V7h2v14h14v2zM15 1H8c-1.1 0-1.99.9-1.99 2L6 17c0 1.1.89 2 1.99 2H19c1.1 0 2-.9 2-2V7l-6-6zm1.5 14h-6v-2h6v2zm0-6h-2v2h-2V9h-2V7h2V5h2v2h2v2z"}),"Difference");ft=ee.default=ht;function Kt({children:t,setKey:r,numInSet:e=5}){return n($,{placement:"top",title:n(pe,{setKey:r,numInSet:e}),disableInteractive:!0,children:t})}function pe({setKey:t,numInSet:r=5}){return n(x.Suspense,{fallback:n(B,{variant:"rectangular",width:100,height:100}),children:n(pt,{numInSet:r,setKey:t})})}function pt({setKey:t,numInSet:r=5}){const{t:e}=F("sheet"),a=Qe(t);return n(_e,{spacing:2,sx:{p:1},children:Object.keys(a.setEffects).map(i=>d(h,{sx:{opacity:parseInt(i)<=r?1:.5},children:[n(y,{children:n(fe,{color:"success",children:e(`${i}set`)})}),n(y,{children:n(we,{ns:`artifact_${i}_gen`,key18:`setEffects.${i}`})})]},i))})}function P({value:t,max:r=1,valid:e}){const[a,i]=typeof t=="number"?[`roll${G(Math.floor(t/r*10)-4,1,6)}`,(t*100).toFixed()+"%"]:["secondary",t];return n(fe,{color:e?a:"error",children:i})}const yt=x.lazy(()=>De(()=>import("./ArtifactEditor-1a57628b.js"),["./ArtifactEditor-1a57628b.js","./index-741fa0d4.js","./index-715179c7.css","./DropdownButton-80831f8f.js","./ArtifactRarityDropdown-3e25d74d.js","./LocationName-02e91412.js","./index-3a53ace2.js","./ArtifactStatKeyDisplay-7a35417e.js","./util-3e22b532.js","./Close-98145f0f.js","./Help-08fe9436.js","./LockOpen-3e2fa5ec.js","./SlotIcon-68d3b4e2.js","./Replay-370ed21f.js","./LocationAutocomplete-9a2d3a8b.js","./InfoTooltip-46bf745d.js","./Info-8916b4da.js","./TextButton-973cbc7b.js","./CardHeader-c9e9249c.js","./ChevronRight-c19619f9.js","./CardActionArea-c934cb54.js"],import.meta.url)),mt=new Set(Z);function Mt({artifactId:t,artifactObj:r,onClick:e,onDelete:a,mainStatAssumptionLevel:i=0,effFilter:s=mt,editorProps:l,canEquip:p=!1,extraButtons:S}){var oe;const{t:c}=F(["artifact","ui"]),{t:b}=F("statKey_gen"),g=le(),k=ot(t),o=(oe=r??k)==null?void 0:oe.setKey,f=x.useCallback(m=>t&&g.arts.set(t,{location:m}),[g,t]),u=!r,[w,_]=x.useState(!1),E=x.useCallback(()=>_(!1),[_]),L=x.useCallback(()=>u&&_(!0),[u,_]),N=x.useCallback(m=>n(at,{onClick:()=>t&&(e==null?void 0:e(t)),sx:{flexGrow:1,display:"flex",flexDirection:"column"},children:m}),[e,t]),W=x.useCallback(m=>n(h,{sx:{flexGrow:1,display:"flex",flexDirection:"column"},children:m}),[]),v=r??k,{currentEfficiency:C,maxEfficiency:A,currentEfficiency_:R,maxEfficiency_:H}=x.useMemo(()=>{if(!v)return{currentEfficiency:0,maxEfficiency:0,currentEfficiency_:0,maxEfficiency_:0};const{currentEfficiency:m,maxEfficiency:ge}=M(v,s),{currentEfficiency:be,maxEfficiency:ve}=M(v,new Set(Z));return{currentEfficiency:m,maxEfficiency:ge,currentEfficiency_:be,maxEfficiency_:ve}},[v,s]);if(!v)return null;const{id:te,lock:j,slotKey:T,setKey:U,rarity:D,level:q,mainStatKey:O,substats:me,location:ne=""}=v,re=Math.max(Math.min(i,D*4),q),V=A!==0,z=n(je,{setKey:U,slotKey:T}),ie=n(qe,{setKey:U,slotKey:T}),ae=ie&&n(st,{title:d(h,{children:[n(y,{variant:"h6",children:z}),n(y,{children:ie})]})}),xe=Ce.find(m=>O.startsWith(m));return d(x.Suspense,{fallback:n(B,{variant:"rectangular",sx:{width:"100%",height:"100%",minHeight:350}}),children:[l&&n(x.Suspense,{fallback:!1,children:n(yt,{artifactIdToEdit:w?t:"",cancelEdit:E,...l})}),d(Ae,{sx:{height:"100%",display:"flex",flexDirection:"column"},children:[d(Ye,{condition:!!e,wrapper:N,falseWrapper:W,children:[d(h,{className:`grad-${D}star`,sx:{position:"relative",width:"100%"},children:[!e&&n(Oe,{color:"primary",disabled:!u,onClick:()=>g.arts.set(te,{lock:!j}),sx:{position:"absolute",right:0,bottom:0,zIndex:2},children:j?n(nt,{}):n(rt,{})}),d(h,{sx:{pt:2,px:2,position:"relative",zIndex:1},children:[d(h,{component:"div",sx:{display:"flex",alignItems:"center",gap:.4,mb:1},children:[n(Ve,{size:"small",label:n("strong",{children:` +${q}`}),color:et(q)}),!z&&n(B,{variant:"text",width:100}),z&&n(y,{noWrap:!0,sx:{textAlign:"center",backgroundColor:"rgba(100,100,100,0.35)",borderRadius:"1em",px:1.5},children:n("strong",{children:z})}),ae||n(B,{width:10})]}),d(y,{color:"text.secondary",variant:"body2",sx:{display:"flex",gap:.5,alignItems:"center"},children:[n(Ze,{iconProps:{fontSize:"inherit"},slotKey:T}),c(`slotName.${T}`)]}),d(y,{variant:"h6",sx:{display:"flex",alignItems:"center",gap:1},children:[n(de,{statKey:O,iconProps:{sx:{color:`${xe}.main`}}}),n("span",{children:b(O)})]}),n(y,{variant:"h5",children:n("strong",{children:n(Q,{color:re!==q?"warning":void 0,children:Re(O,D,re)})})}),n(Je,{stars:D,colored:!0})]}),n(h,{sx:{height:"100%",position:"absolute",right:0,top:0},children:n(h,{component:"img",src:Ke(U,T),width:"auto",height:"110%",sx:{float:"right",marginBottom:"-5%",marginTop:"-5%",marginRight:"-5%"}})})]}),d(Me,{sx:{flexGrow:1,display:"flex",flexDirection:"column",pt:1,pb:"0!important",width:"100%"},children:[me.map(m=>!!m.value&&n(xt,{stat:m,effFilter:s,rarity:D},m.key)),d(y,{variant:"caption",sx:{display:"flex",gap:1,alignItems:"center"},children:[n(Q,{color:"secondary",sx:{flexGrow:1},children:c`artifact:editor.curSubEff`}),n(P,{value:C,max:9,valid:V}),C!==R&&n("span",{children:"/"}),C!==R&&n(P,{value:R,max:9,valid:V})]}),C!==A&&d(y,{variant:"caption",sx:{display:"flex",gap:1},children:[n(Q,{color:"secondary",sx:{flexGrow:1},children:c`artifact:editor.maxSubEff`}),n(P,{value:A,max:9,valid:V}),A!==H&&n("span",{children:"/"}),A!==H&&n(P,{value:H,max:9,valid:V})]}),n(h,{flexGrow:1}),v.probability!==void 0&&v.probability>=0&&d("strong",{children:["Probability: ",(v.probability*100).toFixed(2),"%"]}),d(y,{color:"success.main",children:[o&&n(ze,{setKey:o})||"Artifact Set"," ",o&&n(ct,{title:n(pe,{setKey:o})})]})]})]}),d(h,{sx:{p:1,display:"flex",gap:1,justifyContent:"space-between",alignItems:"center"},children:[n(h,{sx:{flexGrow:1},children:u&&p?n(it,{location:ne,setLocation:f}):n(Xe,{location:ne})}),d(h,{display:"flex",gap:1,alignItems:"stretch",height:"100%",sx:{"& .MuiButton-root":{minWidth:0,height:"100%"}},children:[u&&l&&n($,{title:n(y,{children:c`artifact:edit`}),placement:"top",arrow:!0,children:n(se,{color:"info",size:"small",onClick:L,children:n(tt,{})})}),u&&!!a&&n($,{title:j?c("artifact:cantDeleteLock"):"",placement:"top",children:n("span",{children:n(se,{color:"error",size:"small",onClick:()=>a(te),disabled:j,children:n(Te,{})})})}),S]})]})]})]})}function xt({stat:t,effFilter:r,rarity:e}){var f;const{t:a}=F("statKey_gen"),i=((f=t.rolls)==null?void 0:f.length)??0,s=t.key?ue(t.key):0,l=x.useMemo(()=>t.key?$e(t.key,e):[],[t.key,e]),p=7-l.length,S=`roll${G(i,1,6)}`,c=t.efficiency??0,b=t.key&&r.has(t.key),g=Pe(.5+c/5*.5),k=ce(t.key),o=x.useMemo(()=>n(h,{display:"flex",gap:.25,height:"1.3em",sx:{opacity:b?1:.3},children:[...t.rolls].sort().map((u,w)=>n(gt,{value:100*u/s,color:`roll${G(p+l.indexOf(u),1,6)}.main`},`${w}${u}`))}),[b,t.rolls,s,l,p]);return d(h,{display:"flex",gap:1,alignContent:"center",children:[d(y,{sx:{flexGrow:1},color:i?`${S}.main`:"error.main",component:"span",children:[n(de,{statKey:t.key,iconProps:Ie})," ",a(t.key),`+${Le(t.value,ce(t.key))}${k}`]}),o,d(y,{sx:{opacity:g,minWidth:40,textAlign:"right"},children:[(c*100).toFixed(),"%"]})]})}function gt({color:t="red",value:r=50}){return n(h,{sx:{width:7,height:"100%",bgcolor:t,overflow:"hidden",borderRadius:1,display:"inline-block"},children:n(h,{sx:{width:10,height:`${100-G(r,0,100)}%`,bgcolor:"gray"}})})}const J=[3,4,6],Y={hp:6,atk:6,def:6,hp_:4,atk_:4,def_:4,eleMas:4,enerRech_:4,critRate_:3,critDMG_:3},ye={};function I(t,r,e,a){if(t.length===5){Ge(ye,t,a);return}for(const i of J)r[i]>0&&I([...t,i],{...r,[i]:r[i]-i},e-i,a*r[i]/e)}I([0],{3:6,4:20,6:18},44,1);I([3],{3:3,4:20,6:18},41,1);I([4],{3:6,4:16,6:18},40,1);I([6],{3:6,4:20,6:12},38,1);const X=Array(6).fill(0).map((t,r)=>{const e=[1];let a=0,i=1;for(;++a<=r;)i*=r-a+1,i/=a,e.push(i);return e}),K=[[1]];for(;K.length<6;){const t=K[K.length-1],r=Array(t.length+3).fill(0);t.forEach((e,a)=>{for(const i of[0,1,2,3])r[a+i]+=e}),K.push(r.map(e=>e/4))}for(const t of K){let r=t.reduce((e,a)=>e+a);t.forEach((e,a,i)=>{i[a]=r,r-=e})}function bt(t,r){if(t.rarity<=2)return NaN;const{rarity:e,level:a,substats:i}=t,s={...r},l=new Set(Object.keys(s));let p=0;{const o=t.mainStatKey;if(o in s){const f=e*4;if(Be.art.main[e][o][f]<s[o])return 0;delete s[o],l.delete(o)}}for(const{key:o,value:f}of i)o?l.has(o)&&(l.delete(o),s[o]>f?s[o]-=f:delete s[o]):p+=1;if(p+=4-i.length,l.size>p||Object.keys(s).length>4)return 0;const S=Ne(a,e)-p;for(const[o,f]of Object.entries(s))s[o]=Math.max(Math.ceil(10*f/ue(o,e)),1);let c=0;const b=Object.entries(s).map(([o,f])=>{const u=l.has(o)?1:0,w=Math.ceil(f/10)-u;return c+=w,{target:f,filler:u,minUpgrade:w}}).reverse();if(c>S)return 0;let g={[S]:1};const k=S-c;return b.forEach(({target:o,filler:f,minUpgrade:u},w)=>{const _={};for(let E=u;E<=u+k;E++){const L=o-7*(E+f),N=L>0?K[E+f][L]:1;for(const[W,v]of Object.entries(g)){const C=parseInt(W);if(C<E)continue;const A=vt(C,E,4-w),R=C-E;_[R]=(_[R]??0)+v*N*A}}g=_}),St(t.mainStatKey,i,l)*Object.values(g).reduce((o,f)=>o+f)}function vt(t,r,e){return X[t][r]*Math.pow(e-1,t-r)/Math.pow(e,t)}function St(t,r,e){const a=Y[t]??0;let i=0;const s={3:2,4:5,6:3};let l=ye[a];for(const{key:c}of r)if(c){const b=Y[c];l=l[b],s[b]-=1}a&&(s[a]-=1);const p={3:0,4:0,6:0};for(const c of e)p[Y[c]]+=1;let S=0;Fe(l,[],c=>typeof c=="number",(c,b)=>{S+=c;const g={3:0,4:0,6:0};for(const o of b)g[o]+=1;let k=c;for(const o of J){const f=g[o],u=p[o];if(f<u)return;k*=X[f][u]}i+=k});for(const c of J)i/=X[s[c]][p[c]];return i/S}const Tt=["rarity","level","artsetkey","efficiency","mefficiency","probability"];function Dt(){return{artSetKeys:[],rarity:[...We],levelLow:0,levelHigh:20,slotKeys:[...He],mainStatKeys:[],substats:[],locations:[],showEquipped:!0,showInventory:!0,locked:["locked","unlocked"],rvLow:0,rvHigh:900,useMaxRV:!1,lines:[1,2,3,4]}}function $t(t,r){return{rarity:e=>e.rarity??0,level:e=>e.level??0,artsetkey:e=>e.setKey??"",efficiency:e=>M(e,t).currentEfficiency,mefficiency:e=>M(e,t).maxEfficiency,probability:e=>{if(!Object.keys(r).length)return 0;const a=e.probability;return a===void 0?bt(e,r):a}}}function It(t=new Set(Z)){return{locked:(r,e)=>!(!e.includes("locked")&&r.lock||!e.includes("unlocked")&&!r.lock),locations:(r,e,a)=>r.location&&!a.showEquipped?e.includes(r.location):!0,showEquipped:()=>!0,showInventory:(r,e)=>r.location?!0:e,artSetKeys:(r,e)=>e.length?e.includes(r.setKey):!0,slotKeys:(r,e)=>e.includes(r.slotKey),mainStatKeys:(r,e)=>e.length?e.includes(r.mainStatKey):!0,levelLow:(r,e)=>e<=r.level,levelHigh:(r,e)=>e>=r.level,rvLow:(r,e,a)=>{if(e===0)return!0;e=e/100;const{useMaxRV:i}=a,{currentEfficiency:s,maxEfficiency:l}=M(r,t);return e<=(i?l:s)},rvHigh:(r,e,a)=>{if(e===900)return!0;e=e/100;const{useMaxRV:i}=a,{currentEfficiency:s,maxEfficiency:l}=M(r,t);return e>=(i?l:s)},useMaxRV:()=>!0,rarity:(r,e)=>e.includes(r.rarity),substats:(r,e)=>{for(const a of e)if(a&&!r.substats.some(i=>i.key===a))return!1;return!0},lines:(r,e)=>[0,...e].includes(r.substats.filter(a=>a.value).length)}}const Lt={level:["level","rarity","artsetkey"],rarity:["rarity","level","artsetkey"],artsetkey:["artsetkey","rarity","level"],efficiency:["efficiency"],mefficiency:["mefficiency"],probability:["probability"]};export{Mt as A,st as I,P,gt as S,$t as a,It as b,Lt as c,ft as d,Tt as e,Kt as f,Dt as i,bt as p,ot as u};
