import{a as le,g as ce,s as I,_ as k,r as m,u as de,ac as Kt,ad as Wt,e as ue,U as Ne,ae as Vt,af as qt,j as w,f as J,h as pe,ag as He,P as Gt,ah as Ut,ai as Ht,aj as Pe,b as j,ak as Be,al as Jt,l as Ft,d as Xt,q as f,n as o,H as M,E as $,m as D,am as ze,N as _,an as Qt,Z as dt,ao as Je,X as K,L,G as z,ap as Yt,$ as Ae,F,aq as Zt,ar as en,i as me,k as fe,as as ut,at as X,au as E,av as ae,Y as se,S as tn,aw as nn,a2 as W,ax as rn,ay as on,y as Fe,C as Xe,B as an,az as _e,aA as pt,aB as ye,aC as sn,ab as mt,V as ft,aD as ln,I as cn,W as dn,aE as un,aF as Qe,p as pn,aG as he,aH as ht,aI as mn,aJ as Ye,aK as gt,aL as bt,aM as fn,aN as hn,aO as gn,aP as bn,aQ as vn,aR as Ze}from"./index-CBw8MDeI.js";import{d as xn,b as yn,u as vt,S as Re,C as Cn,a as kn}from"./CharacterEditor-l_wZ14b2.js";import{u as $n,C as Sn}from"./useForceUpdate-ChVYdu_O.js";import{s as wn,t as Mn,w as Rn,c as Dn,l as _n,r as Tn,a as In,d as zn}from"./index-bzcHjU7n.js";import{u as En}from"./useLightCone-Li-gMst4.js";import{T as xt,d as Nn,M as ge,D as be}from"./DropdownButton-C6FU5COy.js";import{G as Pn,d as yt}from"./LocationAutocomplete-aaTeq5jL.js";import{C as Ct}from"./CardActionArea-DFhrtnLA.js";import{u as Bn,R as An,b as jn,D as Ln}from"./RelicCard-DKEH1WLQ.js";import{I as On}from"./InfoTooltip-D96t0tAd.js";function Kn(e){return le("MuiCollapse",e)}ce("MuiCollapse",["root","horizontal","vertical","entered","hidden","wrapper","wrapperInner"]);const Wn=["addEndListener","children","className","collapsedSize","component","easing","in","onEnter","onEntered","onEntering","onExit","onExited","onExiting","orientation","style","timeout","TransitionComponent"],Vn=e=>{const{orientation:t,classes:n}=e,r={root:["root",`${t}`],entered:["entered"],hidden:["hidden"],wrapper:["wrapper",`${t}`],wrapperInner:["wrapperInner",`${t}`]};return pe(r,Kn,n)},qn=I("div",{name:"MuiCollapse",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[t.root,t[n.orientation],n.state==="entered"&&t.entered,n.state==="exited"&&!n.in&&n.collapsedSize==="0px"&&t.hidden]}})(({theme:e,ownerState:t})=>k({height:0,overflow:"hidden",transition:e.transitions.create("height")},t.orientation==="horizontal"&&{height:"auto",width:0,transition:e.transitions.create("width")},t.state==="entered"&&k({height:"auto",overflow:"visible"},t.orientation==="horizontal"&&{width:"auto"}),t.state==="exited"&&!t.in&&t.collapsedSize==="0px"&&{visibility:"hidden"})),Gn=I("div",{name:"MuiCollapse",slot:"Wrapper",overridesResolver:(e,t)=>t.wrapper})(({ownerState:e})=>k({display:"flex",width:"100%"},e.orientation==="horizontal"&&{width:"auto",height:"100%"})),Un=I("div",{name:"MuiCollapse",slot:"WrapperInner",overridesResolver:(e,t)=>t.wrapperInner})(({ownerState:e})=>k({width:"100%"},e.orientation==="horizontal"&&{width:"auto",height:"100%"})),kt=m.forwardRef(function(t,n){const r=de({props:t,name:"MuiCollapse"}),{addEndListener:a,children:s,className:l,collapsedSize:p="0px",component:d,easing:u,in:c,onEnter:i,onEntered:h,onEntering:g,onExit:b,onExited:v,onExiting:C,orientation:S="vertical",style:R,timeout:y=Kt.standard,TransitionComponent:N=Wt}=r,Z=ue(r,Wn),V=k({},r,{orientation:S,collapsedSize:p}),P=Vn(V),ee=Ne(),Te=Vt(),B=m.useRef(null),te=m.useRef(),q=typeof p=="number"?`${p}px`:p,O=S==="horizontal",ne=O?"width":"height",ve=m.useRef(null),Et=qt(n,ve),G=x=>T=>{if(x){const A=ve.current;T===void 0?x(A):x(A,T)}},Ie=()=>B.current?B.current[O?"clientWidth":"clientHeight"]:0,Nt=G((x,T)=>{B.current&&O&&(B.current.style.position="absolute"),x.style[ne]=q,i&&i(x,T)}),Pt=G((x,T)=>{const A=Ie();B.current&&O&&(B.current.style.position="");const{duration:re,easing:xe}=He({style:R,timeout:y,easing:u},{mode:"enter"});if(y==="auto"){const Ue=ee.transitions.getAutoHeightDuration(A);x.style.transitionDuration=`${Ue}ms`,te.current=Ue}else x.style.transitionDuration=typeof re=="string"?re:`${re}ms`;x.style[ne]=`${A}px`,x.style.transitionTimingFunction=xe,g&&g(x,T)}),Bt=G((x,T)=>{x.style[ne]="auto",h&&h(x,T)}),At=G(x=>{x.style[ne]=`${Ie()}px`,b&&b(x)}),jt=G(v),Lt=G(x=>{const T=Ie(),{duration:A,easing:re}=He({style:R,timeout:y,easing:u},{mode:"exit"});if(y==="auto"){const xe=ee.transitions.getAutoHeightDuration(T);x.style.transitionDuration=`${xe}ms`,te.current=xe}else x.style.transitionDuration=typeof A=="string"?A:`${A}ms`;x.style[ne]=q,x.style.transitionTimingFunction=re,C&&C(x)}),Ot=x=>{y==="auto"&&Te.start(te.current||0,x),a&&a(ve.current,x)};return w.jsx(N,k({in:c,onEnter:Nt,onEntered:Bt,onEntering:Pt,onExit:At,onExited:jt,onExiting:Lt,addEndListener:Ot,nodeRef:ve,timeout:y==="auto"?null:y},Z,{children:(x,T)=>w.jsx(qn,k({as:d,className:J(P.root,l,{entered:P.entered,exited:!c&&q==="0px"&&P.hidden}[x]),style:k({[O?"minWidth":"minHeight"]:q},R),ref:Et},T,{ownerState:k({},V,{state:x}),children:w.jsx(Gn,{ownerState:k({},V,{state:x}),className:P.wrapper,ref:B,children:w.jsx(Un,{ownerState:k({},V,{state:x}),className:P.wrapperInner,children:s})})}))}))});kt.muiSupportAuto=!0;const $t=kt,Hn=m.createContext({}),St=Hn;function Jn(e){return le("MuiAccordion",e)}const Fn=ce("MuiAccordion",["root","rounded","expanded","disabled","gutters","region"]),Ce=Fn,Xn=["children","className","defaultExpanded","disabled","disableGutters","expanded","onChange","square","slots","slotProps","TransitionComponent","TransitionProps"],Qn=e=>{const{classes:t,square:n,expanded:r,disabled:a,disableGutters:s}=e;return pe({root:["root",!n&&"rounded",r&&"expanded",a&&"disabled",!s&&"gutters"],region:["region"]},Jn,t)},Yn=I(Gt,{name:"MuiAccordion",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[{[`& .${Ce.region}`]:t.region},t.root,!n.square&&t.rounded,!n.disableGutters&&t.gutters]}})(({theme:e})=>{const t={duration:e.transitions.duration.shortest};return{position:"relative",transition:e.transitions.create(["margin"],t),overflowAnchor:"none","&::before":{position:"absolute",left:0,top:-1,right:0,height:1,content:'""',opacity:1,backgroundColor:(e.vars||e).palette.divider,transition:e.transitions.create(["opacity","background-color"],t)},"&:first-of-type":{"&::before":{display:"none"}},[`&.${Ce.expanded}`]:{"&::before":{opacity:0},"&:first-of-type":{marginTop:0},"&:last-of-type":{marginBottom:0},"& + &":{"&::before":{display:"none"}}},[`&.${Ce.disabled}`]:{backgroundColor:(e.vars||e).palette.action.disabledBackground}}},({theme:e})=>({variants:[{props:t=>!t.square,style:{borderRadius:0,"&:first-of-type":{borderTopLeftRadius:(e.vars||e).shape.borderRadius,borderTopRightRadius:(e.vars||e).shape.borderRadius},"&:last-of-type":{borderBottomLeftRadius:(e.vars||e).shape.borderRadius,borderBottomRightRadius:(e.vars||e).shape.borderRadius,"@supports (-ms-ime-align: auto)":{borderBottomLeftRadius:0,borderBottomRightRadius:0}}}},{props:t=>!t.disableGutters,style:{[`&.${Ce.expanded}`]:{margin:"16px 0"}}}]})),Zn=m.forwardRef(function(t,n){const r=de({props:t,name:"MuiAccordion"}),{children:a,className:s,defaultExpanded:l=!1,disabled:p=!1,disableGutters:d=!1,expanded:u,onChange:c,square:i=!1,slots:h={},slotProps:g={},TransitionComponent:b,TransitionProps:v}=r,C=ue(r,Xn),[S,R]=Ut({controlled:u,default:l,name:"Accordion",state:"expanded"}),y=m.useCallback(O=>{R(!S),c&&c(O,!S)},[S,c,R]),[N,...Z]=m.Children.toArray(a),V=m.useMemo(()=>({expanded:S,disabled:p,disableGutters:d,toggle:y}),[S,p,d,y]),P=k({},r,{square:i,disabled:p,disableGutters:d,expanded:S}),ee=Qn(P),Te=k({transition:b},h),B=k({transition:v},g),[te,q]=Bn("transition",{elementType:$t,externalForwardedProps:{slots:Te,slotProps:B},ownerState:P});return w.jsxs(Yn,k({className:J(ee.root,s),ref:n,ownerState:P,square:i},C,{children:[w.jsx(St.Provider,{value:V,children:N}),w.jsx(te,k({in:S,timeout:"auto"},q,{children:w.jsx("div",{"aria-labelledby":N.props.id,id:N.props["aria-controls"],role:"region",className:ee.region,children:Z})}))]}))}),ke=Zn;function er(e){return le("MuiAccordionDetails",e)}ce("MuiAccordionDetails",["root"]);const tr=["className"],nr=e=>{const{classes:t}=e;return pe({root:["root"]},er,t)},rr=I("div",{name:"MuiAccordionDetails",slot:"Root",overridesResolver:(e,t)=>t.root})(({theme:e})=>({padding:e.spacing(1,2,2)})),or=m.forwardRef(function(t,n){const r=de({props:t,name:"MuiAccordionDetails"}),{className:a}=r,s=ue(r,tr),l=r,p=nr(l);return w.jsx(rr,k({className:J(p.root,a),ref:n,ownerState:l},s))}),$e=or;function ar(e){return le("MuiAccordionSummary",e)}const sr=ce("MuiAccordionSummary",["root","expanded","focusVisible","disabled","gutters","contentGutters","content","expandIconWrapper"]),U=sr,ir=["children","className","expandIcon","focusVisibleClassName","onClick"],lr=e=>{const{classes:t,expanded:n,disabled:r,disableGutters:a}=e;return pe({root:["root",n&&"expanded",r&&"disabled",!a&&"gutters"],focusVisible:["focusVisible"],content:["content",n&&"expanded",!a&&"contentGutters"],expandIconWrapper:["expandIconWrapper",n&&"expanded"]},ar,t)},cr=I(Ht,{name:"MuiAccordionSummary",slot:"Root",overridesResolver:(e,t)=>t.root})(({theme:e})=>{const t={duration:e.transitions.duration.shortest};return{display:"flex",minHeight:48,padding:e.spacing(0,2),transition:e.transitions.create(["min-height","background-color"],t),[`&.${U.focusVisible}`]:{backgroundColor:(e.vars||e).palette.action.focus},[`&.${U.disabled}`]:{opacity:(e.vars||e).palette.action.disabledOpacity},[`&:hover:not(.${U.disabled})`]:{cursor:"pointer"},variants:[{props:n=>!n.disableGutters,style:{[`&.${U.expanded}`]:{minHeight:64}}}]}}),dr=I("div",{name:"MuiAccordionSummary",slot:"Content",overridesResolver:(e,t)=>t.content})(({theme:e})=>({display:"flex",flexGrow:1,margin:"12px 0",variants:[{props:t=>!t.disableGutters,style:{transition:e.transitions.create(["margin"],{duration:e.transitions.duration.shortest}),[`&.${U.expanded}`]:{margin:"20px 0"}}}]})),ur=I("div",{name:"MuiAccordionSummary",slot:"ExpandIconWrapper",overridesResolver:(e,t)=>t.expandIconWrapper})(({theme:e})=>({display:"flex",color:(e.vars||e).palette.action.active,transform:"rotate(0deg)",transition:e.transitions.create("transform",{duration:e.transitions.duration.shortest}),[`&.${U.expanded}`]:{transform:"rotate(180deg)"}})),pr=m.forwardRef(function(t,n){const r=de({props:t,name:"MuiAccordionSummary"}),{children:a,className:s,expandIcon:l,focusVisibleClassName:p,onClick:d}=r,u=ue(r,ir),{disabled:c=!1,disableGutters:i,expanded:h,toggle:g}=m.useContext(St),b=S=>{g&&g(S),d&&d(S)},v=k({},r,{expanded:h,disabled:c,disableGutters:i}),C=lr(v);return w.jsxs(cr,k({focusRipple:!1,disableRipple:!0,disabled:c,component:"div","aria-expanded":h,className:J(C.root,s),focusVisibleClassName:J(C.focusVisible,p),onClick:b,ref:n,ownerState:v},u,{children:[w.jsx(dr,{className:C.content,ownerState:v,children:a}),l&&w.jsx(ur,{className:C.expandIconWrapper,ownerState:v,children:l})]}))}),Se=pr;function mr(e){return le("MuiLinearProgress",e)}ce("MuiLinearProgress",["root","colorPrimary","colorSecondary","determinate","indeterminate","buffer","query","dashed","dashedColorPrimary","dashedColorSecondary","bar","barColorPrimary","barColorSecondary","bar1Indeterminate","bar1Determinate","bar1Buffer","bar2Indeterminate","bar2Buffer"]);const fr=["className","color","value","valueBuffer","variant"];let Q=e=>e,et,tt,nt,rt,ot,at;const Ee=4,hr=Pe(et||(et=Q`
  0% {
    left: -35%;
    right: 100%;
  }

  60% {
    left: 100%;
    right: -90%;
  }

  100% {
    left: 100%;
    right: -90%;
  }
`)),gr=Pe(tt||(tt=Q`
  0% {
    left: -200%;
    right: 100%;
  }

  60% {
    left: 107%;
    right: -8%;
  }

  100% {
    left: 107%;
    right: -8%;
  }
`)),br=Pe(nt||(nt=Q`
  0% {
    opacity: 1;
    background-position: 0 -23px;
  }

  60% {
    opacity: 0;
    background-position: 0 -23px;
  }

  100% {
    opacity: 1;
    background-position: -200px -23px;
  }
`)),vr=e=>{const{classes:t,variant:n,color:r}=e,a={root:["root",`color${j(r)}`,n],dashed:["dashed",`dashedColor${j(r)}`],bar1:["bar",`barColor${j(r)}`,(n==="indeterminate"||n==="query")&&"bar1Indeterminate",n==="determinate"&&"bar1Determinate",n==="buffer"&&"bar1Buffer"],bar2:["bar",n!=="buffer"&&`barColor${j(r)}`,n==="buffer"&&`color${j(r)}`,(n==="indeterminate"||n==="query")&&"bar2Indeterminate",n==="buffer"&&"bar2Buffer"]};return pe(a,mr,t)},je=(e,t)=>t==="inherit"?"currentColor":e.vars?e.vars.palette.LinearProgress[`${t}Bg`]:e.palette.mode==="light"?Ft(e.palette[t].main,.62):Xt(e.palette[t].main,.5),xr=I("span",{name:"MuiLinearProgress",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[t.root,t[`color${j(n.color)}`],t[n.variant]]}})(({ownerState:e,theme:t})=>k({position:"relative",overflow:"hidden",display:"block",height:4,zIndex:0,"@media print":{colorAdjust:"exact"},backgroundColor:je(t,e.color)},e.color==="inherit"&&e.variant!=="buffer"&&{backgroundColor:"none","&::before":{content:'""',position:"absolute",left:0,top:0,right:0,bottom:0,backgroundColor:"currentColor",opacity:.3}},e.variant==="buffer"&&{backgroundColor:"transparent"},e.variant==="query"&&{transform:"rotate(180deg)"})),yr=I("span",{name:"MuiLinearProgress",slot:"Dashed",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[t.dashed,t[`dashedColor${j(n.color)}`]]}})(({ownerState:e,theme:t})=>{const n=je(t,e.color);return k({position:"absolute",marginTop:0,height:"100%",width:"100%"},e.color==="inherit"&&{opacity:.3},{backgroundImage:`radial-gradient(${n} 0%, ${n} 16%, transparent 42%)`,backgroundSize:"10px 10px",backgroundPosition:"0 -23px"})},Be(rt||(rt=Q`
    animation: ${0} 3s infinite linear;
  `),br)),Cr=I("span",{name:"MuiLinearProgress",slot:"Bar1",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[t.bar,t[`barColor${j(n.color)}`],(n.variant==="indeterminate"||n.variant==="query")&&t.bar1Indeterminate,n.variant==="determinate"&&t.bar1Determinate,n.variant==="buffer"&&t.bar1Buffer]}})(({ownerState:e,theme:t})=>k({width:"100%",position:"absolute",left:0,bottom:0,top:0,transition:"transform 0.2s linear",transformOrigin:"left",backgroundColor:e.color==="inherit"?"currentColor":(t.vars||t).palette[e.color].main},e.variant==="determinate"&&{transition:`transform .${Ee}s linear`},e.variant==="buffer"&&{zIndex:1,transition:`transform .${Ee}s linear`}),({ownerState:e})=>(e.variant==="indeterminate"||e.variant==="query")&&Be(ot||(ot=Q`
      width: auto;
      animation: ${0} 2.1s cubic-bezier(0.65, 0.815, 0.735, 0.395) infinite;
    `),hr)),kr=I("span",{name:"MuiLinearProgress",slot:"Bar2",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[t.bar,t[`barColor${j(n.color)}`],(n.variant==="indeterminate"||n.variant==="query")&&t.bar2Indeterminate,n.variant==="buffer"&&t.bar2Buffer]}})(({ownerState:e,theme:t})=>k({width:"100%",position:"absolute",left:0,bottom:0,top:0,transition:"transform 0.2s linear",transformOrigin:"left"},e.variant!=="buffer"&&{backgroundColor:e.color==="inherit"?"currentColor":(t.vars||t).palette[e.color].main},e.color==="inherit"&&{opacity:.3},e.variant==="buffer"&&{backgroundColor:je(t,e.color),transition:`transform .${Ee}s linear`}),({ownerState:e})=>(e.variant==="indeterminate"||e.variant==="query")&&Be(at||(at=Q`
      width: auto;
      animation: ${0} 2.1s cubic-bezier(0.165, 0.84, 0.44, 1) 1.15s infinite;
    `),gr)),$r=m.forwardRef(function(t,n){const r=de({props:t,name:"MuiLinearProgress"}),{className:a,color:s="primary",value:l,valueBuffer:p,variant:d="indeterminate"}=r,u=ue(r,fr),c=k({},r,{color:s,variant:d}),i=vr(c),h=Jt(),g={},b={bar1:{},bar2:{}};if((d==="determinate"||d==="buffer")&&l!==void 0){g["aria-valuenow"]=Math.round(l),g["aria-valuemin"]=0,g["aria-valuemax"]=100;let v=l-100;h&&(v=-v),b.bar1.transform=`translateX(${v}%)`}if(d==="buffer"&&p!==void 0){let v=(p||0)-100;h&&(v=-v),b.bar2.transform=`translateX(${v}%)`}return w.jsxs(xr,k({className:J(i.root,a),ownerState:c,role:"progressbar"},g,{ref:n},u,{children:[d==="buffer"?w.jsx(yr,{className:i.dashed,ownerState:c}):null,w.jsx(Cr,{className:i.bar1,ownerState:c,style:b.bar1}),d==="determinate"?null:w.jsx(kr,{className:i.bar2,ownerState:c,style:b.bar2})]}))}),Sr=$r;function wr({avatar:e,title:t,action:n}){return f($,{display:"flex",gap:1,p:2,alignItems:"center",children:[e,o(M,{variant:"subtitle1",sx:{flexGrow:1},children:t}),n&&o(M,{variant:"caption",children:n})]})}function Mr({condition:e,wrapper:t,falseWrapper:n,children:r}){return e?t(r):n?n(r):r}function Rr({value:e,onChange:t,float:n=!1,...r}){const[a,s]=m.useState(e==null?void 0:e.toString()),{min:l,max:p}=(r==null?void 0:r.inputProps)??{};m.useEffect(()=>{s(e==null?void 0:e.toString())},[e]);const d=()=>{const i=n?parseFloat(a):parseInt(a);if(l!==void 0&&i<l){t(l),s(l.toString());return}if(p!==void 0&&i>p){t(p),s(p.toString());return}t(i)},u=i=>{const h=i.target.value;if(h.match(n?/[^0-9.-]/:/[^0-9-]/))return i.preventDefault();s(h)},c=i=>{i.target.select()};return o(xt,{value:a==null?void 0:a.toString(),onChange:u,onBlur:d,onFocus:c,onKeyDown:i=>i.key==="Enter"&&!r.multiline&&d(),...r,inputProps:{inputMode:"numeric",...r.inputProps??{}}})}function st({value:e,onChange:t,...n}){const[r,a]=m.useState(e);m.useEffect(()=>{a(e)},[e]);const s=()=>t(r);return o(xt,{value:r,onChange:l=>a(l.target.value),onBlur:s,onKeyDown:l=>l.key==="Enter"&&!n.multiline&&s(),...n})}function Dr(e){const{t}=D("ui"),n=ze({path:"/:page/*"}),r=t("pageTitle"),a=e??((n==null?void 0:n.params.page)&&t(`tabs.${n==null?void 0:n.params.page}`));m.useEffect(()=>{a?document.title=`${a} - ${r}`:document.title=r},[t,r,a])}function Le(e,t){const[n,r]=$n(),a=m.useMemo(()=>n&&e.get(t),[n,e,t]);return m.useEffect(()=>e.follow(t,r),[e,t,r]),a}function _r(e){const{database:t}=_();return Le(t.builds,e??"")}function wt(e){const t=m.useMemo(()=>e||Qt(dt,()=>""),[e]),{database:n}=_(),[r,a]=m.useState(()=>Je(t,s=>n.relics.get(s)));return m.useEffect(()=>{a(Je(t,l=>n.relics.get(l)));const s=Object.values(t).map(l=>n.relics.follow(l,(p,d,u)=>{d==="update"&&a(c=>({...c,[u.slotKey]:u})),d==="remove"&&a(c=>({...c,[u.slotKey]:void 0}))}));return()=>s.forEach(l=>l())},[n,t]),r}function H(e){const{database:t}=_();return Le(t.loadouts,e??"")}function Mt(e){const{database:t}=_();return Le(t.teams,e)}function Tr({slot:e}){const{t}=D("relic");return o(L,{sx:{height:"100%"},children:f(K,{children:[f(M,{children:[t("slot"),": ",e]}),o(M,{children:t("empty")})]})})}function Ir({build:e}){const t=wt(e);return o(z,{container:!0,columns:3,spacing:1,children:dt.map(n=>{const r=t[n];return o(z,{item:!0,xs:1,children:r?o(An,{relic:r}):o(Tr,{slot:n})},`${n}_${r==null?void 0:r.id}`)})})}function zr({charKey:e,setCharKey:t}){const{t:n}=D(["character","charNames_gen"]),{database:r}=_(),a=m.useCallback(p=>!!r.chars.get(p),[r.chars]),s=m.useCallback(p=>r.charMeta.get(p).favorite,[r.charMeta]),l=m.useMemo(()=>[{key:"",label:n("character:autocomplete.none")},...Yt.map(p=>({key:p,label:n(`charNames_gen:${p}`),favorite:s(p),color:a(p)?void 0:"secondary"}))],[a,s,n]);return o(m.Suspense,{fallback:o(Ae,{variant:"text",width:100}),children:o(Pn,{options:l,toImg:()=>o(F,{children:" "}),valueKey:e,onChange:p=>t(p??"")})})}function Er(e){return["basic","skill","ult","talent"].includes(e)}const Nr={Arlan:Zt,RuanMei:en};var Oe={},Pr=fe;Object.defineProperty(Oe,"__esModule",{value:!0});var De=Oe.default=void 0,Br=Pr(me()),Ar=w,jr=(0,Br.default)((0,Ar.jsx)("path",{d:"M12 12.75c1.63 0 3.07.39 4.24.9 1.08.48 1.76 1.56 1.76 2.73V18H6v-1.61c0-1.18.68-2.26 1.76-2.73 1.17-.52 2.61-.91 4.24-.91zM4 13c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2zm1.13 1.1c-.37-.06-.74-.1-1.13-.1-.99 0-1.93.21-2.78.58C.48 14.9 0 15.62 0 16.43V18h4.5v-1.61c0-.83.23-1.61.63-2.29zM20 13c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2zm4 3.43c0-.81-.48-1.53-1.22-1.85-.85-.37-1.79-.58-2.78-.58-.39 0-.76.04-1.13.1.4.68.63 1.46.63 2.29V18H24v-1.57zM12 6c1.66 0 3 1.34 3 3s-1.34 3-3 3-3-1.34-3-3 1.34-3 3-3z"}),"Groups");De=Oe.default=jr;function Lr({document:e,bgt:t="normal",collapse:n=!1,setConditional:r}){switch(e.type){case"fields":return o(Or,{fieldsDocument:e,bgt:t});case"text":return n?o(Kr,{textDocument:e}):o(Rt,{textDocument:e});case"conditional":return o(Wr,{conditional:e.conditional,setConditional:r,bgt:t});default:return null}}function Or({fieldsDocument:e,bgt:t="normal"}){return f(L,{bgt:t,children:[e.header&&o(Dt,{header:e.header,hideDivider:e.fields.length===0}),o(ut,{bgt:t,fields:e.fields})]})}function Rt({textDocument:e}){const t=m.useContext(X);return t?o("div",{children:E(e.text,t)}):null}function Kr({textDocument:e}){const[t,n]=m.useState(!1),[r,a]=m.useState(!1);return f($,{sx:{position:"relative"},children:[!t&&o($,{sx:{pointerEvents:"none",position:"absolute",mx:"auto",width:"100%",display:"flex",justifyContent:"center",height:"100%",alignItems:"flex-end",zIndex:"10",transition:"transform 0.3s ease",transform:r?"translate(0,-5px)":void 0},children:o(Nn,{})}),o($t,{onMouseEnter:()=>a(!0),onMouseLeave:()=>a(!1),collapsedSize:55,onClick:()=>n(s=>!s),in:t,sx:{cursor:"pointer",position:"relative",maskImage:t?void 0:"linear-gradient(to bottom, black 0%, transparent 100%)","&:hover":{maskImage:t?void 0:"linear-gradient(to bottom, black 50%, transparent 100%)"}},children:o(Rt,{textDocument:e})})]})}function Dt({header:e,hideDivider:t}){const{icon:n,text:r,additional:a}=e;return f(F,{children:[o(wr,{avatar:n,title:r,action:a}),!t&&o(ae,{})]})}function Wr({conditional:e,bgt:t="normal",setConditional:n}){const{header:r,fields:a}=e;return f(L,{bgt:t,children:[!!r&&o(Dt,{header:r}),o(Vr,{conditional:e,setConditional:n}),!!a&&o(ut,{bgt:t,fields:a})]})}function Vr({conditional:e,setConditional:t}){switch(e.metadata.type){case"bool":return o(qr,{conditional:e,setConditional:t});case"list":return o(Gr,{conditional:e,setConditional:t});case"num":return o(Ur,{conditional:e,setConditional:t});default:return null}}function ie({children:e}){return e?o(tn,{sx:{ml:1},children:e}):null}function Ke(e,t,n,r){return e.compute(nn({et:"own",qt:"cond",sheet:t,q:n,src:r,dst:e.cache.tag.src},"max")).val}function qr({conditional:e,setConditional:t}){const n=m.useContext(X),{label:r,badge:a}=e,{sheet:s,name:l}=e.metadata;if(!s||!l)throw new Error("metadata missing");if(!n)return null;const p="all",d=Ke(n,s,l,p),u=E(r,n,d),c=E(a,n,d);return f(se,{fullWidth:!0,size:"small",sx:{borderRadius:0},color:d?"success":"primary",onClick:()=>t(p,s,l,+!d),startIcon:d?o(xn,{}):o(yn,{}),children:[u," ",o(ie,{children:c})]})}function Gr({conditional:e,setConditional:t}){const n=m.useContext(X),{label:r,badge:a}=e,{sheet:s,name:l,list:p}=e.metadata;if(!s||!l)throw new Error("metadata missing");if(!n)return null;const d="all",u=Ke(n,s,l,d);return f(be,{fullWidth:!0,size:"small",sx:{borderRadius:0},color:u?"success":"primary",title:f(F,{children:[E(r,n,u)," ",o(ie,{children:E(a,n,u)})]}),children:[o(ae,{}),["0",...p].map((c,i)=>f(ge,{onClick:()=>t(d,s,l,i),selected:u===i,disabled:u===i,children:[E(r,n,i),o(ie,{children:E(a,n,i)})]},c))]})}function Ur({conditional:e,setConditional:t}){const n=m.useContext(X),{label:r,badge:a}=e,{sheet:s,name:l,int_only:p,min:d,max:u}=e.metadata;if(!s||!l)throw new Error("metadata missing");if(!n)return null;const c="all",i=Ke(n,s,l,c),h=E(r,n,i),g=E(a,n,i);return typeof d>"u"||typeof u>"u"?o(Rr,{fullWidth:!0,float:!p,inputProps:{min:d,max:u},InputProps:{startAdornment:h&&o($,{sx:{mr:1},children:h}),endAdornment:o(ie,{children:E(a,n,i)})},value:i,onChange:b=>t(c,s,l,b)}):f($,{sx:{px:2},children:[(h||a)&&f(M,{display:"flex",justifyContent:"space-between",children:[h," ",o(ie,{children:g})]}),o(Hr,{max:u,min:d,value:i,onChangeCommitted:(b,v)=>t(c,s,l,v),valueLabelDisplay:"auto"})]})}function Hr(e){const[t,n]=m.useState(e.value);return o(jn,{...e,onChange:(r,a)=>n(a),value:t})}function Y(){return m.useContext(X)}function _t({optTarget:e,setOptTarget:t}){const{t:n}=D("optimize"),r=Y();return o(be,{title:`${n("optTarget")}${e?`: ${e.tag.name||e.tag.q}`:""}`,children:r==null?void 0:r.listFormulas(W.listing.formulas).map((a,s)=>o(ge,{onClick:()=>t(a),children:a.tag.name||a.tag.q},`${s}_${a.tag.name||a.tag.q}`))})}function Jr({statFilters:e,setStatFilters:t,disabled:n=!1}){const r=m.useCallback((d,u,c)=>{const i={...e},h=JSON.stringify(u),g=u?[...e[h]]:void 0,b=JSON.stringify(d),v=[...e[b]??[]];c!==void 0&&g?v.push(g[c]):v.push({minValue:0,maxValue:0,disabled:!1}),i[b]=v,c!==void 0&&g&&(g.splice(c,1),g.length?i[h]=g:delete i[h]),t({...i})},[t,e]),a=m.useCallback((d,u)=>{const c={...e},i=JSON.stringify(d),h=[...e[i]];h.splice(u,1),h.length?c[i]=h:delete c[i],t({...c})},[t,e]),s=m.useCallback((d,u,c)=>{const i={...e},h=JSON.stringify(d),g=[...e[h]];g[u]={...g[u],minValue:c},i[h]=g,t({...i})},[t,e]),l=m.useCallback((d,u,c)=>{const i={...e},h=JSON.stringify(d),g=[...e[h]];g[u]={...g[u],maxValue:c},i[h]=g,t({...i})},[t,e]),p=m.useCallback((d,u,c)=>{const i={...e},h=JSON.stringify(d),g=[...e[h]];g[u]={...g[u],disabled:c},i[h]=g,t({...i})},[t,e]);return f(F,{children:[Object.entries(e).flatMap(([d,u])=>u==null?void 0:u.map((c,i)=>o(it,{path:JSON.parse(d),setting:c,index:i,setTarget:r,delTarget:a,setMinValue:s,setMaxValue:l,setDisabled:p,disabled:n},d+i))),o(it,{delTarget:a,setTarget:r,setMinValue:s,setMaxValue:l,setDisabled:p,disabled:n})]})}function it({path:e,setting:t,index:n,delTarget:r,setMinValue:a,setMaxValue:s,setDisabled:l,disabled:p}){const{t:d}=D("page_character_optimize"),u=m.useCallback(b=>e&&n!==void 0&&a(e,n,b??0),[a,e,n]),c=m.useCallback(b=>e&&n!==void 0&&s(e,n,b??1/0),[s,e,n]),[i,h]=m.useState(void 0),g={p:1,flexBasis:30,flexGrow:0,flexShrink:0};return f(an,{sx:{"& .MuiButtonGroup-grouped":{minWidth:24},width:"100%"},children:[!!t&&!!e&&n!==void 0&&o(se,{sx:g,color:t.disabled?"secondary":"success",onClick:()=>l(e,n,!t.disabled),disabled:p,children:t.disabled?o(rn,{}):o(on,{})}),o(Xe,{sx:{flexBasis:150,flexGrow:1},children:o(Fe,{float:!0,disabled:!e||p,value:t==null?void 0:t.minValue,placeholder:d("buildConstraint.minStatValue"),onChange:u,sx:{px:1},inputProps:{sx:{"& + .MuiOutlinedInput-notchedOutline":{borderRadius:0},textAlign:"right"}}})}),o(_t,{optTarget:i,setOptTarget:h}),o(Xe,{sx:{flexBasis:150,flexGrow:1},children:o(Fe,{float:!0,disabled:!e||p,value:t==null?void 0:t.maxValue,placeholder:d("buildConstraint.maxStatValue"),onChange:c,sx:{px:1},inputProps:{sx:{"& + .MuiOutlinedInput-notchedOutline":{borderRadius:0},textAlign:"left"}}})}),!!e&&n!==void 0&&o(se,{sx:g,color:"error",onClick:()=>r(e,n),disabled:p,children:o(Ln,{fontSize:"small"})})]})}function Fr({disabled:e=!1}){const{t}=D("page_character_optimize"),[n,r]=m.useState({});return o($,{children:f(L,{bgt:"light",children:[o(K,{sx:{display:"flex",gap:1,justifyContent:"space-between",flexDirection:"column"},children:f($,{display:"flex",justifyContent:"space-between",children:[o(M,{sx:{fontWeight:"bold"},children:t`constraintFilter.title`}),o(On,{title:o(M,{children:t`constraintFilter.tooltip`})})]})}),o(ae,{}),o($,{display:"flex",flexDirection:"column",gap:.5,children:o(Jr,{statFilters:n,setStatFilters:r,disabled:e})})]})})}function Xr({numWorkers:e,setNumWorkers:t}){const{t:n}=D("optimize"),r=navigator.hardwareConcurrency||8;return o(be,{title:`${n("numWorkers")}: ${e}`,children:_e(1,r).map(a=>o(ge,{onClick:()=>t(a),children:n("workers",{count:a})},a))})}function Qr({teamId:e,currentIndex:t,children:n}){var v,C,S,R;const r=Mt(e),a=H((v=r.loadoutMetadata[0])==null?void 0:v.loadoutId),s=H((C=r.loadoutMetadata[1])==null?void 0:C.loadoutId),l=H((S=r.loadoutMetadata[2])==null?void 0:S.loadoutId),p=H((R=r.loadoutMetadata[3])==null?void 0:R.loadoutId),d=m.useMemo(()=>{const y={all:"all"};return a&&(y[a.key]="0"),s&&(y[s.key]="1"),l&&(y[l.key]="2"),p&&(y[p.key]="3"),y},[a,s,l,p]),u=we(r.loadoutMetadata[0],d),c=we(r.loadoutMetadata[1],d),i=we(r.loadoutMetadata[2],d),h=we(r.loadoutMetadata[3],d),g=m.useMemo(()=>wn([...Mn(r.loadoutMetadata.map((y,N)=>y===void 0?void 0:pt[N]).filter(y=>!!y)),...u?Me(0,u):[],...c?Me(1,c):[],...i?Me(2,i):[],...h?Me(3,h):[],ye.common.lvl.add(80),ye.common.res.add(.1),ye.common.isBroken.add(0),ye.common.maxToughness.add(100),sn.common.critMode.add("avg")]),[u,c,i,h,r.loadoutMetadata]),b=m.useMemo(()=>(g==null?void 0:g.withTag({src:t,dst:t}))??null,[g,t]);return o(X.Provider,{value:b,children:n})}function we(e,t){const n=H(e==null?void 0:e.loadoutId),r=vt(n==null?void 0:n.key),a=_r(e==null?void 0:e.buildId),s=En(a==null?void 0:a.lightConeId),l=wt(a==null?void 0:a.relicIds),p=m.useMemo(()=>Object.fromEntries(Object.entries((n==null?void 0:n.conditional)??{}).map(([d,u])=>[t[d],u])),[n,t]);return m.useMemo(()=>({character:r,lightCone:s,relics:l,conditionals:p}),[r,s,p,l])}function Me(e,{character:t,lightCone:n,relics:r,conditionals:a}){return t?[...Rn(`${e}`,...Dn(t),..._n(n),...Tn(Object.values(r).filter(s=>!!s).map(s=>({set:s.setKey,stats:[...s.substats.filter(({key:l})=>l!=="").map(l=>({key:l.key,value:l.accurateValue})),{key:s.mainStatKey,value:s.mainStatVal}]})))),...In(`${e}`,a)]:[]}var We={},Yr=fe;Object.defineProperty(We,"__esModule",{value:!0});var Tt=We.default=void 0,Zr=Yr(me()),eo=w,to=(0,Zr.default)((0,eo.jsx)("path",{d:"M22 24H2v-4h20v4zM13.06 5.19l3.75 3.75L7.75 18H4v-3.75l9.06-9.06zm4.82 2.68-3.75-3.75 1.83-1.83c.39-.39 1.02-.39 1.41 0l2.34 2.34c.39.39.39 1.02 0 1.41l-1.83 1.83z"}),"BorderColor");Tt=We.default=to;var Ve={},no=fe;Object.defineProperty(Ve,"__esModule",{value:!0});var It=Ve.default=void 0,ro=no(me()),oo=w,ao=(0,ro.default)((0,oo.jsx)("path",{d:"M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"}),"Person");It=Ve.default=ao;function so({teamId:e,charKey:t,tab:n=""}){const{t:r}=D("page_team"),a=mt(),{database:s}=_(),l=s.teams.get(e),{loadoutMetadata:p}=l,d=Ne(),u=ft(d.breakpoints.down("md")),[c,i]=m.useState(!1),h=b=>{s.teams.set(e,{name:b})},g=b=>{s.teams.set(e,{description:b})};return f($,{sx:()=>({borderBottom:"1px rgb(200,200,200,0.3) solid","& .MuiTab-root:hover":{transition:"background-color 0.25s ease",backgroundColor:"rgba(255,255,255,0.1)"},"& .Mui-selected":{color:"white !important"},"& .MuiTabs-indicator":{height:"4px",backgroundColor:"rgb(200,200,200,0.5)"}}),children:[o(Ct,{onClick:()=>i(!0),children:o(ln,{placement:"top",title:f($,{children:[f($,{sx:{display:"flex",color:"info.light",gap:1},children:[o(Tt,{}),o(M,{children:o("strong",{children:r`team.editNameDesc`})})]}),!!l.description&&o(M,{children:l.description})]}),children:o(K,{sx:{display:"flex",justifyContent:"center","&:hover":{color:"info.light"}},children:f(M,{variant:"h5",sx:{display:"flex",gap:1,alignItems:"center",justifyContent:"center",textShadow:"#000 0 0 10px !important"},children:[o(De,{}),l.name]})})})}),o(dn,{open:c,onClose:()=>i(!1),children:f(L,{children:[o(Sn,{title:r`team.editNameDesc`,avatar:o(De,{}),titleTypographyProps:{variant:"h6"},action:o(cn,{onClick:()=>i(!1),children:o(yt,{})})}),o(ae,{}),o(K,{children:f($,{display:"flex",flexDirection:"column",gap:2,sx:{mt:2},children:[o(st,{label:r`team.name`,value:l.name,onChange:b=>h(b),autoFocus:!0}),o(st,{label:r`team.desc`,value:l.description,onChange:b=>g(b),multiline:!0,minRows:4})]})})]})}),o(ae,{}),f(un,{variant:"fullWidth",value:t??"team",orientation:u?"vertical":"horizontal",children:[o(Qe,{icon:o(De,{}),iconPosition:"start",value:"team",label:"Team Settings",onClick:()=>a(`/teams/${e}/`)}),p.map((b,v)=>{var S;const C=b&&((S=s.loadouts.get(b==null?void 0:b.loadoutId))==null?void 0:S.key);return o(Qe,{icon:o(It,{}),iconPosition:"start",value:C??v,disabled:!p[v],label:C?o(M,{children:r(`charNames_gen:${C}`)}):`Character ${v+1}`,onClick:()=>C&&a(`/teams/${e}/${C}/${n}`)},v)})]})]})}function io({teamId:e}){const{database:t}=_(),n=t.teams.get(e);return f($,{children:[e,n.loadoutMetadata.map((r,a)=>o(lo,{loadoutMetadataIndex:a,teamId:e},`${a}_${r==null?void 0:r.loadoutId}`))]})}function lo({loadoutMetadataIndex:e,teamId:t}){var p;const{database:n}=_(),r=n.teams.get(t),a=(p=r.loadoutMetadata[e])==null?void 0:p.loadoutId,s=n.loadouts.get(a);function l(d){if(d===""){n.teams.set(t,c=>c.loadoutMetadata[e]=void 0);return}n.chars.getOrCreate(d);const u=r.loadoutMetadata.findIndex(c=>{var i;return c&&((i=n.loadouts.get(c.loadoutId))==null?void 0:i.key)===d});if(u===-1){let c=n.loadouts.keys.find(i=>n.loadouts.get(i).key===d);c||(c=n.loadouts.new(d)),n.teams.set(t,i=>{i.loadoutMetadata[e]={loadoutId:c}})}else{if(u===e)return;const c=r.loadoutMetadata[u],i=r.loadoutMetadata[e];n.teams.set(t,h=>{h.loadoutMetadata[e]=c,h.loadoutMetadata[u]=i})}}return o(zr,{charKey:(s==null?void 0:s.key)??"",setCharKey:l})}var qe={},co=fe;Object.defineProperty(qe,"__esModule",{value:!0});var oe=qe.default=void 0,uo=co(me()),po=w,mo=(0,uo.default)((0,po.jsx)("path",{d:"M16.59 8.59 12 13.17 7.41 8.59 6 10l6 6 6-6z"}),"ExpandMore");oe=qe.default=mo;const fo=5e4;class ho{constructor(t,n,r,a,s){this.calc=t,this.optTarget=n,this.relicsBySlot=r,this.numWorkers=a,this.setProgress=s,this.worker=new Worker(new URL(""+new URL("parentWorker-q8Kd5MtO.js",import.meta.url).href,import.meta.url),{type:"module"})}async optimize(){return await new Promise((n,r)=>{this.worker.onmessage=({data:s})=>{switch(s.resultType){case"progress":this.setProgress(s.progress);break;case"done":n(s.buildResults);break;case"err":console.log(s),r();break}};const a={command:"start",relicsBySlot:this.relicsBySlot,detachedNodes:this.detachNodes(),numWorkers:this.numWorkers};this.worker.postMessage(a)})}async terminate(){const t={command:"terminate"};this.worker.postMessage(t),await new Promise((n,r)=>{this.worker.onmessage=({data:a})=>{switch(a.resultType){case"terminated":n();break;case"err":console.log(a),r();break}}}),this.worker.terminate()}detachNodes(){const t=new Set(pn);return zn([this.optTarget],this.calc,r=>{if(r.src==="0"&&r.et==="own"){if(r.sheet==="dyn"&&r.qt==="premod")return{q:r.q};if(r.q==="count"&&t.has(r.sheet))return{q:r.sheet}}})}}var Ge={},go=fe;Object.defineProperty(Ge,"__esModule",{value:!0});var zt=Ge.default=void 0,bo=go(me()),vo=w,xo=(0,bo.default)((0,vo.jsx)("path",{d:"m16 6 2.29 2.29-4.88 4.88-4-4L2 16.59 3.41 18l6-6 4 4 6.3-6.29L22 12V6z"}),"TrendingUp");zt=Ge.default=xo;function yo(){const{t:e}=D("optimize"),{database:t}=_(),n=Y(),[r,a]=m.useState(8),[s,l]=m.useState(void 0),[p,d]=m.useState(void 0),u=m.useMemo(()=>t.relics.values.reduce((R,y)=>(R[y.slotKey].push(y),R),{head:[],hands:[],feet:[],body:[],sphere:[],rope:[]}),[t.relics.values]),c=Object.values(u).reduce((R,y)=>R*y.length,1),[i,h]=m.useState(void 0),[g,b]=m.useState(!1),v=m.useRef(()=>{});m.useEffect(()=>()=>v.current(),[]);const C=m.useCallback(async()=>{if(!p||!n)return;const R=new Promise(Z=>v.current=Z);l(void 0),b(!0);const y=new ho(n,p,u,r,l);R.then(async()=>await y.terminate());const N=await y.optimize();await y.terminate(),v.current=()=>{},b(!1),h(N[0])},[n,r,p,u]),S=m.useCallback(()=>{v.current(),b(!1)},[v]);return o(L,{bgt:"dark",children:f(K,{children:[o(Fr,{}),f(Re,{children:[o(M,{variant:"h5",children:e("optimize")}),f($,{children:[o(_t,{optTarget:p,setOptTarget:d}),o(Xr,{numWorkers:r,setNumWorkers:a}),o(se,{onClick:g?S:C,color:g?"error":"primary",startIcon:g?o(yt,{}):o(zt,{}),children:e(g?"cancel":"optimize")})]}),s&&o(Co,{progress:s,totalPermutations:c}),i&&f($,{children:[f(M,{children:["Best: ",i.value]}),o(Ir,{build:i.ids})]})]})]})})}function Co({progress:e,totalPermutations:t}){const{t:n}=D("optimize");return f($,{children:[f(M,{children:[n("totalProgress"),": ",e.numBuildsComputed.toLocaleString()," /"," ",t.toLocaleString()]}),f(M,{children:[n("buildsKept"),": ",e.numBuildsKept.toLocaleString()," /"," ",fo.toLocaleString()]}),o(Sr,{variant:"determinate",value:e.numBuildsComputed/t*100})]})}const ko={xs:12,sm:6,md:4};function $o(){const{loadout:{key:e}}=he(),t=Y(),{t:n}=D("sheet_gen"),{database:r}=_(),a=[["basic",n("ability.basic")],["skill",n("ability.skill")],["ult",n("ability.ult")],["talent",n("ability.talent")]],s=Ne(),l=ft(s.breakpoints.up("lg")),p=Nr[e],d=(t==null?void 0:t.compute(W.char.eidolon).val)??0,u=m.useMemo(()=>p&&_e(1,gt).map(c=>{const i=p[`eidolon${c}`];return i?o(lt,{talentKey:`eidolon${c}`,subtitle:f("span",{children:[n("eidolonLvl")," ",c]}),sheetElement:i,onClickTitle:()=>r.chars.set(e,{eidolon:c===d?c-1:c})}):null}),[e,p,r.chars,d,n]);if(!(!p||!t))return o(F,{children:f(z,{container:!0,spacing:1,children:[l&&f(z,{item:!0,xs:12,md:12,lg:3,sx:{display:"flex",flexDirection:"column",gap:1},children:[o(ct,{}),u&&u.map((c,i)=>o($,{sx:{opacity:d>=i+1?1:.5},children:c},i))]}),o(z,{item:!0,xs:12,md:12,lg:9,container:!0,spacing:1,children:a.map(([c,i])=>{const h=p[c];return h?o(z,{item:!0,...ko,children:o(lt,{talentKey:c,subtitle:i,sheetElement:h})},c):null})}),!l&&o(z,{item:!0,xs:12,md:12,lg:3,container:!0,spacing:1,children:o(z,{item:!0,xs:12,children:o(ct,{})})})]})})}function lt({sheetElement:e,talentKey:t,subtitle:n,onClickTitle:r}){const{loadout:{key:a}}=he(),s=m.useCallback(c=>o(Ct,{onClick:r,children:c}),[r]);let l=null;l=null,Er(t)&&(l=o(So,{talentKey:t,dropDownButtonProps:{sx:{borderRadius:0}},setTalent:c=>d.chars.set(a,i=>{i[t]=c})}));const{loadoutId:p}=m.useContext(ht),{database:d}=_(),u=m.useCallback((c,i,h,g)=>{d.loadouts.set(p,b=>(b=structuredClone(b),mn(b.conditional,[c,i,h],g),b))},[d,p]);return f(L,{bgt:"light",sx:{height:"100%"},children:[l,f(K,{children:[o(Mr,{condition:!!r,wrapper:s,children:f(z,{container:!0,sx:{flexWrap:"nowrap"},children:[o(z,{item:!0,children:o($,{component:Ye?Ye:"img",src:e==null?void 0:e.img,sx:{width:60,height:"auto"}})}),f(z,{item:!0,flexGrow:1,sx:{pl:1},children:[o(M,{variant:"h6",children:e==null?void 0:e.name}),f(M,{variant:"subtitle1",children:[n,e.tag&&f(F,{children:[" • ",e.tag]})]})]})]})}),e.documents.map((c,i)=>o(Lr,{document:c,collapse:!0,setConditional:u},i))]})]})}function ct(){const{t:e}=D("sheet_gen"),t=Y(),{loadout:{key:n}}=he(),{database:r}=_();if(!t)return null;const a=t.compute(W.char.eidolon).val;return o(be,{fullWidth:!0,title:f("span",{children:[e("eidolonLvl")," ",a]}),color:"primary",children:_e(0,gt).map(s=>o(ge,{selected:a===s,disabled:a===s,onClick:()=>r.chars.set(n,{eidolon:s}),children:f("span",{children:[e("eidolonLvl")," ",s]})},s))})}function So({talentKey:e,setTalent:t,dropDownButtonProps:n}){const{t:r}=D("sheet_gen"),{character:a}=bt(),s=Y();if(!s||!a)return null;const l=0,p=s.compute(W.char[e]).val,d=s.compute(W.char.ascension).val;return o(be,{fullWidth:!0,title:f("span",{children:[r("lvl")," ",p]}),color:"primary",...n,children:_e(1,fn[d]).map(u=>o(ge,{selected:a[e]===u,disabled:a[e]===u,onClick:()=>t(u),children:f("span",{children:[r("lvl")," ",u+l]})},u))})}function wo({tab:e}){const{loadout:{key:t}}=he(),{character:n}=bt(),r=Y(),[a,s]=m.useState(void 0);return f($,{children:[e,o(Cn,{characterKey:a,onClose:()=>s(void 0)}),o(kn,{character:n}),f(Re,{gap:1,pt:1,children:[o(L,{bgt:"dark",children:f(K,{children:[o(se,{disabled:!t,onClick:()=>t&&s(t),children:"Edit Character"}),f(ke,{children:[o(Se,{expandIcon:o(oe,{}),children:"All target listings"}),o($e,{children:o(Re,{children:r==null?void 0:r.listFormulas(W.listing.formulas).map((l,p)=>{const d=r.compute(l),u=l.tag.name||l.tag.q;return f($,{children:[f(M,{children:[u,": ",d.val]}),f(ke,{children:[f(Se,{expandIcon:o(oe,{}),children:["debug for ",u]}),f($e,{children:["conds:"," ",JSON.stringify(d.meta.conds,void 0,2),o(M,{component:"pre",children:JSON.stringify(r.toDebug().compute(l),void 0,2)})]})]})]},`${u}${p}`)})})})]}),f(ke,{children:[o(Se,{expandIcon:o(oe,{}),children:"All target buffs"}),o($e,{children:o(Re,{children:r==null?void 0:r.listFormulas(W.listing.buffs).map((l,p)=>{const d=r.compute(l),u=l.tag.name||l.tag.q;return f($,{children:[f(M,{children:[u,": ",d.val]}),f(ke,{children:[f(Se,{expandIcon:o(oe,{}),children:["debug for ",u]}),f($e,{children:["conds:"," ",JSON.stringify(d.meta.conds,void 0,2),o(M,{component:"pre",children:JSON.stringify(r.toDebug().compute(l),void 0,2)})]})]})]},`${u}${p}`)})})})]})]})}),o($o,{}),o(yo,{})]})]})}const Mo=o(Ae,{variant:"rectangular",width:"100%",height:1e3});function Lo(){const{database:e}=_(),{teamId:t}=hn(),n=!t||!e.teams.keys.includes(t);return m.useEffect(()=>{n||e.teams.set(t,{lastEdit:Date.now()})},[t,e.teams,n]),n?o(bn,{to:"/teams"}):o($,{display:"flex",flexDirection:"column",gap:1,children:o(m.Suspense,{fallback:Mo,children:t&&o(Ro,{teamId:t})})})}function Ro({teamId:e}){var b;const{database:t}=_(),n=mt(),r=Mt(e),{loadoutMetadata:a}=r,{params:{characterKey:s}}=ze({path:"/teams/:teamId/:characterKey",end:!1})??{params:{}},{params:{tab:l}}=ze({path:"/teams/:teamId/:characterKey/:tab"})??{params:{}},p=m.useMemo(()=>a.findIndex(v=>{var C;return(v==null?void 0:v.loadoutId)&&((C=t.loadouts.get(v.loadoutId))==null?void 0:C.key)===s}),[a,t.loadouts,s]),d=m.useMemo(()=>a[p],[a,p]);m.useEffect(()=>{window.scrollTo({top:0})},[]),m.useEffect(()=>{d||n("",{replace:!0})},[d,n]);const u=d==null?void 0:d.loadoutId,c=(b=t.loadouts.get(u))==null?void 0:b.key,{t:i}=D(["charNames_gen","page_character"]);Dr(m.useMemo(()=>{const v=i(c?"charNames_gen:Character":"Team Settings"),C=l?i(`page_character:tabs.${l}`):c?i("Loadout/Build"):l;return`${r.name} - ${v}${C?` - ${C}`:""}`},[c,i,l,r.name]));const h=H(u??""),g=m.useMemo(()=>{if(!(!u||!h||!d))return{teamId:e,team:r,loadoutId:u,loadout:h,loadoutMetadatum:d}},[d,r,h,u,e]);return o(Qr,{teamId:e,currentIndex:pt[p],children:f($,{sx:{display:"flex",gap:1,flexDirection:"column",mx:1,mt:2},children:[o(L,{children:o(so,{teamId:e,charKey:c,tab:l})}),o($,{children:g?o(ht.Provider,{value:g,children:o(Do,{})}):o(io,{teamId:e})})]})})}function Do({tab:e}){const{loadout:{key:t}}=he(),n=vt(t),r=m.useMemo(()=>n&&{character:n},[n]);return r?o(gn.Provider,{value:r,children:o(vn,{children:o(Ze,{path:":characterKey",children:o(Ze,{path:"*",index:!0,element:o(wo,{tab:e})})})})}):o(Ae,{variant:"rectangular",width:"100%",height:1e3})}export{Lo as default};
