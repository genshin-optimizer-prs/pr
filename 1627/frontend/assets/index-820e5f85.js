import{e as i,Q as L,n,J as s,p as t,T as v,B as w,t as _,C as y,D as $,U as P,V as et,r as rt,i as it,j as nt,u as I,b as O,N as S,_ as V,W as St,s as at,X as st,K as W,Y as Dt,Z as Ct,$ as _t,M as It,R as ot}from"./index-a526b209.js";import{u as Et,A as Pt,P as Tt}from"./LocationAutocomplete-9b1b9759.js";import{f as Ft,s as Mt}from"./StarDisplay-28e8f69e.js";import{d as lt,A as ct,a as Rt,b as $t,p as Ot,c as jt,e as Z}from"./ArtifactSort-9154f88e.js";import{S as qt,A as Ut}from"./StatEditorList-da3ddbbb.js";import{d as Kt}from"./BootstrapTooltip-ea97cd4b.js";import{C as B}from"./CloseButton-cfc175df.js";import{T as Lt}from"./index-133485b7.js";import{u as ut}from"./useDisplayArtifact-cccf6d12.js";import{d as Wt,a as Bt}from"./LockOpen-755946c6.js";import{S as R}from"./SqBadge-49f3a99e.js";import{C as Vt}from"./ColoredText-3b59b665.js";import"./DropdownButton-d41cf2a2.js";import"./SlotIcon-d187952b.js";import"./InfoTooltip-c1f7f871.js";import"./index-c070a4ae.js";import"./Artifact-12786f38.js";import"./CardActionArea-d886c601.js";import"./Link-6074cdd2.js";const zt=r=>r[Math.floor(Math.random()*r.length)];function Gt(r){const[e,a]=i.useState(!1),o=i.useRef(null);return o.current||(o.current=new IntersectionObserver(([c])=>a(c.isIntersecting))),i.useEffect(()=>{if(a(!1),!!o.current&&r)return o.current.observe(r),()=>{var c;(c=o.current)==null||c.disconnect()}},[r]),e}function Nt({pageKey:r,text:e="",modalTitle:a="",children:o}){const[c,h,d]=L(localStorage.getItem(`infoShown_${r}`)!=="true"),[f]=i.useState(Array.isArray(e)?zt(e):e),b=i.useCallback(()=>{d(),localStorage.setItem(`infoShown_${r}`,"true")},[d,r]);return n(_,{children:[n(s,{container:!0,children:[t(s,{item:!0,flexGrow:1,children:t(v,{variant:"caption",pl:1,children:f})}),t(s,{item:!0,xs:"auto",children:t(w,{size:"small",color:"info",variant:"contained",onClick:h,startIcon:t(Kt,{}),children:t(Lt,{ns:"ui",key18:"info"})})})]}),t(et,{containerProps:{maxWidth:"xl"},open:c,onClose:b,children:n(_,{children:[t(y,{sx:{py:1},children:n(s,{container:!0,children:[t(s,{item:!0,flexGrow:1,children:t(v,{variant:"h6",children:a})}),t(s,{item:!0,children:t(B,{onClick:b})})]})}),t($,{}),t(y,{children:t(i.Suspense,{fallback:t(P,{variant:"rectangular",width:"100%",height:500}),children:o})}),t($,{}),t(y,{sx:{py:1},children:t(B,{large:!0,onClick:b})})]})})]})}var z={},Ht=it;Object.defineProperty(z,"__esModule",{value:!0});var dt=z.default=void 0,Qt=Ht(rt()),Xt=nt,Jt=(0,Qt.default)((0,Xt.jsx)("path",{d:"M8.65 5.82C9.36 4.72 10.6 4 12 4c2.21 0 4 1.79 4 4 0 1.4-.72 2.64-1.82 3.35L8.65 5.82zM20 17.17c-.02-1.1-.63-2.11-1.61-2.62-.54-.28-1.13-.54-1.77-.76L20 17.17zm1.19 4.02L2.81 2.81 1.39 4.22l8.89 8.89c-1.81.23-3.39.79-4.67 1.45-1 .51-1.61 1.54-1.61 2.66V20h13.17l2.61 2.61 1.41-1.42z"}),"PersonOff");dt=z.default=Jt;var G={},Yt=it;Object.defineProperty(G,"__esModule",{value:!0});var ft=G.default=void 0,Zt=Yt(rt()),te=nt,ee=(0,Zt.default)((0,te.jsx)("path",{d:"M12 5V1L7 6l5 5V7c3.31 0 6 2.69 6 6s-2.69 6-6 6-6-2.69-6-6H4c0 4.42 3.58 8 8 8s8-3.58 8-8-3.58-8-8-8z"}),"Replay");ft=G.default=ee;const re=i.lazy(()=>V(()=>import("./ArtifactFilterDisplay-a038ed67.js").then(r=>r.b),["./ArtifactFilterDisplay-a038ed67.js","./index-a526b209.js","./index-cae87115.css","./LockOpen-755946c6.js","./useDisplayArtifact-cccf6d12.js","./totalUtils-8ac7fa79.js","./BootstrapTooltip-ea97cd4b.js","./StarDisplay-28e8f69e.js","./DropdownButton-d41cf2a2.js","./ColoredText-3b59b665.js","./index-133485b7.js","./SqBadge-49f3a99e.js","./ArtifactStatKeyDisplay-cf17d201.js","./Artifact-12786f38.js","./LocationAutocomplete-9b1b9759.js","./index-c070a4ae.js","./SlotIcon-d187952b.js"],import.meta.url));function ie({numShowing:r,total:e,artifactIds:a}){const{t:o}=I(["artifact","ui"]),c=O(),{filterOption:h}=ut(),d=i.useCallback(f=>c.displayArtifact.set({filterOption:{...h,...f}}),[c,h]);return t(i.Suspense,{fallback:t(P,{variant:"rectangular",width:"100%",height:300}),children:t(_,{children:n(y,{children:[n(s,{container:!0,children:[t(s,{item:!0,children:t(v,{variant:"h6",children:t(S,{t:o,i18nKey:"artifactFilter",children:"Artifact Filter"})})}),t(s,{item:!0,flexGrow:1,display:"flex",justifyContent:"center",alignItems:"center",children:r!==e&&n(v,{children:["Filtered ",t("strong",{children:r})," / ",e]})}),t(s,{item:!0,children:t(w,{size:"small",color:"error",onClick:()=>c.displayArtifact.set({action:"reset"}),startIcon:t(ft,{}),children:t(S,{t:o,i18nKey:"ui:reset"})})})]}),t(i.Suspense,{fallback:t(P,{variant:"rectangular",width:"100%",height:200}),children:t(re,{filterOption:h,filterOptionDispatch:d,filteredIds:a})})]})})})}function ne({artifactIds:r}){const{t:e}=I(["artifact","ui"]),a=O(),{numDelete:o,numUnequip:c,numUnlock:h,numLock:d}=i.useMemo(()=>{const u=r.map(A=>a.arts.get(A)),p=u.reduce((A,C)=>A+(C.lock?0:1),0),x=u.length-p,k=p,j=u.reduce((A,C)=>A+(C.location?1:0),0);return{numDelete:k,numUnequip:j,numUnlock:p,numLock:x}},[r,a]);return n(s,{container:!0,spacing:1,alignItems:"center",children:[t(s,{item:!0,xs:12,sm:6,md:3,children:n(w,{fullWidth:!0,color:"error",disabled:!c,onClick:()=>window.confirm(`Are you sure you want to unequip ${c} artifacts currently equipped on characters?`)&&r.map(u=>a.arts.set(u,{location:""})),startIcon:t(dt,{}),children:[t(S,{t:e,i18nKey:"button.unequipArtifacts",children:"Unequip Artifacts"}),t(R,{sx:{ml:1},color:c?"success":"secondary",children:c})]})}),t(s,{item:!0,xs:12,sm:6,md:3,children:n(w,{fullWidth:!0,color:"error",disabled:!o,onClick:()=>window.confirm(`Are you sure you want to delete ${o} artifacts?`)&&r.map(u=>{var p;return!((p=a.arts.get(u))!=null&&p.lock)&&a.arts.remove(u)}),startIcon:t(St,{}),children:[t(S,{t:e,i18nKey:"button.deleteArtifacts",children:"Delete Artifacts"}),t(R,{sx:{ml:1},color:o?"success":"secondary",children:o})]})}),t(s,{item:!0,xs:12,sm:6,md:3,children:n(w,{fullWidth:!0,color:"error",disabled:!d,onClick:()=>window.confirm(`Are you sure you want to unlock ${d} artifacts?`)&&r.map(u=>a.arts.set(u,{lock:!1})),startIcon:t(Wt,{}),children:[t(S,{t:e,i18nKey:"button.unlockrtifacts",children:"Unlock Artifacts"}),t(R,{sx:{ml:1},color:d?"success":"secondary",children:d})]})}),t(s,{item:!0,xs:12,sm:6,md:3,children:n(w,{fullWidth:!0,color:"error",disabled:!h,onClick:()=>window.confirm(`Are you sure you want to lock ${h} artifacts?`)&&r.map(u=>a.arts.set(u,{lock:!0})),startIcon:t(Bt,{}),children:[t(S,{t:e,i18nKey:"button.lockArtifacts",children:"Lock Artifacts"}),t(R,{sx:{ml:1},color:h?"success":"secondary",children:h})]})}),t(s,{item:!0,xs:12,display:"flex",justifyContent:"space-around",children:t(v,{variant:"caption",color:"text.secondary",children:n(S,{t:e,i18nKey:"buttonHint",children:["Note: the red buttons above only apply to",t("b",{children:"currently filtered artifacts"})]})})})]})}function ae({show:r,onHide:e}){const{t:a}=I("artifact");return t(et,{open:r,onClose:e,children:n(at,{children:[n(y,{sx:{display:"flex",alignItems:"center"},children:[n(v,{variant:"h6",flexGrow:1,children:[t(lt,{sx:{verticalAlign:"text-top",mr:1}}),a`showDup`]}),t(B,{onClick:e})]}),t($,{}),t(y,{children:t(se,{})})]})})}function se(){const{t:r}=I("artifact"),e=O(),[a,o]=st();i.useEffect(()=>e.arts.followAny(o),[o,e]);const c=i.useMemo(()=>{const d=a&&[];let f=e.arts.keys;for(;f.length!==0;){const b=f.shift();if(!b)continue;const g=e.arts.get(b);if(!g)continue;const{duplicated:D}=e.arts.findDups(g,f);if(!D.length)continue;const u=D.map(p=>p.id);d.push([b,...u].sort(p=>{var x;return((x=e.arts.get(p))==null?void 0:x.location)??""?-1:1})),f=f.filter(p=>!u.includes(p))}return d},[e,a]),h=i.useMemo(()=>({}),[]);return n(Ct,{spacing:2,children:[c.map(d=>t(_,{sx:{overflowX:"scroll"},children:t(y,{sx:{display:"flex",gap:1},children:d.map(f=>t(W,{sx:{minWidth:300},children:t(ct,{artifactId:f,canEquip:!0,onDelete:()=>e.arts.remove(f),editorProps:h})},f))})},d.join())),!c.length&&t(Dt,{variant:"filled",severity:"success",children:r`noDupAlert`})]})}const oe=[..._t];function le({probabilityFilter:r={},setProbabilityFilter:e,disabled:a=!1}){const{t:o}=I("artifact");return n(_,{children:[t(y,{sx:{py:1},children:t(v,{variant:"h6",children:"Roll Probability Calculator"})}),t($,{}),t(y,{children:n(s,{container:!0,spacing:1,children:[t(s,{item:!0,xs:12,md:6,children:t(at,{children:t(y,{children:n(v,{children:['This UI only pops up when "Sort by"',t("strong",{children:"Probability"}),". In conjunction with the Artifact Filters above, this UI allows you to set a criteria for substats values, and it will sort the artifacts by those with the highest probability to roll into those criteria values.",n(Vt,{color:"warning",children:[" ","Artifacts that already reach the criteria(100%) or are at 0% are hidden."]})]})})})}),t(s,{item:!0,xs:12,md:6,spacing:1,sx:{display:"flex",flexDirection:"column",gap:1},children:t(qt,{statKeys:oe,statFilters:r,setStatFilters:e,disabled:a,label:o("probabilityFilter.label")})})]})})]})}const ce=ot.lazy(()=>V(()=>import("./ArtifactEditor-6facbb9b.js"),["./ArtifactEditor-6facbb9b.js","./index-a526b209.js","./index-cae87115.css","./ArtifactRarityDropdown-99c3742c.js","./index-c070a4ae.js","./index-133485b7.js","./ColoredText-3b59b665.js","./SqBadge-49f3a99e.js","./LocationAutocomplete-9b1b9759.js","./StarDisplay-28e8f69e.js","./DropdownButton-d41cf2a2.js","./ArtifactStatKeyDisplay-cf17d201.js","./Artifact-12786f38.js","./BootstrapTooltip-ea97cd4b.js","./LockOpen-755946c6.js","./SlotIcon-d187952b.js","./CloseButton-cfc175df.js","./ArtifactSort-9154f88e.js","./InfoTooltip-c1f7f871.js","./CardActionArea-d886c601.js","./TextButton-f18ad906.js","./CardHeader-8177e913.js","./ChevronRight-fdb7ba3b.js"],import.meta.url)),ue=ot.lazy(()=>V(()=>import("./index-cb1546db.js"),["./index-cb1546db.js","./index-a526b209.js","./index-cae87115.css","./Settings-aa819498.js","./StarDisplay-28e8f69e.js","./DropdownButton-d41cf2a2.js","./ColoredText-3b59b665.js","./index-133485b7.js","./SqBadge-49f3a99e.js","./ImgFullwidth-8220f988.js","./ArtifactSort-9154f88e.js","./LocationAutocomplete-9b1b9759.js","./BootstrapTooltip-ea97cd4b.js","./SlotIcon-d187952b.js","./InfoTooltip-c1f7f871.js","./index-c070a4ae.js","./Artifact-12786f38.js","./CardActionArea-d886c601.js","./Link-6074cdd2.js"],import.meta.url)),tt={xs:1,sm:2,md:3,lg:3,xl:4},K={xs:5,sm:6,md:12,lg:12,xl:12};function Te(){const{t:r}=I(["artifact","ui"]),e=O(),a=ut(),[o,c,h]=L(!1),[d,f,b]=L(!1),g=Et(),{sortType:D,effFilter:u,ascending:p,probabilityFilter:x}=a,k=D==="probability",[j,A]=st(),C=i.useDeferredValue(j),E=i.useMemo(()=>new Set(u),[u]),ht=i.useCallback(l=>e.arts.remove(l),[e]);i.useEffect(()=>(It.send({hitType:"pageview",page:"/artifact"}),e.arts.followAny(()=>A())),[e,A]);const[pt,mt]=i.useState(),yt=Gt(pt),bt=i.useCallback(l=>e.displayArtifact.set({probabilityFilter:l}),[e]),gt=i.useMemo(()=>!e.arts.values.length,[e]),N=i.useMemo(()=>Rt(E,x),[E,x]),H=i.useMemo(()=>$t(E),[E]),Q=i.useDeferredValue(a),X=i.useDeferredValue(x);i.useEffect(()=>{if(k)return e.arts.values.forEach(l=>e.arts.setProbability(l.id,Ot(l,X))),()=>e.arts.values.forEach(l=>e.arts.setProbability(l.id,-1))},[e,k,X]);const[q,J]=i.useState(K[g]),{artifactIds:m,totalArtNum:T}=i.useMemo(()=>{const{sortType:l=Z[0],ascending:vt=!1,filterOption:kt}=Q;let F=e.arts.values;return k&&(F=F.filter(M=>M.probability&&M.probability!==1)),{artifactIds:F.filter(Ft(kt,H)).sort(Mt(jt[l]??[],vt,N)).map(M=>M.id),totalArtNum:F.length,...C}},[Q,C,e,N,H,k]);i.useEffect(()=>{m&&J(K[g])},[m,g]);const Y=yt&&q<m.length;i.useEffect(()=>{Y&&J(l=>l+K[g])},[Y,g]);const U=i.useMemo(()=>m.slice(0,q),[m,q]),xt=m.length!==T?`${m.length}/${T}`:`${T}`,At={numShowing:U.length,total:xt,t:r,namespace:"artifact"},wt={sortKeys:[...Z],value:D,onChange:l=>e.displayArtifact.set({sortType:l}),ascending:p,onChangeAsc:l=>e.displayArtifact.set({ascending:l})};return n(W,{display:"flex",flexDirection:"column",gap:1,my:1,children:[t(i.Suspense,{fallback:!1,children:t(ce,{artifactIdToEdit:o?"new":"",cancelEdit:h,allowUpload:!0,allowEmpty:!0})}),t(i.Suspense,{fallback:!1,children:t(ae,{show:d,onHide:b})}),t(Nt,{pageKey:"artifactPage",modalTitle:r`info.title`,text:r("tipsOfTheDay",{returnObjects:!0}),children:t(ue,{})}),gt&&t(Ut,{}),t(ie,{numShowing:m.length,total:T,artifactIds:m}),t(_,{children:n(y,{children:[t(W,{pb:2,display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",children:t(Tt,{showingTextProps:At,displaySort:!0,sortByButtonProps:wt})}),t(ne,{artifactIds:m})]})}),k&&t(le,{probabilityFilter:x,setProbabilityFilter:bt}),n(s,{container:!0,columns:tt,spacing:1,children:[t(s,{item:!0,xs:!0,children:t(w,{fullWidth:!0,onClick:c,color:"info",startIcon:t(Pt,{}),children:r`addNew`})}),t(s,{item:!0,xs:1,children:t(w,{fullWidth:!0,onClick:f,color:"info",startIcon:t(lt,{}),children:r`showDup`})})]}),n(i.Suspense,{fallback:t(P,{variant:"rectangular",sx:{width:"100%",height:"100%",minHeight:5e3}}),children:[t(s,{container:!0,spacing:1,columns:tt,children:U.map(l=>t(s,{item:!0,xs:1,children:t(ct,{artifactId:l,effFilter:E,onDelete:ht,editorProps:{},canEquip:!0})},l))}),m.length!==U.length&&t(P,{ref:l=>{l&&mt(l)},sx:{borderRadius:1},variant:"rectangular",width:"100%",height:100})]})]})}export{Te as default};
