import{a as W,z as F,r,c9 as Y,cl as ee,y as ae,aZ as te,aA as re,ar as se,aa as ne,aD as ce,aE as oe,b3 as C,aF as le,d as w,b as t,N as ie,G as o,b6 as he,cm as ue,cn as pe,bh as de,f as M,aJ as ge,h as ye,aG as me,_ as fe,S as D,co as Ce,cp as N,cq as we,cr as xe,H as Te,F as Se,g as be,E as ke,bO as ve,cs as Ee,ct as Ke}from"./index-CdwkUo38.js";import{C as Me}from"./CharacterEditor-U4E_Ij1z.js";import"./TeamCard-eLgiU1k-.js";import"./consts-BQe5fBME.js";import"./Settings-CQHCKDLL.js";function De(){const a=W(),l=F();return r.useCallback(u=>{a.chars.get(u)||a.chars.getWithInitWeapon(u),l(`/characters/${u}`)},[l,a])}const We={xs:1,sm:2,md:3,lg:4,xl:4},Fe={xs:5,sm:8,md:9,lg:12,xl:12},Ne=Object.keys(N);function ze(){const a=W(),l=F(),{params:{characterKey:i}}=Y({path:"/characters/:characterKey",end:!1})??{params:{}},u=r.useMemo(()=>i?ee(i)?(a.chars.get(i)||a.chars.getWithInitWeapon(i),i):(l("/characters"),null):null,[i,l,a]),{t:p}=ae(["page_character","sillyWisher_charNames","charNames_gen"]),{silly:y}=r.useContext(te),[x,T]=r.useState(()=>a.displayCharacter.get());r.useEffect(()=>a.displayCharacter.follow((e,n)=>T(n)),[a,T]);const[S,j]=r.useState(""),b=r.useDeferredValue(S),_=re(),[A,k]=r.useState(!1),[I,d]=se();r.useEffect(()=>(ne.send({hitType:"pageview",page:"/characters"}),a.chars.followAny((e,n)=>(n==="new"||n==="remove")&&d())),[d,a]),r.useEffect(()=>a.charMeta.followAny(e=>d()),[d,a]);const O=De(),v=r.useDeferredValue(x),E=r.useDeferredValue(I),{charKeys:s,totalCharNum:m}=r.useMemo(()=>{const n=a.chars.keys.length,{element:h,weaponType:c,rarity:g,sortType:Z,ascending:L}=v,X=a.chars.keys.filter(ce({element:h,weaponType:c,rarity:g,name:b},we(a,y))).sort(oe(N[Z]??[],L,xe(a,y),["new","favorite"]));return E&&{charKeys:X,totalCharNum:n}},[a,v,b,y,E]),{weaponType:z,element:G,rarity:P,sortType:R,ascending:$}=x,B=r.useMemo(()=>C(Se,e=>Object.entries(a.chars.data).forEach(([n,h])=>{const c=a.weapons.get(h.equippedWeapon);if(!c)return;const g=Te(c.key).weaponType;e[g].total++,s.includes(n)&&e[g].current++})),[a,s]),H=r.useMemo(()=>C(ke,e=>Object.entries(a.chars.data).forEach(([n,h])=>{const c=be(h.key);e[c].total++,s.includes(n)&&e[c].current++})),[a,s]),U=r.useMemo(()=>C(Ee,e=>Object.entries(a.chars.data).forEach(([n,h])=>{const c=ve(h.key).rarity;e[c].total++,s.includes(n)&&e[c].current++})),[a,s]),{numShow:K,setTriggerElement:V}=le(Fe[_],s.length),f=r.useMemo(()=>s.slice(0,K),[s,K]),q=s.length!==m?`${s.length}/${m}`:`${m}`,J={numShowing:f.length,total:q,t:p,namespace:"page_character"},Q={sortKeys:[...Ne],value:R,onChange:e=>a.displayCharacter.set({sortType:e}),ascending:$,onChangeAsc:e=>a.displayCharacter.set({ascending:e})};return w(M,{display:"flex",flexDirection:"column",gap:1,children:[u&&t(Me,{characterKey:u,onClose:()=>l("/characters")}),t(r.Suspense,{fallback:!1,children:t(Ke,{newFirst:!0,show:A,onHide:()=>k(!1),onSelect:O})}),t(ye,{children:w(ie,{sx:{display:"flex",flexDirection:"column",gap:1},children:[w(o,{container:!0,spacing:1,children:[t(o,{item:!0,children:t(he,{sx:{height:"100%"},onChange:e=>a.displayCharacter.set({weaponType:e}),value:z,totals:B,size:"small"})}),t(o,{item:!0,children:t(ue,{sx:{height:"100%"},onChange:e=>a.displayCharacter.set({element:e}),value:G,totals:H,size:"small"})}),t(o,{item:!0,children:t(pe,{sx:{height:"100%"},onChange:e=>a.displayCharacter.set({rarity:e}),value:P,totals:U,size:"small"})}),t(o,{item:!0,flexGrow:1}),t(o,{item:!0,children:t(de,{autoFocus:!0,value:S,onChange:e=>j(e.target.value),label:p("characterName"),size:"small",sx:{height:"100%"},InputProps:{sx:{height:"100%"}}})})]}),t(M,{display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",children:t(ge,{showingTextProps:J,sortByButtonProps:Q})})]})}),t(fe,{fullWidth:!0,onClick:()=>k(!0),color:"info",startIcon:t(me,{}),children:p`addNew`}),t(r.Suspense,{fallback:t(D,{variant:"rectangular",sx:{width:"100%",height:"100%",minHeight:5e3}}),children:t(o,{container:!0,spacing:1,columns:We,children:f.map(e=>t(o,{item:!0,xs:1,children:t(Ce,{characterKey:e,onClick:()=>l(`${e}`),hideStats:!0})},e))})}),s.length!==f.length&&t(D,{ref:e=>{e&&V(e)},sx:{borderRadius:1},variant:"rectangular",width:"100%",height:100})]})}export{ze as default};
