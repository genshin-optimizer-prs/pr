import{u as q,e as o,a9 as A,b as N,d as j,Y as J,dP as M,h as Y,f as Q,p as e,n as i,C as E,K as r,D as R,J as F,t as X,W as Z,at as H,v as ee,dO as te,U as ae,aA as se,T as x,c4 as oe,s as ne}from"./index-078f93a6.js";import{f as re,s as ie,T as le,k as ce,F as de,c as pe}from"./StarDisplay-3359d7a4.js";import{g as b,V as me}from"./index-230ec75b.js";import{c as G,E as he,o as ue,k as fe,a as xe,l as ye,p as ge,b as Ce,e as ve}from"./CharacterSort-c2af0a30.js";import{C as Te}from"./CloseButton-57b338ee.js";import{S as I}from"./SqBadge-51815102.js";import{W as we}from"./WeaponUtil-56d4733b.js";import{D as be}from"./FieldDisplay-802ebe8f.js";import{c as z}from"./totalUtils-09c2317e.js";import{C as De}from"./CardActionArea-52d9111c.js";import"./DropdownButton-8f98ee5b.js";import"./ColoredText-cbe1a83d.js";import"./index-f7fb7351.js";import"./index-9628ca20.js";import"./Artifact-df05b0e0.js";import"./Help-a0275779.js";import"./SlotIcon-fdaccc71.js";import"./Groups-e98d327e.js";const Se=Object.keys(G);function qe({show:n,onHide:c,onSelect:d,filter:s=()=>!0,newFirst:m=!1}){const{t:y}=q(["page_character","sillyWisher_charNames","charNames_gen"]),{silly:h}=o.useContext(A),a=N(),[g,C]=o.useState(()=>a.displayCharacter.get());o.useEffect(()=>a.displayCharacter.follow((t,l)=>C(l)),[a,C]);const{gender:u}=j(),[D,v]=J();o.useEffect(()=>a.charMeta.followAny(()=>v()),[v,a]);const[T,w]=o.useState(""),S=o.useDeferredValue(T),k=o.useDeferredValue(g),B=o.useDeferredValue(D),f=o.useMemo(()=>{const{element:t,weaponType:l,sortType:p,ascending:$}=k,K=[...m?["new"]:[],...G[p]??[]];return B&&M.filter(W=>s(a.chars.get(W),b(W,u))).filter(re({element:t,weaponType:l,name:S},Ce(a,h))).sort(ie(K,$,ve(a,h),["new","favorite"]))},[k,m,B,S,a,h,s,u]),L=o.useMemo(()=>z(Y,t=>M.forEach(l=>{const p=b(l,a.gender).weaponTypeKey;t[p].total++,f.includes(l)&&t[p].current++})),[f,a]),P=o.useMemo(()=>z(Q,t=>M.forEach(l=>{const p=b(l,a.gender).elementKey;t[p].total++,f.includes(l)&&t[p].current++})),[f,a]),{weaponType:V,element:_,sortType:O,ascending:U}=g;return e(Z,{open:n,onClose:c,sx:{"& .MuiContainer-root":{justifyContent:"normal"}},children:i(X,{children:[i(E,{sx:{py:1,display:"flex",alignItems:"center",gap:1,flexWrap:"wrap"},children:[e(we,{sx:{height:"100%"},onChange:t=>a.displayCharacter.set({weaponType:t}),value:V,totals:L,size:"small"}),e(he,{sx:{height:"100%"},onChange:t=>a.displayCharacter.set({element:t}),value:_,totals:P,size:"small"}),e(r,{flexGrow:1,children:e(le,{autoFocus:!0,value:T,onChange:t=>w(t.target.value),label:y("characterName"),size:"small",sx:{height:"100%"},InputProps:{sx:{height:"100%"}}})}),e(ce,{sx:{height:"100%"},sortKeys:Se,value:O,onChange:t=>a.displayCharacter.set({sortType:t}),ascending:U,onChangeAsc:t=>a.displayCharacter.set({ascending:t})}),e(Te,{onClick:c})]}),e(R,{}),e(be.Provider,{value:{teamData:void 0},children:e(E,{children:e(F,{container:!0,spacing:1,columns:{xs:2,sm:3,md:4,lg:5},children:f.map(t=>e(F,{item:!0,xs:1,children:e(ke,{characterKey:t,onClick:()=>{c(),d==null||d(t)}})},t))})})})]})})}const Me=H(({className:n,...c})=>e(ee,{...c,classes:{popper:n}}))({[`& .${te.tooltip}`]:{padding:0}});function ke({characterKey:n,onClick:c}){const{gender:d}=j(),s=b(n,d),m=ue(n),{favorite:y}=fe(n),h=N(),{silly:a}=o.useContext(A),[g,C,u]=ae(),{level:D=1,ascension:v=0,constellation:T=0}=m??{},w=me(n,"banner",d);return e(Me,{enterDelay:300,enterNextDelay:300,arrow:!0,placement:"bottom",open:g,onClose:u,onOpen:C,title:e(r,{sx:{width:300},children:e(xe,{hideStats:!0,characterKey:n})}),children:e(r,{children:i(ne,{sx:{flexGrow:1,display:"flex",flexDirection:"column"},children:[e(r,{sx:{position:"absolute",opacity:.7,zIndex:2},children:e(se,{sx:{p:.25},onClick:S=>{u(),h.charMeta.set(n,{favorite:!y})},children:y?e(de,{}):e(ye,{})})}),e(De,{onClick:c,children:i(r,{display:"flex",position:"relative",className:w?void 0:`grad-${s==null?void 0:s.rarity}star`,sx:{"&::before":{content:'""',display:"block",position:"absolute",left:0,top:0,width:"100%",height:"100%",opacity:.7,backgroundImage:`url(${w})`,backgroundPosition:"center",backgroundSize:"cover"}},width:"100%",children:[e(r,{flexShrink:1,sx:{maxWidth:{xs:"33%",lg:"30%"}},alignSelf:"flex-end",display:"flex",flexDirection:"column",zIndex:1,children:e(r,{component:"img",src:ge(n,d,a),width:"100%",height:"auto",maxWidth:256,sx:{mt:"auto"}})}),i(r,{flexGrow:1,sx:{pr:1,pt:1},display:"flex",flexDirection:"column",zIndex:1,justifyContent:"space-evenly",children:[e(x,{variant:"body2",sx:{flexGrow:1},children:e(I,{color:s==null?void 0:s.elementKey,sx:{opacity:.85,textShadow:"0 0 5px gray"},children:s==null?void 0:s.name})}),m?i(r,{sx:{display:"flex",gap:1,alignItems:"center"},children:[i(r,{sx:{textShadow:"0 0 5px gray"},children:[i(x,{variant:"body2",component:"span",whiteSpace:"nowrap",children:["Lv. ",D]}),i(x,{variant:"body2",component:"span",color:"text.secondary",children:["/",oe[v]]})]}),i(x,{variant:"body2",children:["C",T]})]}):e(x,{component:"span",variant:"body2",children:e(I,{children:"NEW"})}),e(pe,{stars:(s==null?void 0:s.rarity)??1,colored:!0})]})]})})]})})})}export{qe as default};
