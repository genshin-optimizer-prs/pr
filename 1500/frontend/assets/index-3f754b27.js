import{u as pe,e as s,a9 as de,b as ue,Y as me,M as fe,d as ge,ao as ye,aD as Ce,n as h,p as e,C as B,J as i,K as x,t as K,B as R,V as xe,al as we,D as z,T as u,aA as m,R as Te,_ as Se,a0 as be,h as ke,f as ve,aE as De}from"./index-9cb39364.js";import{u as Pe,f as _e,s as Ee,T as Me,P as A}from"./StarDisplay-4e568075.js";import{u as Ie,E as Fe,C as Ne,d as G,a as We,F as je,T as $e,S as Be,D as Ke,c as L,b as Re,e as ze}from"./CharacterSort-0a3b196b.js";import{B as f}from"./Help-5e0d91b8.js";import{W as Ae}from"./WeaponUtil-2a009db6.js";import{g as k}from"./index-97f4e8b9.js";import{g as Ge}from"./index-df0072ad.js";import{c as v}from"./totalUtils-cd5c25de.js";import{G as Le}from"./Groups-0cdf021a.js";import"./DropdownButton-ec24c7a0.js";import"./ColoredText-aa84ea1b.js";import"./FieldDisplay-ef45fcb2.js";import"./SqBadge-27e03487.js";import"./index-27b82561.js";import"./Artifact-31bf8e6b.js";import"./SlotIcon-c6bb8994.js";import"./CardActionArea-70ae795a.js";const Oe=Te.lazy(()=>Se(()=>import("./CharacterSelectionModal-b1d07647.js"),["assets/CharacterSelectionModal-b1d07647.js","assets/index-9cb39364.js","assets/index-829a9ccb.css","assets/StarDisplay-4e568075.js","assets/DropdownButton-ec24c7a0.js","assets/ColoredText-aa84ea1b.js","assets/index-97f4e8b9.js","assets/SqBadge-27e03487.js","assets/CharacterSort-0a3b196b.js","assets/FieldDisplay-ef45fcb2.js","assets/Help-5e0d91b8.js","assets/Groups-0cdf021a.js","assets/index-27b82561.js","assets/index-df0072ad.js","assets/WeaponUtil-2a009db6.js","assets/Artifact-31bf8e6b.js","assets/SlotIcon-c6bb8994.js","assets/CardActionArea-70ae795a.js","assets/CloseButton-264c8b36.js","assets/totalUtils-cd5c25de.js"])),Ve={xs:1,sm:2,md:3,lg:4,xl:4},Ue={xs:6,sm:8,md:12,lg:16,xl:16},He=Object.keys(L);function pt(){const{t:n}=pe(["page_character","sillyWisher_charNames","charNames_gen"]),{silly:p}=s.useContext(de),a=ue(),[D,P]=s.useState(()=>a.displayCharacter.get());s.useEffect(()=>a.displayCharacter.follow((t,r)=>P(r)),[a,P]);const[_,O]=s.useState(""),E=s.useDeferredValue(_),w=s.useRef(null),V=s.useCallback((t,r)=>{var l;(l=w.current)==null||l.scrollIntoView({behavior:"smooth"}),a.displayCharacter.set({pageIndex:r-1})},[a,w]),U=Pe(),g=Ue[U],[H,T]=s.useState(!1),[q,y]=me();s.useEffect(()=>(fe.send({hitType:"pageview",page:"/characters"}),a.chars.followAny((t,r)=>(r==="new"||r==="remove")&&y())),[y,a]),s.useEffect(()=>a.charMeta.followAny(t=>y()),[y,a]);const{gender:S}=ge(),J=s.useCallback(async t=>{let r=k(t,S).name;typeof r=="object"&&(r=n(`${p?"sillyWisher_charNames":"charNames_gen"}:${ye(t,S)}`)),window.confirm(n("removeCharacter",{value:r}))&&a.chars.remove(t)},[a.chars,S,p,n]),Q=Ie(),d=Ce(),M=s.useDeferredValue(D),I=s.useDeferredValue(q),{charKeyList:o,totalCharNum:b}=s.useMemo(()=>{const r=a.chars.keys.length,{element:l,weaponType:c,rarity:C,sortType:ce,ascending:ie}=M,he=a.chars.keys.filter(_e({element:l,weaponType:c,rarity:C,name:E},Re(a,p))).sort(Ee(L[ce]??[],ie,ze(a,p),["new","favorite"]));return I&&{charKeyList:he,totalCharNum:r}},[a,M,E,p,I]),{weaponType:Y,element:X,rarity:Z,sortType:ee,ascending:te,pageIndex:F=0}=D,{charKeyListToShow:N,numPages:W,currentPageIndex:ae}=s.useMemo(()=>{const t=Math.ceil(o.length/g),r=be(F,0,t-1);return{charKeyListToShow:o.slice(r*g,(r+1)*g),numPages:t,currentPageIndex:r}},[o,F,g]),re=o.length!==b?`${o.length}/${b}`:`${b}`,se=s.useMemo(()=>v(ke,t=>Object.entries(a.chars.data).forEach(([r,l])=>{const c=a.weapons.get(l.equippedWeapon);if(!c)return;const C=Ge(c.key).weaponType;t[C].total++,o.includes(r)&&t[C].current++})),[a,o]),ne=s.useMemo(()=>v(ve,t=>Object.entries(a.chars.data).forEach(([r,l])=>{const c=k(l.key,a.gender).elementKey;t[c].total++,o.includes(r)&&t[c].current++})),[a,o]),oe=s.useMemo(()=>v(De,t=>Object.entries(a.chars.data).forEach(([r,l])=>{const c=k(l.key,a.gender).rarity;t[c].total++,o.includes(r)&&t[c].current++})),[a,o]),j={count:W,page:ae+1,onChange:V},$={numShowing:N.length,total:re,t:n,namespace:"page_character"},le={sortKeys:[...He],value:ee,onChange:t=>a.displayCharacter.set({sortType:t}),ascending:te,onChangeAsc:t=>a.displayCharacter.set({ascending:t})};return h(x,{my:1,display:"flex",flexDirection:"column",gap:1,children:[e(s.Suspense,{fallback:!1,children:e(Oe,{newFirst:!0,show:H,onHide:()=>T(!1),onSelect:Q})}),e(K,{ref:w,children:h(B,{sx:{display:"flex",flexDirection:"column",gap:1},children:[h(i,{container:!0,spacing:1,children:[e(i,{item:!0,children:e(Ae,{sx:{height:"100%"},onChange:t=>a.displayCharacter.set({weaponType:t}),value:Y,totals:se,size:"small"})}),e(i,{item:!0,children:e(Fe,{sx:{height:"100%"},onChange:t=>a.displayCharacter.set({element:t}),value:X,totals:ne,size:"small"})}),e(i,{item:!0,children:e(Ne,{sx:{height:"100%"},onChange:t=>a.displayCharacter.set({rarity:t}),value:Z,totals:oe,size:"small"})}),e(i,{item:!0,flexGrow:1}),e(i,{item:!0,children:e(Me,{autoFocus:!0,value:_,onChange:t=>O(t.target.value),label:n("characterName"),size:"small",sx:{height:"100%"},InputProps:{sx:{height:"100%"}}})})]}),e(x,{display:"flex",justifyContent:"space-between",alignItems:"flex-end",flexWrap:"wrap",children:e(A,{paginationProps:j,showingTextProps:$,displaySort:!0,sortByButtonProps:le})})]})}),e(R,{fullWidth:!0,onClick:()=>T(!0),color:"info",startIcon:e(G,{}),children:n`addNew`}),e(s.Suspense,{fallback:e(xe,{variant:"rectangular",sx:{width:"100%",height:"100%",minHeight:5e3}}),children:e(i,{container:!0,spacing:1,columns:Ve,children:N.map(t=>e(i,{item:!0,xs:1,children:e(We,{characterKey:t,onClick:()=>d(`${t}`),footer:h(we,{children:[e(z,{}),h(x,{sx:{py:1,px:2,display:"flex",gap:1,justifyContent:"space-between"},children:[e(f,{placement:"top",title:e(u,{children:n("tabs.talent")}),children:e(m,{onClick:()=>d(`${t}/talent`),children:e(je,{})})}),e(f,{placement:"top",title:e(u,{children:n("tabs.teambuffs")}),children:e(m,{onClick:()=>d(`${t}/teambuffs`),children:e(Le,{})})}),e(f,{placement:"top",title:e(u,{children:n("tabs.optimize")}),children:e(m,{onClick:()=>d(`${t}/optimize`),children:e($e,{})})}),e(f,{placement:"top",title:e(u,{children:n("tabs.theorycraft")}),children:e(m,{onClick:()=>d(`${t}/theorycraft`),children:e(Be,{})})}),e(z,{orientation:"vertical"}),e(f,{placement:"top",title:e(u,{children:n("delete")}),children:e(m,{color:"error",onClick:()=>J(t),children:e(Ke,{})})})]})]})})},t))})}),W>1&&e(K,{children:h(B,{sx:{display:"flex",flexDirection:"row",gap:1},children:[e(R,{onClick:()=>T(!0),color:"info",sx:{minWidth:0},children:e(G,{})}),e(x,{display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",flexGrow:1,children:e(A,{paginationProps:j,showingTextProps:$})})]})})]})}export{pt as default};
