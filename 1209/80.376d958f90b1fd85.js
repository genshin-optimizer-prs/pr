"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[80],{73826:(e,t,a)=>{a.r(t),a.d(t,{default:()=>_c});var n=a(31981),i=a(95178),l=a(96e3),r=a(85439),s=a(36380),c=a(61391),o=a(60319),d=a(68826),u=a(32782),h=a(67550),Z=a(79906),p=a(7671),m=a(38484),f=a(78287),g=a(83249),x=a(2784),v=a(21560),y=a(73557),b=a(39857),C=a(24264),w=a(87833),B=a(23690),S=a(14084),k=a(86512),X=a(12366),_=a(13230),K=a(99487),j=a(48650);const E=(0,x.createContext)({});var O=a(23657),P=a(92064),T=a(34156),M=a(56302),A=a(76260),D=a(55893),I=a(22134),L=a(6982),R=a(68220),N=a(80680),G=a(2180),z=a(52903);const W=x.lazy((()=>a.e(592).then(a.bind(a,37629))));function $(){var e;const{t}=(0,v.$G)("page_character"),{characterSheet:a,character:{key:n}}=(0,x.useContext)(_.K),[i,l]=(0,x.useState)(!1),r=(0,G.Z)();return(0,z.BX)(z.HY,{children:[(0,z.tZ)(x.Suspense,{fallback:!1,children:(0,z.tZ)(W,{show:i,onHide:()=>l(!1),onSelect:r})}),(0,z.tZ)(g.Z,{color:"info",onClick:()=>l(!0),startIcon:(0,z.tZ)(N.Z,{characterKey:n}),children:null!=(e=null==a?void 0:a.name)?e:t("selectCharacter")})]})}var V=a(84485),F=a(42523),q=a(56961),H=a(23570),U=a(2995),Y=a(62197),J=a(35322),Q=a(34048),ee=a(4453),te=a(86569),ae=a(79410),ne=a(69698),ie=a(75636),le=a(15030);function re(){const{modalOpen:e}=(0,x.useContext)(j.M),{setFormulaData:t}=(0,x.useContext)(j.M),a=(0,x.useCallback)((()=>null==t?void 0:t(void 0,void 0)),[t]);return(0,z.tZ)(ne.Z,{open:!!e,onClose:a,children:(0,z.BX)(C.Z,{children:[(0,z.tZ)(F.Z,{title:"Formulas & Calculations",action:(0,z.tZ)(B.Z,{onClick:a})}),(0,z.tZ)(p.Z,{sx:{pt:0},children:(0,z.tZ)(se,{})})]})})}function se(){const{data:e}=(0,x.useContext)(K.R),{data:t}=(0,x.useContext)(j.M),a=(0,ie.U)(null!=t?t:e);return(0,z.tZ)(x.Suspense,{fallback:(0,z.tZ)(Z.Z,{variant:"rectangular",width:"100%",height:1e3}),children:(0,z.tZ)(h.Z,{sx:{mr:-1,mb:-1},children:a.map((([e,t])=>(0,z.tZ)(ce,{displayNs:t,sectionKey:e},e)))})})}function ce({sectionKey:e,displayNs:t}){const{data:a}=(0,x.useContext)(K.R),{database:n}=(0,x.useContext)(T.t),{data:i}=(0,x.useContext)(j.M),l=(0,x.useMemo)((()=>(0,ie.f)(null!=i?i:a,e,n)),[n,i,a,e]);if(!l)return null;if(Object.entries(t).every((([e,t])=>t.isEmpty)))return null;const{title:r,icon:s,action:c}=l;return(0,z.BX)(w.Z,{sx:{mb:1},children:[(0,z.tZ)(ee.Z,{avatar:s&&(0,z.tZ)(ae.Z,{size:2,src:s}),title:r,action:c&&(0,z.tZ)(X.Z,{children:c})}),(0,z.tZ)(q.Z,{}),(0,z.tZ)(p.Z,{children:Object.entries(t).map((([e,t])=>!t.isEmpty&&(0,z.tZ)(oe,{node:t},e)))})]})}function oe({node:e}){const{node:t}=(0,x.useContext)(j.M),[a,i]=(0,x.useState)(!1),l=(0,x.useCallback)(((e,t)=>i(t)),[]),r=(0,x.useRef)();return(0,x.useEffect)((()=>{e===t&&setTimeout((()=>{var e;return null==r||null==(e=r.current)||null==e.scrollIntoView?void 0:e.scrollIntoView({behavior:"smooth"})}),300)}),[r,e,t]),(0,z.BX)(H.Z,{sx:{bgcolor:"contentDark.main"},expanded:e===t||a,onChange:l,ref:r,children:[(0,z.BX)(U.Z,{expandIcon:(0,z.tZ)(V.Z,{}),children:[(0,z.BX)(Y.Z,{children:[(0,z.tZ)(te.Z,{color:e.info.variant,children:e.info.name})," ",(0,z.tZ)("strong",{children:(0,le.p)(e)})]}),n.Mk.includes(e.info.variant)&&(0,z.tZ)(h.Z,{sx:{display:"inline-block",ml:"auto",mr:2},children:(0,z.tZ)(Q.Z,{reaction:e.info.variant,trigger:e.info.subVariant})})]}),(0,z.tZ)(J.Z,{children:e.formulas.map(((e,t)=>(0,z.tZ)(Y.Z,{component:"div",children:e},t)))})]})}var de=a(33927),ue=a(41075),he=a(107),Ze=a(15873),pe=a(17885),me=a(32510),fe=a(5658),ge=a(27216),xe=a(66198),ve=a(41033),ye=a(41319),be=a(25576),Ce=a(39099),we=a(98283),Be=a(65992),Se=a(85801);const ke=["expand"],Xe=(0,Be.ZP)((e=>{const t=(0,we.Z)(e,ke);return(0,z.tZ)(Se.Z,Object.assign({},t))}))((({theme:e,expand:t})=>({transform:t?"rotate(180deg)":"rotate(0deg)",marginLeft:"auto",transition:e.transitions.create("transform",{duration:e.transitions.duration.shortest})})));var _e=a(38553),Ke=a(89977),je=a(13900);const Ee=["name","children","value","placeholder","defaultValue","onValueChange","percent","disabled","onReset"],Oe=(0,Be.ZP)(_e.Z)({display:"flex"});function Pe(e){let{name:t,children:a,value:n,placeholder:i,defaultValue:l=0,onValueChange:r,percent:s=!1,disabled:c=!1,onReset:o}=e,d=(0,we.Z)(e,Ee);return(0,z.BX)(Oe,Object.assign({},d,{children:[a,(0,z.tZ)(je.Z,{sx:{px:1},children:t}),(0,z.tZ)(Ke.CC,{sx:{flexBasis:"10em",flexGrow:1},children:(0,z.tZ)(Ke.ZP,{sx:{px:1},inputProps:{sx:{textAlign:"right"}},float:s,placeholder:i,value:n,onChange:r,disabled:c,endAdornment:s?"%":void 0})}),(0,z.tZ)(g.Z,{sx:{flexShrink:2},size:"small",color:"error",onClick:()=>o?o():r(l),disabled:c||n===l,children:(0,z.tZ)(me.Z,{})})]}))}let Te,Me=e=>e;function Ae(){const{t:e}=(0,v.$G)("ui"),{characterDispatch:t}=(0,x.useContext)(_.K),{data:a}=(0,x.useContext)(K.R),[i,l]=(0,x.useState)(!1),r=(0,x.useCallback)((()=>l(!i)),[l,i]),s=a.get(ye.ri.enemy.level),c=a.get(ye.ri.enemy.defRed),o=a.get(ye.ri.enemy.defIgn),d=(0,x.useCallback)((()=>t({enemyOverride:{}})),[t]);return(0,z.BX)(w.Z,{children:[(0,z.BX)(p.Z,{sx:{display:"flex",gap:1,alignItems:"center",flexWrap:"wrap"},children:[(0,z.tZ)(xe.Z,{size:"small",color:"success",label:(0,z.BX)("span",{children:[s.info.name," ",(0,z.tZ)("strong",{children:s.value})]})}),n.fR.map((e=>(0,z.tZ)(Y.Z,{children:(0,z.tZ)(De,{element:e})},e))),(0,z.BX)(Y.Z,{children:["DEF Red. ",(0,le.p)(c)]}),(0,z.BX)(Y.Z,{children:["DEF Ignore ",(0,le.p)(o)]}),(0,z.BX)(h.Z,{flexGrow:1,display:"flex",justifyContent:"flex-end",gap:1,children:[(0,z.tZ)(g.Z,{size:"small",color:"error",onClick:d,startIcon:(0,z.tZ)(me.Z,{}),children:e(Te||(Te=Me`reset`))}),(0,z.tZ)(Xe,{expand:i,onClick:r,"aria-expanded":i,"aria-label":"show more",size:"small",sx:{marginLeft:0},children:(0,z.tZ)(V.Z,{})})]})]}),(0,z.tZ)(ve.Z,{in:i,timeout:"auto",unmountOnExit:!0,children:(0,z.tZ)(p.Z,{sx:{pt:0},children:(0,z.tZ)(Ie,{})})})]})}function De({element:e}){const{data:t}=(0,x.useContext)(K.R),a=t.get(ye.ri.enemy[`${e}_res_`]),n=!isFinite(a.value),i=(0,z.tZ)(Ce.Z,{ele:e,iconProps:pe.mX}),l=n?(0,z.BX)("span",{children:[i," ∞"]}):(0,z.BX)("span",{children:[i," ",(0,z.tZ)("strong",{children:(0,le.p)(a)})]});return(0,z.tZ)(te.Z,{color:e,children:l})}function Ie({bsProps:e={xs:12,md:6}}){var t,a,i;const{character:{enemyOverride:l},characterDispatch:r}=(0,x.useContext)(_.K),{data:s}=(0,x.useContext)(K.R),c=null!=(t=l.enemyLevel)?t:s.get(ye.ri.lvl).value,o=null!=(a=l.enemyDefIgn_)?a:0,d=null!=(i=l.enemyDefRed_)?i:0;return(0,z.BX)(ue.ZP,{container:!0,spacing:1,children:[(0,z.tZ)(ue.ZP,Object.assign({item:!0},e,{children:(0,z.tZ)(g.Z,{fullWidth:!0,sx:{height:"100%"},size:"small",component:"a",color:"warning",href:"https://genshin-impact.fandom.com/wiki/Resistance#Base_Enemy_Resistances",target:"_blank",rel:"noreferrer",children:"To get the specific resistance values of enemies, please visit the wiki."})})),(0,z.tZ)(ue.ZP,Object.assign({item:!0},e,{children:(0,z.tZ)(Pe,{sx:{bgcolor:e=>e.palette.contentLight.main,width:"100%"},name:(0,z.tZ)("b",{children:be.ZP.get("enemyLevel")}),value:c,placeholder:be.ZP.getStr("enemyLevel"),defaultValue:s.get(ye.ri.lvl).value,onValueChange:e=>r({type:"enemyOverride",statKey:"enemyLevel",value:e}),onReset:()=>r({type:"enemyOverride",statKey:"enemyLevel",value:void 0})})})),n.fR.map((t=>{const a=`${t}_enemyRes_`,n=l[a],i=n===Number.MAX_VALUE;return(0,z.tZ)(ue.ZP,Object.assign({item:!0},e,{children:(0,z.tZ)(Pe,{sx:{bgcolor:e=>e.palette.contentLight.main,width:"100%"},name:(0,z.tZ)(te.Z,{color:t,children:(0,z.tZ)("b",{children:be.ZP.get(a)})}),value:void 0!==n?i?1/0:n:10,placeholder:i?"∞ ":be.ZP.getStr(a),defaultValue:10,onValueChange:e=>r({type:"enemyOverride",statKey:a,value:e}),disabled:i,percent:!0,children:(0,z.tZ)(g.Z,{color:t,onClick:()=>r({type:"enemyOverride",statKey:a,value:i?10:Number.MAX_VALUE}),startIcon:i?(0,z.tZ)(fe.Z,{}):(0,z.tZ)(ge.Z,{}),children:"Immunity"})})}),t)})),(0,z.tZ)(ue.ZP,Object.assign({item:!0},e,{children:(0,z.tZ)(Pe,{sx:{bgcolor:e=>e.palette.contentLight.main,width:"100%"},name:(0,z.tZ)("b",{children:be.ZP.get("enemyDefIgn_")}),value:o,placeholder:be.ZP.getStr("enemyDefIgn_"),defaultValue:0,onValueChange:e=>r({type:"enemyOverride",statKey:"enemyDefIgn_",value:e}),percent:!0})})),(0,z.tZ)(ue.ZP,Object.assign({item:!0},e,{children:(0,z.tZ)(Pe,{sx:{bgcolor:e=>e.palette.contentLight.main,width:"100%"},name:(0,z.tZ)("b",{children:be.ZP.get("enemyDefRed_")}),value:d,placeholder:be.ZP.getStr("enemyDefRed_"),defaultValue:0,onValueChange:e=>r({type:"enemyOverride",statKey:"enemyDefRed_",value:e}),percent:!0})})),(0,z.tZ)(ue.ZP,{item:!0,xs:12,children:(0,z.tZ)("small",{children:"Note: Genshin Impact halves resistance shred values below 0%. For the sake of calculations enter the RAW value and GO will do the rest. (e.g. 10% - 20% = -10%)"})})]})}var Le=a(39282),Re=a(68330);let Ne,Ge=e=>e;const ze={xs:1,md:2,lg:3};function We({open:e,onClose:t}){const{t:a}=(0,v.$G)("page_character");return(0,z.tZ)(ne.Z,{open:e,onClose:t,children:(0,z.BX)(C.Z,{children:[(0,z.tZ)(F.Z,{title:a(Ne||(Ne=Ge`addStats.title`)),action:(0,z.tZ)(B.Z,{onClick:t})}),(0,z.tZ)(p.Z,{sx:{pt:0},children:(0,z.BX)(de.Z,{spacing:1,children:[(0,z.tZ)(Fe,{}),(0,z.tZ)(Ae,{}),(0,z.tZ)(et,{})]})})]})})}const $e=[...ye.lR],Ve=(e,t)=>(0,z.tZ)(ue.ZP,{item:!0,xs:1,children:e},t);function Fe(){const{t:e}=(0,v.$G)("page_character"),{character:{bonusStats:t},characterDispatch:a}=(0,x.useContext)(_.K),n=(0,x.useCallback)((e=>a({bonusStats:e})),[a]);return(0,z.tZ)(w.Z,{children:(0,z.tZ)(p.Z,{sx:{display:"flex"},children:(0,z.BX)(ue.ZP,{container:!0,columns:ze,sx:{pt:1},spacing:1,children:[(0,z.tZ)(ue.ZP,{item:!0,xs:12,children:(0,z.tZ)(he.Z,{severity:"info",variant:"filled",children:(0,z.BX)(v.cC,{i18nKey:"addStats.info",t:e,children:["You can use these fields to add buffs/debuffs not directly supported in GO, such as food buffs, abyss cards, or Superconduct. Please refer to the",(0,z.tZ)("a",{href:"https://genshin-impact.fandom.com/wiki/Genshin_Impact_Wiki",children:"Genshin Impact Wiki"}),"for specific values."]})})}),(0,z.tZ)(Re.Z,{statKeys:$e,statFilters:t,setStatFilters:n,wrapperFunc:Ve})]})})})}const qe=["eleMas","critRate_","critDMG_","enerRech_","heal_"],He=["hp","atk","def",...qe].map((e=>ye.ri.total[e])),Ue=["atk_","atk","hp_","hp","def_","def",...qe],Ye=[...be.hX,...be.Sx,"stamina","incHeal_","shield_","cdRed_"],Je=ye.lR.filter((e=>!Ue.includes(e)&&!Ye.includes(e)));function Qe({nodes:e,extra:t}){const{data:a,oldData:n}=(0,x.useContext)(K.R);return(0,z.BX)(Le.lD,{children:[e.map((e=>{var t;return(0,z.tZ)(Le.JW,{component:Ze.ZP,node:a.get(e),oldValue:null==n||null==(t=n.get(e))?void 0:t.value},JSON.stringify(e.info))})),t]})}function et(){const{characterSheet:e}=(0,x.useContext)(_.K),{data:t}=(0,x.useContext)(K.R),a=t.get(ye.ri.special),n=e.elementKey,i=e.isMelee(),l=(0,x.useMemo)((()=>Ye.filter((e=>!e.includes(n)&&(i&&e.includes("physical"),!0))).map((e=>ye.ri.total[e])).filter((e=>!!t.get(e).value))),[t,n,i]),r=(0,x.useMemo)((()=>Je.map((e=>ye.ri.total[e])).filter((e=>t.get(e).value))),[t]);return(0,z.tZ)(w.Z,{children:(0,z.tZ)(p.Z,{children:(0,z.BX)(ue.ZP,{container:!0,columns:ze,spacing:1,children:[(0,z.tZ)(ue.ZP,{item:!0,xs:1,children:(0,z.tZ)(tt,{title:"Main Stats",children:(0,z.tZ)(Qe,{nodes:He,extra:a&&(0,z.BX)(Ze.ZP,{sx:{display:"flex",justifyContent:"space-between"},children:[(0,z.BX)("span",{children:[(0,z.tZ)("b",{children:"Special:"})," ",(0,z.BX)(te.Z,{color:a.info.variant,children:[a.info.icon," ",a.info.name]})]}),(0,z.tZ)("span",{children:(0,le.p)(a)})]})})})}),(0,z.tZ)(ue.ZP,{item:!0,xs:1,children:(0,z.tZ)(tt,{title:"Other Stats",children:(0,z.tZ)(Qe,{nodes:l})})}),!!r.length&&(0,z.tZ)(ue.ZP,{item:!0,xs:1,children:(0,z.tZ)(tt,{title:"Misc Stats",children:(0,z.tZ)(Qe,{nodes:r})})})]})})})}function tt({title:e,children:t}){return(0,z.BX)(C.Z,{children:[(0,z.tZ)(p.Z,{sx:{py:1},children:(0,z.tZ)(h.Z,{display:"flex",justifyContent:"space-between",children:(0,z.tZ)(Y.Z,{variant:"subtitle1",children:e})})}),t]})}var at=a(12761),nt=a(36269),it=a(46342),lt=a(62469),rt=a(85162),st=a(94380),ct=a(92794),ot=a(51290),dt=a(45269),ut=a(11615),ht=a(23485),Zt=a(12702),pt=a(23119);function mt(){return(0,z.BX)(he.Z,{severity:"warning",variant:"filled",children:["Opps! It looks like you haven't added any artifacts to GO yet! You should go to the"," ",(0,z.tZ)(pt.Z,{component:b.rU,to:"/artifact",children:"Artifacts"})," ","page and add some!"]})}var ft=a(58489);const gt=(0,x.createContext)(void 0);var xt=a(64212),vt=a(13810),yt=a(2754),bt=a(93290);var Ct=a(64985),wt=a(6094);function Bt(e,t,a=!1){const i=new Set,l=new Set;function r(e,t){return t?i.add(e):e.operands.forEach((e=>i.has(e)&&l.add(e))),e}const s=new Set;if(e=(0,Ct.uW)(e,(e=>e),(e=>{const{operation:t}=e;switch(t){case"read":return s.add(e.path[1]),r(e,!0);case"add":{const t=e.operands.filter((e=>i.has(e))),a=e.operands.filter((e=>!i.has(e)));if(0===a.length)return r(e,!0);if(t.length<=1)return r(e,!1);const n=r((0,wt.Sm)(...t),!0);return r((0,wt.Sm)(n,...a),!1)}case"mul":{const t=e.operands.filter((e=>"const"!==e.operation));return r(e,0===t.length||1===t.length&&i.has(t[0]))}case"const":return r(e,!0);case"res":case"threshold":case"sum_frac":case"max":case"min":return r(e,!1);default:(0,at.UT)(t)}})),e.filter((e=>i.has(e))).forEach((e=>l.add(e))),[...l].every((({operation:e})=>"read"===e||"const"===e))&&Object.keys(t.base).length===s.size)return{nodes:e,arts:t};let c=-1;function o(){for(;s.has(""+ ++c););return`${c}`}const d=[...l].filter((e=>"const"!==e.operation)),u=new Map(d.map((e=>[e,a||"read"!==e.operation||"dyn"!==e.path[0]?(0,wt.Cj)(o()):e])));function h(e){const t=(0,bt.CG)([...u.keys()],{dyn:(0,at.Ay)(e,(e=>(0,wt.a9)(e)))},(e=>!0));return Object.fromEntries([...u.values()].map(((e,a)=>[e.path[1],t[a].value])))}const Z={nodes:e=(0,Ct.uW)(e,(e=>{var t;return null!=(t=u.get(e))?t:e}),(e=>e)),arts:{base:h(t.base),values:(0,at.K8)(n.Ex,(e=>t.values[e].map((({id:e,set:t,values:a})=>({id:e,set:t,values:h(a)})))))}},p=Object.entries(h({}));for(const e of Object.values(Z.arts.values))for(const{values:t}of e)for(const[e,a]of p)t[e]-=a;return Z}function St(e,t,a){var i;let l=!1;const r=!(null!=(i=a.rainbow)&&i.length),s=Object.keys(e.base),c=new Set(Object.entries(a).filter((([e,t])=>t.length)).map((([e])=>e))),o=new Set(Object.entries(a).filter((([e,t])=>t.includes(2)&&!t.includes(4))).map((([e])=>e))),d=(0,at.K8)(n.Ex,(a=>{const n=e.values[a],i=n.filter((e=>{let a=0;return n.every((n=>{const i=s.every((t=>{var a,i;return(null!=(a=n.values[t])?a:0)>=(null!=(i=e.values[t])?i:0)})),l=s.some((t=>{var a,i;return(null!=(a=n.values[t])?a:0)>(null!=(i=e.values[t])?i:0)})),d=i&&(l||n.id>e.id),u=r&&!c.has(n.set)&&!o.has(e.set)||e.set===n.set;return d&&u&&a++,a<t}))}));return i.length!==n.length&&(l=!0),i}));return l?{base:e.base,values:d}:e}function kt(e,t,a){const i=Object.fromEntries(Object.entries(t.base).map((([e,t])=>[e,{min:t,max:t}]))),l={arts:t};for(;;){const t=(0,at.K8)(n.Ex,(e=>Kt(l.arts.values[e]))),r=(0,at.K8)(n.Ex,(e=>_t(Object.entries(t).map((t=>t[0]===e?i:t[1])).filter((e=>e)))));let s=!1;const c=(0,at.K8)(n.Ex,(t=>{const n=l.arts.values[t].filter((n=>{const i=_t([Kt([n]),r[t]]),l=jt(e,i);return e.every(((e,t)=>{var n;return l.get(e).max>=(null!=(n=a[t])?n:-1/0)}))}));return n.length!==l.arts.values[t].length&&(s=!0),n}));if(!s)break;l.arts={base:l.arts.base,values:c}}return l.arts}function Xt(e,t){const a=jt(e,_t([Object.fromEntries(Object.entries(t.base).map((([e,t])=>[e,{min:t,max:t}]))),...Object.values(t.values).map((e=>Kt(e)))]));return(0,Ct.uW)(e,(e=>{{const{min:t,max:n}=a.get(e);if(t===n)return(0,wt.a9)(t)}const{operation:t}=e,n=e.operands.map((e=>a.get(e)));switch(t){case"threshold":{const[t,a,i,l]=n;if(t.min>=a.max)return e.operands[2];if(t.max<a.min)return e.operands[3];if(i.max===i.min&&l.max===l.min&&i.min===l.min&&isFinite(i.min))return(0,wt.a9)(i.max);break}case"min":{const t=e.operands.filter(((e,t)=>{const a=n[t];return n.every((e=>a.min<=e.max))}));if(t.length<n.length)return(0,wt.VV)(...t);break}case"max":{const t=e.operands.filter(((e,t)=>{const a=n[t];return n.every((e=>a.max>=e.min))}));if(t.length<n.length)return(0,wt.Fp)(...t);break}}return e}),(e=>e))}function _t(e){const t={};return e.forEach((e=>{Object.entries(e).forEach((([e,a])=>{t[e]?(t[e].min+=a.min,t[e].max+=a.max):t[e]=Object.assign({},a)}))})),t}function Kt(e){const t={};return e.length&&(Object.keys(e[0].values).filter((t=>e.every((e=>e.values[t])))).forEach((a=>t[a]={min:e[0].values[a],max:e[0].values[a]})),e.forEach((({values:e})=>{for(const[a,n]of Object.entries(e))t[a]?(t[a].max<n&&(t[a].max=n),t[a].min>n&&(t[a].min=n)):t[a]={min:0,max:n}}))),t}function jt(e,t){const a=new Map;return(0,Ct.aD)(e,(e=>{}),(e=>{var n;const{operation:i}=e,l=e.operands.map((e=>a.get(e)));let r;switch(i){case"read":if("dyn"!==e.path[0])throw new Error(`Found non-dyn path ${e.path} while computing range`);r=null!=(n=t[e.path[1]])?n:{min:0,max:0};break;case"const":r=Et([e.value]);break;case"add":case"min":case"max":r={min:bt.aj[i](l.map((e=>e.min))),max:bt.aj[i](l.map((e=>e.max)))};break;case"res":r={min:bt.aj[i]([l[0].max]),max:bt.aj[i]([l[0].min])};break;case"mul":r=l.reduce(((e,t)=>Et([e.min*t.min,e.min*t.max,e.max*t.min,e.max*t.max])));break;case"threshold":r=l[0].min>=l[1].max?l[2]:l[0].max<l[1].min?l[3]:Et([],[l[2],l[3]]);break;case"sum_frac":{const[e,t]=l,a={min:e.min+t.min,max:e.max+t.max};r=a.min<=0&&a.max>=0?e.min<=0&&e.max>=0?{min:NaN,max:NaN}:{min:-1/0,max:1/0}:Et([e.min/a.min,e.min/a.max,e.max/a.min,e.max/a.max]);break}default:(0,at.UT)(i)}a.set(e,r)})),a}function Et(e,t=[]){const a=Math.max(...e,...t.map((e=>e.max)));return{min:Math.min(...e,...t.map((e=>e.min))),max:a}}function Ot(e){function t(e){if(Object(e)!==e)return Promise.reject(new TypeError(e+" is not an object."));var t=e.done;return Promise.resolve(e.value).then((function(e){return{value:e,done:t}}))}return Ot=function(e){this.s=e,this.n=e.next},Ot.prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(e){var a=this.s.return;return void 0===a?Promise.resolve({value:e,done:!0}):t(a.apply(this.s,arguments))},throw:function(e){var a=this.s.return;return void 0===a?Promise.reject(e):t(a.apply(this.s,arguments))}},new Ot(e)}class Pt{constructor(e,t,a){this.prio=void 0,this.commands=void 0,this.workers=void 0,this.workDone=new Map,this._workers=void 0,this.cancel=void 0,this.cancelled=void 0,this.callback=void 0,this.notifyNonEmpty=void 0,this.commands=t.map((e=>new at.uZ)),this.prio=new Map(t.map(((e,t)=>[e,t]))),this.callback=a,e.forEach((e=>{e.onmessage=t=>this.onMessage(t.data,e),e.onerror=e=>this.onError(e)})),this._workers=e,this.workers=e.map((e=>Promise.resolve(e))),this.cancel=()=>{},this.cancelled=new Promise(((e,t)=>this.cancel=t)),this.cancelled.catch((t=>e.forEach((e=>e.terminate()))))}async execute(e){var t=this;const a=async function(){var a,n=!1,i=!1;try{for(var l,r=function(e){var t,a,n,i=2;for("undefined"!=typeof Symbol&&(a=Symbol.asyncIterator,n=Symbol.iterator);i--;){if(a&&null!=(t=e[a]))return t.call(e);if(n&&null!=(t=e[n]))return new Ot(t.call(e));a="@@asyncIterator",n="@@iterator"}throw new TypeError("Object is not async iterable")}(e);n=!(l=await r.next()).done;n=!1){const e=l.value;t.add(e)}}catch(e){i=!0,a=e}finally{try{n&&null!=r.return&&await r.return()}finally{if(i)throw a}}}();for(;;){var n;const e=null==(n=this.commands.find((e=>e.length)))?void 0:n.pop();if(void 0===e){const e=await Promise.race([new Promise((e=>this.notifyNonEmpty=()=>e(!0))),Promise.all([...this.workers,a]).then((e=>!1)),this.cancelled]);if(this.notifyNonEmpty=void 0,e)continue;break}const{i:t,w:i}=await Promise.race([...this.workers.map(((e,t)=>e.then((e=>({i:t,w:e}))))),this.cancelled]);this.workers[t]=new Promise((e=>this.workDone.set(i,(()=>e(i))))),i.postMessage(e)}}onError(e){this.cancel(new Error(`Worker Error: ${e.message}`))}onMessage(e,t){void 0!==e.command?this.add(e):"done"===e.resultType?this.workDone.get(t)():this.callback(e,t)}add(e){var t;const a=this.prio.get(e.command);this.commands[a].push(e),null==(t=this.notifyNonEmpty)||t.call(this)}broadcast(e){this._workers.forEach((t=>t.postMessage(e)))}notifiedBroadcast(e){this.workers=this.workers.map((e=>e.then((e=>new Promise((t=>{this.workDone.set(e,(()=>t(e)))})))))),this._workers.forEach((t=>t.postMessage(e)))}}class Tt extends Pt{constructor(e,t,n){super(Array(n).fill(NaN).map((e=>new Worker(new URL(a.p+a.u(710),a.b)))),["iterate","split","count"],((e,t)=>{switch(e.resultType){case"interim":this.interim(e,t);break;case"finalize":this.finalizedResults.push(e);break;case"count":this.status.total=e.count;break;case"err":this.onError(e)}})),this.maxIterateSize=32e6,this.status=void 0,this.exclusion=void 0,this.topN=void 0,this.buildValues=void 0,this.finalizedResults=[];const{exclusion:i,topN:l}=e;this.status=t,this.exclusion=i,this.topN=l,this.status.total=NaN,this.buildValues=Array(l).fill({w:void 0,val:-1/0}),this.notifiedBroadcast(this.preprocess(e))}async solve(){const{exclusion:e,maxIterateSize:t}=this;return this.finalizedResults=[],await this.execute([{command:"count",exclusion:e,maxIterateSize:t}]),this.notifiedBroadcast({command:"finalize"}),await this.execute([]),this.finalizedResults}preprocess({plotBase:e,optimizationTarget:t,arts:a,topN:n,exclusion:i,constraints:l}){let r=[...(l=l.filter((e=>e.min>-1/0))).map((e=>e.value)),t];const s=[...l.map((e=>e.min)),-1/0];e&&(r.push(e),s.push(-1/0)),r=function(e,t){const a={};for(const[e,n]of Object.entries(t))n.includes(4)&&(a[e]=n.includes(2)?1:3);return(0,Ct.uW)(e,(e=>e),(e=>{if("threshold"!==e.operation)return e;const[n,i,l,r]=e.operands;if("read"===n.operation&&"const"===i.operation){const e=n.path[n.path.length-1],s=i.value;if(e in a){if(a[e]<s)return r;if(2===s&&t[e].includes(2))return(0,wt.Lj)(n,4,l,r)}}return e}))}(r,i),r=(0,bt.tL)(r,{},(e=>!1)),({nodes:r,arts:a}=function(e,t,a,n,i,l){let r=l;const s={pruneNodeRange:!0},c={pruneNodeRange:!0},o={reaffine:!0},d={pruneOrder:!0,pruneArtRange:!0,pruneNodeRange:!0};let u=0;for(;Object.values(r).some((e=>e))&&u++<20;){if(r.pruneOrder){delete r.pruneOrder;const e=St(a,n,i);a!==e&&(a=e,r=Object.assign({},r,s))}if(r.pruneArtRange){delete r.pruneArtRange;const n=kt(e,a,t);a!==n&&(a=n,r=Object.assign({},r,c))}if(r.pruneNodeRange){delete r.pruneNodeRange;const t=Xt(e,a);e!==t&&(e=t,r=Object.assign({},r,o))}if(r.reaffine){delete r.reaffine;const{nodes:t,arts:n}=Bt(e,a);e===t&&a===n||(e=t,a=n,r=Object.assign({},r,d))}}return{nodes:e,arts:a}}(r,s,a,n,i,{reaffine:!0,pruneArtRange:!0,pruneNodeRange:!0,pruneOrder:!0})),r=(0,bt.tL)(r,{},(e=>!1)),e&&(e=r.pop());return{command:"setup",arts:a,optTarget:r.pop(),plotBase:e,topN:n,constraints:r.map(((e,t)=>({value:e,min:s[t]})))}}interim(e,t){if(this.status.tested+=e.tested,this.status.failed+=e.failed,this.status.skipped+=e.skipped,e.buildValues){var a,n;const{topN:i}=this,l=null!=(a=this.buildValues[i-1].val)?a:-1/0;this.buildValues.filter((({w:e})=>e!==t)),this.buildValues.push(...e.buildValues.map((e=>({w:t,val:e})))),this.buildValues.sort(((e,t)=>t.val-e.val)).splice(i);const r=null!=(n=this.buildValues[i-1].val)?n:-1/0;l!==r&&this.broadcast({command:"threshold",threshold:r})}}}var Mt=a(2313),At=a(13264),Dt=a(96511),It=a(13780),Lt=a(79199),Rt=a(91218),Nt=a(89279),Gt=a(28265),zt=a(64303);function Wt(e){const{database:t}=(0,x.useContext)(T.t),[a,n]=(0,x.useState)((()=>t.buildSettings.get(e)));(0,x.useEffect)((()=>n(t.buildSettings.get(e))),[t,e]),(0,x.useEffect)((()=>t.buildSettings.follow(e,((e,t,a)=>"update"===t&&n(a)))),[e,n,t]);return{buildSetting:a,buildSettingDispatch:(0,x.useCallback)((a=>e&&t.buildSettings.set(e,a)),[e,t])}}let $t,Vt,Ft,qt,Ht=e=>e;var Ut;function Yt({disabled:e=!1,allowListTotal:t}){const{t:a}=(0,v.$G)("page_character_optimize"),{t:l}=(0,v.$G)("page_character"),{character:{key:r}}=(0,x.useContext)(_.K),{silly:s}=(0,x.useContext)(O.E),{buildSetting:{excludedLocations:c,allowLocationsState:o},buildSettingDispatch:d}=Wt(r),{database:u}=(0,x.useContext)(T.t),[Z,m,f]=(0,i.aV)(!1),[y,b]=(0,i.NW)(),S=(0,x.useDeferredValue)(y),[k,K]=(0,x.useState)(""),j=(0,x.useDeferredValue)(k),[E,M]=(0,x.useState)([...n.UB]),A=(0,x.useDeferredValue)(E),[D,I]=(0,x.useState)([...n.yd]),L=(0,x.useDeferredValue)(D),R=(0,x.useMemo)((()=>S&&Object.fromEntries(Array.from(new Set(Object.entries(u.chars.data).filter((([e])=>e!==r)).filter((([e])=>(0,at.CZ)({element:A,weaponType:L,name:j},(0,zt.zU)(u,s))(e))))))),[S,u,r,A,L,j,s]),N=Object.entries(R).sort((([e,t],[a,n])=>{const[i,l]=[-1,1],r=u.charMeta.get(e).favorite,s=u.charMeta.get(a).favorite;if(r&&!s)return i;if(s&&!r)return l;const c=Object.values(t.equippedArtifacts).filter((e=>e)).length,o=Object.values(n.equippedArtifacts).filter((e=>e)).length;return c>o?i:o>c?l:e.localeCompare(a)})).map((([e])=>(0,n.V7)(e))),{elementTotals:G,weaponTypeTotals:W,locListTotals:$}=(0,x.useMemo)((()=>{const e={elementTotals:[...n.UB],weaponTypeTotals:[...n.yd],locListTotals:["allowed","excluded"]};return(0,Mt.A)(e,(e=>Object.entries(u.chars.data).filter((([e])=>e!==r)).forEach((([t])=>{const a=(0,P.m)(t,u.gender),i=a.elementKey;e.elementTotals[i].total++,R[t]&&e.elementTotals[i].current++;const l=a.weaponTypeKey;e.weaponTypeTotals[l].total++,R[t]&&e.weaponTypeTotals[l].current++;const r=(0,n.V7)(t);N.includes(r)&&(e.locListTotals.allowed.total++,e.locListTotals.excluded.total++,c.includes(r)?e.locListTotals.excluded.current++:e.locListTotals.allowed.current++)}))))}),[R,r,u.chars.data,u.gender,c,N]);(0,x.useEffect)((()=>u.charMeta.followAny((e=>b()))),[b,u]),(0,x.useEffect)((()=>u.chars.followAny((e=>b()))),[b,u]);const[V,F]=(0,x.useState)(!1),H=(0,x.useCallback)((()=>d({excludedLocations:c.filter((e=>!N.includes(e))),allowLocationsState:"customList"})),[d,c,N]),U=(0,x.useCallback)((()=>d({excludedLocations:Array.from(new Set(c.concat(N))),allowLocationsState:"customList"})),[d,c,N]),J=(0,x.useCallback)(((e,t)=>d({allowLocationsState:t})),[d]),Q=(0,x.useCallback)((e=>{const t=[...e],a=t.filter((e=>!c.includes(e))).concat(c.filter((e=>!t.includes(e))));d({excludedLocations:a,allowLocationsState:"customList"})}),[c,d]),ee=(0,x.useCallback)((()=>F(!0)),[]),te=u.chars.keys.length-1,ae=te-c.length,ie="all"===o?te:"customList"===o?ae===te?ae:`${ae}/${te}`:0,le="all"===o?"success":"customList"===o?"info":"secondary";return(0,z.BX)(h.Z,{display:"flex",gap:1,children:[(0,z.tZ)(ne.Z,{open:Z,onClose:f,containerProps:{maxWidth:"xl"},draggable:!1,onMouseUp:ee,children:(0,z.BX)(C.Z,{children:[(0,z.tZ)(p.Z,{children:(0,z.BX)(h.Z,{display:"flex",gap:1,alignItems:"center",children:[(0,z.tZ)(Y.Z,{variant:"h6",children:a($t||($t=Ht`excludeChar.title`))}),(0,z.tZ)(Zt.Z,{title:(0,z.tZ)(Y.Z,{children:a(Vt||(Vt=Ht`excludeChar.tooltip`))})}),(0,z.tZ)(h.Z,{flexGrow:1}),(0,z.tZ)(B.Z,{onClick:f,size:"small"})]})}),(0,z.tZ)(q.Z,{}),(0,z.tZ)(p.Z,{sx:{pb:0},children:(0,z.BX)(de.Z,{gap:1,children:[(0,z.BX)(h.Z,{display:"flex",gap:1,flexWrap:"wrap",children:[(0,z.tZ)(ft.Z,{exclusive:!0,baseColor:"secondary",size:"small",value:o,onChange:J,children:vt.Cz.map((t=>(0,z.tZ)(ct.Z,{value:t,disabled:o===t||e,children:a(`excludeChar.states.${t}`)},t)))}),(0,z.tZ)(It.Z,{autoFocus:!0,value:k,onChange:e=>K(e.target.value),label:l("characterName"),size:"small",sx:{height:"100%"},InputProps:{sx:{height:"100%"}}})]}),(0,z.BX)(h.Z,{display:"flex",gap:1,flexWrap:"wrap",children:[(0,z.tZ)(Gt.Z,{sx:{height:"100%"},onChange:I,value:L,totals:W,size:"small"}),(0,z.tZ)(Nt.Z,{sx:{height:"100%"},onChange:M,value:A,totals:G,size:"small"})]})]})}),(0,z.BX)(p.Z,{sx:{opacity:"customList"===o?1:.6},children:[(0,z.BX)(ue.ZP,{container:!0,pb:1,gap:1,flexWrap:"nowrap",children:[(0,z.tZ)(ue.ZP,{item:!0,xs:6,children:(0,z.BX)(g.Z,{color:"success",fullWidth:!0,onClick:H,children:[a(Ft||(Ft=Ht`excludeChar.modal.allow_all`)),(0,z.tZ)(X.Z,{sx:{ml:1},children:(0,z.tZ)("strong",{children:$.allowed})})]})}),(0,z.tZ)(ue.ZP,{item:!0,xs:6,children:(0,z.BX)(g.Z,{fullWidth:!0,color:"error",onClick:U,children:[a(qt||(qt=Ht`excludeChar.modal.disallow_All`)),(0,z.tZ)(X.Z,{sx:{ml:1},children:(0,z.tZ)("strong",{children:$.excluded})})]})})]}),(0,z.tZ)(Jt,{locList:N,excludedLocations:c,mouseUpDetected:V,setMouseUpDetected:F,toggleList:Q})]})]})}),(0,z.BX)(w.Z,{sx:{display:"flex",width:"100%"},children:[(0,z.tZ)(p.Z,{sx:{flexGrow:1},children:(0,z.BX)(de.Z,{spacing:1,children:[(0,z.tZ)(Y.Z,{children:(0,z.tZ)("strong",{children:a("excludeChar.title")})}),(0,z.BX)(Y.Z,{children:[a("excludeChar.usingState")," ",(0,z.tZ)(X.Z,{color:le,children:a(`excludeChar.states.${o}`)})]}),(0,z.BX)(Y.Z,{children:[a("excludeChar.chars")," ",(0,z.BX)(X.Z,{color:"success",children:[ie," ",(0,z.tZ)(Dt.Z,Object.assign({},pe.mX)),a("artSetConfig.allowed")]})]}),(0,z.BX)(Y.Z,{children:[a("excludeChar.artis")," ",(0,z.BX)(X.Z,{color:"success",children:[t," ",(0,z.tZ)(Dt.Z,Object.assign({},pe.mX)),a("artSetConfig.allowed")]})]})]})}),(0,z.tZ)(g.Z,{sx:{borderRadius:0,flexShrink:1,minWidth:40},onClick:m,disabled:e,color:"info",children:(0,z.tZ)(At.Z,{})})]})]})}function Jt({locList:e,excludedLocations:t,mouseUpDetected:a,setMouseUpDetected:n,toggleList:i}){const[l,r]=(0,x.useState)(new Set),[s,c]=(0,x.useState)();return(0,x.useEffect)((()=>{a&&(n(!1),l.size>0&&(i(l),r(new Set),c(void 0)))}),[l,r,n,a,i]),(0,z.tZ)(ue.ZP,{container:!0,spacing:1,columns:{xs:6,sm:7,md:10,lg:12,xl:16},children:e.map((e=>(0,z.tZ)(ue.ZP,{item:!0,xs:1,children:(0,z.tZ)(Qt,{locKey:e,charList:l,charListMode:s,setCharList:r,setCharListMode:c,selected:!t.includes(e)})},e)))})}function Qt({locKey:e,selected:t,charList:a,charListMode:i,setCharList:l,setCharListMode:r}){const{database:s}=(0,x.useContext)(T.t),c=s.chars.get(s.chars.LocationToCharacterKey(e)),o=(0,x.useCallback)((n=>1===n.buttons&&(i===Ut.ToggleToAllow&&!t||i===Ut.ToggleToExclude&&t)&&l(new Set([...a]).add(e))),[i,t,l,a,e]),d=(0,x.useCallback)((()=>{const n=t?Ut.ToggleToExclude:Ut.ToggleToAllow;r(n),l(new Set([...a]).add(e))}),[t,r,l,a,e]),u=(0,x.useMemo)((()=>0!==a.size),[a.size]),Z=t&&!(i===Ut.ToggleToExclude&&a.has(e))||i===Ut.ToggleToAllow&&a.has(e),p={opacity:Z?void 0:.6,borderColor:Z?"rgb(100,200,100)":"rgb(200,100,100)",borderWidth:"3px",borderStyle:"solid",borderRadius:"8px"},m=(0,x.useMemo)((()=>(0,z.tZ)(h.Z,{fontSize:"0.85em",display:"flex",justifyContent:"space-between",p:.3,children:n.Ex.map((e=>(0,z.tZ)(Lt.Z,{slotKey:e,iconProps:{fontSize:"inherit",sx:{opacity:null!=c&&c.equippedArtifacts[e]?void 0:.5}}},e)))})),[null==c?void 0:c.equippedArtifacts]);return(0,z.BX)(w.Z,{sx:p,children:[(0,z.tZ)(Rt.Z,{characterKey:s.chars.LocationToCharacterKey(e),onMouseDown:d,onMouseEnter:o,disableTooltip:u}),m]})}!function(e){e[e.ToggleToAllow=0]="ToggleToAllow",e[e.ToggleToExclude=1]="ToggleToExclude"}(Ut||(Ut={}));var ea=a(38114),ta=a(78437),aa=a(1089),na=a(14836);function ia({setKey:e,setNumKey:t,hideHeader:a=!1,conditionalsOnly:n=!1}){var i;const l=(0,aa.Sk)(e),r=n?null==(i=l.setEffectDocument(t))?void 0:i.filter((e=>"states"in e)):l.setEffectDocument(t);return(0,z.tZ)(h.Z,{display:"flex",flexDirection:"column",children:r?(0,z.tZ)(na.Z,{sections:r,hideHeader:a}):null})}var la=a(1665),ra=a(51576);let sa,ca,oa=e=>e;function da({setKey:e,buttonGroupSx:t}){var a;const{t:n}=(0,v.$G)("sheet"),{character:{key:i}}=(0,x.useContext)(_.K),{buildSetting:{artSetExclusion:l},buildSettingDispatch:r}=Wt(i),s=null!=(a=null==l?void 0:l[e])?a:[],c=s.includes(2),o=s.includes(4);return(0,z.BX)(_e.Z,{sx:t,fullWidth:!0,children:[(0,z.tZ)(g.Z,{startIcon:c?(0,z.tZ)(ge.Z,{}):(0,z.tZ)(fe.Z,{}),onClick:()=>r({artSetExclusion:(0,vt.sL)(l,e,2)}),color:c?"secondary":"success",endIcon:c?(0,z.tZ)(ea.Z,{}):(0,z.tZ)(Dt.Z,{}),children:n(sa||(sa=oa`2set`))}),(0,z.tZ)(g.Z,{startIcon:o?(0,z.tZ)(ge.Z,{}):(0,z.tZ)(fe.Z,{}),onClick:()=>r({artSetExclusion:(0,vt.sL)(l,e,4)}),color:o?"secondary":"success",endIcon:o?(0,z.tZ)(ea.Z,{}):(0,z.tZ)(Dt.Z,{}),children:n(ca||(ca=oa`4set`))})]})}let ua,ha,Za,pa,ma,fa,ga,xa,va,ya,ba,Ca,wa,Ba,Sa=e=>e;function ka({disabled:e}){var t,a;const{t:l}=(0,v.$G)(["page_character_optimize","sheet"]),r=(0,x.useContext)(K.R),{database:s}=(0,x.useContext)(T.t),{character:{key:c,conditional:o},characterDispatch:d}=(0,x.useContext)(_.K),{buildSetting:{artSetExclusion:u},buildSettingDispatch:Z}=Wt(c),[m,f]=(0,x.useState)(!1),y=(0,x.useCallback)((()=>f(!0)),[f]),b=(0,x.useCallback)((()=>f(!1)),[f]),[S,k]=(0,i.NW)();(0,x.useEffect)((()=>s.arts.followAny(k)),[s,k]);const j=(0,x.useMemo)((()=>Object.entries(aa.WO).reverse().flatMap((([,e])=>e)).filter((e=>!e.includes("Prayers")))),[]),{artKeys:E,artSlotCount:O}=(0,x.useMemo)((()=>{const e=(0,at.K8)(j,(e=>(0,at.K8)(n.Ex,(e=>0))));s.arts.values.forEach((t=>e[t.setKey]&&e[t.setKey][t.slotKey]++));const t=[...j].sort(((t,a)=>+(Ka(e[t])<2)-+(Ka(e[a])<2)));return S&&{artKeys:t,artSlotCount:e}}),[S,s,j]),P=!(null!=(t=u.rainbow)&&t.includes(2)),M=!(null!=(a=u.rainbow)&&a.includes(4)),{allowTotals:A}=(0,x.useMemo)((()=>(0,Mt.A)({allowTotals:["2","4"]},(e=>j.forEach((t=>{var a,n;e.allowTotals[2].total++,null!=(a=u[t])&&a.includes(2)||e.allowTotals[2].current++,e.allowTotals[4].total++,null!=(n=u[t])&&n.includes(4)||e.allowTotals[4].current++}))))),[j,u]),D=(0,x.useMemo)((()=>Object.keys(o).filter((e=>{var t;return n.Gt.includes(e)&&!!Object.keys(null!=(t=o[e])?t:{}).length})).length),[o]),I=(0,x.useMemo)((()=>Object.assign({},r,{data:new le.w(Object.assign({},r.data.data[0],{artSet:(0,at.K8)(n.Gt,(e=>(0,wt.a9)(4)))}),void 0)})),[r]),L=(0,x.useCallback)((()=>{const e=Object.fromEntries(Object.entries(o).filter((([e])=>!n.Gt.includes(e))));d({conditional:e})}),[o,d]),R=(0,x.useCallback)(((e,t=!0)=>{const a=structuredClone(u);j.forEach((n=>{var i;t?a[n]=[...null!=(i=a[n])?i:[],e]:a[n]&&(a[n]=a[n].filter((t=>t!==e)))})),Z({artSetExclusion:a})}),[j,u,Z]);return(0,z.BX)(z.HY,{children:[(0,z.BX)(w.Z,{sx:{display:"flex",width:"100%"},children:[(0,z.BX)(p.Z,{sx:{flexGrow:1},children:[(0,z.tZ)(Y.Z,{children:(0,z.tZ)("strong",{children:l(ua||(ua=Sa`artSetConfig.title`))})}),(0,z.BX)(de.Z,{spacing:1,children:[(0,z.BX)(Y.Z,{children:[l(ha||(ha=Sa`artSetConfig.setEffCond`))," ",(0,z.BX)(X.Z,{color:D?"success":"warning",children:[D," ",l("artSetConfig.enabled")]})]}),(0,z.BX)(Y.Z,{children:[l(Za||(Za=Sa`sheet:2set`))," ",(0,z.BX)(X.Z,{color:"success",children:[A[2]," ",(0,z.tZ)(Dt.Z,Object.assign({},pe.mX))," ",l("artSetConfig.allowed")]})]}),(0,z.BX)(Y.Z,{children:[l(pa||(pa=Sa`sheet:4set`))," ",(0,z.BX)(X.Z,{color:"success",children:[A[4]," ",(0,z.tZ)(Dt.Z,Object.assign({},pe.mX))," ",l("artSetConfig.allowed")]})]}),(0,z.BX)(Y.Z,{children:[l(ma||(ma=Sa`artSetConfig.2rainbow`))," ",(0,z.BX)(X.Z,{color:P?"success":"secondary",children:[P?(0,z.tZ)(Dt.Z,Object.assign({},pe.mX)):(0,z.tZ)(ea.Z,Object.assign({},pe.mX))," ",P?l("artSetConfig.allowed"):"Excluded"]})]}),(0,z.BX)(Y.Z,{children:[l(fa||(fa=Sa`artSetConfig.4rainbow`))," ",(0,z.BX)(X.Z,{color:M?"success":"secondary",children:[M?(0,z.tZ)(Dt.Z,Object.assign({},pe.mX)):(0,z.tZ)(ea.Z,Object.assign({},pe.mX))," ",M?l("artSetConfig.allowed"):"Excluded"]})]})]})]}),(0,z.tZ)(g.Z,{onClick:y,disabled:e,color:"info",sx:{borderRadius:0,flexShrink:1,minWidth:40},children:(0,z.tZ)(At.Z,{})})]}),(0,z.tZ)(ne.Z,{open:m,onClose:b,children:(0,z.BX)(C.Z,{children:[(0,z.BX)(p.Z,{sx:{display:"flex",gap:1,justifyContent:"space-between"},children:[(0,z.tZ)(Y.Z,{variant:"h6",children:l(ga||(ga=Sa`artSetConfig.title`))}),(0,z.tZ)(B.Z,{onClick:b})]}),(0,z.tZ)(q.Z,{}),(0,z.BX)(p.Z,{children:[(0,z.tZ)(w.Z,{sx:{mb:1},children:(0,z.BX)(p.Z,{children:[(0,z.BX)(h.Z,{display:"flex",gap:1,children:[(0,z.tZ)(Y.Z,{children:(0,z.tZ)("strong",{children:l(xa||(xa=Sa`artSetConfig.modal.setCond.title`))})}),(0,z.tZ)(Y.Z,{sx:{flexGrow:1},children:(0,z.BX)(X.Z,{color:D?"success":"warning",children:[D," ",l("artSetConfig.selected")]})}),(0,z.tZ)(g.Z,{size:"small",onClick:L,color:"error",startIcon:(0,z.tZ)(me.Z,{}),children:l(va||(va=Sa`artSetConfig.modal.setCond.reset`))})]}),(0,z.tZ)(Y.Z,{children:l(ya||(ya=Sa`artSetConfig.modal.setCond.text`))})]})}),(0,z.tZ)(w.Z,{sx:{mb:1},children:(0,z.BX)(p.Z,{children:[(0,z.tZ)(Y.Z,{sx:{flexGrow:1},children:(0,z.tZ)("strong",{children:(0,z.BX)(v.cC,{t:l,i18nKey:"artSetConfig.modal.ArtSetFilter.title",children:["Artifact Sets ",(0,z.BX)(te.Z,{color:"success",children:["Allowed",(0,z.tZ)(Dt.Z,Object.assign({},pe.mX))]})," / ",(0,z.BX)(te.Z,{color:"secondary",variant:"light",children:["Excluded",(0,z.tZ)(ea.Z,Object.assign({},pe.mX))]})]})})}),(0,z.tZ)(Y.Z,{children:(0,z.BX)(v.cC,{t:l,i18nKey:"artSetConfig.modal.ArtSetFilter.intro",children:["You can allow/exclude which sets you want the builder to consider. In the following examples, ",(0,z.tZ)("strong",{children:"A"})," is on-set, and ",(0,z.tZ)("strong",{children:"R"})," is rainbow(off-set)"]})}),(0,z.tZ)(Y.Z,{children:(0,z.BX)(v.cC,{t:l,i18nKey:"artSetConfig.modal.ArtSetFilter.2set",children:[(0,z.tZ)("strong",{children:(0,z.BX)(te.Z,{color:"secondary",variant:"light",children:["Excluding",(0,z.tZ)(ea.Z,Object.assign({},pe.mX))," 2-Set"]})}),"would exclude 2-Set builds:",(0,z.BX)("strong",{children:[(0,z.tZ)(te.Z,{color:"secondary",variant:"light",children:"AA"}),"RRR"]}),"and",(0,z.BX)("strong",{children:[(0,z.tZ)(te.Z,{color:"secondary",variant:"light",children:"AAA"}),"RR"]}),"."]})}),(0,z.tZ)(Y.Z,{children:(0,z.BX)(v.cC,{t:l,i18nKey:"artSetConfig.modal.ArtSetFilter.4set",children:[(0,z.tZ)("strong",{children:(0,z.BX)(te.Z,{color:"secondary",variant:"light",children:["Excluding",(0,z.tZ)(ea.Z,Object.assign({},pe.mX))," 4-Set"]})}),"would exclude 4-Set builds:",(0,z.BX)("strong",{children:[(0,z.tZ)(te.Z,{color:"secondary",variant:"light",children:"AAAA"}),"R"]}),"and",(0,z.tZ)("strong",{children:(0,z.tZ)(te.Z,{color:"secondary",variant:"light",children:"AAAAA"})}),"."]})}),(0,z.tZ)(Y.Z,{children:(0,z.BX)(v.cC,{t:l,i18nKey:"artSetConfig.modal.ArtSetFilter.2rain",children:[(0,z.tZ)("strong",{children:(0,z.BX)(te.Z,{color:"secondary",variant:"light",children:["Excluding",(0,z.tZ)(ea.Z,Object.assign({},pe.mX))," 3-Rainbow"]})}),"would exclude 2-Set + 3-Rainbow builds:",(0,z.BX)("strong",{children:["AA",(0,z.tZ)(te.Z,{color:"secondary",variant:"light",children:"RRR"})]}),"and",(0,z.BX)("strong",{children:["AAA",(0,z.tZ)(te.Z,{color:"secondary",variant:"light",children:"RR"})]}),"."]})}),(0,z.tZ)(Y.Z,{children:(0,z.BX)(v.cC,{t:l,i18nKey:"artSetConfig.modal.ArtSetFilter.4rain",children:[(0,z.tZ)("strong",{children:(0,z.BX)(te.Z,{color:"secondary",variant:"light",children:["Excluding",(0,z.tZ)(ea.Z,Object.assign({},pe.mX))," 5-Rainbow"]})}),"would exclude full 5-Rainbow builds:",(0,z.tZ)("strong",{children:(0,z.tZ)(te.Z,{color:"secondary",variant:"light",children:"RRRRR"})}),"."]})})]})}),(0,z.BX)(ue.ZP,{container:!0,columns:{xs:2,lg:3},sx:{mb:1},spacing:1,children:[(0,z.tZ)(ue.ZP,{item:!0,xs:1,children:(0,z.tZ)(Xa,{allowTotal:A[2],setNum:2,setAllExclusion:R})}),(0,z.tZ)(ue.ZP,{item:!0,xs:1,children:(0,z.tZ)(Xa,{allowTotal:A[4],setNum:4,setAllExclusion:R})}),(0,z.tZ)(ue.ZP,{item:!0,xs:1,children:(0,z.tZ)(w.Z,{children:(0,z.BX)(p.Z,{children:[(0,z.tZ)(Y.Z,{gutterBottom:!0,children:(0,z.tZ)("strong",{children:(0,z.BX)(v.cC,{t:l,i18nKey:"artSetConfig.alExRainbow",children:[(0,z.BX)(te.Z,{color:"success",children:["Allow ",(0,z.tZ)(Dt.Z,Object.assign({},pe.mX))]})," / ",(0,z.BX)(te.Z,{color:"secondary",variant:"light",children:["Exclude ",(0,z.tZ)(ea.Z,Object.assign({},pe.mX))]})," Rainbow Builds"]})})}),(0,z.BX)(h.Z,{sx:{display:"flex",flexDirection:"column",gap:1},children:[(0,z.tZ)(g.Z,{fullWidth:!0,onClick:()=>Z({artSetExclusion:(0,vt.sL)(u,"rainbow",2)}),color:P?"success":"secondary",startIcon:P?(0,z.tZ)(fe.Z,{}):(0,z.tZ)(ge.Z,{}),endIcon:P?(0,z.tZ)(Dt.Z,{}):(0,z.tZ)(ea.Z,{}),children:l(ba||(ba=Sa`artSetConfig.2rainbow`))}),(0,z.tZ)(g.Z,{fullWidth:!0,onClick:()=>Z({artSetExclusion:(0,vt.sL)(u,"rainbow",4)}),color:M?"success":"secondary",startIcon:M?(0,z.tZ)(fe.Z,{}):(0,z.tZ)(ge.Z,{}),endIcon:M?(0,z.tZ)(Dt.Z,{}):(0,z.tZ)(ea.Z,{}),children:l(Ca||(Ca=Sa`artSetConfig.4rainbow`))})]})]})})})]}),(0,z.tZ)(ue.ZP,{container:!0,spacing:1,columns:{xs:2,lg:3},children:E.map((e=>(0,z.tZ)(_a,{setKey:e,fakeDataContextObj:I,slotCount:O[e]},e)))})]}),(0,z.tZ)(q.Z,{}),(0,z.tZ)(p.Z,{sx:{py:1},children:(0,z.tZ)(B.Z,{large:!0,onClick:b})})]})})]})}function Xa({allowTotal:e,setNum:t,setAllExclusion:a}){const{t:n}=(0,v.$G)(["page_character_optimize","sheet"]);return(0,z.tZ)(w.Z,{children:(0,z.BX)(p.Z,{children:[(0,z.BX)(Y.Z,{gutterBottom:!0,children:[(0,z.tZ)("strong",{children:n(`sheet:${t}set`)})," ",(0,z.BX)(X.Z,{color:"success",children:[e," ",(0,z.tZ)(Dt.Z,Object.assign({},pe.mX))," ",n("artSetConfig.allowed")]})]}),(0,z.BX)(h.Z,{sx:{display:"flex",flexDirection:"column",gap:1},children:[(0,z.tZ)(g.Z,{fullWidth:!0,disabled:"0"!==e.charAt(0)&&-1===e.indexOf("/"),onClick:()=>a(t,!1),color:"success",startIcon:(0,z.tZ)(Dt.Z,{}),children:n(`artSetConfig.allowAll${t}set`)}),(0,z.tZ)(g.Z,{fullWidth:!0,disabled:"0"===e.charAt(0),onClick:()=>a(t,!0),color:"secondary",startIcon:(0,z.tZ)(ea.Z,{}),children:n(`artSetConfig.excludeAll${t}set`)})]})]})})}function _a({setKey:e,fakeDataContextObj:t,slotCount:a}){var n,i;const{t:l}=(0,v.$G)("sheet"),{character:{key:r}}=(0,x.useContext)(_.K),{buildSetting:s}=Wt(r),{artSetExclusion:c}=s,o=null!=(n=null==c?void 0:c[e])?n:[],d=!o.includes(4),u=Ka(a),Z=(0,aa.Sk)(e),m=(0,x.useMemo)((()=>d?Object.keys(Z.setEffects).filter((e=>{var t;return null==(t=Z.setEffects[e])?void 0:t.document.some((e=>"states"in e))})):[]),[Z.setEffects,d]);return(0,z.tZ)(ue.ZP,{item:!0,xs:1,children:(0,z.BX)(w.Z,{sx:{height:"100%",opacity:u<2?"50%":void 0},children:[(0,z.BX)(h.Z,{className:`grad-${Z.rarity[0]}star`,width:"100%",sx:{display:"flex"},children:[(0,z.tZ)(h.Z,{component:"img",src:(0,ra.jU)(e),sx:{height:100,width:"auto",mx:-1}}),(0,z.BX)(h.Z,{sx:{flexGrow:1,px:1,display:"flex",flexDirection:"column",justifyContent:"center"},children:[(0,z.tZ)(Y.Z,{variant:"h6",children:null!=(i=Z.name)?i:""}),(0,z.tZ)(h.Z,{children:(0,z.BX)(Y.Z,{variant:"subtitle1",children:[Z.rarity.map(((e,t)=>(0,z.BX)(h.Z,{component:"span",sx:{display:"inline-flex",alignItems:"center"},children:[e," ",(0,z.tZ)(ta.Z,{fontSize:"inherit"})," ",t<Z.rarity.length-1?"/ ":null]},e)))," ",(0,z.tZ)(Zt.L,{title:(0,z.BX)(h.Z,{children:[(0,z.tZ)(Y.Z,{children:(0,z.tZ)(X.Z,{color:"success",children:l(wa||(wa=Sa`2set`))})}),(0,z.tZ)(Y.Z,{children:(0,z.tZ)(la.v,{ns:`artifact_${e}_gen`,key18:"setEffects.2"})}),(0,z.BX)(h.Z,{paddingTop:2,sx:{opacity:o.includes(4)?.6:1},children:[(0,z.tZ)(Y.Z,{children:(0,z.tZ)(X.Z,{color:"success",children:l(Ba||(Ba=Sa`4set`))})}),(0,z.tZ)(Y.Z,{children:(0,z.tZ)(la.v,{ns:`artifact_${e}_gen`,key18:"setEffects.4"})})]})]})})]})}),(0,z.tZ)(h.Z,{sx:{display:"flex",gap:1},children:Object.entries(a).map((([e,t])=>(0,z.tZ)(Y.Z,{sx:{flexGrow:1},variant:"subtitle2",children:(0,z.BX)(X.Z,{sx:{width:"100%"},color:t?"primary":"secondary",children:[(0,z.tZ)(Lt.Z,{slotKey:e,iconProps:pe.mX})," ",t]})},e)))})]})]}),vt.Uu.includes(e)&&(0,z.tZ)(da,{setKey:e,buttonGroupSx:{".MuiButton-root":{borderRadius:0}}}),!!m.length&&(0,z.tZ)(K.R.Provider,{value:t,children:(0,z.tZ)(p.Z,{sx:{display:"flex",flexDirection:"column",gap:2},children:m.map((t=>(0,z.tZ)(ia,{setKey:e,setNumKey:parseInt(t),hideHeader:!0,conditionalsOnly:!0},t)))})})]})},e)}function Ka(e){return Object.values(e).reduce(((e,t)=>e+(t?1:0)),0)}const ja=[0,4,8,12,16,20];function Ea({mainStatAssumptionLevel:e=0,setmainStatAssumptionLevel:t,disabled:a}){const{t:n}=(0,v.$G)("page_character_optimize");return(0,z.tZ)(ht.Z,{fullWidth:!0,color:e?"success":"primary",disabled:a,title:e?n("mainStat.assumptionLvl.lvl",{lvl:e}):n("mainStat.assumptionLvl.no"),children:ja.map((e=>(0,z.tZ)(st.Z,{onClick:()=>t(e),children:e?n("mainStat.assumptionLvl.lvl",{lvl:e}):n("mainStat.assumptionLvl.no")},e)))})}let Oa,Pa=e=>e;function Ta(){const{t:e}=(0,v.$G)("page_character_optimize"),{character:{bonusStats:t}}=(0,x.useContext)(_.K),{data:a}=(0,x.useContext)(K.R),n=Object.keys(t);if(!n.length)return null;const i=n.map((e=>a.get(ye.ri.customBonus[e])));return(0,z.BX)(w.Z,{children:[(0,z.tZ)(p.Z,{children:(0,z.tZ)(Y.Z,{sx:{fontWeight:"bold"},children:e(Oa||(Oa=Pa`bonusStats.title`))})}),(0,z.tZ)(q.Z,{}),(0,z.tZ)(p.Z,{children:i.map((e=>(0,z.tZ)(Le.JW,{node:e},JSON.stringify(e.info))))})]})}var Ma=a(38162);const Aa=(0,Be.ZP)("strong")({fontFamily:"monospace"}),Da=(0,Be.ZP)(Ma.Z)((()=>({height:10,borderRadius:5})));function Ia({status:{type:e,tested:t,failed:a,skipped:n,total:i,startTime:l,finishTime:r},characterName:s}){const c=isFinite(i),o="inactive"!==e,d=i-n,u=(0,z.tZ)(Aa,{children:t.toLocaleString()}),h=(0,z.tZ)(Aa,{children:d.toLocaleString()}),Z=!!n&&(0,z.BX)("span",{children:["(",(0,z.tZ)("b",{children:(0,z.tZ)(Aa,{children:n.toLocaleString()})})," skipped)"]}),p=(0,z.tZ)(Aa,{children:(0,at.e6)(Math.round((null!=r?r:performance.now())-(null!=l?l:NaN)))});let m,f="",g="";if(o)m=100*t/d,f=(0,z.BX)(Y.Z,{children:["Generating and testing ",u,c?(0,z.BX)(z.HY,{children:["/",h]}):void 0," build configurations against the criteria for ",(0,z.tZ)("b",{children:s}),". ",Z]}),g=(0,z.BX)(Y.Z,{children:["Time elapsed: ",p]});else{if(!(t+n))return null;m=100,f=(0,z.BX)(Y.Z,{children:["Generated and tested ",u," Build configurations against the criteria for ",(0,z.tZ)("b",{children:s}),". ",Z]}),g=(0,z.BX)(Y.Z,{children:["Total duration: ",p]})}return(0,z.BX)(he.Z,{severity:"success",variant:"filled",sx:{"& .MuiAlert-message":{flexGrow:1}},children:[f,g,void 0!==m&&(0,z.BX)(ue.ZP,{container:!0,spacing:1,alignItems:"center",children:[c&&(0,z.tZ)(ue.ZP,{item:!0,children:(0,z.tZ)(Y.Z,{children:`${m.toFixed(1)}%`})}),(0,z.tZ)(ue.ZP,{item:!0,flexGrow:1,children:(0,z.tZ)(Da,{variant:c?"determinate":"indeterminate",value:m,color:"primary"})})]})]})}var La=a(74064),Ra=a(73673),Na=a(99074),Ga=a(22499),za=a(77133),Wa=a(30538),$a=a(66615),Va=a(75213),Fa=a(47746),qa=a(47591),Ha=a(69614),Ua=a(70582);function Ya({characterKey:e}){const{gender:t}=(0,D.Z)();if(!e)return null;const a=(0,P.m)(e,t);return a?(0,z.tZ)(dt.Z,{placement:"right-end",title:(0,z.tZ)(Y.Z,{children:a.name}),children:(0,z.tZ)(N.Z,{characterKey:e,sideMargin:!0})}):null}var Ja=a(26437);function Qa({statKey:e,disableIcon:t=!1}){return(0,z.BX)(h.Z,{component:"span",display:"flex",alignItems:"center",gap:1,children:[!t&&(0,z.tZ)(Ce.C,{statKey:e,iconProps:pe.mX}),(0,z.BX)("span",{children:[be.ZP.get(e),be.ZP.unit(e)]})]})}function en({statKey:e,disableIcon:t=!1}){return(0,z.tZ)(te.Z,{color:be.ZP.getVariant(e),children:(0,z.tZ)(Qa,{statKey:e,disableIcon:t})})}var tn=a(2218);function an({artifactId:e,slotKey:t,mainStatAssumptionLevel:a=0,showLocation:i=!1,onClick:l,BGComponent:r=C.Z}){const s=(0,Ua.Z)(e),{database:c}=(0,x.useContext)(T.t),o=(0,x.useCallback)((e=>(0,z.tZ)(Va.Z,{onClick:l,sx:{height:"100%"},children:e})),[l]),d=(0,Fa.Z)();if(!s)return(0,z.tZ)(r,{sx:{display:"flex",height:"100%",alignItems:"center",justifyContent:"center"},children:(0,z.tZ)(h.Z,{component:"img",src:za.CL.slot[t],sx:{width:"25%",height:"auto",opacity:.7}})});const{slotKey:u,rarity:Z,level:p,mainStatKey:m,substats:f,location:g}=s,v=Math.max(Math.min(a,4*Z),p),y=n.fR.find((e=>s.mainStatKey.includes(e))),b=y?(0,qa.Fq)(d.palette[y].main,.6):(0,qa.Fq)(d.palette.secondary.main,.6);return(0,z.tZ)(r,{sx:{height:"100%"},children:(0,z.tZ)(Ja.Z,{condition:!!l,wrapper:o,children:(0,z.BX)(h.Z,{display:"flex",height:"100%",children:[(0,z.BX)(h.Z,{className:`grad-${Z}star`,sx:{position:"relative",flexGrow:1,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"},children:[(0,z.tZ)(tn.Z,{art:s,children:(0,z.tZ)(h.Z,{component:"img",src:(0,za.Hp)(s.setKey,u),sx:{m:-1,maxHeight:"110%",maxWidth:"110%"}})}),(0,z.BX)(h.Z,{sx:{position:"absolute",width:"100%",height:"100%",p:.5,opacity:.85,display:"flex",justifyContent:"space-between",pointerEvents:"none"},children:[(0,z.tZ)(xe.Z,{size:"small",label:(0,z.tZ)("strong",{children:` +${p}`}),color:Ha.Z.levelVariant(p)}),i&&(0,z.tZ)(xe.Z,{size:"small",label:g?(0,z.tZ)(Ya,{characterKey:g&&c.chars.LocationToCharacterKey(g)}):(0,z.tZ)($a.Z,{}),color:"secondary",sx:{overflow:"visible",".MuiChip-label":{overflow:"visible"}}})]}),(0,z.tZ)(xe.Z,{size:"small",sx:{position:"absolute",bottom:0,mb:1,backgroundColor:b,p:1},icon:(0,z.tZ)(dt.Z,{placement:"top",title:(0,z.tZ)(Y.Z,{children:(0,z.tZ)(en,{statKey:m})}),disableInteractive:!0,children:(0,z.tZ)(h.Z,{lineHeight:0,children:(0,z.tZ)(Ce.C,{statKey:m,iconProps:{style:{padding:"4px"}}})})}),label:(0,z.tZ)(Y.Z,{sx:{mx:-.7},children:(0,z.tZ)(te.Z,{color:v!==p?"warning":void 0,children:(0,Wa.R1)(m,Z,v)})})})]}),(0,z.tZ)(h.Z,{display:"flex",flexDirection:"column",justifyContent:"space-between",sx:{p:1},children:f.map(((e,t)=>(0,z.tZ)(nn,{stat:e},t+e.key)))})]})})})}function nn({stat:e}){var t,a;if(!e.value)return null;const n=null!=(t=null==(a=e.rolls)?void 0:a.length)?t:0,i=`roll${(0,at.re)(n,1,6)}`,l=(0,at.bf)(e.key);return(0,z.tZ)(h.Z,{display:"flex",gap:1,alignContent:"center",children:(0,z.BX)(Y.Z,{sx:{flexGrow:1,display:"flex",gap:.5,alignItems:"center"},color:n?`${i}.main`:"error.main",component:"span",children:[(0,z.tZ)(dt.Z,{placement:"top",title:(0,z.tZ)(Y.Z,{children:e.key&&(0,z.tZ)(en,{statKey:e.key})}),disableInteractive:!0,children:(0,z.tZ)(h.Z,{lineHeight:0,children:(0,z.tZ)(Ce.C,{statKey:e.key,iconProps:{fontSize:"inherit"}})})}),(0,z.tZ)("span",{children:`${(0,Wa.Jj)(e.value,l)}${l}`})]})})}var ln=a(42906);function rn(){const{data:e}=(0,x.useContext)(K.R),t=(0,x.useMemo)((()=>(0,ie.U)(e).filter((([,e])=>Object.values(e).some((e=>!e.isEmpty))))),[e]);return(0,z.tZ)(h.Z,{sx:{mr:-1,mb:-1},children:(0,z.tZ)(ln.ZP,{columns:{xs:1,sm:2,md:3,xl:4},spacing:1,children:t.map((([e,t])=>(0,z.tZ)(sn,{displayNs:t,sectionKey:e},e)))})})}function sn({displayNs:e,sectionKey:t}){const a=(0,x.useContext)(gt),{data:n,oldData:i}=(0,x.useContext)(K.R),{database:l}=(0,x.useContext)(T.t),r=(0,x.useMemo)((()=>(0,ie.f)(n,t,l)),[l,n,t]),s=(0,x.useMemo)((()=>(0,at.Ay)(e,((e,a)=>(0,wt.UF)(["display",t,a])))),[e,t]);if(!r)return(0,z.tZ)(C.Z,{});const{title:c,icon:o,action:d}=r;return(0,z.BX)(C.Z,{children:[(0,z.tZ)(ee.Z,{avatar:o&&(0,z.tZ)(ae.Z,{size:2,src:o}),title:c,action:d&&(0,z.tZ)(X.Z,{children:d})}),(0,z.tZ)(q.Z,{}),(0,z.tZ)(Le.lD,{sx:{m:0},children:Object.entries(e).map((([e,n])=>(0,z.tZ)(Le.JW,{node:n,oldValue:i?i.get(s[e]).value:void 0,component:Ze.ZP,emphasize:JSON.stringify(a)===JSON.stringify([t,e])},e)))})]})}var cn=a(28582),on=a(51784),dn=a(30311),un=a(61340);function hn({weaponId:e,showLocation:t=!1,onClick:a,BGComponent:n=C.Z}){const{database:i}=(0,x.useContext)(T.t),l=(0,dn.Z)(e),r=(null==l?void 0:l.key)&&(0,cn.ub)(l.key),s=(0,x.useCallback)((e=>(0,z.tZ)(Va.Z,{sx:{height:"100%"},onClick:a,children:e})),[a]),c=(0,x.useMemo)((()=>r&&l&&(0,yt.mP)([r.data,(0,yt.v0)(l)])),[r,l]);if(!l||!r||!c)return(0,z.tZ)(n,{sx:{height:"100%"},children:(0,z.tZ)(Z.Z,{variant:"rectangular",sx:{width:"100%",height:"100%"}})});const{refinement:o,location:d}=l;return(0,z.tZ)(n,{sx:{height:"100%"},children:(0,z.tZ)(Ja.Z,{condition:!!a,wrapper:s,children:(0,z.BX)(h.Z,{display:"flex",height:"100%",alignItems:"stretch",children:[(0,z.BX)(h.Z,{className:`grad-${r.rarity}star`,sx:{height:"100%",position:"relative",flexGrow:1,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"flex-end"},children:[(0,z.tZ)(un.Z,{sheet:r,children:(0,z.tZ)(h.Z,{component:"img",src:(0,za.Aq)(l.key,l.ascension>=2),sx:{mx:-1,maxHeight:"100%",maxWidth:"100%"}})}),(0,z.BX)(h.Z,{sx:{position:"absolute",width:"100%",height:"100%",p:.5,opacity:.85,display:"flex",justifyContent:"space-between",pointerEvents:"none"},children:[(0,z.tZ)(xe.Z,{size:"small",label:(0,z.tZ)("strong",{children:on.Z.getLevelString(l)}),color:"primary"}),t&&(0,z.tZ)(xe.Z,{size:"small",label:d?(0,z.tZ)(Ya,{characterKey:i.chars.LocationToCharacterKey(d)}):(0,z.tZ)($a.Z,{}),color:"secondary",sx:{overflow:"visible",".MuiChip-label":{overflow:"visible"}}})]}),(0,z.tZ)(h.Z,{sx:{position:"absolute",width:"100%",height:"100%",p:.5,opacity:.85,display:"flex",justifyContent:"flex-end",alignItems:"flex-end"},children:r.hasRefinement&&(0,z.tZ)(xe.Z,{size:"small",color:"info",label:(0,z.BX)("strong",{children:["R",o]})})})]}),(0,z.BX)(h.Z,{display:"flex",flexDirection:"column",sx:{p:1},children:[(0,z.tZ)(Zn,{node:c.get(ye.qH.weapon.main)}),(0,z.tZ)(Zn,{node:c.get(ye.qH.weapon.sub)})]})]})})})}function Zn({node:e}){return e.info.name?(0,z.tZ)(h.Z,{display:"flex",gap:1,alignContent:"center",children:(0,z.BX)(Y.Z,{sx:{flexGrow:1,display:"flex",gap:1},component:"span",children:[(0,z.tZ)(dt.Z,{placement:"top",title:(0,z.tZ)(Y.Z,{children:e.info.name}),disableInteractive:!0,children:(0,z.tZ)("span",{children:e.info.icon})}),(0,z.tZ)("span",{children:(0,le.p)(e)})]})}):null}var pn=a(30706),mn=a(5051);function fn({artifacts:e,currentlyEquipped:t=!1}){const a=(0,x.useMemo)((()=>e.filter((e=>e)).reduce(((e,t)=>(e[t.setKey]?e[t.setKey].push(t.slotKey):e[t.setKey]=[t.slotKey],e)),{})),[e]);return(0,z.tZ)(z.HY,{children:Object.entries(a).sort((([e,t],[a,n])=>n.length-t.length)).map((([e,a])=>(0,z.tZ)(gn,{setKey:e,currentlyEquipped:t,slotarr:a},e)))})}function gn({setKey:e,currentlyEquipped:t=!1,slotarr:a}){var n;const i=(0,aa.Sk)(e),l=a.length,r=Object.keys(i.setEffects).map((e=>parseInt(e))).filter((e=>e<=l));return(0,z.tZ)(h.Z,{children:(0,z.tZ)(mn.Z,{artifactSheet:i,numInSet:l,children:(0,z.tZ)(X.Z,{sx:{height:"100%"},color:t?"success":"primary",children:(0,z.BX)(Y.Z,{children:[a.map((e=>(0,z.tZ)(Lt.Z,{slotKey:e,iconProps:pe.mX},e)))," ",null!=(n=i.name)?n:"",r.map(((e,t)=>(0,z.tZ)(X.Z,{sx:{ml:.5},color:"success",children:e},""+e+t)))]})})})})}let xn,vn,yn=e=>e;function bn({label:e,compareBuild:t,extraButtonsRight:a,extraButtonsLeft:i,disabled:l}){const{character:{key:r,equippedArtifacts:s}}=(0,x.useContext)(_.K),{buildSetting:{mainStatAssumptionLevel:c,allowLocationsState:o}}=Wt(r),{database:d}=(0,x.useContext)(T.t),u=(0,x.useContext)(K.R),{data:m,oldData:f}=u,[v,y]=(0,x.useState)(void 0),b=(0,x.useCallback)((()=>y(void 0)),[y]),C=(0,x.useCallback)((()=>{if(!window.confirm("Do you want to equip this build to this character?"))return;const e=d.chars.get(r);if(!e)return;n.Ex.forEach((t=>{var a;const i=null==(a=m.get(ye.ri.art[t].id).value)?void 0:a.toString();if(i)d.arts.set(i,{location:(0,n.V7)(r)});else{const a=e.equippedArtifacts[t];a&&d.arts.get(a)&&d.arts.set(a,{location:""})}}));const t=m.get(ye.ri.weapon.id).value;t&&d.weapons.set(t,{location:(0,n.V7)(r)})}),[r,m,d]),B=(0,x.useMemo)((()=>{const e=Object.assign({},u);return t||(e.oldData=void 0),e}),[u,t]),S=(0,x.useMemo)((()=>Object.fromEntries(n.Ex.map((e=>{var t;return[e,null==(t=m.get(ye.ri.art[e].id).value)?void 0:t.toString()]})))),[m]),k=(0,x.useMemo)((()=>S&&Object.values(S).map((e=>d.arts.get(e))).filter((e=>e))),[S,d.arts]),j=(0,x.useMemo)((()=>n.Ex.map((e=>(0,z.tZ)(ue.ZP,{item:!0,xs:1,children:(0,z.tZ)(an,{showLocation:!0,slotKey:e,artifactId:S[e],mainStatAssumptionLevel:c,onClick:()=>{const t=s[e],a=S[e];y({oldId:t!==a?t:void 0,newId:a})}})},e)))),[y,s,c,S]);if(!f)return null;const E=n.Ex.every((e=>{var t;return S[e]===(null==(t=f.get(ye.ri.art[e].id).value)?void 0:t.toString())}))&&m.get(ye.ri.weapon.id).value===f.get(ye.ri.weapon.id).value;return(0,z.tZ)(w.Z,{children:(0,z.BX)(x.Suspense,{fallback:(0,z.tZ)(Z.Z,{variant:"rectangular",width:"100%",height:600}),children:[v&&(0,z.tZ)(Cn,{newOld:v,mainStatAssumptionLevel:c,onClose:b,allowLocationsState:o}),(0,z.BX)(p.Z,{children:[(0,z.BX)(h.Z,{display:"flex",gap:1,sx:{pb:1},flexWrap:"wrap",children:[void 0!==e&&(0,z.tZ)(X.Z,{color:"info",children:(0,z.tZ)(Y.Z,{children:(0,z.BX)("strong",{children:[e,E?" (Equipped)":""]})})}),(0,z.tZ)(fn,{artifacts:k,currentlyEquipped:E}),(0,z.tZ)(h.Z,{sx:{flexGrow:1,display:"flex",justifyContent:"flex-end"}}),i,(0,z.tZ)(g.Z,{size:"small",color:"success",onClick:C,disabled:l||E,startIcon:(0,z.tZ)(La.Z,{}),children:"Equip Build"}),a]}),(0,z.BX)(ue.ZP,{container:!0,spacing:1,sx:{pb:1},columns:{xs:2,sm:3,md:4,lg:6},children:[(0,z.tZ)(ue.ZP,{item:!0,xs:1,children:(0,z.tZ)(hn,{showLocation:!0,weaponId:m.get(ye.ri.weapon.id).value})}),j]}),(0,z.tZ)(K.R.Provider,{value:B,children:(0,z.tZ)(rn,{})})]})]})})}function Cn({newOld:{newId:e,oldId:t},mainStatAssumptionLevel:a,onClose:i,allowLocationsState:l}){var r,s;const{database:c}=(0,x.useContext)(T.t),{character:{key:o}}=(0,x.useContext)(_.K),d=(0,x.useCallback)((()=>{window.confirm("Do you want to equip this artifact to this character?")&&(c.arts.set(e,{location:(0,n.V7)(o)}),i())}),[e,c,o,i]),u=null!=(r=null==(s=c.arts.get(e))?void 0:s.location)?r:"",Z=(0,Ua.Z)(e);return(0,z.tZ)(ne.Z,{open:!!e,onClose:i,containerProps:{maxWidth:t?"md":"xs"},children:(0,z.tZ)(C.Z,{children:(0,z.BX)(p.Z,{sx:{display:"flex",justifyContent:"center",alignItems:"stretch",gap:2},children:[t&&(0,z.tZ)(h.Z,{minWidth:320,children:(0,z.tZ)(pn.Z,{artifactId:t,mainStatAssumptionLevel:a,canEquip:!0,editorProps:{disableSet:!0,disableSlot:!0},extraButtons:(0,z.tZ)(wn,{id:t})})}),t&&(0,z.tZ)(h.Z,{display:"flex",flexGrow:1}),t&&(0,z.tZ)(h.Z,{display:"flex",alignItems:"center",justifyContent:"center",children:(0,z.tZ)(g.Z,{onClick:d,sx:{display:"flex"},children:(0,z.tZ)(Ra.Z,{sx:{fontSize:40}})})}),t&&(0,z.tZ)(h.Z,{display:"flex",flexGrow:1}),(0,z.BX)(h.Z,{minWidth:320,display:"flex",flexDirection:"column",gap:1,children:[(0,z.tZ)(pn.Z,{artifactId:e,mainStatAssumptionLevel:a,canEquip:!0,editorProps:{disableSet:!0,disableSlot:!0},extraButtons:(0,z.tZ)(wn,{id:e})}),u&&u!==(0,n.V7)(o)&&"all"!==l&&(0,z.tZ)(Bn,{locationKey:u}),Z&&vt.Uu.includes(Z.setKey)&&(0,z.tZ)(da,{setKey:Z.setKey})]})]})})})}function wn({id:e}){const{t}=(0,v.$G)("page_character_optimize"),{character:{key:a}}=(0,x.useContext)(_.K),{buildSetting:{artExclusion:n},buildSettingDispatch:i}=Wt(a),l=n.includes(e),r=(0,x.useCallback)((()=>i({artExclusion:(0,at.nh)(n,e)})),[e,n,i]);return(0,z.tZ)(dt.Z,{title:(0,z.BX)(h.Z,{children:[(0,z.tZ)(Y.Z,{children:t(xn||(xn=yn`excludeArt.excludeArtifactTip`))}),(0,z.tZ)(Y.Z,{children:(0,z.tZ)(te.Z,{color:l?"error":"success",children:t(l?"excludeArt.excluded":"excludeArt.included")})})]}),placement:"top",arrow:!0,children:(0,z.tZ)(g.Z,{onClick:r,color:l?"error":"success",size:"small",children:l?(0,z.tZ)(ea.Z,{}):(0,z.tZ)(Dt.Z,{})})})}function Bn({locationKey:e}){const{t}=(0,v.$G)("page_character_optimize"),{character:{key:a}}=(0,x.useContext)(_.K),{database:n}=(0,x.useContext)(T.t),i=(0,P.m)(n.chars.LocationToCharacterKey(e)),{buildSetting:{excludedLocations:l},buildSettingDispatch:r}=Wt(a),s=l.includes(e),c=(0,x.useCallback)((()=>r({excludedLocations:(0,at.nh)(l,e)})),[e,l,r]);return(0,z.tZ)(g.Z,{onClick:c,color:s?"secondary":"success",size:"small",startIcon:s?(0,z.tZ)(Ga.Z,{}):(0,z.tZ)(Na.Z,{}),children:(0,z.BX)("span",{children:[t(vn||(vn=yn`excludeChar.allowEquip`))," ",(0,z.tZ)("strong",{children:i.name})]})})}var Sn=a(68164),kn=a(66510),Xn=a(61660),_n=a(22443),Kn=a(55484),jn=a(25556),En=a(81224),On=a(3131),Pn=a(47857),Tn=a(55734),Mn=a(63004),An=a(36197);function Dn(e){const{database:t}=(0,x.useContext)(T.t),[a,n]=(0,x.useState)((()=>t.buildResult.get(e)));(0,x.useEffect)((()=>n(t.buildResult.get(e))),[t,e]),(0,x.useEffect)((()=>t.buildResult.follow(e,((e,t,a)=>"update"===t&&n(a)))),[e,n,t]);return{buildResult:a,buildResultDispatch:(0,x.useCallback)((a=>e&&t.buildResult.set(e,a)),[e,t])}}var In=a(6875);function Ln({cx:e,cy:t,payload:a,selectedPoint:n,radiusSelected:i=6,radiusUnselected:l=3,colorSelected:r="red",colorUnselected:s,shape:c="circle"}){if(!e||!t||!a)return null;const o=n&&n.x===a.x&&n.y===a.y;return(0,z.tZ)("g",{className:"custom-dot","data-chart-x":e,"data-chart-y":t,"data-x-value":a.x,"data-y-value":a.y,"data-radius":o?l:i,children:o?(0,z.BX)(z.HY,{children:[(0,z.tZ)(Rn,{id:"customShapeSelected",shape:c,cx:e,cy:t,r:i/2,fill:r}),(0,z.tZ)(Rn,{id:"customShapeBorder",shape:c,cx:e,cy:t,r:i,fill:"none",stroke:r})]}):(0,z.tZ)(Rn,{id:"customShapeUnselected",shape:c,cx:e,cy:t,r:l,fill:s})})}function Rn({shape:e,id:t,cx:a,cy:n,r:i,fill:l,stroke:r}){switch(e){case"circle":return(0,z.tZ)("circle",{id:t,cx:a,cy:n,r:i,fill:l,stroke:r});case"square":return(0,z.tZ)("rect",{id:t,x:a-i,y:n-i,width:2*i,height:2*i,fill:l,stroke:r});case"diamond":return(0,z.tZ)("polygon",{id:t,points:`${a},${n+2.5*i} ${a+1.5*i},${n} ${a},${n-2.5*i} ${a-1.5*i},${n}`,fill:l,stroke:r})}}var Nn=a(99118),Gn=a(45390);const zn=["xLabel","xUnit","yLabel","yUnit","selectedPoint","setSelectedPoint","addBuildToList"];function Wn(e){let{xLabel:t,xUnit:a,yLabel:i,yUnit:l,selectedPoint:r,setSelectedPoint:s,addBuildToList:c}=e,o=(0,we.Z)(e,zn);const{database:d}=(0,x.useContext)(T.t),{data:u}=(0,x.useContext)(K.R),{t:h}=(0,v.$G)("page_character_optimize"),m=(0,x.useMemo)((()=>r&&r.artifactIds&&Object.fromEntries(r.artifactIds.map((e=>{const t=d.arts.get(e);return[null==t?void 0:t.slotKey,t]})).filter((e=>e)))),[d.arts,r]),f=(0,x.useCallback)((e=>{e.target.id.includes("customShape")||e.target.id.includes("chartContainer")||s(void 0)}),[s]),y=m&&n.Ex.every((e=>{var t,a;return(null==(t=m[e])?void 0:t.id)===(null==(a=u.get(ye.qH.art[e].id).value)?void 0:a.toString())})),b=(0,x.useMemo)((()=>void 0!==(null==r?void 0:r.generBuildNumber)&&`#${null==r?void 0:r.generBuildNumber}`),[r]),w=(0,x.useMemo)((()=>void 0!==(null==r?void 0:r.graphBuildNumber)&&(0,z.BX)(v.cC,{t:h,i18nKey:"graphBuildLabel",count:null==r?void 0:r.graphBuildNumber,children:["Graph #",{count:(null==r?void 0:r.graphBuildNumber)+1}]})),[r,h]);return o.active&&r?(0,z.tZ)(Nn.Z,{onClickAway:f,children:(0,z.tZ)(C.Z,{sx:{minWidth:"400px",maxWidth:"400px"},onClick:e=>e.stopPropagation(),children:(0,z.tZ)(p.Z,{children:(0,z.BX)(de.Z,{gap:1,children:[(0,z.BX)(de.Z,{direction:"row",alignItems:"start",gap:1,children:[(0,z.BX)(de.Z,{spacing:.5,flexGrow:99,children:[y&&(0,z.tZ)(X.Z,{color:"info",children:(0,z.tZ)("strong",{children:h("currentlyEquippedBuild")})}),b&&(0,z.tZ)(X.Z,{color:"info",children:b}),w&&(0,z.tZ)(X.Z,{color:"info",children:w}),(0,z.tZ)(x.Suspense,{fallback:(0,z.tZ)(Z.Z,{width:300,height:50}),children:(0,z.tZ)(fn,{artifacts:Object.values(m),currentlyEquipped:y})})]}),(0,z.tZ)(ue.ZP,{item:!0,flexGrow:1}),(0,z.tZ)(B.Z,{onClick:()=>s(void 0)})]}),(0,z.tZ)(ue.ZP,{container:!0,direction:"row",spacing:.75,columns:5,children:n.Ex.map((e=>(0,z.tZ)(ue.ZP,{item:!0,xs:1,children:(0,z.tZ)(x.Suspense,{fallback:(0,z.tZ)(Z.Z,{width:75,height:75}),children:(0,z.tZ)(Gn.Z,{artifactObj:m[e],slotKey:e})})},e)))}),(0,z.BX)(Y.Z,{children:[(0,z.tZ)("strong",{children:t}),":"," ",(0,at.EC)("%"===a?r.x/100:r.x,a)]}),(0,z.BX)(Y.Z,{children:[(0,z.tZ)("strong",{children:i}),":"," ",(0,at.EC)("%"===l?r.y/100:r.y,l)]}),(0,z.tZ)(dt.Z,{title:r.highlighted?h("tcGraph.buildAlreadyInList"):"",placement:"top",children:(0,z.tZ)("span",{children:(0,z.tZ)(g.Z,{sx:{width:"100%"},disabled:void 0!==(null==r?void 0:r.graphBuildNumber),color:"info",onClick:()=>c(r.artifactIds),children:h("addBuildToList")})})})]})})})}):null}class $n{constructor(e,t,a){this.x=void 0,this.trueY=void 0,this.artifactIds=void 0,this.min=void 0,this.current=void 0,this.highlighted=void 0,this.generBuildNumber=void 0,this.graphBuildNumber=void 0,this.x=e,this.trueY=t,this.artifactIds=a}get y(){return this.trueY||this.current||this.highlighted}set y(e){this.trueY=e}}let Vn,Fn,qn,Hn,Un,Yn,Jn,Qn=e=>e;function ei({plotBase:e,setPlotBase:t,disabled:a=!1,showTooltip:l=!1}){const{t:r}=(0,v.$G)(["page_character_optimize","ui"]),{data:s}=(0,x.useContext)(K.R),{chartData:c}=(0,x.useContext)(E),[o,d]=(0,x.useState)(!1),[u,h]=(0,x.useState)(!0),{graphBuilds:Z}=(0,x.useContext)(E),{character:{key:m}}=(0,x.useContext)(_.K),{buildResult:{builds:f}}=Dn(m),[y,b]=(0,x.useState)(-1/0),[B,S]=(0,x.useState)(1/0),k=(0,x.useCallback)(((e,t)=>{if("number"==typeof t)throw new TypeError;const[a,n]=t;b(a),S(n)}),[b,S]);(0,x.useEffect)((()=>{b(-1/0),S(1/0)}),[c]);const{displayData:X,downloadData:j,sliderMin:O,sliderMax:P}=(0,x.useMemo)((()=>{var e,t;if(!c)return{displayData:null,downloadData:null};let a=1/0,i=-1/0;const l=n.Ex.map((e=>{var t;return null!=(t=null==s?void 0:s.get(ye.qH.art[e].id).value)?t:""})),r=c.data.map((({value:e,plot:t,artifactIds:n})=>{if(void 0===t)return null;t<a&&(a=t),t>i&&(i=t);const r=new $n(t,e,n),s=(0,at.K8)(n,(e=>!0));l.every((e=>s[e]))&&(r.current=e,r.y=void 0);const c=null==Z?void 0:Z.findIndex((e=>e.every((e=>s[e]))));void 0!==c&&-1!==c&&(void 0!==r.trueY&&(r.highlighted=e,r.y=void 0),r.graphBuildNumber=c+1);const o=f.findIndex((e=>e.every((e=>s[e]))));return-1!==o&&(void 0!==r.trueY&&(r.highlighted=e,r.y=void 0),r.generBuildNumber=o+1),r})).filter((e=>null!==e)).sort(((e,t)=>e.x-t.x)),o=[];for(const e of r){let t;for(;t=o.pop();)if(t.y>e.y){o.push(t);break}o.push(e)}(null==(e=o[0])?void 0:e.x)!==(null==(t=r[0])?void 0:t.x)&&(r[0].min=o[0].y),o.forEach((e=>{e.min=e.y}));const d={minimum:o.map((e=>[e.x,e.y])),allData:r.map((e=>[e.x,e.y]))};return{displayData:r.filter((e=>e&&e.x>=y&&e.x<=B)),downloadData:d,sliderMin:a,sliderMax:i}}),[c,f,s,Z,y,B]),T=e&&(0,at.Hm)(null==s?void 0:s.getDisplay(),e),M=r(e&&(!T||T.isEmpty)?"page_character_optimize:targetSelector.invalidTarget":"page_character_optimize:targetSelector.selectGraphTarget");return(0,z.BX)(w.Z,{children:[(0,z.tZ)(p.Z,{children:(0,z.BX)(ue.ZP,{container:!0,spacing:1,alignItems:"center",children:[(0,z.tZ)(ue.ZP,{item:!0,children:(0,z.tZ)(Y.Z,{children:r(Vn||(Vn=Qn`tcGraph.vs`))})}),(0,z.tZ)(ue.ZP,{item:!0,children:(0,z.tZ)(dt.Z,{placement:"top",title:l?r("page_character_optimize:selectTargetFirst"):"",children:(0,z.tZ)("span",{children:(0,z.tZ)(In.Z,{optimizationTarget:e,setTarget:e=>t(e),defaultText:M,disabled:a})})})}),(0,z.tZ)(ue.ZP,{item:!0,children:(0,z.tZ)(dt.Z,{title:e?r("ui:reset"):"",placement:"top",children:(0,z.tZ)("span",{children:(0,z.tZ)(g.Z,{color:"error",onClick:()=>t(void 0),disabled:!e||a,children:(0,z.tZ)(me.Z,{})})})})}),(0,z.tZ)(ue.ZP,{item:!0,flexGrow:1,children:(0,z.tZ)(Zt.Z,{placement:"top",title:r("page_character_optimize:tcGraph.desc")})}),!!j&&(0,z.tZ)(ue.ZP,{item:!0,children:(0,z.tZ)(g.Z,{size:"small",startIcon:u?(0,z.tZ)(fe.Z,{}):(0,z.tZ)(ge.Z,{}),color:u?"success":"secondary",onClick:()=>h(!u),children:r(Fn||(Fn=Qn`tcGraph.showStatThr`))})}),!!j&&(0,z.tZ)(ue.ZP,{item:!0,children:(0,z.tZ)(g.Z,{size:"small",color:"info",startIcon:(0,z.tZ)(Sn.Z,{}),onClick:()=>d(!o),children:r(qn||(qn=Qn`tcGraph.downloadData`))})})]})}),X&&X.length&&(0,z.tZ)(q.Z,{}),c&&X&&!!X.length&&(0,z.BX)(p.Z,{children:[(0,z.tZ)(ve.Z,{in:!!j&&o,children:(0,z.tZ)(C.Z,{sx:{mb:2},children:(0,z.BX)(p.Z,{children:[(0,z.tZ)(Y.Z,{children:"Min Data"}),(0,z.tZ)(i.TU,{value:JSON.stringify(null==j?void 0:j.minimum)}),(0,z.tZ)(Y.Z,{children:"All Data"}),(0,z.tZ)(i.TU,{value:JSON.stringify(null==j?void 0:j.allData)})]})})}),(0,z.tZ)(li,{displayData:X,plotNode:c.plotNode,valueNode:c.valueNode,showMin:u}),X.length>1&&(0,z.tZ)(kn.ZP,{marks:!0,value:[y,B],onChange:k,onChangeCommitted:k,min:O,max:P,step:(P-O)/20,valueLabelDisplay:"auto",valueLabelFormat:e=>{var t,a;return(0,at.EC)("%"===(null==(t=c.plotNode.info)?void 0:t.unit)?e/100:e,null==(a=c.plotNode.info)?void 0:a.unit)},sx:{ml:"6%",width:"93%"}})]})]})}const ti="#8884d8",ai="cyan",ni="#46a046",ii="#ff7300";function li({displayData:e,plotNode:t,valueNode:a,showMin:n}){var i,l,r,s;const{graphBuilds:c,setGraphBuilds:o}=(0,x.useContext)(E),{t:d}=(0,v.$G)("page_character_optimize"),[u,h]=(0,x.useState)(),Z=(0,x.useCallback)((e=>{o([...null!=c?c:[],e]),h(void 0)}),[o,c]),p=(0,x.useCallback)((t=>{t&&t.chartX&&t.chartY&&h(function(e,t,a,n){const i=Array.from(document.querySelectorAll(".custom-dot")).reduce(((a,n)=>{const{chartX:i,chartY:l}=a.dataset,r=Math.sqrt((e-i)**2+(t-l)**2),{chartX:s,chartY:c}=n.dataset;return r<=Math.sqrt((e-s)**2+(t-c)**2)?a:n})).dataset;return Math.sqrt((e-i.chartX)**2+(t-i.chartY)**2)<a?n.find((e=>e.x===+i.xValue&&e.y===+i.yValue)):void 0}(t.chartX,t.chartY,20,e))}),[h,e]),m=ri(t,d),f=ri(a,d);return(0,z.tZ)(Xn.h,{width:"100%",height:600,children:(0,z.BX)(_n.c,{id:"chartContainer",data:e,onClick:p,style:{cursor:"pointer"},children:[(0,z.tZ)(Kn.q,{strokeDasharray:"3 3"}),(0,z.tZ)(jn.K,{dataKey:"x",scale:"linear",unit:null==(i=t.info)?void 0:i.unit,domain:["auto","auto"],tick:{fill:"white"},type:"number",tickFormatter:e=>e>1e4?e.toFixed():e.toFixed(1),label:(0,z.tZ)(En._,{fill:"white",dy:10,children:m}),height:50}),(0,z.tZ)(On.B,{name:"DMG",domain:["auto","auto"],unit:null==(l=a.info)?void 0:l.unit,allowDecimals:!1,tick:{fill:"white"},type:"number",label:(0,z.tZ)(En._,{fill:"white",angle:-90,dx:-40,children:f}),width:100}),(0,z.tZ)(Pn.u,{content:(0,z.tZ)(Wn,{xLabel:m,xUnit:null==(r=t.info)?void 0:r.unit,yLabel:f,yUnit:null==(s=a.info)?void 0:s.unit,selectedPoint:u,setSelectedPoint:h,addBuildToList:Z}),trigger:"click",wrapperStyle:{pointerEvents:"auto",cursor:"auto"},cursor:!1}),(0,z.tZ)(Tn.D,{payload:[...n?[{id:"min",value:d(Hn||(Hn=Qn`tcGraph.statReqThr`)),type:"line",color:ii}]:[],{id:"trueY",value:d(Un||(Un=Qn`tcGraph.generatedBuilds`)),type:"circle",color:ti},{id:"highlighted",value:d(Yn||(Yn=Qn`tcGraph.highlightedBuilds`)),type:"square",color:ai},{id:"current",value:d(Jn||(Jn=Qn`tcGraph.currentBuild`)),type:"diamond",color:ni}]}),n&&(0,z.tZ)(Mn.x,{dataKey:"min",stroke:ii,type:"stepBefore",connectNulls:!0,strokeWidth:2,isAnimationActive:!1,dot:!1,activeDot:!1}),(0,z.tZ)(An.b,{dataKey:"trueY",isAnimationActive:!1,shape:(0,z.tZ)(Ln,{selectedPoint:u,colorUnselected:ti})}),(0,z.tZ)(An.b,{dataKey:"highlighted",isAnimationActive:!1,shape:(0,z.tZ)(Ln,{shape:"square",selectedPoint:u,colorUnselected:ai})}),(0,z.tZ)(An.b,{dataKey:"current",isAnimationActive:!1,shape:(0,z.tZ)(Ln,{shape:"diamond",selectedPoint:u,colorUnselected:ni})})]})})}function ri(e,t){var a,n,i,l,r,s,c;return"string"==typeof(null==(a=e.info)?void 0:a.name)?e.info.name:`${t(`${null==(n=e.info)||null==(i=n.name)?void 0:i.props.ns}:${null==(l=e.info)||null==(r=l.name)?void 0:r.props.key18}`)}${null!=(s=e.info)&&s.textSuffix?` ${null==(c=e.info)?void 0:c.textSuffix}`:""}`}var si=a(92760),ci=a(22537),oi=a(15015);let di,ui,hi,Zi,pi,mi=e=>e;function fi({disabled:e=!1,excludedTotal:t}){const{t:a}=(0,v.$G)("page_character_optimize"),{character:{key:n}}=(0,x.useContext)(_.K),{buildSetting:{artExclusion:l,useExcludedArts:r},buildSettingDispatch:s}=Wt(n),[c,o,d]=(0,i.aV)(!1),u=l.length,[Z,m,f]=(0,i.aV)(!1),y=(0,x.useCallback)((e=>{s({artExclusion:[...l,e],useExcludedArts:!1})}),[s,l]),b=(0,x.useCallback)((e=>{s({artExclusion:l.filter((t=>t!==e)),useExcludedArts:!1})}),[s,l]),S=(0,x.useCallback)((()=>s({useExcludedArts:!r})),[s,r]);return(0,z.BX)(z.HY,{children:[(0,z.tZ)(ne.Z,{open:c,onClose:d,containerProps:{maxWidth:"xl"},children:(0,z.BX)(C.Z,{children:[(0,z.tZ)(p.Z,{children:(0,z.BX)(h.Z,{display:"flex",gap:1,alignItems:"center",children:[(0,z.tZ)(Y.Z,{variant:"h6",children:a(di||(di=mi`excludeArt.title_exclude`))}),(0,z.tZ)(Zt.Z,{title:(0,z.tZ)(Y.Z,{children:a(ui||(ui=mi`excludeArt.title_tooltip`))})}),(0,z.tZ)(h.Z,{flexGrow:1}),(0,z.tZ)(B.Z,{onClick:d,size:"small"})]})}),(0,z.tZ)(q.Z,{}),(0,z.BX)(p.Z,{children:[(0,z.tZ)(vi,{show:Z,onClose:f,onSelect:y,artExclusion:l}),(0,z.tZ)(g.Z,{fullWidth:!0,onClick:m,color:"info",sx:{mb:1},startIcon:(0,z.tZ)(si.Z,{}),children:a(hi||(hi=mi`excludeArt.addExc`))}),!!u&&(0,z.tZ)(w.Z,{sx:{mb:1},children:(0,z.tZ)(Y.Z,{textAlign:"center",children:a(Zi||(Zi=mi`excludeArt.deSelectExc`))})}),(0,z.tZ)(ue.ZP,{container:!0,columns:{xs:3,md:5,lg:6,xl:8},spacing:1,children:l.map((e=>(0,z.tZ)(ue.ZP,{item:!0,xs:1,children:(0,z.tZ)(an,{artifactId:e,slotKey:"flower",BGComponent:w.Z,onClick:()=>b(e),showLocation:!0})},e)))})]})]})}),(0,z.BX)(_e.Z,{sx:{display:"flex",width:"100%"},children:[(0,z.tZ)(g.Z,{onClick:S,disabled:e||!u,startIcon:r?(0,z.tZ)(Ga.Z,{}):(0,z.tZ)(Na.Z,{}),color:r?"secondary":"success",sx:{flexGrow:1},children:(0,z.BX)(h.Z,{sx:{display:"flex",gap:1},children:[(0,z.tZ)(h.Z,{children:a("excludeArt.button_txt")}),(0,z.tZ)(X.Z,{sx:{whiteSpace:"normal"},color:u?r?"warning":"primary":"secondary",children:r?(0,z.BX)(v.cC,{t:a,i18nKey:"excludeArt.usingNum",children:["Using ",{totalStr:t}," excluded artifacts"]}):(0,z.BX)(v.cC,{t:a,i18nKey:"excludeArt.excNum",count:u,children:[{count:u}," artifacts are excluded"]})})]})}),(0,z.tZ)(g.Z,{color:"info",onClick:o,disabled:e,sx:{flexShrink:1},children:(0,z.tZ)(At.Z,{})})]})]})}const gi={xs:6,sm:6,md:9,lg:12,xl:12},xi=(e,t)=>Object.assign({},e,t);function vi({onSelect:e,show:t,onClose:a,artExclusion:n}){const{t:l}=(0,v.$G)("page_character_optimize"),{database:r}=(0,x.useContext)(T.t),s=(0,x.useCallback)((t=>{e(t),a()}),[e,a]),[c,o]=(0,x.useReducer)(xi,(0,oi.Af)()),[d,u]=(0,i.NW)();(0,x.useEffect)((()=>r.arts.followAny(u)),[r,u]);const m=(0,i.JT)(),f=(0,x.useMemo)((()=>(0,oi.EM)()),[]),g=(0,x.useMemo)((()=>{const e=(0,at.CZ)(c,f);return d&&r.arts.values.filter(e).map((e=>e.id)).filter((e=>!n.includes(e))).slice(0,gi[m])}),[d,r,f,c,m,n]);return(0,z.tZ)(ne.Z,{open:t,onClose:a,containerProps:{maxWidth:"xl"},children:(0,z.BX)(C.Z,{children:[(0,z.BX)(p.Z,{sx:{py:1,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,z.tZ)(Y.Z,{variant:"h6",children:l(pi||(pi=mi`excludeArt.selExc`))}),(0,z.tZ)(B.Z,{onClick:a})]}),(0,z.tZ)(q.Z,{}),(0,z.BX)(p.Z,{children:[(0,z.tZ)(x.Suspense,{fallback:(0,z.tZ)(Z.Z,{variant:"rectangular",width:"100%",height:200}),children:(0,z.tZ)(ci.default,{filterOption:c,filterOptionDispatch:o,filteredIds:g})}),(0,z.tZ)(h.Z,{mt:1,children:(0,z.tZ)(x.Suspense,{fallback:(0,z.tZ)(Z.Z,{variant:"rectangular",width:"100%",height:300}),children:(0,z.tZ)(ue.ZP,{container:!0,spacing:1,columns:{xs:2,md:3,lg:4},children:g.map((e=>(0,z.tZ)(ue.ZP,{item:!0,xs:1,children:(0,z.tZ)(pn.Z,{artifactId:e,onClick:s})},e)))})})})]})]})})}var yi=a(40067),bi=a(61851);const Ci=["sands","goblet","circlet"];function wi({disabled:e=!1,filteredArtIdMap:t}){const{t:a}=(0,v.$G)("artifact"),{character:{key:i}}=(0,x.useContext)(_.K),{buildSetting:{mainStatKeys:l},buildSettingDispatch:r}=Wt(i),{database:s}=(0,x.useContext)(T.t),{mainStatSlotTots:c,slotTots:o}=(0,x.useMemo)((()=>{const e={flowerMainStatTots:n.x1.flower.stats,plumeMainStatTots:n.x1.plume.stats,sandsMainStatTots:n.x1.sands.stats,gobletMainStatTots:n.x1.goblet.stats,circletMainStatTots:n.x1.circlet.stats,slotTots:Ci},a=(0,Mt.A)(e,(e=>Object.entries(s.arts.data).forEach((([a,n])=>{const{slotKey:i,mainStatKey:l}=n;Ci.includes(i)&&(e.slotTots[i].total++,t[a]&&e.slotTots[i].current++),e[`${i}MainStatTots`][l].total++,t[a]&&e[`${i}MainStatTots`][l].current++}))));return{mainStatSlotTots:{flower:a.flowerMainStatTots,plume:a.plumeMainStatTots,sands:a.sandsMainStatTots,goblet:a.gobletMainStatTots,circlet:a.circletMainStatTots},slotTots:a.slotTots}}),[s,t]);return(0,z.BX)(h.Z,{display:"flex",flexDirection:"column",children:[(0,z.tZ)(q.Z,{}),(0,z.BX)(h.Z,{display:"flex",children:[(0,z.tZ)(p.Z,{sx:{flexGrow:1},children:(0,z.BX)(h.Z,{sx:{display:"flex",gap:1,alignItems:"center"},children:[(0,z.tZ)(dt.Z,{placement:"top",title:(0,z.tZ)(Y.Z,{children:a("slotName.flower")}),children:(0,z.tZ)(yi.pv,{fontSize:"inherit"})}),(0,z.tZ)(h.Z,{flexGrow:1,children:(0,z.BX)(X.Z,{color:"info",children:[(0,z.tZ)(yi.If,Object.assign({},pe.mX))," ",c.flower.hp]})})]})}),(0,z.tZ)(q.Z,{orientation:"vertical",flexItem:!0}),(0,z.tZ)(p.Z,{sx:{flexGrow:1},children:(0,z.BX)(h.Z,{sx:{display:"flex",gap:1,alignItems:"center"},children:[(0,z.tZ)(dt.Z,{placement:"top",title:(0,z.tZ)(Y.Z,{children:a("slotName.plume")}),children:(0,z.tZ)(yi.QA,{fontSize:"inherit"})}),(0,z.tZ)(h.Z,{flexGrow:1,children:(0,z.BX)(X.Z,{color:"info",children:[(0,z.tZ)(yi._B,Object.assign({},pe.mX))," ",c.plume.atk]})})]})})]}),Ci.map((t=>{const i=l[t],s=n.x1[t].stats,d=(0,bi.X)([...s]);return(0,z.BX)(h.Z,{children:[(0,z.tZ)(q.Z,{}),(0,z.BX)(p.Z,{sx:{pt:1,pb:1},children:[(0,z.BX)(h.Z,{sx:{display:"flex",gap:1,alignItems:"center",pb:1},children:[(0,z.tZ)(dt.Z,{placement:"top",title:(0,z.tZ)(Y.Z,{children:a(`slotName.${t}`)}),children:(0,z.tZ)(h.Z,{lineHeight:0,children:(0,z.tZ)(Lt.Z,{slotKey:t,iconProps:{fontSize:"inherit"}})})}),(0,z.tZ)(h.Z,{flexGrow:1,children:(0,z.tZ)(X.Z,{color:"info",children:o[t]})})]}),(0,z.tZ)(ue.ZP,{container:!0,spacing:1,children:s.map(((a,s)=>{const o=n.fR.find((e=>a.includes(e))),u=i.includes(a)?null!=o?o:"success":"secondary";return(0,z.tZ)(ue.ZP,{item:!0,flexGrow:1,xs:s<3&&"goblet"!==t||"goblet"===t?4:void 0,children:(0,z.tZ)(dt.Z,{placement:"top",title:(0,z.tZ)(Y.Z,{children:(0,z.tZ)("strong",{children:(0,z.tZ)(en,{statKey:a})})}),disableInteractive:!0,children:(0,z.tZ)(g.Z,{fullWidth:!0,size:"small",color:u,sx:{height:"100%",pointerEvents:e?"none":void 0,cursor:e?"none":void 0},startIcon:(0,z.tZ)(Ce.C,{statKey:a}),onClick:()=>r({mainStatKeys:Object.assign({},l,{[t]:d(i,a)})}),children:c[t][a]})})},a)}))})]})]},t)}))]})}var Bi=a(11845);function Si({statFilters:e,setStatFilters:t,disabled:a=!1}){const n=(0,x.useCallback)(((a,n,i)=>{var l;const r=Object.assign({},e),s=JSON.stringify(n),c=n?[...e[s]]:void 0,o=JSON.stringify(a),d=[...null!=(l=e[o])?l:[]];void 0!==i&&c?d.push(c[i]):d.push({value:0,disabled:!1}),r[o]=d,void 0!==i&&c&&(c.splice(i,1),c.length?r[s]=c:delete r[s]),t(Object.assign({},r))}),[t,e]),i=(0,x.useCallback)(((a,n)=>{const i=Object.assign({},e),l=JSON.stringify(a),r=[...e[l]];r.splice(n,1),r.length?i[l]=r:delete i[l],t(Object.assign({},i))}),[t,e]),l=(0,x.useCallback)(((a,n,i)=>{const l=Object.assign({},e),r=JSON.stringify(a),s=[...e[r]];s[n]=Object.assign({},s[n],{value:i}),l[r]=s,t(Object.assign({},l))}),[t,e]),r=(0,x.useCallback)(((a,n,i)=>{const l=Object.assign({},e),r=JSON.stringify(a),s=[...e[r]];s[n]=Object.assign({},s[n],{disabled:i}),l[r]=s,t(Object.assign({},l))}),[t,e]);return(0,z.BX)(z.HY,{children:[Object.entries(e).flatMap((([e,t])=>null==t?void 0:t.map(((t,s)=>(0,z.tZ)(ki,{path:JSON.parse(e),setting:t,index:s,setTarget:n,delTarget:i,setValue:l,setDisabled:r,disabled:a},e+s))))),(0,z.tZ)(ki,{setTarget:n,delTarget:i,setValue:l,setDisabled:r,disabled:a})]})}function ki({path:e,setting:t,index:a,setTarget:n,delTarget:i,setValue:l,setDisabled:r,disabled:s}){var c;const{t:o}=(0,v.$G)("page_character_optimize"),{data:d}=(0,x.useContext)(K.R),u=(0,x.useCallback)((t=>e&&void 0!==a&&l(e,a,null!=t?t:0)),[l,e,a]),h={p:1,flexBasis:30,flexGrow:0,flexShrink:0},Z=(0,Bi.Hm)(d.getDisplay(),null!=e?e:[]),p="%"===(null==Z||null==(c=Z.info)?void 0:c.unit);return(0,z.BX)(_e.Z,{sx:{"& .MuiButtonGroup-grouped":{minWidth:24},width:"100%"},children:[!!t&&!!e&&void 0!==a&&(0,z.tZ)(g.Z,{sx:h,color:t.disabled?"secondary":"success",onClick:()=>r(e,a,!t.disabled),disabled:s,children:t.disabled?(0,z.tZ)(ge.Z,{}):(0,z.tZ)(fe.Z,{})}),(0,z.tZ)(In.Z,{showEmptyTargets:!0,optimizationTarget:e,setTarget:t=>n(t,e,a),defaultText:o("targetSelector.selectBuildTarget")}),(0,z.tZ)(Ke.CC,{sx:{flexBasis:150,flexGrow:1},children:(0,z.tZ)(Ke.ZP,{float:!0,disabled:!e||s,value:null==t?void 0:t.value,placeholder:"Stat Value",onChange:u,sx:{px:1},inputProps:{sx:{textAlign:"right"}},endAdornment:p?"%":void 0})}),!!e&&void 0!==a&&(0,z.tZ)(g.Z,{sx:h,color:"error",onClick:()=>i(e,a),disabled:s,children:(0,z.tZ)(it.Z,{fontSize:"small"})})]})}let Xi,_i,Ki=e=>e;function ji({disabled:e=!1}){const{t}=(0,v.$G)("page_character_optimize"),{character:{key:a}}=(0,x.useContext)(_.K),{buildSetting:{statFilters:n},buildSettingDispatch:i}=Wt(a),l=(0,x.useCallback)((e=>i({statFilters:e})),[i]);return(0,z.tZ)(h.Z,{children:(0,z.BX)(w.Z,{children:[(0,z.tZ)(p.Z,{sx:{display:"flex",gap:1,justifyContent:"space-between",flexDirection:"column"},children:(0,z.BX)(h.Z,{display:"flex",justifyContent:"space-between",children:[(0,z.tZ)(Y.Z,{sx:{fontWeight:"bold"},children:t(Xi||(Xi=Ki`constraintFilter.title`))}),(0,z.tZ)(Zt.Z,{title:(0,z.tZ)(Y.Z,{children:t(_i||(_i=Ki`constraintFilter.tooltip`))})})]})}),(0,z.tZ)(q.Z,{}),(0,z.tZ)(h.Z,{display:"flex",flexDirection:"column",gap:.5,children:(0,z.tZ)(Si,{statFilters:n,setStatFilters:l,disabled:e})})]})})}const Ei=(0,wt.yY)((0,Bi.I8)({dyn:Object.assign({},ye.qH.art,ye.qH.artSet)})),Oi={art:(0,at.K8)([...n.rW,...n._m],(e=>Ei.dyn[e])),artSet:(0,at.Ay)(ye.qH.artSet,((e,t)=>Ei.dyn[t]))};let Pi,Ti,Mi,Ai,Di,Ii,Li,Ri=e=>e;const Ni=new Audio("notification.mp3");function Gi(){var e,t;const{t:a}=(0,v.$G)("page_character_optimize"),{character:{key:l,compareData:r}}=(0,x.useContext)(_.K),{database:s}=(0,x.useContext)(T.t),{setChartData:o,graphBuilds:d,setGraphBuilds:u}=(0,x.useContext)(E),{gender:Z}=(0,D.Z)(),[m,f]=(0,x.useState)(!1),y=(0,x.useRef)(!1);(0,x.useEffect)((()=>{y.current=m}),[m]);const[b,C]=(0,x.useState)({type:"inactive",tested:0,failed:0,skipped:0,total:0}),B="inactive"!==b.type,[k,j]=(0,i.NW)(),[{threads:O=xt.g},P]=(0,x.useState)(s.displayOptimize.get());(0,x.useEffect)((()=>s.displayOptimize.follow(((e,t)=>P(t)))),[s,P]);const M=O>xt.g?xt.g:O,L=(0,x.useCallback)((e=>s.displayOptimize.set({threads:e})),[s]),R=(0,A.Z)(l),N=(0,G.Z)();(0,x.useEffect)((()=>{C({type:"inactive",tested:0,failed:0,skipped:0,total:0})}),[l]);const W=(0,x.useMemo)((()=>!s.arts.values.length),[s]),{buildSetting:$,buildSettingDispatch:V}=Wt(l),{plotBase:F,optimizationTarget:H,mainStatAssumptionLevel:U,allowPartial:J,maxBuildsToShow:Q,levelLow:ee,levelHigh:te}=$,{buildResult:{builds:ae,buildDate:ne},buildResultDispatch:ie}=Dn(l),le=(0,I.Z)(l,U),{characterSheet:re,target:se}=null!=(e=null==le?void 0:le[l])?e:{},ce=H&&(0,at.Hm)(null==se?void 0:se.getDisplay(),H),oe=["xs","sm"].includes((0,i.JT)());(0,x.useEffect)((()=>s.arts.followAny(j)),[j,s]);const de=(0,x.useDeferredValue)(k),he=(0,x.useDeferredValue)($),Ze=(0,x.useMemo)((()=>{const{mainStatKeys:e,excludedLocations:t,artExclusion:a,levelLow:i,levelHigh:r,allowLocationsState:c,useExcludedArts:o}=de&&he;return s.arts.values.filter((s=>{if(!o&&a.includes(s.id))return!1;if(s.level<i)return!1;if(s.level>r)return!1;const d=e[s.slotKey];if(null!=d&&d.length&&!d.includes(s.mainStatKey))return!1;const u=(0,n.V7)(l),h="unequippedOnly"===c&&s.location&&s.location!==u,Z="customList"===c&&s.location&&s.location!==u&&t.includes(s.location);return!h&&!Z}))}),[s,l,de,he]),pe=(0,x.useMemo)((()=>(0,at.K8)(Ze.map((({id:e})=>e)),(e=>!0))),[Ze]),{levelTotal:me,allowListTotal:xe,excludedTotal:ve}=(0,x.useMemo)((()=>(0,Mt.A)({levelTotal:["in"],allowListTotal:["in"],excludedTotal:["in"]},(e=>Object.entries(s.arts.data).forEach((([t,a])=>{const{level:i,location:r}=a,{levelLow:s,levelHigh:c,excludedLocations:o,allowLocationsState:d,artExclusion:u}=de&&he;i>=s&&i<=c&&(e.levelTotal.in.total++,pe[t]&&e.levelTotal.in.current++);const h=(0,n.V7)(l),Z="all"===d&&r&&r!==h,p="customList"===d&&r&&r!==h&&!o.includes(r);(Z||p)&&(e.allowListTotal.in.total++,pe[t]&&e.allowListTotal.in.current++),u.includes(t)&&(e.excludedTotal.in.total++,pe[t]&&e.excludedTotal.in.current++)}))))),[l,s.arts.data,de,he,pe]),ye=(0,x.useRef)(!0);(0,x.useEffect)((()=>{const e=()=>ye.current=!0,t=()=>ye.current=!1;return window.addEventListener("focus",e),window.addEventListener("blur",t),()=>{window.removeEventListener("focus",e),window.removeEventListener("blur",t)}}),[ye]);const be=(0,x.useRef)((()=>{}));(0,x.useEffect)((()=>()=>be.current()),[]);const Ce=function(){const[,e]=(0,x.useState)();return(0,x.useCallback)((t=>{e((()=>{throw t}))}),[])}(),we=(0,x.useCallback)((async()=>{var e,t,i;const{artSetExclusion:r,plotBase:c,statFilters:d,optimizationTarget:u,mainStatAssumptionLevel:h,allowPartial:p,maxBuildsToShow:m}=$;if(!l||!u)return;const f=function(e,t,a){const i={base:{},values:{flower:[],plume:[],goblet:[],circlet:[],sands:[]}},l=new Set;for(const a of e){const e=(0,Wa.Bv)(a.mainStatKey,a.rarity,Math.max(Math.min(t,n.F7[a.rarity]),a.level)),r={id:a.id,set:a.setKey,values:Object.assign({[a.setKey]:1,[a.mainStatKey]:a.mainStatKey.endsWith("_")?e/100:e},Object.fromEntries(a.substats.map((e=>[e.key,e.key.endsWith("_")?e.accurateValue/100:e.accurateValue]))))};delete r.values[""],i.values[a.slotKey].push(r),Object.keys(r.values).forEach((e=>l.add(e)))}if(i.base=(0,at.K8)([...l],(e=>0)),a)for(const e of Object.values(i.values))e.push({id:"",values:{}});return i}(Ze,h,p),g=(0,I.V)(s,l,h,[]);if(!g)return;const x=null==(e=(0,yt.Qo)(g.teamData,Z,l)[l])?void 0:e.target.data[0];if(!x)return;Object.assign(x,(0,yt.b3)([x,Oi]));const v=(0,at.Hm)(null!=(t=x.display)?t:{},u);if(!v)return;const b=v,w=Object.entries(d).flatMap((([e,t])=>t.filter((e=>!e.disabled)).map((t=>{var a,n;const i=(0,at.Hm)(null!=(a=x.display)?a:{},JSON.parse(e));return{value:i,minimum:"%"===(null==(n=i.info)?void 0:n.unit)?t.value/100:t.value}})))).filter((e=>e.value&&e.minimum>-1/0));o(void 0);const B=new Promise((e=>be.current=e)),S=[...w.map((e=>e.value)),v],k=[...w.map((e=>e.minimum)),-1/0],X=c&&(0,at.Hm)(null!=(i=x.display)?i:{},c);X&&(S.push(X),k.push(-1/0));const _=(0,bt.tL)(S,x,(({path:[e]})=>"dyn"!==e)),K=X?_.pop():void 0,j={arts:f,optimizationTarget:_.pop(),exclusion:r,constraints:_.map(((e,t)=>({value:e,min:k[t]}))),topN:m,plotBase:K},E={tested:0,failed:0,skipped:0,total:0,startTime:performance.now()},O=setInterval((()=>C(Object.assign({type:"active"},E))),100),P=new Error;try{const e=new Tt(j,E,M);B.then((()=>e.cancel(P)));const t=await e.solve();if(e.cancel(),be.current=()=>{},X){var T,A;const e=function(e){let t=.01,a=new Set(e.flatMap((e=>Object.values(e).map((e=>Math.round(e.plot/t))))));for(;a.size>1500;)t*=2,a=new Set([...a].map((e=>Math.round(e/2))));const n={};for(const a of e)for(const e of Object.values(a)){const a=Math.round(e.plot/t)*t;(!n[a]||n[a].value<e.value)&&(n[a]=e)}return n}(t.map((e=>e.plotData)));let a=Object.values(e);"%"===(null==(T=b.info)?void 0:T.unit)&&(a=a.map((({value:e,plot:t,artifactIds:a})=>({value:100*e,plot:t,artifactIds:a})))),"%"===(null==(A=X.info)?void 0:A.unit)&&(a=a.map((({value:e,plot:t,artifactIds:a})=>({value:e,plot:100*(null!=t?t:0),artifactIds:a})))),o({valueNode:b,plotNode:X,data:a})}const n=function(e,t){return e.flatMap((e=>e)).sort(((e,t)=>t.value-e.value)).slice(0,t)}(t.map((e=>e.builds)),m);0,ie({builds:n.map((e=>e.artifactIds)),buildDate:Date.now()}),setTimeout((()=>{t&&y.current&&(Ni.play(),ye.current||setTimeout((()=>window.alert(a(Pi||(Pi=Ri`buildCompleted`)))),1))}),100)}catch(e){e!==P&&(console.log("Failed to load worker"),console.log(e),e instanceof Error&&Ce(e)),be.current(),E.tested=0,E.failed=0,E.skipped=0,E.total=0}finally{clearInterval(O),C(Object.assign({type:"inactive"},E,{finishTime:performance.now()}))}}),[$,l,Ze,s,Z,o,M,ie,a,Ce]),Be=null!=(t=null==re?void 0:re.name)?t:"Character Name",Se=(0,x.useCallback)((e=>{V({plotBase:e}),o(void 0)}),[V,o]),ke=(0,x.useMemo)((()=>se&&le&&{data:se,teamData:le}),[se,le]),Xe=(0,z.tZ)(In.Z,{optimizationTarget:H,setTarget:e=>V({optimizationTarget:e}),disabled:!!B}),Ke=(0,x.useCallback)((e=>(0,z.BX)(v.cC,{t:a,i18nKey:"graphBuildLabel",count:e+1,children:["Graph #",{count:e+1}]})),[a]),je=(0,x.useCallback)((e=>`#${e+1}`),[]);return(0,z.BX)(h.Z,{display:"flex",flexDirection:"column",gap:1,children:[W&&(0,z.tZ)(mt,{}),ke&&(0,z.BX)(K.R.Provider,{value:ke,children:[(0,z.BX)(ue.ZP,{container:!0,spacing:1,children:[(0,z.BX)(ue.ZP,{item:!0,xs:12,sm:6,lg:3,display:"flex",flexDirection:"column",gap:1,children:[(0,z.tZ)(h.Z,{children:(0,z.tZ)(ut.Z,{characterKey:l,onClickTeammate:N})}),(0,z.tZ)(Ta,{})]}),(0,z.BX)(ue.ZP,{item:!0,xs:12,sm:6,lg:4,display:"flex",flexDirection:"column",gap:1,children:[(0,z.BX)(w.Z,{children:[(0,z.BX)(p.Z,{sx:{display:"flex",gap:1},children:[(0,z.tZ)(Y.Z,{sx:{fontWeight:"bold"},children:a(Ti||(Ti=Ri`levelFilter`))}),(0,z.tZ)(X.Z,{color:"info",children:me.in})]}),(0,z.tZ)(q.Z,{}),(0,z.tZ)(p.Z,{children:(0,z.tZ)(ot.Z,{levelLow:ee,levelHigh:te,setLow:e=>V({levelLow:e}),setHigh:e=>V({levelHigh:e}),setBoth:(e,t)=>V({levelLow:e,levelHigh:t}),disabled:B})})]}),(0,z.BX)(w.Z,{children:[(0,z.tZ)(p.Z,{children:(0,z.tZ)(Y.Z,{sx:{fontWeight:"bold"},children:a(Mi||(Mi=Ri`mainStat.title`))})}),(0,z.tZ)(q.Z,{}),(0,z.tZ)(p.Z,{children:(0,z.BX)(h.Z,{display:"flex",alignItems:"center",gap:1,children:[(0,z.tZ)(Ea,{mainStatAssumptionLevel:U,setmainStatAssumptionLevel:e=>V({mainStatAssumptionLevel:e}),disabled:B}),(0,z.tZ)(Zt.Z,{title:(0,z.BX)(h.Z,{children:[(0,z.tZ)(Y.Z,{variant:"h6",children:a(Ai||(Ai=Ri`mainStat.levelAssTooltip.title`))}),(0,z.tZ)(Y.Z,{children:a(Di||(Di=Ri`mainStat.levelAssTooltip.desc`))})]})})]})}),(0,z.tZ)(wi,{disabled:B,filteredArtIdMap:pe})]})]}),(0,z.BX)(ue.ZP,{item:!0,xs:12,sm:6,lg:5,display:"flex",flexDirection:"column",gap:1,children:[(0,z.tZ)(ka,{disabled:B}),(0,z.tZ)(fi,{disabled:B,excludedTotal:ve.in}),(0,z.tZ)(g.Z,{fullWidth:!0,startIcon:J?(0,z.tZ)(fe.Z,{}):(0,z.tZ)(ge.Z,{}),color:J?"success":"secondary",onClick:()=>V({allowPartial:!J}),disabled:B,children:a(Ii||(Ii=Ri`allowPartial`))}),(0,z.tZ)(Yt,{disabled:B,allowListTotal:xe.in}),(0,z.tZ)(ji,{disabled:B})]})]}),oe&&Xe,(0,z.BX)(_e.Z,{children:[!oe&&Xe,(0,z.BX)(ht.Z,{disabled:B||!l,title:(0,z.BX)(v.cC,{t:a,i18nKey:"build",count:Q,children:[{count:Q}," Builds"]}),children:[(0,z.tZ)(st.Z,{children:(0,z.tZ)(Y.Z,{variant:"caption",color:"info.main",children:a("buildDropdownDesc")})}),(0,z.tZ)(q.Z,{}),vt.sY.map((e=>(0,z.tZ)(st.Z,{onClick:()=>V({maxBuildsToShow:e}),children:(0,z.BX)(v.cC,{t:a,i18nKey:"build",count:e,children:[{count:e}," Builds"]})},e)))]}),(0,z.BX)(ht.Z,{disabled:B||!l,sx:{borderRadius:"4px 0px 0px 4px"},title:(0,z.BX)(v.cC,{t:a,i18nKey:"thread",count:M,children:[{count:M}," Threads"]}),children:[(0,z.tZ)(st.Z,{children:(0,z.tZ)(Y.Z,{variant:"caption",color:"info.main",children:a("threadDropdownDesc")})}),(0,z.tZ)(q.Z,{}),(0,at.w6)(1,xt.g).reverse().map((e=>(0,z.tZ)(st.Z,{onClick:()=>L(e),children:(0,z.BX)(v.cC,{t:a,i18nKey:"thread",count:e,children:[{count:e}," Threads"]})},e)))]}),(0,z.tZ)(dt.Z,{placement:"top",title:a(Li||(Li=Ri`notifyTooltip`)),children:(0,z.tZ)(g.Z,{sx:{borderRadius:0},color:"warning",onClick:()=>f((e=>!e)),children:m?(0,z.tZ)(lt.Z,{}):(0,z.tZ)(rt.Z,{})})}),(0,z.tZ)(dt.Z,{placement:"top",title:H?"":a("selectTargetFirst"),children:(0,z.tZ)("span",{children:(0,z.tZ)(g.Z,{disabled:!l||!H||!ce||ce.isEmpty,color:B?"error":"success",onClick:B?()=>be.current():we,startIcon:B?(0,z.tZ)(nt.Z,{}):(0,z.tZ)(c.Z,{}),sx:{borderRadius:"0px 4px 4px 0px"},children:a(B?"generateButton.cancel":"generateButton.generateBuilds")})})})]}),!!l&&(0,z.tZ)(Ia,{status:b,characterName:Be,maxBuildsToShow:Q}),(0,z.tZ)(h.Z,{children:(0,z.tZ)(ei,{disabled:B||!H,plotBase:F,setPlotBase:Se,showTooltip:!H})}),(0,z.tZ)(w.Z,{children:(0,z.BX)(p.Z,{children:[(0,z.BX)(h.Z,{display:"flex",alignItems:"center",gap:1,mb:1,children:[(0,z.tZ)(Y.Z,{sx:{flexGrow:1},children:ae?(0,z.BX)("span",{children:["Showing"," ",(0,z.tZ)("strong",{children:ae.length+(d?d.length:0)})," ","build generated for ",Be,"."," ",!!ne&&(0,z.BX)("span",{children:["Build generated on:"," ",(0,z.tZ)("strong",{children:new Date(ne).toLocaleString()})]})]}):(0,z.tZ)("span",{children:"Select a character to generate builds."})}),(0,z.tZ)(g.Z,{disabled:!ae.length,color:"error",onClick:()=>{u(void 0),ie({builds:[],buildDate:0})},children:"Clear Builds"})]}),(0,z.BX)(ue.ZP,{container:!0,display:"flex",spacing:1,children:[(0,z.tZ)(ue.ZP,{item:!0,children:(0,z.tZ)(S.Hn,{size:"small"})}),(0,z.tZ)(ue.ZP,{item:!0,children:(0,z.tZ)(S.oX,{size:"small"})}),(0,z.tZ)(ue.ZP,{item:!0,flexGrow:1}),(0,z.tZ)(ue.ZP,{item:!0,children:(0,z.BX)(ft.Z,{exclusive:!0,value:r,onChange:(e,t)=>R({compareData:t}),size:"small",children:[(0,z.tZ)(ct.Z,{value:!1,disabled:!r,children:"Show new builds"}),(0,z.tZ)(ct.Z,{value:!0,disabled:r,children:"Compare vs. equipped"})]})})]})]})}),(0,z.BX)(gt.Provider,{value:H,children:[d&&(0,z.tZ)(zi,{builds:d,characterKey:l,data:se,compareData:r,disabled:!!B,getLabel:Ke,setBuilds:u}),(0,z.tZ)(zi,{builds:ae,characterKey:l,data:se,compareData:r,disabled:!!B,getLabel:je})]})]})]})}function zi({builds:e,setBuilds:t,characterKey:a,data:n,compareData:i,disabled:l,getLabel:r}){const s=(0,x.useCallback)((a=>{if(t){const n=[...e];n.splice(a,1),t(n)}}),[e,t]);return(0,x.useMemo)((()=>(0,z.tZ)(x.Suspense,{fallback:(0,z.tZ)(Z.Z,{variant:"rectangular",width:"100%",height:600}),children:null==e?void 0:e.map(((e,c)=>a&&n&&(0,z.tZ)($i,{characterKey:a,build:e,oldData:n,children:(0,z.tZ)(Wi,{index:c,label:r(c),build:e,compareData:i,disabled:l,deleteBuild:t?s:void 0})},c+e.join())))})),[e,a,n,i,l,r,s,t])}function Wi({index:e,label:t,build:a,compareData:n,disabled:i,deleteBuild:l}){const{t:r}=(0,v.$G)("page_character_optimize"),s=(0,y.TH)(),c=(0,y.s0)(),d=(0,x.useCallback)((()=>{const e=s.pathname.split("/");e.pop(),c(`${e.join("/")}/theorycraft`,{state:{build:a}})}),[c,a,s.pathname]);return(0,z.tZ)(bn,{label:t,compareBuild:n,disabled:i,extraButtonsLeft:(0,z.BX)(z.HY,{children:[(0,z.tZ)(g.Z,{color:"info",size:"small",startIcon:(0,z.tZ)(o.Z,{}),onClick:d,children:r("theorycraftButton")}),l&&(0,z.tZ)(g.Z,{color:"error",size:"small",startIcon:(0,z.tZ)(it.Z,{}),onClick:()=>l(e),children:r("removeBuildButton")})]})})}function $i({children:e,characterKey:t,build:a,oldData:n}){const{database:l}=(0,x.useContext)(T.t),{buildSetting:{mainStatAssumptionLevel:r}}=Wt(t),[s,c]=(0,i.NW)();(0,x.useEffect)((()=>l.arts.followAny((e=>a.includes(e)&&c()))),[l,a,c]);const o=(0,x.useMemo)((()=>s&&a.map((e=>l.arts.get(e))).filter((e=>e))),[s,a,l]),d=(0,I.Z)(t,r,o),u=(0,x.useMemo)((()=>{const e=null==d?void 0:d[t];if(e)return{data:e.target,teamData:d,oldData:n}}),[d,n,t]);return u?(0,z.tZ)(K.R.Provider,{value:u,children:e}):null}var Vi=a(1856),Fi=a(5896),qi=a(81073),Hi=a(30840),Ui=a(15045);const Yi=[[1],[1,1,1,1],[1,2,3,4,3,2,1],[1,3,6,10,12,12,10,6,3,1],[1,4,10,20,31,40,44,40,31,20,10,4,1],[1,5,15,35,65,101,135,155,155,135,101,65,35,15,5,1]];function Ji(e,t){for(var a;e>=Yi.length;){const e=Yi.length,t=[];for(let a=0,s=e-1;a<=3*e;a++){var n,i,l,r;const e=null!=(n=Yi[s][a-3])?n:0,c=null!=(i=Yi[s][a-2])?i:0,o=null!=(l=Yi[s][a-1])?l:0,d=null!=(r=Yi[s][a])?r:0;t[a]=e+c+o+d}Yi.push(t)}return null!=(a=Yi[e][t])?a:0}function Qi(e){let t=1;e<0&&(t=-1);const a=1/(1+.3275911*(e=Math.abs(e)));return t*(1-((((1.061405429*a-1.453152027)*a+1.421413741)*a-.284496736)*a+.254829592)*a*Math.exp(-e*e))}const el=[270/1024,80/1024,0,12/256,8/256,120/1024,0,60/1024,4/256,60/1024,4/256,30/1024,24/256,.15625,1/64,1/64,24/256,1/64,12/256,0,6/256,2/16,6/256,0,81/256,.0625,0,27/64,12/64,0,1/16,1/16,12/64,1/16,6/64,3/4,.5,243/1024,.03125,0,108/256,.125,0,9/64,6/64,.1875,0,24/256,3/64,5/1024,3/64,5/1024,0,405/1024,80/1024,0,54/256,90/1024,40/1024,0,1/256,1/256,40/1024,1/256,20/1024,9/16,.25,0,1/4,1/4,0,1/4,27/64,8/64,0,6/16,.25,10/1024,0,10/1024,2/16,0,0,0,15/1024,10/1024,1/1024,1/1024,0,1/1024],tl=[35,64,70,21,33,45,12,0,53,76,48,86];function al(e,t){const a=e.reduce(((e,t)=>e+t));if(e.length>4||a>t)return 0;if(4===e.length&&a!==t)return 0;3===e.length&&(e=[...e,t-a]),e.sort().reverse();let n=13*t+e.length-14+16*e[0];e.length>1&&(n+=4*e[1]);const i=n%12,l=Math.trunc(n/12);return el[i+tl[l]]}function nl(e,t){if(0!==e)for(let a=e;a>=0;a--)for(let n=e-a;n>=0;n--)for(let i=e-a-n;i>=0;i--){const l=e-a-n-i;t([a,n,i,l],al([a,n,i,l],e))}else t([0,0,0,0],1)}function il(e,t,a){let n=!0;return(0,Ct.aD)([e],(e=>{}),(e=>{const{operation:i}=e;if("read"===i){if("number"!==e.type||e.accu&&"add"!==e.accu)throw new Error(`Unsupported [${i}] node in zero_deriv`);t(e)===a&&(n=!1)}})),n}function ll(e,t,a){const{operation:n}=e;switch(n){case"read":if("number"!==e.type||e.accu&&"add"!==e.accu)throw new Error(`Unsupported [${n}] node in d/dx`);return t(e)===a?(0,wt.a9)(1):(0,wt.a9)(0);case"const":return(0,wt.a9)(0);case"res":if(!il(e,t,a))throw new Error(`[${n}] node takes only constant inputs. ${e}`);return(0,wt.a9)(0);case"add":return(0,wt.Sm)(...e.operands.map((e=>ll(e,t,a))));case"mul":{const n=e.operands.map(((n,i)=>(0,wt.WV)(ll(n,t,a),...e.operands.filter(((e,t)=>t!==i)))));return(0,wt.Sm)(...n)}case"sum_frac":{const n=e.operands[0],i=ll(n,t,a),l=(0,wt.Sm)(...e.operands.slice(1)),r=ll(l,t,a),s=(0,wt.WV)((0,wt.Sm)(...e.operands),(0,wt.Sm)(...e.operands)),c=(0,wt.Sm)((0,wt.WV)(l,i),(0,wt.WV)(-1,n,r));return(0,wt.F9)(c,(0,wt.Sm)((0,wt.WV)(-1,c),s))}case"min":case"max":if(1===e.operands.length)return ll(e.operands[0],t,a);if(2===e.operands.length){const[i,l]=e.operands;if("min"===n)return(0,wt.Lj)(i,l,ll(l,t,a),ll(i,t,a));if("max"===n)return(0,wt.Lj)(i,l,ll(i,t,a),ll(l,t,a));(0,Bi.UT)(n);break}if("min"===n)return ll((0,wt.VV)(e.operands[0],(0,wt.VV)(...e.operands.slice(1))),t,a);if("max"===n)return ll((0,wt.Fp)(e.operands[0],(0,wt.Fp)(...e.operands.slice(1))),t,a);(0,Bi.UT)(n);break;case"threshold":{const[i,l,r,s]=e.operands;if(!il(i,t,a)||!il(l,t,a))throw new Error(`[${n}] node must branch on constant inputs. ${e}`);return(0,wt.Lj)(i,l,ll(r,t,a),ll(s,t,a))}default:(0,Bi.UT)(n)}}function rl(e,t,a){if(t<1e-5)return e>a?{p:1,upAvg:e-a}:{p:0,upAvg:0};const n=(a-e)/Math.sqrt(t),i=(1-Qi(n/Math.sqrt(2)))/2,l=function(e,t,a){return void 0===t&&(t=0),void 0===a&&(a=1),a<=0?0:Math.exp(-(t-e)*(t-e)/a/2)/Math.sqrt(2*Math.PI*a)}(n),r=1/(n*n),s=n<5?l/i-n:(1-2*r*(1-r*(5+37*r)))/n;return{p:i,upAvg:Math.sqrt(t)*s}}const sl=8.5,cl=18.375,ol=4.515625;let dl;!function(e){e[e.Fast=0]="Fast",e[e.Slow=1]="Slow",e[e.Exact=2]="Exact"}(dl||(dl={}));const ul={hp:6,atk:6,def:6,hp_:4,atk_:4,def_:4,eleMas:4,enerRech_:4,critRate_:3,critDMG_:3};function hl(e,t=5){return Zl(e,(0,Wa.U9)(e,t)/10)}function Zl(e,t){return e.endsWith("_")?t/100:t}class pl{constructor(e,t,a){this.baseBuild=void 0,this.nodes=void 0,this.thresholds=void 0,this.calc4th=!1,this.skippableDerivatives=void 0,this.eval=void 0,this.artifacts=[],this.fixedIx=0,this.baseBuild=a,this.nodes=e,this.thresholds=t;const i=[];e.forEach((e=>{i.push(e,...n._m.map((t=>ll(e,(e=>e.path[1]),t))))}));const l=(0,bt.tL)(i,{},(({path:[e]})=>"dyn"!==e)),r=(0,bt.I3)(l,{},(e=>e.path[1]),5);t[0]=r(Object.values(a))[0],this.skippableDerivatives=n._m.map((t=>e.every((e=>il(e,(e=>e.path[1]),t))))),this.eval=(t,i)=>{const l=Object.assign({},a,{[i]:{id:"",values:t}}),s=r(Object.values(l));return e.map(((e,t)=>{const a=t*(1+n._m.length);return{v:s[a],grads:n._m.map(((e,t)=>s[a+1+t]))}}))}}addArtifact(e){const t=n.F7[e.rarity],a=(0,Wa.Bv)(e.mainStatKey,e.rarity,t);this.artifacts.push({id:e.id,rollsLeft:(0,Wa.NB)(e.level,e.rarity),slotKey:e.slotKey,mainStat:e.mainStatKey,subs:e.substats.map((({key:e})=>e)).filter((e=>""!==e)),values:Object.assign({[e.setKey]:1,[e.mainStatKey]:Zl(e.mainStatKey,a)},Object.fromEntries(e.substats.filter((({key:e})=>""!==e)).map((e=>[e.key,Zl(e.key,e.accurateValue)]))))})}calcFastAll(){function e(e){return e.result.p*e.result.upAvg}this.artifacts.forEach(((e,t)=>this.calcFast(t,this.calc4th))),this.artifacts.sort(((t,a)=>e(a)-e(t))),this.fixedIx=0}calcSlowToIndex(e,t=5){const a=this.artifacts.slice(0,this.fixedIx),n=this.artifacts.slice(this.fixedIx);function i(e){return e.result.p*e.result.upAvg}function l(e,t){if(i(e)>1e-5||i(t)>1e-5)return i(t)-i(e);const a=e.result.distr.gmm.reduce(((e,{phi:t,mu:a})=>e+t*a),0);return t.result.distr.gmm.reduce(((e,{phi:t,mu:a})=>e+t*a),0)-a}let r=0;const s=Math.min(e-this.fixedIx+t,n.length);do{for(;r<s;r++)this.calcSlow(this.fixedIx+r,this.calc4th);for(n.sort(l),this.artifacts=[...a,...n],r=0;r<s&&n[r].result.evalMode!==dl.Fast;r++);}while(r<s)}toResult1(e){let t=0,a=0;const n=e.map((({prob:e,mu:n,cov:i})=>{const l=n.map(((e,t)=>rl(e,i[t],this.thresholds[t]))),r=Math.min(...l.map((({p:e})=>e))),s=Math.min(...l.slice(1).map((({p:e})=>e)));return t+=r*e,a+=r*e*l[0].upAvg,{phi:e,cp:s,mu:n[0],sig2:i[0]}})),i=n.map((({mu:e,sig2:t})=>e-4*Math.sqrt(t))),l=n.map((({mu:e,sig2:t})=>e+4*Math.sqrt(t)));return{p:t,upAvg:t<1e-6?0:a/t,distr:{gmm:n,lower:Math.min(...i),upper:Math.max(...l)},evalMode:dl.Fast}}calcFast(e,t=!0){4===this.artifacts[e].subs.length&&(t=!1),t?this._calcFast4th(e):this._calcFast(e)}_calcFast(e){const{subs:t,slotKey:a,rollsLeft:i}=this.artifacts[e],l=i-(t.length<4?1:0),r=Object.assign({},this.artifacts[e].values);t.forEach((e=>{r[e]+=sl*(l/4)*hl(e)}));const s=this.eval(r,a).map((({v:e,grads:a})=>{const i=t.map((e=>a[n._m.indexOf(e)]*hl(e))),r=i.reduce(((e,t)=>e+t),0),s=i.reduce(((e,t)=>e+t*t),0);return{mu:e,sig2:(cl*s-ol*r**2)*l}}));this.artifacts[e].result=this.toResult1([{prob:1,mu:s.map((({mu:e})=>e)),cov:s.map((({sig2:e})=>e))}])}_calcFast4th(e){const{mainStat:t,subs:a,slotKey:i,rollsLeft:l}=this.artifacts[e],r=l-1,s=n._m.filter((e=>!a.includes(e)&&e!==t)),c=s.reduce(((e,t)=>e+ul[t]),0),o=s.map((t=>{var l;const s=ul[t]/c,o=Object.assign({},this.artifacts[e].values);a.forEach((e=>{o[e]+=sl*(r/4)*hl(e)})),o[t]=(null!=(l=o[t])?l:0)+sl*(r/4+1)*hl(t);const d=this.eval(o,i).map((({v:e,grads:i})=>{const l=a.map((e=>i[n._m.indexOf(e)]*hl(e))),s=i[n._m.indexOf(t)]*hl(t),c=l.reduce(((e,t)=>e+t),s),o=l.reduce(((e,t)=>e+t*t),s*s);return{mu:e,sig2:(cl*o-ol*c**2)*r+1.25*s*s}}));return{prob:s,mu:d.map((({mu:e})=>e)),cov:d.map((({sig2:e})=>e))}}));this.artifacts[e].result=this.toResult1(o)}toResult2(e){let t=0,a=0;const n=e.map((({prob:e,mu:n,cov:i})=>{const{p:l,upAvg:r,cp:s}=function(e,t,a){let n=1,i=1;for(let l=0;l<e.length;++l){if(t[l][l]<1e-5){if(e[l]<a[l])return{p:0,upAvg:0,cp:0};continue}const r=(1-Qi((a[l]-e[l])/Math.sqrt(t[l][l])/Math.sqrt(2)))/2;n*=r,0!==l&&(i*=r)}const{upAvg:l}=rl(e[0],t[0][0],a[0]);return{p:n,upAvg:l,cp:i}}(n,i,this.thresholds);return t+=e*l,a+=e*l*r,{phi:e,cp:s,mu:n[0],sig2:i[0][0]}})),i=n.map((({mu:e,sig2:t})=>e-4*Math.sqrt(t))),l=n.map((({mu:e,sig2:t})=>e+4*Math.sqrt(t)));return{p:t,upAvg:t<1e-6?0:a/t,distr:{gmm:n,lower:Math.min(...i,this.thresholds[0]),upper:Math.max(...l,this.thresholds[0])},evalMode:dl.Slow}}calcSlow(e,t=!0){var a,n;(null==(a=this.artifacts[e].result)?void 0:a.evalMode)!==dl.Slow&&(null==(n=this.artifacts[e].result)?void 0:n.evalMode)!==dl.Exact&&(4===this.artifacts[e].subs.length&&(t=!1),t?this._calcSlow4th(e):this._calcSlow(e))}_calcSlow(e){const{subs:t,slotKey:a,rollsLeft:i}=this.artifacts[e],l=i-(t.length<4?1:0),r=[];nl(l,((i,l)=>{const s=Object.assign({},this.artifacts[e].values);t.forEach(((e,t)=>{s[e]+=sl*i[t]*hl(e)}));const c=this.eval(s,a),o=c.map((({grads:e})=>t.map((t=>e[n._m.indexOf(t)]*hl(t))))),d=c.map((e=>e.v)),u=o.map((e=>o.map((t=>e.reduce(((a,n,l)=>a+e[l]*t[l]*i[l]),0)))));r.push({prob:l,mu:d,cov:u})})),this.artifacts[e].result=this.toResult2(r)}_calcSlow4th(e){const{mainStat:t,subs:a,slotKey:i,rollsLeft:l}=this.artifacts[e],r=l-1,s=n._m.filter((e=>!a.includes(e)&&e!==t)),c=s.reduce(((e,t)=>e+ul[t]),0),o=[];s.forEach((t=>{nl(r,((l,r)=>{var s;r*=ul[t]/c;const d=Object.assign({},this.artifacts[e].values);l[3]+=1,a.forEach(((e,t)=>{d[e]+=sl*l[t]*hl(e)})),d[t]=(null!=(s=d[t])?s:0)+sl*l[3]*hl(t);const u=this.eval(d,i),h=u.map((({grads:e})=>{const i=a.map((t=>e[n._m.indexOf(t)]*hl(t)));return i.push(e[n._m.indexOf(t)]*hl(t)),i})),Z=u.map((e=>e.v)),p=h.map((e=>h.map((t=>e.reduce(((a,n,i)=>a+e[i]*t[i]*l[i]),0)))));o.push({prob:r,mu:Z,cov:p})}))})),this.artifacts[e].result=this.toResult2(o)}toResult3(e){let t=0,a=0;const n=e.map((({prob:e,val:n})=>n.every(((e,t)=>0===t||e>=this.thresholds[t]))?(t+=e,a+=e*(n[0]-this.thresholds[0]),{phi:e,cp:1,mu:n[0],sig2:0}):{phi:e,cp:0,mu:n[0],sig2:0})),i=n.map((({mu:e})=>e));return{p:t,upAvg:t<1e-6?0:a/t,distr:{gmm:n,lower:Math.min(...i),upper:Math.max(...i)},evalMode:dl.Exact}}calcExact(e,t=!0){var a;(null==(a=this.artifacts[e].result)?void 0:a.evalMode)!==dl.Exact&&(4===this.artifacts[e].subs.length&&(t=!1),t?this._calcExact4th(e):this._calcExact(e))}_calcExact(e){const{subs:t,slotKey:a,rollsLeft:i}=this.artifacts[e],l=i-(t.length<4?1:0),r=[];nl(l,((i,l)=>{const s=Object.assign({},this.artifacts[e].values),c=i.map(((e,a)=>t[a]&&!this.skippableDerivatives[n._m.indexOf(t[a])]?(0,at.w6)(7*e,10*e):[NaN]));(0,at.Og)(...c).forEach((e=>{const n=Object.assign({},s);let c=1;for(let a=0;a<4;a++){var o;if(isNaN(e[a]))continue;const l=t[a],r=e[a],s=i[a];n[l]=(null!=(o=n[l])?o:0)+r*hl(l);c*=4**-s*Ji(s,r-7*s)}r.push({prob:l*c,val:this.eval(n,a).map((e=>e.v))})}))})),this.artifacts[e].result=this.toResult3(r),console.log("calc exact called.",this.artifacts[e].result.p)}_calcExact4th(e){const{mainStat:t,subs:a,slotKey:i,rollsLeft:l}=this.artifacts[e],r=l-1,s=n._m.filter((e=>!a.includes(e)&&e!==t)),c=s.reduce(((e,t)=>e+ul[t]),0),o=[];s.forEach((t=>{const l=ul[t]/c;nl(r,((r,s)=>{const c=r.map(((e,i)=>3===i?(e+=1,this.skippableDerivatives[n._m.indexOf(t)]?[NaN]:(0,at.w6)(7*e,10*e)):a[i]&&!this.skippableDerivatives[n._m.indexOf(a[i])]?(0,at.w6)(7*e,10*e):[NaN]));(0,at.Og)(...c).forEach((n=>{const c=Object.assign({},this.artifacts[e].values);let d=1;for(let e=0;e<3;e++){var u;if(isNaN(n[e]))continue;const t=a[e],i=n[e],l=r[e];c[t]=(null!=(u=c[t])?u:0)+i*hl(t);d*=4**-l*Ji(l,i-7*l)}if(!isNaN(n[3])){var h;const e=t,a=n[3],i=r[3]+1;c[e]=(null!=(h=c[e])?h:0)+a*hl(e);d*=4**-i*Ji(i,a-7*i)}o.push({prob:l*s*d,val:this.eval(c,i).map((e=>e.v))})}))}))})),this.artifacts[e].result=this.toResult3(o),console.log("calc exact4th called.",this.artifacts[e].result.p)}}function ml(e){const t=Zl(e.mainStatKey,(0,Wa.Bv)(e.mainStatKey,e.rarity,e.level)),a={id:e.id,slot:e.slotKey,level:e.level,rarity:e.rarity,values:Object.assign({[e.setKey]:1,[e.mainStatKey]:t},Object.fromEntries(e.substats.map((e=>[e.key,Zl(e.key,e.accurateValue)])).filter((([,e])=>0!==e)))),subs:e.substats.reduce(((e,t)=>(""!==t.key&&e.push(t.key),e)),[])};return delete a.values[""],a}function fl(e){return(0,z.BX)(ue.ZP,{container:!0,spacing:1,children:[(0,z.tZ)(ue.ZP,{item:!0,xs:5,sm:4,md:4,lg:3,xl:3,children:(0,z.tZ)(pn.Z,{artifactId:e.upgradeOpt.id,editorProps:{}})}),(0,z.tZ)(ue.ZP,{item:!0,xs:7,sm:8,md:8,lg:9,xl:9,children:(0,z.tZ)(gl,Object.assign({},e))})]})}function gl({upgradeOpt:e,thresholds:t,objMin:a,objMax:n,calcExactCallback:l}){const{database:r}=(0,x.useContext)(T.t),s=r.arts.get(e.id);if(!s)throw new Error(`artifact ${e.id} not found.`);const c=t.length>1,o=(t,a)=>e.result.distr.gmm.reduce(((e,{phi:n,mu:i,sig2:l})=>{const r=Math.sqrt(l);if(r<.001)return t<=i&&i<a?n+e:e;return e+n*(Qi((i-t)/r)-Qi((i-a)/r))/2}),0),d=(t,a)=>e.result.distr.gmm.reduce(((e,{cp:n,phi:i,mu:l,sig2:r})=>{const s=Math.sqrt(r);if(s<.001)return t<=l&&l<a?n*i+e:e;return e+n*i*(Qi((l-t)/s)-Qi((l-a)/s))/2}),0),u=t[0],Z=(0,x.useCallback)((e=>100*(e-u)/u),[u]),m=(n-a)/50,f=(0,at.SX)(a,n,50,!1).flatMap((e=>[{x:Z(e),est:o(e,e+m),estCons:d(e,e+m)},{x:Z(e+m),est:o(e,e+m),estCons:d(e,e+m)}]));f.unshift({x:Z(a),est:0,estCons:0}),f.push({x:Z(n),est:0,estCons:0});const g=f.reduce(((e,{est:t})=>Math.max(e,t)),0),v=(u-a)/(n-a),y=e.result.p,b=e.result.upAvg,C=f,B=e.result.evalMode===dl.Exact,S=(0,at.SX)(a,n,50,!1).reduce(((e,t)=>t<u+b?t:e)),k=d(S,S+m),X=(0,i.KS)();B||X(l,1e3);const _=(0,z.BX)("span",{children:["Prob. upgrade",B?"":" (est.)",":"," ",(0,z.BX)("strong",{children:[(100*y).toFixed(1),"%"]})]}),K=(0,z.BX)("span",{children:["Average increase",B?"":" (est.)",":"," ",(0,z.BX)("strong",{children:[b<=0?"":"+",(100*b/u).toFixed(1),"%"]})]});return(0,z.BX)(w.Z,{children:[(0,z.BX)(h.Z,{sx:{display:"flex",flexDirection:"row"},children:[(0,z.tZ)(p.Z,{sx:{flexGrow:1},children:(0,z.BX)(h.Z,{sx:{display:"flex",flexDirection:"row",gap:2},children:[(0,z.tZ)(Y.Z,{children:_}),(0,z.tZ)(Y.Z,{sx:{flexGrow:1},children:K}),(0,z.tZ)(Y.Z,{children:"Currently Equipped"})]})}),(0,z.tZ)(h.Z,{sx:{height:50,width:50},children:(0,z.tZ)(xl,{slotKey:s.slotKey})})]}),(0,z.tZ)(p.Z,{children:(0,z.tZ)(Xn.h,{width:"100%",aspect:2.5,children:(0,z.BX)(_n.c,{data:C,margin:{top:5,right:30,left:20,bottom:20},children:[(0,z.tZ)(jn.K,{dataKey:"x",type:"number",domain:["auto","auto"],allowDecimals:!1,tickFormatter:e=>`${e<=0?"":"+"}${e}%`,children:(0,z.tZ)(En._,{value:"Relative Damage Potential",position:"insideBottom",style:{fill:"#eaebed"},offset:-10})}),(0,z.tZ)(On.B,{type:"number",domain:[0,g],tick:!1,children:(0,z.tZ)(En._,{value:"Probability",position:"insideLeft",angle:-90,style:{fill:"#eaebed"}})}),(0,z.tZ)(Tn.D,{verticalAlign:"top",height:36}),(0,z.tZ)("defs",{children:(0,z.BX)("linearGradient",{id:`splitOpacity${e.id}`,x1:"0",y1:"0",x2:v,y2:"0",children:[(0,z.tZ)("stop",{offset:1,stopColor:B?"#f17704":"orange",stopOpacity:0}),(0,z.tZ)("stop",{offset:0,stopColor:B?"#f17704":"orange",stopOpacity:1})]})}),(0,z.tZ)(Mn.x,{dataKey:"dne",stroke:"red",name:"Current Damage"}),c&&(0,z.tZ)(qi.u,{type:"monotone",dataKey:"est",stroke:"grey",dot:!1,fill:"grey",legendType:"none",tooltipType:"none",opacity:.5,activeDot:!1}),(0,z.tZ)(qi.u,{type:"monotone",dataKey:"estCons",stroke:B?"#f17704":"orange",dot:!1,fill:`url(#splitOpacity${e.id})`,opacity:.5,name:B?`Exact${c?" Constrained":""} Distribution`:"Estimated Distribution",activeDot:!1}),(0,z.tZ)(Hi.d,{x:Z(u),stroke:"red",strokeDasharray:"3 3",name:"Current Damage"}),(0,z.tZ)(Ui.q,{x:Z(u+b),y:k/2,shape:(0,z.tZ)("circle",{radius:1,opacity:.5})}),(0,z.tZ)(Pn.u,{content:(0,z.tZ)((({active:e})=>e?(0,z.BX)("div",{className:"custom-tooltip",children:[(0,z.tZ)("p",{className:"label"}),(0,z.tZ)("p",{className:"desc",children:_}),(0,z.tZ)("p",{className:"desc",children:K})]}):null),{}),cursor:!1})]})},e.id)})]})}function xl({slotKey:e}){const{database:t}=(0,x.useContext)(T.t),{data:a}=(0,x.useContext)(K.R),n=(0,x.useMemo)((()=>t.arts.get(a.get(ye.ri.art[e].id).value)),[e,a,t]);return(0,z.tZ)(Gn.Z,{slotKey:e,artifactObj:n})}var vl=a(90380),yl=a(83660);function bl(){var e;const{character:{key:t}}=(0,x.useContext)(_.K),{database:a}=(0,x.useContext)(T.t),{gender:l}=(0,D.Z)(),r=(0,G.Z)(),s=(0,x.useMemo)((()=>!a.arts.values.length),[a]),{buildSetting:c,buildSettingDispatch:o}=Wt(t),{optimizationTarget:d,levelLow:u,levelHigh:m}=c,f=(0,I.Z)(t),{target:v}=null!=(e=null==f?void 0:f[t])?e:{},[y]=(0,i.NW)(),[,b]=(0,x.useState)(a.displayOptimize.get());(0,x.useEffect)((()=>a.displayOptimize.follow(((e,t)=>b(t)))),[a,b]);const C=(0,x.useDeferredValue)(y),B=(0,x.useDeferredValue)(c),k=(0,x.useMemo)((()=>{const{mainStatKeys:e,excludedLocations:i,artExclusion:l,levelLow:r,levelHigh:s,allowLocationsState:c,useExcludedArts:o}=C&&B;return a.arts.values.filter((a=>{if(!o&&l.includes(a.id))return!1;if(a.level<r)return!1;if(a.level>s)return!1;const d=e[a.slotKey];if(null!=d&&d.length&&!d.includes(a.mainStatKey))return!1;const u=(0,n.V7)(t),h="unequippedOnly"===c&&a.location&&a.location!==u,Z="customList"===c&&a.location&&a.location!==u&&i.includes(a.location);return!h&&!Z}))}),[a,t,C,B]),X=(0,x.useMemo)((()=>Object.fromEntries(k.map((({id:e})=>[e,!0])))),[k]),[j,E]=(0,x.useState)(void 0),[,O]=(0,i.NW)(),[P,M]=(0,x.useState)(!0),[A,L]=(0,x.useState)(!0),[R,N]=(0,x.useState)(!1),[W,$]=(0,x.useState)(0),{artifactsToShow:V,numPages:F,currentPageIndex:q,minObj0:H,maxObj0:U}=(0,x.useMemo)((()=>{if(!j)return{artifactsToShow:[],numPages:0,currentPageIndex:0,toShow:0,minObj0:0,maxObj0:0};const e=Math.ceil(j.artifacts.length/5),t=(0,at.re)(W,0,e-1),a=j.artifacts.slice(5*t,5*(t+1)),n=j.thresholds[0];return{artifactsToShow:a,numPages:e,currentPageIndex:t,minObj0:a.reduce(((e,t)=>Math.min(t.result.distr.lower,e)),n),maxObj0:a.reduce(((e,t)=>Math.max(t.result.distr.upper,e)),n)}}),[W,j]),Y=(0,x.useCallback)(((e,t)=>{if(!j)return;const a=5*t;j.calcSlowToIndex(a),$(t-1)}),[j]),J=(0,x.useCallback)((async()=>{var e,i,r,s;const{statFilters:o,optimizationTarget:d,mainStatKeys:u,levelLow:h,levelHigh:Z,artSetExclusion:p}=c;if(!t||!d)return;const m=await(0,I.V)(a,t,0,[]);if(!m)return;const f=null==(e=(0,yt.Qo)(m.teamData,l,t)[t])?void 0:e.target.data[0];if(!f)return;Object.assign(f,(0,yt.b3)([f,Oi]));const g=(0,Bi.Hm)(null!=(i=f.display)?i:{},d);if(!g)return;E(void 0),$(0);const x=Object.entries(o).flatMap((([e,t])=>t.filter((e=>!e.disabled)).map((t=>{var a,n;const i=(0,Bi.Hm)(null!=(a=f.display)?a:{},JSON.parse(e));return{value:i,minimum:"%"===(null==(n=i.info)?void 0:n.unit)?t.value/100:t.value}})))),v=null!=(r=null==(s=a.chars.get(t))?void 0:s.equippedArtifacts)?r:{},y=Object.fromEntries(n.Ex.map((e=>{var t;const n=a.arts.get(null!=(t=v[e])?t:"");return[e,n?ml(n):void 0]}))),b=Object.fromEntries(n.Ex.map((e=>{var t,n;const i=a.arts.get(null!=(t=v[e])?t:"");return[e,null!=(n=null==i?void 0:i.setKey)?n:""]})));const C=[g,...x.map((e=>e.value))],w=(0,bt.tL)(C,f,(({path:[e]})=>"dyn"!==e)),B=new pl(w,[-1/0,...x.map((e=>e.minimum))],y);B.calc4th=A,a.arts.values.filter((e=>5===e.rarity)).filter((function(e){const t=Object.assign({},b);t[e.slotKey]=e.setKey;const a={};if(n.Ex.forEach((e=>{var n;return a[t[e]]=(null!=(n=a[t[e]])?n:0)+1})),!Object.entries(a).every((([e,t])=>{if(!p[e])return!0;switch(t){case 0:case 1:return!0;case 2:case 3:return!p[e].includes(2);case 4:case 5:return!p[e].includes(4);default:throw Error("error in respectSetExclude: num > 5")}})))return!1;if(!p.rainbow)return!0;switch(Object.values(a).reduce(((e,t)=>e+t%2),0)){case 0:case 1:return!0;case 2:case 3:return!p.rainbow.includes(2);case 4:case 5:return!p.rainbow.includes(4);default:throw Error("error in respectSex: nRainbow > 5")}})).filter((e=>P||20!==e.level)).filter((e=>{var t,a;return!R||!(null!=(t=u[e.slotKey])&&t.length)||(null==(a=u[e.slotKey])?void 0:a.includes(e.mainStatKey))})).filter((e=>!R||h<=e.level&&e.level<=Z)).forEach((e=>B.addArtifact(e))),B.calcFastAll(),B.calcSlowToIndex(5),E(B)}),[c,t,a,l,P,R,A]),Q=(0,x.useMemo)((()=>v&&f&&{data:v,teamData:f}),[v,f]),ee=F>1&&(0,z.tZ)(w.Z,{children:(0,z.tZ)(p.Z,{children:(0,z.BX)(ue.ZP,{container:!0,children:[(0,z.tZ)(ue.ZP,{item:!0,flexGrow:1,children:(0,z.tZ)(Fi.Z,{count:F,page:q+1,onChange:Y})}),(0,z.tZ)(ue.ZP,{item:!0,children:(0,z.tZ)(Cl,{numShowing:V.length,total:null==j?void 0:j.artifacts.length})})]})})});return(0,z.BX)(h.Z,{display:"flex",flexDirection:"column",gap:1,children:[s&&(0,z.tZ)(mt,{}),Q&&(0,z.tZ)(K.R.Provider,{value:Q,children:(0,z.BX)(vl.Z,{spacing:1,children:[(0,z.BX)(ue.ZP,{container:!0,spacing:1,children:[(0,z.BX)(ue.ZP,{item:!0,xs:12,sm:6,lg:3,display:"flex",flexDirection:"column",gap:1,children:[(0,z.tZ)(h.Z,{children:(0,z.tZ)(ut.Z,{characterKey:t,onClickTeammate:r})}),(0,z.tZ)(Ta,{})]}),(0,z.tZ)(ue.ZP,{item:!0,xs:12,sm:6,lg:9,display:"flex",flexDirection:"column",gap:1,children:(0,z.BX)(ue.ZP,{container:!0,spacing:1,children:[(0,z.BX)(ue.ZP,{item:!0,lg:4,display:"flex",flexDirection:"column",gap:1,children:[(0,z.tZ)(w.Z,{children:(0,z.BX)(p.Z,{children:[(0,z.tZ)("span",{children:"Optimization Target: "}),(0,z.tZ)(In.Z,{optimizationTarget:d,setTarget:e=>o({optimizationTarget:e}),disabled:!1})]})}),(0,z.tZ)(w.Z,{children:(0,z.tZ)(p.Z,{children:(0,z.tZ)(ji,{disabled:!1})})}),R&&(0,z.BX)(w.Z,{children:[(0,z.tZ)(p.Z,{sx:{py:1},children:"Artifact Level Filter"}),(0,z.tZ)(ot.Z,{levelLow:u,levelHigh:m,setLow:e=>o({levelLow:e}),setHigh:e=>o({levelHigh:e}),setBoth:(e,t)=>o({levelLow:e,levelHigh:t}),disabled:!1}),(0,z.tZ)(p.Z,{children:(0,z.tZ)(wi,{disabled:!1,filteredArtIdMap:X})})]})]}),(0,z.BX)(ue.ZP,{item:!0,lg:8,display:"flex",flexDirection:"column",gap:1,children:[(0,z.tZ)(w.Z,{children:(0,z.tZ)(p.Z,{children:(0,z.tZ)(ka,{disabled:!1})})}),(0,z.tZ)(w.Z,{children:(0,z.tZ)(p.Z,{children:(0,z.BX)(ue.ZP,{container:!0,spacing:1,children:[(0,z.tZ)(ue.ZP,{item:!0,children:(0,z.tZ)(g.Z,{startIcon:P?(0,z.tZ)(fe.Z,{}):(0,z.tZ)(ge.Z,{}),color:P?"success":"secondary",onClick:()=>M(!P),children:"show lvl 20"})}),(0,z.tZ)(ue.ZP,{item:!0,children:(0,z.tZ)(g.Z,{startIcon:A?(0,z.tZ)(fe.Z,{}):(0,z.tZ)(ge.Z,{}),color:A?"success":"secondary",onClick:()=>L(!A),children:"compute 4th sub"})}),(0,z.tZ)(ue.ZP,{item:!0,children:(0,z.tZ)(g.Z,{startIcon:R?(0,z.tZ)(fe.Z,{}):(0,z.tZ)(ge.Z,{}),color:R?"success":"secondary",onClick:()=>N(!R),children:"enable filters"})})]})})})]})]})})]}),(0,z.tZ)(w.Z,{children:(0,z.tZ)(p.Z,{children:(0,z.BX)(ue.ZP,{container:!0,spacing:1,children:[(0,z.tZ)(ue.ZP,{item:!0,children:(0,z.tZ)(g.Z,{disabled:!t||!d||!(0,Bi.Hm)(null==v?void 0:v.getDisplay(),d),color:t?"success":"warning",onClick:J,startIcon:(0,z.tZ)(Vi.Z,{}),children:"Calc Upgrade Priority"})}),(0,z.tZ)(ue.ZP,{item:!0,children:(0,z.tZ)(S.Hn,{size:"small"})}),(0,z.tZ)(ue.ZP,{item:!0,children:(0,z.tZ)(S.oX,{size:"small"})})]})})}),ee,s&&(0,z.tZ)(yl.Z,{}),(0,z.tZ)(x.Suspense,{fallback:(0,z.tZ)(Z.Z,{variant:"rectangular",sx:{width:"100%",height:600,minHeight:5e3}}),children:V.map(((e,t)=>{var a;return(0,z.tZ)(h.Z,{children:(0,z.tZ)(fl,{upgradeOpt:e,thresholds:null!=(a=null==j?void 0:j.thresholds)?a:[],objMax:U,objMin:H,calcExactCallback:()=>{const e=5*q+t;null==j||j.calcExact(e),O()}})},e.id)}))}),ee]})})]})}function Cl({numShowing:e,total:t}){return(0,z.tZ)(Y.Z,{color:"text.secondary",children:(0,z.BX)(v.cC,{i18nKey:"showingNum",count:e,value:t,children:["Showing ",{count:e}," out of ",{value:t}," Artifacts"]})})}const wl=a.p+"Character_Albedo_Card.5892308f446f759f.png",Bl=a.p+"Character_Alhaitham_Card.390618cfb70f0e4e.jpg",Sl=a.p+"Character_Aloy_Card.b6b990337b74f55f.png",kl=a.p+"Character_Amber_Card.2830ac6d2ff3846d.jpg",Xl=a.p+"Character_Arataki_Itto_Card.e1e874752d65877c.jpg",_l=a.p+"Character_Baizhu_Card.19f716d36f154360.jpg",Kl=a.p+"Character_Barbara_Card.f372476873df3b6d.jpg",jl=a.p+"Character_Beidou_Card.916c73f4f4a3ca3c.jpg",El=a.p+"Character_Bennett_Card.25f8771de05532d0.jpg",Ol=a.p+"Character_Candace_Card.6353e91b7bcd4404.jpg",Pl=a.p+"Character_Chongyun_Card.1770f1995289db9c.jpg",Tl=a.p+"Character_Collei_Card.aaa7e8dc2183674d.jpg",Ml=a.p+"Character_Cyno_Card.65e14ca6391b2f37.jpg",Al=a.p+"Character_Dehya_Card.eeff4efcde0ab4f5.jpg",Dl=a.p+"Character_Diluc_Card.18a7a83ac9ce0b87.jpg",Il=a.p+"Character_Diona_Card.21bd261dfcfe1c21.png",Ll=a.p+"Character_Dori_Card.ab5ef6d6304aec80.jpg",Rl=a.p+"Character_Eula_Card.e680ce8ea2567c4f.png",Nl=a.p+"Character_Faruzan_Card.8e06d53607285885.jpg",Gl=a.p+"Character_Fischl_Card.d45651a83cfbca82.jpg",zl=a.p+"Character_Ganyu_Card.5dc050fe16cea049.png",Wl=a.p+"Character_Gorou_Card.50bf591a764d2242.png",$l=a.p+"Character_Hu_Tao_Card.d087463aac3ba35f.png",Vl=a.p+"Character_Jean_Card.36b2f258f4290f55.jpg",Fl=a.p+"Character_Kaeya_Card.b2645bca5fa7a637.jpg",ql=a.p+"Character_Kaveh_Card.7f11be5aaf366a88.jpg",Hl=a.p+"Character_Kamisato_Ayaka_Card.e481f78f6bb51a31.png",Ul=a.p+"Character_Kamisato_Ayato_Card.c32d0bbba107a804.png",Yl=a.p+"Character_Kazuha_Card.09ababa93ec3a3e2.png",Jl=a.p+"Character_Keqing_Card.ed7c0168559732f6.jpg",Ql=a.p+"Character_Kirara_Card.f5792590c4f5a97d.jpg",er=a.p+"Character_Klee_Card.e0ee4daa68e99a52.jpg",tr=a.p+"Character_Kujou_Sara_Card.1f934a5832be2b5c.jpg",ar=a.p+"Character_Kuki_Shinobu_Card.3247590264aa41ec.jpg",nr=a.p+"Character_Layla_Card.1e4a55ea008f4fa2.jpeg",ir=a.p+"Character_Lisa_Card.4966ba74ac03470a.jpg",lr=a.p+"Character_Mika_Card.280a1899f15cfea5.jpg",rr=a.p+"Character_Mona_Card.d14df945153b29c3.jpg",sr=a.p+"Character_Nahida_Card.c01ab425bddc31ae.jpeg",cr=a.p+"Character_Nilou_Card.13f5e94ed5181b37.jpg",or=a.p+"Character_Ningguang_Card.cd89f11944f1c9cd.jpg",dr=a.p+"Character_Noelle_Card.394f26d7473fd2ad.jpg",ur=a.p+"Character_Qiqi_Card.8728d970279d46ac.jpg",hr=a.p+"Character_Raiden_Shogun_Card.56a2190f00c137f3.png",Zr=a.p+"Character_Razor_Card.1b116c57394d4b1b.jpg",pr=a.p+"Character_Rosaria_Card.8267339e414b4b96.png",mr=a.p+"Character_Sangonomiya_Kokomi_Card.843fc41e00f54a04.jpg",fr=a.p+"Character_Sayu_Card.5d2a94faea5e0c8e.png",gr=a.p+"Character_Shenhe_Card.883f751b234b9ec6.jpg",xr=a.p+"Character_Shikanoin_Heizou_Card.e3c6c8b01018558e.png",vr=a.p+"Character_Somnia_Card.36432f04e4174367.png",yr=a.p+"Character_Sucrose_Card.a5b72ffa09e14920.jpg",br=a.p+"Character_Tartaglia_Card.daa075230d685675.png",Cr=a.p+"Character_Thoma_Card.8aaf239f62fe5ce8.jpg",wr=a.p+"Character_Tighnari_Card.c59a95c5d6c8e80b.jpg",Br=a.p+"Character_Venti_Card.53c36f1f18e39e8c.jpg",Sr=a.p+"Character_Wanderer_Card.9280e378fab9bec7.jpg",kr=a.p+"Character_Xiangling_Card.5693675f27b0f2d7.jpg",Xr=a.p+"Character_Xiao_Card.505ee35780a80258.jpg",_r=a.p+"Character_Xingqiu_Card.7eb5998349f9541d.jpg",Kr=a.p+"Character_Xinyan_Card.592529410cb0ab30.jpg",jr=a.p+"Character_Yae_Miko_Card.4ad3e897b1e3a097.png",Er=a.p+"Character_Yanfei_Card.0e3112d6ef574c1a.png",Or=a.p+"Character_Yaoyao_Card.b1085e13b40477e1.jpg",Pr=a.p+"Character_Yelan_Card.3a483ca01484e384.jpg",Tr=a.p+"Character_Yoimiya_Card.cd7bc5df84521f72.png",Mr=a.p+"Character_Yun_Jin_Card.f980c03bc03f7f1d.jpg",Ar=a.p+"Character_Zhongli_Card.34830d011897679b.png",Dr={Albedo:wl,Alhaitham:Bl,Aloy:Sl,Amber:kl,AratakiItto:Xl,Baizhu:_l,Barbara:Kl,Beidou:jl,Bennett:El,Candace:Ol,Chongyun:Pl,Collei:Tl,Cyno:Ml,Dehya:Al,Diluc:Dl,Diona:Il,Dori:Ll,Eula:Rl,Faruzan:Nl,Fischl:Gl,Ganyu:zl,Gorou:Wl,HuTao:$l,Jean:Vl,KaedeharaKazuha:Yl,Kaeya:Fl,KamisatoAyaka:Hl,KamisatoAyato:Ul,Kaveh:ql,Keqing:Jl,Kirara:Ql,Klee:er,KujouSara:tr,KukiShinobu:ar,Layla:nr,Lisa:ir,Mika:lr,Mona:rr,Nahida:sr,Nilou:cr,Ningguang:or,Noelle:dr,Qiqi:ur,RaidenShogun:hr,Razor:Zr,Rosaria:pr,SangonomiyaKokomi:mr,Sayu:fr,Shenhe:gr,ShikanoinHeizou:xr,Somnia:vr,Sucrose:yr,Tartaglia:br,Thoma:Cr,Tighnari:wr,TravelerF:a.p+"Traveler_Female_Card.fa3a506cfdb64634.jpg",TravelerM:a.p+"Traveler_Male_Card.68e79e7eeb25b514.jpg",Venti:Br,Wanderer:Sr,Xiangling:kr,Xiao:Xr,Xingqiu:_r,Xinyan:Kr,YaeMiko:jr,Yanfei:Er,Yaoyao:Or,Yelan:Pr,Yoimiya:Tr,YunJin:Mr,Zhongli:Ar};var Ir=a(55290),Lr=a(16068),Rr=a(66147),Nr=a(63303),Gr=a(36674),zr=a(15132),Wr=a(85469),$r=a(49810),Vr=a(86432),Fr=a(23883),qr=a(71179),Hr=a(96580),Ur=a(73501),Yr=a(29687);let Jr,Qr=e=>e;function es({artId:e,weaponId:t}){const{t:a}=(0,v.$G)("page_character"),[n,l,r]=(0,i.aV)(!1);return(0,z.BX)(z.HY,{children:[(0,z.tZ)(ne.Z,{open:n,onClose:r,containerProps:{maxWidth:"xl"},children:(0,z.tZ)(ts,{artId:e,weaponId:t,onHide:r})}),(0,z.tZ)(Fr.Z,{title:(0,z.tZ)(Y.Z,{children:a(Jr||(Jr=Qr`tabEquip.compare`))}),placement:"top",arrow:!0,children:(0,z.tZ)(g.Z,{color:"info",size:"small",onClick:l,children:(0,z.tZ)(Yr.Z,{})})})]})}function ts({artId:e,weaponId:t,onHide:a}){const{database:n}=(0,x.useContext)(T.t),{character:{key:i,equippedArtifacts:l}}=(0,x.useContext)(_.K),{buildSetting:{mainStatAssumptionLevel:r}}=Wt(i),{data:s}=(0,x.useContext)(K.R),c=(0,x.useMemo)((()=>{const t=n.arts.get(null!=e?e:""),a=(0,at.Ay)(l,((e,a)=>a===(null==t?void 0:t.slotKey)?t:n.arts.get(e)));return Object.values(a).filter((e=>e))}),[n,l,e]),o=(0,I.Z)(i,r,c,t?n.weapons.get(t):void 0),d=(0,x.useMemo)((()=>o&&{data:o[i].target,teamData:o,oldData:s}),[i,o,s]);return(0,z.tZ)(x.Suspense,{fallback:(0,z.tZ)(Z.Z,{variant:"rectangular",width:"100%",height:600}),children:d&&(0,z.tZ)(K.R.Provider,{value:d,children:(0,z.tZ)(bn,{compareBuild:!0,extraButtonsLeft:(0,z.BX)(z.HY,{children:[(0,z.tZ)(S.Hn,{size:"small"}),(0,z.tZ)(S.oX,{size:"small"})]}),extraButtonsRight:(0,z.tZ)(g.Z,{size:"small",color:"error",onClick:a,children:(0,z.tZ)(nt.Z,{})})})})})}let as,ns=e=>e;const is={xs:6,sm:6,md:9,lg:12,xl:12},ls=(0,x.lazy)((()=>Promise.resolve().then(a.bind(a,22537))));function rs({onChangeId:e,slotKey:t,show:a,onClose:n}){const{t:l}=(0,v.$G)("page_character"),{database:r}=(0,x.useContext)(T.t),s=(0,x.useCallback)((t=>{e(t),n()}),[e,n]),c=(0,x.useCallback)(((e,a)=>Object.assign({},e,a,{slotKeys:[t]})),[t]),[o,d]=(0,x.useReducer)(c,Object.assign({},(0,oi.Af)(),{slotKeys:[t]})),[u,m]=(0,i.NW)();(0,x.useEffect)((()=>r.arts.followAny(m)),[r,m]);const f=(0,i.JT)(),g=(0,x.useMemo)((()=>(0,oi.EM)()),[]),y=(0,x.useMemo)((()=>{const e=(0,at.CZ)(o,g);return u&&r.arts.values.filter(e).map((e=>e.id)).slice(0,is[f])}),[u,r,g,o,f]);return(0,z.tZ)(ne.Z,{open:a,onClose:n,containerProps:{maxWidth:"xl"},children:(0,z.BX)(C.Z,{children:[(0,z.BX)(p.Z,{sx:{py:1,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,z.BX)(Y.Z,{variant:"h6",children:[t?(0,z.tZ)(ae.Z,{src:za.CL.slot[t]}):null," ",l(as||(as=ns`tabEquip.swapArt`))]}),(0,z.tZ)(B.Z,{onClick:n})]}),(0,z.tZ)(q.Z,{}),(0,z.BX)(p.Z,{children:[(0,z.tZ)(x.Suspense,{fallback:(0,z.tZ)(Z.Z,{variant:"rectangular",width:"100%",height:200}),children:(0,z.tZ)(ls,{filterOption:o,filterOptionDispatch:d,filteredIds:y,disableSlotFilter:!0})}),(0,z.tZ)(h.Z,{mt:1,children:(0,z.tZ)(x.Suspense,{fallback:(0,z.tZ)(Z.Z,{variant:"rectangular",width:"100%",height:300}),children:(0,z.tZ)(ue.ZP,{container:!0,spacing:1,columns:{xs:2,md:3,lg:4},children:y.map((e=>(0,z.tZ)(ue.ZP,{item:!0,xs:1,children:(0,z.tZ)(pn.Z,{artifactId:e,extraButtons:(0,z.tZ)(es,{artId:e}),onClick:s})},e)))})})})]})]})})}var ss=a(92252),cs=a(18571),os=a(64262),ds=a(54578),us=a(7794);let hs,Zs=e=>e;const ps=(0,bi.X)([...n.U1]);function ms({onChangeId:e,weaponTypeKey:t,show:a,onClose:l}){const{t:r}=(0,v.$G)(["page_character","page_weapon","weaponNames_gen"]),{database:s}=(0,x.useContext)(T.t),[c,o]=(0,x.useState)(!1),d=(0,x.useCallback)((t=>{e(t),l()}),[e,l]),[u,Z]=(0,x.useState)(""),m=(0,x.useCallback)((e=>{Z(s.weapons.new((0,us.xg)(e)))}),[s,Z]),f=(0,x.useCallback)((()=>Z("")),[]),[y,b]=(0,i.NW)();(0,x.useEffect)((()=>s.weapons.followAny(b)),[b,s]);const[w,S]=(0,x.useState)([5,4,3]),[k,X]=(0,x.useState)(""),_=(0,x.useDeferredValue)(k),K=(0,x.useMemo)((()=>{var e,a;return null!=(e=y&&s.weapons.values.filter((0,at.CZ)({weaponType:t,rarity:w,name:_},(0,ds.Xg)())).sort((0,at.ef)(null!=(a=ds.gd.level)?a:[],!1,(0,ds.Sn)())).map((e=>e.id)))?e:[]}),[y,s,w,t,_]);return(0,z.tZ)(ne.Z,{open:a,onClose:l,children:(0,z.BX)(C.Z,{children:[(0,z.tZ)(x.Suspense,{fallback:!1,children:(0,z.tZ)(cs.default,{show:c,onHide:()=>o(!1),onSelect:m,weaponTypeFilter:t})}),(0,z.tZ)(x.Suspense,{fallback:!1,children:(0,z.tZ)(os.default,{weaponId:u,footer:!0,onClose:f})}),(0,z.tZ)(p.Z,{sx:{py:1},children:(0,z.BX)(ue.ZP,{container:!0,children:[(0,z.tZ)(ue.ZP,{item:!0,flexGrow:1,children:(0,z.BX)(Y.Z,{variant:"h6",children:[t?(0,z.tZ)(ae.Z,{src:za.CL.weaponTypes[t]}):null," ",r(hs||(hs=Zs`page_character:tabEquip.swapWeapon`))]})}),(0,z.tZ)(ue.ZP,{item:!0,children:(0,z.tZ)(B.Z,{onClick:l})})]})}),(0,z.tZ)(q.Z,{}),(0,z.BX)(p.Z,{sx:{display:"flex",flexDirection:"column",gap:1},children:[(0,z.BX)(ue.ZP,{container:!0,spacing:1,children:[(0,z.tZ)(ue.ZP,{item:!0,children:(0,z.tZ)(ft.Z,{sx:{height:"100%"},value:w,size:"small",children:n.U1.map((e=>(0,z.tZ)(ct.Z,{value:e,onClick:()=>S(ps(w,e)),children:(0,z.BX)(h.Z,{display:"flex",children:[(0,z.tZ)("strong",{children:e}),(0,z.tZ)(ta.Z,{})]})},e)))})}),(0,z.tZ)(ue.ZP,{item:!0,flexGrow:1,children:(0,z.tZ)(It.Z,{autoFocus:!0,size:"small",value:k,onChange:e=>X(e.target.value),label:r("page_weapon:weaponName"),sx:{height:"100%"},InputProps:{sx:{height:"100%"}}})})]}),(0,z.tZ)(g.Z,{fullWidth:!0,onClick:()=>o(!0),color:"info",startIcon:(0,z.tZ)(ss.Z,{}),children:r("page_weapon:addWeapon")}),(0,z.tZ)(ue.ZP,{container:!0,spacing:1,children:K.map((e=>(0,z.tZ)(ue.ZP,{item:!0,xs:6,sm:6,md:4,lg:3,children:(0,z.tZ)(Ur.Z,{weaponId:e,onClick:d,extraButtons:(0,z.tZ)(es,{weaponId:e})})},e)))})]})]})})}let fs,gs,xs,vs,ys,bs,Cs,ws=e=>e;const Bs=(0,x.lazy)((()=>Promise.resolve().then(a.bind(a,64262))));function Ss(){var e;const{character:{equippedWeapon:t,key:a},characterSheet:i}=(0,x.useContext)(_.K),{teamData:l,data:r}=(0,x.useContext)(K.R),s=null==(e=l[a])?void 0:e.weaponSheet,[c,o]=(0,x.useState)(""),d=(0,x.useCallback)((()=>o(t)),[t]),u=(0,x.useCallback)((()=>o("")),[]);(0,x.useEffect)((()=>{c&&c!==t&&o(t)}),[c,t]);const Z=(0,Fa.Z)(),p=(0,Vr.Z)(Z.breakpoints.up("lg")),m=(0,x.useMemo)((()=>s&&s.document.length>0&&(0,z.tZ)(w.Z,{children:(0,z.tZ)(h.Z,{p:1,children:(0,z.tZ)(na.Z,{sections:s.document})})})),[s]),{rvFilter:f}=(0,zr.Z)(a),g=(0,x.useDeferredValue)(f),v=(0,x.useMemo)((()=>new Set(g)),[g]);return(0,z.BX)(h.Z,{children:[(0,z.tZ)(x.Suspense,{fallback:!1,children:(0,z.tZ)(Bs,{weaponId:c,footer:!0,onClose:u,extraButtons:(0,z.tZ)(_s,{weaponTypeKey:i.weaponTypeKey})})}),(0,z.BX)(ue.ZP,{container:!0,spacing:1,children:[p&&(0,z.BX)(ue.ZP,{item:!0,xs:12,md:12,lg:3,xl:3,sx:{display:"flex",flexDirection:"column",gap:1},children:[m&&m,(0,z.tZ)(js,{})]}),(0,z.BX)(ue.ZP,{item:!0,xs:12,md:12,lg:9,xl:9,container:!0,spacing:1,children:[(0,z.tZ)(ue.ZP,{item:!0,xs:12,sm:6,md:4,display:"flex",flexDirection:"column",gap:1,children:(0,z.tZ)(Ur.Z,{weaponId:t,onEdit:d,canEquip:!0,extraButtons:(0,z.tZ)(Xs,{weaponTypeKey:i.weaponTypeKey})})}),n.Ex.map((e=>{var t;return(0,z.tZ)(ue.ZP,{item:!0,xs:12,sm:6,md:4,children:r.get(ye.ri.art[e].id).value?(0,z.tZ)(pn.Z,{artifactId:null==(t=r.get(ye.ri.art[e].id).value)?void 0:t.toString(),effFilter:v,extraButtons:(0,z.tZ)(Ks,{slotKey:e}),editorProps:{},canEquip:!0}):(0,z.tZ)(ks,{slotKey:e})},e)}))]}),!p&&(0,z.BX)(ue.ZP,{item:!0,xs:12,md:12,xl:3,container:!0,spacing:1,children:[m&&(0,z.tZ)(ue.ZP,{item:!0,xs:12,md:6,lg:4,children:m}),(0,z.tZ)(ue.ZP,{item:!0,xs:12,md:6,lg:4,sx:{display:"flex",flexDirection:"column",gap:1},children:(0,z.tZ)(js,{})})]})]})]})}function ks({slotKey:e}){const{character:{key:t}}=(0,x.useContext)(_.K),{database:a}=(0,x.useContext)(T.t),[l,r,s]=(0,i.aV)(),{t:c}=(0,v.$G)("artifact");return(0,z.BX)(w.Z,{sx:{height:"100%",width:"100%",minHeight:300,display:"flex",flexDirection:"column"},children:[(0,z.tZ)(p.Z,{children:(0,z.BX)(Y.Z,{children:[(0,z.tZ)(Lt.Z,{iconProps:pe.mX,slotKey:e})," ",c(`slotName.${e}`)]})}),(0,z.tZ)(q.Z,{}),(0,z.BX)(h.Z,{sx:{flexGrow:1,display:"flex",justifyContent:"center",alignItems:"center"},children:[(0,z.tZ)(rs,{slotKey:e,show:l,onClose:s,onChangeId:e=>a.arts.set(e,{location:(0,n.V7)(t)})}),(0,z.tZ)(g.Z,{onClick:r,color:"info",sx:{borderRadius:"1em"},children:(0,z.tZ)(Wr.Z,{sx:{height:100,width:100}})})]})]})}function Xs({weaponTypeKey:e}){const{t}=(0,v.$G)("page_character"),{character:{key:a}}=(0,x.useContext)(_.K),{database:l}=(0,x.useContext)(T.t),[r,s,c]=(0,i.aV)();return(0,z.BX)(z.HY,{children:[(0,z.tZ)(Fr.Z,{title:(0,z.tZ)(Y.Z,{children:t(fs||(fs=ws`tabEquip.swapWeapon`))}),placement:"top",arrow:!0,children:(0,z.tZ)(g.Z,{color:"info",size:"small",onClick:s,children:(0,z.tZ)(Wr.Z,{})})}),(0,z.tZ)(ms,{weaponTypeKey:e,onChangeId:e=>l.weapons.set(e,{location:(0,n.V7)(a)}),show:r,onClose:c})]})}function _s({weaponTypeKey:e}){const{t}=(0,v.$G)("page_character"),{character:{key:a}}=(0,x.useContext)(_.K),{database:l}=(0,x.useContext)(T.t),[r,s,c]=(0,i.aV)();return(0,z.BX)(z.HY,{children:[(0,z.tZ)(g.Z,{color:"info",onClick:s,startIcon:(0,z.tZ)(Wr.Z,{}),children:t(gs||(gs=ws`tabEquip.swapWeapon`))}),(0,z.tZ)(ms,{weaponTypeKey:e,onChangeId:e=>l.weapons.set(e,{location:(0,n.V7)(a)}),show:r,onClose:c})]})}function Ks({slotKey:e}){const{t}=(0,v.$G)("page_character"),{character:{key:a}}=(0,x.useContext)(_.K),{database:l}=(0,x.useContext)(T.t),[r,s,c]=(0,i.aV)();return(0,z.BX)(z.HY,{children:[(0,z.tZ)(Fr.Z,{title:(0,z.tZ)(Y.Z,{children:t(xs||(xs=ws`tabEquip.swapArt`))}),placement:"top",arrow:!0,children:(0,z.tZ)(g.Z,{color:"info",size:"small",onClick:s,children:(0,z.tZ)(Wr.Z,{})})}),(0,z.tZ)(rs,{slotKey:e,show:r,onClose:c,onChangeId:e=>l.arts.set(e,{location:(0,n.V7)(a)})})]})}function js(){const{t:e}=(0,v.$G)(["page_character","artifact"]),{database:t}=(0,x.useContext)(T.t),{character:a,character:{key:l,equippedArtifacts:r}}=(0,x.useContext)(_.K),{data:s}=(0,x.useContext)(K.R),c=(0,x.useMemo)((()=>!!Object.values(r).filter((e=>e)).length),[r]),o=(0,x.useCallback)((()=>{a&&window.confirm("Do you want to move all currently equipped artifacts to inventory?")&&Object.values(r).forEach((e=>t.arts.set(e,{location:""})))}),[a,t,r]),d=(0,x.useMemo)((()=>(0,aa.ND)(s)),[s]),{rvFilter:u}=(0,zr.Z)(l),Z=(0,x.useCallback)((e=>t.charMeta.set(l,{rvFilter:e})),[t,l]),[m,f,y]=(0,i.aV)(),b=(0,x.useDeferredValue)(u),{rvField:B,rvmField:S}=(0,x.useMemo)((()=>{const{currentEfficiency:a,currentEfficiency_:i,maxEfficiency:l,maxEfficiency_:s}=Object.values(r).reduce(((e,a)=>{const i=t.arts.get(a);if(i){const{currentEfficiency:t,maxEfficiency:a}=Ha.Z.getArtifactEfficiency(i,new Set(b)),{currentEfficiency:l,maxEfficiency:r}=Ha.Z.getArtifactEfficiency(i,new Set(n._m));e.currentEfficiency=e.currentEfficiency+t,e.maxEfficiency=e.maxEfficiency+a,e.currentEfficiency_=e.currentEfficiency_+l,e.maxEfficiency_=e.maxEfficiency_+r}return e}),{currentEfficiency:0,currentEfficiency_:0,maxEfficiency:0,maxEfficiency_:0});return{rvField:{text:e(vs||(vs=ws`artifact:editor.curSubEff`)),value:a-i?(0,z.BX)("span",{children:[(0,z.tZ)(Hr.Z,{value:a,max:4500,valid:!0})," /"," ",(0,z.tZ)(Hr.Z,{value:i,max:4500,valid:!0})]}):(0,z.tZ)(Hr.Z,{value:a,max:4500,valid:!0})},rvmField:{text:e(ys||(ys=ws`artifact:editor.maxSubEff`)),canShow:()=>!!(i-s),value:l-s?(0,z.BX)("span",{children:[(0,z.tZ)(Hr.Z,{value:l,max:4500,valid:!0})," /"," ",(0,z.tZ)(Hr.Z,{value:s,max:4500,valid:!0})]}):(0,z.tZ)(Hr.Z,{value:l,max:4500,valid:!0})}}}),[e,b,r,t]);return(0,z.BX)(w.Z,{children:[c&&(0,z.tZ)(g.Z,{color:"error",onClick:o,fullWidth:!0,sx:{borderBottomRightRadius:0,borderBottomLeftRadius:0},children:e(bs||(bs=ws`tabEquip.unequipArts`))}),(0,z.tZ)(h.Z,{p:1,children:(0,z.BX)(de.Z,{spacing:1,children:[(0,z.BX)(C.Z,{children:[(0,z.tZ)(g.Z,{fullWidth:!0,color:"info",startIcon:(0,z.tZ)($r.Z,{}),sx:{borderBottomLeftRadius:0,borderBottomRightRadius:0},onClick:f,children:"RV Filter"}),(0,z.tZ)(ne.Z,{open:m,onClose:y,children:(0,z.tZ)(C.Z,{children:(0,z.BX)(p.Z,{children:[(0,z.tZ)(Y.Z,{textAlign:"center",gutterBottom:!0,variant:"h6",children:e(Cs||(Cs=ws`artifact:efficiencyFilter.title`))}),(0,z.tZ)(qr.Z,{selectedKeys:u,onChange:Z})]})})}),(0,z.BX)(Le.lD,{children:[(0,z.tZ)(Le.ms,{field:B,component:Ze.ZP}),(null==S||null==S.canShow?void 0:S.canShow(s))&&(0,z.tZ)(Le.ms,{field:S,component:Ze.ZP})]})]}),d&&Object.entries(d).flatMap((([e,t])=>t.map((t=>(0,z.tZ)(C.Z,{sx:{display:"flex",flexDirection:"column",gap:2},children:(0,z.tZ)(ia,{setKey:e,setNumKey:t},e+t)},e+t)))))]})})]})}function Es(){const e=(0,x.useRef)(),t=(0,x.useCallback)((()=>{var t;return null==e||null==(t=e.current)||null==t.scrollIntoView?void 0:t.scrollIntoView({behavior:"smooth"})}),[e]);return(0,z.BX)(de.Z,{spacing:1,children:[(0,z.BX)(ue.ZP,{container:!0,spacing:1,sx:{justifyContent:"center"},children:[(0,z.tZ)(ue.ZP,{item:!0,xs:8,sm:5,md:4,lg:2.3,children:(0,z.tZ)(Ps,{})}),(0,z.BX)(ue.ZP,{item:!0,xs:12,sm:7,md:8,lg:9.7,sx:{display:"flex",flexDirection:"column",gap:1},children:[(0,z.tZ)(Os,{onClick:t}),(0,z.tZ)(w.Z,{sx:{flexGrow:1,p:1},children:(0,z.tZ)(rn,{})})]})]}),(0,z.tZ)(h.Z,{ref:e,children:(0,z.tZ)(Ss,{})})]})}function Os({onClick:e}){const{character:{equippedWeapon:t}}=(0,x.useContext)(_.K),{data:a}=(0,x.useContext)(K.R);return(0,z.BX)(ue.ZP,{container:!0,spacing:1,columns:{xs:2,sm:2,md:3,lg:6,xl:6},children:[(0,z.tZ)(ue.ZP,{item:!0,xs:1,children:(0,z.tZ)(hn,{weaponId:t,BGComponent:w.Z,onClick:e})}),n.Ex.map((t=>{var n;return(0,z.tZ)(ue.ZP,{item:!0,xs:1,children:(0,z.tZ)(an,{artifactId:null==(n=a.get(ye.ri.art[t].id).value)?void 0:n.toString(),slotKey:t,BGComponent:w.Z,onClick:e})},t)}))]})}function Ps(){const{silly:e}=(0,x.useContext)(O.E),{characterSheet:t,character:{key:a,team:n}}=(0,x.useContext)(_.K),{gender:i}=(0,D.Z)(),{data:l}=(0,x.useContext)(K.R),r=(0,A.Z)(a),s=(0,y.s0)(),c=l.get(ye.ri.lvl).value,o=l.get(ye.ri.asc).value,d=l.get(ye.ri.constellation).value,u={auto:l.get(ye.ri.total.auto).value,skill:l.get(ye.ri.total.skill).value,burst:l.get(ye.ri.total.burst).value},Z={auto:l.get(ye.ri.total.autoBoost).value,skill:l.get(ye.ri.total.skillBoost).value,burst:l.get(ye.ri.total.burstBoost).value},p=(0,Ir.V)(a,i),m=function(e,t){var a,n;switch(e){case"TravelerAnemo":case"TravelerDendro":case"TravelerElectro":case"TravelerGeo":return null!=(a=Dr[`Traveler${t}`])?a:"";default:return null!=(n=Dr[e])?n:""}}(a,i);return(0,z.BX)(w.Z,{sx:{height:"100%"},children:[e&&p?(0,z.tZ)(Ts,{src:p,level:c,ascension:o}):(0,z.tZ)(Ms,{src:m,level:c,ascension:o}),(0,z.BX)(h.Z,{children:[(0,z.tZ)(Va.Z,{sx:{p:1},onClick:()=>s("talent"),children:(0,z.tZ)(ue.ZP,{container:!0,spacing:1,mt:-1,children:["auto","skill","burst"].map((e=>{var a;return(0,z.tZ)(ue.ZP,{item:!0,xs:4,children:(0,z.tZ)(Nr.Z,{badgeContent:u[e],color:Z[e]?"info":"secondary",overlap:"circular",anchorOrigin:{vertical:"bottom",horizontal:"right"},sx:{width:"100%",height:"100%","& > .MuiBadge-badge":{fontSize:"1.25em",padding:".25em .4em",borderRadius:".5em",lineHeight:1,height:"1.25em"}},children:(0,z.tZ)(h.Z,{component:"img",src:null==(a=t.getTalentOfKey(e))?void 0:a.img,width:"100%",height:"auto"})})},e)}))})}),(0,z.tZ)(Y.Z,{sx:{textAlign:"center",mt:1},variant:"h6",children:t.constellationName}),(0,z.tZ)(ue.ZP,{container:!0,spacing:1,children:(0,Bi.w6)(1,6).map((e=>{var a;return(0,z.tZ)(ue.ZP,{item:!0,xs:4,children:(0,z.tZ)(Va.Z,{onClick:()=>r({constellation:e===d?e-1:e}),children:(0,z.tZ)(h.Z,{component:"img",src:null==(a=t.getTalentOfKey(`constellation${e}`))?void 0:a.img,sx:Object.assign({},d>=e?{}:{filter:"brightness(50%)"}),width:"100%",height:"auto"})})},e)}))}),(0,z.tZ)(Va.Z,{sx:{p:1},onClick:()=>s("teambuffs"),children:(0,z.tZ)(ue.ZP,{container:!0,columns:3,spacing:1,children:(0,Bi.w6)(0,2).map((e=>(0,z.tZ)(ue.ZP,{item:!0,xs:1,height:"100%",children:n[e]?(0,z.tZ)(Rt.Z,{characterKey:n[e]}):(0,z.tZ)(Rt.D,{index:e})},e)))})})]})]})}function Ts({src:e,level:t,ascension:a}){const{characterSheet:n}=(0,x.useContext)(_.K);return(0,z.BX)(h.Z,{sx:{position:"relative"},children:[(0,z.tZ)(h.Z,{src:e,component:"img",width:"100%",height:"auto"}),(0,z.BX)(h.Z,{sx:{width:"100%",height:"100%"},children:[(0,z.tZ)(h.Z,{sx:{opacity:.85,width:"100%",display:"flex",justifyContent:"center",px:1},children:(0,z.tZ)(As,{})}),(0,z.tZ)(Y.Z,{variant:"h6",sx:{width:"100%",opacity:.75,textAlign:"center"},children:(0,z.tZ)(Gr.q,{stars:n.rarity,colored:!0})}),(0,z.tZ)(Is,{}),(0,z.tZ)(Ds,{level:t,ascension:a})]})]})}function Ms({src:e,level:t,ascension:a}){const{characterSheet:n}=(0,x.useContext)(_.K);return(0,z.BX)(h.Z,{sx:{position:"relative"},children:[(0,z.BX)(h.Z,{sx:{position:"absolute",width:"100%",height:"100%"},children:[(0,z.tZ)(Y.Z,{variant:"h6",sx:{position:"absolute",width:"100%",left:"50%",bottom:0,transform:"translate(-50%, -50%)",opacity:.75,textAlign:"center"},children:(0,z.tZ)(Gr.q,{stars:n.rarity,colored:!0})}),(0,z.tZ)(h.Z,{sx:{position:"absolute",left:"50%",bottom:"7%",transform:"translate(-50%, -50%)",opacity:.85,width:"100%",display:"flex",justifyContent:"center",px:1},children:(0,z.tZ)(As,{})}),(0,z.tZ)(Is,{}),(0,z.tZ)(Ds,{level:t,ascension:a})]}),(0,z.tZ)(h.Z,{src:e,component:"img",width:"100%",height:"auto"})]})}function As(){var e;const{characterSheet:t}=(0,x.useContext)(_.K),a=t.elementKey;return(0,z.tZ)(xe.Z,{color:a,sx:{height:"auto"},label:(0,z.BX)(Y.Z,{variant:"h6",sx:{display:"flex",gap:1,alignItems:"center"},children:[(0,z.tZ)(Ce.Z,{ele:a}),(0,z.tZ)(h.Z,{sx:{whiteSpace:"normal",textAlign:"center"},children:t.name}),(0,z.tZ)(ae.Z,{src:null==(e=za.CL.weaponTypes)?void 0:e[t.weaponTypeKey]})]})})}function Ds({level:e,ascension:t}){return(0,z.tZ)(Y.Z,{sx:{p:1,position:"absolute",right:0,top:0,opacity:.8},children:(0,z.tZ)(X.Z,{children:(0,Wa.wQ)(e,t)})})}function Is(){const{character:{key:e}}=(0,x.useContext)(_.K),{database:t}=(0,x.useContext)(T.t),{favorite:a}=(0,zr.Z)(e);return(0,z.tZ)(h.Z,{sx:{position:"absolute",left:0,top:0},children:(0,z.tZ)(Se.Z,{sx:{p:1},color:"error",onClick:()=>t.charMeta.set(e,{favorite:!a}),children:a?(0,z.tZ)(Lr.Z,{}):(0,z.tZ)(Rr.Z,{})})})}const Ls={xs:12,sm:6,md:4};function Rs(){const{character:e,characterSheet:t}=(0,x.useContext)(_.K),{data:a}=(0,x.useContext)(K.R),n=(0,A.Z)(e.key),i=a.get(ye.ri.asc).value,l=a.get(ye.ri.constellation).value,r=(0,Fa.Z)(),s=(0,Vr.Z)(r.breakpoints.up("lg")),c=(0,x.useMemo)((()=>(0,Bi.w6)(1,6).map((e=>(0,z.tZ)(zs,{talentKey:`constellation${e}`,subtitle:`Constellation Lv. ${e}`,onClickTitle:()=>n({constellation:e===l?e-1:e})})))),[l,n]);return(0,z.BX)(z.HY,{children:[(0,z.tZ)(Ns,{}),(0,z.BX)(ue.ZP,{container:!0,spacing:1,children:[s&&(0,z.BX)(ue.ZP,{item:!0,xs:12,md:12,lg:3,sx:{display:"flex",flexDirection:"column",gap:1},children:[(0,z.tZ)(w.Z,{children:(0,z.tZ)(p.Z,{children:(0,z.BX)(Y.Z,{variant:"h6",sx:{textAlign:"center"},children:["Constellation Lv. ",l]})})}),c.map(((e,t)=>(0,z.tZ)(h.Z,{sx:{opacity:l>=t+1?1:.5},children:e},t)))]}),(0,z.BX)(ue.ZP,{item:!0,xs:12,md:12,lg:9,container:!0,spacing:1,children:[[["auto","Normal/Charged Attack"],["skill","Elemental Skill"],["burst","Elemental Burst"]].map((([e,t])=>(0,z.tZ)(ue.ZP,Object.assign({item:!0},Ls,{children:(0,z.tZ)(zs,{talentKey:e,subtitle:t})}),e))),!!t.getTalentOfKey("sprint")&&(0,z.tZ)(ue.ZP,Object.assign({item:!0},Ls,{children:(0,z.tZ)(zs,{talentKey:"sprint",subtitle:"Alternative Sprint"})})),!!t.getTalentOfKey("passive")&&(0,z.tZ)(ue.ZP,Object.assign({item:!0},Ls,{children:(0,z.tZ)(zs,{talentKey:"passive",subtitle:"Passive"})})),[["passive1","Unlocked at Ascension 1",1],["passive2","Unlocked at Ascension 4",4],["passive3","Unlocked by Default",0]].map((([e,a,n])=>{const l=i>=n;return t.getTalentOfKey(e)?(0,z.tZ)(ue.ZP,Object.assign({item:!0,style:{opacity:l?1:.5}},Ls,{children:(0,z.tZ)(zs,{talentKey:e,subtitle:a})}),e):null}))]}),!s&&(0,z.BX)(ue.ZP,{item:!0,xs:12,md:12,lg:3,container:!0,spacing:1,children:[(0,z.tZ)(ue.ZP,{item:!0,xs:12,children:(0,z.tZ)(w.Z,{children:(0,z.tZ)(p.Z,{children:(0,z.BX)(Y.Z,{variant:"h6",sx:{textAlign:"center"},children:["Constellation Lv. ",l]})})})}),c.map(((e,t)=>(0,z.tZ)(ue.ZP,Object.assign({item:!0,sx:{opacity:l>=t+1?1:.5}},Ls,{children:e}),t)))]})]})]})}function Ns(){const{data:e}=(0,x.useContext)(K.R),t=e.getDisplay().reaction;return(0,z.tZ)(w.Z,{children:(0,z.tZ)(p.Z,{children:(0,z.tZ)(ue.ZP,{container:!0,spacing:1,children:Object.entries(t).filter((([e,t])=>!t.isEmpty)).map((([e,t])=>(0,z.tZ)(ue.ZP,{item:!0,children:(0,z.tZ)(C.Z,{children:(0,z.tZ)(p.Z,{sx:{p:1,"&:last-child":{pb:1}},children:(0,z.tZ)(Le.JW,{node:t})})})},e)))})})})}const Gs=[1,1,2,4,6,8,10];function zs({talentKey:e,subtitle:t,onClickTitle:a}){const{character:{talent:n},characterSheet:i,characterDispatch:l}=(0,x.useContext)(_.K),{data:r}=(0,x.useContext)(K.R),s=(0,x.useCallback)((e=>(0,z.tZ)(Va.Z,{onClick:a,children:e})),[a]),c=(0,x.useCallback)(((e,t)=>l({talent:Object.assign({},n,{[e]:t})})),[n,l]);let o=null;if(e in n){const t=r.get(ye.ri.total[`${e}Boost`]).value,a=r.get(ye.ri.total[e]).value,i=r.get(ye.ri.asc).value;o=(0,z.tZ)(ht.Z,{fullWidth:!0,title:`Talent Lv. ${a}`,color:t?"info":"primary",sx:{borderRadius:0},children:(0,Bi.w6)(1,Gs[i]).map((a=>(0,z.BX)(st.Z,{selected:n[e]===a,disabled:n[e]===a,onClick:()=>c(e,a),children:["Talent Lv. ",a+t]},a)))})}const d=i.getTalentOfKey(e);return(0,z.BX)(w.Z,{sx:{height:"100%"},children:[o,(0,z.BX)(p.Z,{children:[(0,z.tZ)(Ja.Z,{condition:!!a,wrapper:s,children:(0,z.BX)(ue.ZP,{container:!0,sx:{flexWrap:"nowrap"},children:[(0,z.tZ)(ue.ZP,{item:!0,children:(0,z.tZ)(h.Z,{component:"img",src:null==d?void 0:d.img,sx:{width:60,height:"auto"}})}),(0,z.BX)(ue.ZP,{item:!0,flexGrow:1,sx:{pl:1},children:[(0,z.tZ)(Y.Z,{variant:"h6",children:null==d?void 0:d.name}),(0,z.tZ)(Y.Z,{variant:"subtitle1",children:t})]})]})}),null!=d&&d.sections?(0,z.tZ)(na.Z,{sections:d.sections,hideDesc:!0,hideHeader:t=>{var a;const n=null==(a=t.header)?void 0:a.action;if(n&&"string"!=typeof n){return n.props.children.props.key18.includes(e)}return!1}}):null]})]})}var Ws=a(88819),$s=a(4371),Vs=a(87923);let Fs,qs=e=>e;function Hs(){return(0,z.tZ)(h.Z,{display:"flex",flexDirection:"column",gap:1,alignItems:"stretch",children:(0,z.BX)(ue.ZP,{container:!0,spacing:1,children:[(0,z.BX)(ue.ZP,{item:!0,xs:12,md:6,lg:3,sx:{display:"flex",flexDirection:"column",gap:1},children:[(0,z.tZ)(Us,{}),(0,z.tZ)(Ys,{})]}),(0,Bi.w6)(0,2).map((e=>(0,z.tZ)(ue.ZP,{item:!0,xs:12,md:6,lg:3,children:(0,z.tZ)(Js,{index:e})},e)))]})})}function Us(){var e,t,a;const{data:n,oldData:i}=(0,x.useContext)(K.R),l=n.getTeamBuff(),r=[];return Object.entries(null!=(e=l.total)?e:{}).forEach((([e,t])=>!t.isEmpty&&0!==t.value&&r.push([["total",e],t]))),Object.entries(null!=(t=l.premod)?t:{}).forEach((([e,t])=>!t.isEmpty&&0!==t.value&&r.push([["premod",e],t]))),Object.entries(null!=(a=l.enemy)?a:{}).forEach((([e,t])=>!t.isEmpty&&"number"==typeof t.value&&0!==t.value&&r.push([["enemy",e],t]))),r.length?(0,z.BX)(w.Z,{children:[(0,z.tZ)(p.Z,{children:(0,z.tZ)(Y.Z,{children:"Team Buffs"})}),(0,z.tZ)(q.Z,{}),(0,z.tZ)(p.Z,{children:(0,z.tZ)(ue.ZP,{container:!0,children:r.map((([e,t])=>{var a;return t&&(0,z.tZ)(ue.ZP,{item:!0,xs:12,children:(0,z.tZ)(Le.JW,{node:t,oldValue:null==(a=(0,Bi.Hm)(null==i?void 0:i.getTeamBuff(),e))?void 0:a.value})},JSON.stringify(t.info))}))})})]}):null}function Ys(){const{t:e}=(0,v.$G)("page_character"),{data:t}=(0,x.useContext)(K.R),{character:{team:a}}=(0,x.useContext)(_.K),n=a.reduce(((e,t)=>e+(t?1:0)),1);return(0,z.BX)(z.HY,{children:[(0,z.tZ)(w.Z,{children:(0,z.tZ)(F.Z,{title:(0,z.BX)("span",{children:[e("tabTeambuff.team_reso")," ",(0,z.tZ)("strong",{children:(0,z.BX)(te.Z,{color:n>=4?"success":"warning",children:["(",n,"/4)"]})})," ",(0,z.tZ)(Zt.L,{title:(0,z.tZ)(Y.Z,{children:e(Fs||(Fs=qs`tabTeambuff.resonance_tip`))})})]}),titleTypographyProps:{variant:"subtitle2"}})}),Vs.J.map(((e,a)=>(0,z.BX)(w.Z,{sx:{opacity:e.canShow(t)?1:.5},children:[(0,z.tZ)(F.Z,{title:(0,z.BX)("span",{children:[e.name," ",(0,z.tZ)(Zt.L,{title:(0,z.tZ)(Y.Z,{children:e.desc})})]}),action:e.icon,titleTypographyProps:{variant:"subtitle2"}}),e.canShow(t)&&(0,z.tZ)(q.Z,{}),e.canShow(t)&&(0,z.tZ)(p.Z,{children:(0,z.tZ)(na.Z,{sections:e.sections,teamBuffOnly:!0,hideDesc:!0})})]},a)))]})}function Js({index:e}){const{teamData:t}=(0,x.useContext)(K.R),{t:a}=(0,v.$G)("page_character"),{character:n,character:{key:i},characterDispatch:l}=(0,x.useContext)(_.K),r=n.team[e],s=(0,x.useMemo)((()=>[i,...n.team].filter(((t,a)=>a-1!==e))),[n.team,i,e]),c=(0,G.Z)(),o=(0,x.useCallback)((t=>l({type:"team",index:e,charKey:t})),[e,l]),d=t[r],u=(0,x.useMemo)((()=>{var e;return d&&{character:Object.assign({},d.character,{conditional:null!=(e=n.teamConditional[r])?e:{}}),characterSheet:d.characterSheet,characterDispatch:e=>{if(!r)return;if(!("conditional"in e))return;const{conditional:t}=e;t&&l({type:"teamConditional",teamMateKey:r,conditional:t})}}}),[n,r,d,l]),h=(0,x.useMemo)((()=>d&&{data:d.target,teamData:t}),[d,t]);return(0,z.BX)(w.Z,{sx:{overflow:"visible"},children:[(0,z.tZ)(ac,{characterKey:r,team:s,setChar:o,label:a("teammate",{count:e+1})}),r&&u&&(0,z.tZ)(_.K.Provider,{value:u,children:h&&(0,z.tZ)(K.R.Provider,{value:h,children:(0,z.tZ)(ut.Z,{characterKey:r,onClickHeader:c,artifactChildren:(0,z.tZ)(_.K.Provider,{value:u,children:(0,z.tZ)(K.R.Provider,{value:h,children:(0,z.tZ)(Qs,{})})}),weaponChildren:(0,z.tZ)(_.K.Provider,{value:u,children:(0,z.tZ)(K.R.Provider,{value:h,children:(0,z.tZ)(ec,{})})}),characterChildren:(0,z.tZ)(_.K.Provider,{value:u,children:(0,z.tZ)(K.R.Provider,{value:h,children:(0,z.tZ)(tc,{})})}),isTeammateCard:!0})})})]})}function Qs(){const{data:e}=(0,x.useContext)(K.R),t=(0,x.useMemo)((()=>Object.entries((0,aa.ND)(e)).flatMap((([e,t])=>t.flatMap((t=>{var a;return null!=(a=(0,aa.Sk)(e).setEffectDocument(t))?a:[]}))))),[e]);return t?(0,z.tZ)(na.Z,{sections:t,teamBuffOnly:!0}):null}function ec(){const{character:{key:e}}=(0,x.useContext)(_.K),{teamData:t}=(0,x.useContext)(K.R),a=t[e].weaponSheet;return a.document?(0,z.tZ)(na.Z,{sections:a.document,teamBuffOnly:!0}):null}function tc(){const{character:{key:e}}=(0,x.useContext)(_.K),{teamData:t}=(0,x.useContext)(K.R),a=t[e].characterSheet,n=Object.values(a.talent).flatMap((e=>e.sections));return n?(0,z.tZ)(na.Z,{sections:n,teamBuffOnly:!0}):null}function ac({characterKey:e,team:t,label:a,setChar:i,autoCompleteProps:l={}}){const{t:r}=(0,v.$G)(["sillyWisher_charNames","page_character","sheet_gen","charNames_gen"]),{database:s}=(0,x.useContext)(T.t),{gender:c}=(0,D.Z)(),{silly:o}=(0,x.useContext)(O.E),d=(0,x.useCallback)(((e,t)=>{var a;return e.startsWith("Traveler")?`${r(`${t?"sillyWisher_charNames":"charNames_gen"}:${(0,n.Cs)(e,c)}`)} (${r(`sheet_gen:element.${null==(a=(0,P.m)(e,c))?void 0:a.elementKey}`)})`:r(`${t?"sillyWisher_charNames":"charNames_gen"}:${e}`)}),[r,c]),u=(0,x.useCallback)((e=>e?(0,z.tZ)(N.Z,{characterKey:e}):(0,z.tZ)(Ws.Z,{})),[]),h=(0,x.useCallback)((e=>s.charMeta.get(e).favorite),[s]),p=(0,x.useCallback)((({key:a})=>t.filter((t=>t&&t!==e)).includes(a)||a.startsWith("Traveler")&&t.some((e=>e.startsWith("Traveler")))),[t,e]),m=(0,x.useMemo)((()=>s.chars.keys.map((e=>({key:e,label:d(e,o),favorite:h(e),alternateNames:[d(e,!1)]}))).sort(((e,t)=>e.favorite&&!t.favorite?-1:!e.favorite&&t.favorite?1:e.label.localeCompare(t.label)))),[s.chars.keys,d,h,o]);return(0,z.tZ)(x.Suspense,{fallback:(0,z.tZ)(Z.Z,{variant:"text",width:100}),children:(0,z.tZ)($s._,Object.assign({size:"small",label:a,options:m,valueKey:e,onChange:e=>i(null!=e?e:""),getOptionDisabled:p,toImg:u},l))})}var nc=a(71076),ic=a(97183),lc=a(31114),rc=a(47712),sc=a(23128),cc=a(40584);let oc,dc=e=>e;function uc(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var a=e[Symbol.toPrimitive];if(void 0!==a){var n=a.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}const hc=x.lazy((()=>Promise.resolve().then(a.bind(a,18571))));function Zc(){var e,t;const{database:a}=(0,x.useContext)(T.t),{data:n}=(0,x.useContext)(K.R),{character:i,character:{key:l,compareData:r},characterSheet:s,characterDispatch:c}=(0,x.useContext)(_.K),o=function(e,t){const{database:a}=(0,x.useContext)(T.t),[n,i]=(0,x.useState)((()=>a.charTCs.getWithInit(e,t)));return(0,x.useEffect)((()=>i(a.charTCs.getWithInit(e,t))),[a,e,t]),(0,x.useEffect)((()=>e?a.charTCs.follow(e,((e,t,a)=>"update"===t&&i(a))):void 0),[e,i,a]),n}(l,(0,us.mT)(s.weaponTypeKey)),d=(0,x.useCallback)((e=>a.charTCs.set(l,e)),[l,a]),u=(0,x.useCallback)((()=>{d((0,cc.O)((0,us.mT)(s.weaponTypeKey)))}),[d,s]),p=(0,x.useCallback)((e=>{d(Object.assign({},o,{weapon:Object.assign({},o.weapon,e)}))}),[d,o]),m=(0,x.useCallback)(((e,t)=>{const a=(0,cc.O)(e.key);a.artifact.substats.type=o.artifact.substats.type,a.weapon.level=e.level,a.weapon.ascension=e.ascension,a.weapon.refinement=e.refinement;const n={};t.forEach((e=>{var t;if(!e)return;const{slotKey:i,setKey:l,substats:r,mainStatKey:s,level:c,rarity:o}=e;a.artifact.slots[i].level=c,a.artifact.slots[i].statKey=s,a.artifact.slots[i].rarity=o,n[l]=(null!=(t=n[l])?t:0)+1,r.forEach((e=>{var t;e.key&&(a.artifact.substats.stats[e.key]=(null!=(t=a.artifact.substats.stats[e.key])?t:0)+e.accurateValue)}))})),a.artifact.sets=Object.fromEntries(Object.entries(n).map((([e,t])=>[e,3===t?2:5===t?4:1!==t||e.startsWith("PrayersFor")?t:0])).filter((([,e])=>e))),d(a)}),[o,d]),f=(0,y.TH)(),{build:v}=null!=(e=f.state)?e:{build:void 0};(0,x.useEffect)((()=>{if(!v)return;const e=a.weapons.get(i.equippedWeapon);m(e,v.map((e=>a.arts.get(e))))}),[v,a]);const b=(0,x.useCallback)((()=>{const e=a.weapons.get(i.equippedWeapon);m(e,Object.values(i.equippedArtifacts).map((e=>a.arts.get(e))).filter((e=>e)))}),[a,i.equippedArtifacts,i.equippedWeapon,m]),C=(0,x.useMemo)((()=>Object.assign({},o.weapon,{location:"",lock:!1,id:""})),[o]),B=(0,x.useCallback)((e=>{const t=structuredClone(o);t.artifact=e,d(t)}),[o,d]),S=(0,x.useCallback)((e=>{const t=structuredClone(o);t.artifact.substats.type=e,d(t)}),[o,d]),k=(0,x.useCallback)((e=>{const t=structuredClone(o);t.artifact.substats.stats=e,d(t)}),[o,d]),X=(0,x.useDeferredValue)(o),j=(0,x.useMemo)((()=>{const e=Object.assign({},X.artifact.substats.stats);return Object.values(X.artifact.slots).forEach((({statKey:t,rarity:a,level:n})=>{var i;return e[t]=(null!=(i=e[t])?i:0)+(0,Wa.Bv)(t,a,n)})),{art:(0,at.Ay)(e,((e,t)=>t.endsWith("_")?(0,wt.aQ)(e/100):(0,wt.a9)(e))),artSet:(0,at.Ay)(X.artifact.sets,(e=>(0,wt.a9)(e)))}}),[X]),E=(0,x.useMemo)((()=>({id:"",location:"",key:o.weapon.key,level:o.weapon.level,ascension:o.weapon.ascension,refinement:o.weapon.refinement,lock:!1})),[o]),O=(0,I.Z)(l,0,j,E),{target:P}=null!=(t=null==O?void 0:O[l])?t:{},M=(0,x.useMemo)((()=>{if(O&&P)return{data:P,teamData:O}}),[P,O]),A=(0,x.useMemo)((()=>{if(M)return Object.assign({},M,{oldData:r?n:void 0})}),[M,r,n]);return(0,z.BX)(de.Z,{spacing:1,children:[(0,z.tZ)(w.Z,{children:(0,z.BX)(h.Z,{sx:{display:"flex",gap:1,p:1},children:[(0,z.BX)(h.Z,{sx:{flexGrow:1,display:"flex",gap:1},children:[(0,z.tZ)(g.Z,{color:"info",onClick:b,startIcon:(0,z.tZ)(nc.Z,{}),children:"Copy from equipped"}),(0,z.tZ)(g.Z,{color:"error",onClick:u,startIcon:(0,z.tZ)(ic.Z,{}),children:"Reset"})]}),(0,z.BX)(ft.Z,{exclusive:!0,value:r,onChange:(e,t)=>c({compareData:t}),size:"small",children:[(0,z.tZ)(ct.Z,{value:!1,disabled:!r,children:"Show TC stats"}),(0,z.tZ)(ct.Z,{value:!0,disabled:r,children:"Compare vs. equipped"})]})]})}),M?(0,z.tZ)(K.R.Provider,{value:M,children:(0,z.BX)(ue.ZP,{container:!0,spacing:1,sx:{justifyContent:"center"},children:[(0,z.BX)(ue.ZP,{item:!0,sx:{flexGrow:-1},children:[(0,z.tZ)(pc,{weapon:C,setWeapon:p,weaponTypeKey:s.weaponTypeKey}),(0,z.tZ)(mc,{artifactData:o.artifact,setArtifactData:B})]}),(0,z.tZ)(ue.ZP,{item:!0,sx:{flexGrow:1},children:(0,z.tZ)(vc,{substats:o.artifact.substats.stats,setSubstats:k,substatsType:o.artifact.substats.type,setSubstatsType:S,mainStatKeys:Object.values(o.artifact.slots).map((e=>e.statKey))})})]})}):(0,z.tZ)(Z.Z,{variant:"rectangular",width:"100%",height:500}),(0,z.tZ)(w.Z,{sx:{flexGrow:1,p:1},children:A?(0,z.tZ)(K.R.Provider,{value:A,children:(0,z.tZ)(rn,{})}):(0,z.tZ)(Z.Z,{variant:"rectangular",width:"100%",height:500})})]})}function pc({weapon:e,setWeapon:t,weaponTypeKey:a}){const{key:n,level:l=0,refinement:r=1,ascension:s=0}=e,c=(0,cn.ub)(n),[o,d,u]=(0,i.aV)(),{data:Z}=(0,x.useContext)(K.R),p=(0,x.useMemo)((()=>e&&(0,yt.mP)([c.data,(0,yt.v0)(e)])),[c,e]);return(0,z.BX)(w.Z,{sx:{p:1,mb:1},children:[(0,z.tZ)(hc,{ascension:s,show:o,onHide:u,onSelect:e=>t({key:e}),weaponTypeFilter:a}),(0,z.BX)(h.Z,{display:"flex",flexDirection:"column",gap:1,children:[(0,z.BX)(h.Z,{display:"flex",gap:1,children:[(0,z.tZ)(h.Z,{className:`grad-${c.rarity}star`,component:"img",src:(0,za.Aq)(e.key,s>=2),sx:{flexshrink:1,flexBasis:0,maxWidth:"30%",borderRadius:1}}),(0,z.BX)(de.Z,{spacing:1,flexGrow:1,children:[(0,z.tZ)(g.Z,{fullWidth:!0,color:"info",sx:{flexGrow:1},onClick:d,children:(0,z.tZ)(h.Z,{sx:{maxWidth:"10em"},children:null==c?void 0:c.name})}),c.hasRefinement&&(0,z.tZ)(sc.Z,{refinement:r,setRefinement:e=>t({refinement:e})})]})]}),(0,z.tZ)(k.Z,{level:l,ascension:s,setBoth:t,useLow:!c.hasRefinement}),(0,z.BX)(C.Z,{children:[(0,z.tZ)(F.Z,{title:"Main Stats",titleTypographyProps:{variant:"subtitle2"}}),(0,z.tZ)(q.Z,{}),p&&(0,z.tZ)(Le.lD,{children:[ye.ri.weapon.main,ye.ri.weapon.sub,ye.ri.weapon.sub2].map((e=>{const t=p.get(e);return t.isEmpty||!t.value?null:(0,z.tZ)(Le.JW,{node:t,component:Ze.ZP},JSON.stringify(t.info))}))})]}),Z&&(null==c?void 0:c.document)&&(0,z.tZ)(na.Z,{sections:c.document})]})]})}function mc({artifactData:e,setArtifactData:t}){const a=(0,x.useCallback)((a=>n=>{const i=structuredClone(e);i.slots[a]=n,t(i)}),[e,t]),i=(0,x.useCallback)((a=>{const n=structuredClone(e);n.sets=a,t(n)}),[e,t]);return(0,z.BX)(de.Z,{spacing:1,children:[(0,z.tZ)(w.Z,{sx:{p:1},children:(0,z.tZ)(de.Z,{spacing:1,children:n.Ex.map((t=>(0,z.tZ)(fc,{slotKey:t,slot:e.slots[t],setSlot:a(t)},t)))})}),(0,z.tZ)(x.Suspense,{fallback:(0,z.tZ)(Z.Z,{variant:"rectangular",width:"100%",height:200}),children:(0,z.tZ)(gc,{artSet:e.sets,setArtSet:i})})]})}function fc({slotKey:e,slot:t,setSlot:a}){var i;const{level:l,statKey:r,rarity:s}=t,c=n.x1[e].stats,o=(0,x.useCallback)((e=>{a(Object.assign({},t,e))}),[t,a]),d=(0,x.useCallback)((e=>{var t;const a=null!=(t=n.F7[e])?t:0;o(l>a?{rarity:e,level:a}:{rarity:e})}),[l,o]);return(0,z.BX)(h.Z,{display:"flex",gap:1,justifyContent:"space-between",alignItems:"center",children:[(0,z.tZ)(Lt.Z,{slotKey:e}),(0,z.tZ)(C.Z,{sx:{height:"100%",minWidth:"5em",flexGrow:1,display:"flex"},children:1===c.length?(0,z.BX)(h.Z,{p:1,justifyContent:"center",alignItems:"center",width:"100%",display:"flex",gap:1,children:[(0,z.tZ)(Ce.C,{statKey:c[0],iconProps:pe.mX})," ",be.ZP.getStr(c[0])]}):(0,z.tZ)(ht.Z,{sx:{px:0},fullWidth:!0,title:(0,z.tZ)(Qa,{statKey:r}),color:null!=(i=be.ZP.getVariant(r))?i:"success",children:c.map((e=>(0,z.tZ)(st.Z,{disabled:r===e,onClick:()=>o({statKey:e}),children:(0,z.tZ)(en,{statKey:e})},e)))})}),(0,z.tZ)(ht.Z,{sx:{px:0},title:(0,z.BX)(h.Z,{sx:{display:"flex",alignItems:"center"},children:[s," ",(0,z.tZ)(ta.Z,{fontSize:"inherit"})]}),children:[5,4,3].map((e=>(0,z.tZ)(st.Z,{disabled:s===e,onClick:()=>d(e),children:(0,z.BX)(h.Z,{sx:{display:"flex",alignItems:"center"},children:[e," ",(0,z.tZ)(ta.Z,{fontSize:"inherit"})]})},e)))}),(0,z.tZ)(Ke.ZP,{startAdornment:"+",value:l,color:Ha.Z.levelVariant(l),onChange:e=>void 0!==e&&o({level:e}),sx:{borderRadius:1,pl:1,my:0,height:"100%"},inputProps:{sx:{pl:.5,width:"2em"},max:20,min:0}}),(0,z.tZ)(C.Z,{sx:{height:"100%",minWidth:"4em"},children:(0,z.tZ)(h.Z,{p:1,textAlign:"center",children:`${(0,Wa.Jj)((0,Wa.Bv)(r,s,l),be.ZP.unit(r))}${be.ZP.unit(r)}`})})]})}function gc({artSet:e,setArtSet:t}){const a=(0,x.useCallback)((a=>{a&&t(Object.assign({},e,{[a]:parseInt(Object.keys((0,aa.Sk)(a).setEffects)[0])}))}),[e,t]),n=(0,x.useCallback)((a=>n=>t(Object.assign({},e,{[a]:n}))),[e,t]),i=(0,x.useCallback)((a=>()=>{const n=(0,we.Z)(e,[a].map(uc));t(Object.assign({},n))}),[e,t]),l=5-Object.values(e).reduce(((e,t)=>e+t),0);return(0,z.BX)(de.Z,{spacing:1,sx:{flexGrow:1},children:[Object.entries(e).map((([e,t])=>(0,z.tZ)(xc,{setKey:e,value:t,setValue:n(e),deleteValue:i(e),remaining:l},e))),(0,z.tZ)(w.Z,{sx:{flexGrow:1,overflow:"visible"},children:(0,z.tZ)(rc.Z,{artSetKey:"",setArtSetKey:a,label:"New Artifact Set",getOptionDisabled:({key:t})=>Object.keys(e).includes(t)||!t||Object.keys((0,aa.Sk)(t).setEffects).every((e=>parseInt(e)>l))})})]})}function xc({setKey:e,value:t,setValue:a,deleteValue:n,remaining:i}){const l=(0,aa.Sk)(e),r=(0,x.useMemo)((()=>t<4?[]:Object.keys(l.setEffects).filter((e=>{var t;return null==(t=l.setEffects[e])?void 0:t.document.some((e=>"states"in e))}))),[l,t]);return(0,z.BX)(w.Z,{children:[(0,z.BX)(h.Z,{display:"flex",children:[(0,z.tZ)(mn.Z,{artifactSheet:l,numInSet:t,children:(0,z.BX)(h.Z,{flexGrow:1,p:1,display:"flex",gap:1,alignItems:"center",children:[(0,z.tZ)(ae.Z,{size:2,src:(0,ra.jU)(e)}),(0,z.tZ)(h.Z,{children:l.setName}),(0,z.tZ)(lc.Z,{})]})}),(0,z.BX)(_e.Z,{children:[(0,z.tZ)(ht.Z,{size:"small",title:(0,z.BX)(h.Z,{whiteSpace:"nowrap",children:[t,"-set"]}),children:Object.keys(l.setEffects).map((e=>parseInt(e))).map((e=>(0,z.BX)(st.Z,{disabled:t===e||e>i+t,onClick:()=>a(e),children:[e,"-set"]},e)))}),(0,z.tZ)(g.Z,{color:"error",size:"small",onClick:n,children:(0,z.tZ)(it.Z,{})})]})]}),!!r.length&&(0,z.tZ)(de.Z,{spacing:1,sx:{p:1},children:r.map((t=>(0,z.tZ)(ia,{setKey:e,setNumKey:parseInt(t),hideHeader:!0,conditionalsOnly:!0},t)))})]})}function vc({substats:e,setSubstats:t,substatsType:a,setSubstatsType:i,mainStatKeys:l}){const r=(0,x.useCallback)((a=>n=>t(Object.assign({},e,{[a]:n}))),[e,t]),{t:s}=(0,v.$G)("page_character"),c=100*Object.entries(e).reduce(((e,[t,a])=>e+a/(0,Wa.U9)(t)),0),o=Object.entries(e).reduce(((e,[t,n])=>e+n/(0,Wa.U9)(t,void 0,a)),0);return(0,z.BX)(w.Z,{sx:{p:1,height:"100%"},children:[(0,z.BX)(h.Z,{sx:{mb:1,display:"flex",gap:1},children:[(0,z.tZ)(ht.Z,{fullWidth:!0,title:s(`tabTheorycraft.substatType.${a}`),children:n.Ar.map((e=>(0,z.tZ)(st.Z,{disabled:a===e,onClick:()=>i(e),children:s(`tabTheorycraft.substatType.${e}`)},e)))}),(0,z.tZ)(dt.Z,{title:(0,z.tZ)(Y.Z,{children:s(oc||(oc=dc`tabTheorycraft.maxTotalRolls`))}),placement:"top",children:(0,z.BX)(C.Z,{sx:{textAlign:"center",py:.5,px:1,minWidth:"15em",whiteSpace:"nowrap",display:"flex",gap:2,justifyContent:"flex-end",alignItems:"center"},children:[(0,z.BX)(te.Z,{color:o>45?"warning":void 0,children:["Rolls: ",(0,z.tZ)("strong",{children:o.toFixed(0)})]}),(0,z.BX)(te.Z,{color:o>45?"warning":void 0,children:["RV: ",(0,z.BX)("strong",{children:[c.toFixed(1),"%"]})]})]})})]}),(0,z.tZ)(de.Z,{spacing:1,children:Object.entries(e).map((([e,t])=>(0,z.tZ)(yc,{statKey:e,value:t,setValue:r(e),substatsType:a,mainStatKeys:l},e)))})]})}function yc({statKey:e,value:t,setValue:a,substatsType:n,mainStatKeys:i}){const{t:l}=(0,v.$G)("page_character"),r=(0,Wa.U9)(e,5,n),[s,c]=(0,x.useState)((()=>t/r));(0,x.useEffect)((()=>c(t/r)),[t,r]);const o=be.ZP.unit(e),d=s*r,u=s*r/(0,Wa.U9)(e)*100,Z=i.reduce(((t,a)=>t+(a===e?1:0)),0),p=6*(5-Z),m=s-1e-4>p,f=(0,x.useCallback)((e=>a(e*r)),[a,r]);return(0,z.BX)(de.Z,{spacing:.5,children:[(0,z.BX)(h.Z,{display:"flex",gap:1,justifyContent:"space-between",alignItems:"center",children:[(0,z.BX)(C.Z,{sx:{p:.5,minWidth:"11em",flexGrow:1,display:"flex",gap:1,alignItems:"center",justifyContent:"center"},children:[(0,z.tZ)(Ce.C,{statKey:e,iconProps:{fontSize:"inherit"}}),be.ZP.getStr(e),be.ZP.unit(e)]}),(0,z.tZ)(dt.Z,{title:(0,z.tZ)(Y.Z,{children:l(Z?"tabTheorycraft.maxRollsMain":"tabTheorycraft.maxRolls",{value:p})}),placement:"top",children:(0,z.tZ)(C.Z,{sx:{textAlign:"center",p:.5,minWidth:"8em"},children:(0,z.BX)(te.Z,{color:m?"warning":void 0,children:["RV: ",(0,z.BX)("strong",{children:[u.toFixed(1),"%"]})]})})})]}),(0,z.BX)(h.Z,{display:"flex",gap:1,justifyContent:"space-between",alignItems:"center",children:[(0,z.tZ)(Ke.ZP,{color:d?"success":"primary",float:"%"===be.ZP.unit(e),endAdornment:be.ZP.unit(e)||(0,z.tZ)(h.Z,{width:"1em",component:"span"}),value:parseFloat(d.toFixed(2)),onChange:e=>void 0!==e&&a(e),sx:{borderRadius:1,px:1,height:"100%",width:"6em"},inputProps:{sx:{textAlign:"right"},min:0}}),(0,z.tZ)(C.Z,{sx:{px:2,flexGrow:1,display:"flex",gap:1,alignItems:"center",justifyContent:"center",overflow:"visible"},children:(0,z.tZ)(kn.ZP,{size:"small",value:s,max:p,min:0,step:1,marks:!0,valueLabelDisplay:"auto",onChange:(e,t)=>c(t),onChangeCommitted:(e,t)=>f(t)})}),(0,z.tZ)(Ke.ZP,{color:t?m?"warning":"success":"primary",float:!0,startAdornment:(0,z.BX)(h.Z,{sx:{whiteSpace:"nowrap",width:"7em",display:"flex",justifyContent:"space-between"},children:[(0,z.BX)("span",{children:[(0,Wa.Jj)(r,o),o]}),(0,z.tZ)("span",{children:"x"})]}),value:parseFloat(s.toFixed(2)),onChange:e=>void 0!==e&&a(e*r),sx:{borderRadius:1,px:1,my:0,height:"100%",width:"7em"},inputProps:{sx:{textAlign:"right",pr:.5},min:0,step:1}})]})]})}var bc=a(51638);function Cc(){const{character:e}=(0,x.useContext)(_.K),{key:t}=e,a=(0,G.Z)();if(!t.startsWith("Traveler"))return null;const i=n.UB.find((e=>t.toLowerCase().includes(e)));return i?(0,z.tZ)(ht.Z,{color:i,title:(0,z.tZ)("strong",{children:(0,bc.el)(`element.${i}`)}),children:n.DZ.map((e=>(0,z.tZ)(st.Z,{selected:i===e,disabled:i===e,onClick:()=>a((0,n.vd)(e)),children:(0,z.tZ)("strong",{children:(0,z.tZ)(te.Z,{color:e,children:(0,bc.el)(`element.${e}`)})})},e)))}):null}var wc=a(2247),Bc=a(96608);function Sc(){const{t:e}=(0,v.$G)("ui"),{database:t}=(0,x.useContext)(T.t),{character:a}=(0,x.useContext)(_.K),{key:n}=a,{gender:i}=(0,D.Z)(),l=(0,x.useCallback)((()=>t.dbMeta.set({gender:"F"===i?"M":"F"})),[i,t]);return n.startsWith("Traveler")?(0,z.BX)(g.Z,{onClick:l,startIcon:"F"===i?(0,z.tZ)(wc.Z,{}):(0,z.tZ)(Bc.Z,{}),children:[(0,z.tZ)("strong",{children:e(`gender.${i}`)})," "]}):null}let kc,Xc=e=>e;function _c(){const e=(0,y.s0)(),{database:t}=(0,x.useContext)(T.t),a=(0,x.useCallback)((()=>e("/characters")),[e]),{characterKey:n}=(0,y.UO)();return!t.chars.keys.includes(n)?(0,z.tZ)(y.Fg,{to:"/characters"}):(0,z.tZ)(h.Z,{my:1,display:"flex",flexDirection:"column",gap:1,children:(0,z.tZ)(x.Suspense,{fallback:(0,z.tZ)(Z.Z,{variant:"rectangular",width:"100%",height:1e3}),children:n&&(0,z.tZ)(Kc,{characterKey:n,onClose:a},n)})})}function Kc({characterKey:e,onClose:t}){var a,i,l;const{silly:r}=(0,x.useContext)(O.E),s=(0,M.Z)(e),{gender:c}=(0,D.Z)(),o=(0,P.m)(e,c),d=(0,I.Z)(e),{target:u}=null!=(a=null==d?void 0:d[e])?a:{},{params:{tab:m="overview"}}=null!=(i=(0,y.bS)({path:"/characters/:charKey/:tab",end:!1}))?i:{params:{tab:"overview"}},{t:f}=(0,v.$G)(["sillyWisher_charNames","charNames_gen","page_character"]);(0,L.Z)((0,x.useMemo)((()=>`${f(`${r?"sillyWisher_charNames":"charNames_gen"}:${(0,n.Cs)(e,c)}`)} - ${f(`page_character:tabs.${m}`)}`),[f,r,e,c,m]));const g=(0,A.Z)(null!=(l=null==s?void 0:s.key)?l:""),b=(0,x.useMemo)((()=>{if(d&&u)return{data:u,teamData:d,oldData:void 0}}),[u,d]),X=(0,x.useMemo)((()=>{if(s&&o)return{character:s,characterSheet:o,characterDispatch:g}}),[s,o,g]),[T,N]=(0,x.useState)(void 0),[G,W]=(0,x.useState)(),V=(0,x.useMemo)((()=>({chartData:T,setChartData:N,graphBuilds:G,setGraphBuilds:W})),[T,G]);return(0,x.useEffect)((()=>{N(void 0),W(void 0)}),[e]),(0,z.tZ)(C.Z,{children:b&&X&&V?(0,z.tZ)(_.K.Provider,{value:X,children:(0,z.tZ)(K.R.Provider,{value:b,children:(0,z.tZ)(E.Provider,{value:V,children:(0,z.tZ)(j.B,{children:(0,z.BX)(p.Z,{sx:{display:"flex",flexDirection:"column",gap:1},children:[(0,z.BX)(h.Z,{display:"flex",children:[(0,z.BX)(h.Z,{display:"flex",gap:1,flexWrap:"wrap",flexGrow:1,children:[(0,z.tZ)($,{}),(0,z.tZ)(Cc,{}),(0,z.tZ)(Sc,{}),(0,z.tZ)(Oc,{}),(0,z.tZ)(R.J,{}),(0,z.tZ)(Pc,{})]}),!!t&&(0,z.tZ)(B.Z,{onClick:t})]}),(0,z.BX)(h.Z,{display:"flex",gap:1,flexWrap:"wrap",children:[s&&(0,z.tZ)(k.Z,{level:s.level,ascension:s.ascension,setBoth:g}),(0,z.tZ)(S.Hn,{size:"small"}),(0,z.tZ)(S.pg,{}),(0,z.tZ)(S.oX,{size:"small"})]}),(0,z.tZ)(w.Z,{children:(0,z.tZ)(Ec,{tab:m})}),(0,z.tZ)(jc,{}),(0,z.tZ)(w.Z,{children:(0,z.tZ)(Ec,{tab:m})})]})})})})}):(0,z.tZ)(Z.Z,{variant:"rectangular",width:"100%",height:1e3})})}function jc(){return(0,z.tZ)(x.Suspense,{fallback:(0,z.tZ)(Z.Z,{variant:"rectangular",width:"100%",height:500}),children:(0,z.BX)(y.Z5,{children:[(0,z.tZ)(y.AW,{index:!0,element:(0,z.tZ)(Es,{})}),(0,z.tZ)(y.AW,{path:"/talent",element:(0,z.tZ)(Rs,{})}),(0,z.tZ)(y.AW,{path:"/teambuffs",element:(0,z.tZ)(Hs,{})}),(0,z.tZ)(y.AW,{path:"/optimize",element:(0,z.tZ)(Gi,{})}),(0,z.tZ)(y.AW,{path:"/theorycraft",element:(0,z.tZ)(Zc,{})}),(0,z.tZ)(y.AW,{path:"/upopt",element:(0,z.tZ)(bl,{})})]})})}function Ec({tab:e}){const{t}=(0,v.$G)("page_character");return(0,z.BX)(m.Z,{value:e,variant:"scrollable",allowScrollButtonsMobile:!0,sx:{"& .MuiTab-root:hover":{transition:"background-color 0.25s ease",backgroundColor:"rgba(255,255,255,0.1)"}},children:[(0,z.tZ)(f.Z,{sx:{minWidth:"16.6%"},value:"overview",label:t("tabs.overview"),icon:(0,z.tZ)(l.Z,{}),component:b.rU,to:""}),(0,z.tZ)(f.Z,{sx:{minWidth:"16.6%"},value:"talent",label:t("tabs.talent"),icon:(0,z.tZ)(r.Z,{}),component:b.rU,to:"talent"}),(0,z.tZ)(f.Z,{sx:{minWidth:"16.6%"},value:"teambuffs",label:t("tabs.teambuffs"),icon:(0,z.tZ)(s.Z,{}),component:b.rU,to:"teambuffs"}),(0,z.tZ)(f.Z,{sx:{minWidth:"16.6%"},value:"optimize",label:t("tabs.optimize"),icon:(0,z.tZ)(c.Z,{}),component:b.rU,to:"optimize"}),(0,z.tZ)(f.Z,{sx:{minWidth:"16.6%"},value:"theorycraft",label:t("tabs.theorycraft"),icon:(0,z.tZ)(o.Z,{}),component:b.rU,to:"theorycraft"}),(0,z.tZ)(f.Z,{sx:{minWidth:"16.6%"},value:"upopt",label:t("tabs.upgradeopt"),icon:(0,z.tZ)(c.Z,{}),component:b.rU,to:"upopt"})]})}function Oc(){const{t:e}=(0,v.$G)("page_character"),[t,a,n]=(0,i.aV)(),{character:{bonusStats:l}}=(0,x.useContext)(_.K),r=Object.keys(l).length;return(0,z.BX)(z.HY,{children:[(0,z.BX)(g.Z,{color:"info",startIcon:(0,z.tZ)(d.Z,{}),onClick:a,children:[e(kc||(kc=Xc`addStats.title`)),!!r&&(0,z.tZ)(X.Z,{sx:{ml:1},color:"success",children:r})]}),(0,z.tZ)(We,{open:t,onClose:n})]})}function Pc(){const{onModalOpen:e}=(0,x.useContext)(j.M);return(0,z.BX)(z.HY,{children:[(0,z.BX)(g.Z,{color:"info",startIcon:(0,z.tZ)(u.Z,{}),onClick:e,children:["Formulas ","&"," Calcs"]}),(0,z.tZ)(re,{})]})}}}]);