(function(){"use strict";function k(e){throw new Error(`Should not reach this with value ${e}`)}function E(e,t){const o=new Set;function n(i){o.has(i)||(t(i,n),o.add(i))}e.forEach(n)}function S(e,t,o,n,i=""){let d=1,s="'use strict';"+i+";const x0=0";const l=new Map;return E(e,(a,m)=>{const c=`x${d++}`;l.set(a,c);const{op:f,x:g,br:y}=a;g.forEach(m),y.forEach(m);const r=g.map($=>l.get($)),h=y.map($=>l.get($));switch(f){case"const":l.set(a,typeof a.ex!="string"?`(${a.ex})`:`('${a.ex}')`);break;case"sum":case"prod":s+=`,${c}=`,r.length?s+=r.join(f=="sum"?"+":"*"):s+=f=="sum"?0:1;break;case"min":case"max":s+=`,${c}=Math.${f}(${r})`;break;case"sumfrac":s+=`,${c}=${r[0]}/(${r[0]} + ${r[1]})`;break;case"match":s+=`,${c}=${h[0]}===${h[1]}?${r[0]}:${r[1]}`;break;case"thres":s+=`,${c}=${h[0]}>=${h[1]}?${r[0]}:${r[1]}`;break;case"subscript":s+=`,${c}=${JSON.stringify(a.ex)}[${h[0]}]`;break;case"read":{const $=a.tag[t];let p=[...new Array(o)].map((v,T)=>`(b[${T}]['${$}'] ?? 0)`);n[$]&&(p=[n[$].toString(),...p]),s+=`,${c}=${p.join("+")}`;break}case"custom":s+=`,${c}=${a.ex}(${r})`;break;case"lookup":s+=`,${c}=([${r}])[(${JSON.stringify(a.ex)})[${h[0]}] ?? 0]`;break;default:k(f)}}),s+=`;return [${e.map(a=>l.get(a))}]`,new Function("b",s)}const w=1e5;let b,u;onmessage=async e=>{try{await x(e)}catch(t){console.log(t),postMessage({resultType:"err",message:JSON.stringify(t)})}};async function x(e){const{data:t}=e,{command:o}=t;switch(o){case"init":M(t);break;case"start":await N();break}}async function M({relicStatsBySlot:e,combinedNodes:t}){b=S(t,"q",6,{}),u=e,postMessage({resultType:"initialized"})}async function N(){let e=[];u.head.forEach(t=>{u.hand.forEach(o=>{u.feet.forEach(n=>{u.body.forEach(i=>{u.sphere.forEach(d=>{u.rope.forEach(s=>{const l=b([t.stats,o.stats,n.stats,i.stats,d.stats,s.stats]);e.push({value:l[0],ids:{head:t.id,hand:o.id,feet:n.id,body:i.id,sphere:d.id,rope:s.id}}),e.length>w&&(postMessage({resultType:"results",builds:e}),e=[])})})})})})}),e.length>0&&postMessage({resultType:"results",builds:e}),postMessage({resultType:"done"})}})();
