import{u as O,e as s,ai as V,b as G,d as Q,p as e,aN as q,ay as z,aO as _,q as R,Z as M,a3 as X,aK as Z,V as Y,aP as ee,n as S,N as K,M as F,C as P,X as B,B as $,D as ae,T as te,_ as re,aQ as se}from"./index-eeae5ae3.js";import{G as oe,f as ne,s as le,u as ie,a as ce,T as W,S as me,d as he}from"./LocationName-7b0bf763.js";import{d as A}from"./Upload-4d3265e1.js";import{g as ue}from"./index-fa03d1b8.js";import{b as de}from"./totalUtils-cc184362.js";import{T as pe}from"./TeamCard-93861e2e.js";import{C as fe}from"./CardHeader-0d063f31.js";import"./DropdownButton-0e2d583e.js";import"./index-1bd4226f.js";import"./Info-c440607a.js";import"./DataContext-e47a1242.js";import"./util-3e22b532.js";import"./SlotIcon-499530c5.js";import"./index-324e9a68.js";import"./useWeapon-2bbcc862.js";import"./index-5b398d7e.js";import"./CardActionArea-fb12e9f2.js";function ge({teamIds:l,charKeys:r,setCharKey:m,acProps:i}){const{t:u}=O(["sillyWisher_charNames","charNames_gen"]),{silly:y}=s.useContext(V),o=G(),{gender:h}=Q(),d=s.useCallback(a=>o.charMeta.get(a).favorite,[o.charMeta]),b=s.useCallback(a=>e(q,{characterKey:a}),[]),w=s.useCallback((a,n)=>u(`${n?"sillyWisher_charNames":"charNames_gen"}:${z(a,h)}`),[h,u]),D=s.useCallback(a=>ue(a,h).elementKey??void 0,[h]),C=s.useMemo(()=>o.chars.keys,[o]),{characterTeamTotal:p}=s.useMemo(()=>de({characterTeamTotal:C},n=>{o.teams.values.forEach(c=>{const{loadoutData:f}=c;f.filter(_).forEach(({teamCharId:k})=>{const T=o.teamChars.get(k);if(!T)return;const x=T.key;n.characterTeamTotal[x].total++})}),l.forEach(c=>{const f=o.teams.get(c);if(!f)return;const{loadoutData:k}=f;k.filter(_).forEach(({teamCharId:T})=>{const x=o.teamChars.get(T);if(!x)return;const N=x.key;n.characterTeamTotal[N].current++})})}),[o,C,l]),v=s.useCallback(a=>e("strong",{children:p[a]}),[p]),I=s.useCallback(a=>e(R,{size:"small",label:p[a]}),[p]),E=s.useMemo(()=>C.map(a=>({key:a,label:w(a,y),alternateNames:y?[w(a,!y)]:void 0,favorite:d(a),color:D(a)})).sort((a,n)=>a.favorite&&!n.favorite?-1:!a.favorite&&n.favorite?1:a.label.localeCompare(n.label)),[y,w,D,d,C]);return e(s.Suspense,{fallback:e(M,{variant:"text",width:100}),children:e(oe,{label:"Characters",options:E,toImg:b,valueKeys:r,onChange:a=>m(a),toExLabel:v,toExItemLabel:I,chipProps:{variant:"outlined"},...i})})}function ye(){return{name:l=>l.name??"",lastEdit:l=>l.lastEdit??0}}const Ce={name:["name","lastEdit"],lastEdit:["lastEdit"]};function Te(l){return{charKeys:(r,m)=>{var o;if(!m.length)return!0;const i=(o=l.teams.get(r))==null?void 0:o.loadoutData.filter(_),u=i==null?void 0:i.map(({teamCharId:h})=>{var d;return(d=l.teamChars.get(h))==null?void 0:d.key}).filter(_);return m.every(h=>u==null?void 0:u.includes(h))},name:(r,m)=>{var i;return!m||!!((i=l.teams.get(r))!=null&&i.name.toLowerCase().includes(m.toLowerCase()))}}}const xe={xs:1,sm:2,md:3,lg:3,xl:3},Se={xs:6,sm:12,md:18,lg:24,xl:24};function Oe(){const{t:l}=O(["page_teams","sillyWisher_charNames","charNames_gen"]),r=G(),[m,i]=X(),u=Z();s.useEffect(()=>r.teams.followAny((t,g)=>(g==="new"||g==="remove"||g==="update")&&i()),[i,r]);const y=()=>{const t=r.teams.new();u(t)},[o,h,d]=Y(),[b,w]=s.useState(""),D=()=>{try{const t=JSON.parse(b);r.teams.import(t)||window.alert("Data verification failed."),d()}catch(t){window.alert(`Data Import failed. ${t}`);return}},C=ee(r.displayTeam),{sortType:p,ascending:v,charKeys:I}=C,[E,a]=s.useState(C.searchTerm),n=s.useDeferredValue(E);s.useEffect(()=>{r.displayTeam.set({searchTerm:n})},[r,n]);const{teamIds:c,totalTeamNum:f}=s.useMemo(()=>{const t=r.teams.keys.length,g=r.teams.keys.filter(ne({charKeys:I,name:n},Te(r))).sort((H,U)=>le(Ce[p],v,ye())(r.teams.get(H),r.teams.get(U)));return m&&{teamIds:g,totalTeamNum:t}},[m,r,I,n,p,v]),k=ie(),{numShow:T,setTriggerElement:x}=ce(Se[k],c.length),N=s.useMemo(()=>c.slice(0,T),[c,T]),L=c.length!==f?`${c.length}/${f}`:`${f}`,j={numShowing:N.length,total:L,t:l,namespace:"page_teams"},J={sortKeys:[...se],value:p,onChange:t=>r.displayTeam.set({sortType:t}),ascending:v,onChangeAsc:t=>r.displayTeam.set({ascending:t})};return S(K,{my:1,display:"flex",flexDirection:"column",gap:1,children:[e(B,{children:S(P,{sx:{display:"flex",flexDirection:"column",gap:1},children:[S(K,{display:"flex",gap:1,alignItems:"stretch",children:[e(ge,{teamIds:c,charKeys:I,setCharKey:t=>r.displayTeam.set({charKeys:t}),acProps:{sx:{flexGrow:1}}}),e(W,{autoFocus:!0,value:E,onChange:t=>a(t.target.value),label:"Team Name",sx:{height:"100%",flexGrow:1},InputProps:{sx:{height:"100%"}}})]}),e(K,{display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",children:e(me,{showingTextProps:j,sortByButtonProps:J})})]})}),S(K,{sx:{display:"flex",gap:1},children:[e($,{fullWidth:!0,onClick:y,color:"info",startIcon:e(he,{}),children:"Add Team"}),e(re,{open:o,onClose:d,children:S(B,{children:[e(fe,{title:"Import Team"}),e(ae,{}),S(P,{sx:{display:"flex",flexDirection:"column",gap:2},children:[e(te,{children:"Import a team in JSON form below."}),e(W,{fullWidth:!0,label:"JSON Data",placeholder:"Paste your Team JSON here",value:b,onChange:t=>w(t.target.value),multiline:!0,rows:4}),e($,{startIcon:e(A,{}),disabled:!b,onClick:D,children:"Import"})]})]})}),e($,{fullWidth:!0,onClick:h,color:"info",startIcon:e(A,{}),children:"Import Team"})]}),e(s.Suspense,{fallback:e(M,{variant:"rectangular",sx:{width:"100%",height:"100%",minHeight:5e3}}),children:e(F,{container:!0,spacing:1,columns:xe,children:N.map(t=>e(F,{item:!0,xs:1,children:e(s.Suspense,{fallback:e(M,{variant:"rectangular",width:"100%",height:150}),children:e(pe,{teamId:t,bgt:"light",onClick:g=>u(`${t}${g?`/${g}`:""}`),hoverCard:!0})})},t))})}),c.length!==N.length&&e(M,{ref:t=>{t&&x(t)},sx:{borderRadius:1},variant:"rectangular",width:"100%",height:100})]})}export{Oe as default};
