import{a as Z,g as ee,s as _,_ as k,r as c,u as te,ar as Rt,as as Tt,e as oe,a8 as Ce,at as Dt,m as _t,j as $,f as U,h as re,au as Ee,P as Pt,i as It,av as At,aw as ke,b as E,ax as Se,x as Nt,l as zt,d as Bt,K as v,B as a,Z as w,W as M,D as T,ay as be,a4 as I,az as Et,ad as ot,aA as Le,ab as O,a1 as L,Y as P,aB as Lt,ae as $e,G as me,c as jt,aC as Ot,aD as Wt,aE as ue,aF as rt,ah as Me,aG as Kt,aH as Vt,ac as pe,R as je,Q as Oe,L as qt,aI as at,aJ as nt,aK as ie,aL as Gt,z as we,A as Re,aq as st,a9 as it,aM as Ut,aN as ge,I as Ht,aa as Jt,aO as Ft,aP as We,aQ as Xt,F as Qt,aR as Te,aS as Ke,aT as Yt,aU as Zt,aV as eo,aW as to,aX as oo,aY as ro,aZ as ao,a_ as Ve}from"./index-B68UCzpX.js";import{u as lt,S as ve,C as no,a as so}from"./CharacterEditor-DMoApYq1.js";import{u as io,C as lo}from"./useForceUpdate-NulqmO2p.js";import{s as co,t as uo,w as po,c as mo,l as fo,r as ho,a as go,d as bo}from"./index-2OMuYutH.js";import{u as vo}from"./useLightCone-zVEIfIzk.js";import{T as xo,d as yo,M as De,D as _e}from"./DropdownButton-CAzAKtOG.js";import{G as Co,d as ct}from"./LocationAutocomplete-BcoO6_-U.js";import{C as dt}from"./CardActionArea-D0_LirqI.js";import{u as ko,R as So}from"./RelicCard-Bc4-ZKuR.js";import{I as $o}from"./InfoTooltip-BWeH7t8O.js";function Mo(e){return Z("MuiCollapse",e)}ee("MuiCollapse",["root","horizontal","vertical","entered","hidden","wrapper","wrapperInner"]);const wo=["addEndListener","children","className","collapsedSize","component","easing","in","onEnter","onEntered","onEntering","onExit","onExited","onExiting","orientation","style","timeout","TransitionComponent"],Ro=e=>{const{orientation:t,classes:o}=e,r={root:["root",`${t}`],entered:["entered"],hidden:["hidden"],wrapper:["wrapper",`${t}`],wrapperInner:["wrapperInner",`${t}`]};return re(r,Mo,o)},To=_("div",{name:"MuiCollapse",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:o}=e;return[t.root,t[o.orientation],o.state==="entered"&&t.entered,o.state==="exited"&&!o.in&&o.collapsedSize==="0px"&&t.hidden]}})(({theme:e,ownerState:t})=>k({height:0,overflow:"hidden",transition:e.transitions.create("height")},t.orientation==="horizontal"&&{height:"auto",width:0,transition:e.transitions.create("width")},t.state==="entered"&&k({height:"auto",overflow:"visible"},t.orientation==="horizontal"&&{width:"auto"}),t.state==="exited"&&!t.in&&t.collapsedSize==="0px"&&{visibility:"hidden"})),Do=_("div",{name:"MuiCollapse",slot:"Wrapper",overridesResolver:(e,t)=>t.wrapper})(({ownerState:e})=>k({display:"flex",width:"100%"},e.orientation==="horizontal"&&{width:"auto",height:"100%"})),_o=_("div",{name:"MuiCollapse",slot:"WrapperInner",overridesResolver:(e,t)=>t.wrapperInner})(({ownerState:e})=>k({width:"100%"},e.orientation==="horizontal"&&{width:"auto",height:"100%"})),ut=c.forwardRef(function(t,o){const r=te({props:t,name:"MuiCollapse"}),{addEndListener:n,children:s,className:i,collapsedSize:d="0px",component:l,easing:u,in:p,onEnter:m,onEntered:h,onEntering:f,onExit:b,onExited:g,onExiting:C,orientation:S="vertical",style:R,timeout:y=Rt.standard,TransitionComponent:A=Tt}=r,J=oe(r,wo),W=k({},r,{orientation:S,collapsedSize:d}),N=Ro(W),F=Ce(),fe=Dt(),z=c.useRef(null),X=c.useRef(),K=typeof d=="number"?`${d}px`:d,j=S==="horizontal",Q=j?"width":"height",ne=c.useRef(null),xt=_t(o,ne),V=x=>D=>{if(x){const B=ne.current;D===void 0?x(B):x(B,D)}},he=()=>z.current?z.current[j?"clientWidth":"clientHeight"]:0,yt=V((x,D)=>{z.current&&j&&(z.current.style.position="absolute"),x.style[Q]=K,m&&m(x,D)}),Ct=V((x,D)=>{const B=he();z.current&&j&&(z.current.style.position="");const{duration:Y,easing:se}=Ee({style:R,timeout:y,easing:u},{mode:"enter"});if(y==="auto"){const Be=F.transitions.getAutoHeightDuration(B);x.style.transitionDuration=`${Be}ms`,X.current=Be}else x.style.transitionDuration=typeof Y=="string"?Y:`${Y}ms`;x.style[Q]=`${B}px`,x.style.transitionTimingFunction=se,f&&f(x,D)}),kt=V((x,D)=>{x.style[Q]="auto",h&&h(x,D)}),St=V(x=>{x.style[Q]=`${he()}px`,b&&b(x)}),$t=V(g),Mt=V(x=>{const D=he(),{duration:B,easing:Y}=Ee({style:R,timeout:y,easing:u},{mode:"exit"});if(y==="auto"){const se=F.transitions.getAutoHeightDuration(D);x.style.transitionDuration=`${se}ms`,X.current=se}else x.style.transitionDuration=typeof B=="string"?B:`${B}ms`;x.style[Q]=K,x.style.transitionTimingFunction=Y,C&&C(x)}),wt=x=>{y==="auto"&&fe.start(X.current||0,x),n&&n(ne.current,x)};return $.jsx(A,k({in:p,onEnter:yt,onEntered:kt,onEntering:Ct,onExit:St,onExited:$t,onExiting:Mt,addEndListener:wt,nodeRef:ne,timeout:y==="auto"?null:y},J,{children:(x,D)=>$.jsx(To,k({as:l,className:U(N.root,i,{entered:N.entered,exited:!p&&K==="0px"&&N.hidden}[x]),style:k({[j?"minWidth":"minHeight"]:K},R),ref:xt},D,{ownerState:k({},W,{state:x}),children:$.jsx(Do,{ownerState:k({},W,{state:x}),className:N.wrapper,ref:z,children:$.jsx(_o,{ownerState:k({},W,{state:x}),className:N.wrapperInner,children:s})})}))}))});ut.muiSupportAuto=!0;const pt=ut,Po=c.createContext({}),mt=Po;function Io(e){return Z("MuiAccordion",e)}const Ao=ee("MuiAccordion",["root","rounded","expanded","disabled","gutters","region"]),le=Ao,No=["children","className","defaultExpanded","disabled","disableGutters","expanded","onChange","square","slots","slotProps","TransitionComponent","TransitionProps"],zo=e=>{const{classes:t,square:o,expanded:r,disabled:n,disableGutters:s}=e;return re({root:["root",!o&&"rounded",r&&"expanded",n&&"disabled",!s&&"gutters"],region:["region"]},Io,t)},Bo=_(Pt,{name:"MuiAccordion",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:o}=e;return[{[`& .${le.region}`]:t.region},t.root,!o.square&&t.rounded,!o.disableGutters&&t.gutters]}})(({theme:e})=>{const t={duration:e.transitions.duration.shortest};return{position:"relative",transition:e.transitions.create(["margin"],t),overflowAnchor:"none","&::before":{position:"absolute",left:0,top:-1,right:0,height:1,content:'""',opacity:1,backgroundColor:(e.vars||e).palette.divider,transition:e.transitions.create(["opacity","background-color"],t)},"&:first-of-type":{"&::before":{display:"none"}},[`&.${le.expanded}`]:{"&::before":{opacity:0},"&:first-of-type":{marginTop:0},"&:last-of-type":{marginBottom:0},"& + &":{"&::before":{display:"none"}}},[`&.${le.disabled}`]:{backgroundColor:(e.vars||e).palette.action.disabledBackground}}},({theme:e})=>({variants:[{props:t=>!t.square,style:{borderRadius:0,"&:first-of-type":{borderTopLeftRadius:(e.vars||e).shape.borderRadius,borderTopRightRadius:(e.vars||e).shape.borderRadius},"&:last-of-type":{borderBottomLeftRadius:(e.vars||e).shape.borderRadius,borderBottomRightRadius:(e.vars||e).shape.borderRadius,"@supports (-ms-ime-align: auto)":{borderBottomLeftRadius:0,borderBottomRightRadius:0}}}},{props:t=>!t.disableGutters,style:{[`&.${le.expanded}`]:{margin:"16px 0"}}}]})),Eo=c.forwardRef(function(t,o){const r=te({props:t,name:"MuiAccordion"}),{children:n,className:s,defaultExpanded:i=!1,disabled:d=!1,disableGutters:l=!1,expanded:u,onChange:p,square:m=!1,slots:h={},slotProps:f={},TransitionComponent:b,TransitionProps:g}=r,C=oe(r,No),[S,R]=It({controlled:u,default:i,name:"Accordion",state:"expanded"}),y=c.useCallback(j=>{R(!S),p&&p(j,!S)},[S,p,R]),[A,...J]=c.Children.toArray(n),W=c.useMemo(()=>({expanded:S,disabled:d,disableGutters:l,toggle:y}),[S,d,l,y]),N=k({},r,{square:m,disabled:d,disableGutters:l,expanded:S}),F=zo(N),fe=k({transition:b},h),z=k({transition:g},f),[X,K]=ko("transition",{elementType:pt,externalForwardedProps:{slots:fe,slotProps:z},ownerState:N});return $.jsxs(Bo,k({className:U(F.root,s),ref:o,ownerState:N,square:m},C,{children:[$.jsx(mt.Provider,{value:W,children:A}),$.jsx(X,k({in:S,timeout:"auto"},K,{children:$.jsx("div",{"aria-labelledby":A.props.id,id:A.props["aria-controls"],role:"region",className:F.region,children:J})}))]}))}),qe=Eo;function Lo(e){return Z("MuiAccordionDetails",e)}ee("MuiAccordionDetails",["root"]);const jo=["className"],Oo=e=>{const{classes:t}=e;return re({root:["root"]},Lo,t)},Wo=_("div",{name:"MuiAccordionDetails",slot:"Root",overridesResolver:(e,t)=>t.root})(({theme:e})=>({padding:e.spacing(1,2,2)})),Ko=c.forwardRef(function(t,o){const r=te({props:t,name:"MuiAccordionDetails"}),{className:n}=r,s=oe(r,jo),i=r,d=Oo(i);return $.jsx(Wo,k({className:U(d.root,n),ref:o,ownerState:i},s))}),Ge=Ko;function Vo(e){return Z("MuiAccordionSummary",e)}const qo=ee("MuiAccordionSummary",["root","expanded","focusVisible","disabled","gutters","contentGutters","content","expandIconWrapper"]),q=qo,Go=["children","className","expandIcon","focusVisibleClassName","onClick"],Uo=e=>{const{classes:t,expanded:o,disabled:r,disableGutters:n}=e;return re({root:["root",o&&"expanded",r&&"disabled",!n&&"gutters"],focusVisible:["focusVisible"],content:["content",o&&"expanded",!n&&"contentGutters"],expandIconWrapper:["expandIconWrapper",o&&"expanded"]},Vo,t)},Ho=_(At,{name:"MuiAccordionSummary",slot:"Root",overridesResolver:(e,t)=>t.root})(({theme:e})=>{const t={duration:e.transitions.duration.shortest};return{display:"flex",minHeight:48,padding:e.spacing(0,2),transition:e.transitions.create(["min-height","background-color"],t),[`&.${q.focusVisible}`]:{backgroundColor:(e.vars||e).palette.action.focus},[`&.${q.disabled}`]:{opacity:(e.vars||e).palette.action.disabledOpacity},[`&:hover:not(.${q.disabled})`]:{cursor:"pointer"},variants:[{props:o=>!o.disableGutters,style:{[`&.${q.expanded}`]:{minHeight:64}}}]}}),Jo=_("div",{name:"MuiAccordionSummary",slot:"Content",overridesResolver:(e,t)=>t.content})(({theme:e})=>({display:"flex",flexGrow:1,margin:"12px 0",variants:[{props:t=>!t.disableGutters,style:{transition:e.transitions.create(["margin"],{duration:e.transitions.duration.shortest}),[`&.${q.expanded}`]:{margin:"20px 0"}}}]})),Fo=_("div",{name:"MuiAccordionSummary",slot:"ExpandIconWrapper",overridesResolver:(e,t)=>t.expandIconWrapper})(({theme:e})=>({display:"flex",color:(e.vars||e).palette.action.active,transform:"rotate(0deg)",transition:e.transitions.create("transform",{duration:e.transitions.duration.shortest}),[`&.${q.expanded}`]:{transform:"rotate(180deg)"}})),Xo=c.forwardRef(function(t,o){const r=te({props:t,name:"MuiAccordionSummary"}),{children:n,className:s,expandIcon:i,focusVisibleClassName:d,onClick:l}=r,u=oe(r,Go),{disabled:p=!1,disableGutters:m,expanded:h,toggle:f}=c.useContext(mt),b=S=>{f&&f(S),l&&l(S)},g=k({},r,{expanded:h,disabled:p,disableGutters:m}),C=Uo(g);return $.jsxs(Ho,k({focusRipple:!1,disableRipple:!0,disabled:p,component:"div","aria-expanded":h,className:U(C.root,s),focusVisibleClassName:U(C.focusVisible,d),onClick:b,ref:o,ownerState:g},u,{children:[$.jsx(Jo,{className:C.content,ownerState:g,children:n}),i&&$.jsx(Fo,{className:C.expandIconWrapper,ownerState:g,children:i})]}))}),Ue=Xo;function Qo(e){return Z("MuiLinearProgress",e)}ee("MuiLinearProgress",["root","colorPrimary","colorSecondary","determinate","indeterminate","buffer","query","dashed","dashedColorPrimary","dashedColorSecondary","bar","barColorPrimary","barColorSecondary","bar1Indeterminate","bar1Determinate","bar1Buffer","bar2Indeterminate","bar2Buffer"]);const Yo=["className","color","value","valueBuffer","variant"];let H=e=>e,He,Je,Fe,Xe,Qe,Ye;const xe=4,Zo=ke(He||(He=H`
  0% {
    left: -35%;
    right: 100%;
  }

  60% {
    left: 100%;
    right: -90%;
  }

  100% {
    left: 100%;
    right: -90%;
  }
`)),er=ke(Je||(Je=H`
  0% {
    left: -200%;
    right: 100%;
  }

  60% {
    left: 107%;
    right: -8%;
  }

  100% {
    left: 107%;
    right: -8%;
  }
`)),tr=ke(Fe||(Fe=H`
  0% {
    opacity: 1;
    background-position: 0 -23px;
  }

  60% {
    opacity: 0;
    background-position: 0 -23px;
  }

  100% {
    opacity: 1;
    background-position: -200px -23px;
  }
`)),or=e=>{const{classes:t,variant:o,color:r}=e,n={root:["root",`color${E(r)}`,o],dashed:["dashed",`dashedColor${E(r)}`],bar1:["bar",`barColor${E(r)}`,(o==="indeterminate"||o==="query")&&"bar1Indeterminate",o==="determinate"&&"bar1Determinate",o==="buffer"&&"bar1Buffer"],bar2:["bar",o!=="buffer"&&`barColor${E(r)}`,o==="buffer"&&`color${E(r)}`,(o==="indeterminate"||o==="query")&&"bar2Indeterminate",o==="buffer"&&"bar2Buffer"]};return re(n,Qo,t)},Pe=(e,t)=>t==="inherit"?"currentColor":e.vars?e.vars.palette.LinearProgress[`${t}Bg`]:e.palette.mode==="light"?zt(e.palette[t].main,.62):Bt(e.palette[t].main,.5),rr=_("span",{name:"MuiLinearProgress",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:o}=e;return[t.root,t[`color${E(o.color)}`],t[o.variant]]}})(({ownerState:e,theme:t})=>k({position:"relative",overflow:"hidden",display:"block",height:4,zIndex:0,"@media print":{colorAdjust:"exact"},backgroundColor:Pe(t,e.color)},e.color==="inherit"&&e.variant!=="buffer"&&{backgroundColor:"none","&::before":{content:'""',position:"absolute",left:0,top:0,right:0,bottom:0,backgroundColor:"currentColor",opacity:.3}},e.variant==="buffer"&&{backgroundColor:"transparent"},e.variant==="query"&&{transform:"rotate(180deg)"})),ar=_("span",{name:"MuiLinearProgress",slot:"Dashed",overridesResolver:(e,t)=>{const{ownerState:o}=e;return[t.dashed,t[`dashedColor${E(o.color)}`]]}})(({ownerState:e,theme:t})=>{const o=Pe(t,e.color);return k({position:"absolute",marginTop:0,height:"100%",width:"100%"},e.color==="inherit"&&{opacity:.3},{backgroundImage:`radial-gradient(${o} 0%, ${o} 16%, transparent 42%)`,backgroundSize:"10px 10px",backgroundPosition:"0 -23px"})},Se(Xe||(Xe=H`
    animation: ${0} 3s infinite linear;
  `),tr)),nr=_("span",{name:"MuiLinearProgress",slot:"Bar1",overridesResolver:(e,t)=>{const{ownerState:o}=e;return[t.bar,t[`barColor${E(o.color)}`],(o.variant==="indeterminate"||o.variant==="query")&&t.bar1Indeterminate,o.variant==="determinate"&&t.bar1Determinate,o.variant==="buffer"&&t.bar1Buffer]}})(({ownerState:e,theme:t})=>k({width:"100%",position:"absolute",left:0,bottom:0,top:0,transition:"transform 0.2s linear",transformOrigin:"left",backgroundColor:e.color==="inherit"?"currentColor":(t.vars||t).palette[e.color].main},e.variant==="determinate"&&{transition:`transform .${xe}s linear`},e.variant==="buffer"&&{zIndex:1,transition:`transform .${xe}s linear`}),({ownerState:e})=>(e.variant==="indeterminate"||e.variant==="query")&&Se(Qe||(Qe=H`
      width: auto;
      animation: ${0} 2.1s cubic-bezier(0.65, 0.815, 0.735, 0.395) infinite;
    `),Zo)),sr=_("span",{name:"MuiLinearProgress",slot:"Bar2",overridesResolver:(e,t)=>{const{ownerState:o}=e;return[t.bar,t[`barColor${E(o.color)}`],(o.variant==="indeterminate"||o.variant==="query")&&t.bar2Indeterminate,o.variant==="buffer"&&t.bar2Buffer]}})(({ownerState:e,theme:t})=>k({width:"100%",position:"absolute",left:0,bottom:0,top:0,transition:"transform 0.2s linear",transformOrigin:"left"},e.variant!=="buffer"&&{backgroundColor:e.color==="inherit"?"currentColor":(t.vars||t).palette[e.color].main},e.color==="inherit"&&{opacity:.3},e.variant==="buffer"&&{backgroundColor:Pe(t,e.color),transition:`transform .${xe}s linear`}),({ownerState:e})=>(e.variant==="indeterminate"||e.variant==="query")&&Se(Ye||(Ye=H`
      width: auto;
      animation: ${0} 2.1s cubic-bezier(0.165, 0.84, 0.44, 1) 1.15s infinite;
    `),er)),ir=c.forwardRef(function(t,o){const r=te({props:t,name:"MuiLinearProgress"}),{className:n,color:s="primary",value:i,valueBuffer:d,variant:l="indeterminate"}=r,u=oe(r,Yo),p=k({},r,{color:s,variant:l}),m=or(p),h=Nt(),f={},b={bar1:{},bar2:{}};if((l==="determinate"||l==="buffer")&&i!==void 0){f["aria-valuenow"]=Math.round(i),f["aria-valuemin"]=0,f["aria-valuemax"]=100;let g=i-100;h&&(g=-g),b.bar1.transform=`translateX(${g}%)`}if(l==="buffer"&&d!==void 0){let g=(d||0)-100;h&&(g=-g),b.bar2.transform=`translateX(${g}%)`}return $.jsxs(rr,k({className:U(m.root,n),ownerState:p,role:"progressbar"},f,{ref:o},u,{children:[l==="buffer"?$.jsx(ar,{className:m.dashed,ownerState:p}):null,$.jsx(nr,{className:m.bar1,ownerState:p,style:b.bar1}),l==="determinate"?null:$.jsx(sr,{className:m.bar2,ownerState:p,style:b.bar2})]}))}),lr=ir;function cr({avatar:e,title:t,action:o}){return v(M,{display:"flex",gap:1,p:2,alignItems:"center",children:[e,a(w,{variant:"subtitle1",sx:{flexGrow:1},children:t}),o&&a(w,{variant:"caption",children:o})]})}function dr({condition:e,wrapper:t,falseWrapper:o,children:r}){return e?t(r):o?o(r):r}function Ze({value:e,onChange:t,...o}){const[r,n]=c.useState(e);c.useEffect(()=>{n(e)},[e]);const s=()=>t(r);return a(xo,{value:r,onChange:i=>n(i.target.value),onBlur:s,onKeyDown:i=>i.key==="Enter"&&!o.multiline&&s(),...o})}function ur(e){const{t}=T("ui"),o=be({path:"/:page/*"}),r=t("pageTitle"),n=e??((o==null?void 0:o.params.page)&&t(`tabs.${o==null?void 0:o.params.page}`));c.useEffect(()=>{n?document.title=`${n} - ${r}`:document.title=r},[t,r,n])}function Ie(e,t){const[o,r]=io(),n=c.useMemo(()=>o&&e.get(t),[o,e,t]);return c.useEffect(()=>e.follow(t,r),[e,t,r]),n}function pr(e){const{database:t}=I();return Ie(t.builds,e??"")}function ft(e){const t=c.useMemo(()=>e||Et(ot,()=>""),[e]),{database:o}=I(),[r,n]=c.useState(()=>Le(t,s=>o.relics.get(s)));return c.useEffect(()=>{n(Le(t,i=>o.relics.get(i)));const s=Object.values(t).map(i=>o.relics.follow(i,(d,l,u)=>{l==="update"&&n(p=>({...p,[u.slotKey]:u})),l==="remove"&&n(p=>({...p,[u.slotKey]:void 0}))}));return()=>s.forEach(i=>i())},[o,t]),r}function G(e){const{database:t}=I();return Ie(t.loadouts,e??"")}function ht(e){const{database:t}=I();return Ie(t.teams,e)}function mr({slot:e}){const{t}=T("relic");return a(L,{sx:{height:"100%"},children:v(O,{children:[v(w,{children:[t("slot"),": ",e]}),a(w,{children:t("empty")})]})})}function fr({build:e}){const t=ft(e);return a(P,{container:!0,columns:3,spacing:1,children:ot.map(o=>{const r=t[o];return a(P,{item:!0,xs:1,children:r?a(So,{relic:r}):a(mr,{slot:o})},`${o}_${r==null?void 0:r.id}`)})})}function hr({charKey:e,setCharKey:t}){const{t:o}=T(["character","charNames_gen"]),{database:r}=I(),n=c.useCallback(d=>!!r.chars.get(d),[r.chars]),s=c.useCallback(d=>r.charMeta.get(d).favorite,[r.charMeta]),i=c.useMemo(()=>[{key:"",label:o("character:autocomplete.none")},...Lt.map(d=>({key:d,label:o(`charNames_gen:${d}`),favorite:s(d),color:n(d)?void 0:"secondary"}))],[n,s,o]);return a(c.Suspense,{fallback:a($e,{variant:"text",width:100}),children:a(Co,{options:i,toImg:()=>a(me,{children:" "}),valueKey:e,onChange:d=>t(d??"")})})}const gr=jt($.jsx("path",{d:"M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zm2.46-7.12 1.41-1.41L12 12.59l2.12-2.12 1.41 1.41L13.41 14l2.12 2.12-1.41 1.41L12 15.41l-2.12 2.12-1.41-1.41L10.59 14l-2.13-2.12zM15.5 4l-1-1h-5l-1 1H5v2h14V4z"}),"DeleteForever"),br={RuanMei:Ot};function vr({document:e,bgt:t="normal",collapse:o=!1}){switch(e.type){case"fields":return a(xr,{fieldsDocument:e,bgt:t});case"text":return o?a(Cr,{textDocument:e}):a(yr,{textDocument:e});case"conditional":return null;default:return null}}function xr({fieldsDocument:e,bgt:t="normal"}){return v(L,{bgt:t,children:[e.header&&a(kr,{header:e.header,hideDivider:e.fields.length===0}),a(Wt,{bgt:t,fields:e.fields})]})}function yr({textDocument:e}){return a("div",{children:e.text})}function Cr({textDocument:e}){const[t,o]=c.useState(!1),[r,n]=c.useState(!1);return v(M,{sx:{position:"relative"},children:[!t&&a(M,{sx:{pointerEvents:"none",position:"absolute",mx:"auto",width:"100%",display:"flex",justifyContent:"center",height:"100%",alignItems:"flex-end",zIndex:"10",transition:"transform 0.3s ease",transform:r?"translate(0,-5px)":void 0},children:a(yo,{})}),a(pt,{onMouseEnter:()=>n(!0),onMouseLeave:()=>n(!1),collapsedSize:55,onClick:()=>o(s=>!s),in:t,sx:{cursor:"pointer",position:"relative",maskImage:t?void 0:"linear-gradient(to bottom, black 0%, transparent 100%)","&:hover":{maskImage:t?void 0:"linear-gradient(to bottom, black 50%, transparent 100%)"}},children:a("div",{children:e.text})})]})}function kr({header:e,hideDivider:t}){const{icon:o,text:r,additional:n}=e;return v(me,{children:[a(cr,{avatar:o,title:r,action:n}),!t&&a(ue,{})]})}function ae(){return c.useContext(rt)}function gt({optTarget:e,setOptTarget:t}){const{t:o}=T("optimize"),r=ae();return a(_e,{title:`${o("optTarget")}${e?`: ${e.tag.name||e.tag.q}`:""}`,children:r==null?void 0:r.listFormulas(Me.listing.formulas).map((n,s)=>a(De,{onClick:()=>t(n),children:n.tag.name||n.tag.q},`${s}_${n.tag.name||n.tag.q}`))})}function Sr({statFilters:e,setStatFilters:t,disabled:o=!1}){const r=c.useCallback((l,u,p)=>{const m={...e},h=JSON.stringify(u),f=u?[...e[h]]:void 0,b=JSON.stringify(l),g=[...e[b]??[]];p!==void 0&&f?g.push(f[p]):g.push({minValue:0,maxValue:0,disabled:!1}),m[b]=g,p!==void 0&&f&&(f.splice(p,1),f.length?m[h]=f:delete m[h]),t({...m})},[t,e]),n=c.useCallback((l,u)=>{const p={...e},m=JSON.stringify(l),h=[...e[m]];h.splice(u,1),h.length?p[m]=h:delete p[m],t({...p})},[t,e]),s=c.useCallback((l,u,p)=>{const m={...e},h=JSON.stringify(l),f=[...e[h]];f[u]={...f[u],minValue:p},m[h]=f,t({...m})},[t,e]),i=c.useCallback((l,u,p)=>{const m={...e},h=JSON.stringify(l),f=[...e[h]];f[u]={...f[u],maxValue:p},m[h]=f,t({...m})},[t,e]),d=c.useCallback((l,u,p)=>{const m={...e},h=JSON.stringify(l),f=[...e[h]];f[u]={...f[u],disabled:p},m[h]=f,t({...m})},[t,e]);return v(me,{children:[Object.entries(e).flatMap(([l,u])=>u==null?void 0:u.map((p,m)=>a(et,{path:JSON.parse(l),setting:p,index:m,setTarget:r,delTarget:n,setMinValue:s,setMaxValue:i,setDisabled:d,disabled:o},l+m))),a(et,{delTarget:n,setTarget:r,setMinValue:s,setMaxValue:i,setDisabled:d,disabled:o})]})}function et({path:e,setting:t,index:o,delTarget:r,setMinValue:n,setMaxValue:s,setDisabled:i,disabled:d}){const{t:l}=T("page_character_optimize"),u=c.useCallback(b=>e&&o!==void 0&&n(e,o,b??0),[n,e,o]),p=c.useCallback(b=>e&&o!==void 0&&s(e,o,b??1/0),[s,e,o]),[m,h]=c.useState(void 0),f={p:1,flexBasis:30,flexGrow:0,flexShrink:0};return v(qt,{sx:{"& .MuiButtonGroup-grouped":{minWidth:24},width:"100%"},children:[!!t&&!!e&&o!==void 0&&a(pe,{sx:f,color:t.disabled?"secondary":"success",onClick:()=>i(e,o,!t.disabled),disabled:d,children:t.disabled?a(Kt,{}):a(Vt,{})}),a(Oe,{sx:{flexBasis:150,flexGrow:1},children:a(je,{float:!0,disabled:!e||d,value:t==null?void 0:t.minValue,placeholder:l("buildConstraint.minStatValue"),onChange:u,sx:{px:1},inputProps:{sx:{"& + .MuiOutlinedInput-notchedOutline":{borderRadius:0},textAlign:"right"}}})}),a(gt,{optTarget:m,setOptTarget:h}),a(Oe,{sx:{flexBasis:150,flexGrow:1},children:a(je,{float:!0,disabled:!e||d,value:t==null?void 0:t.maxValue,placeholder:l("buildConstraint.maxStatValue"),onChange:p,sx:{px:1},inputProps:{sx:{"& + .MuiOutlinedInput-notchedOutline":{borderRadius:0},textAlign:"left"}}})}),!!e&&o!==void 0&&a(pe,{sx:f,color:"error",onClick:()=>r(e,o),disabled:d,children:a(gr,{fontSize:"small"})})]})}function $r({disabled:e=!1}){const{t}=T("page_character_optimize"),[o,r]=c.useState({});return a(M,{children:v(L,{bgt:"light",children:[a(O,{sx:{display:"flex",gap:1,justifyContent:"space-between",flexDirection:"column"},children:v(M,{display:"flex",justifyContent:"space-between",children:[a(w,{sx:{fontWeight:"bold"},children:t`constraintFilter.title`}),a($o,{title:a(w,{children:t`constraintFilter.tooltip`})})]})}),a(ue,{}),a(M,{display:"flex",flexDirection:"column",gap:.5,children:a(Sr,{statFilters:o,setStatFilters:r,disabled:e})})]})})}function Mr({numWorkers:e,setNumWorkers:t}){const{t:o}=T("optimize"),r=navigator.hardwareConcurrency||8;return a(_e,{title:`${o("numWorkers")}: ${e}`,children:at(1,r).map(n=>a(De,{onClick:()=>t(n),children:o("workers",{count:n})},n))})}function wr({teamId:e,src:t,children:o}){var g,C,S,R;const r=ht(e),n=G((g=r.loadoutMetadata[0])==null?void 0:g.loadoutId),s=G((C=r.loadoutMetadata[1])==null?void 0:C.loadoutId),i=G((S=r.loadoutMetadata[2])==null?void 0:S.loadoutId),d=G((R=r.loadoutMetadata[3])==null?void 0:R.loadoutId),l=c.useMemo(()=>{const y={all:"all"};return n&&(y[n.key]="0"),s&&(y[s.key]="1"),i&&(y[i.key]="2"),d&&(y[d.key]="3"),y},[n,s,i,d]),u=ce(r.loadoutMetadata[0],l),p=ce(r.loadoutMetadata[1],l),m=ce(r.loadoutMetadata[2],l),h=ce(r.loadoutMetadata[3],l),f=c.useMemo(()=>co([...uo(r.loadoutMetadata.map((y,A)=>y===void 0?void 0:nt[A]).filter(y=>!!y)),...u?de(0,u):[],...p?de(1,p):[],...m?de(2,m):[],...h?de(3,h):[],ie.common.lvl.add(80),ie.common.res.add(.1),ie.common.isBroken.add(0),ie.common.maxToughness.add(100),Gt.common.critMode.add("avg")]),[u,p,m,h,r.loadoutMetadata]),b=c.useMemo(()=>(f==null?void 0:f.withTag({src:t}))??null,[f,t]);return a(rt.Provider,{value:b,children:o})}function ce(e,t){const o=G(e==null?void 0:e.loadoutId),r=lt(o==null?void 0:o.key),n=pr(e==null?void 0:e.buildId),s=vo(n==null?void 0:n.lightConeId),i=ft(n==null?void 0:n.relicIds),d=c.useMemo(()=>Object.fromEntries(Object.entries((o==null?void 0:o.conditional)??{}).map(([l,u])=>[t[l],u])),[o,t]);return c.useMemo(()=>({character:r,lightCone:s,relics:i,conditionals:d}),[r,s,d,i])}function de(e,{character:t,lightCone:o,relics:r,conditionals:n}){return t?[...po(`${e}`,...mo(t),...fo(o),...ho(Object.values(r).filter(s=>!!s).map(s=>({set:s.setKey,stats:[...s.substats.filter(({key:i})=>i!=="").map(i=>({key:i.key,value:i.accurateValue})),{key:s.mainStatKey,value:s.mainStatVal}]})))),...go(`${e}`,n)]:[]}var Ae={},Rr=Re;Object.defineProperty(Ae,"__esModule",{value:!0});var bt=Ae.default=void 0,Tr=Rr(we()),Dr=$,_r=(0,Tr.default)((0,Dr.jsx)("path",{d:"M22 24H2v-4h20v4zM13.06 5.19l3.75 3.75L7.75 18H4v-3.75l9.06-9.06zm4.82 2.68-3.75-3.75 1.83-1.83c.39-.39 1.02-.39 1.41 0l2.34 2.34c.39.39.39 1.02 0 1.41l-1.83 1.83z"}),"BorderColor");bt=Ae.default=_r;function Pr({teamId:e,charKey:t,tab:o=""}){const{t:r}=T("page_team"),n=st(),{database:s}=I(),i=s.teams.get(e),{loadoutMetadata:d}=i,l=Ce(),u=it(l.breakpoints.down("md")),[p,m]=c.useState(!1),h=b=>{s.teams.set(e,{name:b})},f=b=>{s.teams.set(e,{description:b})};return v(M,{sx:()=>({borderBottom:"1px rgb(200,200,200,0.3) solid","& .MuiTab-root:hover":{transition:"background-color 0.25s ease",backgroundColor:"rgba(255,255,255,0.1)"},"& .Mui-selected":{color:"white !important"},"& .MuiTabs-indicator":{height:"4px",backgroundColor:"rgb(200,200,200,0.5)"}}),children:[a(dt,{onClick:()=>m(!0),children:a(Ut,{placement:"top",title:v(M,{children:[v(M,{sx:{display:"flex",color:"info.light",gap:1},children:[a(bt,{}),a(w,{children:a("strong",{children:r`team.editNameDesc`})})]}),!!i.description&&a(w,{children:i.description})]}),children:a(O,{sx:{display:"flex",justifyContent:"center","&:hover":{color:"info.light"}},children:v(w,{variant:"h5",sx:{display:"flex",gap:1,alignItems:"center",justifyContent:"center",textShadow:"#000 0 0 10px !important"},children:[a(ge,{}),i.name]})})})}),a(Jt,{open:p,onClose:()=>m(!1),children:v(L,{children:[a(lo,{title:r`team.editNameDesc`,avatar:a(ge,{}),titleTypographyProps:{variant:"h6"},action:a(Ht,{onClick:()=>m(!1),children:a(ct,{})})}),a(ue,{}),a(O,{children:v(M,{display:"flex",flexDirection:"column",gap:2,sx:{mt:2},children:[a(Ze,{label:r`team.name`,value:i.name,onChange:b=>h(b),autoFocus:!0}),a(Ze,{label:r`team.desc`,value:i.description,onChange:b=>f(b),multiline:!0,minRows:4})]})})]})}),a(ue,{}),v(Ft,{variant:"fullWidth",value:t??"team",orientation:u?"vertical":"horizontal",children:[a(We,{icon:a(ge,{}),iconPosition:"start",value:"team",label:"Team Settings",onClick:()=>n(`/teams/${e}/`)}),d.map((b,g)=>{var S;const C=b&&((S=s.loadouts.get(b==null?void 0:b.loadoutId))==null?void 0:S.key);return a(We,{icon:a(Xt,{}),iconPosition:"start",value:C??g,disabled:!d[g],label:C?a(w,{children:r(`charNames_gen:${C}`)}):`Character ${g+1}`,onClick:()=>C&&n(`/teams/${e}/${C}/${o}`)},g)})]})]})}function Ir({teamId:e}){const{database:t}=I(),o=t.teams.get(e);return v(M,{children:[e,o.loadoutMetadata.map((r,n)=>a(Ar,{loadoutMetadataIndex:n,teamId:e},`${n}_${r==null?void 0:r.loadoutId}`))]})}function Ar({loadoutMetadataIndex:e,teamId:t}){var d;const{database:o}=I(),r=o.teams.get(t),n=(d=r.loadoutMetadata[e])==null?void 0:d.loadoutId,s=o.loadouts.get(n);function i(l){if(l===""){o.teams.set(t,p=>p.loadoutMetadata[e]=void 0);return}o.chars.getOrCreate(l);const u=r.loadoutMetadata.findIndex(p=>{var m;return p&&((m=o.loadouts.get(p.loadoutId))==null?void 0:m.key)===l});if(u===-1){let p=o.loadouts.keys.find(m=>o.loadouts.get(m).key===l);p||(p=o.loadouts.new(l)),o.teams.set(t,m=>{m.loadoutMetadata[e]={loadoutId:p}})}else{if(u===e)return;const p=r.loadoutMetadata[u],m=r.loadoutMetadata[e];o.teams.set(t,h=>{h.loadoutMetadata[e]=p,h.loadoutMetadata[u]=m})}}return a(hr,{charKey:(s==null?void 0:s.key)??"",setCharKey:i})}var Ne={},Nr=Re;Object.defineProperty(Ne,"__esModule",{value:!0});var ye=Ne.default=void 0,zr=Nr(we()),Br=$,Er=(0,zr.default)((0,Br.jsx)("path",{d:"M16.59 8.59 12 13.17 7.41 8.59 6 10l6 6 6-6z"}),"ExpandMore");ye=Ne.default=Er;const Lr=5e4;class jr{constructor(t,o,r,n,s){this.calc=t,this.optTarget=o,this.relicsBySlot=r,this.numWorkers=n,this.setProgress=s,this.worker=new Worker(new URL(""+new URL("parentWorker-CAAYnoOP.js",import.meta.url).href,import.meta.url),{type:"module"})}async optimize(){return await new Promise((o,r)=>{this.worker.onmessage=({data:s})=>{switch(s.resultType){case"progress":this.setProgress(s.progress);break;case"done":o(s.buildResults);break;case"err":console.log(s),r();break}};const n={command:"start",relicsBySlot:this.relicsBySlot,detachedNodes:this.detachNodes(),numWorkers:this.numWorkers};this.worker.postMessage(n)})}async terminate(){const t={command:"terminate"};this.worker.postMessage(t),await new Promise((o,r)=>{this.worker.onmessage=({data:n})=>{switch(n.resultType){case"terminated":o();break;case"err":console.log(n),r();break}}}),this.worker.terminate()}detachNodes(){const t=new Set(Qt);return bo([this.optTarget],this.calc,r=>{if(r.src==="0"&&r.et==="own"){if(r.sheet==="dyn"&&r.qt==="premod")return{q:r.q};if(r.q==="count"&&t.has(r.sheet))return{q:r.sheet}}})}}var ze={},Or=Re;Object.defineProperty(ze,"__esModule",{value:!0});var vt=ze.default=void 0,Wr=Or(we()),Kr=$,Vr=(0,Wr.default)((0,Kr.jsx)("path",{d:"m16 6 2.29 2.29-4.88 4.88-4-4L2 16.59 3.41 18l6-6 4 4 6.3-6.29L22 12V6z"}),"TrendingUp");vt=ze.default=Vr;function qr(){const{t:e}=T("optimize"),{database:t}=I(),o=ae(),[r,n]=c.useState(8),[s,i]=c.useState(void 0),[d,l]=c.useState(void 0),u=c.useMemo(()=>t.relics.values.reduce((R,y)=>(R[y.slotKey].push(y),R),{head:[],hands:[],feet:[],body:[],sphere:[],rope:[]}),[t.relics.values]),p=Object.values(u).reduce((R,y)=>R*y.length,1),[m,h]=c.useState(void 0),[f,b]=c.useState(!1),g=c.useRef(()=>{});c.useEffect(()=>()=>g.current(),[]);const C=c.useCallback(async()=>{if(!d||!o)return;const R=new Promise(J=>g.current=J);i(void 0),b(!0);const y=new jr(o,d,u,r,i);R.then(async()=>await y.terminate());const A=await y.optimize();await y.terminate(),g.current=()=>{},b(!1),h(A[0])},[o,r,d,u]),S=c.useCallback(()=>{g.current(),b(!1)},[g]);return a(L,{bgt:"dark",children:v(O,{children:[a($r,{}),v(ve,{children:[a(w,{variant:"h5",children:e("optimize")}),v(M,{children:[a(gt,{optTarget:d,setOptTarget:l}),a(Mr,{numWorkers:r,setNumWorkers:n}),a(pe,{onClick:f?S:C,color:f?"error":"primary",startIcon:f?a(ct,{}):a(vt,{}),children:e(f?"cancel":"optimize")})]}),s&&a(Gr,{progress:s,totalPermutations:p}),m&&v(M,{children:[v(w,{children:["Best: ",m.value]}),a(fr,{build:m.ids})]})]})]})})}function Gr({progress:e,totalPermutations:t}){const{t:o}=T("optimize");return v(M,{children:[v(w,{children:[o("totalProgress"),": ",e.numBuildsComputed.toLocaleString()," /"," ",t.toLocaleString()]}),v(w,{children:[o("buildsKept"),": ",e.numBuildsKept.toLocaleString()," /"," ",Lr.toLocaleString()]}),a(lr,{variant:"determinate",value:e.numBuildsComputed/t*100})]})}const Ur={xs:12,sm:6,md:4};function Hr(){const{loadout:{key:e}}=Te(),t=ae(),{t:o}=T("sheet_gen"),r=[["basic",o("talents.basic")],["skill",o("talents.skill")],["ultimate",o("talents.ultimate")]],n=Ce(),s=it(n.breakpoints.up("lg")),i=br[e];if(console.log({characterSheet:i,calc:t}),!(!i||!t))return a(me,{children:v(P,{container:!0,spacing:1,children:[s&&a(P,{item:!0,xs:12,md:12,lg:3,sx:{display:"flex",flexDirection:"column",gap:1},children:a(tt,{})}),a(P,{item:!0,xs:12,md:12,lg:9,container:!0,spacing:1,children:r.map(([d,l])=>{const u=i[d];return u?a(P,{item:!0,...Ur,children:a(Jr,{talentKey:d,subtitle:l,sheetElement:u})},d):null})}),!s&&a(P,{item:!0,xs:12,md:12,lg:3,container:!0,spacing:1,children:a(P,{item:!0,xs:12,children:a(tt,{})})})]})})}function Jr({sheetElement:e,subtitle:t,onClickTitle:o}){const r=c.useCallback(s=>a(dt,{onClick:o,children:s}),[o]);let n=null;return n=null,v(L,{bgt:"light",sx:{height:"100%"},children:[n,v(O,{children:[a(dr,{condition:!!o,wrapper:r,children:v(P,{container:!0,sx:{flexWrap:"nowrap"},children:[a(P,{item:!0,children:a(M,{component:Ke?Ke:"img",src:e==null?void 0:e.img,sx:{width:60,height:"auto"}})}),v(P,{item:!0,flexGrow:1,sx:{pl:1},children:[a(w,{variant:"h6",children:e==null?void 0:e.name}),a(w,{variant:"subtitle1",children:t})]})]})}),e.documents.map((s,i)=>a(vr,{document:s,collapse:!0},i))]})]})}function tt(){const{t:e}=T("sheet_gen"),t=ae();if(!t)return null;const o=t.compute(Me.char.eidolon).val;return a(_e,{fullWidth:!0,title:e("constellationLvl",{level:o}),color:"primary",children:at(0,Yt).map(r=>a(De,{selected:o===r,disabled:o===r,onClick:()=>{},children:e("constellationLvl",{level:r})},r))})}function Fr({tab:e}){const{loadout:{key:t}}=Te(),{character:o}=Zt(),r=ae(),[n,s]=c.useState(void 0);return v(M,{children:[e,a(no,{characterKey:n,onClose:()=>s(void 0)}),a(so,{character:o}),v(ve,{gap:1,pt:1,children:[a(L,{bgt:"dark",children:v(O,{children:[a(pe,{disabled:!t,onClick:()=>t&&s(t),children:"Edit Character"}),v(qe,{children:[a(Ue,{expandIcon:a(ye,{}),children:"All target values, if sheet is created"}),a(Ge,{children:a(ve,{children:r==null?void 0:r.listFormulas(Me.listing.formulas).map((i,d)=>{const l=r.compute(i),u=i.tag.name||i.tag.q;return v(M,{children:[v(w,{children:[u,": ",l.val]}),v(qe,{children:[v(Ue,{expandIcon:a(ye,{}),children:["debug for ",u]}),a(Ge,{children:a(w,{component:"pre",children:JSON.stringify(r.toDebug().compute(i),void 0,2)})})]})]},`${u}${d}`)})})})]})]})}),a(Hr,{}),a(qr,{})]})]})}const Xr=a($e,{variant:"rectangular",width:"100%",height:1e3});function ca(){const{database:e}=I(),{teamId:t}=eo(),o=!t||!e.teams.keys.includes(t);return c.useEffect(()=>{o||e.teams.set(t,{lastEdit:Date.now()})},[t,e.teams,o]),o?a(ro,{to:"/teams"}):a(M,{display:"flex",flexDirection:"column",gap:1,children:a(c.Suspense,{fallback:Xr,children:t&&a(Qr,{teamId:t})})})}function Qr({teamId:e}){var b;const{database:t}=I(),o=st(),r=ht(e),{loadoutMetadata:n}=r,{params:{characterKey:s}}=be({path:"/teams/:teamId/:characterKey",end:!1})??{params:{}},{params:{tab:i}}=be({path:"/teams/:teamId/:characterKey/:tab"})??{params:{}},d=c.useMemo(()=>n.findIndex(g=>{var C;return(g==null?void 0:g.loadoutId)&&((C=t.loadouts.get(g.loadoutId))==null?void 0:C.key)===s}),[n,t.loadouts,s]),l=c.useMemo(()=>n[d],[n,d]);c.useEffect(()=>{window.scrollTo({top:0})},[]),c.useEffect(()=>{l||o("",{replace:!0})},[l,o]);const u=l==null?void 0:l.loadoutId,p=(b=t.loadouts.get(u))==null?void 0:b.key,{t:m}=T(["charNames_gen","page_character"]);ur(c.useMemo(()=>{const g=m(p?"charNames_gen:Character":"Team Settings"),C=i?m(`page_character:tabs.${i}`):p?m("Loadout/Build"):i;return`${r.name} - ${g}${C?` - ${C}`:""}`},[p,m,i,r.name]));const h=G(u??""),f=c.useMemo(()=>{if(!(!u||!h||!l))return{teamId:e,team:r,loadoutId:u,loadout:h,loadoutMetadatum:l}},[l,r,h,u,e]);return a(wr,{teamId:e,src:nt[d],children:v(M,{sx:{display:"flex",gap:1,flexDirection:"column",mx:1,mt:2},children:[a(L,{children:a(Pr,{teamId:e,charKey:p,tab:i})}),a(M,{children:f?a(to.Provider,{value:f,children:a(Yr,{})}):a(Ir,{teamId:e})})]})})}function Yr({tab:e}){const{loadout:{key:t}}=Te(),o=lt(t),r=c.useMemo(()=>o&&{character:o},[o]);return r?a(oo.Provider,{value:r,children:a(ao,{children:a(Ve,{path:":characterKey",children:a(Ve,{path:"*",index:!0,element:a(Fr,{tab:e})})})})}):a($e,{variant:"rectangular",width:"100%",height:1e3})}export{ca as default};
