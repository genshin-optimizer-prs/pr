"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[396],{8660:(e,t,n)=>{n.d(t,{Z:()=>h});var i=n(98283),a=n(94380),l=n(11141),r=n(76111),s=n(36674),o=n(52903);let c,d=e=>e;const u=["rarity","onChange","filter"];function h(e){let{rarity:t,onChange:n,filter:h}=e,Z=(0,i.Z)(e,u);const{t:p}=(0,l.$G)("artifact");return(0,o.tZ)(r.Z,Object.assign({},Z,{title:t?(0,o.tZ)(s.q,{stars:t,inline:!0}):p(c||(c=d`editor.rarity`)),color:t?"success":"primary",children:[5,4,3].map((e=>(0,o.tZ)(a.Z,{disabled:!h(e),onClick:()=>n(e),children:(0,o.tZ)(s.q,{stars:e,inline:!0})},e)))}))}},47712:(e,t,n)=>{n.d(t,{Z:()=>g});var i=n(98283),a=n(80422),l=n(67550),r=n(38951),s=n(2784),o=n(11141),c=n(4121),d=n(51576),u=n(75958),h=n(79410),Z=n(36674),p=n(86873),m=n(52903);const f=["artSetKey","setArtSetKey","label"];function g(e){let{artSetKey:t,setArtSetKey:n,label:g=""}=e,x=(0,i.Z)(e,f);const{t:b}=(0,o.$G)(["artifact","artifactNames_gen"]);g=g||b("artifact:autocompleteLabels.set");const v=(0,s.useMemo)((()=>Object.entries(c.WO).flatMap((([e,t])=>t.map((t=>({key:t,label:b(`artifactNames_gen:${t}`),grouper:+e}))))).sort(p.Z)),[b]),y=(0,s.useCallback)((e=>e?(0,m.tZ)(h.Z,{src:(0,d.jU)(e),size:2}):void 0),[]),C=(0,s.useCallback)((e=>n(null!=e?e:"")),[n]);return(0,m.tZ)(u._,Object.assign({options:v,valueKey:t,onChange:C,toImg:y,label:g,groupBy:e=>{var t,n;return null!=(t=null==(n=e.grouper)?void 0:n.toString())?t:""},renderGroup:e=>e.group&&(0,m.BX)(a.Z,{component:l.Z,children:[(0,m.BX)(r.Z,{sx:{top:"-1em"},children:[e.group," ",(0,m.tZ)(Z.q,{stars:+e.group,inline:!0})]},`${e.group}Header`),e.children]},e.group)},x))}},13900:(e,t,n)=>{n.d(t,{Z:()=>c});var i=n(98283),a=n(65992),l=n(83249),r=n(52903);const s=["children","disabled"],o=(0,a.ZP)(l.Z)((({theme:e})=>({"&.Mui-disabled":{backgroundColor:e.palette.primary.dark,color:e.palette.text.secondary}})));function c(e){let{children:t}=e,n=(0,i.Z)(e,s);return(0,r.tZ)(o,Object.assign({},n,{disabled:!0,children:t}))}},1110:(e,t,n)=>{n.r(t),n.d(t,{default:()=>ws});var i=n(42579),a=n(31653),l=n(83568),r=n(15944),s=n(67550),o=n(79906),c=n(7671),d=n(2784),u=n(11141),h=n(73557),Z=n(23690),p=n(13230),m=n(99487),f=n(48650),g=n(64583),x=n(48863),b=n(44180),v=n(22134),y=n(6982),C=n(11845),w=n(45492),B=n(60319),k=n(96e3),S=n(85439),X=n(36380),T=n(61391),O=n(68826),I=n(32782),E=n(38484),j=n(78287),P=n(83249),M=n(39857),K=n(87833),D=n(14084),A=n(12366),z=n(42745),_=n(44938),L=n(93553),R=n(80162),W=n(1811),N=n(22698),G=n(44481),V=n(63655),$=n(13264),F=n(62197),q=n(23570),H=n(2995),U=n(66198),Y=n(80551),J=n(23883),Q=n(35322),ee=n(13780),te=n(41075),ne=n(94380),ie=n(65992),ae=n(18779),le=n(34048),re=n(24264),se=n(86569),oe=n(89977),ce=n(76111),de=n(12702),ue=n(69698),he=n(68330),Ze=n(32404),pe=n(15030),me=n(57210),fe=n(33927),ge=n(56961),xe=n(79410),be=n(75636),ve=n(60342),ye=n(42523),Ce=n(19181),we=n(39282),Be=n(52903);function ke({show:e,onClose:t,setTarget:n,showEmptyTargets:i=!1,flatOnly:a=!1,excludeSections:l=[],excludeHeal:r=!1}){const{data:s}=(0,d.useContext)(m.R),o=(0,d.useMemo)((()=>(0,be.U)(s).filter((([e])=>!l.includes(e))).map((([e,t])=>[e,Object.fromEntries(Object.entries(t).filter((([e,t])=>(!a||"%"!==t.info.unit)&&((!r||"heal"!==t.info.variant)&&!(!i&&t.isEmpty)))))])).filter((([e,t])=>Object.keys(t).length))),[s,l,a,i,r]);return(0,Be.tZ)(ue.Z,{open:e,onClose:t,children:(0,Be.tZ)(re.Z,{children:(0,Be.tZ)(c.Z,{children:(0,Be.tZ)(ve.ZP,{columns:{xs:1,sm:2,md:3},spacing:1,children:o.map((([e,t])=>(0,Be.tZ)(Se,{displayNs:t,sectionKey:e,setTarget:n},e)))})})})})}function Se({displayNs:e,sectionKey:t,setTarget:n}){const{data:i}=(0,d.useContext)(m.R),a=(0,l.Wz)(),r=(0,d.useMemo)((()=>(0,be.f)(i,t,a)),[i,t,a]);return(0,Be.BX)(K.Z,{children:[r&&(0,Be.tZ)(ye.Z,{avatar:r.icon&&(0,Be.tZ)(xe.Z,{size:2,src:r.icon}),title:r.title,action:r.action&&(0,Be.tZ)(A.Z,{children:r.action}),titleTypographyProps:{variant:"subtitle1"}}),(0,Be.tZ)(ge.Z,{}),(0,Be.tZ)(Ce.Z,{children:Object.entries(e).map((([e,i])=>(0,Be.tZ)(Xe,{node:i,onClick:()=>n([t,e],i.info.multi)},e)))})]},t)}function Xe({node:e,onClick:t}){return(0,Be.tZ)(ne.Z,{onClick:t,style:{whiteSpace:"normal"},children:(0,Be.tZ)(we.HK,{node:e})})}function Te({optimizationTarget:e,setTarget:t,disabled:n=!1,showEmptyTargets:i=!1,defaultText:a,targetSelectorModalProps:r={}}){var o;const{t:c}=(0,u.$G)("page_character_optimize"),[h,Z,p]=(0,w.aV)(!1),f=(0,d.useCallback)((e=>{p(),t(e)}),[p,t]),{data:g}=(0,d.useContext)(m.R),x=(0,l.Wz)(),b=(0,d.useMemo)((()=>e&&(0,be.f)(g,e[0],x)),[g,e,x]);a||(a=c("targetSelector.selectOptTarget"));const{title:v,icon:y,action:B}=null!=b?b:{},k=e&&(0,C.Hm)(g.getDisplay(),e),S=!e||!b||!k||!i&&k.isEmpty,X=S?"secondary":k.info.variant,T="invalid"===X?void 0:X,{textSuffix:O}=null!=(o=null==k?void 0:k.info)?o:{},I=O&&(0,Be.BX)("span",{children:[" ",O]}),E=y?(0,Be.tZ)(xe.Z,{src:y,size:2}):null==k?void 0:k.info.icon;return(0,Be.BX)(Be.HY,{children:[(0,Be.tZ)(P.Z,{color:"info",onClick:Z,disabled:n,sx:{flexGrow:1},children:S?(0,Be.tZ)("strong",{children:a}):(0,Be.BX)(fe.Z,{direction:"row",divider:(0,Be.tZ)(ge.Z,{orientation:"vertical",flexItem:!0}),spacing:1,children:[(0,Be.BX)(s.Z,{sx:{display:"flex",gap:1,alignItems:"center"},children:[E,(0,Be.tZ)("span",{children:v}),!!B&&(0,Be.tZ)(A.Z,{color:"success",sx:{whiteSpace:"normal"},children:B})]}),(0,Be.tZ)(s.Z,{sx:{display:"flex",alignItems:"center"},children:(0,Be.BX)(A.Z,{color:T,sx:{whiteSpace:"normal"},children:[(0,Be.tZ)("strong",{children:k.info.name}),I]})})]})}),(0,Be.tZ)(ke,Object.assign({show:h,onClose:p,setTarget:f,showEmptyTargets:i},r))]})}let Oe,Ie,Ee,je,Pe,Me=e=>e;const Ke=300;function De(){const e=(0,l.Wz)(),{t}=(0,u.$G)("page_character"),[n,i,a]=(0,w.aV)(),{teamChar:r,teamCharId:h}=(0,d.useContext)(x.V),[p,f]=(0,d.useState)((()=>r.customMultiTargets));(0,d.useEffect)((()=>f(r.customMultiTargets)),[f,r.customMultiTargets]);const[g,b]=(0,d.useState)(!1),v=(0,d.useCallback)((()=>{f([...p,(0,_.HL)()]),b(p.length)}),[p,f,b]),y=(0,d.useCallback)((e=>t=>{const n=[...p];n[e]=t,f(n)}),[p,f]),C=(0,d.useCallback)((e=>()=>{if(p[e].targets.length&&!window.confirm(`Are you sure you want to delete "${p[e].name}"?`))return;const t=[...p];t.splice(e,1),f(t)}),[p,f]),B=(0,d.useCallback)((e=>()=>{const t=[...p];t.splice(e,0,p[e]),f(t)}),[p,f]),k=(0,d.useCallback)((e=>t=>{if(t=(0,z.re)(t-1,0,p.length-1),e===t)return;const n=[...p],i=n[e];n.splice(e,1),n.splice(t,0,i),f(n)}),[p,f]),S=(0,d.useCallback)((()=>{a(),e.teamChars.set(h,{customMultiTargets:p})}),[e,h,p,a]),X=(0,d.useCallback)((e=>()=>b(e!==g&&e)),[g]),{data:T,teamData:O}=(0,d.useContext)(m.R),I=(0,d.useMemo)((()=>{const e=T.data[0],t=Object.assign({},e,{hit:Object.assign({},e.hit),infusion:Object.assign({},e.infusion)});return delete t.hit.reaction,delete t.infusion.team,{data:new pe.w(t,void 0),teamData:O}}),[T,O]),E=(0,d.useMemo)((()=>p.map(((e,t)=>(0,Be.tZ)(Ae,{index:t,expanded:t===g,onExpand:X(t),target:e,setTarget:y(t),onDelete:C(t),onDup:B(t),onOrder:k(t),nTargets:p.length},`${t}${e.name}`)))),[p,C,B,g,X,y,k]);return(0,Be.BX)(d.Suspense,{fallback:(0,Be.tZ)(o.Z,{variant:"rectangular",height:"100%",width:100}),children:[(0,Be.tZ)(P.Z,{color:"info",onClick:i,startIcon:(0,Be.tZ)($.Z,{}),children:t(Oe||(Oe=Me`multiTarget.title`))}),(0,Be.tZ)(m.R.Provider,{value:I,children:(0,Be.tZ)(ue.Z,{open:n,onClose:S,containerProps:{sx:{overflow:"visible"}},children:(0,Be.tZ)(re.Z,{children:(0,Be.BX)(c.Z,{sx:{display:"flex",flexDirection:"column",gap:1},children:[(0,Be.BX)(s.Z,{display:"flex",gap:1,alignItems:"center",children:[(0,Be.tZ)(F.Z,{variant:"h6",children:t(Ie||(Ie=Me`multiTarget.title`))}),(0,Be.tZ)(de.Z,{title:(0,Be.BX)(F.Z,{children:[(0,Be.BX)(u.cC,{t,i18nKey:"multiTarget.info1",children:["Note: Community created custom Multi-Optimization Targets can be found within the",(0,Be.tZ)("a",{href:"https://discord.gg/CXUbQXyfUs",target:"_blank",rel:"noreferrer",children:"GO Discord"}),"or",(0,Be.tZ)("a",{href:"https://keqingmains.com/misc/multi-optimization/",target:"_blank",rel:"noreferrer",children:"KQM Multi-Opt Guide"}),", however the validity of such configurations cannot be guaranteed."]}),(0,Be.tZ)("br",{}),(0,Be.tZ)("br",{}),t("multiTarget.info2")]})}),(0,Be.tZ)(Z.Z,{onClick:S,sx:{marginLeft:"auto"}})]}),(0,Be.BX)(s.Z,{children:[E,(0,Be.tZ)(P.Z,{fullWidth:!0,onClick:v,startIcon:(0,Be.tZ)(L.Z,{}),sx:{mt:1},children:t(Ee||(Ee=Me`multiTarget.addNewMTarget`))})]})]})})})})]})}function Ae({index:e,target:t,setTarget:n,expanded:i,onExpand:a,onDelete:l,onDup:r,onOrder:o,nTargets:c}){var h;const{t:Z}=(0,u.$G)("page_character"),p=(0,d.useCallback)((e=>n(Object.assign({},t,{name:e}))),[n,t]),m=(0,d.useCallback)((e=>n(Object.assign({},t,{description:e}))),[n,t]),f=(0,d.useCallback)(((e,i)=>{const a=Object.assign({},t);a.targets=[...a.targets,(0,_.kV)(e,i)],n(a)}),[t,n]),g=(0,d.useCallback)((e=>i=>{const a=[...t.targets];a[e]=i,n(Object.assign({},t,{targets:a}))}),[t,n]),x=(0,d.useCallback)((e=>()=>{if(Object.values(t.targets[e].bonusStats).length&&!window.confirm("Are you sure you want to delete this target?"))return;const i=[...t.targets];i.splice(e,1),n(Object.assign({},t,{targets:i}))}),[t,n]),b=(0,d.useCallback)((e=>i=>{if(void 0===i||0===i)return;const a=i-1,l=[...t.targets];(0,z.Rp)(l,e,a),n(Object.assign({},t,{targets:l}))}),[t,n]),v=(0,d.useCallback)((e=>()=>{const i=[...t.targets];i.splice(e,0,(0,z.I8)(i[e])),n(Object.assign({},t,{targets:i}))}),[t,n]),y=(0,d.useMemo)((()=>t.targets.map(((e,n)=>(0,Be.tZ)(We,{customTarget:e,setCustomTarget:g(n),deleteCustomTarget:x(n),rank:n+1,maxRank:t.targets.length,setTargetIndex:b(n),onDup:v(n)},e.path.join()+n)))),[x,v,g,b,t.targets]);return(0,Be.BX)(q.Z,{sx:{bgcolor:"contentLight.main"},expanded:i,children:[(0,Be.tZ)(H.Z,{expandIcon:(0,Be.BX)(P.Z,{color:"info",sx:{pointerEvents:"auto"},onClick:a,children:[(0,Be.tZ)($.Z,{}),i?(0,Be.tZ)(G.Z,{}):(0,Be.tZ)(V.Z,{})]}),component:"div",sx:{pointerEvents:"none","& .MuiAccordionSummary-expandIconWrapper":{transform:"rotate(0)"},"& .MuiAccordionSummary-expandIconWrapper.Mui-expanded":{transform:"rotate(0)"}},children:(0,Be.BX)(s.Z,{gap:1,pr:1,display:"flex",flexWrap:"wrap",sx:{pointerEvents:"auto",width:"100%",alignItems:"center"},children:[(0,Be.tZ)(U.Z,{sx:{minWidth:"8em"},color:t.targets.length?"success":void 0,label:(0,Be.BX)(u.cC,{t:Z,i18nKey:"multiTarget.target",count:t.targets.length,children:[{count:t.targets.length}," Targets"]})}),(0,Be.tZ)(ze,{name:t.name,setName:p}),t.description&&(0,Be.tZ)(de.Z,{title:(0,Be.tZ)(F.Z,{children:t.description.length>Ke?t.description.slice(0,Ke)+"...":t.description})}),(0,Be.BX)(Y.Z,{size:"small",children:[(0,Be.tZ)(oe.CC,{children:(0,Be.tZ)(oe.ZP,{onChange:e=>o(null!=e?e:0),value:e+1,inputProps:{min:1,max:c,sx:{textAlign:"center"}},sx:{width:"100%",height:"100%",pl:2}})}),(0,Be.tZ)(J.Z,{title:Z("multiTarget.duplicate"),placement:"top",children:(0,Be.tZ)(P.Z,{onClick:r,color:"info",children:(0,Be.tZ)(R.Z,{})})}),(0,Be.tZ)(P.Z,{color:"error",onClick:l,children:(0,Be.tZ)(N.Z,{})})]})]})}),(0,Be.BX)(Q.Z,{children:[(0,Be.tZ)(s.Z,{mb:1,display:"flex",sx:{pointerEvents:"auto",width:"100%"},children:(0,Be.tZ)(_e,{desc:null!=(h=t.description)?h:"",setDesc:m})}),(0,Be.tZ)(s.Z,{mb:1,children:(0,Be.tZ)($e,{customMultiTarget:t,setCustomMultiTarget:n})}),(0,Be.BX)(s.Z,{display:"flex",gap:1,flexDirection:"column",children:[y,(0,Be.tZ)(Ge,{setTarget:f})]})]})]})}function ze({name:e,setName:t}){const[n,i]=(0,d.useState)(e);(0,d.useEffect)((()=>i(e)),[e,i]);const[a,l,r]=(0,w.aV)(!1),s=(0,w.KS)();return(0,Be.tZ)(ee.Z,{error:a,size:"small",value:n,onChange:e=>{let t=e.target.value;t.length>=_.ac?(s(r,2e3),l(),t=t.slice(0,_.ac)):s(r,1),i(t)},onBlur:e=>t(n),sx:{flexGrow:1}})}function _e({desc:e,setDesc:t}){const{t:n}=(0,u.$G)("page_character"),[i,a]=(0,d.useState)(e);(0,d.useEffect)((()=>a(e)),[e,a]);const[l,r,s]=(0,w.aV)(!1),o=(0,w.KS)();return(0,Be.tZ)(ee.Z,{error:l,multiline:!0,size:"small",placeholder:n("multiTarget.description"),value:i,onChange:e=>{let t=e.target.value;t.length>=_.t2?(o(s,2e3),r(),t=t.slice(0,_.t2)):o(s,1),a(t)},onBlur:e=>t(i),sx:{flexGrow:1}})}const Le=[...Ze.lR],Re=(e,t)=>(0,Be.tZ)(te.ZP,{item:!0,xs:1,children:e},t);function We({customTarget:e,setCustomTarget:t,deleteCustomTarget:n,rank:i,maxRank:l,setTargetIndex:r,onDup:o}){const{t:c}=(0,u.$G)("page_character"),{characterSheet:h}=(0,d.useContext)(x.V),{data:Z}=(0,d.useContext)(m.R),{path:p,weight:f,hitMode:g,reaction:b,infusionAura:v,bonusStats:y}=e,C=(0,d.useCallback)((n=>t(Object.assign({},e,{weight:n}))),[e,t]),w=(0,z.Hm)(Z.getDisplay(),p),B=(0,d.useCallback)((n=>t(Object.assign({},e,{bonusStats:n}))),[e,t]),k=(0,d.useMemo)((()=>(0,Be.tZ)(he.Z,{statKeys:Le,statFilters:y,setStatFilters:B,wrapperFunc:Re,label:c("addStats.label")})),[y,B,c]),S=(null==h?void 0:h.isMelee())&&("normal"===p[0]||"charged"===p[0]||"plunging"===p[0]),X="reaction"===p[0];return(0,Be.BX)(re.Z,{sx:{display:"flex"},children:[(0,Be.BX)(s.Z,{sx:{p:1,flexGrow:1},children:[(0,Be.BX)(s.Z,{sx:{display:"flex",gap:1,flexWrap:"wrap"},children:[(0,Be.tZ)(oe.ZP,{float:!0,startAdornment:"x",value:f,onChange:C,sx:{borderRadius:1,pl:1},inputProps:{sx:{pl:.5,width:"2em"},min:0}}),(0,Be.tZ)(Te,{optimizationTarget:p,setTarget:n=>t(Object.assign({},e,{path:n,reaction:void 0,infusionAura:void 0})),showEmptyTargets:!0,targetSelectorModalProps:{flatOnly:!0,excludeSections:["basic","custom"]}}),(0,Be.tZ)(s.Z,{sx:{flexGrow:1}}),w&&(0,Be.tZ)(Ne,{reaction:b,setReactionMode:n=>t(Object.assign({},e,{reaction:n})),node:w,infusionAura:v}),(0,Be.tZ)(ce.Z,{title:c(`hitmode.${g}`),children:a.kE.map((n=>(0,Be.tZ)(ne.Z,{value:n,disabled:g===n,onClick:()=>t(Object.assign({},e,{hitMode:n})),children:c(`hitmode.${n}`)},n)))})]}),(0,Be.BX)(te.ZP,{container:!0,columns:{xs:1,lg:2},sx:{pt:1},spacing:1,children:[(S||X)&&(0,Be.tZ)(te.ZP,{item:!0,xs:1,children:(0,Be.tZ)(ce.Z,{title:D.Ps[null!=v?v:""],color:v||"secondary",disableElevation:!0,fullWidth:!0,children:Object.entries(D.Ps).map((([n,i])=>(0,Be.tZ)(ne.Z,{sx:n?{color:`${n}.main`}:void 0,selected:n===v,disabled:n===v,onClick:()=>t(Object.assign({},e,{infusionAura:n||void 0,reaction:void 0})),children:i},n)))})}),k]})]}),(0,Be.BX)(Y.Z,{orientation:"vertical",sx:{borderTopLeftRadius:0,"*":{flexGrow:1}},children:[(0,Be.tZ)(oe.CC,{children:(0,Be.tZ)(oe.ZP,{value:i,onChange:r,sx:{pl:2},inputProps:{sx:{width:"1em"},min:1,max:l}})}),(0,Be.tZ)(P.Z,{size:"small",color:"info",onClick:o,children:(0,Be.tZ)(R.Z,{})}),(0,Be.tZ)(P.Z,{size:"small",color:"error",onClick:n,children:(0,Be.tZ)(N.Z,{})})]})]})}function Ne({node:e,reaction:t,setReactionMode:n,infusionAura:i}){var l,r,s,o,c;const d=null!=(l=e.info.variant)?l:"physical",{t:h}=(0,u.$G)("page_character");if(!["pyro","hydro","cryo","electro","dendro"].some((e=>e===d||e===i)))return null;const Z=[...new Set([...null!=(r=me.oR[d])?r:[],...null!=(s=me.oR[null!=i?i:""])?s:[],...null!=(o=me.p7[d])?o:[],...null!=(c=me.p7[null!=i?i:""])?c:[]])],p=t?[...a.Mk].includes(t)?(0,Be.tZ)(le.Z,{reaction:t}):(0,Be.tZ)(ae.Z,{reaction:t}):h(je||(je=Me`noReaction`));return(0,Be.BX)(ce.Z,{title:p,sx:{ml:"auto"},children:[(0,Be.tZ)(ne.Z,{value:"",disabled:!t,onClick:()=>n(),children:"No Reactions"}),Z.map((e=>(0,Be.tZ)(ne.Z,{disabled:t===e,onClick:()=>n(e),children:[...a.Mk].includes(e)?(0,Be.tZ)(le.Z,{reaction:e}):(0,Be.tZ)(ae.Z,{reaction:e})},e)))]})}function Ge({setTarget:e}){const{t}=(0,u.$G)("page_character"),[n,i,a]=(0,w.aV)(!1),l=(0,d.useCallback)(((t,n)=>{a(),e(t,n)}),[a,e]);return(0,Be.BX)(Be.HY,{children:[(0,Be.tZ)(P.Z,{fullWidth:!0,onClick:i,startIcon:(0,Be.tZ)(L.Z,{}),sx:{mb:1},children:t(Pe||(Pe=Me`multiTarget.addNewTarget`))}),(0,Be.tZ)(ke,{showEmptyTargets:!0,flatOnly:!0,excludeHeal:!0,show:n,onClose:a,setTarget:l,excludeSections:["basic","custom"]})]})}const Ve=(0,ie.ZP)("textarea")({width:"100%",fontFamily:"monospace",resize:"vertical",minHeight:"2em"});function $e({customMultiTarget:e,setCustomMultiTarget:t}){const[n,i]=(0,d.useState)(JSON.stringify(e)),[a,l]=(0,d.useState)("");(0,d.useEffect)((()=>{l(""),i(JSON.stringify(e))}),[e,i]);const r=(0,d.useCallback)((()=>navigator.clipboard.writeText(n).then((()=>alert("Copied configuration to clipboard."))).catch(console.error)),[n]),o=(0,d.useCallback)((e=>{l(""),i(e);try{const n=(0,_.RX)(JSON.parse(e));n?t(n):l("Invalid Multi-Optimization Config")}catch(n){n instanceof Error&&l(n.message)}}),[i,t]);return(0,Be.BX)(s.Z,{children:[(0,Be.BX)(s.Z,{display:"flex",gap:1,children:[(0,Be.tZ)(Ve,{value:n,sx:{outlineColor:a?"red":void 0},onClick:e=>{const t=e.target;t.selectionStart=0,t.selectionEnd=t.value.length},onChange:e=>o(e.target.value)}),(0,Be.tZ)(P.Z,{color:"info",disabled:!!a,onClick:r,children:(0,Be.tZ)(W.Z,{})})]}),!!a&&(0,Be.tZ)(se.Z,{color:"error",children:(0,Be.tZ)(F.Z,{children:a})})]})}var Fe=n(84485),qe=n(4453);function He(){const{modalOpen:e}=(0,d.useContext)(f.M),{setFormulaData:t}=(0,d.useContext)(f.M),n=(0,d.useCallback)((()=>null==t?void 0:t(void 0,void 0)),[t]);return(0,Be.tZ)(ue.Z,{open:!!e,onClose:n,children:(0,Be.BX)(re.Z,{children:[(0,Be.tZ)(ye.Z,{title:"Formulas & Calculations",action:(0,Be.tZ)(Z.Z,{onClick:n})}),(0,Be.tZ)(c.Z,{sx:{pt:0},children:(0,Be.tZ)(Ue,{})})]})})}function Ue(){const{data:e}=(0,d.useContext)(m.R),{data:t}=(0,d.useContext)(f.M),n=(0,be.U)(null!=t?t:e);return(0,Be.tZ)(d.Suspense,{fallback:(0,Be.tZ)(o.Z,{variant:"rectangular",width:"100%",height:1e3}),children:(0,Be.tZ)(s.Z,{sx:{mr:-1,mb:-1},children:n.map((([e,t])=>(0,Be.tZ)(Ye,{displayNs:t,sectionKey:e},e)))})})}function Ye({sectionKey:e,displayNs:t}){const{data:n}=(0,d.useContext)(m.R),i=(0,l.Wz)(),{data:a}=(0,d.useContext)(f.M),r=(0,d.useMemo)((()=>(0,be.f)(null!=a?a:n,e,i)),[i,a,n,e]);if(!r)return null;if(Object.entries(t).every((([e,t])=>t.isEmpty)))return null;const{title:s,icon:o,action:u}=r;return(0,Be.BX)(K.Z,{sx:{mb:1},children:[(0,Be.tZ)(qe.Z,{avatar:o&&(0,Be.tZ)(xe.Z,{size:2,src:o}),title:s,action:u&&(0,Be.tZ)(A.Z,{children:u})}),(0,Be.tZ)(ge.Z,{}),(0,Be.tZ)(c.Z,{children:Object.entries(t).map((([e,t])=>!t.isEmpty&&(0,Be.tZ)(Je,{node:t},e)))})]})}function Je({node:e}){const{node:t}=(0,d.useContext)(f.M),[n,i]=(0,d.useState)(!1),l=(0,d.useCallback)(((e,t)=>i(t)),[]),r=(0,d.useRef)();return(0,d.useEffect)((()=>{e===t&&setTimeout((()=>{var e;return null==r||null==(e=r.current)||null==e.scrollIntoView?void 0:e.scrollIntoView({behavior:"smooth"})}),300)}),[r,e,t]),(0,Be.BX)(q.Z,{sx:{bgcolor:"contentNormal.main"},expanded:e===t||n,onChange:l,ref:r,children:[(0,Be.BX)(H.Z,{expandIcon:(0,Be.tZ)(Fe.Z,{}),children:[(0,Be.BX)(F.Z,{children:[(0,Be.tZ)(se.Z,{color:e.info.variant,children:e.info.name})," ",(0,Be.tZ)("strong",{children:(0,pe.p)(e)})]}),a.Mk.includes(e.info.variant)&&(0,Be.tZ)(s.Z,{sx:{display:"inline-block",ml:"auto",mr:2},children:(0,Be.tZ)(le.Z,{reaction:e.info.variant,trigger:e.info.subVariant})})]}),(0,Be.tZ)(Q.Z,{children:e.formulas.map(((e,t)=>(0,Be.tZ)(F.Z,{component:"div",children:e},t)))})]})}var Qe=n(50693),et=n(96778),tt=n(29754),nt=n(69208),it=n(47508),at=n(75213),lt=n(47513),rt=n(22254),st=n(25065);function ot({weaponId:e,artifactIds:t}){const{character:{key:n}}=(0,d.useContext)(x.V),i=(0,Qe.Ru)(n).weaponType;return(0,Be.BX)(te.ZP,{container:!0,spacing:1,columns:{xs:2,sm:2,md:3,lg:6,xl:6},children:[(0,Be.tZ)(te.ZP,{item:!0,xs:1,children:(0,Be.tZ)(st.Z,{weaponId:e,weaponTypeKey:i})}),Object.entries(t).map((([e,t])=>(0,Be.tZ)(te.ZP,{item:!0,xs:1,children:(0,Be.tZ)(rt.Z,{artifactId:t,slotKey:e})},t||e)))]})}function ct({buildId:e,active:t=!1}){const[n,r,o]=(0,w.aV)(),{teamCharId:u,teamChar:{key:h}}=(0,d.useContext)(x.V),Z=(0,l.Wz)(),{name:p,description:m,weaponId:f,artifactIds:g}=(0,l.rO)(e),b=(0,Qe.Ru)(h).weaponType;return(0,Be.BX)(Be.HY,{children:[(0,Be.tZ)(i.AB,{open:n,onClose:o,children:(0,Be.tZ)(dt,{buildId:e,onClose:o})}),(0,Be.tZ)(i.s8,{bgt:"light",sx:{undefined:void 0,boxShadow:t?"0px 0px 0px 2px green inset":void 0},children:(0,Be.BX)(c.Z,{sx:{display:"flex",flexDirection:"column",gap:1},children:[(0,Be.BX)(s.Z,{sx:{display:"flex",gap:1},children:[(0,Be.tZ)(i.s8,{sx:{flexGrow:1},children:(0,Be.tZ)(at.Z,{disabled:!f||t,onClick:()=>Z.teamChars.set(u,{buildType:"real",buildId:e}),children:(0,Be.BX)(s.Z,{component:"span",sx:{p:1,display:"flex",gap:1,alignItems:"center"},children:[(0,Be.tZ)(F.Z,{variant:"h6",children:p}),(0,Be.tZ)(i.eN,{title:(0,Be.tZ)(F.Z,{children:m}),children:(0,Be.tZ)(nt.Z,{})})]})})}),(0,Be.tZ)(P.Z,{color:"info",size:"small",onClick:r,children:(0,Be.tZ)(tt.Z,{})}),(0,Be.tZ)(P.Z,{color:"info",size:"small",onClick:()=>{const e=Z.teamChars.newBuildTcFromBuild(u,b,Z.weapons.get(f),Object.values(g).map((e=>Z.arts.get(e))));Z.buildTcs.set(e,{name:`${p} - Copied`,description:m})},children:(0,Be.tZ)(it.Z,{})}),(0,Be.tZ)(P.Z,{color:"success",size:"small",disabled:!f||t,onClick:()=>{if(!f)return;if(!window.confirm("Do you want to equip all gear in this loadout to this character? The currently equipped build will be overwritten."))return;const e=Z.chars.get(h);Object.entries(g).forEach((([t,n])=>{if(n)Z.arts.set(n,{location:(0,a.V7)(h)});else{const n=e.equippedArtifacts[t];n&&Z.arts.get(n)&&Z.arts.set(n,{location:""})}})),f&&Z.weapons.set(f,{location:(0,a.V7)(h)})},children:(0,Be.tZ)(et.Z,{})}),(0,Be.tZ)(P.Z,{color:"error",size:"small",onClick:()=>{Z.builds.remove(e),Z.teamChars.set(u,{})},children:(0,Be.tZ)(N.Z,{})})]}),(0,Be.tZ)(ot,{weaponId:f,artifactIds:g})]})})]})}function dt({buildId:e,onClose:t}){const{character:{key:n}}=(0,d.useContext)(x.V),a=(0,Qe.Ru)(n).weaponType,r=(0,l.Wz)(),o=(0,l.rO)(e),[u,h]=(0,d.useState)(o.name),p=(0,d.useDeferredValue)(u),[m,f]=(0,d.useState)(o.description),g=(0,d.useDeferredValue)(m);return(0,d.useEffect)((()=>{const{name:t,description:n}=r.builds.get(e);h(t),f(n)}),[r,e]),(0,d.useEffect)((()=>{r.builds.set(e,(e=>{e.name=p}))}),[r,p]),(0,d.useEffect)((()=>{r.builds.set(e,(e=>{e.description=g}))}),[r,g]),(0,Be.BX)(i.s8,{children:[(0,Be.tZ)(ye.Z,{title:"Build Settings",action:(0,Be.tZ)(Z.Z,{onClick:t})}),(0,Be.tZ)(ge.Z,{}),(0,Be.BX)(c.Z,{sx:{display:"flex",flexDirection:"column",gap:2},children:[(0,Be.tZ)(ee.Z,{fullWidth:!0,label:"Build Name",placeholder:"Build Name",value:u,onChange:e=>h(e.target.value)}),(0,Be.tZ)(ee.Z,{fullWidth:!0,label:"Build Description",placeholder:"Build Description",value:m,onChange:e=>f(e.target.value),multiline:!0,rows:4}),(0,Be.tZ)(s.Z,{children:(0,Be.tZ)(lt.ZP,{weaponTypeKey:a,weaponId:o.weaponId,artifactIds:o.artifactIds,setWeapon:t=>r.builds.set(e,{weaponId:t}),setArtifact:(t,n)=>r.builds.set(e,(e=>{e.artifactIds[t]=n}))})})]})]})}var ut=n(72539),ht=n(35800),Zt=n(16633),pt=n(20577),mt=n(25616);function ft({buildTcId:e,active:t=!1}){const[n,a,r]=(0,w.aV)(),{teamCharId:o}=(0,d.useContext)(x.V),u=(0,l.Wz)(),{name:h,description:Z}=(0,l.dN)(e);return(0,Be.BX)(Be.HY,{children:[(0,Be.tZ)(i.AB,{open:n,onClose:r,children:(0,Be.tZ)(xt,{buildTcId:e,onClose:r})}),(0,Be.tZ)(i.s8,{bgt:"light",sx:{undefined:void 0,boxShadow:t?"0px 0px 0px 2px green inset":void 0},children:(0,Be.BX)(c.Z,{sx:{display:"flex",flexDirection:"column",gap:1},children:[(0,Be.BX)(s.Z,{sx:{display:"flex",gap:1},children:[(0,Be.tZ)(i.s8,{sx:{flexGrow:1},children:(0,Be.tZ)(at.Z,{disabled:t,onClick:()=>u.teamChars.set(o,{buildType:"tc",buildTcId:e}),children:(0,Be.BX)(s.Z,{component:"span",sx:{p:1,display:"flex",gap:1,alignItems:"center"},children:[(0,Be.tZ)(F.Z,{variant:"h6",children:h}),(0,Be.tZ)(i.eN,{title:(0,Be.tZ)(F.Z,{children:Z}),children:(0,Be.tZ)(nt.Z,{})})]})})}),(0,Be.tZ)(P.Z,{color:"info",size:"small",onClick:a,children:(0,Be.tZ)(tt.Z,{})}),(0,Be.tZ)(P.Z,{color:"error",size:"small",onClick:()=>{u.buildTcs.remove(e),u.teamChars.set(o,{})},children:(0,Be.tZ)(N.Z,{})})]}),(0,Be.tZ)(gt,{buildTcId:e})]})})]})}function gt({buildTcId:e}){const{weapon:t,artifact:{slots:n,substats:{stats:a},sets:o}}=(0,l.dN)(e),c=(0,mt.ub)(t.key),d=Object.entries(a),u=d.slice(0,5),h=d.slice(5);return(0,Be.BX)(te.ZP,{container:!0,spacing:1,columns:{xs:2,sm:2,md:3,lg:6,xl:6},children:[(0,Be.tZ)(te.ZP,{item:!0,xs:1,children:(0,Be.tZ)(st.N,{weapon:t,weaponSheet:c})}),(0,Be.tZ)(te.ZP,{item:!0,xs:2,sm:2,md:2,lg:5,children:(0,Be.BX)(s.Z,{sx:{display:"flex",gap:1,alignItems:"stretch",height:"100%"},children:[!!Object.keys(o).length&&(0,Be.tZ)(i.s8,{sx:{flexGrow:1},children:(0,Be.tZ)(s.Z,{sx:{p:1,display:"flex",flexDirection:"column",gap:1},children:Object.entries(o).map((([e,t])=>(0,Be.BX)(s.Z,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,Be.tZ)(xe.Z,{size:2,src:(0,ut.Hp)(e,"flower")}),(0,Be.tZ)("span",{children:(0,Be.tZ)(r.C3,{setKey:e})}),(0,Be.BX)(i.dL,{children:["x",t]})]},e)))})}),(0,Be.tZ)(i.s8,{sx:{flexGrow:1},children:(0,Be.tZ)(s.Z,{sx:{p:1,display:"flex",flexDirection:"column",gap:1},children:Object.entries(n).map((([e,{level:t,statKey:n}])=>(0,Be.BX)(s.Z,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,Be.tZ)(ht.x7,{slotKey:e}),(0,Be.BX)(i.dL,{children:["+",t]}),(0,Be.tZ)(pt.x,{statKey:n})]},e)))})}),[u,h].map(((e,t)=>(0,Be.tZ)(i.s8,{sx:{flexGrow:1},children:(0,Be.tZ)(s.Z,{sx:{p:1,display:"flex",flexDirection:"column",gap:1},children:e.map((([e,t])=>(0,Be.BX)(s.Z,{sx:{display:"flex",alignItems:"center",gap:1,justifyContent:"space-between"},children:[(0,Be.tZ)(pt.x,{statKey:e}),(0,Be.BX)("span",{children:[(0,Zt.Jj)(t,(0,z.bf)(e)),(0,z.bf)(e)]})]},e)))})},t)))]})})]})}function xt({buildTcId:e,onClose:t}){const n=(0,l.Wz)(),a=(0,l.dN)(e),[r,s]=(0,d.useState)(a.name),o=(0,d.useDeferredValue)(r),[u,h]=(0,d.useState)(a.description),p=(0,d.useDeferredValue)(u);return(0,d.useEffect)((()=>{const{name:t,description:i}=n.buildTcs.get(e);s(t),h(i)}),[n,e]),(0,d.useEffect)((()=>{n.buildTcs.set(e,(e=>{e.name=o}))}),[n,o]),(0,d.useEffect)((()=>{n.buildTcs.set(e,(e=>{e.description=p}))}),[n,p]),(0,Be.BX)(i.s8,{children:[(0,Be.tZ)(ye.Z,{title:"Build Settings",action:(0,Be.tZ)(Z.Z,{onClick:t})}),(0,Be.tZ)(ge.Z,{}),(0,Be.BX)(c.Z,{sx:{display:"flex",flexDirection:"column",gap:2},children:[(0,Be.tZ)(ee.Z,{fullWidth:!0,label:"Build Name",placeholder:"Build Name",value:r,onChange:e=>s(e.target.value)}),(0,Be.tZ)(ee.Z,{fullWidth:!0,label:"Build Description",placeholder:"Build Description",value:u,onChange:e=>h(e.target.value),multiline:!0,rows:4})]})]})}function bt({active:e=!1}){const{teamCharId:t}=(0,d.useContext)(x.V),{character:{key:n,equippedArtifacts:a,equippedWeapon:r}}=(0,d.useContext)(p.K),o=(0,l.Wz)(),u=(0,Qe.Ru)(n).weaponType;return(0,Be.tZ)(i.s8,{bgt:"light",sx:{undefined:void 0,boxShadow:e?"0px 0px 0px 2px green inset":void 0},children:(0,Be.BX)(c.Z,{sx:{display:"flex",flexDirection:"column",gap:1},children:[(0,Be.BX)(s.Z,{sx:{display:"flex",gap:1},children:[(0,Be.tZ)(i.s8,{sx:{flexGrow:1},children:(0,Be.tZ)(at.Z,{disabled:e,onClick:()=>o.teamChars.set(t,{buildType:"equipped"}),sx:{p:1},children:(0,Be.tZ)(F.Z,{variant:"h6",children:"Equipped"})})}),(0,Be.tZ)(P.Z,{disabled:!0,color:"info",size:"small",children:(0,Be.tZ)(tt.Z,{})}),(0,Be.tZ)(P.Z,{color:"info",size:"small",onClick:()=>{const e=o.teamChars.newBuildTcFromBuild(t,u,o.weapons.get(r),Object.values(a).map((e=>o.arts.get(e))));o.buildTcs.set(e,{name:"Equipped - Copied",description:"Copied from Equipped Build"})},children:(0,Be.tZ)(it.Z,{})}),(0,Be.tZ)(P.Z,{color:"info",size:"small",onClick:()=>o.teamChars.newBuild(t,{name:"Duplicate of Equipped",artifactIds:a,weaponId:r}),children:(0,Be.tZ)(R.Z,{})})]}),(0,Be.tZ)(ot,{weaponId:r,artifactIds:a})]})})}function vt(){const e=(0,l.Wz)(),[t,n,a]=(0,w.aV)(),{teamCharId:r,teamChar:{key:o,buildType:u,buildId:h,buildIds:Z,buildTcId:p,buildTcIds:m}}=(0,d.useContext)(x.V),f=(0,Qe.Ru)(o).weaponType,g=(0,d.useMemo)((()=>{switch(u){case"equipped":return"Equipped";case"real":return e.builds.get(h).name;case"tc":return e.buildTcs.get(p).name}}),[e,u,h,p]);return(0,Be.BX)(Be.HY,{children:[(0,Be.BX)(P.Z,{startIcon:(0,Be.tZ)(et.Z,{}),onClick:()=>{t?a():n()},children:["Loadout: ",(0,Be.tZ)("strong",{children:g})]}),(0,Be.tZ)(d.Suspense,{fallback:null,children:(0,Be.tZ)(i.AB,{open:t,onClose:a,children:(0,Be.BX)(i.s8,{children:[(0,Be.tZ)(ye.Z,{title:"Loadout Management"}),(0,Be.tZ)(ge.Z,{}),(0,Be.BX)(c.Z,{sx:{display:"flex",flexDirection:"column",gap:2},children:[(0,Be.tZ)(bt,{active:"equipped"===u}),(0,Be.BX)(s.Z,{sx:{display:"flex",gap:2},children:[(0,Be.tZ)(F.Z,{variant:"h6",children:"Loadouts"}),(0,Be.tZ)(P.Z,{startIcon:(0,Be.tZ)(L.Z,{}),color:"info",size:"small",onClick:()=>e.teamChars.newBuild(r),children:"New Loadout"})]}),Z.map((e=>(0,Be.tZ)(ct,{buildId:e,active:"real"===u&&h===e},e))),(0,Be.BX)(s.Z,{sx:{display:"flex",gap:2},children:[(0,Be.tZ)(F.Z,{variant:"h6",children:"TC Loadouts"}),(0,Be.tZ)(P.Z,{startIcon:(0,Be.tZ)(L.Z,{}),color:"info",size:"small",onClick:()=>e.teamChars.newBuildTcFromBuild(r,f),children:"New TC Loadout"})]}),m.map((e=>(0,Be.tZ)(ft,{buildTcId:e,active:"tc"===u&&p===e},e)))]})]})})})]})}var yt=n(15162),Ct=n(107),wt=n(15873),Bt=n(98883),kt=n(32510),St=n(5658),Xt=n(27216),Tt=n(41033),Ot=n(39099),It=n(98283),Et=n(85801);const jt=["expand"],Pt=(0,ie.ZP)((e=>{const t=(0,It.Z)(e,jt);return(0,Be.tZ)(Et.Z,Object.assign({},t))}))((({theme:e,expand:t})=>({transform:t?"rotate(180deg)":"rotate(0deg)",marginLeft:"auto",transition:e.transitions.create("transform",{duration:e.transitions.duration.shortest})})));var Mt=n(13900);const Kt=["name","children","value","placeholder","defaultValue","onValueChange","percent","disabled","onReset"],Dt=(0,ie.ZP)(Y.Z)({display:"flex"});function At(e){let{name:t,children:n,value:i,placeholder:a,defaultValue:l=0,onValueChange:r,percent:s=!1,disabled:o=!1,onReset:c}=e,d=(0,It.Z)(e,Kt);return(0,Be.BX)(Dt,Object.assign({},d,{children:[n,(0,Be.tZ)(Mt.Z,{sx:{px:1},children:t}),(0,Be.tZ)(oe.CC,{sx:{flexBasis:"10em",flexGrow:1},children:(0,Be.tZ)(oe.ZP,{sx:{px:1},inputProps:{sx:{textAlign:"right"}},float:s,placeholder:a,value:i,onChange:r,disabled:o,endAdornment:s?"%":void 0})}),(0,Be.tZ)(P.Z,{sx:{flexShrink:2},size:"small",color:"error",onClick:()=>c?c():r(l),disabled:o||i===l,children:(0,Be.tZ)(kt.Z,{})})]}))}let zt,_t=e=>e;function Lt(){const{t:e}=(0,u.$G)("ui"),{teamId:t}=(0,d.useContext)(x.V),n=(0,l.Wz)(),{data:i}=(0,d.useContext)(m.R),[r,o]=(0,d.useState)(!1),h=(0,d.useCallback)((()=>o(!r)),[o,r]),Z=i.get(Ze.ri.enemy.level),p=i.get(Ze.ri.enemy.defRed),f=i.get(Ze.ri.enemy.defIgn),g=(0,d.useCallback)((()=>n.teams.set(t,{enemyOverride:{}})),[n,t]);return(0,Be.BX)(K.Z,{children:[(0,Be.BX)(c.Z,{sx:{display:"flex",gap:1,alignItems:"center",flexWrap:"wrap"},children:[(0,Be.tZ)(U.Z,{size:"small",color:"success",label:(0,Be.BX)("span",{children:[Z.info.name," ",(0,Be.tZ)("strong",{children:Z.value})]})}),a.fR.map((e=>(0,Be.tZ)(F.Z,{children:(0,Be.tZ)(Rt,{element:e})},e))),(0,Be.BX)(F.Z,{children:["DEF Red. ",(0,pe.p)(p)]}),(0,Be.BX)(F.Z,{children:["DEF Ignore ",(0,pe.p)(f)]}),(0,Be.BX)(s.Z,{flexGrow:1,display:"flex",justifyContent:"flex-end",gap:1,children:[(0,Be.tZ)(P.Z,{size:"small",color:"error",onClick:g,startIcon:(0,Be.tZ)(kt.Z,{}),children:e(zt||(zt=_t`reset`))}),(0,Be.tZ)(Pt,{expand:r,onClick:h,"aria-expanded":r,"aria-label":"show more",size:"small",sx:{marginLeft:0},children:(0,Be.tZ)(Fe.Z,{})})]})]}),(0,Be.tZ)(Tt.Z,{in:r,timeout:"auto",unmountOnExit:!0,children:(0,Be.tZ)(c.Z,{sx:{pt:0},children:(0,Be.tZ)(Wt,{})})})]})}function Rt({element:e}){const{data:t}=(0,d.useContext)(m.R),n=t.get(Ze.ri.enemy[`${e}_res_`]),i=!isFinite(n.value),a=(0,Be.tZ)(Ot.Z,{ele:e,iconProps:Bt.mX}),l=i?(0,Be.BX)("span",{children:[a," \u221e"]}):(0,Be.BX)("span",{children:[a," ",(0,Be.tZ)("strong",{children:(0,pe.p)(n)})]});return(0,Be.tZ)(se.Z,{color:e,children:l})}function Wt({bsProps:e={xs:12,md:6}}){var t,n,i;const{teamId:r,team:{enemyOverride:s}}=(0,d.useContext)(x.V),o=(0,l.Wz)(),{data:c}=(0,d.useContext)(m.R),u=null!=(t=s.enemyLevel)?t:c.get(Ze.ri.lvl).value,h=null!=(n=s.enemyDefIgn_)?n:0,Z=null!=(i=s.enemyDefRed_)?i:0;return(0,Be.BX)(te.ZP,{container:!0,spacing:1,children:[(0,Be.tZ)(te.ZP,Object.assign({item:!0},e,{children:(0,Be.tZ)(P.Z,{fullWidth:!0,sx:{height:"100%"},size:"small",component:"a",color:"warning",href:"https://genshin-impact.fandom.com/wiki/Resistance#Base_Enemy_Resistances",target:"_blank",rel:"noreferrer",children:"To get the specific resistance values of enemies, please visit the wiki."})})),(0,Be.tZ)(te.ZP,Object.assign({item:!0},e,{children:(0,Be.tZ)(At,{sx:{bgcolor:e=>e.palette.contentLight.main,width:"100%"},name:(0,Be.tZ)("b",{children:yt.d4.get("enemyLevel")}),value:u,placeholder:yt.d4.getStr("enemyLevel"),defaultValue:c.get(Ze.ri.lvl).value,onValueChange:e=>o.teams.set(r,(t=>{t.enemyOverride.enemyLevel=e})),onReset:()=>o.teams.set(r,(e=>{delete e.enemyOverride.enemyLevel}))})})),a.fR.map((t=>{const n=`${t}_enemyRes_`,i=s[n],a=i===Number.MAX_VALUE;return(0,Be.tZ)(te.ZP,Object.assign({item:!0},e,{children:(0,Be.tZ)(At,{sx:{bgcolor:e=>e.palette.contentLight.main,width:"100%"},name:(0,Be.tZ)(se.Z,{color:t,children:(0,Be.tZ)("b",{children:yt.d4.get(n)})}),value:void 0!==i?a?1/0:i:10,placeholder:a?"\u221e ":yt.d4.getStr(n),defaultValue:10,onValueChange:e=>o.teams.set(r,(t=>{t.enemyOverride[n]=e})),disabled:a,percent:!0,children:(0,Be.tZ)(P.Z,{color:t,onClick:()=>o.teams.set(r,(e=>{e.enemyOverride[n]=a?10:Number.MAX_VALUE})),startIcon:a?(0,Be.tZ)(St.Z,{}):(0,Be.tZ)(Xt.Z,{}),children:"Immunity"})})}),t)})),(0,Be.tZ)(te.ZP,Object.assign({item:!0},e,{children:(0,Be.tZ)(At,{sx:{bgcolor:e=>e.palette.contentLight.main,width:"100%"},name:(0,Be.tZ)("b",{children:yt.d4.get("enemyDefIgn_")}),value:h,placeholder:yt.d4.getStr("enemyDefIgn_"),defaultValue:0,onValueChange:e=>o.teams.set(r,(t=>{t.enemyOverride.enemyDefIgn_=e})),percent:!0})})),(0,Be.tZ)(te.ZP,Object.assign({item:!0},e,{children:(0,Be.tZ)(At,{sx:{bgcolor:e=>e.palette.contentLight.main,width:"100%"},name:(0,Be.tZ)("b",{children:yt.d4.get("enemyDefRed_")}),value:Z,placeholder:yt.d4.getStr("enemyDefRed_"),defaultValue:0,onValueChange:e=>o.teams.set(r,(t=>{t.enemyOverride.enemyDefRed_=e})),percent:!0})})),(0,Be.tZ)(te.ZP,{item:!0,xs:12,children:(0,Be.tZ)("small",{children:"Note: Genshin Impact halves resistance shred values below 0%. For the sake of calculations enter the RAW value and GO will do the rest. (e.g. 10% - 20% = -10%)"})})]})}let Nt,Gt=e=>e;const Vt={xs:1,md:2,lg:3};function $t({open:e,onClose:t}){const{t:n}=(0,u.$G)("page_character");return(0,Be.tZ)(ue.Z,{open:e,onClose:t,children:(0,Be.BX)(re.Z,{children:[(0,Be.tZ)(ye.Z,{title:n(Nt||(Nt=Gt`addStats.title`)),action:(0,Be.tZ)(Z.Z,{onClick:t})}),(0,Be.tZ)(c.Z,{sx:{pt:0},children:(0,Be.BX)(fe.Z,{spacing:1,children:[(0,Be.tZ)(Ht,{}),(0,Be.tZ)(Lt,{}),(0,Be.tZ)(nn,{})]})})]})})}const Ft=[...Ze.lR],qt=(e,t)=>(0,Be.tZ)(te.ZP,{item:!0,xs:1,children:e},t);function Ht(){const{t:e}=(0,u.$G)("page_character"),t=(0,l.Wz)(),{teamCharId:n,teamChar:{bonusStats:i}}=(0,d.useContext)(x.V);return(0,Be.tZ)(K.Z,{children:(0,Be.tZ)(c.Z,{sx:{display:"flex"},children:(0,Be.BX)(te.ZP,{container:!0,columns:Vt,sx:{pt:1},spacing:1,children:[(0,Be.tZ)(te.ZP,{item:!0,xs:12,children:(0,Be.tZ)(Ct.Z,{severity:"info",variant:"filled",children:(0,Be.BX)(u.cC,{i18nKey:"addStats.info",t:e,children:["You can use these fields to add buffs/debuffs not directly supported in GO, such as food buffs, abyss cards, or Superconduct. Please refer to the",(0,Be.tZ)("a",{href:"https://genshin-impact.fandom.com/wiki/Genshin_Impact_Wiki",children:"Genshin Impact Wiki"}),"for specific values."]})})}),(0,Be.tZ)(he.Z,{statKeys:Ft,statFilters:i,setStatFilters:e=>t.teamChars.set(n,{bonusStats:e}),wrapperFunc:qt,label:e("addStats.label")})]})})})}const Ut=["eleMas","critRate_","critDMG_","enerRech_","heal_"],Yt=["hp","atk","def",...Ut].map((e=>Ze.ri.total[e])),Jt=["atk_","atk","hp_","hp","def_","def",...Ut],Qt=[...yt.hX,...yt.Sx,"stamina","incHeal_","shield_","cdRed_"],en=Ze.lR.filter((e=>!Jt.includes(e)&&!Qt.includes(e)));function tn({nodes:e,extra:t}){const{data:n,oldData:i}=(0,d.useContext)(m.R);return(0,Be.BX)(we.lD,{children:[e.map((e=>{var t;return(0,Be.tZ)(we.JW,{component:wt.ZP,node:n.get(e),oldValue:null==i||null==(t=i.get(e))?void 0:t.value},JSON.stringify(e.info))})),t]})}function nn(){const{characterSheet:e}=(0,d.useContext)(x.V),{data:t}=(0,d.useContext)(m.R),n=t.get(Ze.ri.special),i=e.elementKey,a=e.isMelee(),l=(0,d.useMemo)((()=>Qt.filter((e=>!e.includes(i)&&(a&&e.includes("physical"),!0))).map((e=>Ze.ri.total[e])).filter((e=>!!t.get(e).value))),[t,i,a]),r=(0,d.useMemo)((()=>en.map((e=>Ze.ri.total[e])).filter((e=>t.get(e).value))),[t]);return(0,Be.tZ)(K.Z,{children:(0,Be.tZ)(c.Z,{children:(0,Be.BX)(te.ZP,{container:!0,columns:Vt,spacing:1,children:[(0,Be.tZ)(te.ZP,{item:!0,xs:1,children:(0,Be.tZ)(an,{title:"Main Stats",children:(0,Be.tZ)(tn,{nodes:Yt,extra:n&&(0,Be.BX)(wt.ZP,{sx:{display:"flex",justifyContent:"space-between"},children:[(0,Be.BX)("span",{children:[(0,Be.tZ)("b",{children:"Special:"})," ",(0,Be.BX)(se.Z,{color:n.info.variant,children:[n.info.icon," ",n.info.name]})]}),(0,Be.tZ)("span",{children:(0,pe.p)(n)})]})})})}),(0,Be.tZ)(te.ZP,{item:!0,xs:1,children:(0,Be.tZ)(an,{title:"Other Stats",children:(0,Be.tZ)(tn,{nodes:l})})}),!!r.length&&(0,Be.tZ)(te.ZP,{item:!0,xs:1,children:(0,Be.tZ)(an,{title:"Misc Stats",children:(0,Be.tZ)(tn,{nodes:r})})})]})})})}function an({title:e,children:t}){return(0,Be.BX)(re.Z,{children:[(0,Be.tZ)(c.Z,{sx:{py:1},children:(0,Be.tZ)(s.Z,{display:"flex",justifyContent:"space-between",children:(0,Be.tZ)(F.Z,{variant:"subtitle1",children:e})})}),t]})}var ln=n(36269),rn=n(46342),sn=n(62469),on=n(85162),cn=n(51290),dn=n(45269),un=n(10342),hn=n(39833),Zn=n(52218),pn=n(23119);function mn(){const{t:e}=(0,u.$G)("page_character_optimize");return(0,Be.tZ)(Ct.Z,{severity:"warning",variant:"filled",children:(0,Be.BX)(u.cC,{t:e,i18nKey:"noArtis",children:["Oops! It looks like you haven't added any artifacts to GO yet! You should go to the",(0,Be.tZ)(pn.Z,{component:M.rU,to:"/artifacts",children:"Artifacts"}),"page and add some!"]})})}var fn=n(29218),gn=n(2754),xn=n(93290);var bn=n(64985),vn=n(6094);function yn(e,t,n=!1){const i=new Set,l=new Set;function r(e,t){return t?i.add(e):e.operands.forEach((e=>i.has(e)&&l.add(e))),e}const s=new Set;if(e=(0,bn.uW)(e,(e=>e),(e=>{const{operation:t}=e;switch(t){case"read":return s.add(e.path[1]),r(e,!0);case"add":{const t=e.operands.filter((e=>i.has(e))),n=e.operands.filter((e=>!i.has(e)));if(0===n.length)return r(e,!0);if(t.length<=1)return r(e,!1);const a=r((0,vn.Sm)(...t),!0);return r((0,vn.Sm)(a,...n),!1)}case"mul":{const t=e.operands.filter((e=>"const"!==e.operation));return r(e,0===t.length||1===t.length&&i.has(t[0]))}case"const":return r(e,!0);case"res":case"threshold":case"sum_frac":case"max":case"min":return r(e,!1);default:(0,z.UT)(t)}})),e.filter((e=>i.has(e))).forEach((e=>l.add(e))),[...l].every((({operation:e})=>"read"===e||"const"===e))&&Object.keys(t.base).length===s.size)return{nodes:e,arts:t};let o=-1;function c(){for(;s.has(""+ ++o););return`${o}`}const d=[...l].filter((e=>"const"!==e.operation)),u=new Map(d.map((e=>[e,n||"read"!==e.operation||"dyn"!==e.path[0]?(0,vn.Cj)(c()):e])));function h(e){const t=(0,xn.CG)([...u.keys()],{dyn:(0,z.vU)(e,(e=>(0,vn.a9)(e)))},(e=>!0));return Object.fromEntries([...u.values()].map(((e,n)=>[e.path[1],t[n].value])))}const Z={nodes:e=(0,bn.uW)(e,(e=>{var t;return null!=(t=u.get(e))?t:e}),(e=>e)),arts:{base:h(t.base),values:(0,z.K8)(a.Ex,(e=>t.values[e].map((({id:e,set:t,values:n})=>({id:e,set:t,values:h(n)})))))}},p=Object.entries(h({}));for(const a of Object.values(Z.arts.values))for(const{values:e}of a)for(const[t,n]of p)e[t]-=n;return Z}function Cn(e,t,n){var i;let l=!1;const r=!(null!=(i=n.rainbow)&&i.length),s=Object.keys(e.base),o=new Set(Object.entries(n).filter((([e,t])=>t.length)).map((([e])=>e))),c=new Set(Object.entries(n).filter((([e,t])=>t.includes(2)&&!t.includes(4))).map((([e])=>e))),d=(0,z.K8)(a.Ex,(n=>{const i=e.values[n],a=i.filter((e=>{let n=0;return i.every((i=>{const a=s.every((t=>{var n,a;return(null!=(n=i.values[t])?n:0)>=(null!=(a=e.values[t])?a:0)})),l=s.some((t=>{var n,a;return(null!=(n=i.values[t])?n:0)>(null!=(a=e.values[t])?a:0)})),d=a&&(l||i.id>e.id),u=r&&!o.has(i.set)&&!c.has(e.set)||e.set===i.set;return d&&u&&n++,n<t}))}));return a.length!==i.length&&(l=!0),a}));return l?{base:e.base,values:d}:e}function wn(e,t,n){const i=Object.fromEntries(Object.entries(t.base).map((([e,t])=>[e,{min:t,max:t}]))),l={arts:t};for(;;){const t=(0,z.K8)(a.Ex,(e=>Sn(l.arts.values[e]))),r=(0,z.K8)(a.Ex,(e=>kn(Object.entries(t).map((t=>t[0]===e?i:t[1])).filter((e=>e)))));let s=!1;const o=(0,z.K8)(a.Ex,(t=>{const i=l.arts.values[t].filter((i=>{const a=kn([Sn([i]),r[t]]),l=Xn(e,a);return e.every(((e,t)=>{var i;return l.get(e).max>=(null!=(i=n[t])?i:-1/0)}))}));return i.length!==l.arts.values[t].length&&(s=!0),i}));if(!s)break;l.arts={base:l.arts.base,values:o}}return l.arts}function Bn(e,t){const n=Xn(e,kn([Object.fromEntries(Object.entries(t.base).map((([e,t])=>[e,{min:t,max:t}]))),...Object.values(t.values).map((e=>Sn(e)))]));return(0,bn.uW)(e,(e=>{{const{min:t,max:i}=n.get(e);if(t===i)return(0,vn.a9)(t)}const{operation:t}=e,i=e.operands.map((e=>n.get(e)));switch(t){case"threshold":{const[t,n,a,l]=i;if(t.min>=n.max)return e.operands[2];if(t.max<n.min)return e.operands[3];if(a.max===a.min&&l.max===l.min&&a.min===l.min&&isFinite(a.min))return(0,vn.a9)(a.max);break}case"min":{const t=e.operands.filter(((e,t)=>{const n=i[t];return i.every((e=>n.min<=e.max))}));if(t.length<i.length)return(0,vn.VV)(...t);break}case"max":{const t=e.operands.filter(((e,t)=>{const n=i[t];return i.every((e=>n.max>=e.min))}));if(t.length<i.length)return(0,vn.Fp)(...t);break}}return e}),(e=>e))}function kn(e){const t={};return e.forEach((e=>{Object.entries(e).forEach((([e,n])=>{t[e]?(t[e].min+=n.min,t[e].max+=n.max):t[e]=Object.assign({},n)}))})),t}function Sn(e){const t={};return e.length&&(Object.keys(e[0].values).filter((t=>e.every((e=>e.values[t])))).forEach((n=>t[n]={min:e[0].values[n],max:e[0].values[n]})),e.forEach((({values:e})=>{for(const[n,i]of Object.entries(e))t[n]?(t[n].max<i&&(t[n].max=i),t[n].min>i&&(t[n].min=i)):t[n]={min:0,max:i}}))),t}function Xn(e,t){const n=new Map;return(0,bn.aD)(e,(e=>{}),(e=>{var i;const{operation:a}=e,l=e.operands.map((e=>n.get(e)));let r;switch(a){case"read":if("dyn"!==e.path[0])throw new Error(`Found non-dyn path ${e.path} while computing range`);r=null!=(i=t[e.path[1]])?i:{min:0,max:0};break;case"const":r=Tn([e.value]);break;case"add":case"min":case"max":r={min:xn.aj[a](l.map((e=>e.min))),max:xn.aj[a](l.map((e=>e.max)))};break;case"res":r={min:xn.aj[a]([l[0].max]),max:xn.aj[a]([l[0].min])};break;case"mul":r=l.reduce(((e,t)=>Tn([e.min*t.min,e.min*t.max,e.max*t.min,e.max*t.max])));break;case"threshold":r=l[0].min>=l[1].max?l[2]:l[0].max<l[1].min?l[3]:Tn([],[l[2],l[3]]);break;case"sum_frac":{const[e,t]=l,n={min:e.min+t.min,max:e.max+t.max};r=n.min<=0&&n.max>=0?e.min<=0&&e.max>=0?{min:NaN,max:NaN}:{min:-1/0,max:1/0}:Tn([e.min/n.min,e.min/n.max,e.max/n.min,e.max/n.max]);break}default:(0,z.UT)(a)}n.set(e,r)})),n}function Tn(e,t=[]){const n=Math.max(...e,...t.map((e=>e.max)));return{min:Math.min(...e,...t.map((e=>e.min))),max:n}}function On(e){function t(e){if(Object(e)!==e)return Promise.reject(new TypeError(e+" is not an object."));var t=e.done;return Promise.resolve(e.value).then((function(e){return{value:e,done:t}}))}return On=function(e){this.s=e,this.n=e.next},On.prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(e){var n=this.s.return;return void 0===n?Promise.resolve({value:e,done:!0}):t(n.apply(this.s,arguments))},throw:function(e){var n=this.s.return;return void 0===n?Promise.reject(e):t(n.apply(this.s,arguments))}},new On(e)}class WorkerCoordinator{constructor(e,t,n){this.prio=void 0,this.commands=void 0,this.workers=void 0,this.workDone=new Map,this._workers=void 0,this.cancel=void 0,this.cancelled=void 0,this.callback=void 0,this.notifyNonEmpty=void 0,this.commands=t.map((e=>new z.uZ)),this.prio=new Map(t.map(((e,t)=>[e,t]))),this.callback=n,e.forEach((e=>{e.onmessage=t=>this.onMessage(t.data,e),e.onerror=e=>this.onError(e)})),this._workers=e,this.workers=e.map((e=>Promise.resolve(e))),this.cancel=()=>{},this.cancelled=new Promise(((e,t)=>this.cancel=t)),this.cancelled.catch((t=>e.forEach((e=>e.terminate()))))}async execute(e){var t=this;const n=async function(){var n,i=!1,a=!1;try{for(var l,r=function(e){var t,n,i,a=2;for("undefined"!=typeof Symbol&&(n=Symbol.asyncIterator,i=Symbol.iterator);a--;){if(n&&null!=(t=e[n]))return t.call(e);if(i&&null!=(t=e[i]))return new On(t.call(e));n="@@asyncIterator",i="@@iterator"}throw new TypeError("Object is not async iterable")}(e);i=!(l=await r.next()).done;i=!1){const e=l.value;t.add(e)}}catch(s){a=!0,n=s}finally{try{i&&null!=r.return&&await r.return()}finally{if(a)throw n}}}();for(;;){var i;const e=null==(i=this.commands.find((e=>e.length)))?void 0:i.pop();if(void 0===e){const e=await Promise.race([new Promise((e=>this.notifyNonEmpty=()=>e(!0))),Promise.all([...this.workers,n]).then((e=>!1)),this.cancelled]);if(this.notifyNonEmpty=void 0,e)continue;break}const{i:t,w:a}=await Promise.race([...this.workers.map(((e,t)=>e.then((e=>({i:t,w:e}))))),this.cancelled]);this.workers[t]=new Promise((e=>this.workDone.set(a,(()=>e(a))))),a.postMessage(e)}}onError(e){this.cancel(new Error(`Worker Error: ${e.message}`))}onMessage(e,t){void 0!==e.command?this.add(e):"done"===e.resultType?this.workDone.get(t)():this.callback(e,t)}add(e){var t;const n=this.prio.get(e.command);this.commands[n].push(e),null==(t=this.notifyNonEmpty)||t.call(this)}broadcast(e){this._workers.forEach((t=>t.postMessage(e)))}notifiedBroadcast(e){this.workers=this.workers.map((e=>e.then((e=>new Promise((t=>{this.workDone.set(e,(()=>t(e)))})))))),this._workers.forEach((t=>t.postMessage(e)))}}class GOSolver extends WorkerCoordinator{constructor(e,t,i){super(Array(i).fill(NaN).map((e=>new Worker(new URL(n.p+n.u(976),n.b)))),["iterate","split","count"],((e,t)=>{switch(e.resultType){case"interim":this.interim(e,t);break;case"finalize":this.finalizedResults.push(e);break;case"count":this.status.total=e.count;break;case"err":this.onError(e)}})),this.maxIterateSize=32e6,this.status=void 0,this.exclusion=void 0,this.topN=void 0,this.buildValues=void 0,this.finalizedResults=[];const{exclusion:a,topN:l}=e;this.status=t,this.exclusion=a,this.topN=l,this.status.total=NaN,this.buildValues=Array(l).fill({w:void 0,val:-1/0}),this.notifiedBroadcast(this.preprocess(e))}async solve(){const{exclusion:e,maxIterateSize:t}=this;return this.finalizedResults=[],await this.execute([{command:"count",exclusion:e,maxIterateSize:t}]),this.notifiedBroadcast({command:"finalize"}),await this.execute([]),this.finalizedResults}preprocess({plotBase:e,optimizationTarget:t,arts:n,topN:i,exclusion:a,constraints:l}){let r=[...(l=l.filter((e=>e.min>-1/0))).map((e=>e.value)),t];const s=[...l.map((e=>e.min)),-1/0];e&&(r.push(e),s.push(-1/0)),r=function(e,t){const n={};for(const[i,a]of Object.entries(t))a.includes(4)&&(n[i]=a.includes(2)?1:3);return(0,bn.uW)(e,(e=>e),(e=>{if("threshold"!==e.operation)return e;const[i,a,l,r]=e.operands;if("read"===i.operation&&"const"===a.operation){const e=i.path[i.path.length-1],s=a.value;if(e in n){if(n[e]<s)return r;if(2===s&&t[e].includes(2))return(0,vn.Lj)(i,4,l,r)}}return e}))}(r,a),r=(0,xn.tL)(r,{},(e=>!1)),({nodes:r,arts:n}=function(e,t,n,i,a,l){let r=l;const s={pruneNodeRange:!0},o={pruneNodeRange:!0},c={reaffine:!0},d={pruneOrder:!0,pruneArtRange:!0,pruneNodeRange:!0};let u=0;for(;Object.values(r).some((e=>e))&&u++<20;){if(r.pruneOrder){delete r.pruneOrder;const e=Cn(n,i,a);n!==e&&(n=e,r=Object.assign({},r,s))}if(r.pruneArtRange){delete r.pruneArtRange;const i=wn(e,n,t);n!==i&&(n=i,r=Object.assign({},r,o))}if(r.pruneNodeRange){delete r.pruneNodeRange;const t=Bn(e,n);e!==t&&(e=t,r=Object.assign({},r,c))}if(r.reaffine){delete r.reaffine;const{nodes:t,arts:i}=yn(e,n);e===t&&n===i||(e=t,n=i,r=Object.assign({},r,d))}}return{nodes:e,arts:n}}(r,s,n,i,a,{reaffine:!0,pruneArtRange:!0,pruneNodeRange:!0,pruneOrder:!0})),r=(0,xn.tL)(r,{},(e=>!1)),e&&(e=r.pop());return{command:"setup",arts:n,optTarget:r.pop(),plotBase:e,topN:i,constraints:r.map(((e,t)=>({value:e,min:s[t]})))}}interim(e,t){if(this.status.tested+=e.tested,this.status.failed+=e.failed,this.status.skipped+=e.skipped,e.buildValues){var n,i;const{topN:a}=this,l=null!=(n=this.buildValues[a-1].val)?n:-1/0;this.buildValues.filter((({w:e})=>e!==t)),this.buildValues.push(...e.buildValues.map((e=>({w:t,val:e})))),this.buildValues.sort(((e,t)=>t.val-e.val)).splice(a);const r=null!=(i=this.buildValues[a-1].val)?i:-1/0;l!==r&&this.broadcast({command:"threshold",threshold:r})}}}var In=n(2313),En=n(28128);function jn(){const e=(0,l.Wz)(),{teamId:t,teamCharId:n,teamChar:{key:i,compare:r,compareType:s,compareBuildId:o,compareBuildTcId:c}}=(0,d.useContext)(x.V),{gender:u}=(0,l.Hz)();return(0,d.useMemo)((()=>{if(!r)return;const{overrideArt:l,overrideWeapon:d}=(()=>{switch(s){case"equipped":{const t=e.chars.get(i);return{overrideArt:Object.values(t.equippedArtifacts).map((t=>e.arts.get(t))).filter((e=>e)),overrideWeapon:e.weapons.get(t.equippedWeapon)}}case"real":{const t=e.builds.get(o);return{overrideArt:Object.keys(t.artifactIds).map((t=>e.arts.get(t))).filter((e=>e)),overrideWeapon:e.weapons.get(t.weaponId)}}case"tc":{const t=e.buildTcs.get(c);return{overrideArt:(0,En.ho)(t),overrideWeapon:Object.assign({},t.weapon,{location:(0,a.V7)(i)})}}}})(),h=(0,v.o_)(e,t,u,n,0,l,d);if(!h)return;return h[i].target}),[i,n,t,u,r,s,o,c,e])}var Pn=n(99074),Mn=n(22499);function Kn(){const e=(0,l.Wz)(),{teamCharId:t,teamChar:{buildType:n,buildId:a,buildIds:r,buildTcId:s,buildTcIds:o,compare:c,compareType:u,compareBuildId:h,compareBuildTcId:Z,buildId:p,buildTcId:m}}=(0,d.useContext)(x.V),f=!r.length&&!o.length,g="real"===u?e.builds.get(h).name:"tc"===u?(0,Be.BX)("span",{children:[e.buildTcs.get(Z).name," ",(0,Be.tZ)(i.dL,{color:"info",children:"TC"})]}):"Equipped",b="equipped"===u&&"equipped"===n||"real"===u&&"real"===n&&a===h||"tc"===u&&"tc"===n&&s===Z;return(0,Be.BX)(Y.Z,{disabled:f,children:[(0,Be.tZ)(P.Z,{startIcon:c?(0,Be.tZ)(Pn.Z,{}):(0,Be.tZ)(Mn.Z,{}),color:c?"success":"secondary",onClick:()=>e.teamChars.set(t,{compare:!c}),children:"Compare"}),(0,Be.BX)(i.PS,{title:(0,Be.BX)(Be.HY,{children:[g," ",b&&(0,Be.tZ)(i.dL,{color:"info",children:"Current"})]}),disabled:!c,children:[(0,Be.BX)(ne.Z,{onClick:()=>e.teamChars.set(t,{compareType:"equipped"}),children:["Equipped"," ","equipped"===n&&(0,Be.tZ)(i.dL,{color:"info",children:"Current"})]}),r.map((a=>(0,Be.BX)(ne.Z,{disabled:!e.builds.get(a).weaponId,onClick:()=>e.teamChars.set(t,{compareType:"real",compareBuildId:a}),children:[e.builds.get(a).name," ","real"===n&&a===p&&(0,Be.tZ)(i.dL,{color:"info",children:"Current"})]},a))),o.map((a=>(0,Be.BX)(ne.Z,{onClick:()=>e.teamChars.set(t,{compareType:"tc",compareBuildTcId:a}),children:[e.buildTcs.get(a).name," ",(0,Be.tZ)(i.dL,{color:"info",children:"TC"}),"tc"===n&&a===m&&(0,Be.tZ)(i.dL,{color:"info",children:"Current"})]},a)))]})]})}var Dn=n(96511),An=n(92794),zn=n(79199),_n=n(91218),Ln=n(58489),Rn=n(42090),Wn=n(89279),Nn=n(28265),Gn=n(64303);let Vn,$n,Fn,qn,Hn=e=>e;var Un=function(e){return e[e.ToggleToAllow=0]="ToggleToAllow",e[e.ToggleToExclude=1]="ToggleToExclude",e}(Un||{});function Yn({disabled:e=!1,allowListTotal:t}){const{t:n}=(0,u.$G)("page_character_optimize"),{t:i}=(0,u.$G)("page_character"),{teamChar:{optConfigId:o},character:{key:h}}=(0,d.useContext)(x.V),{silly:p}=(0,d.useContext)(r.E6),{excludedLocations:m,allowLocationsState:f}=(0,l.EZ)(o),g=(0,l.Wz)(),[v,y,C]=(0,w.aV)(!1),[B,k]=(0,w.NW)(),S=(0,d.useDeferredValue)(B),[X,T]=(0,d.useState)(""),O=(0,d.useDeferredValue)(X),[I,E]=(0,d.useState)([...a.UB]),j=(0,d.useDeferredValue)(I),[M,D]=(0,d.useState)([...a.yd]),L=(0,d.useDeferredValue)(M),[R,W]=(0,d.useState)([...a.ZI]),N=(0,d.useDeferredValue)(R),G=(0,d.useMemo)((()=>S&&Object.fromEntries(Array.from(new Set(Object.entries(g.chars.data).filter((([e])=>(0,a.V7)(e)!==(0,a.V7)(h))).filter((([e])=>(0,z.CZ)({element:j,weaponType:L,rarity:N,name:O},(0,Gn.zU)(g,p))(e))))))),[S,g,h,j,L,N,O,p]),V=Array.from(new Set(Object.entries(G).sort((([e,t],[n,i])=>{const[a,l]=[-1,1],r=g.charMeta.get(e).favorite,s=g.charMeta.get(n).favorite;if(r&&!s)return a;if(s&&!r)return l;const o=Object.values(t.equippedArtifacts).filter((e=>e)).length,c=Object.values(i.equippedArtifacts).filter((e=>e)).length;return o>c?a:c>o?l:e.localeCompare(n)})).map((([e])=>(0,a.V7)(e))))),{elementTotals:q,weaponTypeTotals:H,characterRarityTotals:U,locListTotals:Y}=(0,d.useMemo)((()=>{const e={elementTotals:[...a.UB],weaponTypeTotals:[...a.yd],characterRarityTotals:[...a.ZI],locListTotals:["allowed","excluded"]};let t=!1;return(0,In.A)(e,(e=>Object.entries(g.chars.data).filter((([e])=>(0,a.V7)(e)!==(0,a.V7)(h))).forEach((([n])=>{const i=(0,b.m)(n,g.gender),l=i.elementKey,r=i.weaponTypeKey,s=i.rarity;if(e.elementTotals[l].total++,G[n]&&e.elementTotals[l].current++,"Traveler"===(0,a.V7)(n)){if(!G[n]&&V.includes("Traveler")){if(e.elementTotals[l].current++,t)return;e.weaponTypeTotals[r].current++,e.characterRarityTotals[s].current++}t=!0}e.weaponTypeTotals[r].total++,G[n]&&e.weaponTypeTotals[r].current++,e.characterRarityTotals[s].total++,G[n]&&e.characterRarityTotals[s].current++;const o=(0,a.V7)(n);V.includes(o)&&(e.locListTotals.allowed.total++,e.locListTotals.excluded.total++,m.includes(o)?e.locListTotals.excluded.current++:e.locListTotals.allowed.current++)}))))}),[G,h,g.chars.data,g.gender,m,V]);(0,d.useEffect)((()=>g.charMeta.followAny((e=>k()))),[k,g]),(0,d.useEffect)((()=>g.chars.followAny((e=>k()))),[k,g]);const[J,Q]=(0,d.useState)(!1),ne=(0,d.useCallback)((()=>g.optConfigs.set(o,{excludedLocations:m.filter((e=>!V.includes(e))),allowLocationsState:"customList"})),[g,o,m,V]),ie=(0,d.useCallback)((()=>g.optConfigs.set(o,{excludedLocations:Array.from(new Set(m.concat(V))),allowLocationsState:"customList"})),[g,o,m,V]),ae=(0,d.useCallback)(((e,t)=>g.optConfigs.set(o,{allowLocationsState:t})),[g,o]),le=(0,d.useCallback)((e=>{const t=[...e],n=t.filter((e=>!m.includes(e))).concat(m.filter((e=>!t.includes(e))));g.optConfigs.set(o,{excludedLocations:n,allowLocationsState:"customList"})}),[g,o,m]),se=(0,d.useCallback)((()=>Q(!0)),[]),oe=V.length,ce=oe-m.length,he="all"===f?oe:"customList"===f?ce===oe?ce:`${ce}/${oe}`:0,Ze="all"===f?"success":"customList"===f?"info":"secondary";return(0,Be.BX)(s.Z,{display:"flex",gap:1,children:[(0,Be.tZ)(ue.Z,{open:v,onClose:C,containerProps:{maxWidth:"xl"},draggable:!1,onMouseUp:se,children:(0,Be.BX)(re.Z,{children:[(0,Be.tZ)(c.Z,{children:(0,Be.BX)(s.Z,{display:"flex",gap:1,alignItems:"center",children:[(0,Be.tZ)(F.Z,{variant:"h6",children:n(Vn||(Vn=Hn`excludeChar.title`))}),(0,Be.tZ)(de.Z,{title:(0,Be.tZ)(F.Z,{children:n($n||($n=Hn`excludeChar.tooltip`))})}),(0,Be.tZ)(s.Z,{flexGrow:1}),(0,Be.tZ)(Z.Z,{onClick:C,size:"small"})]})}),(0,Be.tZ)(ge.Z,{}),(0,Be.tZ)(c.Z,{sx:{pb:0},children:(0,Be.BX)(fe.Z,{gap:1,children:[(0,Be.BX)(s.Z,{display:"flex",gap:1,flexWrap:"wrap",children:[(0,Be.tZ)(Ln.Z,{exclusive:!0,baseColor:"secondary",size:"small",value:f,onChange:ae,children:_.Cz.map((t=>(0,Be.tZ)(An.Z,{value:t,disabled:f===t||e,children:n(`excludeChar.states.${t}`)},t)))}),(0,Be.tZ)(ee.Z,{autoFocus:!0,value:X,onChange:e=>T(e.target.value),label:i("characterName"),size:"small",sx:{height:"100%"},InputProps:{sx:{height:"100%"}}})]}),(0,Be.BX)(s.Z,{display:"flex",gap:1,flexWrap:"wrap",children:[(0,Be.tZ)(Nn.Z,{sx:{height:"100%"},onChange:D,value:L,totals:H,size:"small"}),(0,Be.tZ)(Wn.Z,{sx:{height:"100%"},onChange:E,value:j,totals:q,size:"small"}),(0,Be.tZ)(Rn.Z,{sx:{height:"100%"},onChange:W,value:N,totals:U,size:"small"})]})]})}),(0,Be.BX)(c.Z,{sx:{opacity:"customList"===f?1:.6},children:[(0,Be.BX)(te.ZP,{container:!0,pb:1,gap:1,flexWrap:"nowrap",children:[(0,Be.tZ)(te.ZP,{item:!0,xs:6,children:(0,Be.BX)(P.Z,{color:"success",fullWidth:!0,onClick:ne,children:[n(Fn||(Fn=Hn`excludeChar.modal.allow_all`)),(0,Be.tZ)(A.Z,{sx:{ml:1},children:(0,Be.tZ)("strong",{children:Y.allowed})})]})}),(0,Be.tZ)(te.ZP,{item:!0,xs:6,children:(0,Be.BX)(P.Z,{fullWidth:!0,color:"error",onClick:ie,children:[n(qn||(qn=Hn`excludeChar.modal.disallow_All`)),(0,Be.tZ)(A.Z,{sx:{ml:1},children:(0,Be.tZ)("strong",{children:Y.excluded})})]})})]}),(0,Be.tZ)(Jn,{locList:V,excludedLocations:m,mouseUpDetected:J,setMouseUpDetected:Q,toggleList:le})]})]})}),(0,Be.BX)(K.Z,{sx:{display:"flex",width:"100%"},children:[(0,Be.tZ)(c.Z,{sx:{flexGrow:1},children:(0,Be.BX)(fe.Z,{spacing:1,children:[(0,Be.tZ)(F.Z,{children:(0,Be.tZ)("strong",{children:n("excludeChar.title")})}),(0,Be.BX)(F.Z,{children:[n("excludeChar.usingState")," ",(0,Be.tZ)(A.Z,{color:Ze,children:n(`excludeChar.states.${f}`)})]}),(0,Be.BX)(F.Z,{children:[n("excludeChar.chars")," ",(0,Be.BX)(A.Z,{color:"success",children:[he," ",(0,Be.tZ)(Dn.Z,Object.assign({},Bt.mX)),n("artSetConfig.allowed")]})]}),(0,Be.BX)(F.Z,{children:[n("excludeChar.artis")," ",(0,Be.BX)(A.Z,{color:"success",children:[t," ",(0,Be.tZ)(Dn.Z,Object.assign({},Bt.mX)),n("artSetConfig.allowed")]})]})]})}),(0,Be.tZ)(P.Z,{sx:{borderRadius:0,flexShrink:1,minWidth:40},onClick:y,disabled:e,color:"info",children:(0,Be.tZ)($.Z,{})})]})]})}function Jn({locList:e,excludedLocations:t,mouseUpDetected:n,setMouseUpDetected:i,toggleList:a}){const[l,r]=(0,d.useState)(new Set),[s,o]=(0,d.useState)();return(0,d.useEffect)((()=>{n&&(i(!1),l.size>0&&(a(l),r(new Set),o(void 0)))}),[l,r,i,n,a]),(0,Be.tZ)(te.ZP,{container:!0,spacing:1,columns:{xs:6,sm:7,md:10,lg:12,xl:16},children:e.map((e=>(0,Be.tZ)(te.ZP,{item:!0,xs:1,children:(0,Be.tZ)(Qn,{locKey:e,charList:l,charListMode:s,setCharList:r,setCharListMode:o,selected:!t.includes(e)})},e)))})}function Qn({locKey:e,selected:t,charList:n,charListMode:i,setCharList:r,setCharListMode:o}){const c=(0,l.Wz)(),u=c.chars.get(c.chars.LocationToCharacterKey(e)),h=(0,d.useCallback)((a=>1===a.buttons&&(i===Un.ToggleToAllow&&!t||i===Un.ToggleToExclude&&t)&&r(new Set([...n]).add(e))),[i,t,r,n,e]),Z=(0,d.useCallback)((()=>{const i=t?Un.ToggleToExclude:Un.ToggleToAllow;o(i),r(new Set([...n]).add(e))}),[t,o,r,n,e]),p=(0,d.useMemo)((()=>0!==n.size),[n.size]),m=t&&!(i===Un.ToggleToExclude&&n.has(e))||i===Un.ToggleToAllow&&n.has(e),f={opacity:m?void 0:.6,borderColor:m?"rgb(100,200,100)":"rgb(200,100,100)",borderWidth:"3px",borderStyle:"solid",borderRadius:"8px"},g=(0,d.useMemo)((()=>(0,Be.tZ)(s.Z,{fontSize:"0.85em",display:"flex",justifyContent:"space-between",p:.3,children:a.Ex.map((e=>(0,Be.tZ)(zn.Z,{slotKey:e,iconProps:{fontSize:"inherit",sx:{opacity:null!=u&&u.equippedArtifacts[e]?void 0:.5}}},e)))})),[null==u?void 0:u.equippedArtifacts]);return(0,Be.BX)(K.Z,{sx:f,children:[(0,Be.tZ)(_n.Z,{characterKey:c.chars.LocationToCharacterKey(e),onMouseDown:Z,onMouseEnter:h,disableTooltip:p}),g]})}var ei=n(38114),ti=n(78437),ni=n(4121),ii=n(14836);function ai({setKey:e,setNumKey:t,hideHeader:n=!1,conditionalsOnly:i=!1,disabled:a=!1}){var l;const r=(0,ni.Sk)(e),o=i?null==(l=r.setEffectDocument(t))?void 0:l.filter((e=>"states"in e)):r.setEffectDocument(t);return(0,Be.tZ)(s.Z,{display:"flex",flexDirection:"column",children:o?(0,Be.tZ)(ii.Z,{sections:o,hideHeader:n,disabled:a}):null})}var li=n(1665),ri=n(51576),si=n(26850);let oi,ci,di,ui,hi,Zi,pi,mi,fi,gi,xi,bi,vi,yi,Ci=e=>e;function wi({disabled:e}){var t,n;const{t:i}=(0,u.$G)(["page_character_optimize","sheet"]),r=(0,d.useContext)(m.R),o=(0,l.Wz)(),{teamChar:{conditional:h,optConfigId:p},teamCharId:f}=(0,d.useContext)(x.V),{artSetExclusion:g}=(0,l.EZ)(p),[b,v]=(0,d.useState)(!1),y=(0,d.useCallback)((()=>v(!0)),[v]),C=(0,d.useCallback)((()=>v(!1)),[v]),[B,k]=(0,w.NW)();(0,d.useEffect)((()=>o.arts.followAny(k)),[o,k]);const S=(0,d.useMemo)((()=>Object.entries(ni.WO).reverse().flatMap((([,e])=>e)).filter((e=>!e.includes("Prayers")))),[]),{artKeys:X,artSlotCount:T}=(0,d.useMemo)((()=>{const e=(0,z.K8)(S,(e=>(0,z.K8)(a.Ex,(e=>0))));o.arts.values.forEach((t=>e[t.setKey]&&e[t.setKey][t.slotKey]++));const t=[...S].sort(((t,n)=>+(Si(e[t])<2)-+(Si(e[n])<2)));return B&&{artKeys:t,artSlotCount:e}}),[B,o,S]),O=!(null!=(t=g.rainbow)&&t.includes(2)),I=!(null!=(n=g.rainbow)&&n.includes(4)),{allowTotals:E}=(0,d.useMemo)((()=>(0,In.A)({allowTotals:["2","4"]},(e=>S.forEach((t=>{var n,i;e.allowTotals[2].total++,null!=(n=g[t])&&n.includes(2)||e.allowTotals[2].current++,e.allowTotals[4].total++,null!=(i=g[t])&&i.includes(4)||e.allowTotals[4].current++}))))),[S,g]),j=(0,d.useMemo)((()=>Object.keys(h).filter((e=>{var t;return a.Gt.includes(e)&&!!Object.keys(null!=(t=h[e])?t:{}).length})).length),[h]),M=(0,d.useMemo)((()=>Object.assign({},r,{data:new pe.w(Object.assign({},r.data.data[0],{artSet:(0,z.K8)(a.Gt,(e=>(0,vn.a9)(4)))}),void 0)})),[r]),D=(0,d.useCallback)((()=>{const e=Object.fromEntries(Object.entries(h).filter((([e])=>!a.Gt.includes(e))));o.teamChars.set(f,(t=>{t.conditional=e}))}),[o,f,h]),L=(0,d.useCallback)(((e,t=!0)=>{const n=(0,z.I8)(g);S.forEach((i=>{var a;t?n[i]=[...null!=(a=n[i])?a:[],e]:n[i]&&(n[i]=n[i].filter((t=>t!==e)))})),o.optConfigs.set(p,{artSetExclusion:n})}),[S,g,o,p]);return(0,Be.BX)(Be.HY,{children:[(0,Be.BX)(K.Z,{sx:{display:"flex",width:"100%"},children:[(0,Be.BX)(c.Z,{sx:{flexGrow:1},children:[(0,Be.tZ)(F.Z,{children:(0,Be.tZ)("strong",{children:i(oi||(oi=Ci`artSetConfig.title`))})}),(0,Be.BX)(fe.Z,{spacing:1,children:[(0,Be.BX)(F.Z,{children:[i(ci||(ci=Ci`artSetConfig.setEffCond`))," ",(0,Be.BX)(A.Z,{color:j?"success":"warning",children:[j," ",i("artSetConfig.enabled")]})]}),(0,Be.BX)(F.Z,{children:[i(di||(di=Ci`sheet:2set`))," ",(0,Be.BX)(A.Z,{color:"success",children:[E[2]," ",(0,Be.tZ)(Dn.Z,Object.assign({},Bt.mX))," ",i("artSetConfig.allowed")]})]}),(0,Be.BX)(F.Z,{children:[i(ui||(ui=Ci`sheet:4set`))," ",(0,Be.BX)(A.Z,{color:"success",children:[E[4]," ",(0,Be.tZ)(Dn.Z,Object.assign({},Bt.mX))," ",i("artSetConfig.allowed")]})]}),(0,Be.BX)(F.Z,{children:[i(hi||(hi=Ci`artSetConfig.2rainbow`))," ",(0,Be.BX)(A.Z,{color:O?"success":"secondary",children:[O?(0,Be.tZ)(Dn.Z,Object.assign({},Bt.mX)):(0,Be.tZ)(ei.Z,Object.assign({},Bt.mX))," ",O?i("artSetConfig.allowed"):"Excluded"]})]}),(0,Be.BX)(F.Z,{children:[i(Zi||(Zi=Ci`artSetConfig.4rainbow`))," ",(0,Be.BX)(A.Z,{color:I?"success":"secondary",children:[I?(0,Be.tZ)(Dn.Z,Object.assign({},Bt.mX)):(0,Be.tZ)(ei.Z,Object.assign({},Bt.mX))," ",I?i("artSetConfig.allowed"):"Excluded"]})]})]})]}),(0,Be.tZ)(P.Z,{onClick:y,disabled:e,color:"info",sx:{borderRadius:0,flexShrink:1,minWidth:40},children:(0,Be.tZ)($.Z,{})})]}),(0,Be.tZ)(ue.Z,{open:b,onClose:C,children:(0,Be.BX)(re.Z,{children:[(0,Be.BX)(c.Z,{sx:{display:"flex",gap:1,justifyContent:"space-between"},children:[(0,Be.tZ)(F.Z,{variant:"h6",children:i(pi||(pi=Ci`artSetConfig.title`))}),(0,Be.tZ)(Z.Z,{onClick:C})]}),(0,Be.tZ)(ge.Z,{}),(0,Be.BX)(c.Z,{children:[(0,Be.tZ)(K.Z,{sx:{mb:1},children:(0,Be.BX)(c.Z,{children:[(0,Be.BX)(s.Z,{display:"flex",gap:1,children:[(0,Be.tZ)(F.Z,{children:(0,Be.tZ)("strong",{children:i(mi||(mi=Ci`artSetConfig.modal.setCond.title`))})}),(0,Be.tZ)(F.Z,{sx:{flexGrow:1},children:(0,Be.BX)(A.Z,{color:j?"success":"warning",children:[j," ",i("artSetConfig.selected")]})}),(0,Be.tZ)(P.Z,{size:"small",onClick:D,color:"error",startIcon:(0,Be.tZ)(kt.Z,{}),children:i(fi||(fi=Ci`artSetConfig.modal.setCond.reset`))})]}),(0,Be.tZ)(F.Z,{children:i(gi||(gi=Ci`artSetConfig.modal.setCond.text`))})]})}),(0,Be.tZ)(K.Z,{sx:{mb:1},children:(0,Be.BX)(c.Z,{children:[(0,Be.tZ)(F.Z,{sx:{flexGrow:1},children:(0,Be.tZ)("strong",{children:(0,Be.BX)(u.cC,{t:i,i18nKey:"artSetConfig.modal.ArtSetFilter.title",children:["Artifact Sets ",(0,Be.BX)(se.Z,{color:"success",children:["Allowed",(0,Be.tZ)(Dn.Z,Object.assign({},Bt.mX))]})," / ",(0,Be.BX)(se.Z,{color:"secondary",variant:"light",children:["Excluded",(0,Be.tZ)(ei.Z,Object.assign({},Bt.mX))]})]})})}),(0,Be.tZ)(F.Z,{children:(0,Be.BX)(u.cC,{t:i,i18nKey:"artSetConfig.modal.ArtSetFilter.intro",children:["You can allow/exclude which sets you want the builder to consider. In the following examples, ",(0,Be.tZ)("strong",{children:"A"})," is on-set, and ",(0,Be.tZ)("strong",{children:"R"})," is rainbow(off-set)"]})}),(0,Be.tZ)(F.Z,{children:(0,Be.BX)(u.cC,{t:i,i18nKey:"artSetConfig.modal.ArtSetFilter.2set",children:[(0,Be.tZ)("strong",{children:(0,Be.BX)(se.Z,{color:"secondary",variant:"light",children:["Excluding",(0,Be.tZ)(ei.Z,Object.assign({},Bt.mX))," 2-Set"]})}),"would exclude 2-Set builds:",(0,Be.BX)("strong",{children:[(0,Be.tZ)(se.Z,{color:"secondary",variant:"light",children:"AA"}),"RRR"]}),"and",(0,Be.BX)("strong",{children:[(0,Be.tZ)(se.Z,{color:"secondary",variant:"light",children:"AAA"}),"RR"]}),"."]})}),(0,Be.tZ)(F.Z,{children:(0,Be.BX)(u.cC,{t:i,i18nKey:"artSetConfig.modal.ArtSetFilter.4set",children:[(0,Be.tZ)("strong",{children:(0,Be.BX)(se.Z,{color:"secondary",variant:"light",children:["Excluding",(0,Be.tZ)(ei.Z,Object.assign({},Bt.mX))," 4-Set"]})}),"would exclude 4-Set builds:",(0,Be.BX)("strong",{children:[(0,Be.tZ)(se.Z,{color:"secondary",variant:"light",children:"AAAA"}),"R"]}),"and",(0,Be.tZ)("strong",{children:(0,Be.tZ)(se.Z,{color:"secondary",variant:"light",children:"AAAAA"})}),"."]})}),(0,Be.tZ)(F.Z,{children:(0,Be.BX)(u.cC,{t:i,i18nKey:"artSetConfig.modal.ArtSetFilter.2rain",children:[(0,Be.tZ)("strong",{children:(0,Be.BX)(se.Z,{color:"secondary",variant:"light",children:["Excluding",(0,Be.tZ)(ei.Z,Object.assign({},Bt.mX))," 3-Rainbow"]})}),"would exclude 2-Set + 3-Rainbow builds:",(0,Be.BX)("strong",{children:["AA",(0,Be.tZ)(se.Z,{color:"secondary",variant:"light",children:"RRR"})]}),"and",(0,Be.BX)("strong",{children:["AAA",(0,Be.tZ)(se.Z,{color:"secondary",variant:"light",children:"RR"})]}),"."]})}),(0,Be.tZ)(F.Z,{children:(0,Be.BX)(u.cC,{t:i,i18nKey:"artSetConfig.modal.ArtSetFilter.4rain",children:[(0,Be.tZ)("strong",{children:(0,Be.BX)(se.Z,{color:"secondary",variant:"light",children:["Excluding",(0,Be.tZ)(ei.Z,Object.assign({},Bt.mX))," 5-Rainbow"]})}),"would exclude full 5-Rainbow builds:",(0,Be.tZ)("strong",{children:(0,Be.tZ)(se.Z,{color:"secondary",variant:"light",children:"RRRRR"})}),"."]})})]})}),(0,Be.BX)(te.ZP,{container:!0,columns:{xs:2,lg:3},sx:{mb:1},spacing:1,children:[(0,Be.tZ)(te.ZP,{item:!0,xs:1,children:(0,Be.tZ)(Bi,{allowTotal:E[2],setNum:2,setAllExclusion:L})}),(0,Be.tZ)(te.ZP,{item:!0,xs:1,children:(0,Be.tZ)(Bi,{allowTotal:E[4],setNum:4,setAllExclusion:L})}),(0,Be.tZ)(te.ZP,{item:!0,xs:1,children:(0,Be.tZ)(K.Z,{children:(0,Be.BX)(c.Z,{children:[(0,Be.tZ)(F.Z,{gutterBottom:!0,children:(0,Be.tZ)("strong",{children:(0,Be.BX)(u.cC,{t:i,i18nKey:"artSetConfig.alExRainbow",children:[(0,Be.BX)(se.Z,{color:"success",children:["Allow ",(0,Be.tZ)(Dn.Z,Object.assign({},Bt.mX))]})," / ",(0,Be.BX)(se.Z,{color:"secondary",variant:"light",children:["Exclude ",(0,Be.tZ)(ei.Z,Object.assign({},Bt.mX))]})," Rainbow Builds"]})})}),(0,Be.BX)(s.Z,{sx:{display:"flex",flexDirection:"column",gap:1},children:[(0,Be.tZ)(P.Z,{fullWidth:!0,onClick:()=>o.optConfigs.set(p,{artSetExclusion:(0,_.sL)(g,"rainbow",2)}),color:O?"success":"secondary",startIcon:O?(0,Be.tZ)(St.Z,{}):(0,Be.tZ)(Xt.Z,{}),endIcon:O?(0,Be.tZ)(Dn.Z,{}):(0,Be.tZ)(ei.Z,{}),children:i(xi||(xi=Ci`artSetConfig.2rainbow`))}),(0,Be.tZ)(P.Z,{fullWidth:!0,onClick:()=>o.optConfigs.set(p,{artSetExclusion:(0,_.sL)(g,"rainbow",4)}),color:I?"success":"secondary",startIcon:I?(0,Be.tZ)(St.Z,{}):(0,Be.tZ)(Xt.Z,{}),endIcon:I?(0,Be.tZ)(Dn.Z,{}):(0,Be.tZ)(ei.Z,{}),children:i(bi||(bi=Ci`artSetConfig.4rainbow`))})]})]})})})]}),(0,Be.tZ)(te.ZP,{container:!0,spacing:1,columns:{xs:2,lg:3},children:X.map((e=>(0,Be.tZ)(ki,{setKey:e,fakeDataContextObj:M,slotCount:T[e]},e)))})]}),(0,Be.tZ)(ge.Z,{}),(0,Be.tZ)(c.Z,{sx:{py:1},children:(0,Be.tZ)(Z.Z,{large:!0,onClick:C})})]})})]})}function Bi({allowTotal:e,setNum:t,setAllExclusion:n}){const{t:i}=(0,u.$G)(["page_character_optimize","sheet"]);return(0,Be.tZ)(K.Z,{children:(0,Be.BX)(c.Z,{children:[(0,Be.BX)(F.Z,{gutterBottom:!0,children:[(0,Be.tZ)("strong",{children:i(`sheet:${t}set`)})," ",(0,Be.BX)(A.Z,{color:"success",children:[e," ",(0,Be.tZ)(Dn.Z,Object.assign({},Bt.mX))," ",i("artSetConfig.allowed")]})]}),(0,Be.BX)(s.Z,{sx:{display:"flex",flexDirection:"column",gap:1},children:[(0,Be.tZ)(P.Z,{fullWidth:!0,disabled:"0"!==e.charAt(0)&&-1===e.indexOf("/"),onClick:()=>n(t,!1),color:"success",startIcon:(0,Be.tZ)(Dn.Z,{}),children:i(`artSetConfig.allowAll${t}set`)}),(0,Be.tZ)(P.Z,{fullWidth:!0,disabled:"0"===e.charAt(0),onClick:()=>n(t,!0),color:"secondary",startIcon:(0,Be.tZ)(ei.Z,{}),children:i(`artSetConfig.excludeAll${t}set`)})]})]})})}function ki({setKey:e,fakeDataContextObj:t,slotCount:n}){var i,a;const{t:r}=(0,u.$G)("sheet"),{teamChar:{optConfigId:o}}=(0,d.useContext)(x.V),{artSetExclusion:h}=(0,l.EZ)(o),Z=null!=(i=null==h?void 0:h[e])?i:[],p=!Z.includes(4),f=Si(n),g=(0,ni.Sk)(e),b=(0,d.useMemo)((()=>p?Object.keys(g.setEffects).filter((e=>{var t;return null==(t=g.setEffects[e])?void 0:t.document.some((e=>"states"in e))})):[]),[g.setEffects,p]);return(0,Be.tZ)(te.ZP,{item:!0,xs:1,children:(0,Be.BX)(K.Z,{sx:{height:"100%",opacity:f<2?"50%":void 0},children:[(0,Be.BX)(s.Z,{className:`grad-${g.rarity[0]}star`,width:"100%",sx:{display:"flex"},children:[(0,Be.tZ)(s.Z,{component:"img",src:(0,ri.jU)(e),sx:{height:100,width:"auto",mx:-1}}),(0,Be.BX)(s.Z,{sx:{flexGrow:1,px:1,display:"flex",flexDirection:"column",justifyContent:"center"},children:[(0,Be.tZ)(F.Z,{variant:"h6",children:null!=(a=g.name)?a:""}),(0,Be.tZ)(s.Z,{children:(0,Be.BX)(F.Z,{variant:"subtitle1",children:[g.rarity.map(((e,t)=>(0,Be.BX)(s.Z,{component:"span",sx:{display:"inline-flex",alignItems:"center"},children:[e," ",(0,Be.tZ)(ti.Z,{fontSize:"inherit"})," ",t<g.rarity.length-1?"/ ":null]},e)))," ",(0,Be.tZ)(de.L,{title:(0,Be.BX)(s.Z,{children:[(0,Be.tZ)(F.Z,{children:(0,Be.tZ)(A.Z,{color:"success",children:r(vi||(vi=Ci`2set`))})}),(0,Be.tZ)(F.Z,{children:(0,Be.tZ)(li.v,{ns:`artifact_${e}_gen`,key18:"setEffects.2"})}),(0,Be.BX)(s.Z,{paddingTop:2,sx:{opacity:Z.includes(4)?.6:1},children:[(0,Be.tZ)(F.Z,{children:(0,Be.tZ)(A.Z,{color:"success",children:r(yi||(yi=Ci`4set`))})}),(0,Be.tZ)(F.Z,{children:(0,Be.tZ)(li.v,{ns:`artifact_${e}_gen`,key18:"setEffects.4"})})]})]})})]})}),(0,Be.tZ)(s.Z,{sx:{display:"flex",gap:1},children:Object.entries(n).map((([e,t])=>(0,Be.tZ)(F.Z,{sx:{flexGrow:1},variant:"subtitle2",children:(0,Be.BX)(A.Z,{sx:{width:"100%"},color:t?"primary":"secondary",children:[(0,Be.tZ)(zn.Z,{slotKey:e,iconProps:Bt.mX})," ",t]})},e)))})]})]}),_.Uu.includes(e)&&(0,Be.tZ)(si.Z,{setKey:e,buttonGroupSx:{".MuiButton-root":{borderRadius:0}}}),!!b.length&&(0,Be.tZ)(m.R.Provider,{value:t,children:(0,Be.tZ)(c.Z,{sx:{display:"flex",flexDirection:"column",gap:2},children:b.map((t=>(0,Be.tZ)(ai,{setKey:e,setNumKey:parseInt(t),hideHeader:!0,conditionalsOnly:!0},t)))})})]})},e)}function Si(e){return Object.values(e).reduce(((e,t)=>e+(t?1:0)),0)}const Xi=[0,4,8,12,16,20];function Ti({mainStatAssumptionLevel:e=0,setmainStatAssumptionLevel:t,disabled:n}){const{t:i}=(0,u.$G)("page_character_optimize");return(0,Be.tZ)(ce.Z,{fullWidth:!0,color:e?"success":"primary",disabled:n,title:e?i("mainStat.assumptionLvl.lvl",{lvl:e}):i("mainStat.assumptionLvl.no"),children:Xi.map((e=>(0,Be.tZ)(ne.Z,{onClick:()=>t(e),children:e?i("mainStat.assumptionLvl.lvl",{lvl:e}):i("mainStat.assumptionLvl.no")},e)))})}let Oi,Ii=e=>e;function Ei(){const{t:e}=(0,u.$G)("page_character_optimize"),{teamChar:{bonusStats:t}}=(0,d.useContext)(x.V),{data:n}=(0,d.useContext)(m.R),i=Object.keys(t);if(!i.length)return null;const a=i.map((e=>n.get(Ze.ri.customBonus[e])));return(0,Be.BX)(K.Z,{children:[(0,Be.tZ)(c.Z,{children:(0,Be.tZ)(F.Z,{sx:{fontWeight:"bold"},children:e(Oi||(Oi=Ii`bonusStats.title`))})}),(0,Be.tZ)(ge.Z,{}),(0,Be.tZ)(c.Z,{children:a.map((e=>(0,Be.tZ)(we.JW,{node:e},JSON.stringify(e.info))))})]})}var ji=n(38162);const Pi=(0,ie.ZP)("strong")({fontFamily:"monospace"}),Mi=(0,ie.ZP)(ji.Z)((()=>({height:10,borderRadius:5})));function Ki({status:{type:e,tested:t,failed:n,skipped:i,total:a,startTime:l,finishTime:r},characterName:s}){const o=isFinite(a),c="inactive"!==e,d=a-i,u=(0,Be.tZ)(Pi,{children:t.toLocaleString()}),h=(0,Be.tZ)(Pi,{children:d.toLocaleString()}),Z=!!i&&(0,Be.BX)("span",{children:["(",(0,Be.tZ)("b",{children:(0,Be.tZ)(Pi,{children:i.toLocaleString()})})," skipped)"]}),p=(0,Be.tZ)(Pi,{children:(0,z.e6)(Math.round((null!=r?r:performance.now())-(null!=l?l:NaN)))});let m,f="",g="";if(c)m=100*t/d,f=(0,Be.BX)(F.Z,{children:["Generating and testing ",u,o?(0,Be.BX)(Be.HY,{children:["/",h]}):void 0," build configurations against the criteria for ",(0,Be.tZ)("b",{children:s}),". ",Z]}),g=(0,Be.BX)(F.Z,{children:["Time elapsed: ",p]});else{if(!(t+i))return null;m=100,f=(0,Be.BX)(F.Z,{children:["Generated and tested ",u," Build configurations against the criteria for ",(0,Be.tZ)("b",{children:s}),". ",Z]}),g=(0,Be.BX)(F.Z,{children:["Total duration: ",p]})}return(0,Be.BX)(Ct.Z,{severity:"success",variant:"filled",sx:{"& .MuiAlert-message":{flexGrow:1}},children:[f,g,void 0!==m&&(0,Be.BX)(te.ZP,{container:!0,spacing:1,alignItems:"center",children:[o&&(0,Be.tZ)(te.ZP,{item:!0,children:(0,Be.tZ)(F.Z,{children:`${m.toFixed(1)}%`})}),(0,Be.tZ)(te.ZP,{item:!0,flexGrow:1,children:(0,Be.tZ)(Mi,{variant:o?"determinate":"indeterminate",value:m,color:"primary"})})]})]})}var Di=n(30067),Ai=n(68164),zi=n(15099),_i=n(61660),Li=n(22443),Ri=n(55484),Wi=n(61135),Ni=n(81224),Gi=n(3131),Vi=n(47857),$i=n(55734),Fi=n(63004),qi=n(36197);function Hi({cx:e,cy:t,payload:n,selectedPoint:i,radiusSelected:a=6,radiusUnselected:l=3,colorSelected:r="red",colorUnselected:s,shape:o="circle"}){if(!e||!t||!n)return null;const c=i&&i.x===n.x&&i.y===n.y;return(0,Be.tZ)("g",{className:"custom-dot","data-chart-x":e,"data-chart-y":t,"data-x-value":n.x,"data-y-value":n.y,"data-radius":c?l:a,children:c?(0,Be.BX)(Be.HY,{children:[(0,Be.tZ)(Ui,{id:"customShapeSelected",shape:o,cx:e,cy:t,r:a/2,fill:r}),(0,Be.tZ)(Ui,{id:"customShapeBorder",shape:o,cx:e,cy:t,r:a,fill:"none",stroke:r})]}):(0,Be.tZ)(Ui,{id:"customShapeUnselected",shape:o,cx:e,cy:t,r:l,fill:s})})}function Ui({shape:e,id:t,cx:n,cy:i,r:a,fill:l,stroke:r}){switch(e){case"circle":return(0,Be.tZ)("circle",{id:t,cx:n,cy:i,r:a,fill:l,stroke:r});case"square":return(0,Be.tZ)("rect",{id:t,x:n-a,y:i-a,width:2*a,height:2*a,fill:l,stroke:r});case"diamond":return(0,Be.tZ)("polygon",{id:t,points:`${n},${i+2.5*a} ${n+1.5*a},${i} ${n},${i-2.5*a} ${n-1.5*a},${i}`,fill:l,stroke:r})}}var Yi=n(99118),Ji=n(45390),Qi=n(57167);const ea=["xLabel","xUnit","yLabel","yUnit","selectedPoint","setSelectedPoint","addBuildToList"];function ta(e){let{xLabel:t,xUnit:n,yLabel:i,yUnit:r,selectedPoint:s,setSelectedPoint:h,addBuildToList:p}=e,f=(0,It.Z)(e,ea);const g=(0,l.Wz)(),{data:x}=(0,d.useContext)(m.R),{t:b}=(0,u.$G)("page_character_optimize"),v=(0,d.useMemo)((()=>s&&s.artifactIds&&Object.fromEntries(s.artifactIds.map((e=>{const t=g.arts.get(e);return[null==t?void 0:t.slotKey,t]})).filter((e=>e)))),[g.arts,s]),y=(0,d.useCallback)((e=>{e.target.id.includes("customShape")||e.target.id.includes("chartContainer")||h(void 0)}),[h]),C=v&&a.Ex.every((e=>{var t,n;return(null==(t=v[e])?void 0:t.id)===(null==(n=x.get(Ze.qH.art[e].id).value)?void 0:n.toString())})),w=(0,d.useMemo)((()=>void 0!==(null==s?void 0:s.generBuildNumber)&&`#${null==s?void 0:s.generBuildNumber}`),[s]),B=(0,d.useMemo)((()=>void 0!==(null==s?void 0:s.graphBuildNumber)&&(0,Be.BX)(u.cC,{t:b,i18nKey:"graphBuildLabel",count:null==s?void 0:s.graphBuildNumber,children:["Graph #",{count:(null==s?void 0:s.graphBuildNumber)+1}]})),[s,b]);return f.active&&s?(0,Be.tZ)(Yi.d,{onClickAway:y,children:(0,Be.tZ)(re.Z,{sx:{minWidth:"400px",maxWidth:"400px"},onClick:e=>e.stopPropagation(),children:(0,Be.tZ)(c.Z,{children:(0,Be.BX)(fe.Z,{gap:1,children:[(0,Be.BX)(fe.Z,{direction:"row",alignItems:"start",gap:1,children:[(0,Be.BX)(fe.Z,{spacing:.5,flexGrow:99,children:[C&&(0,Be.tZ)(A.Z,{color:"info",children:(0,Be.tZ)("strong",{children:b("currentlyEquippedBuild")})}),w&&(0,Be.tZ)(A.Z,{color:"info",children:w}),B&&(0,Be.tZ)(A.Z,{color:"info",children:B}),(0,Be.tZ)(d.Suspense,{fallback:(0,Be.tZ)(o.Z,{width:300,height:50}),children:(0,Be.tZ)(Qi.u,{artifacts:Object.values(v),currentlyEquipped:C})})]}),(0,Be.tZ)(te.ZP,{item:!0,flexGrow:1}),(0,Be.tZ)(Z.Z,{onClick:()=>h(void 0)})]}),(0,Be.tZ)(te.ZP,{container:!0,direction:"row",spacing:.75,columns:5,children:a.Ex.map((e=>(0,Be.tZ)(te.ZP,{item:!0,xs:1,children:(0,Be.tZ)(d.Suspense,{fallback:(0,Be.tZ)(o.Z,{width:75,height:75}),children:(0,Be.tZ)(Ji.Z,{artifactObj:v[e],slotKey:e})})},e)))}),(0,Be.BX)(F.Z,{children:[(0,Be.tZ)("strong",{children:t}),":"," ",(0,z.EC)("%"===n?s.x/100:s.x,n)]}),(0,Be.BX)(F.Z,{children:[(0,Be.tZ)("strong",{children:i}),":"," ",(0,z.EC)("%"===r?s.y/100:s.y,r)]}),(0,Be.tZ)(dn.Z,{title:s.highlighted?b("tcGraph.buildAlreadyInList"):"",placement:"top",children:(0,Be.tZ)("span",{children:(0,Be.tZ)(P.Z,{sx:{width:"100%"},disabled:void 0!==(null==s?void 0:s.graphBuildNumber),color:"info",onClick:()=>p(s.artifactIds),children:b("addBuildToList")})})})]})})})}):null}class EnhancedPoint{constructor(e,t,n){this.x=void 0,this.trueY=void 0,this.artifactIds=void 0,this.min=void 0,this.current=void 0,this.highlighted=void 0,this.generBuildNumber=void 0,this.graphBuildNumber=void 0,this.x=e,this.trueY=t,this.artifactIds=n}get y(){return this.trueY||this.current||this.highlighted}set y(e){this.trueY=e}}let na,ia,aa,la,ra,sa,oa,ca=e=>e;function da({plotBase:e,setPlotBase:t,disabled:n=!1,showTooltip:i=!1}){const{t:r}=(0,u.$G)(["page_character_optimize","ui"]),{data:s}=(0,d.useContext)(m.R),{chartData:o}=(0,d.useContext)(g.V),[h,Z]=(0,d.useState)(!1),[p,f]=(0,d.useState)(!0),{graphBuilds:b}=(0,d.useContext)(g.V),{teamChar:{optConfigId:v}}=(0,d.useContext)(x.V),{builds:y}=(0,l.EZ)(v),[C,B]=(0,d.useState)(-1/0),[k,S]=(0,d.useState)(1/0),X=(0,d.useCallback)(((e,t)=>{if("number"==typeof t)throw new TypeError;const[n,i]=t;B(n),S(i)}),[B,S]);(0,d.useEffect)((()=>{B(-1/0),S(1/0)}),[o]);const{displayData:T,downloadData:O,sliderMin:I,sliderMax:E}=(0,d.useMemo)((()=>{var e,t;if(!o)return{displayData:null,downloadData:null};let n=1/0,i=-1/0;const l=a.Ex.map((e=>{var t;return null!=(t=null==s?void 0:s.get(Ze.qH.art[e].id).value)?t:""})),r=o.data.map((({value:e,plot:t,artifactIds:a})=>{if(void 0===t)return null;t<n&&(n=t),t>i&&(i=t);const r=new EnhancedPoint(t,e,a),s=(0,z.K8)(a,(e=>!0));l.every((e=>s[e]))&&(r.current=e,r.y=void 0);const o=null==b?void 0:b.findIndex((e=>e.every((e=>s[e]))));void 0!==o&&-1!==o&&(void 0!==r.trueY&&(r.highlighted=e,r.y=void 0),r.graphBuildNumber=o+1);const c=y.findIndex((e=>e.every((e=>s[e]))));return-1!==c&&(void 0!==r.trueY&&(r.highlighted=e,r.y=void 0),r.generBuildNumber=c+1),r})).filter((e=>null!==e)).sort(((e,t)=>e.x-t.x)),c=[];for(const a of r){let e;for(;e=c.pop();)if(e.y>a.y){c.push(e);break}c.push(a)}(null==(e=c[0])?void 0:e.x)!==(null==(t=r[0])?void 0:t.x)&&(r[0].min=c[0].y),c.forEach((e=>{e.min=e.y}));const d={minimum:c.map((e=>[e.x,e.y])),allData:r.map((e=>[e.x,e.y]))};return{displayData:r.filter((e=>e&&e.x>=C&&e.x<=k)),downloadData:d,sliderMin:n,sliderMax:i}}),[o,y,s,b,C,k]),j=e&&(0,z.Hm)(null==s?void 0:s.getDisplay(),e),M=r(e&&(!j||j.isEmpty)?"page_character_optimize:targetSelector.invalidTarget":"page_character_optimize:targetSelector.selectGraphTarget");return(0,Be.BX)(K.Z,{children:[(0,Be.tZ)(c.Z,{children:(0,Be.BX)(te.ZP,{container:!0,spacing:1,alignItems:"center",children:[(0,Be.tZ)(te.ZP,{item:!0,children:(0,Be.tZ)(F.Z,{children:r(na||(na=ca`tcGraph.vs`))})}),(0,Be.tZ)(te.ZP,{item:!0,children:(0,Be.tZ)(dn.Z,{placement:"top",title:i?r("page_character_optimize:selectTargetFirst"):"",children:(0,Be.tZ)("span",{children:(0,Be.tZ)(Te,{optimizationTarget:e,setTarget:e=>t(e),defaultText:M,disabled:n})})})}),(0,Be.tZ)(te.ZP,{item:!0,children:(0,Be.tZ)(dn.Z,{title:e?r("ui:reset"):"",placement:"top",children:(0,Be.tZ)("span",{children:(0,Be.tZ)(P.Z,{color:"error",onClick:()=>t(void 0),disabled:!e||n,children:(0,Be.tZ)(kt.Z,{})})})})}),(0,Be.tZ)(te.ZP,{item:!0,flexGrow:1,children:(0,Be.tZ)(de.Z,{placement:"top",title:r("page_character_optimize:tcGraph.desc")})}),!!O&&(0,Be.tZ)(te.ZP,{item:!0,children:(0,Be.tZ)(P.Z,{size:"small",startIcon:p?(0,Be.tZ)(St.Z,{}):(0,Be.tZ)(Xt.Z,{}),color:p?"success":"secondary",onClick:()=>f(!p),children:r(ia||(ia=ca`tcGraph.showStatThr`))})}),!!O&&(0,Be.tZ)(te.ZP,{item:!0,children:(0,Be.tZ)(P.Z,{size:"small",color:"info",startIcon:(0,Be.tZ)(Ai.Z,{}),onClick:()=>Z(!h),children:r(aa||(aa=ca`tcGraph.downloadData`))})})]})}),T&&!!T.length&&(0,Be.tZ)(ge.Z,{}),o&&T&&!!T.length&&(0,Be.BX)(c.Z,{children:[(0,Be.tZ)(Tt.Z,{in:!!O&&h,children:(0,Be.tZ)(re.Z,{sx:{mb:2},children:(0,Be.BX)(c.Z,{children:[(0,Be.tZ)(F.Z,{children:"Min Data"}),(0,Be.tZ)(w.TU,{value:JSON.stringify(null==O?void 0:O.minimum)}),(0,Be.tZ)(F.Z,{children:"All Data"}),(0,Be.tZ)(w.TU,{value:JSON.stringify(null==O?void 0:O.allData)})]})})}),(0,Be.tZ)(ma,{displayData:T,plotNode:o.plotNode,valueNode:o.valueNode,showMin:p}),T.length>1&&(0,Be.tZ)(zi.ZP,{marks:!0,value:[C,k],onChange:X,onChangeCommitted:X,min:I,max:E,step:(E-I)/20,valueLabelDisplay:"auto",valueLabelFormat:e=>{var t,n;return(0,z.EC)("%"===(null==(t=o.plotNode.info)?void 0:t.unit)?e/100:e,null==(n=o.plotNode.info)?void 0:n.unit)},sx:{ml:"6%",width:"93%"}})]})]})}const ua="#8884d8",ha="cyan",Za="#46a046",pa="#ff7300";function ma({displayData:e,plotNode:t,valueNode:n,showMin:i}){var a,l,r,s;const{graphBuilds:o,setGraphBuilds:c}=(0,d.useContext)(g.V),{t:h}=(0,u.$G)("page_character_optimize"),[Z,p]=(0,d.useState)(),m=(0,d.useCallback)((e=>{c([...null!=o?o:[],e]),p(void 0)}),[c,o]),f=(0,d.useCallback)((t=>{t&&t.chartX&&t.chartY&&p(function(e,t,n,i){const a=Array.from(document.querySelectorAll(".custom-dot")).reduce(((n,i)=>{const{chartX:a,chartY:l}=n.dataset,r=Math.sqrt((e-a)**2+(t-l)**2),{chartX:s,chartY:o}=i.dataset;return r<=Math.sqrt((e-s)**2+(t-o)**2)?n:i})).dataset;return Math.sqrt((e-a.chartX)**2+(t-a.chartY)**2)<n?i.find((e=>e.x===+a.xValue&&e.y===+a.yValue)):void 0}(t.chartX,t.chartY,20,e))}),[p,e]),x=fa(t,h),b=fa(n,h);return(0,Be.tZ)(_i.h,{width:"100%",height:600,children:(0,Be.BX)(Li.c,{id:"chartContainer",data:e,onClick:f,style:{cursor:"pointer"},children:[(0,Be.tZ)(Ri.q,{strokeDasharray:"3 3"}),(0,Be.tZ)(Wi.K,{dataKey:"x",scale:"linear",unit:null==(a=t.info)?void 0:a.unit,domain:["auto","auto"],tick:{fill:"white"},type:"number",tickFormatter:e=>e>1e4?e.toFixed():e.toFixed(1),label:(0,Be.tZ)(Ni._,{fill:"white",dy:10,children:x}),height:50}),(0,Be.tZ)(Gi.B,{name:"DMG",domain:["auto","auto"],unit:null==(l=n.info)?void 0:l.unit,allowDecimals:!1,tick:{fill:"white"},type:"number",label:(0,Be.tZ)(Ni._,{fill:"white",angle:-90,dx:-40,children:b}),width:100}),(0,Be.tZ)(Vi.u,{content:(0,Be.tZ)(ta,{xLabel:x,xUnit:null==(r=t.info)?void 0:r.unit,yLabel:b,yUnit:null==(s=n.info)?void 0:s.unit,selectedPoint:Z,setSelectedPoint:p,addBuildToList:m}),trigger:"click",wrapperStyle:{pointerEvents:"auto",cursor:"auto"},cursor:!1}),(0,Be.tZ)($i.D,{payload:[...i?[{id:"min",value:h(la||(la=ca`tcGraph.statReqThr`)),type:"line",color:pa}]:[],{id:"trueY",value:h(ra||(ra=ca`tcGraph.generatedBuilds`)),type:"circle",color:ua},{id:"highlighted",value:h(sa||(sa=ca`tcGraph.highlightedBuilds`)),type:"square",color:ha},{id:"current",value:h(oa||(oa=ca`tcGraph.currentBuild`)),type:"diamond",color:Za}]}),i&&(0,Be.tZ)(Fi.x,{dataKey:"min",stroke:pa,type:"stepBefore",connectNulls:!0,strokeWidth:2,isAnimationActive:!1,dot:!1,activeDot:!1}),(0,Be.tZ)(qi.b,{dataKey:"trueY",isAnimationActive:!1,shape:(0,Be.tZ)(Hi,{selectedPoint:Z,colorUnselected:ua})}),(0,Be.tZ)(qi.b,{dataKey:"highlighted",isAnimationActive:!1,shape:(0,Be.tZ)(Hi,{shape:"square",selectedPoint:Z,colorUnselected:ha})}),(0,Be.tZ)(qi.b,{dataKey:"current",isAnimationActive:!1,shape:(0,Be.tZ)(Hi,{shape:"diamond",selectedPoint:Z,colorUnselected:Za})})]})})}function fa(e,t){var n,i,a,l,r;return"string"==typeof(null==(n=e.info)?void 0:n.name)?e.info.name:`${t(`${null==(i=e.info)||null==(i=i.name)?void 0:i.props.ns}:${null==(a=e.info)||null==(a=a.name)?void 0:a.props.key18}`)}${null!=(l=e.info)&&l.textSuffix?` ${null==(r=e.info)?void 0:r.textSuffix}`:""}`}var ga=n(22537),xa=n(30706),ba=n(15015);let va,ya,Ca,wa,Ba,ka=e=>e;function Sa({disabled:e=!1,excludedTotal:t}){const{t:n}=(0,u.$G)("page_character_optimize"),i=(0,l.Wz)(),{teamChar:{optConfigId:a}}=(0,d.useContext)(x.V),{artExclusion:r,useExcludedArts:o}=(0,l.EZ)(a),[h,p,m]=(0,w.aV)(!1),f=r.length,[g,b,v]=(0,w.aV)(!1),y=(0,d.useCallback)((e=>{i.optConfigs.set(a,{artExclusion:[...r,e],useExcludedArts:!1})}),[i,a,r]),C=(0,d.useCallback)((e=>{i.optConfigs.set(a,{artExclusion:r.filter((t=>t!==e)),useExcludedArts:!1})}),[i,a,r]),B=(0,d.useCallback)((()=>i.optConfigs.set(a,{useExcludedArts:!o})),[i,a,o]);return(0,Be.BX)(Be.HY,{children:[(0,Be.tZ)(ue.Z,{open:h,onClose:m,containerProps:{maxWidth:"xl"},children:(0,Be.BX)(re.Z,{children:[(0,Be.tZ)(c.Z,{children:(0,Be.BX)(s.Z,{display:"flex",gap:1,alignItems:"center",children:[(0,Be.tZ)(F.Z,{variant:"h6",children:n(va||(va=ka`excludeArt.title_exclude`))}),(0,Be.tZ)(de.Z,{title:(0,Be.tZ)(F.Z,{children:n(ya||(ya=ka`excludeArt.title_tooltip`))})}),(0,Be.tZ)(s.Z,{flexGrow:1}),(0,Be.tZ)(Z.Z,{onClick:m,size:"small"})]})}),(0,Be.tZ)(ge.Z,{}),(0,Be.BX)(c.Z,{children:[(0,Be.tZ)(Oa,{show:g,onClose:v,onSelect:y,artExclusion:r}),(0,Be.tZ)(P.Z,{fullWidth:!0,onClick:b,color:"info",sx:{mb:1},startIcon:(0,Be.tZ)(L.Z,{}),children:n(Ca||(Ca=ka`excludeArt.addExc`))}),!!f&&(0,Be.tZ)(K.Z,{sx:{mb:1},children:(0,Be.tZ)(F.Z,{textAlign:"center",children:n(wa||(wa=ka`excludeArt.deSelectExc`))})}),(0,Be.tZ)(te.ZP,{container:!0,columns:{xs:3,md:5,lg:6,xl:8},spacing:1,children:r.map((e=>(0,Be.tZ)(te.ZP,{item:!0,xs:1,children:(0,Be.tZ)(rt.Z,{artifactId:e,slotKey:"flower",BGComponent:K.Z,onClick:()=>C(e),showLocation:!0})},e)))})]})]})}),(0,Be.BX)(Y.Z,{sx:{display:"flex",width:"100%"},children:[(0,Be.tZ)(P.Z,{onClick:B,disabled:e||!f,startIcon:o?(0,Be.tZ)(Mn.Z,{}):(0,Be.tZ)(Pn.Z,{}),color:o?"secondary":"success",sx:{flexGrow:1},children:(0,Be.BX)(s.Z,{sx:{display:"flex",gap:1},children:[(0,Be.tZ)(s.Z,{children:n("excludeArt.button_txt")}),(0,Be.tZ)(A.Z,{sx:{whiteSpace:"normal"},color:f?o?"warning":"primary":"secondary",children:o?(0,Be.BX)(u.cC,{t:n,i18nKey:"excludeArt.usingNum",children:["Using ",{totalStr:t}," excluded artifacts"]}):(0,Be.BX)(u.cC,{t:n,i18nKey:"excludeArt.excNum",count:f,children:[{count:f}," artifacts are excluded"]})})]})}),(0,Be.tZ)(P.Z,{color:"info",onClick:p,disabled:e,sx:{flexShrink:1},children:(0,Be.tZ)($.Z,{})})]})]})}const Xa={xs:6,sm:6,md:9,lg:12,xl:12},Ta=(e,t)=>Object.assign({},e,t);function Oa({onSelect:e,show:t,onClose:n,artExclusion:i}){const{t:a}=(0,u.$G)("page_character_optimize"),r=(0,l.Wz)(),h=(0,d.useCallback)((t=>{e(t),n()}),[e,n]),[p,m]=(0,d.useReducer)(Ta,(0,ba.Af)()),[f,g]=(0,w.NW)();(0,d.useEffect)((()=>r.arts.followAny(g)),[r,g]);const x=(0,w.JT)(),b=(0,d.useMemo)((()=>(0,ba.EM)()),[]),v=(0,d.useMemo)((()=>{const e=(0,z.CZ)(p,b);return f&&r.arts.values.filter(e).map((e=>e.id)).filter((e=>!i.includes(e))).slice(0,Xa[x])}),[f,r,b,p,x,i]);return(0,Be.tZ)(ue.Z,{open:t,onClose:n,containerProps:{maxWidth:"xl"},children:(0,Be.BX)(re.Z,{children:[(0,Be.BX)(c.Z,{sx:{py:1,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,Be.tZ)(F.Z,{variant:"h6",children:a(Ba||(Ba=ka`excludeArt.selExc`))}),(0,Be.tZ)(Z.Z,{onClick:n})]}),(0,Be.tZ)(ge.Z,{}),(0,Be.BX)(c.Z,{children:[(0,Be.tZ)(d.Suspense,{fallback:(0,Be.tZ)(o.Z,{variant:"rectangular",width:"100%",height:200}),children:(0,Be.tZ)(ga.default,{filterOption:p,filterOptionDispatch:m,filteredIds:v})}),(0,Be.tZ)(s.Z,{mt:1,children:(0,Be.tZ)(d.Suspense,{fallback:(0,Be.tZ)(o.Z,{variant:"rectangular",width:"100%",height:300}),children:(0,Be.tZ)(te.ZP,{container:!0,spacing:1,columns:{xs:2,md:3,lg:4},children:v.map((e=>(0,Be.tZ)(te.ZP,{item:!0,xs:1,children:(0,Be.tZ)(xa.Z,{artifactId:e,onClick:h})},e)))})})})]})]})})}var Ia=n(61851);const Ea=["sands","goblet","circlet"];function ja({disabled:e=!1,filteredArtIdMap:t}){const{t:n}=(0,u.$G)("artifact"),{teamChar:{optConfigId:i}}=(0,d.useContext)(x.V),{mainStatKeys:r}=(0,l.EZ)(i),o=(0,l.Wz)(),{mainStatSlotTots:h,slotTots:Z}=(0,d.useMemo)((()=>{const e={flowerMainStatTots:a.x1.flower.stats,plumeMainStatTots:a.x1.plume.stats,sandsMainStatTots:a.x1.sands.stats,gobletMainStatTots:a.x1.goblet.stats,circletMainStatTots:a.x1.circlet.stats,slotTots:Ea},n=(0,In.A)(e,(e=>Object.entries(o.arts.data).forEach((([n,i])=>{const{slotKey:a,mainStatKey:l}=i;Ea.includes(a)&&(e.slotTots[a].total++,t[n]&&e.slotTots[a].current++),e[`${a}MainStatTots`][l].total++,t[n]&&e[`${a}MainStatTots`][l].current++}))));return{mainStatSlotTots:{flower:n.flowerMainStatTots,plume:n.plumeMainStatTots,sands:n.sandsMainStatTots,goblet:n.gobletMainStatTots,circlet:n.circletMainStatTots},slotTots:n.slotTots}}),[o,t]);return(0,Be.BX)(s.Z,{display:"flex",flexDirection:"column",children:[(0,Be.tZ)(ge.Z,{}),(0,Be.BX)(s.Z,{display:"flex",children:[(0,Be.tZ)(c.Z,{sx:{flexGrow:1},children:(0,Be.BX)(s.Z,{sx:{display:"flex",gap:1,alignItems:"center"},children:[(0,Be.tZ)(dn.Z,{placement:"top",title:(0,Be.tZ)(F.Z,{children:n("slotName.flower")}),children:(0,Be.tZ)(ht.pv,{fontSize:"inherit"})}),(0,Be.tZ)(s.Z,{flexGrow:1,children:(0,Be.BX)(A.Z,{color:"info",children:[(0,Be.tZ)(ht.If,Object.assign({},Bt.mX))," ",h.flower.hp]})})]})}),(0,Be.tZ)(ge.Z,{orientation:"vertical",flexItem:!0}),(0,Be.tZ)(c.Z,{sx:{flexGrow:1},children:(0,Be.BX)(s.Z,{sx:{display:"flex",gap:1,alignItems:"center"},children:[(0,Be.tZ)(dn.Z,{placement:"top",title:(0,Be.tZ)(F.Z,{children:n("slotName.plume")}),children:(0,Be.tZ)(ht.QA,{fontSize:"inherit"})}),(0,Be.tZ)(s.Z,{flexGrow:1,children:(0,Be.BX)(A.Z,{color:"info",children:[(0,Be.tZ)(ht._B,Object.assign({},Bt.mX))," ",h.plume.atk]})})]})})]}),Ea.map((t=>{const l=r[t],d=a.x1[t].stats,u=(0,Ia.X)([...d]);return(0,Be.BX)(s.Z,{children:[(0,Be.tZ)(ge.Z,{}),(0,Be.BX)(c.Z,{sx:{pt:1,pb:1},children:[(0,Be.BX)(s.Z,{sx:{display:"flex",gap:1,alignItems:"center",pb:1},children:[(0,Be.tZ)(dn.Z,{placement:"top",title:(0,Be.tZ)(F.Z,{children:n(`slotName.${t}`)}),children:(0,Be.tZ)(s.Z,{lineHeight:0,children:(0,Be.tZ)(zn.Z,{slotKey:t,iconProps:{fontSize:"inherit"}})})}),(0,Be.tZ)(s.Z,{flexGrow:1,children:(0,Be.tZ)(A.Z,{color:"info",children:Z[t]})})]}),(0,Be.tZ)(te.ZP,{container:!0,spacing:1,children:d.map(((n,s)=>{const c=a.fR.find((e=>n.includes(e))),d=l.includes(n)?null!=c?c:"success":"secondary";return(0,Be.tZ)(te.ZP,{item:!0,flexGrow:1,xs:s<3&&"goblet"!==t||"goblet"===t?4:void 0,children:(0,Be.tZ)(dn.Z,{placement:"top",title:(0,Be.tZ)(F.Z,{children:(0,Be.tZ)("strong",{children:(0,Be.tZ)(pt._,{statKey:n})})}),disableInteractive:!0,children:(0,Be.tZ)(P.Z,{fullWidth:!0,size:"small",color:d,sx:{height:"100%",pointerEvents:e?"none":void 0,cursor:e?"none":void 0},startIcon:(0,Be.tZ)(Ot.C,{statKey:n}),onClick:()=>o.optConfigs.set(i,{mainStatKeys:Object.assign({},r,{[t]:u(l,n)})}),children:h[t][n]})})},n)}))})]})]},t)}))]})}function Pa({statFilters:e,setStatFilters:t,disabled:n=!1}){const i=(0,d.useCallback)(((n,i,a)=>{var l;const r=Object.assign({},e),s=JSON.stringify(i),o=i?[...e[s]]:void 0,c=JSON.stringify(n),d=[...null!=(l=e[c])?l:[]];void 0!==a&&o?d.push(o[a]):d.push({value:0,disabled:!1}),r[c]=d,void 0!==a&&o&&(o.splice(a,1),o.length?r[s]=o:delete r[s]),t(Object.assign({},r))}),[t,e]),a=(0,d.useCallback)(((n,i)=>{const a=Object.assign({},e),l=JSON.stringify(n),r=[...e[l]];r.splice(i,1),r.length?a[l]=r:delete a[l],t(Object.assign({},a))}),[t,e]),l=(0,d.useCallback)(((n,i,a)=>{const l=Object.assign({},e),r=JSON.stringify(n),s=[...e[r]];s[i]=Object.assign({},s[i],{value:a}),l[r]=s,t(Object.assign({},l))}),[t,e]),r=(0,d.useCallback)(((n,i,a)=>{const l=Object.assign({},e),r=JSON.stringify(n),s=[...e[r]];s[i]=Object.assign({},s[i],{disabled:a}),l[r]=s,t(Object.assign({},l))}),[t,e]);return(0,Be.BX)(Be.HY,{children:[Object.entries(e).flatMap((([e,t])=>null==t?void 0:t.map(((t,s)=>(0,Be.tZ)(Ma,{path:JSON.parse(e),setting:t,index:s,setTarget:i,delTarget:a,setValue:l,setDisabled:r,disabled:n},e+s))))),(0,Be.tZ)(Ma,{setTarget:i,delTarget:a,setValue:l,setDisabled:r,disabled:n})]})}function Ma({path:e,setting:t,index:n,setTarget:i,delTarget:a,setValue:l,setDisabled:r,disabled:s}){var o;const{t:c}=(0,u.$G)("page_character_optimize"),{data:h}=(0,d.useContext)(m.R),Z=(0,d.useCallback)((t=>e&&void 0!==n&&l(e,n,null!=t?t:0)),[l,e,n]),p={p:1,flexBasis:30,flexGrow:0,flexShrink:0},f=(0,C.Hm)(h.getDisplay(),null!=e?e:[]),g="%"===(null==f||null==(o=f.info)?void 0:o.unit);return(0,Be.BX)(Y.Z,{sx:{"& .MuiButtonGroup-grouped":{minWidth:24},width:"100%"},children:[!!t&&!!e&&void 0!==n&&(0,Be.tZ)(P.Z,{sx:p,color:t.disabled?"secondary":"success",onClick:()=>r(e,n,!t.disabled),disabled:s,children:t.disabled?(0,Be.tZ)(Xt.Z,{}):(0,Be.tZ)(St.Z,{})}),(0,Be.tZ)(Te,{showEmptyTargets:!0,optimizationTarget:e,setTarget:t=>i(t,e,n),defaultText:c("targetSelector.selectBuildTarget")}),(0,Be.tZ)(oe.CC,{sx:{flexBasis:150,flexGrow:1},children:(0,Be.tZ)(oe.ZP,{float:!0,disabled:!e||s,value:null==t?void 0:t.value,placeholder:"Stat Value",onChange:Z,sx:{px:1},inputProps:{sx:{textAlign:"right"}},endAdornment:g?"%":void 0})}),!!e&&void 0!==n&&(0,Be.tZ)(P.Z,{sx:p,color:"error",onClick:()=>a(e,n),disabled:s,children:(0,Be.tZ)(rn.Z,{fontSize:"small"})})]})}let Ka,Da,Aa=e=>e;function za({disabled:e=!1}){const{t}=(0,u.$G)("page_character_optimize"),{teamChar:{optConfigId:n}}=(0,d.useContext)(x.V),{statFilters:i}=(0,l.EZ)(n),a=(0,l.Wz)(),r=(0,d.useCallback)((e=>a.optConfigs.set(n,{statFilters:e})),[a,n]);return(0,Be.tZ)(s.Z,{children:(0,Be.BX)(K.Z,{children:[(0,Be.tZ)(c.Z,{sx:{display:"flex",gap:1,justifyContent:"space-between",flexDirection:"column"},children:(0,Be.BX)(s.Z,{display:"flex",justifyContent:"space-between",children:[(0,Be.tZ)(F.Z,{sx:{fontWeight:"bold"},children:t(Ka||(Ka=Aa`constraintFilter.title`))}),(0,Be.tZ)(de.Z,{title:(0,Be.tZ)(F.Z,{children:t(Da||(Da=Aa`constraintFilter.tooltip`))})})]})}),(0,Be.tZ)(ge.Z,{}),(0,Be.tZ)(s.Z,{display:"flex",flexDirection:"column",gap:.5,children:(0,Be.tZ)(Pa,{statFilters:i,setStatFilters:r,disabled:e})})]})})}var _a=n(89848);let La,Ra,Wa,Na,Ga,Va,$a,Fa=e=>e;const qa=new Audio("notification.mp3");function Ha(){var e;const{t}=(0,u.$G)("page_character_optimize"),{teamCharId:n,teamChar:{optConfigId:r,key:h},teamId:Z}=(0,d.useContext)(x.V),{characterSheet:f}=(0,d.useContext)(p.K),b=(0,l.Wz)(),{setChartData:y,graphBuilds:C,setGraphBuilds:B}=(0,d.useContext)(g.V),{gender:k}=(0,l.Hz)(),[S,X]=(0,d.useState)(!1),O=(0,d.useRef)(!1);(0,d.useEffect)((()=>{O.current=S}),[S]);const[I,E]=(0,d.useState)({type:"inactive",tested:0,failed:0,skipped:0,total:0}),j="inactive"!==I.type,[M,L]=(0,w.NW)(),[{threads:R=_.gk},W]=(0,d.useState)(b.displayOptimize.get());(0,d.useEffect)((()=>b.displayOptimize.follow(((e,t)=>W(t)))),[b,W]);const N=R>_.gk?_.gk:R,G=(0,d.useCallback)((e=>b.displayOptimize.set({threads:e})),[b]);(0,d.useEffect)((()=>{E({type:"inactive",tested:0,failed:0,skipped:0,total:0})}),[h]);const V=(0,d.useMemo)((()=>!b.arts.values.length),[b]),$=(0,l.EZ)(r),{plotBase:q,optimizationTarget:H,mainStatAssumptionLevel:U,allowPartial:J,maxBuildsToShow:Q,levelLow:ee,levelHigh:ie,builds:ae,buildDate:le}=$,{data:re}=(0,d.useContext)(m.R),se=jn(),oe=H&&(0,z.Hm)(null==re?void 0:re.getDisplay(),H),ue=["xs","sm"].includes((0,w.JT)());(0,d.useEffect)((()=>b.arts.followAny(L)),[L,b]);const he=(0,d.useDeferredValue)(M),Ze=(0,d.useDeferredValue)($),pe=(0,d.useMemo)((()=>{const{mainStatKeys:e,excludedLocations:t,artExclusion:n,levelLow:i,levelHigh:l,allowLocationsState:r,useExcludedArts:s}=he&&Ze;return b.arts.values.filter((o=>{if(!s&&n.includes(o.id))return!1;if(o.level<i)return!1;if(o.level>l)return!1;const c=e[o.slotKey];if(null!=c&&c.length&&!c.includes(o.mainStatKey))return!1;const d=(0,a.V7)(h),u="unequippedOnly"===r&&o.location&&o.location!==d,Z="customList"===r&&o.location&&o.location!==d&&t.includes(o.location);return!u&&!Z}))}),[b,h,he,Ze]),me=(0,d.useMemo)((()=>(0,z.K8)(pe.map((({id:e})=>e)),(e=>!0))),[pe]),{levelTotal:fe,allowListTotal:xe,excludedTotal:be}=(0,d.useMemo)((()=>(0,In.A)({levelTotal:["in"],allowListTotal:["in"],excludedTotal:["in"]},(e=>Object.entries(b.arts.data).forEach((([t,n])=>{const{level:i,location:l}=n,{levelLow:r,levelHigh:s,excludedLocations:o,allowLocationsState:c,artExclusion:d}=he&&Ze;i>=r&&i<=s&&(e.levelTotal.in.total++,me[t]&&e.levelTotal.in.current++);const u=(0,a.V7)(h),Z="all"===c&&l&&l!==u,p="customList"===c&&l&&l!==u&&!o.includes(l);(Z||p)&&(e.allowListTotal.in.total++,me[t]&&e.allowListTotal.in.current++),d.includes(t)&&(e.excludedTotal.in.total++,me[t]&&e.excludedTotal.in.current++)}))))),[h,b.arts.data,he,Ze,me]),ve=(0,d.useRef)(!0);(0,d.useEffect)((()=>{const e=()=>ve.current=!0,t=()=>ve.current=!1;return window.addEventListener("focus",e),window.addEventListener("blur",t),()=>{window.removeEventListener("focus",e),window.removeEventListener("blur",t)}}),[ve]);const ye=(0,d.useRef)((()=>{}));(0,d.useEffect)((()=>()=>ye.current()),[]);const Ce=function(){const[,e]=(0,d.useState)();return(0,d.useCallback)((t=>{e((()=>{throw t}))}),[])}(),we=(0,d.useCallback)((async()=>{var e,i,a;const{artSetExclusion:l,plotBase:s,statFilters:o,optimizationTarget:c,mainStatAssumptionLevel:d,allowPartial:u,maxBuildsToShow:p}=$;if(!h||!c)return;const m=(0,_a.wg)(pe,d,u),f=(0,v.VF)(b,Z,n,d,[]);if(!f)return;const g=null==(e=(0,gn.Qo)(f.teamData,k,h)[h])?void 0:e.target.data[0];if(!g)return;Object.assign(g,(0,gn.b3)([g,_a.mQ]));const x=(0,z.Hm)(null!=(i=g.display)?i:{},c);if(!x)return;const C=x,w=Object.entries(o).flatMap((([e,t])=>t.filter((e=>!e.disabled)).map((t=>{var n,i;const a=(0,z.Hm)(null!=(n=g.display)?n:{},JSON.parse(e));return{value:a,minimum:"%"===(null==(i=a.info)?void 0:i.unit)?t.value/100:t.value}})))).filter((e=>e.value&&e.minimum>-1/0));y(void 0);const B=new Promise((e=>ye.current=e)),S=[...w.map((e=>e.value)),x],X=[...w.map((e=>e.minimum)),-1/0],T=s&&(0,z.Hm)(null!=(a=g.display)?a:{},s);T&&(S.push(T),X.push(-1/0));const I=(0,xn.tL)(S,g,(({path:[e]})=>"dyn"!==e)),j=T?I.pop():void 0,P={arts:m,optimizationTarget:I.pop(),exclusion:l,constraints:I.map(((e,t)=>({value:e,min:X[t]}))),topN:p,plotBase:j},M={tested:0,failed:0,skipped:0,total:0,startTime:performance.now()},K=setInterval((()=>E(Object.assign({type:"active"},M))),100),D=new Error;try{const e=new GOSolver(P,M,N);B.then((()=>e.cancel(D)));const n=await e.solve();if(e.cancel(),ye.current=()=>{},T){var A,_;const e=function(e){let t=.01,n=new Set(e.flatMap((e=>Object.values(e).map((e=>Math.round(e.plot/t))))));for(;n.size>1500;)t*=2,n=new Set([...n].map((e=>Math.round(e/2))));const i={};for(const a of e)for(const e of Object.values(a)){const n=Math.round(e.plot/t)*t;(!i[n]||i[n].value<e.value)&&(i[n]=e)}return i}(n.map((e=>e.plotData)));let t=Object.values(e);"%"===(null==(A=C.info)?void 0:A.unit)&&(t=t.map((({value:e,plot:t,artifactIds:n})=>({value:100*e,plot:t,artifactIds:n})))),"%"===(null==(_=T.info)?void 0:_.unit)&&(t=t.map((({value:e,plot:t,artifactIds:n})=>({value:e,plot:100*(null!=t?t:0),artifactIds:n})))),y({valueNode:C,plotNode:T,data:t})}const i=function(e,t){return e.flatMap((e=>e)).sort(((e,t)=>t.value-e.value)).slice(0,t)}(n.map((e=>e.builds)),p);0,b.optConfigs.set(r,{builds:i.map((e=>e.artifactIds)),buildDate:Date.now()}),setTimeout((()=>{n&&O.current&&(qa.play(),ve.current||setTimeout((()=>window.alert(t(La||(La=Fa`buildCompleted`)))),1))}),100)}catch(L){L!==D&&(console.log("Failed to load worker"),console.log(L),L instanceof Error&&Ce(L)),ye.current(),M.tested=0,M.failed=0,M.skipped=0,M.total=0}finally{clearInterval(K),E(Object.assign({type:"inactive"},M,{finishTime:performance.now()}))}}),[n,Z,$,h,pe,b,k,y,N,r,t,Ce]),ke=null!=(e=null==f?void 0:f.name)?e:"Character Name",Se=(0,d.useCallback)((e=>{b.optConfigs.set(r,{plotBase:e}),y(void 0)}),[b,r,y]),Xe=(0,Be.tZ)(Te,{optimizationTarget:H,setTarget:e=>b.optConfigs.set(r,{optimizationTarget:e}),disabled:!!j}),Oe=(0,d.useCallback)((e=>(0,Be.BX)(u.cC,{t,i18nKey:"graphBuildLabel",count:e+1,children:["Graph #",{count:e+1}]})),[t]),Ie=(0,d.useCallback)((e=>`#${e+1}`),[]);return(0,Be.BX)(s.Z,{display:"flex",flexDirection:"column",gap:1,children:[V&&(0,Be.tZ)(mn,{}),(0,Be.BX)(te.ZP,{container:!0,spacing:1,children:[(0,Be.BX)(te.ZP,{item:!0,xs:12,sm:6,lg:3,display:"flex",flexDirection:"column",gap:1,children:[(0,Be.tZ)(s.Z,{children:(0,Be.tZ)(d.Suspense,{fallback:(0,Be.tZ)(o.Z,{variant:"rectangular",width:"100%",height:600}),children:(0,Be.BX)(i.s8,{bgt:"light",children:[(0,Be.tZ)(hn.ql,{characterKey:h,children:(0,Be.tZ)(hn.uh,{characterKey:h})}),(0,Be.BX)(s.Z,{sx:{p:1,width:"100%",display:"flex",flexDirection:"column",gap:1},children:[(0,Be.tZ)(un.S,{}),(0,Be.tZ)(Zn.D,{})]})]})})}),(0,Be.tZ)(Ei,{})]}),(0,Be.BX)(te.ZP,{item:!0,xs:12,sm:6,lg:4,display:"flex",flexDirection:"column",gap:1,children:[(0,Be.BX)(K.Z,{children:[(0,Be.BX)(c.Z,{sx:{display:"flex",gap:1},children:[(0,Be.tZ)(F.Z,{sx:{fontWeight:"bold"},children:t(Ra||(Ra=Fa`levelFilter`))}),(0,Be.tZ)(A.Z,{color:"info",children:fe.in})]}),(0,Be.tZ)(ge.Z,{}),(0,Be.tZ)(c.Z,{children:(0,Be.tZ)(cn.Z,{levelLow:ee,levelHigh:ie,setLow:e=>b.optConfigs.set(r,{levelLow:e}),setHigh:e=>b.optConfigs.set(r,{levelHigh:e}),setBoth:(e,t)=>b.optConfigs.set(r,{levelLow:e,levelHigh:t}),disabled:j})})]}),(0,Be.BX)(K.Z,{children:[(0,Be.tZ)(c.Z,{children:(0,Be.tZ)(F.Z,{sx:{fontWeight:"bold"},children:t(Wa||(Wa=Fa`mainStat.title`))})}),(0,Be.tZ)(ge.Z,{}),(0,Be.tZ)(c.Z,{children:(0,Be.BX)(s.Z,{display:"flex",alignItems:"center",gap:1,children:[(0,Be.tZ)(Ti,{mainStatAssumptionLevel:U,setmainStatAssumptionLevel:e=>b.optConfigs.set(r,{mainStatAssumptionLevel:e}),disabled:j}),(0,Be.tZ)(de.Z,{title:(0,Be.BX)(s.Z,{children:[(0,Be.tZ)(F.Z,{variant:"h6",children:t(Na||(Na=Fa`mainStat.levelAssTooltip.title`))}),(0,Be.tZ)(F.Z,{children:t(Ga||(Ga=Fa`mainStat.levelAssTooltip.desc`))})]})})]})}),(0,Be.tZ)(ja,{disabled:j,filteredArtIdMap:me})]})]}),(0,Be.BX)(te.ZP,{item:!0,xs:12,sm:6,lg:5,display:"flex",flexDirection:"column",gap:1,children:[(0,Be.tZ)(wi,{disabled:j}),(0,Be.tZ)(Sa,{disabled:j,excludedTotal:be.in}),(0,Be.tZ)(P.Z,{fullWidth:!0,startIcon:J?(0,Be.tZ)(St.Z,{}):(0,Be.tZ)(Xt.Z,{}),color:J?"success":"secondary",onClick:()=>b.optConfigs.set(r,{allowPartial:!J}),disabled:j,children:t(Va||(Va=Fa`allowPartial`))}),(0,Be.tZ)(Yn,{disabled:j,allowListTotal:xe.in}),(0,Be.tZ)(za,{disabled:j})]})]}),ue&&Xe,(0,Be.BX)(Y.Z,{children:[!ue&&Xe,(0,Be.BX)(ce.Z,{disabled:j||!h,title:(0,Be.BX)(u.cC,{t,i18nKey:"build",count:Q,children:[{count:Q}," Builds"]}),children:[(0,Be.tZ)(ne.Z,{children:(0,Be.tZ)(F.Z,{variant:"caption",color:"info.main",children:t("buildDropdownDesc")})}),(0,Be.tZ)(ge.Z,{}),_.sY.map((e=>(0,Be.tZ)(ne.Z,{onClick:()=>b.optConfigs.set(r,{maxBuildsToShow:e}),children:(0,Be.BX)(u.cC,{t,i18nKey:"build",count:e,children:[{count:e}," Builds"]})},e)))]}),(0,Be.BX)(ce.Z,{disabled:j||!h,sx:{borderRadius:"4px 0px 0px 4px"},title:(0,Be.BX)(u.cC,{t,i18nKey:"thread",count:N,children:[{count:N}," Threads"]}),children:[(0,Be.tZ)(ne.Z,{children:(0,Be.tZ)(F.Z,{variant:"caption",color:"info.main",children:t("threadDropdownDesc")})}),(0,Be.tZ)(ge.Z,{}),(0,z.w6)(1,_.gk).reverse().map((e=>(0,Be.tZ)(ne.Z,{onClick:()=>G(e),children:(0,Be.BX)(u.cC,{t,i18nKey:"thread",count:e,children:[{count:e}," Threads"]})},e)))]}),(0,Be.tZ)(dn.Z,{placement:"top",title:t($a||($a=Fa`notifyTooltip`)),children:(0,Be.tZ)(P.Z,{sx:{borderRadius:0},color:"warning",onClick:()=>X((e=>!e)),children:S?(0,Be.tZ)(sn.Z,{}):(0,Be.tZ)(on.Z,{})})}),(0,Be.tZ)(dn.Z,{placement:"top",title:H?"":t("selectTargetFirst"),children:(0,Be.tZ)("span",{children:(0,Be.tZ)(P.Z,{disabled:!h||!H||!oe||oe.isEmpty,color:j?"error":"success",onClick:j?()=>ye.current():we,startIcon:j?(0,Be.tZ)(ln.Z,{}):(0,Be.tZ)(T.Z,{}),sx:{borderRadius:"0px 4px 4px 0px"},children:t(j?"generateButton.cancel":"generateButton.generateBuilds")})})})]}),!!h&&(0,Be.tZ)(Ki,{status:I,characterName:ke,maxBuildsToShow:Q}),(0,Be.tZ)(s.Z,{children:(0,Be.tZ)(da,{disabled:j||!H,plotBase:q,setPlotBase:Se,showTooltip:!H})}),(0,Be.tZ)(K.Z,{children:(0,Be.BX)(c.Z,{children:[(0,Be.BX)(s.Z,{display:"flex",alignItems:"center",gap:1,mb:1,children:[(0,Be.tZ)(F.Z,{sx:{flexGrow:1},children:ae?(0,Be.BX)("span",{children:["Showing"," ",(0,Be.tZ)("strong",{children:ae.length+(C?C.length:0)})," ","build generated for ",ke,"."," ",!!le&&(0,Be.BX)("span",{children:["Build generated on:"," ",(0,Be.tZ)("strong",{children:new Date(le).toLocaleString()})]})]}):(0,Be.tZ)("span",{children:"Select a character to generate builds."})}),(0,Be.tZ)(P.Z,{disabled:!ae.length,color:"error",onClick:()=>{B(void 0),b.optConfigs.set(r,{builds:[],buildDate:0})},children:"Clear Builds"})]}),(0,Be.BX)(te.ZP,{container:!0,display:"flex",spacing:1,children:[(0,Be.tZ)(te.ZP,{item:!0,children:(0,Be.tZ)(D.Hn,{size:"small"})}),(0,Be.tZ)(te.ZP,{item:!0,children:(0,Be.tZ)(D.oX,{size:"small"})}),(0,Be.tZ)(te.ZP,{item:!0,flexGrow:1}),(0,Be.tZ)(te.ZP,{item:!0,children:(0,Be.tZ)(Kn,{})})]})]})}),(0,Be.BX)(fn.o.Provider,{value:H,children:[C&&(0,Be.tZ)(Ua,{builds:C,oldData:se,disabled:!!j,getLabel:Oe,setBuilds:B,mainStatAssumptionLevel:U}),(0,Be.tZ)(Ua,{builds:ae,oldData:se,disabled:!!j,getLabel:Ie,mainStatAssumptionLevel:U})]})]})}function Ua({builds:e,setBuilds:t,oldData:n,disabled:i,getLabel:a,mainStatAssumptionLevel:l}){const r=(0,d.useCallback)((n=>{if(t){const i=[...e];i.splice(n,1),t(i)}}),[e,t]),s=(0,d.useContext)(x.V),{teamChar:{key:c}}=s;return(0,d.useMemo)((()=>!!s&&(0,Be.tZ)(d.Suspense,{fallback:(0,Be.tZ)(o.Z,{variant:"rectangular",width:"100%",height:600}),children:null==e?void 0:e.map(((e,s)=>(0,Be.tZ)(el,{characterKey:c,build:e,oldData:n,mainStatAssumptionLevel:l,children:(0,Be.tZ)(Ya,{index:s,label:a(s),build:e,disabled:i,deleteBuild:t?r:void 0})},s+e.join())))})),[s,e,c,n,i,a,r,t,l])}function Ya({index:e,label:t,build:n,disabled:i,deleteBuild:a}){const{t:l}=(0,u.$G)("page_character_optimize");return(0,Be.tZ)(Di.Z,{label:t,disabled:i,extraButtonsLeft:(0,Be.BX)(Be.HY,{children:[(0,Be.tZ)(Ja,{build:n}),(0,Be.tZ)(Qa,{build:n}),a&&(0,Be.tZ)(P.Z,{color:"error",size:"small",startIcon:(0,Be.tZ)(rn.Z,{}),onClick:()=>a(e),children:l("removeBuildButton")})]})})}function Ja({build:e}){const{t}=(0,u.$G)("page_character_optimize"),[n,a]=(0,d.useState)(""),[r,o,h]=(0,w.aV)(),p=(0,l.Wz)(),{teamCharId:m,teamChar:{key:f}}=(0,d.useContext)(x.V);return(0,Be.BX)(Be.HY,{children:[(0,Be.tZ)(P.Z,{color:"info",size:"small",startIcon:(0,Be.tZ)(B.Z,{}),onClick:o,children:t("theorycraftButton")}),(0,Be.tZ)(i.AB,{open:r,onClose:h,children:(0,Be.BX)(i.s8,{children:[(0,Be.tZ)(ye.Z,{title:"New Theorycraft Build",action:(0,Be.tZ)(Z.Z,{onClick:h})}),(0,Be.tZ)(ge.Z,{}),(0,Be.BX)(c.Z,{sx:{display:"flex",flexDirection:"column",gap:1},children:[(0,Be.tZ)(F.Z,{children:"Copy over this build to a new TC Build"}),(0,Be.tZ)(ee.Z,{value:n,onChange:e=>a(e.target.value),autoFocus:!0,margin:"dense",label:"TC Loadout Name",fullWidth:!0}),(0,Be.BX)(s.Z,{sx:{display:"flex",justifyContent:"flex-end",gap:1},children:[(0,Be.tZ)(P.Z,{onClick:h,children:"Cancel"}),(0,Be.tZ)(P.Z,{color:"success",disabled:!n,onClick:()=>{const t=(0,Qe.Ru)(f).weaponType,i=p.teamChars.getLoadoutWeapon(m),l=p.teamChars.newBuildTcFromBuild(m,t,i,e.map((e=>p.arts.get(e))));p.buildTcs.set(l,{name:n}),a(""),h()},children:"Create"})]})]})]})})]})}function Qa({build:e}){const[t,n]=(0,d.useState)(""),[r,o,u]=(0,w.aV)(),h=(0,l.Wz)(),{teamCharId:p}=(0,d.useContext)(x.V);return(0,Be.BX)(Be.HY,{children:[(0,Be.tZ)(P.Z,{color:"info",size:"small",startIcon:(0,Be.tZ)(et.Z,{}),onClick:o,children:"Loadout"}),(0,Be.tZ)(i.AB,{open:r,onClose:u,children:(0,Be.BX)(i.s8,{children:[(0,Be.tZ)(ye.Z,{title:"New Build Loadout",action:(0,Be.tZ)(Z.Z,{onClick:u})}),(0,Be.tZ)(ge.Z,{}),(0,Be.BX)(c.Z,{sx:{display:"flex",flexDirection:"column",gap:1},children:[(0,Be.tZ)(F.Z,{children:"Copy over this build to a new Loadout Build"}),(0,Be.tZ)(ee.Z,{value:t,onChange:e=>n(e.target.value),autoFocus:!0,margin:"dense",label:"Loadout Name",fullWidth:!0}),(0,Be.BX)(s.Z,{sx:{display:"flex",justifyContent:"flex-end",gap:1},children:[(0,Be.tZ)(P.Z,{onClick:u,children:"Cancel"}),(0,Be.tZ)(P.Z,{color:"success",disabled:!t,onClick:()=>{const i=h.teamChars.getLoadoutWeapon(p),l=(0,z.K8)(a.Ex,(()=>{}));e.forEach((e=>{const t=h.arts.get(e);l[t.slotKey]=e})),h.teamChars.newBuild(p,{name:t,weaponId:i.id,artifactIds:l}),n(""),u()},children:"Create"})]})]})]})})]})}function el({children:e,characterKey:t,build:n,oldData:i,mainStatAssumptionLevel:a}){const r=(0,l.Wz)(),[s,o]=(0,w.NW)();(0,d.useEffect)((()=>r.arts.followAny((e=>n.includes(e)&&o()))),[r,n,o]);const c=(0,d.useMemo)((()=>s&&n.map((e=>r.arts.get(e))).filter((e=>e))),[s,n,r]),u=(0,v.ZP)(a,c),h=(0,d.useMemo)((()=>{const e=null==u?void 0:u[t];if(e)return{data:e.target,teamData:u,oldData:i}}),[u,i,t]);return h?(0,Be.tZ)(m.R.Provider,{value:h,children:e}):null}var tl=n(46725),nl=n(47746),il=n(86432);let al,ll=e=>e;function rl(){var e;const{character:{key:t}}=(0,d.useContext)(p.K),{teamChar:{buildType:n,buildId:i}}=(0,d.useContext)(x.V),r=i&&"real"===n,{teamData:o,data:c}=(0,d.useContext)(m.R),u=null==(e=o[t])?void 0:e.weaponSheet,h=(0,l.Wz)(),Z=(0,nl.Z)(),f=(0,il.Z)(Z.breakpoints.up("lg")),g=(0,d.useMemo)((()=>u&&u.document.length>0&&(0,Be.tZ)(K.Z,{children:(0,Be.tZ)(s.Z,{p:1,children:(0,Be.tZ)(ii.Z,{sections:u.document})})})),[u]),b=(0,Qe.Ru)(t).weaponType,v=c.get(Ze.ri.weapon.id).value,y=(0,d.useMemo)((()=>(0,z.K8)(a.Ex,(e=>c.get(Ze.ri.art[e].id).value))),[c]);return(0,Be.tZ)(s.Z,{children:(0,Be.BX)(te.ZP,{container:!0,spacing:1,children:[f&&(0,Be.BX)(te.ZP,{item:!0,xs:12,md:12,lg:3,xl:3,sx:{display:"flex",flexDirection:"column",gap:1},children:[g&&g,(0,Be.tZ)(sl,{})]}),(0,Be.tZ)(te.ZP,{item:!0,xs:12,md:12,lg:9,xl:9,children:(0,Be.tZ)(lt.ZP,{weaponTypeKey:b,weaponId:v,artifactIds:y,setWeapon:e=>{r?h.builds.set(i,{weaponId:e}):h.weapons.set(e,{location:(0,a.V7)(t)})},setArtifact:(e,n)=>{r?h.builds.set(i,(t=>{t.artifactIds[e]=n})):h.arts.set(n,{location:(0,a.V7)(t)})}})}),!f&&(0,Be.BX)(te.ZP,{item:!0,xs:12,md:12,xl:3,container:!0,spacing:1,children:[g&&(0,Be.tZ)(te.ZP,{item:!0,xs:12,md:6,lg:4,children:g}),(0,Be.tZ)(te.ZP,{item:!0,xs:12,md:6,lg:4,sx:{display:"flex",flexDirection:"column",gap:1},children:(0,Be.tZ)(sl,{})})]})]})})}function sl(){const{t:e}=(0,u.$G)(["page_character","artifact"]),t=(0,l.Wz)(),{character:{equippedArtifacts:n}}=(0,d.useContext)(p.K),{teamChar:{buildType:i,buildId:r}}=(0,d.useContext)(x.V),{data:o}=(0,d.useContext)(m.R),c=(0,d.useMemo)((()=>!!Object.values(n).filter((e=>e)).length),[n]),h=r&&"real"===i,Z=(0,d.useMemo)((()=>(0,ni.ND)(o)),[o]);return(0,Be.BX)(K.Z,{children:[c&&(0,Be.tZ)(P.Z,{color:"error",onClick:()=>{const e=h?"Do you want to unequip all artifacts in this loadout?":"Do you want to move all currently equipped artifacts to inventory?";window.confirm(e)&&(h?t.builds.set(r,{artifactIds:(0,z.K8)(a.Ex,(()=>{}))}):Object.values(n).forEach((e=>t.arts.set(e,{location:""}))))},fullWidth:!0,sx:{borderBottomRightRadius:0,borderBottomLeftRadius:0},children:e(al||(al=ll`tabEquip.unequipArts`))}),(0,Be.tZ)(s.Z,{p:1,children:(0,Be.tZ)(fe.Z,{spacing:1,children:Z&&Object.entries(Z).flatMap((([e,t])=>t.map((t=>(0,Be.tZ)(ai,{setKey:e,setNumKey:t},e+t)))))})})]})}var ol=n(91267),cl=n(14083),dl=n(37140);function ul(){const{character:{key:e}}=(0,d.useContext)(p.K),{gender:t}=(0,l.Hz)(),n=(0,h.s0)(),[a,o,c]=(0,w.aV)();return(0,Be.BX)(i.s8,{bgt:"light",sx:{height:"100%"},children:[(0,Be.tZ)(dl.A$,{}),(0,Be.BX)(s.Z,{children:[(0,Be.tZ)(cl.Z,{characterKey:a?e:void 0,onClose:c}),(0,Be.tZ)(s.Z,{sx:{px:1},children:(0,Be.tZ)(P.Z,{fullWidth:!0,color:"info",onClick:o,startIcon:(0,Be.tZ)(ol.Z,{}),children:"EDIT"})}),(0,Be.tZ)(at.Z,{sx:{p:1},onClick:()=>n("talent"),children:(0,Be.tZ)(dl.eh,{})}),(0,Be.tZ)(F.Z,{sx:{textAlign:"center",mt:1},variant:"h6",children:(0,Be.tZ)(r.X2,{characterKey:e,gender:t})}),(0,Be.tZ)(dl.tt,{})]})]})}function hl(){const e=(0,d.useRef)(),t=(0,d.useCallback)((()=>{var t;return null==e||null==(t=e.current)||null==t.scrollIntoView?void 0:t.scrollIntoView({behavior:"smooth"})}),[e]),n=(0,d.useContext)(m.R),i=jn(),a=(0,d.useMemo)((()=>Object.assign({},n,{oldData:i})),[n,i]);return(0,Be.BX)(fe.Z,{spacing:1,children:[(0,Be.tZ)(s.Z,{children:(0,Be.BX)(te.ZP,{container:!0,spacing:1,sx:{justifyContent:"center"},children:[(0,Be.tZ)(te.ZP,{item:!0,xs:8,sm:5,md:4,lg:2.3,children:(0,Be.tZ)(ul,{})}),(0,Be.BX)(te.ZP,{item:!0,xs:12,sm:7,md:8,lg:9.7,sx:{display:"flex",flexDirection:"column",gap:1},children:[(0,Be.tZ)(Zl,{onClick:t}),(0,Be.BX)(K.Z,{sx:{flexGrow:1,p:1,display:"flex",flexDirection:"column",gap:1},children:[(0,Be.tZ)(m.R.Provider,{value:a,children:(0,Be.tZ)(tl.Z,{})}),(0,Be.tZ)(s.Z,{sx:{display:"flex",justifyContent:"flex-end"},children:(0,Be.tZ)(Kn,{})})]})]})]})}),(0,Be.tZ)(s.Z,{ref:e,children:(0,Be.tZ)(rl,{})})]})}function Zl({onClick:e}){const{data:t}=(0,d.useContext)(m.R);return(0,Be.BX)(te.ZP,{container:!0,spacing:1,columns:{xs:2,sm:2,md:3,lg:6,xl:6},children:[(0,Be.tZ)(te.ZP,{item:!0,xs:1,children:(0,Be.tZ)(st.Z,{weaponId:t.get(Ze.ri.weapon.id).value,BGComponent:K.Z,onClick:e})}),a.Ex.map((n=>{var i;return(0,Be.tZ)(te.ZP,{item:!0,xs:1,children:(0,Be.tZ)(rt.Z,{artifactId:null==(i=t.get(Ze.ri.art[n].id).value)?void 0:i.toString(),slotKey:n,BGComponent:K.Z,onClick:e})},n)}))]})}function pl(){const{character:{key:e,constellation:t}}=(0,d.useContext)(p.K),{t:n}=(0,u.$G)("sheet_gen"),r=(0,l.Wz)();return(0,Be.tZ)(i.PS,{fullWidth:!0,title:n("constellationLvl",{level:t}),color:"primary",children:(0,z.w6)(0,a.o9).map((i=>(0,Be.tZ)(ne.Z,{selected:t===i,disabled:t===i,onClick:()=>r.chars.set(e,{constellation:i}),children:n("constellationLvl",{level:i})},i)))})}var ml=n(40637),fl=n(26437),gl=n(76260);const xl={xs:12,sm:6,md:4};function bl(){const{t:e}=(0,u.$G)("sheet_gen"),{character:t,characterSheet:n}=(0,d.useContext)(x.V),{data:i}=(0,d.useContext)(m.R),l=(0,gl.Z)(t.key),r=[["auto",e("talents.auto")],["skill",e("talents.skill")],["burst",e("talents.burst")]],o=[["passive1",e("unlockPassive1"),1],["passive2",e("unlockPassive2"),4],["passive3",e("unlockPassive3"),0]],c=i.get(Ze.ri.asc).value,h=i.get(Ze.ri.constellation).value,Z=(0,nl.Z)(),p=(0,il.Z)(Z.breakpoints.up("lg")),f=(0,d.useMemo)((()=>(0,C.w6)(1,a.o9).map((t=>(0,Be.tZ)(yl,{talentKey:`constellation${t}`,subtitle:e("constellationLvl",{level:t}),onClickTitle:()=>l({constellation:t===h?t-1:t})})))),[e,h,l]);return(0,Be.BX)(Be.HY,{children:[(0,Be.tZ)(vl,{}),(0,Be.BX)(te.ZP,{container:!0,spacing:1,children:[p&&(0,Be.BX)(te.ZP,{item:!0,xs:12,md:12,lg:3,sx:{display:"flex",flexDirection:"column",gap:1},children:[(0,Be.tZ)(pl,{}),f.map(((e,t)=>(0,Be.tZ)(s.Z,{sx:{opacity:h>=t+1?1:.5},children:e},t)))]}),(0,Be.BX)(te.ZP,{item:!0,xs:12,md:12,lg:9,container:!0,spacing:1,children:[r.map((([e,t])=>(0,Be.tZ)(te.ZP,Object.assign({item:!0},xl,{children:(0,Be.tZ)(yl,{talentKey:e,subtitle:t})}),e))),!!n.getTalentOfKey("sprint")&&(0,Be.tZ)(te.ZP,Object.assign({item:!0},xl,{children:(0,Be.tZ)(yl,{talentKey:"sprint",subtitle:e("talents.altSprint")})})),!!n.getTalentOfKey("passive")&&(0,Be.tZ)(te.ZP,Object.assign({item:!0},xl,{children:(0,Be.tZ)(yl,{talentKey:"passive",subtitle:"Passive"})})),o.map((([e,t,i])=>{const a=c>=i;return n.getTalentOfKey(e)?(0,Be.tZ)(te.ZP,Object.assign({item:!0,style:{opacity:a?1:.5}},xl,{children:(0,Be.tZ)(yl,{talentKey:e,subtitle:t})}),e):null}))]}),!p&&(0,Be.BX)(te.ZP,{item:!0,xs:12,md:12,lg:3,container:!0,spacing:1,children:[(0,Be.tZ)(te.ZP,{item:!0,xs:12,children:(0,Be.tZ)(pl,{})}),f.map(((e,t)=>(0,Be.tZ)(te.ZP,Object.assign({item:!0,sx:{opacity:h>=t+1?1:.5}},xl,{children:e}),t)))]})]})]})}function vl(){const{data:e}=(0,d.useContext)(m.R),t=e.getDisplay().reaction;return(0,Be.tZ)(K.Z,{children:(0,Be.tZ)(c.Z,{children:(0,Be.tZ)(te.ZP,{container:!0,spacing:1,children:Object.entries(t).filter((([e,t])=>!t.isEmpty)).map((([e,t])=>(0,Be.tZ)(te.ZP,{item:!0,children:(0,Be.tZ)(re.Z,{children:(0,Be.tZ)(c.Z,{sx:{p:1,"&:last-child":{pb:1}},children:(0,Be.tZ)(we.JW,{node:t})})})},e)))})})})}function yl({talentKey:e,subtitle:t,onClickTitle:n}){const{character:{talent:i},characterSheet:a}=(0,d.useContext)(p.K),l=(0,d.useCallback)((e=>(0,Be.tZ)(at.Z,{onClick:n,children:e})),[n]);let r=null;e in i&&(r=(0,Be.tZ)(ml.Z,{talentKey:e,dropDownButtonProps:{sx:{borderRadius:0}}}));const o=a.getTalentOfKey(e);return(0,Be.BX)(K.Z,{sx:{height:"100%"},children:[r,(0,Be.BX)(c.Z,{children:[(0,Be.tZ)(fl.Z,{condition:!!n,wrapper:l,children:(0,Be.BX)(te.ZP,{container:!0,sx:{flexWrap:"nowrap"},children:[(0,Be.tZ)(te.ZP,{item:!0,children:(0,Be.tZ)(s.Z,{component:"img",src:null==o?void 0:o.img,sx:{width:60,height:"auto"}})}),(0,Be.BX)(te.ZP,{item:!0,flexGrow:1,sx:{pl:1},children:[(0,Be.tZ)(F.Z,{variant:"h6",children:null==o?void 0:o.name}),(0,Be.tZ)(F.Z,{variant:"subtitle1",children:t})]})]})}),null!=o&&o.sections?(0,Be.tZ)(ii.Z,{sections:o.sections,hideDesc:!0,hideHeader:t=>{var n;const i=null==(n=t.header)?void 0:n.action;if(i&&"string"!=typeof i){return i.props.children.props.key18.includes(e)}return!1}}):null]})]})}var Cl=n(51784);function wl({weapon:e}){const t=(null==e?void 0:e.key)&&(0,mt.ub)(e.key),n=(0,d.useMemo)((()=>t&&e&&(0,gn.mP)([t.data,(0,gn.v0)(e)])),[t,e]);return e&&t&&n?(0,Be.tZ)(re.Z,{children:(0,Be.BX)(s.Z,{display:"flex",children:[(0,Be.tZ)(s.Z,{flexShrink:1,maxWidth:"35%",display:"flex",flexDirection:"column",alignContent:"flex-end",className:`grad-${t.rarity}star`,children:(0,Be.tZ)(s.Z,{component:"img",src:(0,ut.Aq)(e.key,e.ascension>=2),width:"100%",height:"auto",sx:{mt:"auto"}})}),(0,Be.BX)(s.Z,{flexGrow:1,sx:{p:1},children:[(0,Be.tZ)(F.Z,{variant:"body2",gutterBottom:!0,children:(0,Be.tZ)("strong",{children:null==t?void 0:t.name})}),(0,Be.BX)(F.Z,{variant:"subtitle1",sx:{display:"flex",gap:1},gutterBottom:!0,children:[(0,Be.BX)(A.Z,{color:"primary",children:["Lv. ",Cl.Z.getLevelString(e)]}),t.hasRefinement&&(0,Be.BX)(A.Z,{color:"info",children:["R",e.refinement]})]}),(0,Be.BX)(F.Z,{variant:"subtitle1",sx:{display:"flex",gap:1},children:[(0,Be.tZ)(Bl,{node:n.get(Ze.ri.weapon.main)}),(0,Be.tZ)(Bl,{node:n.get(Ze.ri.weapon.sub)})]})]})]})}):null}function Bl({node:e}){return Number.isNaN(e.value)?null:(0,Be.BX)(A.Z,{color:"secondary",children:[e.info.icon," ",(0,pe.p)(e)]})}var kl=n(58606);let Sl,Xl=e=>e;function Tl(){const{team:{teamCharIds:e},teamCharId:t}=(0,d.useContext)(x.V);return(0,Be.tZ)(s.Z,{display:"flex",flexDirection:"column",gap:1,alignItems:"stretch",children:(0,Be.BX)(te.ZP,{container:!0,spacing:1,children:[(0,Be.BX)(te.ZP,{item:!0,xs:12,md:6,lg:3,sx:{display:"flex",flexDirection:"column",gap:1},children:[(0,Be.tZ)(Ol,{}),(0,Be.tZ)(Il,{})]}),e.filter((e=>e&&e!==t)).map((e=>(0,Be.tZ)(te.ZP,{item:!0,xs:12,md:6,lg:3,children:(0,Be.tZ)(El,{teamCharId:e})},e)))]})})}function Ol(){var e,t,n;const{data:i,oldData:a}=(0,d.useContext)(m.R),l=i.getTeamBuff(),r=[];return Object.entries(null!=(e=l.total)?e:{}).forEach((([e,t])=>!t.isEmpty&&0!==t.value&&r.push([["total",e],t]))),Object.entries(null!=(t=l.premod)?t:{}).forEach((([e,t])=>!t.isEmpty&&0!==t.value&&r.push([["premod",e],t]))),Object.entries(null!=(n=l.enemy)?n:{}).forEach((([e,t])=>!t.isEmpty&&"number"==typeof t.value&&0!==t.value&&r.push([["enemy",e],t]))),r.length?(0,Be.BX)(K.Z,{children:[(0,Be.tZ)(c.Z,{children:(0,Be.tZ)(F.Z,{children:"Team Buffs"})}),(0,Be.tZ)(ge.Z,{}),(0,Be.tZ)(c.Z,{children:(0,Be.tZ)(te.ZP,{container:!0,children:r.map((([e,t])=>{var n;return t&&(0,Be.tZ)(te.ZP,{item:!0,xs:12,children:(0,Be.tZ)(we.JW,{node:t,oldValue:null==(n=(0,C.Hm)(null==a?void 0:a.getTeamBuff(),e))?void 0:n.value})},JSON.stringify(t.info))}))})})]}):null}function Il(){const{t:e}=(0,u.$G)("page_character"),{data:t}=(0,d.useContext)(m.R),{team:{teamCharIds:n}}=(0,d.useContext)(x.V),i=n.reduce(((e,t)=>e+(t?1:0)),0);return(0,Be.BX)(Be.HY,{children:[(0,Be.tZ)(K.Z,{children:(0,Be.tZ)(ye.Z,{title:(0,Be.BX)("span",{children:[e("tabTeambuff.team_reso")," ",(0,Be.tZ)("strong",{children:(0,Be.BX)(se.Z,{color:i>=4?"success":"warning",children:["(",i,"/4)"]})})," ",(0,Be.tZ)(de.L,{title:(0,Be.tZ)(F.Z,{children:e(Sl||(Sl=Xl`tabTeambuff.resonance_tip`))})})]}),titleTypographyProps:{variant:"subtitle2"}})}),kl.J.map(((e,n)=>(0,Be.BX)(K.Z,{sx:{opacity:e.canShow(t)?1:.5},children:[(0,Be.tZ)(ye.Z,{title:(0,Be.BX)("span",{children:[e.name," ",(0,Be.tZ)(de.L,{title:(0,Be.tZ)(F.Z,{children:e.desc})})]}),action:e.icon,titleTypographyProps:{variant:"subtitle2"}}),e.canShow(t)&&(0,Be.tZ)(ge.Z,{}),e.canShow(t)&&(0,Be.tZ)(c.Z,{children:(0,Be.tZ)(ii.Z,{sections:e.sections,teamBuffOnly:!0,hideDesc:!0})})]},n)))]})}function El({teamCharId:e}){var t;const{teamData:n}=(0,d.useContext)(m.R),a=(0,h.s0)(),{teamId:r,team:c}=(0,d.useContext)(x.V),u=(0,l.rX)(e),Z=null==u?void 0:u.key,f=(0,l.AU)(Z),{key:g}=f,{params:{tab:b=""}}=null!=(t=(0,h.bS)({path:"/teams/:teamId/:characterKey/:tab",end:!1}))?t:{params:{tab:""}},v=n[Z],y=(0,d.useMemo)((()=>v&&{teamId:r,team:c,teamCharId:e,teamChar:u,character:f,characterSheet:v.characterSheet}),[r,c,e,u,f,v]),C=(0,d.useMemo)((()=>v&&{character:f,characterSheet:v.characterSheet}),[f,v]),w=(0,d.useMemo)((()=>v&&{data:v.target,teamData:n}),[v,n]);return(0,Be.tZ)(K.Z,{sx:{overflow:"visible"},children:Z&&y&&(0,Be.tZ)(x.V.Provider,{value:y,children:w&&(0,Be.tZ)(m.R.Provider,{value:w,children:C&&(0,Be.tZ)(p.K.Provider,{value:C,children:(0,Be.tZ)(d.Suspense,{fallback:(0,Be.tZ)(o.Z,{variant:"rectangular",width:"100%",height:600}),children:(0,Be.BX)(i.s8,{bgt:"light",children:[(0,Be.tZ)(hn.ql,{characterKey:g,onClick:()=>a(`/teams/${r}/${g}/${b}`),children:(0,Be.tZ)(hn.uh,{characterKey:g})}),(0,Be.BX)(s.Z,{sx:{p:1,width:"100%",display:"flex",flexDirection:"column",gap:1,flexGrow:1},children:[(0,Be.tZ)(jl,{}),(0,Be.tZ)(Kl,{}),(0,Be.tZ)(Ml,{}),(0,Be.tZ)(Dl,{}),(0,Be.tZ)(Al,{})]})]})})})})})})}function jl(){const{teamChar:{buildType:e}}=(0,d.useContext)(x.V);return"tc"!==e?(0,Be.tZ)(un.S,{hideWeapon:!0}):(0,Be.tZ)(Pl,{})}function Pl(){const{teamChar:{buildTcId:e}}=(0,d.useContext)(x.V),{artifact:{sets:t}}=(0,l.dN)(e);return(0,Be.tZ)(i.s8,{sx:{flexGrow:1},children:(0,Be.BX)(s.Z,{sx:{p:1,display:"flex",flexDirection:"column",gap:1},children:[(0,Be.tZ)(i.dL,{color:"info",children:"TC Loadout"}),Object.entries(t).map((([e,t])=>(0,Be.BX)(s.Z,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,Be.tZ)(xe.Z,{size:2,src:(0,ut.Hp)(e,"flower")}),(0,Be.tZ)("span",{children:(0,Be.tZ)(r.C3,{setKey:e})}),(0,Be.BX)(i.dL,{children:["x",t]})]},e)))]})})}function Ml(){const{data:e}=(0,d.useContext)(m.R),{teamCharId:t}=(0,d.useContext)(x.V),n=(0,l.Wz)(),i=(0,d.useMemo)((()=>{var i,a;const l=null!=(i=null==(a=e.get(Ze.qH.weapon.id).value)?void 0:a.toString())?i:"";return l?n.weapons.get(l):n.teamChars.getLoadoutWeapon(t)}),[n,e,t]);return(0,Be.tZ)(wl,{weapon:i})}function Kl(){const{data:e}=(0,d.useContext)(m.R),t=(0,d.useMemo)((()=>Object.entries((0,ni.ND)(e)).flatMap((([e,t])=>t.flatMap((t=>{var n;return null!=(n=(0,ni.Sk)(e).setEffectDocument(t))?n:[]}))))),[e]);return t?(0,Be.tZ)(ii.Z,{sections:t,teamBuffOnly:!0}):null}function Dl(){const{character:{key:e}}=(0,d.useContext)(x.V),{teamData:t}=(0,d.useContext)(m.R),n=t[e].weaponSheet;return n.document?(0,Be.tZ)(ii.Z,{sections:n.document,teamBuffOnly:!0}):null}function Al(){const{character:{key:e}}=(0,d.useContext)(x.V),{teamData:t}=(0,d.useContext)(m.R),n=t[e].characterSheet,i=Object.values(n.talent).flatMap((e=>e.sections));return i?(0,Be.tZ)(ii.Z,{sections:i,teamBuffOnly:!0}):null}var zl=n(83517),_l=n(92679),Ll=n(6480),Rl=n(4311),Wl=n(69614);const Nl=(0,d.createContext)({});function Gl({slotKey:e,disabled:t=!1}){var n;const{buildTc:{artifact:{slots:i}},setBuildTc:l}=(0,d.useContext)(Nl),{level:r,statKey:o,rarity:c}=i[e],u=a.yh[e],h=(0,d.useCallback)((t=>{l((n=>{const i=n.artifact.slots[e];n.artifact.slots[e]=Object.assign({},i,t)}))}),[l,e]),Z=(0,d.useCallback)((e=>{var t;const n=null!=(t=a.F7[e])?t:0;h(r>n?{rarity:e,level:n}:{rarity:e})}),[r,h]);return(0,Be.BX)(s.Z,{display:"flex",gap:1,justifyContent:"space-between",alignItems:"center",children:[(0,Be.tZ)(zn.Z,{slotKey:e}),(0,Be.tZ)(re.Z,{sx:{height:"100%",minWidth:"5em",flexGrow:1,display:"flex"},children:1===u.length?(0,Be.BX)(s.Z,{p:1,justifyContent:"center",alignItems:"center",width:"100%",display:"flex",gap:1,children:[(0,Be.tZ)(Ot.C,{statKey:u[0],iconProps:Bt.mX})," ",yt.d4.getStr(u[0])]}):(0,Be.tZ)(ce.Z,{sx:{px:0},fullWidth:!0,title:(0,Be.tZ)(pt.x,{statKey:o}),color:null!=(n=yt.d4.getVariant(o))?n:"success",disabled:t,children:u.map((e=>(0,Be.tZ)(ne.Z,{disabled:o===e,onClick:()=>h({statKey:e}),children:(0,Be.tZ)(pt._,{statKey:e})},e)))})}),(0,Be.tZ)(ce.Z,{sx:{px:0},title:(0,Be.BX)(s.Z,{sx:{display:"flex",alignItems:"center"},children:[c," ",(0,Be.tZ)(ti.Z,{fontSize:"inherit"})]}),disabled:t,children:[5,4,3].map((e=>(0,Be.tZ)(ne.Z,{disabled:c===e,onClick:()=>Z(e),children:(0,Be.BX)(s.Z,{sx:{display:"flex",alignItems:"center"},children:[e," ",(0,Be.tZ)(ti.Z,{fontSize:"inherit"})]})},e)))}),(0,Be.tZ)(oe.ZP,{startAdornment:"+",value:r,color:Wl.Z.levelVariant(r),onChange:e=>void 0!==e&&h({level:e}),sx:{borderRadius:1,pl:1,my:0,height:"100%"},inputProps:{sx:{pl:.5,width:"2em"},max:20,min:0},disabled:t}),(0,Be.tZ)(re.Z,{sx:{height:"100%",minWidth:"4em"},children:(0,Be.tZ)(s.Z,{p:1,textAlign:"center",children:`${(0,Zt.Jj)((0,Zt.Bv)(o,c,r),yt.d4.unit(o))}${yt.d4.unit(o)}`})})]})}var Vl=n(47712),$l=n(54675),Fl=n(5051);function ql(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}function Hl({setKey:e,remaining:t,disabled:n=!1}){const{buildTc:{artifact:{sets:i}},setBuildTc:a}=(0,d.useContext)(Nl),l=i[e],r=(0,d.useCallback)((t=>{a((n=>{n.artifact.sets[e]=t}))}),[a,e]),o=(0,d.useCallback)((()=>{a((t=>{const n=t.artifact.sets,i=(0,It.Z)(n,[e].map(ql));t.artifact.sets=i}))}),[a,e]),c=(0,ni.Sk)(e),u=(0,d.useMemo)((()=>l<4?[]:Object.keys(c.setEffects).filter((e=>{var t;return null==(t=c.setEffects[e])?void 0:t.document.some((e=>"states"in e))}))),[c,l]);return(0,Be.BX)(K.Z,{children:[(0,Be.BX)(s.Z,{display:"flex",children:[(0,Be.tZ)(Fl.Z,{artifactSheet:c,numInSet:l,children:(0,Be.BX)(s.Z,{flexGrow:1,p:1,display:"flex",gap:1,alignItems:"center",children:[(0,Be.tZ)(xe.Z,{size:2,src:(0,ri.jU)(e)}),(0,Be.tZ)(s.Z,{children:c.setName}),(0,Be.tZ)(nt.Z,Object.assign({},Bt.mX))]})}),(0,Be.BX)(Y.Z,{children:[(0,Be.tZ)(ce.Z,{size:"small",title:(0,Be.BX)(s.Z,{whiteSpace:"nowrap",children:[l,"-set"]}),disabled:n,children:Object.keys(c.setEffects).map((e=>parseInt(e))).map((e=>(0,Be.BX)(ne.Z,{disabled:l===e||e>t+l,onClick:()=>r(e),children:[e,"-set"]},e)))}),(0,Be.tZ)(P.Z,{color:"error",size:"small",onClick:o,disabled:n,children:(0,Be.tZ)($l.Z,{})})]})]}),!!u.length&&(0,Be.tZ)(fe.Z,{spacing:1,sx:{p:1},children:u.map((t=>(0,Be.tZ)(ai,{setKey:e,setNumKey:parseInt(t),hideHeader:!0,conditionalsOnly:!0,disabled:n},t)))})]})}function Ul({disabled:e=!1}){const{buildTc:{artifact:{sets:t}},setBuildTc:n}=(0,d.useContext)(Nl),i=(0,d.useCallback)((e=>{e&&n((t=>{t.artifact.sets[e]=parseInt(Object.keys((0,ni.Sk)(e).setEffects)[0])}))}),[n]),a=5-Object.values(t).reduce(((e,t)=>e+t),0);return(0,Be.BX)(fe.Z,{spacing:1,sx:{flexGrow:1},children:[Object.keys(t).map((t=>(0,Be.tZ)(Hl,{setKey:t,remaining:a,disabled:e},t))),(0,Be.tZ)(K.Z,{sx:{flexGrow:1,overflow:"visible"},children:(0,Be.tZ)(Vl.Z,{artSetKey:"",setArtSetKey:i,label:"New Artifact Set",getOptionDisabled:({key:e})=>Object.keys(t).includes(e)||!e||Object.keys((0,ni.Sk)(e).setEffects).every((e=>parseInt(e)>a)),disabled:e})})]})}function Yl({disabled:e=!1}){return(0,Be.BX)(fe.Z,{spacing:1,children:[(0,Be.tZ)(K.Z,{sx:{p:1},children:(0,Be.tZ)(fe.Z,{spacing:1,children:a.Ex.map((t=>(0,Be.tZ)(Gl,{slotKey:t,disabled:e},t)))})}),(0,Be.tZ)(d.Suspense,{fallback:(0,Be.tZ)(o.Z,{variant:"rectangular",width:"100%",height:200}),children:(0,Be.tZ)(Ul,{disabled:e})})]})}var Jl=n(8660);let Ql,er,tr=e=>e;function nr(e){const{artifact:{substats:{stats:t,rarity:n,type:i}}}=e;return Math.floor(Math.min(...Object.entries(t).map((([e,t])=>t/(0,Zt.U9)(e,n,i)))))}function ir(e){return Math.floor(Math.min(...Object.values(e.optimization.maxSubstats)))}function ar({disabled:e=!1}){const{t}=(0,u.$G)("page_character"),{buildTc:n,setBuildTc:l}=(0,d.useContext)(Nl),[r,o]=(0,d.useState)((()=>[nr(n)])),[c,h]=(0,d.useState)((()=>[ir(n)])),[Z]=r,[p]=c,m=(0,d.useDeferredValue)(r),f=(0,i.z9)();(0,d.useEffect)((()=>{f||l((e=>{const{artifact:{substats:{stats:t,type:n,rarity:i}}}=e;e.artifact.substats.stats=(0,z.vU)(t,((t,a)=>{const l=t,r=(0,Zt.U9)(a,i,n),s=r*m[0],o=Math.round(l/r-m[0]);return e.optimization.distributedSubstats=(0,z.re)(e.optimization.distributedSubstats+o,0,45),s}))}))}),[m]);const g=(0,d.useDeferredValue)(c);(0,d.useEffect)((()=>{f||l((e=>{e.optimization.maxSubstats=(0,z.vU)(e.optimization.maxSubstats,((e,t)=>g[0]))}))}),[g]);const x=5*(a.i0[n.artifact.substats.rarity].numUpgrades+1),b=(null!=Z?Z:-1e-4)>x;return(0,Be.BX)(s.Z,{display:"flex",gap:1,justifyContent:"space-between",alignItems:"center",children:[(0,Be.tZ)(re.Z,{sx:{px:2,flexGrow:1,display:"flex",gap:1,alignItems:"center",justifyContent:"center",overflow:"visible"},children:(0,Be.tZ)(zi.ZP,{size:"small",value:null!=Z?Z:0,max:x,min:0,step:1,marks:!0,valueLabelDisplay:"auto",onChange:(e,t)=>o([t]),onChangeCommitted:(e,t)=>o([t]),disabled:e})}),(0,Be.tZ)(oe.ZP,{color:Z&&b?"warning":"primary",float:!0,startAdornment:(0,Be.tZ)(s.Z,{sx:{whiteSpace:"nowrap"},children:t(Ql||(Ql=tr`tabTheorycraft.all.rolls`))}),value:parseFloat((null!=Z?Z:0).toFixed(2)),onChange:e=>void 0!==e&&o([e]),sx:{borderRadius:1,px:1,my:0,height:"100%",width:"7em"},inputProps:{sx:{textAlign:"right",pr:.5},min:0,step:1},disabled:e}),(0,Be.tZ)(oe.ZP,{value:null!=p?p:0,startAdornment:(0,Be.tZ)(s.Z,{sx:{whiteSpace:"nowrap"},children:t(er||(er=tr`tabTheorycraft.all.max`))}),onChange:e=>void 0!==e&&h([e]),color:(null!=p?p:0)>x?"warning":"primary",sx:{borderRadius:1,px:1,my:0,height:"100%",width:"6.5em"},inputProps:{sx:{textAlign:"right",pr:.5},min:0,step:1},disabled:e})]})}let lr,rr=e=>e;function sr({statKey:e,disabled:t=!1}){const{t:n}=(0,u.$G)("page_character"),{buildTc:{artifact:{slots:l,substats:{type:r,stats:o,rarity:c}},optimization:{maxSubstats:h}},setBuildTc:Z}=(0,d.useContext)(Nl),p=Object.values(l).map((e=>e.statKey)),m=o[e],f=(0,d.useCallback)((t=>{Z((n=>{const i=n.artifact.substats.stats[e];n.artifact.substats.stats[e]=t;const a=Math.round((i-t)/(0,Zt.U9)(e,n.artifact.substats.rarity,n.artifact.substats.type));n.optimization.distributedSubstats=(0,z.re)(n.optimization.distributedSubstats+a,0,45)}))}),[Z,e]),g=h[e],x=(0,d.useCallback)((t=>{Z((n=>{n.optimization.maxSubstats[e]=t}))}),[Z,e]),b=(0,Zt.U9)(e,c,r),[v,y]=(0,d.useState)((()=>m/b));(0,d.useEffect)((()=>y(m/b)),[m,b]);const C=yt.d4.unit(e),w=v*b,B=v*b/(0,Zt.U9)(e)*100,k=p.reduce(((t,n)=>t+(n===e?1:0)),0),S=(5-k)*(a.F7[c]/4+1),X=v-1e-4>S,T=(0,d.useCallback)((e=>f(e*b)),[f,b]);return(0,Be.BX)(fe.Z,{spacing:.5,children:[(0,Be.BX)(s.Z,{display:"flex",gap:1,justifyContent:"space-between",alignItems:"center",children:[(0,Be.tZ)(oe.ZP,{color:w?"success":"primary",float:"%"===yt.d4.unit(e),endAdornment:yt.d4.unit(e)||(0,Be.tZ)(s.Z,{width:"1em",component:"span"}),value:parseFloat(w.toFixed(2)),onChange:e=>void 0!==e&&f(e),sx:{borderRadius:1,px:1,height:"100%",width:"5em"},inputProps:{sx:{textAlign:"right"},min:0},disabled:t}),(0,Be.BX)(i.s8,{sx:{p:.5,minWidth:"11em",flexGrow:1,display:"flex",gap:1,alignItems:"center",justifyContent:"center"},children:[(0,Be.tZ)(Ot.C,{statKey:e,iconProps:{fontSize:"inherit"}}),yt.d4.getStr(e),yt.d4.unit(e)]}),(0,Be.tZ)(oe.ZP,{color:m?X?"warning":"success":"primary",float:!0,startAdornment:(0,Be.BX)(s.Z,{sx:{whiteSpace:"nowrap",width:"6em",display:"flex",justifyContent:"space-between"},children:[(0,Be.BX)("span",{children:[(0,Zt.Jj)(b,C),C]}),(0,Be.tZ)("span",{children:"x"})]}),value:parseFloat(v.toFixed(2)),onChange:e=>void 0!==e&&f(e*b),sx:{borderRadius:1,px:1,my:0,height:"100%",width:"6.5em"},inputProps:{sx:{textAlign:"right",pr:.5},min:0,step:1},disabled:t}),(0,Be.tZ)(i.s8,{sx:{textAlign:"center",p:.5,minWidth:"6em"},children:(0,Be.BX)(i._w,{color:X?"warning":void 0,children:["RV: ",(0,Be.BX)("strong",{children:[B.toFixed(),"%"]}),(0,Be.tZ)(i.eN,{title:(0,Be.tZ)(F.Z,{children:n(k?"tabTheorycraft.maxRollsMain":"tabTheorycraft.maxRolls",{value:S})}),placement:"top",children:(0,Be.tZ)(nt.Z,{fontSize:"inherit",sx:{verticalAlign:"-10%"}})})]})})]}),(0,Be.BX)(s.Z,{display:"flex",gap:1,justifyContent:"space-between",alignItems:"center",children:[(0,Be.tZ)(i.s8,{sx:{px:2,flexGrow:1,display:"flex",gap:1,alignItems:"center",justifyContent:"center",overflow:"visible"},children:(0,Be.tZ)(zi.ZP,{size:"small",value:v,max:Math.min(S,g),min:0,step:1,marks:!0,valueLabelDisplay:"auto",onChange:(e,t)=>y(t),onChangeCommitted:(e,t)=>T(t),disabled:t})}),(0,Be.tZ)(oe.ZP,{value:g,startAdornment:n(lr||(lr=rr`tabTheorycraft.substat.max`)),onChange:e=>void 0!==e&&x(e),color:v-1e-4>g?"error":g>S?"warning":"success",sx:{borderRadius:1,px:1,my:0,height:"100%",width:"6em"},inputProps:{sx:{textAlign:"right",pr:.5},min:0,step:1},disabled:t})]})]})}function or({maxTotalRolls:e,disabled:t=!1}){const{t:n}=(0,u.$G)("page_character"),{buildTc:{artifact:{substats:{type:l,stats:r,rarity:o}}},setBuildTc:c}=(0,d.useContext)(Nl),h=(0,d.useCallback)((e=>{c((t=>{t.artifact.substats.type=e}))}),[c]),Z=(0,d.useCallback)((e=>{c((t=>{t.artifact.substats.rarity=e}))}),[c]),p=100*Object.entries(r).reduce(((e,[t,n])=>e+n/(0,Zt.U9)(t)),0),m=Object.entries(r).reduce(((e,[t,n])=>e+n/(0,Zt.U9)(t,o,l)),0),{high:f,numUpgrades:g}=a.i0[o],x=5*(f+g);return(0,Be.tZ)(i.s8,{bgt:"light",sx:{p:1,height:"100%"},children:(0,Be.BX)(fe.Z,{spacing:1,children:[(0,Be.BX)(s.Z,{sx:{display:"flex",gap:1},children:[(0,Be.tZ)(i.PS,{sx:{flexGrow:1},title:n(`tabTheorycraft.substatType.${l}`),disabled:t,children:a.Ar.map((e=>(0,Be.tZ)(ne.Z,{disabled:l===e,onClick:()=>h(e),children:n(`tabTheorycraft.substatType.${e}`)},e)))}),(0,Be.tZ)(Jl.Z,{rarity:o,onChange:e=>Z(e),filter:e=>e!==o,disabled:t}),(0,Be.tZ)(i.eN,{title:(0,Be.tZ)(F.Z,{children:(0,Be.BX)(u.cC,{t:n,i18nKey:"tabTheorycraft.maxTotalRolls",children:["The current build can only have a maximum of ",(0,Be.tZ)("strong",{children:{value:e}})," rolls."]})}),placement:"top",children:(0,Be.BX)(i.s8,{sx:{textAlign:"center",py:.5,px:1,whiteSpace:"nowrap",display:"flex",gap:2,justifyContent:"flex-end",alignItems:"center",flexShrink:1},children:[(0,Be.BX)(i._w,{color:m>x?"error":void 0,children:["Rolls: ",(0,Be.tZ)("strong",{children:m.toFixed(0)})]}),(0,Be.BX)(i._w,{color:m>x?"error":void 0,children:["RV: ",(0,Be.BX)("strong",{children:[p.toFixed(),"%"]})]})]})})]}),(0,Be.tZ)(ar,{disabled:t}),Object.entries(r).map((([e])=>(0,Be.tZ)(sr,{statKey:e,disabled:t},e)))]})})}var cr=n(83993),dr=n(82056);let ur,hr,Zr=e=>e;function pr({disabled:e}){const{t}=(0,u.$G)("page_character"),{buildTc:{optimization:{minTotal:n}},setBuildTc:a}=(0,d.useContext)(Nl);return(0,Be.BX)(i.s8,{bgt:"light",children:[(0,Be.tZ)(ye.Z,{titleTypographyProps:{variant:"body1",sx:{fontWeight:"bold"}},title:t(ur||(ur=Zr`tabTheorycraft.constraint.title`))}),(0,Be.tZ)(ge.Z,{}),(0,Be.tZ)(s.Z,{sx:{p:1},children:(0,Be.BX)(fe.Z,{spacing:1,children:[Object.entries(n).map((([t,n])=>(0,Be.tZ)(mr,{statKey:t,value:n,disabled:e},t))),(0,Be.tZ)(i.PS,{disabled:e,title:t(hr||(hr=Zr`tabTheorycraft.constraint.add`)),children:_.t1.map((e=>(0,Be.BX)(ne.Z,{disabled:Object.keys(n).includes(e),onClick:()=>a((t=>{t.optimization.minTotal[e]=0})),children:[(0,Be.tZ)(cr.Z,{children:(0,Be.tZ)(ht.ej,{statKey:e})}),(0,Be.tZ)(dr.Z,{children:(0,Be.tZ)(Ll.w0,{statKey:e})})]},e)))})]})})]})}function mr({statKey:e,value:t,disabled:n}){const{setBuildTc:a}=(0,d.useContext)(Nl),l=(0,z.bf)(e)||" ";return(0,Be.BX)(Y.Z,{size:"small",children:[(0,Be.tZ)(i.CC,{sx:{flexBasis:30,flexGrow:1},children:(0,Be.tZ)(i.aJ,{float:"%"===l,value:e?t:void 0,onChange:t=>e&&a((n=>{n.optimization.minTotal[e]=t})),endAdornment:(0,Be.tZ)(s.Z,{width:"1em",component:"span",children:l}),startAdornment:(0,Be.BX)(s.Z,{component:"span",sx:{whiteSpace:"nowrap"},children:[(0,Be.tZ)(ht.ej,{statKey:e,iconProps:{fontSize:"inherit",sx:{verticalAlign:"-10%",mr:1}}}),(0,Be.tZ)(Ll.w0,{statKey:e})]}),disabled:!e||n,sx:{px:1},inputProps:{sx:{textAlign:"right"}}})}),!!e&&(0,Be.tZ)(P.Z,{color:"error",disabled:n,size:"small",onClick:()=>a((t=>{delete t.optimization.minTotal[e]})),children:(0,Be.tZ)($l.Z,{})})]})}var fr=n(13091),gr=n(35936),xr=n(6060),br=n(15694),vr=n(5971);const yr=n.p+"gcsim.5cadfd805391f327.png",Cr={def_:"def%",def:"def",hp:"hp",hp_:"hp%",atk:"atk",atk_:"atk%",enerRech_:"er",eleMas:"em",critRate_:"cr",critDMG_:"cd",heal_:"heal",pyro_dmg_:"pyro%",hydro_dmg_:"hydro%",cryo_dmg_:"cryo%",electro_dmg_:"electro%",anemo_dmg_:"anemo%",geo_dmg_:"geo%",dendro_dmg_:"dendro%",physical_dmg_:"phys%"};function wr({disabled:e}){const{t}=(0,u.$G)(["page_character","settings"]),[n,a,l]=(0,w.aV)(),{character:{key:r,level:s,ascension:o,constellation:h,talent:{auto:Z,skill:p,burst:m}}}=(0,d.useContext)(x.V),{buildTc:{weapon:{key:f,level:g,ascension:b,refinement:v},artifact:{slots:y,substats:{stats:C},sets:B}}}=(0,d.useContext)(Nl),k=r.toLowerCase(),S=Object.entries(B).map((([e,t])=>`${k} add set="${e.toLowerCase()}" count=${t};`)).join("\n"),X=Object.entries(y).map((([e,{level:t,statKey:n,rarity:i}])=>`${Cr[n]}=${(0,Zt.Fx)(n,i,t)}`)).join(" "),T=Object.entries(C).map((([e,t])=>`${Cr[e]}=${(0,z.YM)(t,e).toFixed(e.endsWith("_")?4:2)}`)).join(" "),O=`# Generated by Genshin Optimizer\n\n# Character\n${k} char lvl=${s}/${Zt.SJ[o]} cons=${h} talent=${Z},${p},${m};\n\n# Weapon\n${k} add weapon="${f.toLowerCase()}" refine=${v} lvl=${g}/${Zt.SJ[b]};\n\n# Artifact Set\n${S||"# No Artifact Sets"}\n\n# Main stats\n${k} add stats ${X};\n\n# Sub stats\n${k} add stats ${T};`;return(0,Be.BX)(Be.HY,{children:[(0,Be.tZ)(P.Z,{onClick:a,startIcon:(0,Be.tZ)(xe.Z,{src:yr}),disabled:e,children:t("tabTheorycraft.gcsimDialog.title")}),(0,Be.BX)(fr.Z,{open:n,onClose:l,maxWidth:"lg",children:[(0,Be.tZ)(gr.Z,{children:t("tabTheorycraft.gcsimDialog.title")}),(0,Be.BX)(xr.Z,{children:[(0,Be.tZ)(br.Z,{children:(0,Be.BX)(u.cC,{t,i18nKey:"tabTheorycraft.gcsimDialog.content",children:["Import this build into"," ",(0,Be.tZ)(pn.Z,{href:"https://gcsim.app/",target:"_blank",children:"gcsim"})," ","by copying the code below."]})}),(0,Be.tZ)(i.s8,{children:(0,Be.tZ)(c.Z,{children:(0,Be.tZ)(i.dn,{text:O})})})]}),(0,Be.tZ)(vr.Z,{children:(0,Be.tZ)(P.Z,{fullWidth:!0,color:"info",onClick:()=>navigator.clipboard.writeText(O).then((()=>alert(t("tabTheorycraft.gcsimDialog.copied")))).catch(console.error),startIcon:(0,Be.tZ)(W.Z,{}),children:(0,Be.tZ)(u.cC,{t,i18nKey:"settings:DatabaseCard.button.copy"})})})]})]})}const Br=n.p+"kqm.539212b66c730fa6.png";function kr({action:e,disabled:t}){const{t:n}=(0,u.$G)(["page_character","ui"]),[i,a,l]=(0,w.aV)();return(0,Be.BX)(Be.HY,{children:[(0,Be.tZ)(P.Z,{color:"keqing",onClick:a,startIcon:(0,Be.tZ)(xe.Z,{src:Br}),disabled:t,children:n("tabTheorycraft.kqmsDialog.kqmsBtn")}),(0,Be.BX)(fr.Z,{open:i,onClose:l,children:[(0,Be.tZ)(gr.Z,{children:n("tabTheorycraft.kqmsDialog.title")}),(0,Be.tZ)(xr.Z,{children:(0,Be.tZ)(br.Z,{children:(0,Be.BX)(u.cC,{t:n,i18nKey:"tabTheorycraft.kqmsDialog.content",children:["This will replace your current ",(0,Be.tZ)("strong",{children:"substat setup"})," with one that adheres to the"," ",(0,Be.tZ)(pn.Z,{href:"https://compendium.keqingmains.com/kqm-standards",target:"_blank",children:"KQM Standards"}),"."]})})}),(0,Be.BX)(vr.Z,{children:[(0,Be.tZ)(P.Z,{onClick:l,color:"error",children:n("ui:close")}),(0,Be.tZ)(P.Z,{color:"success",onClick:()=>{l(),e()},autoFocus:!0,children:n("tabTheorycraft.kqmsDialog.kqmsBtn")})]})]})]})}var Sr=n(86512),Xr=n(23128);const Tr=d.lazy((()=>Promise.resolve().then(n.bind(n,18571))));function Or({weaponTypeKey:e,disabled:t}){const{buildTc:n,setBuildTc:i}=(0,d.useContext)(Nl),a=(0,d.useCallback)((e=>{i((t=>{t.weapon=Object.assign({},t.weapon,e)}))}),[i]),l=(0,d.useMemo)((()=>Object.assign({},n.weapon,{location:"",lock:!1,id:""})),[n]),{key:r,level:o=0,refinement:c=1,ascension:u=0}=l,h=(0,mt.ub)(r),[Z,p,f]=(0,w.aV)(),{data:g}=(0,d.useContext)(m.R),x=(0,d.useMemo)((()=>l&&(0,gn.mP)([h.data,(0,gn.v0)(l)])),[h,l]);return(0,Be.BX)(K.Z,{sx:{p:1,mb:1},children:[(0,Be.tZ)(Tr,{ascension:u,show:Z,onHide:f,onSelect:e=>a({key:e}),weaponTypeFilter:e}),(0,Be.BX)(s.Z,{display:"flex",flexDirection:"column",gap:1,children:[(0,Be.BX)(s.Z,{display:"flex",gap:1,children:[(0,Be.tZ)(s.Z,{className:`grad-${h.rarity}star`,component:"img",src:(0,ut.Aq)(l.key,u>=2),sx:{flexshrink:1,flexBasis:0,maxWidth:"30%",borderRadius:1}}),(0,Be.BX)(fe.Z,{spacing:1,flexGrow:1,children:[(0,Be.tZ)(P.Z,{fullWidth:!0,color:"info",sx:{flexGrow:1},onClick:p,disabled:t,children:(0,Be.tZ)(s.Z,{sx:{maxWidth:"10em"},children:null==h?void 0:h.name})}),h.hasRefinement&&(0,Be.tZ)(Xr.Z,{disabled:t,refinement:c,setRefinement:e=>a({refinement:e})})]})]}),(0,Be.tZ)(Sr.Z,{level:o,ascension:u,setBoth:a,useLow:!h.hasRefinement,disabled:t}),(0,Be.BX)(re.Z,{children:[(0,Be.tZ)(ye.Z,{title:"Main Stats",titleTypographyProps:{variant:"subtitle2"}}),(0,Be.tZ)(ge.Z,{}),x&&(0,Be.tZ)(we.lD,{children:[Ze.ri.weapon.main,Ze.ri.weapon.sub,Ze.ri.weapon.sub2].map((e=>{const t=x.get(e);return t.isEmpty||!t.value?null:(0,Be.tZ)(we.JW,{node:t,component:wt.ZP},JSON.stringify(t.info))}))})]}),g&&(null==h?void 0:h.document)&&(0,Be.tZ)(ii.Z,{sections:h.document,disabled:t})]})]})}let Ir,Er=e=>e;function jr(){const{t:e}=(0,u.$G)("page_character"),t=(0,l.Wz)(),{gender:i}=(0,l.Hz)(),{teamChar:{key:c,buildTcId:h}}=(0,d.useContext)(x.V),Z=(0,l.dN)(h),p=(0,d.useCallback)((e=>{t.buildTcs.set(h,e)}),[h,t]),f=(0,d.useMemo)((()=>({buildTc:Z,setBuildTc:p})),[Z,p]),g=(0,Qe.Ru)(c).weaponType,b=(0,d.useContext)(m.R),v=jn(),y=(0,d.useMemo)((()=>{if(b)return Object.assign({},b,{oldData:v})}),[b,v]),w=Z.optimization.target,B=(0,d.useCallback)((e=>{const t=structuredClone(Z);t.optimization.target=e,p(t)}),[Z,p]),k=Z.optimization.distributedSubstats,S=(0,d.useCallback)((e=>{p((t=>{t.optimization.distributedSubstats=e}))}),[p]),X=(0,d.useRef)(null);null===X.current&&(X.current=new Worker(new URL(n.p+n.u(481),n.b)));const[T,O]=(0,d.useState)((0,r.Qe)()),I="active"===T.type,E=(0,d.useCallback)((()=>{X.current.terminate(),X.current=null,O((0,r.Qe)())}),[X]),{minSubLines:j,minOtherRolls:M}=(0,d.useMemo)((()=>(0,En.ce)(Z)),[Z]),D=(0,d.useMemo)((()=>Object.values(Z.artifact.slots).reduce(((e,{level:t,rarity:n})=>e+a.i0[n].high+Math.floor(t/4)),0)),[Z]),{scalesWith:A}=(0,d.useMemo)((()=>{const{nodes:e}=(0,En.UL)(b.teamData,c,Z);return{nodes:e,scalesWith:e?(0,En.qK)(e):new Set}}),[b.teamData,c,Z]),_=e=>{const n=(0,Rl.o)(t,c,0,i,(0,En.ho)(Z),(0,En.qU)(Z)),{nodes:a}=(0,En.UL)(n,c,Z);X.current.postMessage({buildTc:Z,nodes:a}),O((e=>Object.assign({},e,{type:"active",startTime:performance.now(),finishTime:void 0}))),X.current.onmessage=({data:t})=>{const{resultType:n}=t;switch(n){case"total":O((e=>Object.assign({},e,{total:t.total})));break;case"count":O((e=>Object.assign({},e,{tested:t.tested,failed:t.failed})));break;case"finalize":{const{maxBuffer:n,distributed:i,tested:a,failed:l,skipped:r}=t;if(O((e=>Object.assign({},e,{type:"inactive",tested:a,failed:l,skipped:r,finishTime:performance.now()}))),!e){console.log({maxBuffer:n,distributed:i,tested:a,failed:l,skipped:r});break}p((e=>(e.artifact.substats.stats=(0,z.vU)(e.artifact.substats.stats,((e,t)=>{var i;return e+(0,z.yI)(null!=(i=n[t])?i:0,t)})),e.optimization.distributedSubstats=k-i,e)));break}}}},L=(0,d.useCallback)((()=>{p((e=>{e.artifact.substats.type="mid";const{artifact:{slots:t,substats:{stats:n,type:i,rarity:a}}}=e;e.optimization.distributedSubstats=20-(5===a?0:4===a?10:15),e.artifact.substats.stats=(0,z.vU)(n,((e,t)=>2*(0,Zt.U9)(t,a,i))),e.optimization.maxSubstats=(0,z.vU)(e.optimization.maxSubstats,((e,n)=>2+2*(5-Object.entries(t).filter((([e,{statKey:t}])=>t===n)).length)))}))}),[p]);return(0,Be.tZ)(Nl.Provider,{value:f,children:(0,Be.BX)(fe.Z,{spacing:1,children:[(0,Be.tZ)(s.Z,{children:(0,Be.BX)(te.ZP,{container:!0,spacing:1,sx:{justifyContent:"center"},children:[(0,Be.tZ)(te.ZP,{item:!0,xs:8,sm:5,md:4,lg:2.3,children:(0,Be.tZ)(ul,{})}),(0,Be.tZ)(te.ZP,{item:!0,xs:12,sm:7,md:8,lg:9.7,sx:{display:"flex",flexDirection:"column",gap:1},children:(0,Be.tZ)(K.Z,{sx:{flexGrow:1,p:1},children:(0,Be.tZ)(fn.o.Provider,{value:w,children:y?(0,Be.tZ)(m.R.Provider,{value:y,children:(0,Be.tZ)(tl.Z,{})}):(0,Be.tZ)(o.Z,{variant:"rectangular",width:"100%",height:500})})})})]})}),(0,Be.tZ)(K.Z,{children:(0,Be.BX)(s.Z,{sx:{display:"flex",gap:1,p:1},children:[(0,Be.BX)(s.Z,{sx:{flexGrow:1,display:"flex",gap:1},children:[(0,Be.tZ)(kr,{action:L,disabled:I}),(0,Be.tZ)(wr,{disabled:I})]}),(0,Be.tZ)(Kn,{})]})}),b?(0,Be.BX)(m.R.Provider,{value:b,children:[(0,Be.tZ)(s.Z,{children:(0,Be.BX)(te.ZP,{container:!0,spacing:1,sx:{justifyContent:"center"},children:[(0,Be.BX)(te.ZP,{item:!0,sx:{flexGrow:-1,maxWidth:"350px"},children:[(0,Be.tZ)(Or,{weaponTypeKey:g,disabled:I}),(0,Be.tZ)(pr,{disabled:I})]}),(0,Be.tZ)(te.ZP,{item:!0,sx:{flexGrow:-1},children:(0,Be.tZ)(Yl,{disabled:I})}),(0,Be.tZ)(te.ZP,{item:!0,sx:{flexGrow:1},children:(0,Be.tZ)(or,{disabled:I,maxTotalRolls:D})})]})}),(0,Be.BX)(s.Z,{display:"flex",flexDirection:"column",gap:1,children:[M>0&&(0,Be.tZ)(Ct.Z,{severity:"warning",variant:"filled",children:(0,Be.BX)(u.cC,{t:e,i18nKey:"tabTheorycraft.feasibilityAlert",values:{minSubLines:j,minOtherRolls:M},children:["The current substat distribution requires at least"," ",(0,Be.tZ)("strong",{children:{minSubLines:j}})," lines of substats. Need to assign ",(0,Be.tZ)("strong",{children:{minOtherRolls:M}})," ","rolls to other substats for this solution to be feasible."]})}),(0,Be.BX)(s.Z,{display:"flex",gap:1,children:[(0,Be.tZ)(Te,{disabled:I,optimizationTarget:w,setTarget:e=>B(e)}),(0,Be.tZ)(oe.ZP,{value:k,disabled:!w||I,onChange:e=>void 0!==e&&S(e),endAdornment:"Substats",sx:{borderRadius:1,px:1,textWrap:"nowrap",flexShrink:1},inputProps:{sx:{textAlign:"right",px:1,width:"3em",minWidth:"3em"},min:0}}),I?(0,Be.tZ)(P.Z,{onClick:E,color:"error",startIcon:(0,Be.tZ)(_l.Z,{}),children:"Cancel"}):(0,Be.tZ)(P.Z,{onClick:()=>_(!0),disabled:!w||!k||k>D,color:"success",startIcon:(0,Be.tZ)(zl.Z,{}),children:e(Ir||(Ir=Er`tabTheorycraft.distribute`))})]}),C.r8&&(0,Be.tZ)(P.Z,{onClick:()=>_(!1),disabled:!w||I,children:"Log Optimized Substats"}),!!A.size&&(0,Be.BX)(Ct.Z,{severity:"info",variant:"filled",children:[(0,Be.BX)(u.cC,{t:e,i18nKey:"tabTheorycraft.optAlert.scalesWith",children:["The selected Optimization target and constraints scales with:"," "]}),[...A].map((e=>(0,Be.BX)("strong",{children:[(0,Be.tZ)(ht.ej,{statKey:e,iconProps:Bt.mX}),(0,Be.tZ)(Ll.w0,{statKey:e})]},e))).flatMap(((e,t,n)=>t===n.length-2?[e,(0,Be.tZ)("span",{children:", and "},"and")]:t===n.length-1?e:[e,(0,Be.tZ)("span",{children:", "},t)])),(0,Be.tZ)(u.cC,{t:e,i18nKey:"tabTheorycraft.optAlert.distribute",children:". The solver will only distribute stats to these substats."})," ",M>0&&(0,Be.tZ)(u.cC,{t:e,i18nKey:"tabTheorycraft.optAlert.feasibilty",children:"There may be additional leftover substats that should be distributed to non-scaling stats to ensure the solution is feasible."})]}),(0,Be.tZ)(r.g8,{status:T,characterKey:c,gender:i})]})]}):(0,Be.tZ)(o.Z,{variant:"rectangular",width:"100%",height:500})]})})}var Pr=n(1856),Mr=n(5896),Kr=n(81073),Dr=n(30840),Ar=n(15045);const zr=[[1],[1,1,1,1],[1,2,3,4,3,2,1],[1,3,6,10,12,12,10,6,3,1],[1,4,10,20,31,40,44,40,31,20,10,4,1],[1,5,15,35,65,101,135,155,155,135,101,65,35,15,5,1]];function _r(e,t){var n;if(e>=zr.length)throw Error("Input to `quadrinomial` leaves expected range 0 <= n <= 5");return null!=(n=zr[e][t])?n:0}function Lr(e){let t=1;e<0&&(t=-1);const n=1/(1+.3275911*(e=Math.abs(e)));return t*(1-((((1.061405429*n-1.453152027)*n+1.421413741)*n-.284496736)*n+.254829592)*n*Math.exp(-e*e))}const Rr=[1,1,2,6,24,120,720];function Wr(e){for(;e>=Rr.length;)Rr.push(Rr.length*Rr[Rr.length-1]);return Rr[e]}function Nr(e,t){var n,i,a,l,r;if(0!==e)for(let s=e;s>=0;s--)for(let o=e-s;o>=0;o--)for(let c=e-s-o;c>=0;c--){const d=e-s-o-c;t([s,o,c,d],(n=s)+(i=o)+(a=c)+(l=d)!==(r=e)?0:Wr(r)/Wr(n)/Wr(i)/Wr(a)/Wr(l)*4**-r)}else t([0,0,0,0],1)}function Gr(e,t,n){let i=!0;return(0,bn.aD)([e],(e=>{}),(e=>{const{operation:a}=e;if("read"===a){if("number"!==e.type||e.accu&&"add"!==e.accu)throw new Error(`Unsupported [${a}] node in zero_deriv`);t(e)===n&&(i=!1)}})),i}function Vr(e,t,n){const{operation:i}=e;switch(i){case"read":if("number"!==e.type||e.accu&&"add"!==e.accu)throw new Error(`Unsupported [${i}] node in d/dx`);return t(e)===n?(0,vn.a9)(1):(0,vn.a9)(0);case"const":return(0,vn.a9)(0);case"res":if(!Gr(e,t,n))throw new Error(`[${i}] node takes only constant inputs. ${e}`);return(0,vn.a9)(0);case"add":return(0,vn.Sm)(...e.operands.map((e=>Vr(e,t,n))));case"mul":{const i=e.operands.map(((i,a)=>(0,vn.WV)(Vr(i,t,n),...e.operands.filter(((e,t)=>t!==a)))));return(0,vn.Sm)(...i)}case"sum_frac":{const i=e.operands[0],a=Vr(i,t,n),l=(0,vn.Sm)(...e.operands.slice(1)),r=Vr(l,t,n),s=(0,vn.WV)((0,vn.Sm)(...e.operands),(0,vn.Sm)(...e.operands)),o=(0,vn.Sm)((0,vn.WV)(l,a),(0,vn.WV)(-1,i,r));return(0,vn.F9)(o,(0,vn.Sm)((0,vn.WV)(-1,o),s))}case"min":case"max":{let a=Vr(e.operands[0],t,n);for(let l=1;l<e.operands.length;l++){const r=e.operands[l];if("min"===i){const i=(0,vn.VV)(...e.operands.slice(0,l));a=(0,vn.Lj)(r,i,a,Vr(r,t,n))}else if("max"===i){const i=(0,vn.Fp)(...e.operands.slice(0,l));a=(0,vn.Lj)(r,i,Vr(r,t,n),a)}}return a}case"threshold":{const[a,l,r,s]=e.operands;if(!Gr(a,t,n)||!Gr(l,t,n))throw new Error(`[${i}] node must branch on constant inputs. ${e}`);return(0,vn.Lj)(a,l,Vr(r,t,n),Vr(s,t,n))}default:(0,C.UT)(i)}}function $r(e,t,n){if(t<1e-5)return e>n?{p:1,upAvg:e-n}:{p:0,upAvg:0};const i=(n-e)/Math.sqrt(t),a=(1-Lr(i/Math.sqrt(2)))/2,l=function(e,t,n){return void 0===t&&(t=0),void 0===n&&(n=1),n<=0?0:Math.exp(-(t-e)*(t-e)/n/2)/Math.sqrt(2*Math.PI*n)}(i),r=1/(i*i),s=i<5?l/a-i:(1-2*r*(1-r*(5+37*r)))/i;return{p:a,upAvg:Math.sqrt(t)*s}}const Fr=8.5,qr=18.375,Hr=4.515625;let Ur=function(e){return e[e.Fast=0]="Fast",e[e.Slow=1]="Slow",e[e.Exact=2]="Exact",e}({});const Yr={hp:6,atk:6,def:6,hp_:4,atk_:4,def_:4,eleMas:4,enerRech_:4,critRate_:3,critDMG_:3};function Jr(e,t=5){return Qr(e,(0,Zt.U9)(e,t)/10)}function Qr(e,t){return e.endsWith("_")?t/100:t}class UpOptCalculator{constructor(e,t,n,i){this.baseBuild=void 0,this.nodes=void 0,this.thresholds=void 0,this.calc4th=!1,this.skippableDerivatives=void 0,this.eval=void 0,this.artifacts=[],this.fixedIx=0,this.baseBuild=n,this.nodes=e,this.thresholds=t;const l=[];e.forEach((e=>{l.push(e,...a._m.map((t=>Vr(e,(e=>e.path[1]),t))))}));const r=(0,xn.tL)(l,{},(({path:[e]})=>"dyn"!==e)),s=(0,xn.I3)(r,{},(e=>e.path[1]),5);t[0]=s(Object.values(n))[0],this.skippableDerivatives=a._m.map((t=>e.every((e=>Gr(e,(e=>e.path[1]),t))))),this.eval=(t,i)=>{const l=Object.assign({},n,{[i]:{id:"",values:t}}),r=s(Object.values(l));return e.map(((e,t)=>{const n=t*(1+a._m.length);return{v:r[n],grads:a._m.map(((e,t)=>r[n+1+t]))}}))},i.forEach((e=>this._addArtifact(e)))}_addArtifact(e){const t=a.F7[e.rarity],n=(0,Zt.Bv)(e.mainStatKey,e.rarity,t);this.artifacts.push({id:e.id,rollsLeft:(0,Zt.NB)(e.level,e.rarity),slotKey:e.slotKey,mainStat:e.mainStatKey,subs:e.substats.map((({key:e})=>e)).filter((e=>""!==e)),values:Object.assign({[e.setKey]:1,[e.mainStatKey]:Qr(e.mainStatKey,n)},Object.fromEntries(e.substats.filter((({key:e})=>""!==e)).map((e=>[e.key,Qr(e.key,e.accurateValue)]))))})}calcFastAll(){function e(e){return e.result.p*e.result.upAvg}this.artifacts.forEach(((e,t)=>this.calcFast(t,this.calc4th))),this.artifacts.sort(((t,n)=>e(n)-e(t))),this.fixedIx=0}calcSlowToIndex(e,t=5){const n=this.artifacts.slice(0,this.fixedIx),i=this.artifacts.slice(this.fixedIx);function a(e){return e.result.p*e.result.upAvg}function l(e,t){if(a(e)>1e-5||a(t)>1e-5)return a(t)-a(e);const n=e.result.distr.gmm.reduce(((e,{phi:t,mu:n})=>e+t*n),0);return t.result.distr.gmm.reduce(((e,{phi:t,mu:n})=>e+t*n),0)-n}let r=0;const s=Math.min(e-this.fixedIx+t,i.length);do{for(;r<s;r++)this.calcSlow(this.fixedIx+r,this.calc4th);for(i.sort(l),this.artifacts=[...n,...i],r=0;r<s&&i[r].result.evalMode!==Ur.Fast;r++);}while(r<s)}_toResultFast(e){let t=0,n=0;const i=e.map((({prob:e,mu:i,cov:a})=>{const l=i.map(((e,t)=>$r(e,a[t],this.thresholds[t]))),r=Math.min(...l.map((({p:e})=>e))),s=Math.min(...l.slice(1).map((({p:e})=>e)));return t+=r*e,n+=r*e*l[0].upAvg,{phi:e,cp:s,mu:i[0],sig2:a[0]}})),a=i.map((({mu:e,sig2:t})=>e-4*Math.sqrt(t))),l=i.map((({mu:e,sig2:t})=>e+4*Math.sqrt(t)));return{p:t,upAvg:t<1e-6?0:n/t,distr:{gmm:i,lower:Math.min(...a),upper:Math.max(...l)},evalMode:Ur.Fast}}calcFast(e,t=!0){4===this.artifacts[e].subs.length&&(t=!1),t?this._calcFast4th(e):this._calcFast(e)}_calcFast(e){const{subs:t,slotKey:n,rollsLeft:i}=this.artifacts[e],l=i-(t.length<4?1:0),r=Object.assign({},this.artifacts[e].values);t.forEach((e=>{r[e]+=Fr*(l/4)*Jr(e)}));const s=this.eval(r,n).map((({v:e,grads:n})=>{const i=t.map((e=>n[a._m.indexOf(e)]*Jr(e))),r=i.reduce(((e,t)=>e+t),0),s=i.reduce(((e,t)=>e+t*t),0);return{mu:e,sig2:(qr*s-Hr*r**2)*l}}));this.artifacts[e].result=this._toResultFast([{prob:1,mu:s.map((({mu:e})=>e)),cov:s.map((({sig2:e})=>e))}])}_calcFast4th(e){const{mainStat:t,subs:n,slotKey:i,rollsLeft:l}=this.artifacts[e],r=l-1,s=a._m.filter((e=>!n.includes(e)&&e!==t)),o=s.reduce(((e,t)=>e+Yr[t]),0),c=s.map((t=>{var l;const s=Yr[t]/o,c=Object.assign({},this.artifacts[e].values);n.forEach((e=>{c[e]+=Fr*(r/4)*Jr(e)})),c[t]=(null!=(l=c[t])?l:0)+Fr*(r/4+1)*Jr(t);const d=this.eval(c,i).map((({v:e,grads:i})=>{const l=n.map((e=>i[a._m.indexOf(e)]*Jr(e))),s=i[a._m.indexOf(t)]*Jr(t),o=l.reduce(((e,t)=>e+t),s),c=l.reduce(((e,t)=>e+t*t),s*s);return{mu:e,sig2:(qr*c-Hr*o**2)*r+1.25*s*s}}));return{prob:s,mu:d.map((({mu:e})=>e)),cov:d.map((({sig2:e})=>e))}}));this.artifacts[e].result=this._toResultFast(c)}_toResultSlow(e){let t=0,n=0;const i=e.map((({prob:e,mu:i,cov:a})=>{const{p:l,upAvg:r,cp:s}=function(e,t,n){let i=1,a=1;for(let r=0;r<e.length;++r){if(t[r][r]<1e-5){if(e[r]<n[r])return{p:0,upAvg:0,cp:0};continue}const l=(1-Lr((n[r]-e[r])/Math.sqrt(t[r][r])/Math.sqrt(2)))/2;i*=l,0!==r&&(a*=l)}const{upAvg:l}=$r(e[0],t[0][0],n[0]);return{p:i,upAvg:l,cp:a}}(i,a,this.thresholds);return t+=e*l,n+=e*l*r,{phi:e,cp:s,mu:i[0],sig2:a[0][0]}})),a=i.map((({mu:e,sig2:t})=>e-4*Math.sqrt(t))),l=i.map((({mu:e,sig2:t})=>e+4*Math.sqrt(t)));return{p:t,upAvg:t<1e-6?0:n/t,distr:{gmm:i,lower:Math.min(...a,this.thresholds[0]),upper:Math.max(...l,this.thresholds[0])},evalMode:Ur.Slow}}calcSlow(e,t=!0){var n,i;(null==(n=this.artifacts[e].result)?void 0:n.evalMode)!==Ur.Slow&&(null==(i=this.artifacts[e].result)?void 0:i.evalMode)!==Ur.Exact&&(4===this.artifacts[e].subs.length&&(t=!1),t?this._calcSlow4th(e):this._calcSlow(e))}_calcSlow(e){const{subs:t,slotKey:n,rollsLeft:i}=this.artifacts[e],l=i-(t.length<4?1:0),r=[];Nr(l,((i,l)=>{const s=Object.assign({},this.artifacts[e].values);t.forEach(((e,t)=>{s[e]+=Fr*i[t]*Jr(e)}));const o=this.eval(s,n),c=o.map((({grads:e})=>t.map((t=>e[a._m.indexOf(t)]*Jr(t))))),d=o.map((e=>e.v)),u=c.map((e=>c.map((t=>e.reduce(((n,a,l)=>n+e[l]*t[l]*i[l]),0)))));r.push({prob:l,mu:d,cov:u})})),this.artifacts[e].result=this._toResultSlow(r)}_calcSlow4th(e){const{mainStat:t,subs:n,slotKey:i,rollsLeft:l}=this.artifacts[e],r=l-1,s=a._m.filter((e=>!n.includes(e)&&e!==t)),o=s.reduce(((e,t)=>e+Yr[t]),0),c=[];s.forEach((t=>{Nr(r,((l,r)=>{var s;r*=Yr[t]/o;const d=Object.assign({},this.artifacts[e].values);l[3]+=1,n.forEach(((e,t)=>{d[e]+=Fr*l[t]*Jr(e)})),d[t]=(null!=(s=d[t])?s:0)+Fr*l[3]*Jr(t);const u=this.eval(d,i),h=u.map((({grads:e})=>{const i=n.map((t=>e[a._m.indexOf(t)]*Jr(t)));return i.push(e[a._m.indexOf(t)]*Jr(t)),i})),Z=u.map((e=>e.v)),p=h.map((e=>h.map((t=>e.reduce(((n,i,a)=>n+e[a]*t[a]*l[a]),0)))));c.push({prob:r,mu:Z,cov:p})}))})),this.artifacts[e].result=this._toResultSlow(c)}_toResultExact(e){let t=0,n=0;const i=e.map((({prob:e,val:i})=>{if(i.every(((e,t)=>e>=this.thresholds[t])))return t+=e,n+=e*(i[0]-this.thresholds[0]),{phi:e,cp:1,mu:i[0],sig2:0};return{phi:e,cp:i.slice(1).every(((e,t)=>e>=this.thresholds[t]))?1:0,mu:i[0],sig2:0}})),a=i.map((({mu:e})=>e));return{p:t,upAvg:t<1e-6?0:n/t,distr:{gmm:i,lower:Math.min(...a),upper:Math.max(...a)},evalMode:Ur.Exact}}calcExact(e,t=!0){var n;(null==(n=this.artifacts[e].result)?void 0:n.evalMode)!==Ur.Exact&&(4===this.artifacts[e].subs.length&&(t=!1),t?this._calcExact4th(e):this._calcExact(e))}_calcExact(e){const{subs:t,slotKey:n,rollsLeft:i}=this.artifacts[e],l=i-(t.length<4?1:0),r=[];Nr(l,((i,l)=>{const s=Object.assign({},this.artifacts[e].values),o=i.map(((e,n)=>t[n]&&!this.skippableDerivatives[a._m.indexOf(t[n])]?(0,z.w6)(7*e,10*e):[NaN]));(0,z.Og)(...o).forEach((e=>{const a=Object.assign({},s);let o=1;for(let n=0;n<4;n++){var c;if(isNaN(e[n]))continue;const l=t[n],r=e[n],s=i[n];a[l]=(null!=(c=a[l])?c:0)+r*Jr(l);o*=4**-s*_r(s,r-7*s)}r.push({prob:l*o,val:this.eval(a,n).map((e=>e.v))})}))})),this.artifacts[e].result=this._toResultExact(r)}_calcExact4th(e){const{mainStat:t,subs:n,slotKey:i,rollsLeft:l}=this.artifacts[e],r=l-1,s=a._m.filter((e=>!n.includes(e)&&e!==t)),o=s.reduce(((e,t)=>e+Yr[t]),0),c=[];s.forEach((t=>{const l=Yr[t]/o;Nr(r,((r,s)=>{const o=r.map(((e,i)=>3===i?(e+=1,this.skippableDerivatives[a._m.indexOf(t)]?[NaN]:(0,z.w6)(7*e,10*e)):n[i]&&!this.skippableDerivatives[a._m.indexOf(n[i])]?(0,z.w6)(7*e,10*e):[NaN]));(0,z.Og)(...o).forEach((a=>{const o=Object.assign({},this.artifacts[e].values);let d=1;for(let e=0;e<3;e++){var u;if(isNaN(a[e]))continue;const t=n[e],i=a[e],l=r[e];o[t]=(null!=(u=o[t])?u:0)+i*Jr(t);d*=4**-l*_r(l,i-7*l)}if(!isNaN(a[3])){var h;const e=t,n=a[3],i=r[3]+1;o[e]=(null!=(h=o[e])?h:0)+n*Jr(e);d*=4**-i*_r(i,n-7*i)}c.push({prob:l*s*d,val:this.eval(o,i).map((e=>e.v))})}))}))})),this.artifacts[e].result=this._toResultExact(c)}}function es(e){const t=Qr(e.mainStatKey,(0,Zt.Bv)(e.mainStatKey,e.rarity,e.level)),n={id:e.id,slot:e.slotKey,level:e.level,rarity:e.rarity,values:Object.assign({[e.setKey]:1,[e.mainStatKey]:t},Object.fromEntries(e.substats.map((e=>[e.key,Qr(e.key,e.accurateValue)])).filter((([,e])=>0!==e)))),subs:e.substats.reduce(((e,t)=>(""!==t.key&&e.push(t.key),e)),[])};return delete n.values[""],n}const ts=50;function ns(e){return(0,Be.BX)(te.ZP,{container:!0,spacing:1,children:[(0,Be.tZ)(te.ZP,{item:!0,xs:5,sm:4,md:4,lg:3,xl:3,children:(0,Be.tZ)(xa.Z,{artifactId:e.upgradeOpt.id,editorProps:{}})}),(0,Be.tZ)(te.ZP,{item:!0,xs:7,sm:8,md:8,lg:9,xl:9,children:(0,Be.tZ)(is,Object.assign({},e))})]})}function is({upgradeOpt:e,thresholds:t,objMin:n,objMax:i,calcExactCallback:a}){const r=(0,l.Wz)().arts.get(e.id);if(!r)throw new Error(`artifact ${e.id} not found.`);const o=t.length>1,u=(t,n)=>e.result.distr.gmm.reduce(((e,{phi:i,mu:a,sig2:l})=>{const r=Math.sqrt(l);if(r<.001)return t<=a&&a<n?i+e:e;return e+i*(Lr((a-t)/r)-Lr((a-n)/r))/2}),0),h=(t,n)=>e.result.distr.gmm.reduce(((e,{cp:i,phi:a,mu:l,sig2:r})=>{const s=Math.sqrt(r);if(s<.001)return t<=l&&l<n?i*a+e:e;return e+i*a*(Lr((l-t)/s)-Lr((l-n)/s))/2}),0),Z=t[0],p=(0,d.useCallback)((e=>100*(e-Z)/Z),[Z]),m=(i-n)/ts,f=(0,z.SX)(n,i,ts,!1).flatMap((e=>[{x:p(e),est:u(e,e+m),estCons:h(e,e+m)},{x:p(e+m),est:u(e,e+m),estCons:h(e,e+m)}]));f.unshift({x:p(n),est:0,estCons:0}),f.push({x:p(i),est:0,estCons:0});const g=f.reduce(((e,{est:t})=>Math.max(e,t)),0),x=(Z-n)/(i-n),b=e.result.p,v=e.result.upAvg,y=f,C=e.result.evalMode===Ur.Exact,B=(0,z.SX)(n,i,ts,!1).reduce(((e,t)=>t<Z+v?t:e)),k=h(B,B+m),S=(0,w.KS)();C||S(a,1e3);const X=(0,Be.BX)("span",{children:["Prob. upgrade",C?"":" (est.)",":"," ",(0,Be.BX)("strong",{children:[(100*b).toFixed(1),"%"]})]}),T=(0,Be.BX)("span",{children:["Average increase",C?"":" (est.)",":"," ",(0,Be.BX)("strong",{children:[v<=0?"":"+",(100*v/Z).toFixed(1),"%"]})]});return(0,Be.BX)(K.Z,{children:[(0,Be.BX)(s.Z,{sx:{display:"flex",flexDirection:"row"},children:[(0,Be.tZ)(c.Z,{sx:{flexGrow:1},children:(0,Be.BX)(s.Z,{sx:{display:"flex",flexDirection:"row",gap:2},children:[(0,Be.tZ)(F.Z,{children:X}),(0,Be.tZ)(F.Z,{sx:{flexGrow:1},children:T}),(0,Be.tZ)(F.Z,{children:"Currently Equipped"})]})}),(0,Be.tZ)(s.Z,{sx:{height:50,width:50},children:(0,Be.tZ)(as,{slotKey:r.slotKey})})]}),(0,Be.tZ)(c.Z,{children:(0,Be.tZ)(_i.h,{width:"100%",aspect:2.5,children:(0,Be.BX)(Li.c,{data:y,margin:{top:5,right:30,left:20,bottom:20},children:[(0,Be.tZ)(Wi.K,{dataKey:"x",type:"number",domain:["auto","auto"],allowDecimals:!1,tickFormatter:e=>`${e<=0?"":"+"}${e}%`,children:(0,Be.tZ)(Ni._,{value:"Relative Damage Potential",position:"insideBottom",style:{fill:"#eaebed"},offset:-10})}),(0,Be.tZ)(Gi.B,{type:"number",domain:[0,g],tick:!1,children:(0,Be.tZ)(Ni._,{value:"Probability",position:"insideLeft",angle:-90,style:{fill:"#eaebed"}})}),(0,Be.tZ)($i.D,{verticalAlign:"top",height:36}),(0,Be.tZ)("defs",{children:(0,Be.BX)("linearGradient",{id:`splitOpacity${e.id}`,x1:"0",y1:"0",x2:x,y2:"0",children:[(0,Be.tZ)("stop",{offset:1,stopColor:C?"#f17704":"orange",stopOpacity:0}),(0,Be.tZ)("stop",{offset:0,stopColor:C?"#f17704":"orange",stopOpacity:1})]})}),(0,Be.tZ)(Fi.x,{dataKey:"dne",stroke:"red",name:"Current Damage"}),o&&(0,Be.tZ)(Kr.u,{type:"monotone",dataKey:"est",stroke:"grey",dot:!1,fill:"grey",legendType:"none",tooltipType:"none",opacity:.5,activeDot:!1}),(0,Be.tZ)(Kr.u,{type:"monotone",dataKey:"estCons",stroke:C?"#f17704":"orange",dot:!1,fill:`url(#splitOpacity${e.id})`,opacity:.5,name:C?`Exact${o?" Constrained":""} Distribution`:"Estimated Distribution",activeDot:!1}),(0,Be.tZ)(Dr.d,{x:p(Z),stroke:"red",strokeDasharray:"3 3",name:"Current Damage"}),(0,Be.tZ)(Ar.q,{x:p(Z+v),y:k/2,shape:(0,Be.tZ)("circle",{radius:1,opacity:.5})}),(0,Be.tZ)(Vi.u,{content:(0,Be.tZ)((({active:e})=>e?(0,Be.BX)("div",{className:"custom-tooltip",children:[(0,Be.tZ)("p",{className:"label"}),(0,Be.tZ)("p",{className:"desc",children:X}),(0,Be.tZ)("p",{className:"desc",children:T})]}):null),{}),cursor:!1})]})},e.id)})]})}function as({slotKey:e}){const t=(0,l.Wz)(),{data:n}=(0,d.useContext)(m.R),i=(0,d.useMemo)((()=>t.arts.get(n.get(Ze.ri.art[e].id).value)),[e,n,t]);return(0,Be.tZ)(Ji.Z,{slotKey:e,artifactObj:i})}var ls=n(37214),rs=n(83660);function ss(){var e;const{teamId:t,teamCharId:n,teamChar:{optConfigId:r,key:u}}=(0,d.useContext)(x.V),h=(0,l.Wz)(),{gender:Z}=(0,l.Hz)(),p=(0,d.useMemo)((()=>!h.arts.values.length),[h]),f=(0,l.EZ)(r),{optimizationTarget:g,levelLow:b,levelHigh:y}=f,B=(0,v.ZP)(),{target:k}=null!=(e=null==B?void 0:B[u])?e:{},[S]=(0,w.NW)(),[,X]=(0,d.useState)(h.displayOptimize.get());(0,d.useEffect)((()=>h.displayOptimize.follow(((e,t)=>X(t)))),[h,X]);const T=(0,d.useDeferredValue)(S),O=(0,d.useDeferredValue)(f),I=(0,d.useMemo)((()=>{const{mainStatKeys:e,excludedLocations:t,artExclusion:n,levelLow:i,levelHigh:l,allowLocationsState:r,useExcludedArts:s}=T&&O;return h.arts.values.filter((o=>{if(!s&&n.includes(o.id))return!1;if(o.level<i)return!1;if(o.level>l)return!1;const c=e[o.slotKey];if(null!=c&&c.length&&!c.includes(o.mainStatKey))return!1;const d=(0,a.V7)(u),h="unequippedOnly"===r&&o.location&&o.location!==d,Z="customList"===r&&o.location&&o.location!==d&&t.includes(o.location);return!h&&!Z}))}),[h,u,T,O]),E=(0,d.useMemo)((()=>Object.fromEntries(I.map((({id:e})=>[e,!0])))),[I]),[j,M]=(0,d.useState)(void 0),[,A]=(0,w.NW)(),[_,L]=(0,d.useState)(!0),[R,W]=(0,d.useState)(!0),[N,G]=(0,d.useState)(!1),[V,$]=(0,d.useState)(0),{artifactsToShow:F,numPages:q,currentPageIndex:H,minObj0:U,maxObj0:Y}=(0,d.useMemo)((()=>{if(!j)return{artifactsToShow:[],numPages:0,currentPageIndex:0,toShow:0,minObj0:0,maxObj0:0};const e=Math.ceil(j.artifacts.length/5),t=(0,z.re)(V,0,e-1),n=j.artifacts.slice(5*t,5*(t+1)),i=j.thresholds[0];return{artifactsToShow:n,numPages:e,currentPageIndex:t,minObj0:n.reduce(((e,t)=>Math.min(t.result.distr.lower,e)),i),maxObj0:n.reduce(((e,t)=>Math.max(t.result.distr.upper,e)),i)}}),[V,j]),J=(0,d.useCallback)(((e,t)=>{if(!j)return;const n=5*t;j.calcSlowToIndex(n),$(t-1)}),[j]),Q=(0,d.useCallback)((async()=>{var e,i,l,r;const{statFilters:s,optimizationTarget:o,mainStatKeys:c,levelLow:d,levelHigh:p,artSetExclusion:m}=f;if(!C.dG)return;if(!u||!o)return;const g=(0,v.VF)(h,t,n,0,[]);if(!g)return;const x=null==(e=(0,gn.Qo)(g.teamData,Z,u)[u])?void 0:e.target.data[0];if(!x)return;Object.assign(x,(0,gn.b3)([x,_a.mQ]));const b=(0,C.Hm)(null!=(i=x.display)?i:{},o);if(!b)return;M(void 0),$(0);const y=Object.entries(s).flatMap((([e,t])=>t.filter((e=>!e.disabled)).map((t=>{var n,i;const a=(0,C.Hm)(null!=(n=x.display)?n:{},JSON.parse(e));return{value:a,minimum:"%"===(null==(i=a.info)?void 0:i.unit)?t.value/100:t.value}})))),w=null!=(l=null==(r=h.chars.get(u))?void 0:r.equippedArtifacts)?l:{},B=Object.fromEntries(a.Ex.map((e=>{var t;const n=h.arts.get(null!=(t=w[e])?t:"");return[e,n?es(n):void 0]}))),k=Object.fromEntries(a.Ex.map((e=>{var t,n;const i=h.arts.get(null!=(t=w[e])?t:"");return[e,null!=(n=null==i?void 0:i.setKey)?n:""]})));const S=[b,...y.map((e=>e.value))],X=(0,xn.tL)(S,x,(({path:[e]})=>"dyn"!==e)),T=h.arts.values.filter((e=>5===e.rarity)).filter((function(e){const t=Object.assign({},k);t[e.slotKey]=e.setKey;const n={};if(a.Ex.forEach((e=>{var i;return n[t[e]]=(null!=(i=n[t[e]])?i:0)+1})),!Object.entries(n).every((([e,t])=>{if(!m[e])return!0;switch(t){case 0:case 1:return!0;case 2:case 3:return!m[e].includes(2);case 4:case 5:return!m[e].includes(4);default:throw Error("error in respectSetExclude: num > 5")}})))return!1;if(!m.rainbow)return!0;switch(Object.values(n).reduce(((e,t)=>e+t%2),0)){case 0:case 1:return!0;case 2:case 3:return!m.rainbow.includes(2);case 4:case 5:return!m.rainbow.includes(4);default:throw Error("error in respectSex: nRainbow > 5")}})).filter((e=>_||20!==e.level)).filter((e=>{var t,n;return!N||!(null!=(t=c[e.slotKey])&&t.length)||(null==(n=c[e.slotKey])?void 0:n.includes(e.mainStatKey))})).filter((e=>!N||d<=e.level&&e.level<=p)),O=new UpOptCalculator(X,[-1/0,...y.map((e=>e.minimum))],B,T);O.calc4th=R,O.calcFastAll(),O.calcSlowToIndex(5),M(O)}),[n,t,f,u,h,Z,_,N,R]),ee=(0,d.useMemo)((()=>k&&B&&{data:k,teamData:B}),[k,B]),ne=q>1&&(0,Be.tZ)(K.Z,{children:(0,Be.tZ)(c.Z,{children:(0,Be.BX)(te.ZP,{container:!0,children:[(0,Be.tZ)(te.ZP,{item:!0,flexGrow:1,children:(0,Be.tZ)(Mr.Z,{count:q,page:H+1,onChange:J})}),(0,Be.tZ)(te.ZP,{item:!0,children:(0,Be.tZ)(os,{numShowing:F.length,total:null==j?void 0:j.artifacts.length})})]})})});return(0,Be.BX)(s.Z,{display:"flex",flexDirection:"column",gap:1,children:[p&&(0,Be.tZ)(mn,{}),ee&&(0,Be.tZ)(m.R.Provider,{value:ee,children:(0,Be.BX)(ls.Z,{spacing:1,children:[(0,Be.tZ)(s.Z,{children:(0,Be.BX)(te.ZP,{container:!0,spacing:1,children:[(0,Be.BX)(te.ZP,{item:!0,xs:12,sm:6,lg:3,display:"flex",flexDirection:"column",gap:1,children:[(0,Be.tZ)(s.Z,{children:(0,Be.tZ)(d.Suspense,{fallback:(0,Be.tZ)(o.Z,{variant:"rectangular",width:"100%",height:600}),children:(0,Be.BX)(i.s8,{bgt:"light",children:[(0,Be.tZ)(hn.ql,{characterKey:u,children:(0,Be.tZ)(hn.uh,{characterKey:u})}),(0,Be.BX)(s.Z,{sx:{p:1,width:"100%",display:"flex",flexDirection:"column",gap:1},children:[(0,Be.tZ)(un.S,{}),(0,Be.tZ)(Zn.D,{})]})]})})}),(0,Be.tZ)(Ei,{})]}),(0,Be.tZ)(te.ZP,{item:!0,xs:12,sm:6,lg:9,display:"flex",flexDirection:"column",gap:1,children:(0,Be.BX)(te.ZP,{container:!0,spacing:1,children:[(0,Be.BX)(te.ZP,{item:!0,lg:4,display:"flex",flexDirection:"column",gap:1,children:[(0,Be.tZ)(K.Z,{children:(0,Be.BX)(c.Z,{children:[(0,Be.tZ)("span",{children:"Optimization Target: "}),(0,Be.tZ)(Te,{optimizationTarget:g,setTarget:e=>h.optConfigs.set(r,{optimizationTarget:e}),disabled:!1})]})}),(0,Be.tZ)(K.Z,{children:(0,Be.tZ)(c.Z,{children:(0,Be.tZ)(za,{disabled:!1})})}),N&&(0,Be.BX)(K.Z,{children:[(0,Be.tZ)(c.Z,{sx:{py:1},children:"Artifact Level Filter"}),(0,Be.tZ)(cn.Z,{levelLow:b,levelHigh:y,setLow:e=>h.optConfigs.set(r,{levelLow:e}),setHigh:e=>h.optConfigs.set(r,{levelHigh:e}),setBoth:(e,t)=>h.optConfigs.set(r,{levelLow:e,levelHigh:t}),disabled:!1}),(0,Be.tZ)(c.Z,{children:(0,Be.tZ)(ja,{disabled:!1,filteredArtIdMap:E})})]})]}),(0,Be.BX)(te.ZP,{item:!0,lg:8,display:"flex",flexDirection:"column",gap:1,children:[(0,Be.tZ)(K.Z,{children:(0,Be.tZ)(c.Z,{children:(0,Be.tZ)(wi,{disabled:!1})})}),(0,Be.tZ)(K.Z,{children:(0,Be.tZ)(c.Z,{children:(0,Be.BX)(te.ZP,{container:!0,spacing:1,children:[(0,Be.tZ)(te.ZP,{item:!0,children:(0,Be.tZ)(P.Z,{startIcon:_?(0,Be.tZ)(St.Z,{}):(0,Be.tZ)(Xt.Z,{}),color:_?"success":"secondary",onClick:()=>L(!_),children:"show lvl 20"})}),(0,Be.tZ)(te.ZP,{item:!0,children:(0,Be.tZ)(P.Z,{startIcon:R?(0,Be.tZ)(St.Z,{}):(0,Be.tZ)(Xt.Z,{}),color:R?"success":"secondary",onClick:()=>W(!R),children:"compute 4th sub"})}),(0,Be.tZ)(te.ZP,{item:!0,children:(0,Be.tZ)(P.Z,{startIcon:N?(0,Be.tZ)(St.Z,{}):(0,Be.tZ)(Xt.Z,{}),color:N?"success":"secondary",onClick:()=>G(!N),children:"enable filters"})})]})})})]})]})})]})}),(0,Be.tZ)(K.Z,{children:(0,Be.tZ)(c.Z,{children:(0,Be.BX)(te.ZP,{container:!0,spacing:1,children:[(0,Be.tZ)(te.ZP,{item:!0,children:(0,Be.tZ)(P.Z,{disabled:!u||!g||!(0,C.Hm)(null==k?void 0:k.getDisplay(),g),color:u?"success":"warning",onClick:Q,startIcon:(0,Be.tZ)(Pr.Z,{}),children:"Calc Upgrade Priority"})}),(0,Be.tZ)(te.ZP,{item:!0,children:(0,Be.tZ)(D.Hn,{size:"small"})}),(0,Be.tZ)(te.ZP,{item:!0,children:(0,Be.tZ)(D.oX,{size:"small"})})]})})}),ne,p&&(0,Be.tZ)(rs.Z,{}),(0,Be.tZ)(d.Suspense,{fallback:(0,Be.tZ)(o.Z,{variant:"rectangular",sx:{width:"100%",height:600,minHeight:5e3}}),children:F.map(((e,t)=>{var n;return(0,Be.tZ)(s.Z,{children:(0,Be.tZ)(ns,{upgradeOpt:e,thresholds:null!=(n=null==j?void 0:j.thresholds)?n:[],objMax:Y,objMin:U,calcExactCallback:()=>{const e=5*H+t;null==j||j.calcExact(e),A()}})},e.id)}))}),ne]})})]})}function os({numShowing:e,total:t}){return(0,Be.tZ)(F.Z,{color:"text.secondary",children:(0,Be.BX)(u.cC,{i18nKey:"showingNum",count:e,value:t,children:["Showing ",{count:e}," out of ",{value:t}," Artifacts"]})})}let cs,ds=e=>e;function us({tab:e,onClose:t}){const{teamChar:{key:n}}=(0,d.useContext)(x.V);return(0,Be.BX)(Be.HY,{children:[(0,Be.BX)(s.Z,{display:"flex",children:[(0,Be.BX)(s.Z,{display:"flex",gap:1,flexWrap:"wrap",flexGrow:1,children:[(0,Be.tZ)(vt,{}),(0,Be.tZ)(ps,{}),(0,Be.tZ)(De,{}),(0,Be.tZ)(ms,{})]}),!!t&&(0,Be.tZ)(Z.Z,{onClick:t})]}),(0,Be.BX)(s.Z,{display:"flex",gap:1,flexWrap:"wrap",children:[(0,Be.tZ)(D.Hn,{size:"small"}),(0,Be.tZ)(D.pg,{}),(0,Be.tZ)(D.oX,{size:"small"})]}),(0,Be.tZ)(K.Z,{children:(0,Be.tZ)(Zs,{tab:e,characterKey:n})}),(0,Be.tZ)(hs,{}),(0,Be.tZ)(K.Z,{children:(0,Be.tZ)(Zs,{tab:e,characterKey:n})})]})}function hs(){const{teamChar:{buildType:e,buildTcId:t}}=(0,d.useContext)(x.V),n=t&&"tc"===e;return(0,Be.tZ)(d.Suspense,{fallback:(0,Be.tZ)(o.Z,{variant:"rectangular",width:"100%",height:500}),children:(0,Be.BX)(h.Z5,{children:[n?(0,Be.tZ)(h.AW,{path:"/:characterKey/*",element:(0,Be.tZ)(jr,{})}):(0,Be.tZ)(h.AW,{path:"/:characterKey/*",element:(0,Be.tZ)(hl,{})}),(0,Be.tZ)(h.AW,{path:"/:characterKey/talent",element:(0,Be.tZ)(bl,{})}),(0,Be.tZ)(h.AW,{path:"/:characterKey/teambuffs",element:(0,Be.tZ)(Tl,{})}),!n&&(0,Be.tZ)(h.AW,{path:"/:characterKey/optimize",element:(0,Be.tZ)(Ha,{})}),C.dG&&(0,Be.tZ)(h.AW,{path:"/:characterKey/upopt",element:(0,Be.tZ)(ss,{})})]})})}function Zs({tab:e,characterKey:t}){const{t:n}=(0,u.$G)("page_character"),{teamChar:{buildType:i,buildTcId:a}}=(0,d.useContext)(x.V),l=a&&"tc"===i;return(0,Be.BX)(E.Z,{value:e,variant:"fullWidth",allowScrollButtonsMobile:!0,sx:{"& .MuiTab-root:hover":{transition:"background-color 0.25s ease",backgroundColor:"rgba(255,255,255,0.1)"}},children:[l?(0,Be.tZ)(j.Z,{value:"overview",label:n("tabs.theorycraft"),icon:(0,Be.tZ)(B.Z,{}),component:M.rU,to:`${t}/`}):(0,Be.tZ)(j.Z,{value:"overview",label:n("tabs.overview"),icon:(0,Be.tZ)(k.Z,{}),component:M.rU,to:`${t}/`}),(0,Be.tZ)(j.Z,{value:"talent",label:n("tabs.talent"),icon:(0,Be.tZ)(S.Z,{}),component:M.rU,to:`${t}/talent`}),(0,Be.tZ)(j.Z,{value:"teambuffs",label:n("tabs.teambuffs"),icon:(0,Be.tZ)(X.Z,{}),component:M.rU,to:`${t}/teambuffs`}),!l&&(0,Be.tZ)(j.Z,{value:"optimize",label:n("tabs.optimize"),icon:(0,Be.tZ)(T.Z,{}),component:M.rU,to:`${t}/optimize`}),!l&&C.dG&&(0,Be.tZ)(j.Z,{value:"upopt",label:n("tabs.upgradeopt"),icon:(0,Be.tZ)(T.Z,{}),component:M.rU,to:`${t}/upopt`})]})}function ps(){const{t:e}=(0,u.$G)("page_character"),[t,n,i]=(0,w.aV)(),{teamChar:{bonusStats:a}}=(0,d.useContext)(x.V),l=Object.keys(a).length;return(0,Be.BX)(Be.HY,{children:[(0,Be.BX)(P.Z,{color:"info",startIcon:(0,Be.tZ)(O.Z,{}),onClick:n,children:[e(cs||(cs=ds`addStats.title`)),!!l&&(0,Be.tZ)(A.Z,{sx:{ml:1},color:"success",children:l})]}),(0,Be.tZ)($t,{open:t,onClose:i})]})}function ms(){const{onModalOpen:e}=(0,d.useContext)(f.M);return(0,Be.BX)(Be.HY,{children:[(0,Be.BX)(P.Z,{color:"info",startIcon:(0,Be.tZ)(I.Z,{}),onClick:e,children:["Formulas ","&"," Calcs"]}),(0,Be.tZ)(He,{})]})}var fs=n(11559),gs=n(80680);function xs(){var e,t;const n=(0,h.s0)(),a=(0,l.Wz)(),{params:{teamId:o,tab:c="overview",characterKey:d}}=null!=(e=(0,h.bS)({path:"/teams/:teamId/:characterKey/:tab",end:!1}))?e:{params:{teamId:"",tab:"overview",characterKey:""}},u=null!=(t=a.teams.get(o))?t:{teamCharIds:[]},{teamCharIds:Z}=u,{gender:p}=(0,l.Hz)();return(0,Be.tZ)(s.Z,{children:(0,Be.tZ)(i.s8,{bgt:"light",children:(0,Be.tZ)(E.Z,{variant:"fullWidth",value:d,sx:{"& .MuiTab-root:hover":{transition:"background-color 0.25s ease",backgroundColor:"rgba(255,255,255,0.1)"}},children:(0,z.w6)(0,3).map((e=>{var t;const i=null==(t=a.teamChars.get(Z[e]))?void 0:t.key;return(0,Be.tZ)(j.Z,{icon:i?(0,Be.tZ)(gs.Z,{characterKey:i,sideMargin:!0}):(0,Be.tZ)(fs.Z,{}),iconPosition:"start",value:null!=i?i:e,disabled:!Z[e],label:i?(0,Be.tZ)(r.EE,{characterKey:i,gender:p}):`Character ${e+1}`,onClick:()=>n(`/teams/${o}/${i}/${c}`)},e)}))})})})}var bs=n(96703);function vs({teamId:e}){const t=(0,l.Wz)(),n=t.teams.get(e),a=n.teamCharIds.every((e=>!e)),[r,o]=(0,d.useState)(!!a),[u,h]=(0,d.useState)(n.name),p=(0,d.useDeferredValue)(u),[m,f]=(0,d.useState)(n.description),g=(0,d.useDeferredValue)(m);return(0,d.useEffect)((()=>{const{name:n,description:i}=t.teams.get(e);h(n),f(i)}),[t,e]),(0,d.useEffect)((()=>{t.teams.set(e,(e=>{e.name=p}))}),[t,p]),(0,d.useEffect)((()=>{t.teams.set(e,(e=>{e.description=g}))}),[t,g]),(0,Be.BX)(Be.HY,{children:[(0,Be.tZ)(s.Z,{display:"flex",gap:1,alignItems:"center",children:(0,Be.tZ)(i.eN,{title:(0,Be.tZ)(F.Z,{children:n.description}),children:(0,Be.tZ)(P.Z,{endIcon:(0,Be.tZ)(ol.Z,{}),onClick:()=>o((e=>!e)),children:(0,Be.tZ)(F.Z,{variant:"h6",children:n.name})})})}),(0,Be.tZ)(i.AB,{open:r,onClose:()=>o(!1),children:(0,Be.BX)(i.s8,{children:[(0,Be.tZ)(ye.Z,{title:"Team Settings",action:(0,Be.tZ)(Z.Z,{onClick:()=>o(!1)})}),(0,Be.tZ)(ge.Z,{}),(0,Be.BX)(c.Z,{sx:{display:"flex",flexDirection:"column",gap:2},children:[(0,Be.tZ)(ee.Z,{fullWidth:!0,label:"Team Name",placeholder:"Team Name",value:u,onChange:e=>h(e.target.value)}),(0,Be.tZ)(ee.Z,{fullWidth:!0,label:"Team Description",placeholder:"Team Description",value:m,onChange:e=>f(e.target.value),multiline:!0,rows:4}),(0,Be.tZ)(F.Z,{variant:"h6",children:"Team Editor"}),(0,Be.tZ)(Ct.Z,{severity:"info",variant:"filled",children:'The first character in the team received any "active on-field" character buffs.'}),(0,Be.tZ)(ys,{teamId:e})]})]})})]})}function ys({teamId:e}){var t;const n=(0,l.Wz)(),i=n.teams.get(e),{teamCharIds:a}=i,[r,s]=(0,d.useState)(void 0),o=null==(t=n.teamChars.get(a[r]))?void 0:t.key;return(0,Be.BX)(Be.HY,{children:[(0,Be.tZ)(d.Suspense,{fallback:!1,children:(0,Be.tZ)(bs.Z,{filter:e=>o!==(null==e?void 0:e.key),show:void 0!==r,onHide:()=>s(void 0),onSelect:t=>{if(void 0===r)return;const i=a.findIndex((e=>n.teamChars.get(e).key===t));if(i<0){if(a[r]){if(!window.confirm("Do you want to replace existing character with a new character? The loadouts and data on this existing character will be deleted."))return;const e=a[r];n.teamChars.remove(e)}const i=n.teamChars.new(t);n.teams.set(e,(e=>{e.teamCharIds[r]=i}))}else{if(r===i)return;if(a[r]){const t=a[i],l=a[r];n.teams.set(e,(e=>{e.teamCharIds[r]=t,e.teamCharIds[i]=l}))}}}})}),(0,z.w6)(0,3).map((t=>{return a[t]?(0,Be.tZ)(Cs,{teamCharId:a[t],onClick:()=>s(t),onClose:(i=t,()=>{if(!window.confirm("Do you want to delete this character? The loadouts and data on this character will be deleted."))return;const t=a[i];n.teams.set(e,(e=>{e.teamCharIds[i]=void 0})),n.teamChars.remove(t)})},t):(0,Be.tZ)(P.Z,{onClick:()=>s(t),fullWidth:!0,sx:{height:"100%"},disabled:t!==a.length,startIcon:(0,Be.tZ)(L.Z,{}),children:"Add Character"},t);var i}))]})}function Cs({teamCharId:e,onClick:t,onClose:n}){const i=(0,l.Wz)(),{key:a}=i.teamChars.get(e),{gender:s}=(0,l.Hz)();return(0,Be.BX)(Y.Z,{fullWidth:!0,sx:{height:"100%",alignItems:"stretch"},children:[(0,Be.tZ)(P.Z,{onClick:t,color:"success",startIcon:(0,Be.tZ)(gs.Z,{characterKey:a}),children:(0,Be.tZ)(r.EE,{characterKey:a,gender:s})}),(0,Be.tZ)(P.Z,{onClick:n,color:"error",sx:{flexBasis:"0"},children:(0,Be.tZ)(_l.Z,{})})]})}function ws(){const e=(0,h.s0)(),t=(0,l.Wz)(),n=(0,d.useCallback)((()=>e("/teams")),[e]),{teamId:i}=(0,h.UO)();return!t.teams.keys.includes(i)?(0,Be.tZ)(h.Fg,{to:"/characters"}):(0,Be.tZ)(s.Z,{my:1,display:"flex",flexDirection:"column",gap:1,children:(0,Be.tZ)(d.Suspense,{fallback:(0,Be.tZ)(o.Z,{variant:"rectangular",width:"100%",height:1e3}),children:i&&(0,Be.tZ)(Ss,{teamId:i,onClose:n})})})}const Bs=["overview","talent","teambuffs","optimize"];C.dG&&Bs.push("upopt");const ks=["overview","talent","teambuffs"];function Ss({teamId:e,onClose:t}){var n,o;const p=(0,h.s0)(),{silly:m}=(0,d.useContext)(r.E6),f=(0,l.Wz)(),{gender:g}=(0,l.Hz)(),x=(0,l.t7)(e),{teamCharIds:b}=x,{params:{characterKey:v}}=null!=(n=(0,h.bS)({path:"/teams/:teamId/:characterKey",end:!1}))?n:{params:{}},{params:{tab:C}}=null!=(o=(0,h.bS)({path:"/teams/:teamId/:characterKey/:tab",end:!1}))?o:{params:{}},{characterKey:w,teamCharId:B}=(0,d.useMemo)((()=>{var e,t;const n=null!=(e=b.find((e=>{var t;return(null==(t=f.teamChars.get(e))?void 0:t.key)===v})))?e:b[0];return{characterKey:null==(t=f.teamChars.get(n))?void 0:t.key,teamCharId:n}}),[b,v,f]),k=(0,l.rX)(B),S=(0,d.useMemo)((()=>{if(!k)return"overview";if("tc"===k.buildType){if(!ks.includes(C))return"overview"}else if(!Bs.includes(C))return"overview";return C}),[k,C]);(0,d.useEffect)((()=>{w&&(v===w&&S===C||p(`/teams/${e}/${w}/${S}`))}),[f,w,v,p,b,S,e,C]);const{t:X}=(0,u.$G)(["sillyWisher_charNames","charNames_gen","page_character"]);return(0,y.Z)((0,d.useMemo)((()=>`${x.name} - ${X(`${m?"sillyWisher_charNames":"charNames_gen"}:${(0,a.Cs)(w,g)}`)} - ${X(`page_character:tabs.${S}`)}`),[X,x.name,m,w,g,S])),(0,Be.tZ)(i.s8,{children:(0,Be.BX)(c.Z,{sx:{display:"flex",flexDirection:"column",gap:1},children:[(0,Be.BX)(s.Z,{sx:{display:"flex",gap:1},children:[(0,Be.tZ)(s.Z,{flexGrow:1,children:(0,Be.tZ)(vs,{teamId:e})}),(0,Be.tZ)(Z.Z,{onClick:t})]}),(0,Be.tZ)(xs,{}),w&&x&&k&&(0,Be.tZ)(Os,{characterKey:w,teamCharId:B,teamId:e,team:x,teamChar:k,tab:S})]})})}const Xs={},Ts={};function Os({characterKey:e,teamCharId:t,teamChar:n,teamId:i,team:a,tab:r}){const{gender:s}=(0,l.Hz)(),c=(0,b.m)(e,s),u=(0,l.AU)(e),h=(0,d.useMemo)((()=>{if(u&&c)return{teamId:i,team:a,teamCharId:t,teamChar:n,character:u,characterSheet:c}}),[i,a,t,n,u,c]),Z=(0,d.useMemo)((()=>u&&c&&{character:u,characterSheet:c}),[u,c]),[m,v]=(0,d.useState)(Xs[t]),[y,C]=(0,d.useState)(Ts[t]);(0,d.useEffect)((()=>{v(Xs[t]),C(Ts[t])}),[t,v,C]);const w=(0,d.useMemo)((()=>({chartData:m,setChartData:e=>{Xs[t]=e,v(e)},graphBuilds:y,setGraphBuilds:e=>{Ts[t]=e,C(e)}})),[t,m,y,v,C]);return h&&w&&Z?(0,Be.tZ)(x.V.Provider,{value:h,children:(0,Be.tZ)(p.K.Provider,{value:Z,children:(0,Be.tZ)(Is,{children:(0,Be.tZ)(g.V.Provider,{value:w,children:(0,Be.tZ)(f.B,{children:(0,Be.tZ)(us,{tab:r})})})})})}):(0,Be.tZ)(o.Z,{variant:"rectangular",width:"100%",height:1e3})}function Is({children:e}){var t;const{teamChar:{key:n}}=(0,d.useContext)(x.V),i=(0,v.ZP)(),{target:a}=null!=(t=null==i?void 0:i[n])?t:{},l=(0,d.useMemo)((()=>{if(i&&a)return{data:a,teamData:i,oldData:void 0}}),[a,i]);return l?(0,Be.tZ)(m.R.Provider,{value:l,children:e}):(0,Be.tZ)(o.Z,{variant:"rectangular",width:"100%",height:1e3})}}}]);