import{b as D,aN as N,d as r,ar as Z,aO as ee,u as ae,ak as te,a5 as re,U as se,p as C,q as t,C as ne,O as c,Q as M,v as oe,B as ce,$ as W,k as ie,h as le,f as he,e as pe,aP as ue,aQ as me}from"./index-d2bd73a8.js";import{u as de,f as ge,s as fe,a as ye,T as Ce,S as we,d as xe}from"./LocationName-8fabc1d3.js";import{E as Te,C as Se,a as be,c as j,b as ke,d as ve,e as Ee,f as Ke}from"./CharacterRarityToggle-c08bd9e8.js";import{W as Me}from"./WeaponCard-11d951ff.js";import{c as w}from"./totalUtils-1d218385.js";import"./DropdownButton-946e0473.js";import"./index-3c15b4cf.js";import"./TeamCard-20edd5f9.js";import"./Info-2798d638.js";import"./DataContext-cacefef8.js";import"./util-3e22b532.js";import"./SlotIcon-c7599013.js";import"./Trans-2c0d3bdf.js";import"./CardActionArea-f128b30d.js";import"./Close-05e97efb.js";import"./WeaponEditor-811a38b9.js";import"./LocationAutocomplete-495d8512.js";import"./Help-92b1044e.js";import"./CheckBoxOutlineBlank-c2081ce2.js";import"./InfoTooltip-a9764a41.js";import"./CardHeader-71033f61.js";import"./ArtifactSort-bd4b5139.js";import"./ChevronRight-114d1cc6.js";import"./SolidToggleButtonGroup-11d33bce.js";import"./WeaponSelectionModal-6247c36b.js";import"./Settings-2d1b7889.js";function We(){const a=D(),i=N();return r.useCallback(p=>{a.chars.get(p)||a.chars.getWithInitWeapon(p),i(`/characters/${p}`)},[i,a])}const De={xs:1,sm:2,md:3,lg:4,xl:4},Ne={xs:5,sm:8,md:9,lg:12,xl:12},je=Object.keys(j);function na(){const a=D(),i=N(),{params:{characterKey:l}}=Z({path:"/characters/:characterKey",end:!1})??{params:{}},p=r.useMemo(()=>l?ee(l)?(a.chars.get(l)||a.chars.getWithInitWeapon(l),l):(i("/characters"),null):null,[l,i,a]),{t:u}=ae(["page_character","sillyWisher_charNames","charNames_gen"]),{silly:g}=r.useContext(te),[x,T]=r.useState(()=>a.displayCharacter.get());r.useEffect(()=>a.displayCharacter.follow((e,n)=>T(n)),[a,T]);const[S,F]=r.useState(""),b=r.useDeferredValue(S),O=de(),[I,k]=r.useState(!1),[P,m]=re();r.useEffect(()=>(se.send({hitType:"pageview",page:"/characters"}),a.chars.followAny((e,n)=>(n==="new"||n==="remove")&&m())),[m,a]),r.useEffect(()=>a.charMeta.followAny(e=>m()),[m,a]);const _=We(),v=r.useDeferredValue(x),E=r.useDeferredValue(P),{charKeys:s,totalCharNum:f}=r.useMemo(()=>{const n=a.chars.keys.length,{element:h,weaponType:o,rarity:d,sortType:L,ascending:X}=v,Y=a.chars.keys.filter(ge({element:h,weaponType:o,rarity:d,name:b},ke(a,g))).sort(fe(j[L]??[],X,ve(a,g),["new","favorite"]));return E&&{charKeys:Y,totalCharNum:n}},[a,v,b,g,E]),{weaponType:$,element:A,rarity:B,sortType:R,ascending:z}=x,U=r.useMemo(()=>w(le,e=>Object.entries(a.chars.data).forEach(([n,h])=>{const o=a.weapons.get(h.equippedWeapon);if(!o)return;const d=ie(o.key).weaponType;e[d].total++,s.includes(n)&&e[d].current++})),[a,s]),G=r.useMemo(()=>w(pe,e=>Object.entries(a.chars.data).forEach(([n,h])=>{const o=he(h.key);e[o].total++,s.includes(n)&&e[o].current++})),[a,s]),Q=r.useMemo(()=>w(me,e=>Object.entries(a.chars.data).forEach(([n,h])=>{const o=ue(h.key).rarity;e[o].total++,s.includes(n)&&e[o].current++})),[a,s]),{numShow:K,setTriggerElement:V}=ye(Ne[O],s.length),y=r.useMemo(()=>s.slice(0,K),[s,K]),q=s.length!==f?`${s.length}/${f}`:`${f}`,H={numShowing:y.length,total:q,t:u,namespace:"page_character"},J={sortKeys:[...je],value:R,onChange:e=>a.displayCharacter.set({sortType:e}),ascending:z,onChangeAsc:e=>a.displayCharacter.set({ascending:e})};return C(M,{my:1,display:"flex",flexDirection:"column",gap:1,children:[p&&t(Ee,{characterKey:p,onClose:()=>i("/characters")}),t(r.Suspense,{fallback:!1,children:t(Ke,{newFirst:!0,show:I,onHide:()=>k(!1),onSelect:_})}),t(oe,{children:C(ne,{sx:{display:"flex",flexDirection:"column",gap:1},children:[C(c,{container:!0,spacing:1,children:[t(c,{item:!0,children:t(Me,{sx:{height:"100%"},onChange:e=>a.displayCharacter.set({weaponType:e}),value:$,totals:U,size:"small"})}),t(c,{item:!0,children:t(Te,{sx:{height:"100%"},onChange:e=>a.displayCharacter.set({element:e}),value:A,totals:G,size:"small"})}),t(c,{item:!0,children:t(Se,{sx:{height:"100%"},onChange:e=>a.displayCharacter.set({rarity:e}),value:B,totals:Q,size:"small"})}),t(c,{item:!0,flexGrow:1}),t(c,{item:!0,children:t(Ce,{autoFocus:!0,value:S,onChange:e=>F(e.target.value),label:u("characterName"),size:"small",sx:{height:"100%"},InputProps:{sx:{height:"100%"}}})})]}),t(M,{display:"flex",justifyContent:"space-between",alignItems:"flex-end",flexWrap:"wrap",children:t(we,{showingTextProps:H,sortByButtonProps:J})})]})}),t(ce,{fullWidth:!0,onClick:()=>k(!0),color:"info",startIcon:t(xe,{}),children:u`addNew`}),t(r.Suspense,{fallback:t(W,{variant:"rectangular",sx:{width:"100%",height:"100%",minHeight:5e3}}),children:t(c,{container:!0,spacing:1,columns:De,children:y.map(e=>t(c,{item:!0,xs:1,children:t(be,{characterKey:e,onClick:()=>i(`${e}`),hideStats:!0})},e))})}),s.length!==y.length&&t(W,{ref:e=>{e&&V(e)},sx:{borderRadius:1},variant:"rectangular",width:"100%",height:100})]})}export{na as default};
