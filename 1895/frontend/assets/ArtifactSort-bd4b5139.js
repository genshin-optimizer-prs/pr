import{b as le,q as n,bx as L,r as Se,i as ke,j as Ee,$ as B,d as x,u as F,p as d,T as y,a2 as fe,Y as we,Q as h,a7 as _e,ac as W,d6 as M,a9 as Z,c1 as Ce,t as Ae,a8 as J,cJ as Re,bf as Ke,C as Me,B as se,a3 as Te,a1 as De,ce as ue,d7 as Le,bi as ce,bL as $e,c2 as de,bh as Ie,d8 as je,d9 as Ve,_ as qe,s as Oe,bg as ze,da as Pe,aD as Be,d2 as Fe,db as We,dc as Ge,dd as He,l as Ne}from"./index-d2bd73a8.js";import{j as Ue,b as Je,C as Qe,m as Ye,v as Xe}from"./LocationName-8fabc1d3.js";import{d as he}from"./Info-2798d638.js";import{S as Ze}from"./SlotIcon-c7599013.js";import{b as et}from"./util-3e22b532.js";import{d as tt,L as nt,a as it,b as rt}from"./LocationAutocomplete-495d8512.js";import{C as at}from"./CardActionArea-f128b30d.js";function ot(t=""){const i=le();return Ue(i.arts,t)}function st(t){return n(L,{placement:"top",...t,children:n(he,{sx:{cursor:"help"}})})}function ct(t){return n(L,{placement:"top",...t,children:n(he,{fontSize:"inherit",sx:{cursor:"help",verticalAlign:"-10%"}})})}var ee={},lt=ke;Object.defineProperty(ee,"__esModule",{value:!0});var ft=ee.default=void 0,ut=lt(Se()),dt=Ee,ht=(0,ut.default)((0,dt.jsx)("path",{d:"M18 23H4c-1.1 0-2-.9-2-2V7h2v14h14v2zM15 1H8c-1.1 0-1.99.9-1.99 2L6 17c0 1.1.89 2 1.99 2H19c1.1 0 2-.9 2-2V7l-6-6zm1.5 14h-6v-2h6v2zm0-6h-2v2h-2V9h-2V7h2V5h2v2h2v2z"}),"Difference");ft=ee.default=ht;function Kt({children:t,setKey:i,numInSet:e=5}){return n(L,{placement:"top",title:n(pe,{setKey:i,numInSet:e}),disableInteractive:!0,children:t})}function pe({setKey:t,numInSet:i=5}){return n(x.Suspense,{fallback:n(B,{variant:"rectangular",width:100,height:100}),children:n(pt,{numInSet:i,setKey:t})})}function pt({setKey:t,numInSet:i=5}){const{t:e}=F("sheet"),a=Je(t);return n(_e,{spacing:2,sx:{p:1},children:Object.keys(a.setEffects).map(r=>d(h,{sx:{opacity:parseInt(r)<=i?1:.5},children:[n(y,{children:n(fe,{color:"success",children:e(`${r}set`)})}),n(y,{children:n(we,{ns:`artifact_${r}_gen`,key18:`setEffects.${r}`})})]},r))})}function P({value:t,max:i=1,valid:e}){const[a,r]=typeof t=="number"?[`roll${W(Math.floor(t/i*10)-4,1,6)}`,(t*100).toFixed()+"%"]:["secondary",t];return n(fe,{color:e?a:"error",children:r})}const yt=x.lazy(()=>De(()=>import("./ArtifactEditor-240c5a9f.js"),["./ArtifactEditor-240c5a9f.js","./index-d2bd73a8.js","./index-c46e4d2e.css","./DropdownButton-946e0473.js","./ArtifactRarityDropdown-96882024.js","./LocationName-8fabc1d3.js","./index-3c15b4cf.js","./ArtifactStatKeyDisplay-15fe09a1.js","./util-3e22b532.js","./Close-05e97efb.js","./Help-92b1044e.js","./LockOpen-ff92da7a.js","./SlotIcon-c7599013.js","./Replay-cf19cbed.js","./LocationAutocomplete-495d8512.js","./InfoTooltip-a9764a41.js","./Info-2798d638.js","./TextButton-716871be.js","./CardHeader-71033f61.js","./ChevronRight-114d1cc6.js","./CardActionArea-f128b30d.js"],import.meta.url)),mt=new Set(Z);function Mt({artifactId:t,artifactObj:i,onClick:e,onDelete:a,mainStatAssumptionLevel:r=0,effFilter:s=mt,editorProps:l,canEquip:p=!1,extraButtons:S}){var oe;const{t:c}=F(["artifact","ui"]),{t:b}=F("statKey_gen"),g=le(),k=ot(t),o=(oe=i??k)==null?void 0:oe.setKey,f=x.useCallback(m=>t&&g.arts.set(t,{location:m}),[g,t]),u=!i,[w,_]=x.useState(!1),E=x.useCallback(()=>_(!1),[_]),I=x.useCallback(()=>u&&_(!0),[u,_]),G=x.useCallback(m=>n(at,{onClick:()=>t&&(e==null?void 0:e(t)),sx:{flexGrow:1,display:"flex",flexDirection:"column"},children:m}),[e,t]),H=x.useCallback(m=>n(h,{sx:{flexGrow:1,display:"flex",flexDirection:"column"},children:m}),[]),v=i??k,{currentEfficiency:C,maxEfficiency:A,currentEfficiency_:R,maxEfficiency_:N}=x.useMemo(()=>{if(!v)return{currentEfficiency:0,maxEfficiency:0,currentEfficiency_:0,maxEfficiency_:0};const{currentEfficiency:m,maxEfficiency:ge}=M(v,s),{currentEfficiency:be,maxEfficiency:ve}=M(v,new Set(Z));return{currentEfficiency:m,maxEfficiency:ge,currentEfficiency_:be,maxEfficiency_:ve}},[v,s]);if(!v)return null;const{id:te,lock:j,slotKey:T,setKey:U,rarity:D,level:V,mainStatKey:q,substats:me,location:ne=""}=v,ie=Math.max(Math.min(r,D*4),V),O=A!==0,z=n(je,{setKey:U,slotKey:T}),re=n(Ve,{setKey:U,slotKey:T}),ae=re&&n(st,{title:d(h,{children:[n(y,{variant:"h6",children:z}),n(y,{children:re})]})}),xe=Ce.find(m=>q.startsWith(m));return d(x.Suspense,{fallback:n(B,{variant:"rectangular",sx:{width:"100%",height:"100%",minHeight:350}}),children:[l&&n(x.Suspense,{fallback:!1,children:n(yt,{artifactIdToEdit:w?t:"",cancelEdit:E,...l})}),d(Ae,{sx:{height:"100%",display:"flex",flexDirection:"column"},children:[d(Qe,{condition:!!e,wrapper:G,falseWrapper:H,children:[d(h,{className:`grad-${D}star`,sx:{position:"relative",width:"100%"},children:[!e&&n(qe,{color:"primary",disabled:!u,onClick:()=>g.arts.set(te,{lock:!j}),sx:{position:"absolute",right:0,bottom:0,zIndex:2},children:j?n(nt,{}):n(it,{})}),d(h,{sx:{pt:2,px:2,position:"relative",zIndex:1},children:[d(h,{component:"div",sx:{display:"flex",alignItems:"center",gap:.4,mb:1},children:[n(Oe,{size:"small",label:n("strong",{children:` +${V}`}),color:et(V)}),!z&&n(B,{variant:"text",width:100}),z&&n(y,{noWrap:!0,sx:{textAlign:"center",backgroundColor:"rgba(100,100,100,0.35)",borderRadius:"1em",px:1.5},children:n("strong",{children:z})}),ae||n(B,{width:10})]}),d(y,{color:"text.secondary",variant:"body2",sx:{display:"flex",gap:.5,alignItems:"center"},children:[n(Ze,{iconProps:{fontSize:"inherit"},slotKey:T}),c(`slotName.${T}`)]}),d(y,{variant:"h6",sx:{display:"flex",alignItems:"center",gap:1},children:[n(de,{statKey:q,iconProps:{sx:{color:`${xe}.main`}}}),n("span",{children:b(q)})]}),n(y,{variant:"h5",children:n("strong",{children:n(J,{color:ie!==V?"warning":void 0,children:Re(q,D,ie)})})}),n(Ye,{stars:D,colored:!0})]}),n(h,{sx:{height:"100%",position:"absolute",right:0,top:0},children:n(h,{component:"img",src:Ke(U,T),width:"auto",height:"110%",sx:{float:"right",marginBottom:"-5%",marginTop:"-5%",marginRight:"-5%"}})})]}),d(Me,{sx:{flexGrow:1,display:"flex",flexDirection:"column",pt:1,pb:"0!important",width:"100%"},children:[me.map(m=>!!m.value&&n(xt,{stat:m,effFilter:s,rarity:D},m.key)),d(y,{variant:"caption",sx:{display:"flex",gap:1,alignItems:"center"},children:[n(J,{color:"secondary",sx:{flexGrow:1},children:c`artifact:editor.curSubEff`}),n(P,{value:C,max:9,valid:O}),C!==R&&n("span",{children:"/"}),C!==R&&n(P,{value:R,max:9,valid:O})]}),C!==A&&d(y,{variant:"caption",sx:{display:"flex",gap:1},children:[n(J,{color:"secondary",sx:{flexGrow:1},children:c`artifact:editor.maxSubEff`}),n(P,{value:A,max:9,valid:O}),A!==N&&n("span",{children:"/"}),A!==N&&n(P,{value:N,max:9,valid:O})]}),n(h,{flexGrow:1}),v.probability!==void 0&&v.probability>=0&&d("strong",{children:["Probability: ",(v.probability*100).toFixed(2),"%"]}),d(y,{color:"success.main",children:[o&&n(ze,{setKey:o})||"Artifact Set"," ",o&&n(ct,{title:n(pe,{setKey:o})})]})]})]}),d(h,{sx:{p:1,display:"flex",gap:1,justifyContent:"space-between",alignItems:"center"},children:[n(h,{sx:{flexGrow:1},children:u&&p?n(rt,{location:ne,setLocation:f}):n(Xe,{location:ne})}),d(h,{display:"flex",gap:1,alignItems:"stretch",height:"100%",sx:{"& .MuiButton-root":{minWidth:0,height:"100%"}},children:[u&&l&&n(L,{title:n(y,{children:c`artifact:edit`}),placement:"top",arrow:!0,children:n(se,{color:"info",size:"small",onClick:I,children:n(tt,{})})}),u&&!!a&&n(L,{title:j?c("artifact:cantDeleteLock"):"",placement:"top",children:n("span",{children:n(se,{color:"error",size:"small",onClick:()=>a(te),disabled:j,children:n(Te,{})})})}),S]})]})]})]})}function xt({stat:t,effFilter:i,rarity:e}){var f;const{t:a}=F("statKey_gen"),r=((f=t.rolls)==null?void 0:f.length)??0,s=t.key?ue(t.key):0,l=x.useMemo(()=>t.key?Le(t.key,e):[],[t.key,e]),p=7-l.length,S=`roll${W(r,1,6)}`,c=t.efficiency??0,b=t.key&&i.has(t.key),g=Pe(.5+c/5*.5),k=ce(t.key),o=x.useMemo(()=>n(h,{display:"flex",gap:.25,height:"1.3em",sx:{opacity:b?1:.3},children:[...t.rolls].sort().map((u,w)=>n(gt,{value:100*u/s,color:`roll${W(p+l.indexOf(u),1,6)}.main`},`${w}${u}`))}),[b,t.rolls,s,l,p]);return d(h,{display:"flex",gap:1,alignContent:"center",children:[d(y,{sx:{flexGrow:1},color:r?`${S}.main`:"error.main",component:"span",children:[n(de,{statKey:t.key,iconProps:$e})," ",a(t.key),`+${Ie(t.value,ce(t.key))}${k}`]}),o,d(y,{sx:{opacity:g,minWidth:40,textAlign:"right"},children:[(c*100).toFixed(),"%"]})]})}function gt({color:t="red",value:i=50}){return n(h,{sx:{width:7,height:"100%",bgcolor:t,overflow:"hidden",borderRadius:1,display:"inline-block"},children:n(h,{sx:{width:10,height:`${100-W(i,0,100)}%`,bgcolor:"gray"}})})}const Y=[3,4,6],Q={hp:6,atk:6,def:6,hp_:4,atk_:4,def_:4,eleMas:4,enerRech_:4,critRate_:3,critDMG_:3},ye={};function $(t,i,e,a){if(t.length===5){We(ye,t,a);return}for(const r of Y)i[r]>0&&$([...t,r],{...i,[r]:i[r]-r},e-r,a*i[r]/e)}$([0],{3:6,4:20,6:18},44,1);$([3],{3:3,4:20,6:18},41,1);$([4],{3:6,4:16,6:18},40,1);$([6],{3:6,4:20,6:12},38,1);const X=Array(6).fill(0).map((t,i)=>{const e=[1];let a=0,r=1;for(;++a<=i;)r*=i-a+1,r/=a,e.push(r);return e}),K=[[1]];for(;K.length<6;){const t=K[K.length-1],i=Array(t.length+3).fill(0);t.forEach((e,a)=>{for(const r of[0,1,2,3])i[a+r]+=e}),K.push(i.map(e=>e/4))}for(const t of K){let i=t.reduce((e,a)=>e+a);t.forEach((e,a,r)=>{r[a]=i,i-=e})}function bt(t,i){if(t.rarity<=2)return NaN;const{rarity:e,level:a,substats:r}=t,s={...i},l=new Set(Object.keys(s));let p=0;{const o=t.mainStatKey;if(o in s){const f=e*4;if(Be.art.main[e][o][f]<s[o])return 0;delete s[o],l.delete(o)}}for(const{key:o,value:f}of r)o?l.has(o)&&(l.delete(o),s[o]>f?s[o]-=f:delete s[o]):p+=1;if(p+=4-r.length,l.size>p||Object.keys(s).length>4)return 0;const S=Ge(a,e)-p;for(const[o,f]of Object.entries(s))s[o]=Math.max(Math.ceil(10*f/ue(o,e)),1);let c=0;const b=Object.entries(s).map(([o,f])=>{const u=l.has(o)?1:0,w=Math.ceil(f/10)-u;return c+=w,{target:f,filler:u,minUpgrade:w}}).reverse();if(c>S)return 0;let g={[S]:1};const k=S-c;return b.forEach(({target:o,filler:f,minUpgrade:u},w)=>{const _={};for(let E=u;E<=u+k;E++){const I=o-7*(E+f),G=I>0?K[E+f][I]:1;for(const[H,v]of Object.entries(g)){const C=parseInt(H);if(C<E)continue;const A=vt(C,E,4-w),R=C-E;_[R]=(_[R]??0)+v*G*A}}g=_}),St(t.mainStatKey,r,l)*Object.values(g).reduce((o,f)=>o+f)}function vt(t,i,e){return X[t][i]*Math.pow(e-1,t-i)/Math.pow(e,t)}function St(t,i,e){const a=Q[t]??0;let r=0;const s={3:2,4:5,6:3};let l=ye[a];for(const{key:c}of i)if(c){const b=Q[c];l=l[b],s[b]-=1}a&&(s[a]-=1);const p={3:0,4:0,6:0};for(const c of e)p[Q[c]]+=1;let S=0;Fe(l,[],c=>typeof c=="number",(c,b)=>{S+=c;const g={3:0,4:0,6:0};for(const o of b)g[o]+=1;let k=c;for(const o of Y){const f=g[o],u=p[o];if(f<u)return;k*=X[f][u]}r+=k});for(const c of Y)r/=X[s[c]][p[c]];return r/S}const Tt=["rarity","level","artsetkey","efficiency","mefficiency","probability"];function Dt(){return{artSetKeys:[],rarity:[...He],levelLow:0,levelHigh:20,slotKeys:[...Ne],mainStatKeys:[],substats:[],locations:[],showEquipped:!0,showInventory:!0,locked:["locked","unlocked"],rvLow:0,rvHigh:900,useMaxRV:!1,lines:[1,2,3,4]}}function Lt(t,i){return{rarity:e=>e.rarity??0,level:e=>e.level??0,artsetkey:e=>e.setKey??"",efficiency:e=>M(e,t).currentEfficiency,mefficiency:e=>M(e,t).maxEfficiency,probability:e=>{if(!Object.keys(i).length)return 0;const a=e.probability;return a===void 0?bt(e,i):a}}}function $t(t=new Set(Z)){return{locked:(i,e)=>!(!e.includes("locked")&&i.lock||!e.includes("unlocked")&&!i.lock),locations:(i,e,a)=>i.location&&!a.showEquipped?e.includes(i.location):!0,showEquipped:()=>!0,showInventory:(i,e)=>i.location?!0:e,artSetKeys:(i,e)=>e.length?e.includes(i.setKey):!0,slotKeys:(i,e)=>e.includes(i.slotKey),mainStatKeys:(i,e)=>e.length?e.includes(i.mainStatKey):!0,levelLow:(i,e)=>e<=i.level,levelHigh:(i,e)=>e>=i.level,rvLow:(i,e,a)=>{if(e===0)return!0;e=e/100;const{useMaxRV:r}=a,{currentEfficiency:s,maxEfficiency:l}=M(i,t);return e<=(r?l:s)},rvHigh:(i,e,a)=>{if(e===900)return!0;e=e/100;const{useMaxRV:r}=a,{currentEfficiency:s,maxEfficiency:l}=M(i,t);return e>=(r?l:s)},useMaxRV:()=>!0,rarity:(i,e)=>e.includes(i.rarity),substats:(i,e)=>{for(const a of e)if(a&&!i.substats.some(r=>r.key===a))return!1;return!0},lines:(i,e)=>[0,...e].includes(i.substats.filter(a=>a.value).length)}}const It={level:["level","rarity","artsetkey"],rarity:["rarity","level","artsetkey"],artsetkey:["artsetkey","rarity","level"],efficiency:["efficiency"],mefficiency:["mefficiency"],probability:["probability"]};export{Mt as A,st as I,P,gt as S,Lt as a,$t as b,It as c,ft as d,Tt as e,Kt as f,Dt as i,bt as p,ot as u};
