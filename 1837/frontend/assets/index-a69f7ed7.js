import{u as G,d as V,f as t,a5 as H,U as L,ap as Q,p as d,q as o,C as J,Q as u,v as X,B as Y,O as I,R as Z,a1 as D,k as ee,aq as ae,$ as k}from"./index-59c4fd80.js";import{u as te,f as oe,s as ne,a as se,T as re,S as le,d as pe}from"./LocationName-f05c2951.js";import{W as ie,a as ce,b as de,w as R,c as ue,d as me}from"./WeaponCard-2b85e680.js";import{g as E}from"./index-714835cc.js";import{c as M}from"./totalUtils-18c8f1ab.js";import"./DropdownButton-dc3a36fa.js";import"./index-6873d20e.js";import"./index-b5c4e079.js";import"./SolidToggleButtonGroup-1f3f91b9.js";import"./useWeapon-9259db15.js";import"./LocationAutocomplete-b798426d.js";import"./CardActionArea-9ac53781.js";const fe=Z.lazy(()=>D(()=>import("./WeaponSelectionModal-799d21ab.js"),["./WeaponSelectionModal-799d21ab.js","./index-59c4fd80.js","./index-d208f3ec.css","./LocationName-f05c2951.js","./DropdownButton-dc3a36fa.js","./index-6873d20e.js","./index-b5c4e079.js","./Close-0fbb42e0.js","./index-714835cc.js","./totalUtils-18c8f1ab.js","./WeaponCard-2b85e680.js","./SolidToggleButtonGroup-1f3f91b9.js","./useWeapon-9259db15.js","./LocationAutocomplete-b798426d.js","./CardActionArea-9ac53781.js"],import.meta.url)),we=t.lazy(()=>D(()=>import("./WeaponEditor-155e3095.js").then(r=>r.e),["./WeaponEditor-155e3095.js","./index-59c4fd80.js","./index-d208f3ec.css","./LocationName-f05c2951.js","./DropdownButton-dc3a36fa.js","./index-6873d20e.js","./index-b5c4e079.js","./useWeapon-9259db15.js","./Close-0fbb42e0.js","./LocationAutocomplete-b798426d.js","./DataContext-01650a8c.js","./InfoTooltip-d6b18998.js","./Info-57ec9c83.js","./CheckBoxOutlineBlank-b8cbd9e4.js","./index-714835cc.js","./CardHeader-5fc0658f.js"],import.meta.url)),ge={xs:1,sm:2,md:3,lg:3,xl:4},he={xs:10,sm:12,md:24,lg:24,xl:24},ye=Object.keys(R);function De(){const{t:r}=G(["page_weapon","ui","weaponNames_gen"]),a=V(),[i,P]=t.useState(a.displayWeapon.get());t.useEffect(()=>a.displayWeapon.follow((e,n)=>P(n)),[a]);const[O,S]=t.useState(!1),[T,C]=H();t.useEffect(()=>(L.send({hitType:"pageview",page:"/weapon"}),a.weapons.followAny((e,n)=>(n==="new"||n==="remove")&&C())),[C,a]);const j=te(),A=t.useCallback(async e=>{const n=a.weapons.get(e);if(!n)return;const l=r(`weaponNames_gen:${n.key}`);window.confirm(r("removeWeapon",{value:l}))&&(a.weapons.remove(e),i.editWeaponId===e&&a.displayWeapon.set({editWeaponId:""}))},[i.editWeaponId,a,r]),m=t.useCallback(e=>{a.displayWeapon.set({editWeaponId:e})},[a]),F=t.useCallback(e=>{m(a.weapons.new(Q(e)))},[a,m]),[b,N]=t.useState(""),_=t.useDeferredValue(b),{sortType:f,ascending:w,weaponType:g,rarity:h}=i,{weaponIds:s,totalWeaponNum:y}=t.useMemo(()=>{const e=a.weapons.values,n=e.length,l=e.filter(oe({weaponType:g,rarity:h,name:_},ue())).sort(ne(R[f]??[],w,me())).map(p=>p.id);return T&&{weaponIds:l,totalWeaponNum:n}},[T,a,f,w,h,g,_]),{numShow:v,setTriggerElement:z}=se(he[j],s.length),W=t.useMemo(()=>s.slice(0,v),[s,v]),B=s.length!==y?`${s.length}/${y}`:`${y}`,x=t.useCallback(()=>a.displayWeapon.set({editWeaponId:""}),[a]),{editWeaponId:c}=i;t.useEffect(()=>{c&&(a.weapons.get(c)||x())},[a,c,x]);const $=t.useMemo(()=>M(ee,e=>Object.entries(a.weapons.data).forEach(([n,l])=>{const p=E(l.key).weaponType;e[p].total++,s.includes(n)&&e[p].current++})),[a,s]),K=t.useMemo(()=>M(ae,e=>Object.entries(a.weapons.data).forEach(([n,l])=>{const p=E(l.key).rarity;e[p].total++,s.includes(n)&&e[p].current++})),[a,s]),U={numShowing:W.length,total:B,t:r,namespace:"page_weapon"},q={sortKeys:[...ye],value:f,onChange:e=>a.displayWeapon.set({sortType:e}),ascending:w,onChangeAsc:e=>a.displayWeapon.set({ascending:e})};return d(u,{my:1,display:"flex",flexDirection:"column",gap:1,children:[o(t.Suspense,{fallback:!1,children:o(fe,{show:O,onHide:()=>S(!1),onSelect:F})}),o(t.Suspense,{fallback:!1,children:o(we,{weaponId:c,footer:!0,onClose:x})}),o(X,{children:d(J,{sx:{display:"flex",flexDirection:"column",gap:1},children:[d(u,{display:"flex",flexWrap:"wrap",gap:1,alignItems:"stretch",children:[o(ie,{onChange:e=>a.displayWeapon.set({weaponType:e}),value:g,totals:$,size:"small"}),o(ce,{sx:{height:"100%"},onChange:e=>a.displayWeapon.set({rarity:e}),value:h,totals:K,size:"small"}),o(u,{flexGrow:1}),o(re,{autoFocus:!0,size:"small",value:b,onChange:e=>N(e.target.value),label:r("weaponName"),sx:{height:"100%"},InputProps:{sx:{height:"100%"}}})]}),o(u,{display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",children:o(le,{showingTextProps:U,sortByButtonProps:q})})]})}),d(t.Suspense,{fallback:o(k,{variant:"rectangular",sx:{width:"100%",height:"100%",minHeight:500}}),children:[o(Y,{fullWidth:!0,onClick:()=>S(!0),color:"info",startIcon:o(pe,{}),children:r("page_weapon:addWeapon")}),o(I,{container:!0,spacing:1,columns:ge,children:W.map(e=>o(I,{item:!0,xs:1,children:o(de,{weaponId:e,onDelete:A,onEdit:m,canEquip:!0})},e))})]}),s.length!==W.length&&o(k,{ref:e=>{e&&z(e)},sx:{borderRadius:1},variant:"rectangular",width:"100%",height:100})]})}export{De as default};
