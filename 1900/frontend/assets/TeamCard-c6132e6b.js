import{b as D,u as K,bh as bt,bg as vt,p as c,q as e,by as P,T as u,bt as z,d as b,b_ as yt,cs as Ct,a2 as C,ae as St,O as h,_ as M,a5 as Dt,aB as j,af as _,cV as $t,aR as k,c6 as Tt,bT as It,r as H,i as O,j as E,v as I,bQ as jt,bf as kt,k as tt,I as _t,c9 as zt,cg as Bt,c8 as Wt,N as S,l as At,az as N,bd as wt,cW as Pt,ce as et,am as at,ba as nt,s as $,c7 as rt,a8 as Mt,f as st,W as Ht,Y as it,bc as Ot}from"./index-153af171.js";import{d as Et}from"./Info-3ef80394.js";import{I as B,Z as Nt,U as R,b as Rt,$ as qt,g as ot,K as Ft,z as Q,M as Lt,N as Vt,a0 as Ut,D as ct,P as Gt,Q as Qt,a1 as Yt,l as Y,e as Z,x as y,C as lt,R as Zt}from"./index-5a321f82.js";import{b as Jt,D as W}from"./getDisplayUtil-3cb641eb.js";import{u as Xt,W as Kt,a as te,c as ee,r as ae,n as ne}from"./uiData-3df78ec3.js";import{S as q}from"./StatIcon-5f31f8b4.js";import{S as re}from"./SlotIcon-86010403.js";import{b as dt}from"./util-3e22b532.js";import{i as F}from"./index-d4d223e1.js";import{C as T}from"./CardActionArea-d8213cc1.js";function se(t){const a=/^#?([a-f\d])([a-f\d])([a-f\d])$/i;t=t.replace(a,(s,i,o,r)=>i+i+o+o+r+r);const n=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return n?{r:parseInt(n[1],16),g:parseInt(n[2],16),b:parseInt(n[3],16)}:null}function Je(t,a){if(t)return`rgba(${t.r},${t.g},${t.b},${a})`}function ie(t){const a=D();return B(a.charMeta,t)}function ut(t){const a=D();return B(a.chars,t)}function oe(t){const a=D();return B(a.teams,t)}function ce(t){const a=D();return B(a.teamChars,t)}function le({statKey:t,value:a,color:n,prefix:s="",typographyProps:i={}}){const{t:o}=K("statKey_gen"),r=bt(t),l=vt(a,r);return c(u,{color:n?`${n}.main`:void 0,...i,children:[e(q,{statKey:t,iconProps:P})," ",o(t)," ",e("strong",{children:`${s}${l}${r}`})]},t)}function de({art:t,children:a}){const n=e(h,{children:e(M,{variant:"rectangular",width:100,height:100})}),s=e(b.Suspense,{fallback:n,children:e(ue,{art:t})});return e(z,{placement:"top",title:s,disableInteractive:!0,children:a})}function ue({art:t}){const{t:a}=K("statKey_gen"),{setKey:n,slotKey:s,level:i,rarity:o,mainStatKey:r,substats:l}=t,p=yt.getVariant(r);return c(h,{p:1,children:[c(u,{variant:"h6",children:[e(re,{slotKey:s,iconProps:P})," ",e(Nt,{setKey:n,slotKey:s})]}),c(u,{variant:"subtitle1",color:`${p}.main`,children:[e(q,{statKey:r,iconProps:P})," ",a(r)," ",Ct(r,o,i)]}),c(u,{variant:"subtitle2",sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e(R,{stars:o}),c(C,{color:dt(i),children:["+",i]})," "]}),e(h,{py:1,children:l.map(({value:f,key:d,rolls:g})=>!!(f&&d)&&e(le,{statKey:d,value:f,color:`roll${St(g.length,1,6)}`,prefix:"+"},d))}),e(u,{color:"success.main",children:e(Rt,{setKey:n})}),e(qt,{color:"secondary.main",location:t.location})]})}function he(t,a=0,n,s){const i=D(),[o,r]=Dt(),l=b.useDeferredValue(o),{gender:p}=j(),f=b.useMemo(()=>l&&fe(i,t,a,p,n,s),[l,p,t,i,a,n,s]);return b.useEffect(()=>t?i.chars.follow(t,r):void 0,[t,r,i]),f}class pe{constructor(a){this.data={},a.chars.followAny(n=>{this.removeData(n)})}getData(a){return this.data[a]}cacheData(a,n){this.data[a]=n}removeData(a){delete this.data[a]}}const w=new Map,J=t=>{if(w.has(t))return w.get(t);const a=new pe(t);return w.set(t,a),a};function fe(t,a,n=0,s,i,o){if(!a)return;if(!n&&!i&&!o){const d=J(t).getData(a);if(d)return d}const{teamData:r,teamBundle:l}=me(t,a,n,i,o)??{};if(!r||!l)return;const p=Xt(r,s,a),f=_(p,(d,g)=>{const{data:x,...m}=l[g];return{...d,...m}});return!n&&!i&&!o&&J(t).cacheData(a,f),f}function me(t,a,n=0,s,i){if(!a)return;const o=t.chars.get(a);if(!o)return;const r=ge(t,!0,n,o,i||(t.weapons.get(o.equippedWeapon)??$t()),s??Object.values(o.equippedArtifacts).map(f=>t.arts.get(f)).filter(f=>f));if(!r)return;const l={[a]:r};return{teamData:{[a]:r.data},teamBundle:l}}function ge(t,a=!1,n,s,i,o){const r=Jt(s.key,t.gender);if(!r)return;const l=ot(i.key);if(!l)return;const p=Ft[k(s.key).weaponType],f=a?(()=>{const{display:m,...v}=l.data;return Q([v,p])})():l.data,d=Q([r.data,f,Lt]),x=[...Array.isArray(o)?o.map(m=>Vt(m,n)):[o],Ut(s),ct(i),d,Gt,Qt];return{character:s,weapon:i,characterSheet:r,weaponSheet:l,data:x}}function xe(t){const{artifact:{slots:a,substats:{stats:n},sets:s}}=t,i=_(n,(o,r)=>Tt(o,r));return Object.values(a).forEach(({statKey:o,rarity:r,level:l})=>i[o]=(i[o]??0)+It(o,r,l)),{art:_(i,(o,r)=>r.endsWith("_")?Yt(o):Y(o)),artSet:_(s,o=>Y(o))}}function Xe(t){const{weapon:{key:a,level:n,ascension:s,refinement:i}}=t;return{id:"",location:"",key:a,level:n,ascension:s,refinement:i,lock:!1}}var L={},be=O;Object.defineProperty(L,"__esModule",{value:!0});var ht=L.default=void 0,ve=be(H()),ye=E,Ce=(0,ve.default)((0,ye.jsx)("path",{d:"M16.5 3c-1.74 0-3.41.81-4.5 2.09C10.91 3.81 9.24 3 7.5 3 4.42 3 2 5.42 2 8.5c0 3.78 3.4 6.86 8.55 11.54L12 21.35l1.45-1.32C18.6 15.36 22 12.28 22 8.5 22 5.42 19.58 3 16.5 3zm-4.4 15.55-.1.1-.1-.1C7.14 14.24 4 11.39 4 8.5 4 6.5 5.5 5 7.5 5c1.54 0 3.04.99 3.57 2.36h1.87C13.46 5.99 14.96 5 16.5 5c2 0 3.5 1.5 3.5 3.5 0 2.89-3.14 5.74-7.9 10.05z"}),"FavoriteBorder");ht=L.default=Ce;function Se({artifactObj:t,slotKey:a}){if(!t)return e(I,{sx:{display:"flex",flexDirection:"column",height:"100%"},children:e(h,{sx:{width:"100%",pb:"100%",position:"relative"},children:e(h,{sx:{position:"absolute",width:"70%",height:"70%",left:"50%",top:"50%",transform:"translate(-50%, -50%)",opacity:.7},component:"img",src:F.slot[a]})})});const{mainStatKey:n,rarity:s,level:i}=t,r=jt.find(l=>t.mainStatKey.includes(l))??"secondary";return e(de,{art:t,children:c(I,{sx:{display:"flex",flexDirection:"column",position:"relative"},children:[e(h,{component:"img",className:`grad-${s}star`,src:kt(t.setKey,t.slotKey),maxWidth:"100%",maxHeight:"100%"}),e(u,{sx:{position:"absolute",fontSize:"0.75rem",lineHeight:1,opacity:.85,pointerEvents:"none"},children:e("strong",{children:e(C,{sx:{p:.5},color:dt(i),children:c("strong",{children:["+",i]})})})}),e(u,{sx:{position:"absolute",fontSize:"0.75rem",lineHeight:1,opacity:.85,pointerEvents:"none",bottom:0,right:0},children:e(C,{color:r,sx:{p:.5},children:e(q,{statKey:n,iconProps:{fontSize:"inherit"}})})})]})})}function De({weaponKey:t,addlText:a,children:n}){const s=c(b.Suspense,{fallback:e(M,{variant:"text",width:100}),children:[c(u,{children:[e(_t,{src:F.weaponTypes[tt(t).weaponType],size:1.5})," ",e(Kt,{weaponKey:t})]}),a]});return e(z,{placement:"top",title:s,disableInteractive:!0,children:n})}function $e({weaponId:t}){const a=te(t);return a?e(pt,{weapon:a}):null}function pt({weapon:t}){const a=(t==null?void 0:t.key)&&ot(t.key),n=b.useMemo(()=>a&&t&&ee([a.data,ct(t)]),[a,t]);if(!t||!a||!n)return null;const s=c(h,{children:[e(X,{node:n.get(Z.weapon.main)}),e(X,{node:n.get(Z.weapon.sub)})]});return c(I,{sx:{height:"100%",maxWidth:128,position:"relative",display:"flex",flexDirection:"column"},children:[e(h,{display:"flex",flexDirection:"column",alignContent:"flex-end",className:`grad-${tt(t.key).rarity}star`,children:e(De,{weaponKey:t.key,addlText:s,children:e(h,{component:"img",src:zt(t.key,t.ascension>=2),maxWidth:"100%",maxHeight:"100%",sx:{mt:"auto"}})})}),e(u,{sx:{position:"absolute",fontSize:"0.75rem",lineHeight:1,opacity:.85,pointerEvents:"none"},children:e("strong",{children:e(C,{color:"primary",children:Bt(t.level,t.ascension)})})}),Wt(t.key)&&e(u,{sx:{position:"absolute",fontSize:"0.75rem",lineHeight:1,opacity:.85,pointerEvents:"none",bottom:0,right:0},children:e("strong",{children:c(C,{color:"secondary",children:["R",t.refinement]})})})]})}function X({node:t}){const{icon:a}=ae(t.info);return c(u,{children:[a," ",ne(t)]})}function Te({hideWeapon:t=!1}){var n;const{data:a}=b.useContext(W);return e(h,{children:c(S,{container:!0,columns:t?5:6,spacing:.5,children:[!t&&e(S,{item:!0,xs:1,height:"100%",children:e($e,{weaponId:((n=a.get(y.weapon.id).value)==null?void 0:n.toString())??""})}),e(Ie,{})]})})}function Ie(){const t=D(),{data:a}=b.useContext(W),n=At.map(s=>{var i;return[s,t.arts.get(((i=a.get(y.art[s].id).value)==null?void 0:i.toString())??"")]});return e(N,{children:n.map(([s,i])=>e(S,{item:!0,xs:1,children:e(Se,{artifactObj:i,slotKey:s})},s))})}function je({weapon:t}){return e(h,{children:c(S,{container:!0,columns:t?6:5,spacing:.5,sx:{},children:[t&&e(S,{item:!0,xs:1,height:"100%",children:e(pt,{weapon:t})}),e(S,{item:!0,xs:5,children:e(wt,{sx:{backgroundColor:"info.main",height:"44px",display:"flex",justifyContent:"center",alignItems:"center"},children:e(u,{children:"TC Build"})})})]})})}function ft(t,a,n){const s=Pt(t,a),i=et(t,"icon",a);return n&&s?s:i||""}function ke({children:t,characterKey:a,onClick:n}){const{gender:s}=j(),{silly:i}=b.useContext(at),o=k(a),r=b.useCallback(p=>e(T,{onClick:n,sx:{flexGrow:1,display:"flex",flexDirection:"column"},children:p}),[n]),l=et(a,"banner",s);return e(lt,{condition:!!n,wrapper:r,children:c(h,{display:"flex",position:"relative",className:l?void 0:`grad-${o.rarity}star`,sx:{"&::before":{content:'""',display:"block",position:"absolute",left:0,top:0,width:"100%",height:"100%",opacity:.5,backgroundImage:`url(${l})`,backgroundPosition:"center",backgroundSize:"cover"}},width:"100%",children:[e(h,{flexShrink:1,component:"img",src:ft(a,s,i),sx:{maxWidth:"40%"},alignSelf:"flex-end",display:"flex",flexDirection:"column",zIndex:1}),e(h,{flexGrow:1,sx:{py:1,pr:1},display:"flex",flexDirection:"column",zIndex:1,justifyContent:"space-between",children:t})]})})}function _e({characterKey:t}){const{gender:a}=j(),{data:n}=b.useContext(W),s=n.get(y.charEle).value,i=n.get(y.lvl).value,o=n.get(y.constellation).value,r=n.get(y.asc).value,l=n.get(y.total.autoBoost).value,p=n.get(y.total.skillBoost).value,f=n.get(y.total.burstBoost).value,d=n.get(y.total.auto).value,g=n.get(y.total.skill).value,x=n.get(y.total.burst).value,m=k(t);return c(N,{children:[e($,{label:e(u,{variant:"subtitle1",children:e(nt,{characterKey:t,gender:a})}),size:"small",color:s,sx:{opacity:.85}}),c(h,{display:"flex",gap:1,sx:{textShadow:"0 0 5px gray"},alignItems:"center",children:[c(h,{children:[c(u,{component:"span",variant:"h6",whiteSpace:"nowrap",children:["Lv. ",i]}),c(u,{component:"span",variant:"h6",color:"text.secondary",children:["/",rt[r]]})]}),e(u,{component:"span",whiteSpace:"nowrap",sx:{opacity:.85},children:e(C,{color:`roll${o<3?3:o}`,children:e(Mt,{color:"white",children:c("strong",{children:["C",o]})})})})]}),c(h,{display:"flex",gap:1,sx:{opacity:.85},children:[e($,{size:"small",color:l?"info":"secondary",label:e("strong",{children:d})}),e($,{size:"small",color:p?"info":"secondary",label:e("strong",{children:g})}),e($,{size:"small",color:f?"info":"secondary",label:e("strong",{children:x})})]}),e(u,{variant:"h6",lineHeight:1,children:e(R,{stars:m.rarity,colored:!0,inline:!0})})]})}function Ke({characterKey:t}){const{gender:a}=j(),n=k(t);return c(N,{children:[e($,{label:e(u,{variant:"subtitle1",children:e(nt,{characterKey:t,gender:a})}),size:"small",color:st(t),sx:{opacity:.85}}),e(h,{mt:1,children:e(u,{variant:"h4",children:e(C,{children:"NEW"})})}),e(u,{mt:1.5,children:e(R,{stars:n.rarity,colored:!0})})]})}var V={},ze=O;Object.defineProperty(V,"__esModule",{value:!0});var mt=V.default=void 0,Be=ze(H()),We=E,Ae=(0,Be.default)((0,We.jsx)("path",{d:"M21.6 18.2 13 11.75v-.91c1.65-.49 2.8-2.17 2.43-4.05-.26-1.31-1.3-2.4-2.61-2.7C10.54 3.57 8.5 5.3 8.5 7.5h2c0-.83.67-1.5 1.5-1.5s1.5.67 1.5 1.5c0 .84-.69 1.52-1.53 1.5-.54-.01-.97.45-.97.99v1.76L2.4 18.2c-.77.58-.36 1.8.6 1.8h18c.96 0 1.37-1.22.6-1.8zM6 18l6-4.5 6 4.5H6z"}),"Checkroom");mt=V.default=Ae;var U={},we=O;Object.defineProperty(U,"__esModule",{value:!0});var gt=U.default=void 0,Pe=we(H()),Me=E,He=(0,Pe.default)((0,Me.jsx)("path",{d:"M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"}),"Person");gt=U.default=He;function Oe({characterKey:t,onClick:a,onMouseDown:n,onMouseEnter:s,hoverChild:i,hideFav:o}){const r=ut(t),{favorite:l}=ie(t),{gender:p}=j(),{silly:f}=b.useContext(at),d=b.useCallback(()=>a==null?void 0:a(t),[t,a]),g=b.useCallback(A=>e(T,{onClick:d,onMouseDown:n,onMouseEnter:s,children:A}),[d,n,s]),[x,m,v]=Ht();return e(z,{enterNextDelay:500,enterTouchDelay:500,placement:"top",open:!!i&&x,onClose:v,onOpen:m,title:i,children:e(I,{sx:{maxWidth:128,position:"relative",display:"flex",flexDirection:"column"},children:c(lt,{condition:!!a||!!n||!!s,wrapper:g,children:[e(h,{display:"flex",className:`grad-${k(t).rarity}star`,children:e(h,{component:"img",src:ft(t,p,f),maxWidth:"100%",maxHeight:"100%",draggable:!1})}),r&&e(u,{sx:{position:"absolute",fontSize:"0.75rem",lineHeight:1,opacity:.85,pointerEvents:"none",top:0},children:e("strong",{children:c(C,{color:"primary",children:[r.level,"/",rt[r.ascension]]})})}),!o&&e(h,{sx:{position:"absolute",top:0,right:0},children:l?e(Zt,{fontSize:"small"}):e(ht,{fontSize:"small"})}),r&&e(u,{sx:{position:"absolute",fontSize:"0.75rem",lineHeight:1,opacity:.85,pointerEvents:"none",bottom:0,right:0},children:e("strong",{children:c(C,{color:"secondary",children:["C",r.constellation]})})})]})})})}function Ee({index:t}){return e(I,{sx:{display:"flex",alignItems:"center",justifyContent:"center",py:"12.5%"},children:e(h,{component:"img",src:F.team[`team${t+1}`],sx:{width:"75%",height:"auto",opacity:.7}})})}function ta({teamId:t,onClick:a,hoverCard:n=!1,bgt:s}){const i=oe(t),{name:o,description:r,loadoutData:l}=i,p=D(),f=l.map(d=>{if(!d)return;const g=p.teamChars.get(d.teamCharId);if(g)return st(g.key)});return e(it,{bgt:s,sx:{height:"100%"},children:c(h,{sx:d=>({height:"100%",display:"flex",flexDirection:"column",background:`linear-gradient(to right, ${f.map(x=>{if(!x)return"rgba(0,0,0,0)";const m=d.palette[x].main,v=se(m);return v?`rgba(${v.r},${v.g},${v.b},0.25)`:"rgba(0,0,0,0)"}).map((x,m)=>`${x} ${m*25+12.5}%`).join(", ")})`}),children:[e(T,{onClick:()=>a(),sx:{p:1},children:c(u,{sx:{display:"flex",gap:1},children:[e("span",{children:o})," ",r&&e(z,{title:e(u,{children:r}),children:e(Et,{})})]})}),e(h,{sx:{p:1,marginTop:"auto"},children:e(S,{container:!0,columns:4,spacing:1,children:l.map((d,g)=>{var v;const x=d==null?void 0:d.teamCharId,m=x&&((v=p.teamChars.get(x))==null?void 0:v.key);return e(S,{item:!0,xs:1,height:"100%",children:m?e(T,{onClick:()=>a(m),children:e(Oe,{characterKey:m,hoverChild:n&&e(Ne,{characterKey:m,teamCharId:x,teamId:t}),hideFav:!0})}):e(T,{onClick:()=>a(),children:e(Ee,{index:g})})},g)})})})]})})}function Ne({characterKey:t,teamId:a,teamCharId:n}){var v;const s=D(),i=ut(t),{name:o}=ce(n),r=s.teams.getLoadoutDatum(a,n),l=s.teams.getActiveBuildName(r),p=(()=>s.teams.getLoadoutWeapon(r))(),f=(()=>{const{buildType:A,buildTcId:G}=r;return A==="tc"&&G?xe(s.buildTcs.get(G)):Object.values(s.teams.getLoadoutArtifacts(r)).filter(xt=>xt)})(),d=he(t,void 0,f,p),g=(v=d==null?void 0:d[t])==null?void 0:v.target,x=b.useMemo(()=>i&&{character:i},[i]),m=b.useMemo(()=>g&&d&&{data:g,teamData:d},[g,d]);return!x||!m?null:e(Ot.Provider,{value:x,children:e(W.Provider,{value:m,children:e(h,{sx:{width:300,m:-1},children:e(b.Suspense,{fallback:e(M,{variant:"rectangular",width:"100%",height:300}),children:c(it,{children:[e(ke,{characterKey:t,children:e(_e,{characterKey:t})}),c(h,{sx:{p:1,display:"flex",flexDirection:"column",gap:1},children:[c(u,{sx:{display:"flex",gap:1,alignItems:"center"},children:[e(gt,{}),e("span",{children:o})]}),c(u,{sx:{display:"flex",gap:1,alignItems:"center"},children:[e(mt,{}),e("span",{children:l})]}),(r==null?void 0:r.buildType)==="tc"&&(r!=null&&r.buildTcId)?e(je,{weapon:p}):e(Te,{})]})]})})})})})}export{Se as A,Oe as C,Ke as H,ta as T,$e as W,mt as a,ke as b,_e as c,gt as d,Te as e,Xe as f,xe as g,se as h,Je as i,ce as j,ut as k,he as l,ie as m,ht as n,de as o,De as p,ft as q,oe as u};
