import{b as X,q as p,X as b,c8 as P,bK as U,cI as k,bi as h,cR as S,bu as D,b_ as A,bh as J,aA as q,a8 as W,p as y,az as O,d as Q,am as Y,aE as Z,c_ as ee}from"./index-153af171.js";import{I as te,a2 as ae,y as se,a3 as G,z as $,e as ne,p as V,b as re,a4 as z,l as ie,x as T,a5 as ce,W as oe}from"./index-5a321f82.js";import{S as ue}from"./StatIcon-5f31f8b4.js";function Be(s=""){const e=X();return te(e.weapons,s)}function De({weaponKey:s}){return p(b,{ns:`weapon_${s}_gen`,key18:"name"})}function $e({weaponKey:s}){return p(b,{ns:`weapon_${s}_gen`,key18:"description"})}function Oe({weaponKey:s}){return P(s)?p(b,{ns:`weapon_${s}_gen`,key18:"passiveName"}):null}function Ee({weaponKey:s,refineIndex:e}){return P(s)?p(b,{ns:`weapon_${s}_gen`,key18:`passiveDescription.${e}`}):null}const B=!0;function je(s){const{unit:e,fixed:t}=H(s.info);return U(s.value,e,t)}class N{constructor(e,t){this.children=new Map,this.nodes=new Map,this.processed=new Map,this.display=void 0,this.teamBuff=void 0,e===void 0?(this.data=[],this.origin=this):(t||(t=new N(void 0,void 0)),this.data=[e,...t.data],this.origin=t.origin)}getDisplay(){return this.display||(this.display=this.getAll(["display"])),this.display}getTeamBuff(){if(!this.teamBuff){const e=this.getAll(["teamBuff"]),t={};k(ne,[],a=>a.operation,(a,r)=>{const n=h(e,a.path);n&&S(t,r,n)}),this.teamBuff=t}return this.teamBuff}getAll(e){const t={};for(const a of this.data)k(h(a,e)??{},[],r=>r.operation,(r,n)=>S(t,n,this.get(r)));return t}get(e){if(e===void 0)return console.trace("Please report this bug with this trace"),{info:{},operation:!0,value:void 0,isEmpty:!0,formulas:[]};const t=this.processed.get(e);if(t)return t;const a=fe(this.computeNode(e));return this.processed.set(e,a),a}computeNode(e){const t=this.nodes.get(e);if(t)return t;const{operation:a,info:r}=e;let n;switch(a){case"add":case"mul":case"min":case"max":case"res":case"sum_frac":n=this._compute(e);break;case"threshold":n=this._threshold(e);break;case"const":n=this._constant(e.value);break;case"subscript":n=this._subscript(e);break;case"read":n=this._read(e);break;case"data":n=this._data(e);break;case"match":n=this._match(e);break;case"lookup":n=this._lookup(e);break;case"prio":n=this._prio(e.operands);break;case"small":n=this._small(e.operands);break;default:D(a)}if(r){const{asConst:u}=r;n={...n},n.info=be(n.info,r),u&&(delete n.formula,delete n.assignment,n.dependencies=new Set),(n.info.pivot||!n.formula)&&(n.mayNeedWrapping=!1)}return he(n),this.nodes.set(e,n),n}prereadAll(e){return this.data.map(t=>h(t,e)).filter(t=>t)}readFirst(e){const t=this.data.map(a=>h(a,e)).find(a=>a);return t&&this.computeNode(t)}_prio(e){const t=e.find(a=>this.computeNode(a).value!==void 0);return t?this.computeNode(t):R}_small(e){let t;for(const a of e){const r=this.computeNode(a);((t==null?void 0:t.value)===void 0||r.value&&r.value<t.value)&&(t=r)}return t??R}_read(e){const{path:t}=e;if(e.accu===void 0)return this.readFirst(t)??(e.type==="string"?R:Ne);{const a=this.prereadAll(t);return a.length===1?this.computeNode(a[0]):e.accu==="small"?this._small(a):this._accumulate(e.accu,a.map(r=>this.computeNode(r)))}}_lookup(e){const t=this.computeNode(e.operands[0]).value,a=e.table[t]??e.operands[1];if(!a)throw new Error(`Lookup Fail with key ${t}`);return this.computeNode(a)}_match(e){const[t,a,r,n]=e.operands,u=this.computeNode(t),f=this.computeNode(a),c=u.value===f.value,o=this.computeNode(c?r:n);return c&&e.emptyOn==="match"||!c&&e.emptyOn==="unmatch"?F(o.value):o}_threshold(e){const[t,a,r,n]=e.operands,u=this.computeNode(t),f=this.computeNode(a),c=u.value>=f.value?this.computeNode(r):this.computeNode(n);return u.value>=f.value?e.emptyOn==="ge"?F(c.value):c:e.emptyOn==="l"?F(c.value):c}_data(e){let t=this.children.get(e.data);return t||(t=new N(e.data,e.reset?this.origin:this),this.children.set(e.data,t)),t.computeNode(e.operands[0])}_compute(e){const{operation:t,operands:a}=e;return this._accumulate(t,a.map(r=>this.computeNode(r)))}_subscript(e){const t=this.computeNode(e.operands[0]),a=e.list[t.value]??NaN;return this._constant(a)}_constant(e){return{info:{},value:e,empty:!1,mayNeedWrapping:!1,dependencies:new Set}}_accumulate(e,t){var o;let a;switch(e){case"add":case"mul":case"min":case"max":case"res":case"sum_frac":a=le(t);break;default:D(e)}switch(e){case"add":case"mul":case"min":case"max":{const i=V[e]([]);if(t=t.filter(l=>l.value!==i),!t.length)return Object.values(a).some(l=>l)?{...this._constant(i),info:a}:this._constant(i)}}let r,n=!1;switch(e){case"max":r=g`Max( ${{operands:t}} )`;break;case"min":r=g`Min( ${{operands:t}} )`;break;case"add":r=g`${{operands:t,separator:" + "}}`;break;case"mul":r=g`${{operands:t,separator:" * ",shouldWrap:t.length>1}}`;break;case"sum_frac":r=g`${{operands:[t[0]],shouldWrap:B}} / ( ${{operands:t,separator:" + "}} )`;break;case"res":{const i=t[0].value;i<0?(r=g`100% - ${{operands:t,shouldWrap:B}} / 2`,n=!0):i>=.75?r=g`100% / ( ${{operands:t,shouldWrap:B}} * 4 + 100% )`:(r=g`100% - ${{operands:t,shouldWrap:B}}`,n=!0);break}default:D(e)}switch(e){case"add":case"mul":t.length<=1?n=((o=t[0])==null?void 0:o.mayNeedWrapping)??!0:e==="add"&&(n=!0)}const u=V[e](t.map(i=>i.value)),f=new Set([...t.flatMap(i=>i.info.pivot&&i.assignment?[i.assignment,...i.dependencies]:[...i.dependencies])]);return{info:a,formula:r.display,empty:t.every(i=>i.empty),value:u,mayNeedWrapping:n,dependencies:f}}}function g(s,...e){const t=new Set,a=[];return s.forEach((r,n)=>{a.push(r);const u=e[n];if(u){const{operands:f,shouldWrap:c,separator:o=", "}=u;f.forEach((i,l,d)=>{let m;!i.info.pivot&&i.formula?m=i.formula:m=ge(i),c&&i.mayNeedWrapping?(a.push("( "),a.push(m),a.push(" )")):a.push(m),l+1<d.length&&a.push(o),i.dependencies.forEach(_=>t.add(_))})}}),{display:ye(a),dependencies:[...t]}}function le(s){function e(n){switch(n){case"overloaded":case"shattered":case"electrocharged":case"superconduct":case"burning":case"bloom":case"burgeon":case"hyperbloom":case"vaporize":case"melt":case"spread":case"aggravate":return 2;case"anemo":case"cryo":case"hydro":case"pyro":case"electro":case"geo":case"dendro":return 1;case"swirl":case"heal":return .5;case"physical":return 0;case"invalid":return-1;default:D(n)}}const t=new Set(s.flatMap(n=>[n.info.variant,n.info.subVariant]));t.delete(void 0);const a=[...t].sort((n,u)=>e(n)-e(u)),r={};return a.length&&(r.variant=a.pop()),a.length?r.subVariant=a.pop():r.subVariant=r.variant,r}function fe(s){const{info:e,dependencies:t,value:a,formula:r,assignment:n,empty:u}=s;return{operation:!0,info:e,value:a,isEmpty:u,formula:r,formulas:[...n?[n]:[],...t]}}const pe={default:"Default",base:"Base",total:"Total",uncapped:"Uncapped",custom:"Custom",char:"Char.",art:"Art.",weapon:"Weapon",teamBuff:"Team"};function de(s){if(!A.getStr(s))return{};const e=A.get(s),t=J(s),a=A.getVariant(s);return{name:e,icon:p(ue,{statKey:s,iconProps:{fontSize:"inherit",color:a}}),unit:t,variant:a}}function me(s){return q.includes(s)?{name:p(re,{setKey:s})}:{}}function H(s){return{...s,...s.path&&me(s.path),...s.path&&de(s.path),...(s.path&&ae[s.path])??{}}}function he(s){const{info:e,value:t,formula:a}=s,r=H(e),{name:n,prefix:u,source:f,variant:c,fixed:o,unit:i}=r;if(typeof t=="number"&&(s.valueDisplay=p(W,{color:"info",children:U(t,i,o)}),n)){const l=u&&!f?y(O,{children:[pe[u]," "]}):null,d=p(ve,{source:f});s.name=y(O,{children:[y(W,{color:c&&c==="invalid"?void 0:c,children:[l,n]}),d]}),a&&(s.assignment=y("div",{className:"formula",children:[s.name," ",s.valueDisplay," = ",a]}))}}function ve({source:s}){const{silly:e}=Q.useContext(Y);return s?q.includes(s)?y(W,{color:"secondary",children:[" ","(",p(b,{ns:"artifactNames_gen",key18:s}),")"]}):Z.includes(s)?y(W,{color:"secondary",children:[" ","(",p(b,{ns:"weaponNames_gen",key18:s}),")"]}):ee.includes(s)?y(W,{color:"secondary",children:[" ","(",p(b,{ns:e?"sillyWisher_charNames":"charNames_gen",key18:s}),")"]}):null:null}function ge(s){const{name:e,valueDisplay:t}=s;return e?y(O,{children:[p("span",{style:{fontSize:"85%"},children:e})," ",t]}):t}function ye(s){return p(O,{children:s.map((e,t)=>p("span",{children:e},t))})}function be(s,e){const t={...s};for(const[a,r]of Object.entries(e))r&&(t[a]=r);return t}const Ne={info:{pivot:!0},value:NaN,empty:!1,dependencies:new Set,mayNeedWrapping:!1},R={info:{pivot:!0},value:void 0,empty:!1,dependencies:new Set,mayNeedWrapping:!1};function F(s){return{info:{},value:s,empty:!0,dependencies:new Set,mayNeedWrapping:!1}}const _e=!0,we=!0,K=se(G(T),["teamBuff"]);function Ce(s,e,t){const a=Object.entries(s).map(([c,o])=>[c,{...$(o)}]),r=Object.fromEntries(a.map(([c])=>[c,{targetRef:{},buffs:[],calcs:{}}])),n={};function u(c){var d;const o=c[0]==="teamBuff"?h(K,c.slice(1)):h(T,c);if(o)return o;const i=h(n,c);if(i)return i;const l=oe(c);return c[0]==="teamBuff"&&c[1]==="tally"&&(l.accu=(d=h(ce,c.slice(2)))==null?void 0:d.accu),S(n,c,l),l}Object.values(r).forEach(({targetRef:c,buffs:o,calcs:i})=>a.forEach(([l,d])=>{const m=l.includes("Traveler")?`${l}${e}`:l,_=d.teamBuff,w={},E=G({teamBuff:_});o.push(w),i[l]=E,k(_,[],j=>j.operation,(j,C)=>{var x;const L={...(x=h(T,C))==null?void 0:x.info,source:m,prefix:void 0,asConst:_e};S(w,C,z(u(["teamBuff",...C]),E,L)),k(j,[],v=>(v==null?void 0:v.operation)==="read",v=>{if(v.path[0]==="targetBuff")return;let I,M;v.path[0]==="target"?(I=u(v.path.slice(1)),M=c):(I=v,M=r[l].targetRef),S(E,v.path,z(I,M))})})})),a.forEach(([c,o])=>{delete o.teamBuff;const{targetRef:i,buffs:l}=r[c],d=$(l);k(d??{},[],m=>m.operation,(m,_)=>{var w;m.info={...(w=h(K,_))==null?void 0:w.info,prefix:"teamBuff",pivot:we}}),Object.assign(i,$([o,d,{teamBuff:d,activeCharKey:ie(t)}])),i.target=i});const f=new N(void 0,void 0);return Object.fromEntries(Object.entries(r).map(([c,o])=>[c,{target:new N(o.targetRef,f),buffs:Object.fromEntries(Object.entries(o.calcs).map(([i,l])=>[i,new N(l,f)]))}]))}function Ie(s){return new N($(s),void 0)}export{N as U,De as W,Be as a,$e as b,Ie as c,Oe as d,Ee as e,je as n,H as r,Ce as u};
