import{u as O,d as r,am as V,b as G,aB as q,q as e,aT as z,aD as Q,aU as _,s as R,_ as M,f as Y,a5 as X,aP as Z,W as ee,aV as ae,p as w,O as K,N as W,C as B,Y as F,B as $,D as te,T as se,$ as re,aW as oe}from"./index-153af171.js";import{G as ne,f as le,s as ie,u as ce,a as me,T as P,S as he,d as ue}from"./index-5a321f82.js";import{d as A}from"./Upload-67ec0f66.js";import{b as de}from"./totalUtils-42d7ebed.js";import{T as pe}from"./TeamCard-c6132e6b.js";import{C as fe}from"./CardHeader-5a31813a.js";import"./DropdownButton-990b99d4.js";import"./StatIcon-5f31f8b4.js";import"./index-d4d223e1.js";import"./Info-3ef80394.js";import"./getDisplayUtil-3cb641eb.js";import"./uiData-3df78ec3.js";import"./SlotIcon-86010403.js";import"./util-3e22b532.js";import"./CardActionArea-d8213cc1.js";function ge({teamIds:l,charKeys:s,setCharKey:m,acProps:i}){const{t:h}=O(["sillyWisher_charNames","charNames_gen"]),{silly:y}=r.useContext(V),o=G(),{gender:u}=q(),d=r.useCallback(t=>o.charMeta.get(t).favorite,[o.charMeta]),S=r.useCallback(t=>e(z,{characterKey:t}),[]),b=r.useCallback((t,n)=>h(`${n?"sillyWisher_charNames":"charNames_gen"}:${Q(t,u)}`),[u,h]),E=Y,T=r.useMemo(()=>o.chars.keys,[o]),{characterTeamTotal:p}=r.useMemo(()=>de({characterTeamTotal:T},n=>{o.teams.values.forEach(c=>{const{loadoutData:f}=c;f.filter(_).forEach(({teamCharId:k})=>{const C=o.teamChars.get(k);if(!C)return;const x=C.key;n.characterTeamTotal[x].total++})}),l.forEach(c=>{const f=o.teams.get(c);if(!f)return;const{loadoutData:k}=f;k.filter(_).forEach(({teamCharId:C})=>{const x=o.teamChars.get(C);if(!x)return;const D=x.key;n.characterTeamTotal[D].current++})})}),[o,T,l]),v=r.useCallback(t=>e("strong",{children:p[t]}),[p]),I=r.useCallback(t=>e(R,{size:"small",label:p[t]}),[p]),N=r.useMemo(()=>T.map(t=>({key:t,label:b(t,y),alternateNames:y?[b(t,!y)]:void 0,favorite:d(t),color:E(t)})).sort((t,n)=>t.favorite&&!n.favorite?-1:!t.favorite&&n.favorite?1:t.label.localeCompare(n.label)),[y,b,E,d,T]);return e(r.Suspense,{fallback:e(M,{variant:"text",width:100}),children:e(ne,{label:"Characters",options:N,toImg:S,valueKeys:s,onChange:t=>m(t),toExLabel:v,toExItemLabel:I,chipProps:{variant:"outlined"},...i})})}function ye(){return{name:l=>l.name??"",lastEdit:l=>l.lastEdit??0}}const Te={name:["name","lastEdit"],lastEdit:["lastEdit"]};function Ce(l){return{charKeys:(s,m)=>{var o;if(!m.length)return!0;const i=(o=l.teams.get(s))==null?void 0:o.loadoutData.filter(_),h=i==null?void 0:i.map(({teamCharId:u})=>{var d;return(d=l.teamChars.get(u))==null?void 0:d.key}).filter(_);return m.every(u=>h==null?void 0:h.includes(u))},name:(s,m)=>{var i;return!m||!!((i=l.teams.get(s))!=null&&i.name.toLowerCase().includes(m.toLowerCase()))}}}const xe={xs:1,sm:2,md:3,lg:3,xl:3},we={xs:6,sm:12,md:18,lg:24,xl:24};function Pe(){const{t:l}=O(["page_teams","sillyWisher_charNames","charNames_gen"]),s=G(),[m,i]=X(),h=Z();r.useEffect(()=>s.teams.followAny((a,g)=>(g==="new"||g==="remove"||g==="update")&&i()),[i,s]);const y=()=>{const a=s.teams.new();h(a)},[o,u,d]=ee(),[S,b]=r.useState(""),E=()=>{try{const a=JSON.parse(S);s.teams.import(a)||window.alert("Data verification failed."),d()}catch(a){window.alert(`Data Import failed. ${a}`);return}},T=ae(s.displayTeam),{sortType:p,ascending:v,charKeys:I}=T,[N,t]=r.useState(T.searchTerm),n=r.useDeferredValue(N);r.useEffect(()=>{s.displayTeam.set({searchTerm:n})},[s,n]);const{teamIds:c,totalTeamNum:f}=r.useMemo(()=>{const a=s.teams.keys.length,g=s.teams.keys.filter(le({charKeys:I,name:n},Ce(s))).sort((U,H)=>ie(Te[p],v,ye())(s.teams.get(U),s.teams.get(H)));return m&&{teamIds:g,totalTeamNum:a}},[m,s,I,n,p,v]),k=ce(),{numShow:C,setTriggerElement:x}=me(we[k],c.length),D=r.useMemo(()=>c.slice(0,C),[c,C]),L=c.length!==f?`${c.length}/${f}`:`${f}`,j={numShowing:D.length,total:L,t:l,namespace:"page_teams"},J={sortKeys:[...oe],value:p,onChange:a=>s.displayTeam.set({sortType:a}),ascending:v,onChangeAsc:a=>s.displayTeam.set({ascending:a})};return w(K,{my:1,display:"flex",flexDirection:"column",gap:1,children:[e(F,{children:w(B,{sx:{display:"flex",flexDirection:"column",gap:1},children:[w(K,{display:"flex",gap:1,alignItems:"stretch",children:[e(ge,{teamIds:c,charKeys:I,setCharKey:a=>s.displayTeam.set({charKeys:a}),acProps:{sx:{flexGrow:1}}}),e(P,{autoFocus:!0,value:N,onChange:a=>t(a.target.value),label:"Team Name",sx:{height:"100%",flexGrow:1},InputProps:{sx:{height:"100%"}}})]}),e(K,{display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",children:e(he,{showingTextProps:j,sortByButtonProps:J})})]})}),w(K,{sx:{display:"flex",gap:1},children:[e($,{fullWidth:!0,onClick:y,color:"info",startIcon:e(ue,{}),children:"Add Team"}),e(re,{open:o,onClose:d,children:w(F,{children:[e(fe,{title:"Import Team"}),e(te,{}),w(B,{sx:{display:"flex",flexDirection:"column",gap:2},children:[e(se,{children:"Import a team in JSON form below."}),e(P,{fullWidth:!0,label:"JSON Data",placeholder:"Paste your Team JSON here",value:S,onChange:a=>b(a.target.value),multiline:!0,rows:4}),e($,{startIcon:e(A,{}),disabled:!S,onClick:E,children:"Import"})]})]})}),e($,{fullWidth:!0,onClick:u,color:"info",startIcon:e(A,{}),children:"Import Team"})]}),e(r.Suspense,{fallback:e(M,{variant:"rectangular",sx:{width:"100%",height:"100%",minHeight:5e3}}),children:e(W,{container:!0,spacing:1,columns:xe,children:D.map(a=>e(W,{item:!0,xs:1,children:e(r.Suspense,{fallback:e(M,{variant:"rectangular",width:"100%",height:150}),children:e(pe,{teamId:a,bgt:"light",onClick:g=>h(`${a}${g?`/${g}`:""}`),hoverCard:!0})})},a))})}),c.length!==D.length&&e(M,{ref:a=>{a&&x(a)},sx:{borderRadius:1},variant:"rectangular",width:"100%",height:100})]})}export{Pe as default};
