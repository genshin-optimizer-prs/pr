"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[186],{71847:(e,t,a)=>{a.r(t),a.d(t,{default:()=>ud});var n=a(45492),i=a(503),r=a(96e3),l=a(85439),s=a(36380),o=a(61391),c=a(60319),d=a(68826),u=a(32782),h=a(67550),Z=a(79906),p=a(7671),m=a(38484),f=a(78287),g=a(83249),x=a(2784),b=a(11141),y=a(73557),v=a(39857),C=a(24264),w=a(87833),k=a(23690),S=a(4991),B=a(30069),X=a(94380),_=a(92794),T=a(13230),j=a(99487),K=a(41319),O=a(57210),P=a(39099),E=a(86569),M=a(12366),D=a(52903);const A={mx:.25,px:.25};function I({reaction:e}){const{t}=(0,b.$G)("sheet_gen"),a="spread"===e?"dendro":"electro";return(0,D.BX)(h.Z,{display:"flex",alignItems:"center",children:[(0,D.tZ)(E.Z,{color:e,children:t(`reaction.${e}`)}),(0,D.tZ)(M.Z,{sx:A,color:"dendro",children:(0,D.tZ)(B.oZ,Object.assign({},S.mX))}),"+",(0,D.tZ)(M.Z,{sx:A,color:"electro",children:(0,D.tZ)(B.Bn,Object.assign({},S.mX))}),"+",(0,D.tZ)(M.Z,{sx:A,color:a,children:(0,D.tZ)(P.Z,{ele:a,iconProps:S.mX})})]})}var R=a(34048),L=a(23485),z=a(58489);let G,$=e=>e;const N={"":(0,D.tZ)("span",{children:"No Team Melee Infusion"}),pyro:(0,D.BX)("span",{children:[(0,D.tZ)(B.I4,Object.assign({},S.mX))," ",(0,D.tZ)(M.Z,{children:"Bennett C6"})," Fire Ventures with Me"]}),cryo:(0,D.BX)("span",{children:[(0,D.tZ)(B.DK,Object.assign({},S.mX))," ",(0,D.tZ)(M.Z,{children:"Chongyun Skill"})," Spirit Blade: Chonghua's Layered Frost"]}),hydro:(0,D.BX)("span",{children:[(0,D.tZ)(B.px,Object.assign({},S.mX))," ",(0,D.tZ)(M.Z,{children:"Candace Burst"})," Sacred Rite: Wagtail's Tide"]}),electro:(0,D.BX)("span",{children:[(0,D.tZ)(B.Bn,Object.assign({},S.mX))," ",(0,D.tZ)(M.Z,{children:"Somnia Burst"})," ","Parallax Paws"]})};function W(e){const{characterSheet:t,character:{infusionAura:a},characterDispatch:n}=(0,x.useContext)(T.K);return null!=t&&t.isMelee()?(0,D.tZ)(L.Z,Object.assign({title:N[a],color:a||"secondary",disableElevation:!0},e,{children:Object.entries(N).map((([e,t])=>(0,D.tZ)(X.Z,{sx:e?{color:`${e}.main`}:void 0,selected:e===a,disabled:e===a,onClick:()=>n({infusionAura:e}),children:t},e)))})):null}function F(e){var t,a,n,r;const{t:l}=(0,b.$G)("page_character"),{character:{reaction:s},characterDispatch:o}=(0,x.useContext)(T.K),{data:c}=(0,x.useContext)(j.R),d=c.get(K.ri.charEle).value,u=c.get(K._d).value,h=[...new Set([...null!=(t=O.oR[d])?t:[],...null!=(a=O.oR[u])?a:[],...null!=(n=O.p7[d])?n:[],...null!=(r=O.p7[u])?r:[]])];return(0,D.BX)(z.Z,Object.assign({exclusive:!0,baseColor:"secondary",value:s,onChange:(e,t)=>o({reaction:t})},e,{children:[(0,D.tZ)(_.Z,{value:"",disabled:!s,children:l(G||(G=$`noReaction`))}),h.map((e=>(0,D.tZ)(_.Z,{value:e,disabled:s===e,children:[...i.Mk].includes(e)?(0,D.tZ)(R.Z,{reaction:e}):(0,D.tZ)(I,{reaction:e})},e)))]}))}function V(e){const{t}=(0,b.$G)("page_character"),{character:{hitMode:a},characterDispatch:n}=(0,x.useContext)(T.K);return(0,D.tZ)(z.Z,Object.assign({exclusive:!0,baseColor:"secondary",value:a,onChange:(e,t)=>n({hitMode:t})},e,{children:i.Zy.map((e=>(0,D.tZ)(_.Z,{value:e,disabled:a===e,children:t(`hitmode.${e}`)},e)))}))}var q=a(86512),H=a(48650);const U=(0,x.createContext)({});var Y=a(23657),J=a(44180),Q=a(6853),ee=a(56302),te=a(76260),ae=a(55893),ne=a(22134),ie=a(6982),re=a(11845),le=a(42745),se=a(93553),oe=a(80162),ce=a(1811),de=a(22698),ue=a(44481),he=a(63655),Ze=a(13264),pe=a(62197),me=a(23570),fe=a(2995),ge=a(66198),xe=a(80551),be=a(23883),ye=a(35322),ve=a(13780),Ce=a(41075),we=a(65992),ke=a(89977),Se=a(12702),Be=a(69698),Xe=a(68330),_e=a(15030),Te=a(33927),je=a(56961),Ke=a(79410),Oe=a(72539),Pe=a(4121),Ee=a(51576),Me=a(25616);const De={title:(0,D.tZ)(E.Z,{color:"warning",children:"ERROR"})},Ae=Object.assign({normal:"Normal Atk.",charged:"Charged Atk.",plunging:"Plunging Atk.",skill:"Ele. Skill",burst:"Ele. Burst",passive:"Passive",passive1:"1st Asc. Pass.",passive2:"4th Asc. Pass.",passive3:"Util. Pass."},Object.fromEntries((0,re.w6)(1,6).map((e=>[`constellation${e}`,`Const. ${e}`]))));function Ie(e,t,a){if(!t)return De;if("basic"===t)return{title:"Basic Stats"};if("custom"===t)return{title:"Custom Multi Target"};if("reaction"===t)return{title:"Transformative Reactions"};if(!t.includes(":")){const n=e.get(K.qH.charKey).value;if(!n)return De;const i=(0,J.m)(n,a.gender),r=["normal","charged","plunging"].includes(t)?"auto":t,l=null==i?void 0:i.getTalentOfKey(r);if(!l)return De;const s=Ae[t];return{icon:l.img,title:l.name,action:s}}{const[a,n]=t.split(":");if("artifact"===a){const e=(0,Pe.Sk)(n);return e?{title:e.name,icon:(0,Ee.jU)(n)}:De}if("weapon"===a){const t=(0,Me.ub)(n);if(!t)return De;const a=e.get(K.qH.weapon.asc).value;return{title:t.name,icon:(0,Oe.Aq)(n,a>=2)}}}return De}function Re(e){const t=e.getDisplay(),a=Object.entries(t),n=a.filter((([e])=>"basic"===e)),i=a.filter((([e])=>"reaction"===e)),r=a.filter((([e])=>"custom"===e)),l=a.filter((([e])=>e.startsWith("weapon"))),s=a.filter((([e])=>e.startsWith("artifact")));return[...n,...i,...r,...a.filter((([e])=>"basic"!==e&&"reaction"!==e&&!e.startsWith("weapon")&&!e.startsWith("artifact")&&"custom"!==e)),...l,...s]}var Le=a(60342),ze=a(42523),Ge=a(19181),$e=a(39282);function Ne({show:e,onClose:t,setTarget:a,showEmptyTargets:n=!1,flatOnly:i=!1,excludeSections:r=[],excludeHeal:l=!1}){const{data:s}=(0,x.useContext)(j.R),o=(0,x.useMemo)((()=>Re(s).filter((([e])=>!r.includes(e))).map((([e,t])=>[e,Object.fromEntries(Object.entries(t).filter((([e,t])=>(!i||"%"!==t.info.unit)&&((!l||"heal"!==t.info.variant)&&!(!n&&t.isEmpty)))))])).filter((([e,t])=>Object.keys(t).length))),[s,r,i,n,l]);return(0,D.tZ)(Be.Z,{open:e,onClose:t,children:(0,D.tZ)(C.Z,{children:(0,D.tZ)(p.Z,{children:(0,D.tZ)(Le.ZP,{columns:{xs:1,sm:2,md:3},spacing:1,children:o.map((([e,t])=>(0,D.tZ)(We,{displayNs:t,sectionKey:e,setTarget:a},e)))})})})})}function We({displayNs:e,sectionKey:t,setTarget:a}){const{data:n}=(0,x.useContext)(j.R),{database:i}=(0,x.useContext)(Q.t),r=(0,x.useMemo)((()=>Ie(n,t,i)),[n,t,i]);return(0,D.BX)(w.Z,{children:[r&&(0,D.tZ)(ze.Z,{avatar:r.icon&&(0,D.tZ)(Ke.Z,{size:2,src:r.icon}),title:r.title,action:r.action&&(0,D.tZ)(M.Z,{children:r.action}),titleTypographyProps:{variant:"subtitle1"}}),(0,D.tZ)(je.Z,{}),(0,D.tZ)(Ge.Z,{children:Object.entries(e).map((([e,n])=>(0,D.tZ)(Fe,{node:n,onClick:()=>a([t,e],n.info.multi)},e)))})]},t)}function Fe({node:e,onClick:t}){return(0,D.tZ)(X.Z,{onClick:t,style:{whiteSpace:"normal"},children:(0,D.tZ)($e.HK,{node:e})})}function Ve({optimizationTarget:e,setTarget:t,disabled:a=!1,showEmptyTargets:i=!1,defaultText:r,targetSelectorModalProps:l={}}){var s;const{t:o}=(0,b.$G)("page_character_optimize"),[c,d,u]=(0,n.aV)(!1),Z=(0,x.useCallback)((e=>{u(),t(e)}),[u,t]),{data:p}=(0,x.useContext)(j.R),{database:m}=(0,x.useContext)(Q.t),f=(0,x.useMemo)((()=>e&&Ie(p,e[0],m)),[p,e,m]);r||(r=o("targetSelector.selectOptTarget"));const{title:y,icon:v,action:C}=null!=f?f:{},w=e&&(0,re.Hm)(p.getDisplay(),e),k=!e||!f||!w||!i&&w.isEmpty,S=k?"secondary":w.info.variant,B="invalid"===S?void 0:S,{textSuffix:X}=null!=(s=null==w?void 0:w.info)?s:{},_=X&&(0,D.BX)("span",{children:[" ",X]}),T=v?(0,D.tZ)(Ke.Z,{src:v,size:2}):null==w?void 0:w.info.icon;return(0,D.BX)(D.HY,{children:[(0,D.tZ)(g.Z,{color:"info",onClick:d,disabled:a,sx:{flexGrow:1},children:k?(0,D.tZ)("strong",{children:r}):(0,D.BX)(Te.Z,{direction:"row",divider:(0,D.tZ)(je.Z,{orientation:"vertical",flexItem:!0}),spacing:1,children:[(0,D.BX)(h.Z,{sx:{display:"flex",gap:1,alignItems:"center"},children:[T,(0,D.tZ)("span",{children:y}),!!C&&(0,D.tZ)(M.Z,{color:"success",sx:{whiteSpace:"normal"},children:C})]}),(0,D.tZ)(h.Z,{sx:{display:"flex",alignItems:"center"},children:(0,D.BX)(M.Z,{color:B,sx:{whiteSpace:"normal"},children:[(0,D.tZ)("strong",{children:w.info.name}),_]})})]})}),(0,D.tZ)(Ne,Object.assign({show:c,onClose:u,setTarget:Z,showEmptyTargets:i},l))]})}let qe,He,Ue,Ye,Je,Qe=e=>e;const et=200,tt=2e3,at=300;function nt(e,t=1){return{weight:t,path:e,hitMode:"avgHit",bonusStats:{}}}function it(e){if("object"!=typeof e)return;let{name:t,description:a,targets:n}=e;return"string"!=typeof t?t="New Custom Target":t.length>et&&(t=t.slice(0,et)),"string"!=typeof a?a=void 0:a.length>tt&&(a=a.slice(0,tt)),Array.isArray(n)?(n=n.map((e=>function(e){if("object"!=typeof e)return;let{weight:t,path:a,hitMode:n,reaction:r,infusionAura:l,bonusStats:s}=e;return("number"!=typeof t||t<=0)&&(t=1),Array.isArray(a)&&"custom"!==a[0]?(n&&"string"==typeof n&&i.kE.includes(n)||(n="avgHit"),!r||i.Mk.includes(r)||i.eQ.includes(r)||(r=void 0),l&&!i.i1.includes(l)&&(l=void 0),s||(s={}),s=Object.fromEntries(Object.entries(s).filter((([e,t])=>K.lR.includes(e)&&"number"==typeof t))),{weight:t,path:a,hitMode:n,reaction:r,infusionAura:l,bonusStats:s}):void 0}(e))).filter((e=>void 0!==e)),{name:t,description:a,targets:n}):void 0}function rt(){const{t:e}=(0,b.$G)("page_character"),[t,a,i]=(0,n.aV)(),{character:r,characterDispatch:l}=(0,x.useContext)(T.K),[s,o]=(0,x.useState)((()=>r.customMultiTarget));(0,x.useEffect)((()=>o(r.customMultiTarget)),[o,r.customMultiTarget]);const[c,d]=(0,x.useState)(!1),u=(0,x.useCallback)((()=>{o([...s,{name:"New Custom Target",targets:[]}]),d(s.length)}),[s,o,d]),m=(0,x.useCallback)((e=>t=>{const a=[...s];a[e]=t,o(a)}),[s,o]),f=(0,x.useCallback)((e=>()=>{if(s[e].targets.length&&!window.confirm(`Are you sure you want to delete "${s[e].name}"?`))return;const t=[...s];t.splice(e,1),o(t)}),[s,o]),y=(0,x.useCallback)((e=>()=>{const t=[...s];t.splice(e,0,s[e]),o(t)}),[s,o]),v=(0,x.useCallback)((e=>t=>{if(t=(0,le.re)(t-1,0,s.length-1),e===t)return;const a=[...s],n=a[e];a.splice(e,1),a.splice(t,0,n),o(a)}),[s,o]),w=(0,x.useCallback)((()=>{i(),l({customMultiTarget:s})}),[s,i,l]),S=(0,x.useCallback)((e=>()=>d(e!==c&&e)),[c]),{data:B,teamData:X}=(0,x.useContext)(j.R),_=(0,x.useMemo)((()=>{const e=B.data[0],t=Object.assign({},e,{hit:Object.assign({},e.hit),infusion:Object.assign({},e.infusion)});return delete t.hit.reaction,delete t.infusion.team,{data:new _e.w(t,void 0),teamData:X}}),[B,X]),K=(0,x.useMemo)((()=>s.map(((e,t)=>(0,D.tZ)(lt,{index:t,expanded:t===c,onExpand:S(t),target:e,setTarget:m(t),onDelete:f(t),onDup:y(t),onOrder:v(t),nTargets:s.length},`${t}${e.name}`)))),[s,f,y,c,S,m,v]);return(0,D.BX)(x.Suspense,{fallback:(0,D.tZ)(Z.Z,{variant:"rectangular",height:"100%",width:100}),children:[(0,D.tZ)(g.Z,{color:"info",onClick:a,startIcon:(0,D.tZ)(Ze.Z,{}),children:e(qe||(qe=Qe`multiTarget.title`))}),(0,D.tZ)(j.R.Provider,{value:_,children:(0,D.tZ)(Be.Z,{open:t,onClose:w,containerProps:{sx:{overflow:"visible"}},children:(0,D.tZ)(C.Z,{children:(0,D.BX)(p.Z,{sx:{display:"flex",flexDirection:"column",gap:1},children:[(0,D.BX)(h.Z,{display:"flex",gap:1,alignItems:"center",children:[(0,D.tZ)(pe.Z,{variant:"h6",children:e(He||(He=Qe`multiTarget.title`))}),(0,D.tZ)(Se.Z,{title:(0,D.BX)(pe.Z,{children:[(0,D.BX)(b.cC,{t:e,i18nKey:"multiTarget.info1",children:["Note: Community created custom Multi-Optimization Targets can be found within the",(0,D.tZ)("a",{href:"https://discord.gg/CXUbQXyfUs",target:"_blank",rel:"noreferrer",children:"GO Discord"}),"or",(0,D.tZ)("a",{href:"https://keqingmains.com/misc/multi-optimization/",target:"_blank",rel:"noreferrer",children:"KQM Multi-Opt Guide"}),", however the validity of such configurations cannot be guaranteed."]}),(0,D.tZ)("br",{}),(0,D.tZ)("br",{}),e("multiTarget.info2")]})}),(0,D.tZ)(k.Z,{onClick:w,sx:{marginLeft:"auto"}})]}),(0,D.BX)(h.Z,{children:[K,(0,D.tZ)(g.Z,{fullWidth:!0,onClick:u,startIcon:(0,D.tZ)(se.Z,{}),sx:{mt:1},children:e(Ue||(Ue=Qe`multiTarget.addNewMTarget`))})]})]})})})})]})}function lt({index:e,target:t,setTarget:a,expanded:n,onExpand:i,onDelete:r,onDup:l,onOrder:s,nTargets:o}){var c;const{t:d}=(0,b.$G)("page_character"),u=(0,x.useCallback)((e=>a(Object.assign({},t,{name:e}))),[a,t]),Z=(0,x.useCallback)((e=>a(Object.assign({},t,{description:e}))),[a,t]),p=(0,x.useCallback)(((e,n)=>{const i=Object.assign({},t);i.targets=[...i.targets,nt(e,n)],a(i)}),[t,a]),m=(0,x.useCallback)((e=>n=>{const i=[...t.targets];i[e]=n,a(Object.assign({},t,{targets:i}))}),[t,a]),f=(0,x.useCallback)((e=>()=>{if(Object.values(t.targets[e].bonusStats).length&&!window.confirm("Are you sure you want to delete this target?"))return;const n=[...t.targets];n.splice(e,1),a(Object.assign({},t,{targets:n}))}),[t,a]),y=(0,x.useCallback)((e=>n=>{if(void 0===n||0===n)return;const i=n-1,r=[...t.targets];(0,le.Rp)(r,e,i),a(Object.assign({},t,{targets:r}))}),[t,a]),v=(0,x.useCallback)((e=>()=>{const n=[...t.targets];n.splice(e,0,(0,le.I8)(n[e])),a(Object.assign({},t,{targets:n}))}),[t,a]),C=(0,x.useMemo)((()=>t.targets.map(((e,a)=>(0,D.tZ)(ut,{customTarget:e,setCustomTarget:m(a),deleteCustomTarget:f(a),rank:a+1,maxRank:t.targets.length,setTargetIndex:y(a),onDup:v(a)},e.path.join()+a)))),[f,v,m,y,t.targets]);return(0,D.BX)(me.Z,{sx:{bgcolor:"contentLight.main"},expanded:n,children:[(0,D.tZ)(fe.Z,{expandIcon:(0,D.BX)(g.Z,{color:"info",sx:{pointerEvents:"auto"},onClick:i,children:[(0,D.tZ)(Ze.Z,{}),n?(0,D.tZ)(ue.Z,{}):(0,D.tZ)(he.Z,{})]}),component:"div",sx:{pointerEvents:"none","& .MuiAccordionSummary-expandIconWrapper":{transform:"rotate(0)"},"& .MuiAccordionSummary-expandIconWrapper.Mui-expanded":{transform:"rotate(0)"}},children:(0,D.BX)(h.Z,{gap:1,pr:1,display:"flex",flexWrap:"wrap",sx:{pointerEvents:"auto",width:"100%",alignItems:"center"},children:[(0,D.tZ)(ge.Z,{sx:{minWidth:"8em"},color:t.targets.length?"success":void 0,label:(0,D.BX)(b.cC,{t:d,i18nKey:"multiTarget.target",count:t.targets.length,children:[{count:t.targets.length}," Targets"]})}),(0,D.tZ)(st,{name:t.name,setName:u}),t.description&&(0,D.tZ)(Se.Z,{title:(0,D.tZ)(pe.Z,{children:t.description.length>at?t.description.slice(0,at)+"...":t.description})}),(0,D.BX)(xe.Z,{size:"small",children:[(0,D.tZ)(ke.CC,{children:(0,D.tZ)(ke.ZP,{onChange:e=>s(null!=e?e:0),value:e+1,inputProps:{min:1,max:o,sx:{textAlign:"center"}},sx:{width:"100%",height:"100%",pl:2}})}),(0,D.tZ)(be.Z,{title:d("multiTarget.duplicate"),placement:"top",children:(0,D.tZ)(g.Z,{onClick:l,color:"info",children:(0,D.tZ)(oe.Z,{})})}),(0,D.tZ)(g.Z,{color:"error",onClick:r,children:(0,D.tZ)(de.Z,{})})]})]})}),(0,D.BX)(ye.Z,{children:[(0,D.tZ)(h.Z,{mb:1,display:"flex",sx:{pointerEvents:"auto",width:"100%"},children:(0,D.tZ)(ot,{desc:null!=(c=t.description)?c:"",setDesc:Z})}),(0,D.tZ)(h.Z,{mb:1,children:(0,D.tZ)(mt,{customMultiTarget:t,setCustomMultiTarget:a})}),(0,D.BX)(h.Z,{display:"flex",gap:1,flexDirection:"column",children:[C,(0,D.tZ)(Zt,{setTarget:p})]})]})]})}function st({name:e,setName:t}){const[a,i]=(0,x.useState)(e);(0,x.useEffect)((()=>i(e)),[e,i]);const[r,l,s]=(0,n.aV)(!1),o=(0,n.KS)();return(0,D.tZ)(ve.Z,{error:r,size:"small",value:a,onChange:e=>{let t=e.target.value;t.length>=et?(o(s,2e3),l(),t=t.slice(0,et)):o(s,1),i(t)},onBlur:e=>t(a),sx:{flexGrow:1}})}function ot({desc:e,setDesc:t}){const{t:a}=(0,b.$G)("page_character"),[i,r]=(0,x.useState)(e);(0,x.useEffect)((()=>r(e)),[e,r]);const[l,s,o]=(0,n.aV)(!1),c=(0,n.KS)();return(0,D.tZ)(ve.Z,{error:l,multiline:!0,size:"small",placeholder:a("multiTarget.description"),value:i,onChange:e=>{let t=e.target.value;t.length>=tt?(c(o,2e3),s(),t=t.slice(0,tt)):c(o,1),r(t)},onBlur:e=>t(i),sx:{flexGrow:1}})}const ct=[...K.lR],dt=(e,t)=>(0,D.tZ)(Ce.ZP,{item:!0,xs:1,children:e},t);function ut({customTarget:e,setCustomTarget:t,deleteCustomTarget:a,rank:n,maxRank:r,setTargetIndex:l,onDup:s}){const{t:o}=(0,b.$G)("page_character"),{characterSheet:c}=(0,x.useContext)(T.K),{data:d}=(0,x.useContext)(j.R),{path:u,weight:Z,hitMode:p,reaction:m,infusionAura:f,bonusStats:y}=e,v=(0,x.useCallback)((a=>t(Object.assign({},e,{weight:a}))),[e,t]),w=(0,le.Hm)(d.getDisplay(),u),k=(0,x.useCallback)((a=>t(Object.assign({},e,{bonusStats:a}))),[e,t]),S=(0,x.useMemo)((()=>(0,D.tZ)(Xe.Z,{statKeys:ct,statFilters:y,setStatFilters:k,wrapperFunc:dt,label:o("addStats.label")})),[y,k,o]),B=(null==c?void 0:c.isMelee())&&("normal"===u[0]||"charged"===u[0]||"plunging"===u[0]),_="reaction"===u[0];return(0,D.BX)(C.Z,{sx:{display:"flex"},children:[(0,D.BX)(h.Z,{sx:{p:1,flexGrow:1},children:[(0,D.BX)(h.Z,{sx:{display:"flex",gap:1,flexWrap:"wrap"},children:[(0,D.tZ)(ke.ZP,{float:!0,startAdornment:"x",value:Z,onChange:v,sx:{borderRadius:1,pl:1},inputProps:{sx:{pl:.5,width:"2em"},min:0}}),(0,D.tZ)(Ve,{optimizationTarget:u,setTarget:a=>t(Object.assign({},e,{path:a,reaction:void 0,infusionAura:void 0})),showEmptyTargets:!0,targetSelectorModalProps:{flatOnly:!0,excludeSections:["basic","custom"]}}),(0,D.tZ)(h.Z,{sx:{flexGrow:1}}),w&&(0,D.tZ)(ht,{reaction:m,setReactionMode:a=>t(Object.assign({},e,{reaction:a})),node:w,infusionAura:f}),(0,D.tZ)(L.Z,{title:o(`hitmode.${p}`),children:i.kE.map((a=>(0,D.tZ)(X.Z,{value:a,disabled:p===a,onClick:()=>t(Object.assign({},e,{hitMode:a})),children:o(`hitmode.${a}`)},a)))})]}),(0,D.BX)(Ce.ZP,{container:!0,columns:{xs:1,lg:2},sx:{pt:1},spacing:1,children:[(B||_)&&(0,D.tZ)(Ce.ZP,{item:!0,xs:1,children:(0,D.tZ)(L.Z,{title:N[null!=f?f:""],color:f||"secondary",disableElevation:!0,fullWidth:!0,children:Object.entries(N).map((([a,n])=>(0,D.tZ)(X.Z,{sx:a?{color:`${a}.main`}:void 0,selected:a===f,disabled:a===f,onClick:()=>t(Object.assign({},e,{infusionAura:a||void 0,reaction:void 0})),children:n},a)))})}),S]})]}),(0,D.BX)(xe.Z,{orientation:"vertical",sx:{borderTopLeftRadius:0,"*":{flexGrow:1}},children:[(0,D.tZ)(ke.CC,{children:(0,D.tZ)(ke.ZP,{value:n,onChange:l,sx:{pl:2},inputProps:{sx:{width:"1em"},min:1,max:r}})}),(0,D.tZ)(g.Z,{size:"small",color:"info",onClick:s,children:(0,D.tZ)(oe.Z,{})}),(0,D.tZ)(g.Z,{size:"small",color:"error",onClick:a,children:(0,D.tZ)(de.Z,{})})]})]})}function ht({node:e,reaction:t,setReactionMode:a,infusionAura:n}){var r,l,s,o,c;const d=null!=(r=e.info.variant)?r:"physical",{t:u}=(0,b.$G)("page_character");if(!["pyro","hydro","cryo","electro","dendro"].some((e=>e===d||e===n)))return null;const h=[...new Set([...null!=(l=O.oR[d])?l:[],...null!=(s=O.oR[null!=n?n:""])?s:[],...null!=(o=O.p7[d])?o:[],...null!=(c=O.p7[null!=n?n:""])?c:[]])],Z=t?[...i.Mk].includes(t)?(0,D.tZ)(R.Z,{reaction:t}):(0,D.tZ)(I,{reaction:t}):u(Ye||(Ye=Qe`noReaction`));return(0,D.BX)(L.Z,{title:Z,sx:{ml:"auto"},children:[(0,D.tZ)(X.Z,{value:"",disabled:!t,onClick:()=>a(),children:"No Reactions"}),h.map((e=>(0,D.tZ)(X.Z,{disabled:t===e,onClick:()=>a(e),children:[...i.Mk].includes(e)?(0,D.tZ)(R.Z,{reaction:e}):(0,D.tZ)(I,{reaction:e})},e)))]})}function Zt({setTarget:e}){const{t}=(0,b.$G)("page_character"),[a,i,r]=(0,n.aV)(!1),l=(0,x.useCallback)(((t,a)=>{r(),e(t,a)}),[r,e]);return(0,D.BX)(D.HY,{children:[(0,D.tZ)(g.Z,{fullWidth:!0,onClick:i,startIcon:(0,D.tZ)(se.Z,{}),sx:{mb:1},children:t(Je||(Je=Qe`multiTarget.addNewTarget`))}),(0,D.tZ)(Ne,{showEmptyTargets:!0,flatOnly:!0,excludeHeal:!0,show:a,onClose:r,setTarget:l,excludeSections:["basic","custom"]})]})}const pt=(0,we.ZP)("textarea")({width:"100%",fontFamily:"monospace",resize:"vertical",minHeight:"2em"});function mt({customMultiTarget:e,setCustomMultiTarget:t}){const[a,n]=(0,x.useState)(JSON.stringify(e)),[i,r]=(0,x.useState)("");(0,x.useEffect)((()=>{r(""),n(JSON.stringify(e))}),[e,n]);const l=(0,x.useCallback)((()=>navigator.clipboard.writeText(a).then((()=>alert("Copied configuration to clipboard."))).catch(console.error)),[a]),s=(0,x.useCallback)((e=>{r(""),n(e);try{const a=it(JSON.parse(e));a?t(a):r("Invalid Multi-Optimization Config")}catch(a){a instanceof Error&&r(a.message)}}),[n,t]);return(0,D.BX)(h.Z,{children:[(0,D.BX)(h.Z,{display:"flex",gap:1,children:[(0,D.tZ)(pt,{value:a,sx:{outlineColor:i?"red":void 0},onClick:e=>{const t=e.target;t.selectionStart=0,t.selectionEnd=t.value.length},onChange:e=>s(e.target.value)}),(0,D.tZ)(g.Z,{color:"info",disabled:!!i,onClick:l,children:(0,D.tZ)(ce.Z,{})})]}),!!i&&(0,D.tZ)(E.Z,{color:"error",children:(0,D.tZ)(pe.Z,{children:i})})]})}var ft=a(80680),gt=a(2180);const xt=x.lazy((()=>a.e(592).then(a.bind(a,37629))));function bt(){var e;const{t}=(0,b.$G)("page_character"),{characterSheet:a,character:{key:n}}=(0,x.useContext)(T.K),[i,r]=(0,x.useState)(!1),l=(0,gt.Z)();return(0,D.BX)(D.HY,{children:[(0,D.tZ)(x.Suspense,{fallback:!1,children:(0,D.tZ)(xt,{show:i,onHide:()=>r(!1),onSelect:l})}),(0,D.tZ)(g.Z,{color:"info",onClick:()=>r(!0),startIcon:(0,D.tZ)(ft.Z,{characterKey:n}),children:null!=(e=null==a?void 0:a.name)?e:t("selectCharacter")})]})}var yt=a(84485),vt=a(4453);function Ct(){const{modalOpen:e}=(0,x.useContext)(H.M),{setFormulaData:t}=(0,x.useContext)(H.M),a=(0,x.useCallback)((()=>null==t?void 0:t(void 0,void 0)),[t]);return(0,D.tZ)(Be.Z,{open:!!e,onClose:a,children:(0,D.BX)(C.Z,{children:[(0,D.tZ)(ze.Z,{title:"Formulas & Calculations",action:(0,D.tZ)(k.Z,{onClick:a})}),(0,D.tZ)(p.Z,{sx:{pt:0},children:(0,D.tZ)(wt,{})})]})})}function wt(){const{data:e}=(0,x.useContext)(j.R),{data:t}=(0,x.useContext)(H.M),a=Re(null!=t?t:e);return(0,D.tZ)(x.Suspense,{fallback:(0,D.tZ)(Z.Z,{variant:"rectangular",width:"100%",height:1e3}),children:(0,D.tZ)(h.Z,{sx:{mr:-1,mb:-1},children:a.map((([e,t])=>(0,D.tZ)(kt,{displayNs:t,sectionKey:e},e)))})})}function kt({sectionKey:e,displayNs:t}){const{data:a}=(0,x.useContext)(j.R),{database:n}=(0,x.useContext)(Q.t),{data:i}=(0,x.useContext)(H.M),r=(0,x.useMemo)((()=>Ie(null!=i?i:a,e,n)),[n,i,a,e]);if(!r)return null;if(Object.entries(t).every((([e,t])=>t.isEmpty)))return null;const{title:l,icon:s,action:o}=r;return(0,D.BX)(w.Z,{sx:{mb:1},children:[(0,D.tZ)(vt.Z,{avatar:s&&(0,D.tZ)(Ke.Z,{size:2,src:s}),title:l,action:o&&(0,D.tZ)(M.Z,{children:o})}),(0,D.tZ)(je.Z,{}),(0,D.tZ)(p.Z,{children:Object.entries(t).map((([e,t])=>!t.isEmpty&&(0,D.tZ)(St,{node:t},e)))})]})}function St({node:e}){const{node:t}=(0,x.useContext)(H.M),[a,n]=(0,x.useState)(!1),r=(0,x.useCallback)(((e,t)=>n(t)),[]),l=(0,x.useRef)();return(0,x.useEffect)((()=>{e===t&&setTimeout((()=>{var e;return null==l||null==(e=l.current)||null==e.scrollIntoView?void 0:e.scrollIntoView({behavior:"smooth"})}),300)}),[l,e,t]),(0,D.BX)(me.Z,{sx:{bgcolor:"contentNormal.main"},expanded:e===t||a,onChange:r,ref:l,children:[(0,D.BX)(fe.Z,{expandIcon:(0,D.tZ)(yt.Z,{}),children:[(0,D.BX)(pe.Z,{children:[(0,D.tZ)(E.Z,{color:e.info.variant,children:e.info.name})," ",(0,D.tZ)("strong",{children:(0,_e.p)(e)})]}),i.Mk.includes(e.info.variant)&&(0,D.tZ)(h.Z,{sx:{display:"inline-block",ml:"auto",mr:2},children:(0,D.tZ)(R.Z,{reaction:e.info.variant,trigger:e.info.subVariant})})]}),(0,D.tZ)(ye.Z,{children:e.formulas.map(((e,t)=>(0,D.tZ)(pe.Z,{component:"div",children:e},t)))})]})}var Bt=a(107),Xt=a(15873),_t=a(32510),Tt=a(5658),jt=a(27216),Kt=a(41033),Ot=a(25576),Pt=a(98283),Et=a(85801);const Mt=["expand"],Dt=(0,we.ZP)((e=>{const t=(0,Pt.Z)(e,Mt);return(0,D.tZ)(Et.Z,Object.assign({},t))}))((({theme:e,expand:t})=>({transform:t?"rotate(180deg)":"rotate(0deg)",marginLeft:"auto",transition:e.transitions.create("transform",{duration:e.transitions.duration.shortest})})));var At=a(13900);const It=["name","children","value","placeholder","defaultValue","onValueChange","percent","disabled","onReset"],Rt=(0,we.ZP)(xe.Z)({display:"flex"});function Lt(e){let{name:t,children:a,value:n,placeholder:i,defaultValue:r=0,onValueChange:l,percent:s=!1,disabled:o=!1,onReset:c}=e,d=(0,Pt.Z)(e,It);return(0,D.BX)(Rt,Object.assign({},d,{children:[a,(0,D.tZ)(At.Z,{sx:{px:1},children:t}),(0,D.tZ)(ke.CC,{sx:{flexBasis:"10em",flexGrow:1},children:(0,D.tZ)(ke.ZP,{sx:{px:1},inputProps:{sx:{textAlign:"right"}},float:s,placeholder:i,value:n,onChange:l,disabled:o,endAdornment:s?"%":void 0})}),(0,D.tZ)(g.Z,{sx:{flexShrink:2},size:"small",color:"error",onClick:()=>c?c():l(r),disabled:o||n===r,children:(0,D.tZ)(_t.Z,{})})]}))}let zt,Gt=e=>e;function $t(){const{t:e}=(0,b.$G)("ui"),{characterDispatch:t}=(0,x.useContext)(T.K),{data:a}=(0,x.useContext)(j.R),[n,r]=(0,x.useState)(!1),l=(0,x.useCallback)((()=>r(!n)),[r,n]),s=a.get(K.ri.enemy.level),o=a.get(K.ri.enemy.defRed),c=a.get(K.ri.enemy.defIgn),d=(0,x.useCallback)((()=>t({enemyOverride:{}})),[t]);return(0,D.BX)(w.Z,{children:[(0,D.BX)(p.Z,{sx:{display:"flex",gap:1,alignItems:"center",flexWrap:"wrap"},children:[(0,D.tZ)(ge.Z,{size:"small",color:"success",label:(0,D.BX)("span",{children:[s.info.name," ",(0,D.tZ)("strong",{children:s.value})]})}),i.fR.map((e=>(0,D.tZ)(pe.Z,{children:(0,D.tZ)(Nt,{element:e})},e))),(0,D.BX)(pe.Z,{children:["DEF Red. ",(0,_e.p)(o)]}),(0,D.BX)(pe.Z,{children:["DEF Ignore ",(0,_e.p)(c)]}),(0,D.BX)(h.Z,{flexGrow:1,display:"flex",justifyContent:"flex-end",gap:1,children:[(0,D.tZ)(g.Z,{size:"small",color:"error",onClick:d,startIcon:(0,D.tZ)(_t.Z,{}),children:e(zt||(zt=Gt`reset`))}),(0,D.tZ)(Dt,{expand:n,onClick:l,"aria-expanded":n,"aria-label":"show more",size:"small",sx:{marginLeft:0},children:(0,D.tZ)(yt.Z,{})})]})]}),(0,D.tZ)(Kt.Z,{in:n,timeout:"auto",unmountOnExit:!0,children:(0,D.tZ)(p.Z,{sx:{pt:0},children:(0,D.tZ)(Wt,{})})})]})}function Nt({element:e}){const{data:t}=(0,x.useContext)(j.R),a=t.get(K.ri.enemy[`${e}_res_`]),n=!isFinite(a.value),i=(0,D.tZ)(P.Z,{ele:e,iconProps:S.mX}),r=n?(0,D.BX)("span",{children:[i," \u221e"]}):(0,D.BX)("span",{children:[i," ",(0,D.tZ)("strong",{children:(0,_e.p)(a)})]});return(0,D.tZ)(E.Z,{color:e,children:r})}function Wt({bsProps:e={xs:12,md:6}}){var t,a,n;const{character:{enemyOverride:r},characterDispatch:l}=(0,x.useContext)(T.K),{data:s}=(0,x.useContext)(j.R),o=null!=(t=r.enemyLevel)?t:s.get(K.ri.lvl).value,c=null!=(a=r.enemyDefIgn_)?a:0,d=null!=(n=r.enemyDefRed_)?n:0;return(0,D.BX)(Ce.ZP,{container:!0,spacing:1,children:[(0,D.tZ)(Ce.ZP,Object.assign({item:!0},e,{children:(0,D.tZ)(g.Z,{fullWidth:!0,sx:{height:"100%"},size:"small",component:"a",color:"warning",href:"https://genshin-impact.fandom.com/wiki/Resistance#Base_Enemy_Resistances",target:"_blank",rel:"noreferrer",children:"To get the specific resistance values of enemies, please visit the wiki."})})),(0,D.tZ)(Ce.ZP,Object.assign({item:!0},e,{children:(0,D.tZ)(Lt,{sx:{bgcolor:e=>e.palette.contentLight.main,width:"100%"},name:(0,D.tZ)("b",{children:Ot.ZP.get("enemyLevel")}),value:o,placeholder:Ot.ZP.getStr("enemyLevel"),defaultValue:s.get(K.ri.lvl).value,onValueChange:e=>l({type:"enemyOverride",statKey:"enemyLevel",value:e}),onReset:()=>l({type:"enemyOverride",statKey:"enemyLevel",value:void 0})})})),i.fR.map((t=>{const a=`${t}_enemyRes_`,n=r[a],i=n===Number.MAX_VALUE;return(0,D.tZ)(Ce.ZP,Object.assign({item:!0},e,{children:(0,D.tZ)(Lt,{sx:{bgcolor:e=>e.palette.contentLight.main,width:"100%"},name:(0,D.tZ)(E.Z,{color:t,children:(0,D.tZ)("b",{children:Ot.ZP.get(a)})}),value:void 0!==n?i?1/0:n:10,placeholder:i?"\u221e ":Ot.ZP.getStr(a),defaultValue:10,onValueChange:e=>l({type:"enemyOverride",statKey:a,value:e}),disabled:i,percent:!0,children:(0,D.tZ)(g.Z,{color:t,onClick:()=>l({type:"enemyOverride",statKey:a,value:i?10:Number.MAX_VALUE}),startIcon:i?(0,D.tZ)(Tt.Z,{}):(0,D.tZ)(jt.Z,{}),children:"Immunity"})})}),t)})),(0,D.tZ)(Ce.ZP,Object.assign({item:!0},e,{children:(0,D.tZ)(Lt,{sx:{bgcolor:e=>e.palette.contentLight.main,width:"100%"},name:(0,D.tZ)("b",{children:Ot.ZP.get("enemyDefIgn_")}),value:c,placeholder:Ot.ZP.getStr("enemyDefIgn_"),defaultValue:0,onValueChange:e=>l({type:"enemyOverride",statKey:"enemyDefIgn_",value:e}),percent:!0})})),(0,D.tZ)(Ce.ZP,Object.assign({item:!0},e,{children:(0,D.tZ)(Lt,{sx:{bgcolor:e=>e.palette.contentLight.main,width:"100%"},name:(0,D.tZ)("b",{children:Ot.ZP.get("enemyDefRed_")}),value:d,placeholder:Ot.ZP.getStr("enemyDefRed_"),defaultValue:0,onValueChange:e=>l({type:"enemyOverride",statKey:"enemyDefRed_",value:e}),percent:!0})})),(0,D.tZ)(Ce.ZP,{item:!0,xs:12,children:(0,D.tZ)("small",{children:"Note: Genshin Impact halves resistance shred values below 0%. For the sake of calculations enter the RAW value and GO will do the rest. (e.g. 10% - 20% = -10%)"})})]})}let Ft,Vt=e=>e;const qt={xs:1,md:2,lg:3};function Ht({open:e,onClose:t}){const{t:a}=(0,b.$G)("page_character");return(0,D.tZ)(Be.Z,{open:e,onClose:t,children:(0,D.BX)(C.Z,{children:[(0,D.tZ)(ze.Z,{title:a(Ft||(Ft=Vt`addStats.title`)),action:(0,D.tZ)(k.Z,{onClick:t})}),(0,D.tZ)(p.Z,{sx:{pt:0},children:(0,D.BX)(Te.Z,{spacing:1,children:[(0,D.tZ)(Jt,{}),(0,D.tZ)($t,{}),(0,D.tZ)(ra,{})]})})]})})}const Ut=[...K.lR],Yt=(e,t)=>(0,D.tZ)(Ce.ZP,{item:!0,xs:1,children:e},t);function Jt(){const{t:e}=(0,b.$G)("page_character"),{character:{bonusStats:t},characterDispatch:a}=(0,x.useContext)(T.K),n=(0,x.useCallback)((e=>a({bonusStats:e})),[a]);return(0,D.tZ)(w.Z,{children:(0,D.tZ)(p.Z,{sx:{display:"flex"},children:(0,D.BX)(Ce.ZP,{container:!0,columns:qt,sx:{pt:1},spacing:1,children:[(0,D.tZ)(Ce.ZP,{item:!0,xs:12,children:(0,D.tZ)(Bt.Z,{severity:"info",variant:"filled",children:(0,D.BX)(b.cC,{i18nKey:"addStats.info",t:e,children:["You can use these fields to add buffs/debuffs not directly supported in GO, such as food buffs, abyss cards, or Superconduct. Please refer to the",(0,D.tZ)("a",{href:"https://genshin-impact.fandom.com/wiki/Genshin_Impact_Wiki",children:"Genshin Impact Wiki"}),"for specific values."]})})}),(0,D.tZ)(Xe.Z,{statKeys:Ut,statFilters:t,setStatFilters:n,wrapperFunc:Yt,label:e("addStats.label")})]})})})}const Qt=["eleMas","critRate_","critDMG_","enerRech_","heal_"],ea=["hp","atk","def",...Qt].map((e=>K.ri.total[e])),ta=["atk_","atk","hp_","hp","def_","def",...Qt],aa=[...Ot.hX,...Ot.Sx,"stamina","incHeal_","shield_","cdRed_"],na=K.lR.filter((e=>!ta.includes(e)&&!aa.includes(e)));function ia({nodes:e,extra:t}){const{data:a,oldData:n}=(0,x.useContext)(j.R);return(0,D.BX)($e.lD,{children:[e.map((e=>{var t;return(0,D.tZ)($e.JW,{component:Xt.ZP,node:a.get(e),oldValue:null==n||null==(t=n.get(e))?void 0:t.value},JSON.stringify(e.info))})),t]})}function ra(){const{characterSheet:e}=(0,x.useContext)(T.K),{data:t}=(0,x.useContext)(j.R),a=t.get(K.ri.special),n=e.elementKey,i=e.isMelee(),r=(0,x.useMemo)((()=>aa.filter((e=>!e.includes(n)&&(i&&e.includes("physical"),!0))).map((e=>K.ri.total[e])).filter((e=>!!t.get(e).value))),[t,n,i]),l=(0,x.useMemo)((()=>na.map((e=>K.ri.total[e])).filter((e=>t.get(e).value))),[t]);return(0,D.tZ)(w.Z,{children:(0,D.tZ)(p.Z,{children:(0,D.BX)(Ce.ZP,{container:!0,columns:qt,spacing:1,children:[(0,D.tZ)(Ce.ZP,{item:!0,xs:1,children:(0,D.tZ)(la,{title:"Main Stats",children:(0,D.tZ)(ia,{nodes:ea,extra:a&&(0,D.BX)(Xt.ZP,{sx:{display:"flex",justifyContent:"space-between"},children:[(0,D.BX)("span",{children:[(0,D.tZ)("b",{children:"Special:"})," ",(0,D.BX)(E.Z,{color:a.info.variant,children:[a.info.icon," ",a.info.name]})]}),(0,D.tZ)("span",{children:(0,_e.p)(a)})]})})})}),(0,D.tZ)(Ce.ZP,{item:!0,xs:1,children:(0,D.tZ)(la,{title:"Other Stats",children:(0,D.tZ)(ia,{nodes:r})})}),!!l.length&&(0,D.tZ)(Ce.ZP,{item:!0,xs:1,children:(0,D.tZ)(la,{title:"Misc Stats",children:(0,D.tZ)(ia,{nodes:l})})})]})})})}function la({title:e,children:t}){return(0,D.BX)(C.Z,{children:[(0,D.tZ)(p.Z,{sx:{py:1},children:(0,D.tZ)(h.Z,{display:"flex",justifyContent:"space-between",children:(0,D.tZ)(pe.Z,{variant:"subtitle1",children:e})})}),t]})}var sa=a(54522),oa=a(36269),ca=a(46342),da=a(62469),ua=a(85162),ha=a(51290),Za=a(45269),pa=a(11615),ma=a(23119);function fa(){const{t:e}=(0,b.$G)("page_character_optimize");return(0,D.tZ)(Bt.Z,{severity:"warning",variant:"filled",children:(0,D.BX)(b.cC,{t:e,i18nKey:"noArtis",children:["Oops! It looks like you haven't added any artifacts to GO yet! You should go to the",(0,D.tZ)(ma.Z,{component:v.rU,to:"/artifacts",children:"Artifacts"}),"page and add some!"]})})}const ga=(0,x.createContext)(void 0);var xa=a(2754),ba=a(93290);var ya=a(64985),va=a(6094);function Ca(e,t,a=!1){const n=new Set,r=new Set;function l(e,t){return t?n.add(e):e.operands.forEach((e=>n.has(e)&&r.add(e))),e}const s=new Set;if(e=(0,ya.uW)(e,(e=>e),(e=>{const{operation:t}=e;switch(t){case"read":return s.add(e.path[1]),l(e,!0);case"add":{const t=e.operands.filter((e=>n.has(e))),a=e.operands.filter((e=>!n.has(e)));if(0===a.length)return l(e,!0);if(t.length<=1)return l(e,!1);const i=l((0,va.Sm)(...t),!0);return l((0,va.Sm)(i,...a),!1)}case"mul":{const t=e.operands.filter((e=>"const"!==e.operation));return l(e,0===t.length||1===t.length&&n.has(t[0]))}case"const":return l(e,!0);case"res":case"threshold":case"sum_frac":case"max":case"min":return l(e,!1);default:(0,le.UT)(t)}})),e.filter((e=>n.has(e))).forEach((e=>r.add(e))),[...r].every((({operation:e})=>"read"===e||"const"===e))&&Object.keys(t.base).length===s.size)return{nodes:e,arts:t};let o=-1;function c(){for(;s.has(""+ ++o););return`${o}`}const d=[...r].filter((e=>"const"!==e.operation)),u=new Map(d.map((e=>[e,a||"read"!==e.operation||"dyn"!==e.path[0]?(0,va.Cj)(c()):e])));function h(e){const t=(0,ba.CG)([...u.keys()],{dyn:(0,le.vU)(e,(e=>(0,va.a9)(e)))},(e=>!0));return Object.fromEntries([...u.values()].map(((e,a)=>[e.path[1],t[a].value])))}const Z={nodes:e=(0,ya.uW)(e,(e=>{var t;return null!=(t=u.get(e))?t:e}),(e=>e)),arts:{base:h(t.base),values:(0,le.K8)(i.Ex,(e=>t.values[e].map((({id:e,set:t,values:a})=>({id:e,set:t,values:h(a)})))))}},p=Object.entries(h({}));for(const i of Object.values(Z.arts.values))for(const{values:e}of i)for(const[t,a]of p)e[t]-=a;return Z}function wa(e,t,a){var n;let r=!1;const l=!(null!=(n=a.rainbow)&&n.length),s=Object.keys(e.base),o=new Set(Object.entries(a).filter((([e,t])=>t.length)).map((([e])=>e))),c=new Set(Object.entries(a).filter((([e,t])=>t.includes(2)&&!t.includes(4))).map((([e])=>e))),d=(0,le.K8)(i.Ex,(a=>{const n=e.values[a],i=n.filter((e=>{let a=0;return n.every((n=>{const i=s.every((t=>{var a,i;return(null!=(a=n.values[t])?a:0)>=(null!=(i=e.values[t])?i:0)})),r=s.some((t=>{var a,i;return(null!=(a=n.values[t])?a:0)>(null!=(i=e.values[t])?i:0)})),d=i&&(r||n.id>e.id),u=l&&!o.has(n.set)&&!c.has(e.set)||e.set===n.set;return d&&u&&a++,a<t}))}));return i.length!==n.length&&(r=!0),i}));return r?{base:e.base,values:d}:e}function ka(e,t,a){const n=Object.fromEntries(Object.entries(t.base).map((([e,t])=>[e,{min:t,max:t}]))),r={arts:t};for(;;){const t=(0,le.K8)(i.Ex,(e=>Xa(r.arts.values[e]))),l=(0,le.K8)(i.Ex,(e=>Ba(Object.entries(t).map((t=>t[0]===e?n:t[1])).filter((e=>e)))));let s=!1;const o=(0,le.K8)(i.Ex,(t=>{const n=r.arts.values[t].filter((n=>{const i=Ba([Xa([n]),l[t]]),r=_a(e,i);return e.every(((e,t)=>{var n;return r.get(e).max>=(null!=(n=a[t])?n:-1/0)}))}));return n.length!==r.arts.values[t].length&&(s=!0),n}));if(!s)break;r.arts={base:r.arts.base,values:o}}return r.arts}function Sa(e,t){const a=_a(e,Ba([Object.fromEntries(Object.entries(t.base).map((([e,t])=>[e,{min:t,max:t}]))),...Object.values(t.values).map((e=>Xa(e)))]));return(0,ya.uW)(e,(e=>{{const{min:t,max:n}=a.get(e);if(t===n)return(0,va.a9)(t)}const{operation:t}=e,n=e.operands.map((e=>a.get(e)));switch(t){case"threshold":{const[t,a,i,r]=n;if(t.min>=a.max)return e.operands[2];if(t.max<a.min)return e.operands[3];if(i.max===i.min&&r.max===r.min&&i.min===r.min&&isFinite(i.min))return(0,va.a9)(i.max);break}case"min":{const t=e.operands.filter(((e,t)=>{const a=n[t];return n.every((e=>a.min<=e.max))}));if(t.length<n.length)return(0,va.VV)(...t);break}case"max":{const t=e.operands.filter(((e,t)=>{const a=n[t];return n.every((e=>a.max>=e.min))}));if(t.length<n.length)return(0,va.Fp)(...t);break}}return e}),(e=>e))}function Ba(e){const t={};return e.forEach((e=>{Object.entries(e).forEach((([e,a])=>{t[e]?(t[e].min+=a.min,t[e].max+=a.max):t[e]=Object.assign({},a)}))})),t}function Xa(e){const t={};return e.length&&(Object.keys(e[0].values).filter((t=>e.every((e=>e.values[t])))).forEach((a=>t[a]={min:e[0].values[a],max:e[0].values[a]})),e.forEach((({values:e})=>{for(const[a,n]of Object.entries(e))t[a]?(t[a].max<n&&(t[a].max=n),t[a].min>n&&(t[a].min=n)):t[a]={min:0,max:n}}))),t}function _a(e,t){const a=new Map;return(0,ya.aD)(e,(e=>{}),(e=>{var n;const{operation:i}=e,r=e.operands.map((e=>a.get(e)));let l;switch(i){case"read":if("dyn"!==e.path[0])throw new Error(`Found non-dyn path ${e.path} while computing range`);l=null!=(n=t[e.path[1]])?n:{min:0,max:0};break;case"const":l=Ta([e.value]);break;case"add":case"min":case"max":l={min:ba.aj[i](r.map((e=>e.min))),max:ba.aj[i](r.map((e=>e.max)))};break;case"res":l={min:ba.aj[i]([r[0].max]),max:ba.aj[i]([r[0].min])};break;case"mul":l=r.reduce(((e,t)=>Ta([e.min*t.min,e.min*t.max,e.max*t.min,e.max*t.max])));break;case"threshold":l=r[0].min>=r[1].max?r[2]:r[0].max<r[1].min?r[3]:Ta([],[r[2],r[3]]);break;case"sum_frac":{const[e,t]=r,a={min:e.min+t.min,max:e.max+t.max};l=a.min<=0&&a.max>=0?e.min<=0&&e.max>=0?{min:NaN,max:NaN}:{min:-1/0,max:1/0}:Ta([e.min/a.min,e.min/a.max,e.max/a.min,e.max/a.max]);break}default:(0,le.UT)(i)}a.set(e,l)})),a}function Ta(e,t=[]){const a=Math.max(...e,...t.map((e=>e.max)));return{min:Math.min(...e,...t.map((e=>e.min))),max:a}}function ja(e){function t(e){if(Object(e)!==e)return Promise.reject(new TypeError(e+" is not an object."));var t=e.done;return Promise.resolve(e.value).then((function(e){return{value:e,done:t}}))}return ja=function(e){this.s=e,this.n=e.next},ja.prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(e){var a=this.s.return;return void 0===a?Promise.resolve({value:e,done:!0}):t(a.apply(this.s,arguments))},throw:function(e){var a=this.s.return;return void 0===a?Promise.reject(e):t(a.apply(this.s,arguments))}},new ja(e)}class WorkerCoordinator{constructor(e,t,a){this.prio=void 0,this.commands=void 0,this.workers=void 0,this.workDone=new Map,this._workers=void 0,this.cancel=void 0,this.cancelled=void 0,this.callback=void 0,this.notifyNonEmpty=void 0,this.commands=t.map((e=>new le.uZ)),this.prio=new Map(t.map(((e,t)=>[e,t]))),this.callback=a,e.forEach((e=>{e.onmessage=t=>this.onMessage(t.data,e),e.onerror=e=>this.onError(e)})),this._workers=e,this.workers=e.map((e=>Promise.resolve(e))),this.cancel=()=>{},this.cancelled=new Promise(((e,t)=>this.cancel=t)),this.cancelled.catch((t=>e.forEach((e=>e.terminate()))))}async execute(e){var t=this;const a=async function(){var a,n=!1,i=!1;try{for(var r,l=function(e){var t,a,n,i=2;for("undefined"!=typeof Symbol&&(a=Symbol.asyncIterator,n=Symbol.iterator);i--;){if(a&&null!=(t=e[a]))return t.call(e);if(n&&null!=(t=e[n]))return new ja(t.call(e));a="@@asyncIterator",n="@@iterator"}throw new TypeError("Object is not async iterable")}(e);n=!(r=await l.next()).done;n=!1){const e=r.value;t.add(e)}}catch(s){i=!0,a=s}finally{try{n&&null!=l.return&&await l.return()}finally{if(i)throw a}}}();for(;;){var n;const e=null==(n=this.commands.find((e=>e.length)))?void 0:n.pop();if(void 0===e){const e=await Promise.race([new Promise((e=>this.notifyNonEmpty=()=>e(!0))),Promise.all([...this.workers,a]).then((e=>!1)),this.cancelled]);if(this.notifyNonEmpty=void 0,e)continue;break}const{i:t,w:i}=await Promise.race([...this.workers.map(((e,t)=>e.then((e=>({i:t,w:e}))))),this.cancelled]);this.workers[t]=new Promise((e=>this.workDone.set(i,(()=>e(i))))),i.postMessage(e)}}onError(e){this.cancel(new Error(`Worker Error: ${e.message}`))}onMessage(e,t){void 0!==e.command?this.add(e):"done"===e.resultType?this.workDone.get(t)():this.callback(e,t)}add(e){var t;const a=this.prio.get(e.command);this.commands[a].push(e),null==(t=this.notifyNonEmpty)||t.call(this)}broadcast(e){this._workers.forEach((t=>t.postMessage(e)))}notifiedBroadcast(e){this.workers=this.workers.map((e=>e.then((e=>new Promise((t=>{this.workDone.set(e,(()=>t(e)))})))))),this._workers.forEach((t=>t.postMessage(e)))}}class GOSolver extends WorkerCoordinator{constructor(e,t,n){super(Array(n).fill(NaN).map((e=>new Worker(new URL(a.p+a.u(507),a.b)))),["iterate","split","count"],((e,t)=>{switch(e.resultType){case"interim":this.interim(e,t);break;case"finalize":this.finalizedResults.push(e);break;case"count":this.status.total=e.count;break;case"err":this.onError(e)}})),this.maxIterateSize=32e6,this.status=void 0,this.exclusion=void 0,this.topN=void 0,this.buildValues=void 0,this.finalizedResults=[];const{exclusion:i,topN:r}=e;this.status=t,this.exclusion=i,this.topN=r,this.status.total=NaN,this.buildValues=Array(r).fill({w:void 0,val:-1/0}),this.notifiedBroadcast(this.preprocess(e))}async solve(){const{exclusion:e,maxIterateSize:t}=this;return this.finalizedResults=[],await this.execute([{command:"count",exclusion:e,maxIterateSize:t}]),this.notifiedBroadcast({command:"finalize"}),await this.execute([]),this.finalizedResults}preprocess({plotBase:e,optimizationTarget:t,arts:a,topN:n,exclusion:i,constraints:r}){let l=[...(r=r.filter((e=>e.min>-1/0))).map((e=>e.value)),t];const s=[...r.map((e=>e.min)),-1/0];e&&(l.push(e),s.push(-1/0)),l=function(e,t){const a={};for(const[n,i]of Object.entries(t))i.includes(4)&&(a[n]=i.includes(2)?1:3);return(0,ya.uW)(e,(e=>e),(e=>{if("threshold"!==e.operation)return e;const[n,i,r,l]=e.operands;if("read"===n.operation&&"const"===i.operation){const e=n.path[n.path.length-1],s=i.value;if(e in a){if(a[e]<s)return l;if(2===s&&t[e].includes(2))return(0,va.Lj)(n,4,r,l)}}return e}))}(l,i),l=(0,ba.tL)(l,{},(e=>!1)),({nodes:l,arts:a}=function(e,t,a,n,i,r){let l=r;const s={pruneNodeRange:!0},o={pruneNodeRange:!0},c={reaffine:!0},d={pruneOrder:!0,pruneArtRange:!0,pruneNodeRange:!0};let u=0;for(;Object.values(l).some((e=>e))&&u++<20;){if(l.pruneOrder){delete l.pruneOrder;const e=wa(a,n,i);a!==e&&(a=e,l=Object.assign({},l,s))}if(l.pruneArtRange){delete l.pruneArtRange;const n=ka(e,a,t);a!==n&&(a=n,l=Object.assign({},l,o))}if(l.pruneNodeRange){delete l.pruneNodeRange;const t=Sa(e,a);e!==t&&(e=t,l=Object.assign({},l,c))}if(l.reaffine){delete l.reaffine;const{nodes:t,arts:n}=Ca(e,a);e===t&&a===n||(e=t,a=n,l=Object.assign({},l,d))}}return{nodes:e,arts:a}}(l,s,a,n,i,{reaffine:!0,pruneArtRange:!0,pruneNodeRange:!0,pruneOrder:!0})),l=(0,ba.tL)(l,{},(e=>!1)),e&&(e=l.pop());return{command:"setup",arts:a,optTarget:l.pop(),plotBase:e,topN:n,constraints:l.map(((e,t)=>({value:e,min:s[t]})))}}interim(e,t){if(this.status.tested+=e.tested,this.status.failed+=e.failed,this.status.skipped+=e.skipped,e.buildValues){var a,n;const{topN:i}=this,r=null!=(a=this.buildValues[i-1].val)?a:-1/0;this.buildValues.filter((({w:e})=>e!==t)),this.buildValues.push(...e.buildValues.map((e=>({w:t,val:e})))),this.buildValues.sort(((e,t)=>t.val-e.val)).splice(i);const l=null!=(n=this.buildValues[i-1].val)?n:-1/0;r!==l&&this.broadcast({command:"threshold",threshold:l})}}}var Ka=a(2313),Oa=a(96511),Pa=a(79199),Ea=a(91218),Ma=a(42090),Da=a(89279),Aa=a(28265),Ia=a(64303);function Ra(e){const{database:t}=(0,x.useContext)(Q.t),[a,n]=(0,x.useState)((()=>t.buildSettings.get(e)));(0,x.useEffect)((()=>n(t.buildSettings.get(e))),[t,e]),(0,x.useEffect)((()=>t.buildSettings.follow(e,((e,t,a)=>"update"===t&&n(a)))),[e,n,t]);return{buildSetting:a,buildSettingDispatch:(0,x.useCallback)((a=>e&&t.buildSettings.set(e,a)),[e,t])}}let La,za,Ga,$a,Na=e=>e;var Wa=function(e){return e[e.ToggleToAllow=0]="ToggleToAllow",e[e.ToggleToExclude=1]="ToggleToExclude",e}(Wa||{});function Fa({disabled:e=!1,allowListTotal:t}){const{t:a}=(0,b.$G)("page_character_optimize"),{t:r}=(0,b.$G)("page_character"),{character:{key:l}}=(0,x.useContext)(T.K),{silly:s}=(0,x.useContext)(Y.E),{buildSetting:{excludedLocations:o,allowLocationsState:c},buildSettingDispatch:d}=Ra(l),{database:u}=(0,x.useContext)(Q.t),[Z,m,f]=(0,n.aV)(!1),[y,v]=(0,n.NW)(),B=(0,x.useDeferredValue)(y),[X,j]=(0,x.useState)(""),K=(0,x.useDeferredValue)(X),[O,P]=(0,x.useState)([...i.UB]),E=(0,x.useDeferredValue)(O),[A,I]=(0,x.useState)([...i.yd]),R=(0,x.useDeferredValue)(A),[L,G]=(0,x.useState)([...i.ZI]),$=(0,x.useDeferredValue)(L),N=(0,x.useMemo)((()=>B&&Object.fromEntries(Array.from(new Set(Object.entries(u.chars.data).filter((([e])=>(0,i.V7)(e)!==(0,i.V7)(l))).filter((([e])=>(0,le.CZ)({element:E,weaponType:R,rarity:$,name:K},(0,Ia.zU)(u,s))(e))))))),[B,u,l,E,R,$,K,s]),W=Array.from(new Set(Object.entries(N).sort((([e,t],[a,n])=>{const[i,r]=[-1,1],l=u.charMeta.get(e).favorite,s=u.charMeta.get(a).favorite;if(l&&!s)return i;if(s&&!l)return r;const o=Object.values(t.equippedArtifacts).filter((e=>e)).length,c=Object.values(n.equippedArtifacts).filter((e=>e)).length;return o>c?i:c>o?r:e.localeCompare(a)})).map((([e])=>(0,i.V7)(e))))),{elementTotals:F,weaponTypeTotals:V,characterRarityTotals:q,locListTotals:H}=(0,x.useMemo)((()=>{const e={elementTotals:[...i.UB],weaponTypeTotals:[...i.yd],characterRarityTotals:[...i.ZI],locListTotals:["allowed","excluded"]};let t=!1;return(0,Ka.A)(e,(e=>Object.entries(u.chars.data).filter((([e])=>(0,i.V7)(e)!==(0,i.V7)(l))).forEach((([a])=>{const n=(0,J.m)(a,u.gender),r=n.elementKey,l=n.weaponTypeKey,s=n.rarity;if(e.elementTotals[r].total++,N[a]&&e.elementTotals[r].current++,"Traveler"===(0,i.V7)(a)){if(!N[a]&&W.includes("Traveler")){if(e.elementTotals[r].current++,t)return;e.weaponTypeTotals[l].current++,e.characterRarityTotals[s].current++}t=!0}e.weaponTypeTotals[l].total++,N[a]&&e.weaponTypeTotals[l].current++,e.characterRarityTotals[s].total++,N[a]&&e.characterRarityTotals[s].current++;const c=(0,i.V7)(a);W.includes(c)&&(e.locListTotals.allowed.total++,e.locListTotals.excluded.total++,o.includes(c)?e.locListTotals.excluded.current++:e.locListTotals.allowed.current++)}))))}),[N,l,u.chars.data,u.gender,o,W]);(0,x.useEffect)((()=>u.charMeta.followAny((e=>v()))),[v,u]),(0,x.useEffect)((()=>u.chars.followAny((e=>v()))),[v,u]);const[U,ee]=(0,x.useState)(!1),te=(0,x.useCallback)((()=>d({excludedLocations:o.filter((e=>!W.includes(e))),allowLocationsState:"customList"})),[d,o,W]),ae=(0,x.useCallback)((()=>d({excludedLocations:Array.from(new Set(o.concat(W))),allowLocationsState:"customList"})),[d,o,W]),ne=(0,x.useCallback)(((e,t)=>d({allowLocationsState:t})),[d]),ie=(0,x.useCallback)((e=>{const t=[...e],a=t.filter((e=>!o.includes(e))).concat(o.filter((e=>!t.includes(e))));d({excludedLocations:a,allowLocationsState:"customList"})}),[o,d]),re=(0,x.useCallback)((()=>ee(!0)),[]),se=W.length,oe=se-o.length,ce="all"===c?se:"customList"===c?oe===se?oe:`${oe}/${se}`:0,de="all"===c?"success":"customList"===c?"info":"secondary";return(0,D.BX)(h.Z,{display:"flex",gap:1,children:[(0,D.tZ)(Be.Z,{open:Z,onClose:f,containerProps:{maxWidth:"xl"},draggable:!1,onMouseUp:re,children:(0,D.BX)(C.Z,{children:[(0,D.tZ)(p.Z,{children:(0,D.BX)(h.Z,{display:"flex",gap:1,alignItems:"center",children:[(0,D.tZ)(pe.Z,{variant:"h6",children:a(La||(La=Na`excludeChar.title`))}),(0,D.tZ)(Se.Z,{title:(0,D.tZ)(pe.Z,{children:a(za||(za=Na`excludeChar.tooltip`))})}),(0,D.tZ)(h.Z,{flexGrow:1}),(0,D.tZ)(k.Z,{onClick:f,size:"small"})]})}),(0,D.tZ)(je.Z,{}),(0,D.tZ)(p.Z,{sx:{pb:0},children:(0,D.BX)(Te.Z,{gap:1,children:[(0,D.BX)(h.Z,{display:"flex",gap:1,flexWrap:"wrap",children:[(0,D.tZ)(z.Z,{exclusive:!0,baseColor:"secondary",size:"small",value:c,onChange:ne,children:sa.Cz.map((t=>(0,D.tZ)(_.Z,{value:t,disabled:c===t||e,children:a(`excludeChar.states.${t}`)},t)))}),(0,D.tZ)(ve.Z,{autoFocus:!0,value:X,onChange:e=>j(e.target.value),label:r("characterName"),size:"small",sx:{height:"100%"},InputProps:{sx:{height:"100%"}}})]}),(0,D.BX)(h.Z,{display:"flex",gap:1,flexWrap:"wrap",children:[(0,D.tZ)(Aa.Z,{sx:{height:"100%"},onChange:I,value:R,totals:V,size:"small"}),(0,D.tZ)(Da.Z,{sx:{height:"100%"},onChange:P,value:E,totals:F,size:"small"}),(0,D.tZ)(Ma.Z,{sx:{height:"100%"},onChange:G,value:$,totals:q,size:"small"})]})]})}),(0,D.BX)(p.Z,{sx:{opacity:"customList"===c?1:.6},children:[(0,D.BX)(Ce.ZP,{container:!0,pb:1,gap:1,flexWrap:"nowrap",children:[(0,D.tZ)(Ce.ZP,{item:!0,xs:6,children:(0,D.BX)(g.Z,{color:"success",fullWidth:!0,onClick:te,children:[a(Ga||(Ga=Na`excludeChar.modal.allow_all`)),(0,D.tZ)(M.Z,{sx:{ml:1},children:(0,D.tZ)("strong",{children:H.allowed})})]})}),(0,D.tZ)(Ce.ZP,{item:!0,xs:6,children:(0,D.BX)(g.Z,{fullWidth:!0,color:"error",onClick:ae,children:[a($a||($a=Na`excludeChar.modal.disallow_All`)),(0,D.tZ)(M.Z,{sx:{ml:1},children:(0,D.tZ)("strong",{children:H.excluded})})]})})]}),(0,D.tZ)(Va,{locList:W,excludedLocations:o,mouseUpDetected:U,setMouseUpDetected:ee,toggleList:ie})]})]})}),(0,D.BX)(w.Z,{sx:{display:"flex",width:"100%"},children:[(0,D.tZ)(p.Z,{sx:{flexGrow:1},children:(0,D.BX)(Te.Z,{spacing:1,children:[(0,D.tZ)(pe.Z,{children:(0,D.tZ)("strong",{children:a("excludeChar.title")})}),(0,D.BX)(pe.Z,{children:[a("excludeChar.usingState")," ",(0,D.tZ)(M.Z,{color:de,children:a(`excludeChar.states.${c}`)})]}),(0,D.BX)(pe.Z,{children:[a("excludeChar.chars")," ",(0,D.BX)(M.Z,{color:"success",children:[ce," ",(0,D.tZ)(Oa.Z,Object.assign({},S.mX)),a("artSetConfig.allowed")]})]}),(0,D.BX)(pe.Z,{children:[a("excludeChar.artis")," ",(0,D.BX)(M.Z,{color:"success",children:[t," ",(0,D.tZ)(Oa.Z,Object.assign({},S.mX)),a("artSetConfig.allowed")]})]})]})}),(0,D.tZ)(g.Z,{sx:{borderRadius:0,flexShrink:1,minWidth:40},onClick:m,disabled:e,color:"info",children:(0,D.tZ)(Ze.Z,{})})]})]})}function Va({locList:e,excludedLocations:t,mouseUpDetected:a,setMouseUpDetected:n,toggleList:i}){const[r,l]=(0,x.useState)(new Set),[s,o]=(0,x.useState)();return(0,x.useEffect)((()=>{a&&(n(!1),r.size>0&&(i(r),l(new Set),o(void 0)))}),[r,l,n,a,i]),(0,D.tZ)(Ce.ZP,{container:!0,spacing:1,columns:{xs:6,sm:7,md:10,lg:12,xl:16},children:e.map((e=>(0,D.tZ)(Ce.ZP,{item:!0,xs:1,children:(0,D.tZ)(qa,{locKey:e,charList:r,charListMode:s,setCharList:l,setCharListMode:o,selected:!t.includes(e)})},e)))})}function qa({locKey:e,selected:t,charList:a,charListMode:n,setCharList:r,setCharListMode:l}){const{database:s}=(0,x.useContext)(Q.t),o=s.chars.get(s.chars.LocationToCharacterKey(e)),c=(0,x.useCallback)((i=>1===i.buttons&&(n===Wa.ToggleToAllow&&!t||n===Wa.ToggleToExclude&&t)&&r(new Set([...a]).add(e))),[n,t,r,a,e]),d=(0,x.useCallback)((()=>{const n=t?Wa.ToggleToExclude:Wa.ToggleToAllow;l(n),r(new Set([...a]).add(e))}),[t,l,r,a,e]),u=(0,x.useMemo)((()=>0!==a.size),[a.size]),Z=t&&!(n===Wa.ToggleToExclude&&a.has(e))||n===Wa.ToggleToAllow&&a.has(e),p={opacity:Z?void 0:.6,borderColor:Z?"rgb(100,200,100)":"rgb(200,100,100)",borderWidth:"3px",borderStyle:"solid",borderRadius:"8px"},m=(0,x.useMemo)((()=>(0,D.tZ)(h.Z,{fontSize:"0.85em",display:"flex",justifyContent:"space-between",p:.3,children:i.Ex.map((e=>(0,D.tZ)(Pa.Z,{slotKey:e,iconProps:{fontSize:"inherit",sx:{opacity:null!=o&&o.equippedArtifacts[e]?void 0:.5}}},e)))})),[null==o?void 0:o.equippedArtifacts]);return(0,D.BX)(w.Z,{sx:p,children:[(0,D.tZ)(Ea.Z,{characterKey:s.chars.LocationToCharacterKey(e),onMouseDown:d,onMouseEnter:c,disableTooltip:u}),m]})}var Ha=a(38114),Ua=a(78437),Ya=a(14836);function Ja({setKey:e,setNumKey:t,hideHeader:a=!1,conditionalsOnly:n=!1,disabled:i=!1}){var r;const l=(0,Pe.Sk)(e),s=n?null==(r=l.setEffectDocument(t))?void 0:r.filter((e=>"states"in e)):l.setEffectDocument(t);return(0,D.tZ)(h.Z,{display:"flex",flexDirection:"column",children:s?(0,D.tZ)(Ya.Z,{sections:s,hideHeader:a,disabled:i}):null})}var Qa=a(1665);let en,tn,an=e=>e;function nn({setKey:e,buttonGroupSx:t}){var a;const{t:n}=(0,b.$G)("sheet"),{character:{key:i}}=(0,x.useContext)(T.K),{buildSetting:{artSetExclusion:r},buildSettingDispatch:l}=Ra(i),s=null!=(a=null==r?void 0:r[e])?a:[],o=s.includes(2),c=s.includes(4);return(0,D.BX)(xe.Z,{sx:t,fullWidth:!0,children:[(0,D.tZ)(g.Z,{startIcon:o?(0,D.tZ)(jt.Z,{}):(0,D.tZ)(Tt.Z,{}),onClick:()=>l({artSetExclusion:(0,sa.sL)(r,e,2)}),color:o?"secondary":"success",endIcon:o?(0,D.tZ)(Ha.Z,{}):(0,D.tZ)(Oa.Z,{}),children:n(en||(en=an`2set`))}),(0,D.tZ)(g.Z,{startIcon:c?(0,D.tZ)(jt.Z,{}):(0,D.tZ)(Tt.Z,{}),onClick:()=>l({artSetExclusion:(0,sa.sL)(r,e,4)}),color:c?"secondary":"success",endIcon:c?(0,D.tZ)(Ha.Z,{}):(0,D.tZ)(Oa.Z,{}),children:n(tn||(tn=an`4set`))})]})}let rn,ln,sn,on,cn,dn,un,hn,Zn,pn,mn,fn,gn,xn,bn=e=>e;function yn({disabled:e}){var t,a;const{t:r}=(0,b.$G)(["page_character_optimize","sheet"]),l=(0,x.useContext)(j.R),{database:s}=(0,x.useContext)(Q.t),{character:{key:o,conditional:c},characterDispatch:d}=(0,x.useContext)(T.K),{buildSetting:{artSetExclusion:u},buildSettingDispatch:Z}=Ra(o),[m,f]=(0,x.useState)(!1),y=(0,x.useCallback)((()=>f(!0)),[f]),v=(0,x.useCallback)((()=>f(!1)),[f]),[B,X]=(0,n.NW)();(0,x.useEffect)((()=>s.arts.followAny(X)),[s,X]);const _=(0,x.useMemo)((()=>Object.entries(Pe.WO).reverse().flatMap((([,e])=>e)).filter((e=>!e.includes("Prayers")))),[]),{artKeys:K,artSlotCount:O}=(0,x.useMemo)((()=>{const e=(0,le.K8)(_,(e=>(0,le.K8)(i.Ex,(e=>0))));s.arts.values.forEach((t=>e[t.setKey]&&e[t.setKey][t.slotKey]++));const t=[..._].sort(((t,a)=>+(wn(e[t])<2)-+(wn(e[a])<2)));return B&&{artKeys:t,artSlotCount:e}}),[B,s,_]),P=!(null!=(t=u.rainbow)&&t.includes(2)),A=!(null!=(a=u.rainbow)&&a.includes(4)),{allowTotals:I}=(0,x.useMemo)((()=>(0,Ka.A)({allowTotals:["2","4"]},(e=>_.forEach((t=>{var a,n;e.allowTotals[2].total++,null!=(a=u[t])&&a.includes(2)||e.allowTotals[2].current++,e.allowTotals[4].total++,null!=(n=u[t])&&n.includes(4)||e.allowTotals[4].current++}))))),[_,u]),R=(0,x.useMemo)((()=>Object.keys(c).filter((e=>{var t;return i.Gt.includes(e)&&!!Object.keys(null!=(t=c[e])?t:{}).length})).length),[c]),L=(0,x.useMemo)((()=>Object.assign({},l,{data:new _e.w(Object.assign({},l.data.data[0],{artSet:(0,le.K8)(i.Gt,(e=>(0,va.a9)(4)))}),void 0)})),[l]),z=(0,x.useCallback)((()=>{const e=Object.fromEntries(Object.entries(c).filter((([e])=>!i.Gt.includes(e))));d({conditional:e})}),[c,d]),G=(0,x.useCallback)(((e,t=!0)=>{const a=(0,le.I8)(u);_.forEach((n=>{var i;t?a[n]=[...null!=(i=a[n])?i:[],e]:a[n]&&(a[n]=a[n].filter((t=>t!==e)))})),Z({artSetExclusion:a})}),[_,u,Z]);return(0,D.BX)(D.HY,{children:[(0,D.BX)(w.Z,{sx:{display:"flex",width:"100%"},children:[(0,D.BX)(p.Z,{sx:{flexGrow:1},children:[(0,D.tZ)(pe.Z,{children:(0,D.tZ)("strong",{children:r(rn||(rn=bn`artSetConfig.title`))})}),(0,D.BX)(Te.Z,{spacing:1,children:[(0,D.BX)(pe.Z,{children:[r(ln||(ln=bn`artSetConfig.setEffCond`))," ",(0,D.BX)(M.Z,{color:R?"success":"warning",children:[R," ",r("artSetConfig.enabled")]})]}),(0,D.BX)(pe.Z,{children:[r(sn||(sn=bn`sheet:2set`))," ",(0,D.BX)(M.Z,{color:"success",children:[I[2]," ",(0,D.tZ)(Oa.Z,Object.assign({},S.mX))," ",r("artSetConfig.allowed")]})]}),(0,D.BX)(pe.Z,{children:[r(on||(on=bn`sheet:4set`))," ",(0,D.BX)(M.Z,{color:"success",children:[I[4]," ",(0,D.tZ)(Oa.Z,Object.assign({},S.mX))," ",r("artSetConfig.allowed")]})]}),(0,D.BX)(pe.Z,{children:[r(cn||(cn=bn`artSetConfig.2rainbow`))," ",(0,D.BX)(M.Z,{color:P?"success":"secondary",children:[P?(0,D.tZ)(Oa.Z,Object.assign({},S.mX)):(0,D.tZ)(Ha.Z,Object.assign({},S.mX))," ",P?r("artSetConfig.allowed"):"Excluded"]})]}),(0,D.BX)(pe.Z,{children:[r(dn||(dn=bn`artSetConfig.4rainbow`))," ",(0,D.BX)(M.Z,{color:A?"success":"secondary",children:[A?(0,D.tZ)(Oa.Z,Object.assign({},S.mX)):(0,D.tZ)(Ha.Z,Object.assign({},S.mX))," ",A?r("artSetConfig.allowed"):"Excluded"]})]})]})]}),(0,D.tZ)(g.Z,{onClick:y,disabled:e,color:"info",sx:{borderRadius:0,flexShrink:1,minWidth:40},children:(0,D.tZ)(Ze.Z,{})})]}),(0,D.tZ)(Be.Z,{open:m,onClose:v,children:(0,D.BX)(C.Z,{children:[(0,D.BX)(p.Z,{sx:{display:"flex",gap:1,justifyContent:"space-between"},children:[(0,D.tZ)(pe.Z,{variant:"h6",children:r(un||(un=bn`artSetConfig.title`))}),(0,D.tZ)(k.Z,{onClick:v})]}),(0,D.tZ)(je.Z,{}),(0,D.BX)(p.Z,{children:[(0,D.tZ)(w.Z,{sx:{mb:1},children:(0,D.BX)(p.Z,{children:[(0,D.BX)(h.Z,{display:"flex",gap:1,children:[(0,D.tZ)(pe.Z,{children:(0,D.tZ)("strong",{children:r(hn||(hn=bn`artSetConfig.modal.setCond.title`))})}),(0,D.tZ)(pe.Z,{sx:{flexGrow:1},children:(0,D.BX)(M.Z,{color:R?"success":"warning",children:[R," ",r("artSetConfig.selected")]})}),(0,D.tZ)(g.Z,{size:"small",onClick:z,color:"error",startIcon:(0,D.tZ)(_t.Z,{}),children:r(Zn||(Zn=bn`artSetConfig.modal.setCond.reset`))})]}),(0,D.tZ)(pe.Z,{children:r(pn||(pn=bn`artSetConfig.modal.setCond.text`))})]})}),(0,D.tZ)(w.Z,{sx:{mb:1},children:(0,D.BX)(p.Z,{children:[(0,D.tZ)(pe.Z,{sx:{flexGrow:1},children:(0,D.tZ)("strong",{children:(0,D.BX)(b.cC,{t:r,i18nKey:"artSetConfig.modal.ArtSetFilter.title",children:["Artifact Sets ",(0,D.BX)(E.Z,{color:"success",children:["Allowed",(0,D.tZ)(Oa.Z,Object.assign({},S.mX))]})," / ",(0,D.BX)(E.Z,{color:"secondary",variant:"light",children:["Excluded",(0,D.tZ)(Ha.Z,Object.assign({},S.mX))]})]})})}),(0,D.tZ)(pe.Z,{children:(0,D.BX)(b.cC,{t:r,i18nKey:"artSetConfig.modal.ArtSetFilter.intro",children:["You can allow/exclude which sets you want the builder to consider. In the following examples, ",(0,D.tZ)("strong",{children:"A"})," is on-set, and ",(0,D.tZ)("strong",{children:"R"})," is rainbow(off-set)"]})}),(0,D.tZ)(pe.Z,{children:(0,D.BX)(b.cC,{t:r,i18nKey:"artSetConfig.modal.ArtSetFilter.2set",children:[(0,D.tZ)("strong",{children:(0,D.BX)(E.Z,{color:"secondary",variant:"light",children:["Excluding",(0,D.tZ)(Ha.Z,Object.assign({},S.mX))," 2-Set"]})}),"would exclude 2-Set builds:",(0,D.BX)("strong",{children:[(0,D.tZ)(E.Z,{color:"secondary",variant:"light",children:"AA"}),"RRR"]}),"and",(0,D.BX)("strong",{children:[(0,D.tZ)(E.Z,{color:"secondary",variant:"light",children:"AAA"}),"RR"]}),"."]})}),(0,D.tZ)(pe.Z,{children:(0,D.BX)(b.cC,{t:r,i18nKey:"artSetConfig.modal.ArtSetFilter.4set",children:[(0,D.tZ)("strong",{children:(0,D.BX)(E.Z,{color:"secondary",variant:"light",children:["Excluding",(0,D.tZ)(Ha.Z,Object.assign({},S.mX))," 4-Set"]})}),"would exclude 4-Set builds:",(0,D.BX)("strong",{children:[(0,D.tZ)(E.Z,{color:"secondary",variant:"light",children:"AAAA"}),"R"]}),"and",(0,D.tZ)("strong",{children:(0,D.tZ)(E.Z,{color:"secondary",variant:"light",children:"AAAAA"})}),"."]})}),(0,D.tZ)(pe.Z,{children:(0,D.BX)(b.cC,{t:r,i18nKey:"artSetConfig.modal.ArtSetFilter.2rain",children:[(0,D.tZ)("strong",{children:(0,D.BX)(E.Z,{color:"secondary",variant:"light",children:["Excluding",(0,D.tZ)(Ha.Z,Object.assign({},S.mX))," 3-Rainbow"]})}),"would exclude 2-Set + 3-Rainbow builds:",(0,D.BX)("strong",{children:["AA",(0,D.tZ)(E.Z,{color:"secondary",variant:"light",children:"RRR"})]}),"and",(0,D.BX)("strong",{children:["AAA",(0,D.tZ)(E.Z,{color:"secondary",variant:"light",children:"RR"})]}),"."]})}),(0,D.tZ)(pe.Z,{children:(0,D.BX)(b.cC,{t:r,i18nKey:"artSetConfig.modal.ArtSetFilter.4rain",children:[(0,D.tZ)("strong",{children:(0,D.BX)(E.Z,{color:"secondary",variant:"light",children:["Excluding",(0,D.tZ)(Ha.Z,Object.assign({},S.mX))," 5-Rainbow"]})}),"would exclude full 5-Rainbow builds:",(0,D.tZ)("strong",{children:(0,D.tZ)(E.Z,{color:"secondary",variant:"light",children:"RRRRR"})}),"."]})})]})}),(0,D.BX)(Ce.ZP,{container:!0,columns:{xs:2,lg:3},sx:{mb:1},spacing:1,children:[(0,D.tZ)(Ce.ZP,{item:!0,xs:1,children:(0,D.tZ)(vn,{allowTotal:I[2],setNum:2,setAllExclusion:G})}),(0,D.tZ)(Ce.ZP,{item:!0,xs:1,children:(0,D.tZ)(vn,{allowTotal:I[4],setNum:4,setAllExclusion:G})}),(0,D.tZ)(Ce.ZP,{item:!0,xs:1,children:(0,D.tZ)(w.Z,{children:(0,D.BX)(p.Z,{children:[(0,D.tZ)(pe.Z,{gutterBottom:!0,children:(0,D.tZ)("strong",{children:(0,D.BX)(b.cC,{t:r,i18nKey:"artSetConfig.alExRainbow",children:[(0,D.BX)(E.Z,{color:"success",children:["Allow ",(0,D.tZ)(Oa.Z,Object.assign({},S.mX))]})," / ",(0,D.BX)(E.Z,{color:"secondary",variant:"light",children:["Exclude ",(0,D.tZ)(Ha.Z,Object.assign({},S.mX))]})," Rainbow Builds"]})})}),(0,D.BX)(h.Z,{sx:{display:"flex",flexDirection:"column",gap:1},children:[(0,D.tZ)(g.Z,{fullWidth:!0,onClick:()=>Z({artSetExclusion:(0,sa.sL)(u,"rainbow",2)}),color:P?"success":"secondary",startIcon:P?(0,D.tZ)(Tt.Z,{}):(0,D.tZ)(jt.Z,{}),endIcon:P?(0,D.tZ)(Oa.Z,{}):(0,D.tZ)(Ha.Z,{}),children:r(mn||(mn=bn`artSetConfig.2rainbow`))}),(0,D.tZ)(g.Z,{fullWidth:!0,onClick:()=>Z({artSetExclusion:(0,sa.sL)(u,"rainbow",4)}),color:A?"success":"secondary",startIcon:A?(0,D.tZ)(Tt.Z,{}):(0,D.tZ)(jt.Z,{}),endIcon:A?(0,D.tZ)(Oa.Z,{}):(0,D.tZ)(Ha.Z,{}),children:r(fn||(fn=bn`artSetConfig.4rainbow`))})]})]})})})]}),(0,D.tZ)(Ce.ZP,{container:!0,spacing:1,columns:{xs:2,lg:3},children:K.map((e=>(0,D.tZ)(Cn,{setKey:e,fakeDataContextObj:L,slotCount:O[e]},e)))})]}),(0,D.tZ)(je.Z,{}),(0,D.tZ)(p.Z,{sx:{py:1},children:(0,D.tZ)(k.Z,{large:!0,onClick:v})})]})})]})}function vn({allowTotal:e,setNum:t,setAllExclusion:a}){const{t:n}=(0,b.$G)(["page_character_optimize","sheet"]);return(0,D.tZ)(w.Z,{children:(0,D.BX)(p.Z,{children:[(0,D.BX)(pe.Z,{gutterBottom:!0,children:[(0,D.tZ)("strong",{children:n(`sheet:${t}set`)})," ",(0,D.BX)(M.Z,{color:"success",children:[e," ",(0,D.tZ)(Oa.Z,Object.assign({},S.mX))," ",n("artSetConfig.allowed")]})]}),(0,D.BX)(h.Z,{sx:{display:"flex",flexDirection:"column",gap:1},children:[(0,D.tZ)(g.Z,{fullWidth:!0,disabled:"0"!==e.charAt(0)&&-1===e.indexOf("/"),onClick:()=>a(t,!1),color:"success",startIcon:(0,D.tZ)(Oa.Z,{}),children:n(`artSetConfig.allowAll${t}set`)}),(0,D.tZ)(g.Z,{fullWidth:!0,disabled:"0"===e.charAt(0),onClick:()=>a(t,!0),color:"secondary",startIcon:(0,D.tZ)(Ha.Z,{}),children:n(`artSetConfig.excludeAll${t}set`)})]})]})})}function Cn({setKey:e,fakeDataContextObj:t,slotCount:a}){var n,i;const{t:r}=(0,b.$G)("sheet"),{character:{key:l}}=(0,x.useContext)(T.K),{buildSetting:s}=Ra(l),{artSetExclusion:o}=s,c=null!=(n=null==o?void 0:o[e])?n:[],d=!c.includes(4),u=wn(a),Z=(0,Pe.Sk)(e),m=(0,x.useMemo)((()=>d?Object.keys(Z.setEffects).filter((e=>{var t;return null==(t=Z.setEffects[e])?void 0:t.document.some((e=>"states"in e))})):[]),[Z.setEffects,d]);return(0,D.tZ)(Ce.ZP,{item:!0,xs:1,children:(0,D.BX)(w.Z,{sx:{height:"100%",opacity:u<2?"50%":void 0},children:[(0,D.BX)(h.Z,{className:`grad-${Z.rarity[0]}star`,width:"100%",sx:{display:"flex"},children:[(0,D.tZ)(h.Z,{component:"img",src:(0,Ee.jU)(e),sx:{height:100,width:"auto",mx:-1}}),(0,D.BX)(h.Z,{sx:{flexGrow:1,px:1,display:"flex",flexDirection:"column",justifyContent:"center"},children:[(0,D.tZ)(pe.Z,{variant:"h6",children:null!=(i=Z.name)?i:""}),(0,D.tZ)(h.Z,{children:(0,D.BX)(pe.Z,{variant:"subtitle1",children:[Z.rarity.map(((e,t)=>(0,D.BX)(h.Z,{component:"span",sx:{display:"inline-flex",alignItems:"center"},children:[e," ",(0,D.tZ)(Ua.Z,{fontSize:"inherit"})," ",t<Z.rarity.length-1?"/ ":null]},e)))," ",(0,D.tZ)(Se.L,{title:(0,D.BX)(h.Z,{children:[(0,D.tZ)(pe.Z,{children:(0,D.tZ)(M.Z,{color:"success",children:r(gn||(gn=bn`2set`))})}),(0,D.tZ)(pe.Z,{children:(0,D.tZ)(Qa.v,{ns:`artifact_${e}_gen`,key18:"setEffects.2"})}),(0,D.BX)(h.Z,{paddingTop:2,sx:{opacity:c.includes(4)?.6:1},children:[(0,D.tZ)(pe.Z,{children:(0,D.tZ)(M.Z,{color:"success",children:r(xn||(xn=bn`4set`))})}),(0,D.tZ)(pe.Z,{children:(0,D.tZ)(Qa.v,{ns:`artifact_${e}_gen`,key18:"setEffects.4"})})]})]})})]})}),(0,D.tZ)(h.Z,{sx:{display:"flex",gap:1},children:Object.entries(a).map((([e,t])=>(0,D.tZ)(pe.Z,{sx:{flexGrow:1},variant:"subtitle2",children:(0,D.BX)(M.Z,{sx:{width:"100%"},color:t?"primary":"secondary",children:[(0,D.tZ)(Pa.Z,{slotKey:e,iconProps:S.mX})," ",t]})},e)))})]})]}),sa.Uu.includes(e)&&(0,D.tZ)(nn,{setKey:e,buttonGroupSx:{".MuiButton-root":{borderRadius:0}}}),!!m.length&&(0,D.tZ)(j.R.Provider,{value:t,children:(0,D.tZ)(p.Z,{sx:{display:"flex",flexDirection:"column",gap:2},children:m.map((t=>(0,D.tZ)(Ja,{setKey:e,setNumKey:parseInt(t),hideHeader:!0,conditionalsOnly:!0},t)))})})]})},e)}function wn(e){return Object.values(e).reduce(((e,t)=>e+(t?1:0)),0)}const kn=[0,4,8,12,16,20];function Sn({mainStatAssumptionLevel:e=0,setmainStatAssumptionLevel:t,disabled:a}){const{t:n}=(0,b.$G)("page_character_optimize");return(0,D.tZ)(L.Z,{fullWidth:!0,color:e?"success":"primary",disabled:a,title:e?n("mainStat.assumptionLvl.lvl",{lvl:e}):n("mainStat.assumptionLvl.no"),children:kn.map((e=>(0,D.tZ)(X.Z,{onClick:()=>t(e),children:e?n("mainStat.assumptionLvl.lvl",{lvl:e}):n("mainStat.assumptionLvl.no")},e)))})}let Bn,Xn=e=>e;function _n(){const{t:e}=(0,b.$G)("page_character_optimize"),{character:{bonusStats:t}}=(0,x.useContext)(T.K),{data:a}=(0,x.useContext)(j.R),n=Object.keys(t);if(!n.length)return null;const i=n.map((e=>a.get(K.ri.customBonus[e])));return(0,D.BX)(w.Z,{children:[(0,D.tZ)(p.Z,{children:(0,D.tZ)(pe.Z,{sx:{fontWeight:"bold"},children:e(Bn||(Bn=Xn`bonusStats.title`))})}),(0,D.tZ)(je.Z,{}),(0,D.tZ)(p.Z,{children:i.map((e=>(0,D.tZ)($e.JW,{node:e},JSON.stringify(e.info))))})]})}var Tn=a(38162);const jn=(0,we.ZP)("strong")({fontFamily:"monospace"}),Kn=(0,we.ZP)(Tn.Z)((()=>({height:10,borderRadius:5})));function On({status:{type:e,tested:t,failed:a,skipped:n,total:i,startTime:r,finishTime:l},characterName:s}){const o=isFinite(i),c="inactive"!==e,d=i-n,u=(0,D.tZ)(jn,{children:t.toLocaleString()}),h=(0,D.tZ)(jn,{children:d.toLocaleString()}),Z=!!n&&(0,D.BX)("span",{children:["(",(0,D.tZ)("b",{children:(0,D.tZ)(jn,{children:n.toLocaleString()})})," skipped)"]}),p=(0,D.tZ)(jn,{children:(0,le.e6)(Math.round((null!=l?l:performance.now())-(null!=r?r:NaN)))});let m,f="",g="";if(c)m=100*t/d,f=(0,D.BX)(pe.Z,{children:["Generating and testing ",u,o?(0,D.BX)(D.HY,{children:["/",h]}):void 0," build configurations against the criteria for ",(0,D.tZ)("b",{children:s}),". ",Z]}),g=(0,D.BX)(pe.Z,{children:["Time elapsed: ",p]});else{if(!(t+n))return null;m=100,f=(0,D.BX)(pe.Z,{children:["Generated and tested ",u," Build configurations against the criteria for ",(0,D.tZ)("b",{children:s}),". ",Z]}),g=(0,D.BX)(pe.Z,{children:["Total duration: ",p]})}return(0,D.BX)(Bt.Z,{severity:"success",variant:"filled",sx:{"& .MuiAlert-message":{flexGrow:1}},children:[f,g,void 0!==m&&(0,D.BX)(Ce.ZP,{container:!0,spacing:1,alignItems:"center",children:[o&&(0,D.tZ)(Ce.ZP,{item:!0,children:(0,D.tZ)(pe.Z,{children:`${m.toFixed(1)}%`})}),(0,D.tZ)(Ce.ZP,{item:!0,flexGrow:1,children:(0,D.tZ)(Kn,{variant:o?"determinate":"indeterminate",value:m,color:"primary"})})]})]})}var Pn=a(74064),En=a(73673),Mn=a(99074),Dn=a(22499),An=a(14115),In=a(66615),Rn=a(75213),Ln=a(47746),zn=a(47591),Gn=a(69614),$n=a(70582);function Nn({characterKey:e}){const{gender:t}=(0,ae.Z)();if(!e)return null;const a=(0,J.m)(e,t);return a?(0,D.tZ)(Za.Z,{placement:"right-end",title:(0,D.tZ)(pe.Z,{children:a.name}),children:(0,D.tZ)(ft.Z,{characterKey:e,sideMargin:!0})}):null}var Wn=a(26437);function Fn({statKey:e,disableIcon:t=!1}){return(0,D.BX)(h.Z,{component:"span",display:"flex",alignItems:"center",gap:1,children:[!t&&(0,D.tZ)(P.C,{statKey:e,iconProps:S.mX}),(0,D.BX)("span",{children:[Ot.ZP.get(e),Ot.ZP.unit(e)]})]})}function Vn({statKey:e,disableIcon:t=!1}){return(0,D.tZ)(E.Z,{color:Ot.ZP.getVariant(e),children:(0,D.tZ)(Fn,{statKey:e,disableIcon:t})})}var qn=a(2218);function Hn({artifactId:e,slotKey:t,mainStatAssumptionLevel:a=0,showLocation:n=!1,onClick:r,BGComponent:l=C.Z}){const s=(0,$n.Z)(e),{database:o}=(0,x.useContext)(Q.t),c=(0,x.useCallback)((e=>(0,D.tZ)(Rn.Z,{onClick:r,sx:{height:"100%"},children:e})),[r]),d=(0,Ln.Z)();if(!s)return(0,D.tZ)(l,{sx:{display:"flex",height:"100%",alignItems:"center",justifyContent:"center"},children:(0,D.tZ)(h.Z,{component:"img",src:Oe.CL.slot[t],sx:{width:"25%",height:"auto",opacity:.7}})});const{slotKey:u,rarity:Z,level:p,mainStatKey:m,substats:f,location:g}=s,b=Math.max(Math.min(a,4*Z),p),y=i.fR.find((e=>s.mainStatKey.includes(e))),v=y?(0,zn.Fq)(d.palette[y].main,.6):(0,zn.Fq)(d.palette.secondary.main,.6);return(0,D.tZ)(l,{sx:{height:"100%"},children:(0,D.tZ)(Wn.Z,{condition:!!r,wrapper:c,children:(0,D.BX)(h.Z,{display:"flex",height:"100%",children:[(0,D.BX)(h.Z,{className:`grad-${Z}star`,sx:{position:"relative",flexGrow:1,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"},children:[(0,D.tZ)(qn.Z,{art:s,children:(0,D.tZ)(h.Z,{component:"img",src:(0,Oe.Hp)(s.setKey,u),sx:{m:-1,maxHeight:"110%",maxWidth:"110%"}})}),(0,D.BX)(h.Z,{sx:{position:"absolute",width:"100%",height:"100%",p:.5,opacity:.85,display:"flex",justifyContent:"space-between",pointerEvents:"none"},children:[(0,D.tZ)(ge.Z,{size:"small",label:(0,D.tZ)("strong",{children:` +${p}`}),color:Gn.Z.levelVariant(p)}),n&&(0,D.tZ)(ge.Z,{size:"small",label:g?(0,D.tZ)(Nn,{characterKey:g&&o.chars.LocationToCharacterKey(g)}):(0,D.tZ)(In.Z,{}),color:"secondary",sx:{overflow:"visible",".MuiChip-label":{overflow:"visible"}}})]}),(0,D.tZ)(ge.Z,{size:"small",sx:{position:"absolute",bottom:0,mb:1,backgroundColor:v,p:1},icon:(0,D.tZ)(Za.Z,{placement:"top",title:(0,D.tZ)(pe.Z,{children:(0,D.tZ)(Vn,{statKey:m})}),disableInteractive:!0,children:(0,D.tZ)(h.Z,{lineHeight:0,children:(0,D.tZ)(P.C,{statKey:m,iconProps:{style:{padding:"4px"}}})})}),label:(0,D.tZ)(pe.Z,{sx:{mx:-.7},children:(0,D.tZ)(E.Z,{color:b!==p?"warning":void 0,children:(0,An.R1)(m,Z,b)})})})]}),(0,D.tZ)(h.Z,{display:"flex",flexDirection:"column",justifyContent:"space-between",sx:{p:1},children:f.map(((e,t)=>(0,D.tZ)(Un,{stat:e},t+e.key)))})]})})})}function Un({stat:e}){var t,a;if(!e.value)return null;const n=null!=(t=null==(a=e.rolls)?void 0:a.length)?t:0,i=`roll${(0,le.re)(n,1,6)}`,r=(0,le.bf)(e.key);return(0,D.tZ)(h.Z,{display:"flex",gap:1,alignContent:"center",children:(0,D.BX)(pe.Z,{sx:{flexGrow:1,display:"flex",gap:.5,alignItems:"center"},color:n?`${i}.main`:"error.main",component:"span",children:[(0,D.tZ)(Za.Z,{placement:"top",title:(0,D.tZ)(pe.Z,{children:e.key&&(0,D.tZ)(Vn,{statKey:e.key})}),disableInteractive:!0,children:(0,D.tZ)(h.Z,{lineHeight:0,children:(0,D.tZ)(P.C,{statKey:e.key,iconProps:{fontSize:"inherit"}})})}),(0,D.tZ)("span",{children:`${(0,An.Jj)(e.value,r)}${r}`})]})})}function Yn(){const{data:e}=(0,x.useContext)(j.R),t=(0,x.useMemo)((()=>Re(e).filter((([,e])=>Object.values(e).some((e=>!e.isEmpty))))),[e]);return(0,D.tZ)(h.Z,{sx:{mr:-1,mb:-1},children:(0,D.tZ)(Le.ZP,{columns:{xs:1,sm:2,md:3,xl:4},spacing:1,children:t.map((([e,t])=>(0,D.tZ)(Jn,{displayNs:t,sectionKey:e},e)))})})}function Jn({displayNs:e,sectionKey:t}){const a=(0,x.useContext)(ga),{data:n,oldData:i}=(0,x.useContext)(j.R),{database:r}=(0,x.useContext)(Q.t),l=(0,x.useMemo)((()=>Ie(n,t,r)),[r,n,t]),s=(0,x.useMemo)((()=>(0,le.vU)(e,((e,a)=>(0,va.UF)(["display",t,a])))),[e,t]);if(!l)return(0,D.tZ)(C.Z,{});const{title:o,icon:c,action:d}=l;return(0,D.BX)(C.Z,{children:[(0,D.tZ)(vt.Z,{avatar:c&&(0,D.tZ)(Ke.Z,{size:2,src:c}),title:o,action:d&&(0,D.tZ)(M.Z,{children:d})}),(0,D.tZ)(je.Z,{}),(0,D.tZ)($e.lD,{sx:{m:0},children:Object.entries(e).map((([e,n])=>(0,D.tZ)($e.JW,{node:n,oldValue:i?i.get(s[e]).value:void 0,component:Xt.ZP,emphasize:JSON.stringify(a)===JSON.stringify([t,e])},e)))})]})}var Qn=a(51784),ei=a(30311),ti=a(61340);function ai({weaponId:e,showLocation:t=!1,onClick:a,BGComponent:n=C.Z}){const{database:i}=(0,x.useContext)(Q.t),r=(0,ei.Z)(e),l=(null==r?void 0:r.key)&&(0,Me.ub)(r.key),s=(0,x.useCallback)((e=>(0,D.tZ)(Rn.Z,{sx:{height:"100%"},onClick:a,children:e})),[a]),o=(0,x.useMemo)((()=>l&&r&&(0,xa.mP)([l.data,(0,xa.v0)(r)])),[l,r]);if(!r||!l||!o)return(0,D.tZ)(n,{sx:{height:"100%"},children:(0,D.tZ)(Z.Z,{variant:"rectangular",sx:{width:"100%",height:"100%"}})});const{refinement:c,location:d}=r;return(0,D.tZ)(n,{sx:{height:"100%"},children:(0,D.tZ)(Wn.Z,{condition:!!a,wrapper:s,children:(0,D.BX)(h.Z,{display:"flex",height:"100%",alignItems:"stretch",children:[(0,D.BX)(h.Z,{className:`grad-${l.rarity}star`,sx:{height:"100%",position:"relative",flexGrow:1,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"flex-end"},children:[(0,D.tZ)(ti.Z,{sheet:l,children:(0,D.tZ)(h.Z,{component:"img",src:(0,Oe.Aq)(r.key,r.ascension>=2),sx:{mx:-1,maxHeight:"100%",maxWidth:"100%"}})}),(0,D.BX)(h.Z,{sx:{position:"absolute",width:"100%",height:"100%",p:.5,opacity:.85,display:"flex",justifyContent:"space-between",pointerEvents:"none"},children:[(0,D.tZ)(ge.Z,{size:"small",label:(0,D.tZ)("strong",{children:Qn.Z.getLevelString(r)}),color:"primary"}),t&&(0,D.tZ)(ge.Z,{size:"small",label:d?(0,D.tZ)(Nn,{characterKey:i.chars.LocationToCharacterKey(d)}):(0,D.tZ)(In.Z,{}),color:"secondary",sx:{overflow:"visible",".MuiChip-label":{overflow:"visible"}}})]}),(0,D.tZ)(h.Z,{sx:{position:"absolute",width:"100%",height:"100%",p:.5,opacity:.85,display:"flex",justifyContent:"flex-end",alignItems:"flex-end"},children:l.hasRefinement&&(0,D.tZ)(ge.Z,{size:"small",color:"info",label:(0,D.BX)("strong",{children:["R",c]})})})]}),(0,D.BX)(h.Z,{display:"flex",flexDirection:"column",sx:{p:1},children:[(0,D.tZ)(ni,{node:o.get(K.qH.weapon.main)}),(0,D.tZ)(ni,{node:o.get(K.qH.weapon.sub)})]})]})})})}function ni({node:e}){return e.info.name?(0,D.tZ)(h.Z,{display:"flex",gap:1,alignContent:"center",children:(0,D.BX)(pe.Z,{sx:{flexGrow:1,display:"flex",gap:1},component:"span",children:[(0,D.tZ)(Za.Z,{placement:"top",title:(0,D.tZ)(pe.Z,{children:e.info.name}),disableInteractive:!0,children:(0,D.tZ)("span",{children:e.info.icon})}),(0,D.tZ)("span",{children:(0,_e.p)(e)})]})}):null}var ii=a(30706),ri=a(5051);function li({artifacts:e,currentlyEquipped:t=!1}){const a=(0,x.useMemo)((()=>e.filter((e=>e)).reduce(((e,t)=>(e[t.setKey]?e[t.setKey].push(t.slotKey):e[t.setKey]=[t.slotKey],e)),{})),[e]);return(0,D.tZ)(D.HY,{children:Object.entries(a).sort((([e,t],[a,n])=>n.length-t.length)).map((([e,a])=>(0,D.tZ)(si,{setKey:e,currentlyEquipped:t,slotarr:a},e)))})}function si({setKey:e,currentlyEquipped:t=!1,slotarr:a}){var n;const i=(0,Pe.Sk)(e),r=a.length,l=Object.keys(i.setEffects).map((e=>parseInt(e))).filter((e=>e<=r));return(0,D.tZ)(h.Z,{children:(0,D.tZ)(ri.Z,{artifactSheet:i,numInSet:r,children:(0,D.tZ)(M.Z,{sx:{height:"100%"},color:t?"success":"primary",children:(0,D.BX)(pe.Z,{children:[a.map((e=>(0,D.tZ)(Pa.Z,{slotKey:e,iconProps:S.mX},e)))," ",null!=(n=i.name)?n:"",l.map(((e,t)=>(0,D.tZ)(M.Z,{sx:{ml:.5},color:"success",children:e},""+e+t)))]})})})})}let oi,ci,di=e=>e;function ui({label:e,compareBuild:t,extraButtonsRight:a,extraButtonsLeft:n,disabled:r}){const{character:{key:l,equippedArtifacts:s}}=(0,x.useContext)(T.K),{buildSetting:{mainStatAssumptionLevel:o,allowLocationsState:c}}=Ra(l),{database:d}=(0,x.useContext)(Q.t),u=(0,x.useContext)(j.R),{data:m,oldData:f}=u,[b,y]=(0,x.useState)(void 0),v=(0,x.useCallback)((()=>y(void 0)),[y]),C=(0,x.useCallback)((()=>{if(!window.confirm("Do you want to equip this build to this character?"))return;const e=d.chars.get(l);if(!e)return;i.Ex.forEach((t=>{var a;const n=null==(a=m.get(K.ri.art[t].id).value)?void 0:a.toString();if(n)d.arts.set(n,{location:(0,i.V7)(l)});else{const a=e.equippedArtifacts[t];a&&d.arts.get(a)&&d.arts.set(a,{location:""})}}));const t=m.get(K.ri.weapon.id).value;t&&d.weapons.set(t,{location:(0,i.V7)(l)})}),[l,m,d]),k=(0,x.useMemo)((()=>{const e=Object.assign({},u);return t||(e.oldData=void 0),e}),[u,t]),S=(0,x.useMemo)((()=>Object.fromEntries(i.Ex.map((e=>{var t;return[e,null==(t=m.get(K.ri.art[e].id).value)?void 0:t.toString()]})))),[m]),B=(0,x.useMemo)((()=>S&&Object.values(S).map((e=>d.arts.get(e))).filter((e=>e))),[S,d.arts]),X=(0,x.useMemo)((()=>i.Ex.map((e=>(0,D.tZ)(Ce.ZP,{item:!0,xs:1,children:(0,D.tZ)(Hn,{showLocation:!0,slotKey:e,artifactId:S[e],mainStatAssumptionLevel:o,onClick:()=>{const t=s[e],a=S[e];y({oldId:t!==a?t:void 0,newId:a})}})},e)))),[y,s,o,S]);if(!f)return null;const _=i.Ex.every((e=>{var t;return S[e]===(null==(t=f.get(K.ri.art[e].id).value)?void 0:t.toString())}))&&m.get(K.ri.weapon.id).value===f.get(K.ri.weapon.id).value;return(0,D.tZ)(w.Z,{children:(0,D.BX)(x.Suspense,{fallback:(0,D.tZ)(Z.Z,{variant:"rectangular",width:"100%",height:600}),children:[b&&(0,D.tZ)(hi,{newOld:b,mainStatAssumptionLevel:o,onClose:v,allowLocationsState:c}),(0,D.BX)(p.Z,{children:[(0,D.BX)(h.Z,{display:"flex",gap:1,sx:{pb:1},flexWrap:"wrap",children:[void 0!==e&&(0,D.tZ)(M.Z,{color:"info",children:(0,D.tZ)(pe.Z,{children:(0,D.BX)("strong",{children:[e,_?" (Equipped)":""]})})}),(0,D.tZ)(li,{artifacts:B,currentlyEquipped:_}),(0,D.tZ)(h.Z,{sx:{flexGrow:1,display:"flex",justifyContent:"flex-end"}}),n,(0,D.tZ)(g.Z,{size:"small",color:"success",onClick:C,disabled:r||_,startIcon:(0,D.tZ)(Pn.Z,{}),children:"Equip Build"}),a]}),(0,D.BX)(Ce.ZP,{container:!0,spacing:1,sx:{pb:1},columns:{xs:2,sm:3,md:4,lg:6},children:[(0,D.tZ)(Ce.ZP,{item:!0,xs:1,children:(0,D.tZ)(ai,{showLocation:!0,weaponId:m.get(K.ri.weapon.id).value})}),X]}),(0,D.tZ)(j.R.Provider,{value:k,children:(0,D.tZ)(Yn,{})})]})]})})}function hi({newOld:{newId:e,oldId:t},mainStatAssumptionLevel:a,onClose:n,allowLocationsState:r}){var l,s;const{database:o}=(0,x.useContext)(Q.t),{character:{key:c}}=(0,x.useContext)(T.K),d=(0,x.useCallback)((()=>{window.confirm("Do you want to equip this artifact to this character?")&&(o.arts.set(e,{location:(0,i.V7)(c)}),n())}),[e,o,c,n]),u=null!=(l=null==(s=o.arts.get(e))?void 0:s.location)?l:"",Z=(0,$n.Z)(e);return(0,D.tZ)(Be.Z,{open:!!e,onClose:n,containerProps:{maxWidth:t?"md":"xs"},children:(0,D.tZ)(C.Z,{children:(0,D.BX)(p.Z,{sx:{display:"flex",justifyContent:"center",alignItems:"stretch",gap:2},children:[t&&(0,D.tZ)(h.Z,{minWidth:320,children:(0,D.tZ)(ii.Z,{artifactId:t,mainStatAssumptionLevel:a,canEquip:!0,editorProps:{disableSet:!0,disableSlot:!0},extraButtons:(0,D.tZ)(Zi,{id:t})})}),t&&(0,D.tZ)(h.Z,{display:"flex",flexGrow:1}),t&&(0,D.tZ)(h.Z,{display:"flex",alignItems:"center",justifyContent:"center",children:(0,D.tZ)(g.Z,{onClick:d,sx:{display:"flex"},children:(0,D.tZ)(En.Z,{sx:{fontSize:40}})})}),t&&(0,D.tZ)(h.Z,{display:"flex",flexGrow:1}),(0,D.BX)(h.Z,{minWidth:320,display:"flex",flexDirection:"column",gap:1,children:[(0,D.tZ)(ii.Z,{artifactId:e,mainStatAssumptionLevel:a,canEquip:!0,editorProps:{disableSet:!0,disableSlot:!0},extraButtons:(0,D.tZ)(Zi,{id:e})}),u&&u!==(0,i.V7)(c)&&"all"!==r&&(0,D.tZ)(pi,{locationKey:u}),Z&&sa.Uu.includes(Z.setKey)&&(0,D.tZ)(nn,{setKey:Z.setKey})]})]})})})}function Zi({id:e}){const{t}=(0,b.$G)("page_character_optimize"),{character:{key:a}}=(0,x.useContext)(T.K),{buildSetting:{artExclusion:n},buildSettingDispatch:i}=Ra(a),r=n.includes(e),l=(0,x.useCallback)((()=>i({artExclusion:(0,le.nh)(n,e)})),[e,n,i]);return(0,D.tZ)(Za.Z,{title:(0,D.BX)(h.Z,{children:[(0,D.tZ)(pe.Z,{children:t(oi||(oi=di`excludeArt.excludeArtifactTip`))}),(0,D.tZ)(pe.Z,{children:(0,D.tZ)(E.Z,{color:r?"error":"success",children:t(r?"excludeArt.excluded":"excludeArt.included")})})]}),placement:"top",arrow:!0,children:(0,D.tZ)(g.Z,{onClick:l,color:r?"error":"success",size:"small",children:r?(0,D.tZ)(Ha.Z,{}):(0,D.tZ)(Oa.Z,{})})})}function pi({locationKey:e}){const{t}=(0,b.$G)("page_character_optimize"),{character:{key:a}}=(0,x.useContext)(T.K),{database:n}=(0,x.useContext)(Q.t),i=(0,J.m)(n.chars.LocationToCharacterKey(e)),{buildSetting:{excludedLocations:r},buildSettingDispatch:l}=Ra(a),s=r.includes(e),o=(0,x.useCallback)((()=>l({excludedLocations:(0,le.nh)(r,e)})),[e,r,l]);return(0,D.tZ)(g.Z,{onClick:o,color:s?"secondary":"success",size:"small",startIcon:s?(0,D.tZ)(Dn.Z,{}):(0,D.tZ)(Mn.Z,{}),children:(0,D.BX)("span",{children:[t(ci||(ci=di`excludeChar.allowEquip`))," ",(0,D.tZ)("strong",{children:i.name})]})})}var mi=a(68164),fi=a(15099),gi=a(61660),xi=a(22443),bi=a(55484),yi=a(25556),vi=a(81224),Ci=a(3131),wi=a(47857),ki=a(55734),Si=a(63004),Bi=a(36197);function Xi(e){const{database:t}=(0,x.useContext)(Q.t),[a,n]=(0,x.useState)((()=>t.buildResult.get(e)));(0,x.useEffect)((()=>n(t.buildResult.get(e))),[t,e]),(0,x.useEffect)((()=>t.buildResult.follow(e,((e,t,a)=>"update"===t&&n(a)))),[e,n,t]);return{buildResult:a,buildResultDispatch:(0,x.useCallback)((a=>e&&t.buildResult.set(e,a)),[e,t])}}function _i({cx:e,cy:t,payload:a,selectedPoint:n,radiusSelected:i=6,radiusUnselected:r=3,colorSelected:l="red",colorUnselected:s,shape:o="circle"}){if(!e||!t||!a)return null;const c=n&&n.x===a.x&&n.y===a.y;return(0,D.tZ)("g",{className:"custom-dot","data-chart-x":e,"data-chart-y":t,"data-x-value":a.x,"data-y-value":a.y,"data-radius":c?r:i,children:c?(0,D.BX)(D.HY,{children:[(0,D.tZ)(Ti,{id:"customShapeSelected",shape:o,cx:e,cy:t,r:i/2,fill:l}),(0,D.tZ)(Ti,{id:"customShapeBorder",shape:o,cx:e,cy:t,r:i,fill:"none",stroke:l})]}):(0,D.tZ)(Ti,{id:"customShapeUnselected",shape:o,cx:e,cy:t,r,fill:s})})}function Ti({shape:e,id:t,cx:a,cy:n,r:i,fill:r,stroke:l}){switch(e){case"circle":return(0,D.tZ)("circle",{id:t,cx:a,cy:n,r:i,fill:r,stroke:l});case"square":return(0,D.tZ)("rect",{id:t,x:a-i,y:n-i,width:2*i,height:2*i,fill:r,stroke:l});case"diamond":return(0,D.tZ)("polygon",{id:t,points:`${a},${n+2.5*i} ${a+1.5*i},${n} ${a},${n-2.5*i} ${a-1.5*i},${n}`,fill:r,stroke:l})}}var ji=a(99118),Ki=a(45390);const Oi=["xLabel","xUnit","yLabel","yUnit","selectedPoint","setSelectedPoint","addBuildToList"];function Pi(e){let{xLabel:t,xUnit:a,yLabel:n,yUnit:r,selectedPoint:l,setSelectedPoint:s,addBuildToList:o}=e,c=(0,Pt.Z)(e,Oi);const{database:d}=(0,x.useContext)(Q.t),{data:u}=(0,x.useContext)(j.R),{t:h}=(0,b.$G)("page_character_optimize"),m=(0,x.useMemo)((()=>l&&l.artifactIds&&Object.fromEntries(l.artifactIds.map((e=>{const t=d.arts.get(e);return[null==t?void 0:t.slotKey,t]})).filter((e=>e)))),[d.arts,l]),f=(0,x.useCallback)((e=>{e.target.id.includes("customShape")||e.target.id.includes("chartContainer")||s(void 0)}),[s]),y=m&&i.Ex.every((e=>{var t,a;return(null==(t=m[e])?void 0:t.id)===(null==(a=u.get(K.qH.art[e].id).value)?void 0:a.toString())})),v=(0,x.useMemo)((()=>void 0!==(null==l?void 0:l.generBuildNumber)&&`#${null==l?void 0:l.generBuildNumber}`),[l]),w=(0,x.useMemo)((()=>void 0!==(null==l?void 0:l.graphBuildNumber)&&(0,D.BX)(b.cC,{t:h,i18nKey:"graphBuildLabel",count:null==l?void 0:l.graphBuildNumber,children:["Graph #",{count:(null==l?void 0:l.graphBuildNumber)+1}]})),[l,h]);return c.active&&l?(0,D.tZ)(ji.d,{onClickAway:f,children:(0,D.tZ)(C.Z,{sx:{minWidth:"400px",maxWidth:"400px"},onClick:e=>e.stopPropagation(),children:(0,D.tZ)(p.Z,{children:(0,D.BX)(Te.Z,{gap:1,children:[(0,D.BX)(Te.Z,{direction:"row",alignItems:"start",gap:1,children:[(0,D.BX)(Te.Z,{spacing:.5,flexGrow:99,children:[y&&(0,D.tZ)(M.Z,{color:"info",children:(0,D.tZ)("strong",{children:h("currentlyEquippedBuild")})}),v&&(0,D.tZ)(M.Z,{color:"info",children:v}),w&&(0,D.tZ)(M.Z,{color:"info",children:w}),(0,D.tZ)(x.Suspense,{fallback:(0,D.tZ)(Z.Z,{width:300,height:50}),children:(0,D.tZ)(li,{artifacts:Object.values(m),currentlyEquipped:y})})]}),(0,D.tZ)(Ce.ZP,{item:!0,flexGrow:1}),(0,D.tZ)(k.Z,{onClick:()=>s(void 0)})]}),(0,D.tZ)(Ce.ZP,{container:!0,direction:"row",spacing:.75,columns:5,children:i.Ex.map((e=>(0,D.tZ)(Ce.ZP,{item:!0,xs:1,children:(0,D.tZ)(x.Suspense,{fallback:(0,D.tZ)(Z.Z,{width:75,height:75}),children:(0,D.tZ)(Ki.Z,{artifactObj:m[e],slotKey:e})})},e)))}),(0,D.BX)(pe.Z,{children:[(0,D.tZ)("strong",{children:t}),":"," ",(0,le.EC)("%"===a?l.x/100:l.x,a)]}),(0,D.BX)(pe.Z,{children:[(0,D.tZ)("strong",{children:n}),":"," ",(0,le.EC)("%"===r?l.y/100:l.y,r)]}),(0,D.tZ)(Za.Z,{title:l.highlighted?h("tcGraph.buildAlreadyInList"):"",placement:"top",children:(0,D.tZ)("span",{children:(0,D.tZ)(g.Z,{sx:{width:"100%"},disabled:void 0!==(null==l?void 0:l.graphBuildNumber),color:"info",onClick:()=>o(l.artifactIds),children:h("addBuildToList")})})})]})})})}):null}class EnhancedPoint{constructor(e,t,a){this.x=void 0,this.trueY=void 0,this.artifactIds=void 0,this.min=void 0,this.current=void 0,this.highlighted=void 0,this.generBuildNumber=void 0,this.graphBuildNumber=void 0,this.x=e,this.trueY=t,this.artifactIds=a}get y(){return this.trueY||this.current||this.highlighted}set y(e){this.trueY=e}}let Ei,Mi,Di,Ai,Ii,Ri,Li,zi=e=>e;function Gi({plotBase:e,setPlotBase:t,disabled:a=!1,showTooltip:r=!1}){const{t:l}=(0,b.$G)(["page_character_optimize","ui"]),{data:s}=(0,x.useContext)(j.R),{chartData:o}=(0,x.useContext)(U),[c,d]=(0,x.useState)(!1),[u,h]=(0,x.useState)(!0),{graphBuilds:Z}=(0,x.useContext)(U),{character:{key:m}}=(0,x.useContext)(T.K),{buildResult:{builds:f}}=Xi(m),[y,v]=(0,x.useState)(-1/0),[k,S]=(0,x.useState)(1/0),B=(0,x.useCallback)(((e,t)=>{if("number"==typeof t)throw new TypeError;const[a,n]=t;v(a),S(n)}),[v,S]);(0,x.useEffect)((()=>{v(-1/0),S(1/0)}),[o]);const{displayData:X,downloadData:_,sliderMin:O,sliderMax:P}=(0,x.useMemo)((()=>{var e,t;if(!o)return{displayData:null,downloadData:null};let a=1/0,n=-1/0;const r=i.Ex.map((e=>{var t;return null!=(t=null==s?void 0:s.get(K.qH.art[e].id).value)?t:""})),l=o.data.map((({value:e,plot:t,artifactIds:i})=>{if(void 0===t)return null;t<a&&(a=t),t>n&&(n=t);const l=new EnhancedPoint(t,e,i),s=(0,le.K8)(i,(e=>!0));r.every((e=>s[e]))&&(l.current=e,l.y=void 0);const o=null==Z?void 0:Z.findIndex((e=>e.every((e=>s[e]))));void 0!==o&&-1!==o&&(void 0!==l.trueY&&(l.highlighted=e,l.y=void 0),l.graphBuildNumber=o+1);const c=f.findIndex((e=>e.every((e=>s[e]))));return-1!==c&&(void 0!==l.trueY&&(l.highlighted=e,l.y=void 0),l.generBuildNumber=c+1),l})).filter((e=>null!==e)).sort(((e,t)=>e.x-t.x)),c=[];for(const i of l){let e;for(;e=c.pop();)if(e.y>i.y){c.push(e);break}c.push(i)}(null==(e=c[0])?void 0:e.x)!==(null==(t=l[0])?void 0:t.x)&&(l[0].min=c[0].y),c.forEach((e=>{e.min=e.y}));const d={minimum:c.map((e=>[e.x,e.y])),allData:l.map((e=>[e.x,e.y]))};return{displayData:l.filter((e=>e&&e.x>=y&&e.x<=k)),downloadData:d,sliderMin:a,sliderMax:n}}),[o,f,s,Z,y,k]),E=e&&(0,le.Hm)(null==s?void 0:s.getDisplay(),e),M=l(e&&(!E||E.isEmpty)?"page_character_optimize:targetSelector.invalidTarget":"page_character_optimize:targetSelector.selectGraphTarget");return(0,D.BX)(w.Z,{children:[(0,D.tZ)(p.Z,{children:(0,D.BX)(Ce.ZP,{container:!0,spacing:1,alignItems:"center",children:[(0,D.tZ)(Ce.ZP,{item:!0,children:(0,D.tZ)(pe.Z,{children:l(Ei||(Ei=zi`tcGraph.vs`))})}),(0,D.tZ)(Ce.ZP,{item:!0,children:(0,D.tZ)(Za.Z,{placement:"top",title:r?l("page_character_optimize:selectTargetFirst"):"",children:(0,D.tZ)("span",{children:(0,D.tZ)(Ve,{optimizationTarget:e,setTarget:e=>t(e),defaultText:M,disabled:a})})})}),(0,D.tZ)(Ce.ZP,{item:!0,children:(0,D.tZ)(Za.Z,{title:e?l("ui:reset"):"",placement:"top",children:(0,D.tZ)("span",{children:(0,D.tZ)(g.Z,{color:"error",onClick:()=>t(void 0),disabled:!e||a,children:(0,D.tZ)(_t.Z,{})})})})}),(0,D.tZ)(Ce.ZP,{item:!0,flexGrow:1,children:(0,D.tZ)(Se.Z,{placement:"top",title:l("page_character_optimize:tcGraph.desc")})}),!!_&&(0,D.tZ)(Ce.ZP,{item:!0,children:(0,D.tZ)(g.Z,{size:"small",startIcon:u?(0,D.tZ)(Tt.Z,{}):(0,D.tZ)(jt.Z,{}),color:u?"success":"secondary",onClick:()=>h(!u),children:l(Mi||(Mi=zi`tcGraph.showStatThr`))})}),!!_&&(0,D.tZ)(Ce.ZP,{item:!0,children:(0,D.tZ)(g.Z,{size:"small",color:"info",startIcon:(0,D.tZ)(mi.Z,{}),onClick:()=>d(!c),children:l(Di||(Di=zi`tcGraph.downloadData`))})})]})}),X&&!!X.length&&(0,D.tZ)(je.Z,{}),o&&X&&!!X.length&&(0,D.BX)(p.Z,{children:[(0,D.tZ)(Kt.Z,{in:!!_&&c,children:(0,D.tZ)(C.Z,{sx:{mb:2},children:(0,D.BX)(p.Z,{children:[(0,D.tZ)(pe.Z,{children:"Min Data"}),(0,D.tZ)(n.TU,{value:JSON.stringify(null==_?void 0:_.minimum)}),(0,D.tZ)(pe.Z,{children:"All Data"}),(0,D.tZ)(n.TU,{value:JSON.stringify(null==_?void 0:_.allData)})]})})}),(0,D.tZ)(Vi,{displayData:X,plotNode:o.plotNode,valueNode:o.valueNode,showMin:u}),X.length>1&&(0,D.tZ)(fi.ZP,{marks:!0,value:[y,k],onChange:B,onChangeCommitted:B,min:O,max:P,step:(P-O)/20,valueLabelDisplay:"auto",valueLabelFormat:e=>{var t,a;return(0,le.EC)("%"===(null==(t=o.plotNode.info)?void 0:t.unit)?e/100:e,null==(a=o.plotNode.info)?void 0:a.unit)},sx:{ml:"6%",width:"93%"}})]})]})}const $i="#8884d8",Ni="cyan",Wi="#46a046",Fi="#ff7300";function Vi({displayData:e,plotNode:t,valueNode:a,showMin:n}){var i,r,l,s;const{graphBuilds:o,setGraphBuilds:c}=(0,x.useContext)(U),{t:d}=(0,b.$G)("page_character_optimize"),[u,h]=(0,x.useState)(),Z=(0,x.useCallback)((e=>{c([...null!=o?o:[],e]),h(void 0)}),[c,o]),p=(0,x.useCallback)((t=>{t&&t.chartX&&t.chartY&&h(function(e,t,a,n){const i=Array.from(document.querySelectorAll(".custom-dot")).reduce(((a,n)=>{const{chartX:i,chartY:r}=a.dataset,l=Math.sqrt((e-i)**2+(t-r)**2),{chartX:s,chartY:o}=n.dataset;return l<=Math.sqrt((e-s)**2+(t-o)**2)?a:n})).dataset;return Math.sqrt((e-i.chartX)**2+(t-i.chartY)**2)<a?n.find((e=>e.x===+i.xValue&&e.y===+i.yValue)):void 0}(t.chartX,t.chartY,20,e))}),[h,e]),m=qi(t,d),f=qi(a,d);return(0,D.tZ)(gi.h,{width:"100%",height:600,children:(0,D.BX)(xi.c,{id:"chartContainer",data:e,onClick:p,style:{cursor:"pointer"},children:[(0,D.tZ)(bi.q,{strokeDasharray:"3 3"}),(0,D.tZ)(yi.K,{dataKey:"x",scale:"linear",unit:null==(i=t.info)?void 0:i.unit,domain:["auto","auto"],tick:{fill:"white"},type:"number",tickFormatter:e=>e>1e4?e.toFixed():e.toFixed(1),label:(0,D.tZ)(vi._,{fill:"white",dy:10,children:m}),height:50}),(0,D.tZ)(Ci.B,{name:"DMG",domain:["auto","auto"],unit:null==(r=a.info)?void 0:r.unit,allowDecimals:!1,tick:{fill:"white"},type:"number",label:(0,D.tZ)(vi._,{fill:"white",angle:-90,dx:-40,children:f}),width:100}),(0,D.tZ)(wi.u,{content:(0,D.tZ)(Pi,{xLabel:m,xUnit:null==(l=t.info)?void 0:l.unit,yLabel:f,yUnit:null==(s=a.info)?void 0:s.unit,selectedPoint:u,setSelectedPoint:h,addBuildToList:Z}),trigger:"click",wrapperStyle:{pointerEvents:"auto",cursor:"auto"},cursor:!1}),(0,D.tZ)(ki.D,{payload:[...n?[{id:"min",value:d(Ai||(Ai=zi`tcGraph.statReqThr`)),type:"line",color:Fi}]:[],{id:"trueY",value:d(Ii||(Ii=zi`tcGraph.generatedBuilds`)),type:"circle",color:$i},{id:"highlighted",value:d(Ri||(Ri=zi`tcGraph.highlightedBuilds`)),type:"square",color:Ni},{id:"current",value:d(Li||(Li=zi`tcGraph.currentBuild`)),type:"diamond",color:Wi}]}),n&&(0,D.tZ)(Si.x,{dataKey:"min",stroke:Fi,type:"stepBefore",connectNulls:!0,strokeWidth:2,isAnimationActive:!1,dot:!1,activeDot:!1}),(0,D.tZ)(Bi.b,{dataKey:"trueY",isAnimationActive:!1,shape:(0,D.tZ)(_i,{selectedPoint:u,colorUnselected:$i})}),(0,D.tZ)(Bi.b,{dataKey:"highlighted",isAnimationActive:!1,shape:(0,D.tZ)(_i,{shape:"square",selectedPoint:u,colorUnselected:Ni})}),(0,D.tZ)(Bi.b,{dataKey:"current",isAnimationActive:!1,shape:(0,D.tZ)(_i,{shape:"diamond",selectedPoint:u,colorUnselected:Wi})})]})})}function qi(e,t){var a,n,i,r,l;return"string"==typeof(null==(a=e.info)?void 0:a.name)?e.info.name:`${t(`${null==(n=e.info)||null==(n=n.name)?void 0:n.props.ns}:${null==(i=e.info)||null==(i=i.name)?void 0:i.props.key18}`)}${null!=(r=e.info)&&r.textSuffix?` ${null==(l=e.info)?void 0:l.textSuffix}`:""}`}var Hi=a(22537),Ui=a(15015);let Yi,Ji,Qi,er,tr,ar=e=>e;function nr({disabled:e=!1,excludedTotal:t}){const{t:a}=(0,b.$G)("page_character_optimize"),{character:{key:i}}=(0,x.useContext)(T.K),{buildSetting:{artExclusion:r,useExcludedArts:l},buildSettingDispatch:s}=Ra(i),[o,c,d]=(0,n.aV)(!1),u=r.length,[Z,m,f]=(0,n.aV)(!1),y=(0,x.useCallback)((e=>{s({artExclusion:[...r,e],useExcludedArts:!1})}),[s,r]),v=(0,x.useCallback)((e=>{s({artExclusion:r.filter((t=>t!==e)),useExcludedArts:!1})}),[s,r]),S=(0,x.useCallback)((()=>s({useExcludedArts:!l})),[s,l]);return(0,D.BX)(D.HY,{children:[(0,D.tZ)(Be.Z,{open:o,onClose:d,containerProps:{maxWidth:"xl"},children:(0,D.BX)(C.Z,{children:[(0,D.tZ)(p.Z,{children:(0,D.BX)(h.Z,{display:"flex",gap:1,alignItems:"center",children:[(0,D.tZ)(pe.Z,{variant:"h6",children:a(Yi||(Yi=ar`excludeArt.title_exclude`))}),(0,D.tZ)(Se.Z,{title:(0,D.tZ)(pe.Z,{children:a(Ji||(Ji=ar`excludeArt.title_tooltip`))})}),(0,D.tZ)(h.Z,{flexGrow:1}),(0,D.tZ)(k.Z,{onClick:d,size:"small"})]})}),(0,D.tZ)(je.Z,{}),(0,D.BX)(p.Z,{children:[(0,D.tZ)(lr,{show:Z,onClose:f,onSelect:y,artExclusion:r}),(0,D.tZ)(g.Z,{fullWidth:!0,onClick:m,color:"info",sx:{mb:1},startIcon:(0,D.tZ)(se.Z,{}),children:a(Qi||(Qi=ar`excludeArt.addExc`))}),!!u&&(0,D.tZ)(w.Z,{sx:{mb:1},children:(0,D.tZ)(pe.Z,{textAlign:"center",children:a(er||(er=ar`excludeArt.deSelectExc`))})}),(0,D.tZ)(Ce.ZP,{container:!0,columns:{xs:3,md:5,lg:6,xl:8},spacing:1,children:r.map((e=>(0,D.tZ)(Ce.ZP,{item:!0,xs:1,children:(0,D.tZ)(Hn,{artifactId:e,slotKey:"flower",BGComponent:w.Z,onClick:()=>v(e),showLocation:!0})},e)))})]})]})}),(0,D.BX)(xe.Z,{sx:{display:"flex",width:"100%"},children:[(0,D.tZ)(g.Z,{onClick:S,disabled:e||!u,startIcon:l?(0,D.tZ)(Dn.Z,{}):(0,D.tZ)(Mn.Z,{}),color:l?"secondary":"success",sx:{flexGrow:1},children:(0,D.BX)(h.Z,{sx:{display:"flex",gap:1},children:[(0,D.tZ)(h.Z,{children:a("excludeArt.button_txt")}),(0,D.tZ)(M.Z,{sx:{whiteSpace:"normal"},color:u?l?"warning":"primary":"secondary",children:l?(0,D.BX)(b.cC,{t:a,i18nKey:"excludeArt.usingNum",children:["Using ",{totalStr:t}," excluded artifacts"]}):(0,D.BX)(b.cC,{t:a,i18nKey:"excludeArt.excNum",count:u,children:[{count:u}," artifacts are excluded"]})})]})}),(0,D.tZ)(g.Z,{color:"info",onClick:c,disabled:e,sx:{flexShrink:1},children:(0,D.tZ)(Ze.Z,{})})]})]})}const ir={xs:6,sm:6,md:9,lg:12,xl:12},rr=(e,t)=>Object.assign({},e,t);function lr({onSelect:e,show:t,onClose:a,artExclusion:i}){const{t:r}=(0,b.$G)("page_character_optimize"),{database:l}=(0,x.useContext)(Q.t),s=(0,x.useCallback)((t=>{e(t),a()}),[e,a]),[o,c]=(0,x.useReducer)(rr,(0,Ui.Af)()),[d,u]=(0,n.NW)();(0,x.useEffect)((()=>l.arts.followAny(u)),[l,u]);const m=(0,n.JT)(),f=(0,x.useMemo)((()=>(0,Ui.EM)()),[]),g=(0,x.useMemo)((()=>{const e=(0,le.CZ)(o,f);return d&&l.arts.values.filter(e).map((e=>e.id)).filter((e=>!i.includes(e))).slice(0,ir[m])}),[d,l,f,o,m,i]);return(0,D.tZ)(Be.Z,{open:t,onClose:a,containerProps:{maxWidth:"xl"},children:(0,D.BX)(C.Z,{children:[(0,D.BX)(p.Z,{sx:{py:1,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,D.tZ)(pe.Z,{variant:"h6",children:r(tr||(tr=ar`excludeArt.selExc`))}),(0,D.tZ)(k.Z,{onClick:a})]}),(0,D.tZ)(je.Z,{}),(0,D.BX)(p.Z,{children:[(0,D.tZ)(x.Suspense,{fallback:(0,D.tZ)(Z.Z,{variant:"rectangular",width:"100%",height:200}),children:(0,D.tZ)(Hi.default,{filterOption:o,filterOptionDispatch:c,filteredIds:g})}),(0,D.tZ)(h.Z,{mt:1,children:(0,D.tZ)(x.Suspense,{fallback:(0,D.tZ)(Z.Z,{variant:"rectangular",width:"100%",height:300}),children:(0,D.tZ)(Ce.ZP,{container:!0,spacing:1,columns:{xs:2,md:3,lg:4},children:g.map((e=>(0,D.tZ)(Ce.ZP,{item:!0,xs:1,children:(0,D.tZ)(ii.Z,{artifactId:e,onClick:s})},e)))})})})]})]})})}var sr=a(61851);const or=["sands","goblet","circlet"];function cr({disabled:e=!1,filteredArtIdMap:t}){const{t:a}=(0,b.$G)("artifact"),{character:{key:n}}=(0,x.useContext)(T.K),{buildSetting:{mainStatKeys:r},buildSettingDispatch:l}=Ra(n),{database:s}=(0,x.useContext)(Q.t),{mainStatSlotTots:o,slotTots:c}=(0,x.useMemo)((()=>{const e={flowerMainStatTots:i.x1.flower.stats,plumeMainStatTots:i.x1.plume.stats,sandsMainStatTots:i.x1.sands.stats,gobletMainStatTots:i.x1.goblet.stats,circletMainStatTots:i.x1.circlet.stats,slotTots:or},a=(0,Ka.A)(e,(e=>Object.entries(s.arts.data).forEach((([a,n])=>{const{slotKey:i,mainStatKey:r}=n;or.includes(i)&&(e.slotTots[i].total++,t[a]&&e.slotTots[i].current++),e[`${i}MainStatTots`][r].total++,t[a]&&e[`${i}MainStatTots`][r].current++}))));return{mainStatSlotTots:{flower:a.flowerMainStatTots,plume:a.plumeMainStatTots,sands:a.sandsMainStatTots,goblet:a.gobletMainStatTots,circlet:a.circletMainStatTots},slotTots:a.slotTots}}),[s,t]);return(0,D.BX)(h.Z,{display:"flex",flexDirection:"column",children:[(0,D.tZ)(je.Z,{}),(0,D.BX)(h.Z,{display:"flex",children:[(0,D.tZ)(p.Z,{sx:{flexGrow:1},children:(0,D.BX)(h.Z,{sx:{display:"flex",gap:1,alignItems:"center"},children:[(0,D.tZ)(Za.Z,{placement:"top",title:(0,D.tZ)(pe.Z,{children:a("slotName.flower")}),children:(0,D.tZ)(B.pv,{fontSize:"inherit"})}),(0,D.tZ)(h.Z,{flexGrow:1,children:(0,D.BX)(M.Z,{color:"info",children:[(0,D.tZ)(B.If,Object.assign({},S.mX))," ",o.flower.hp]})})]})}),(0,D.tZ)(je.Z,{orientation:"vertical",flexItem:!0}),(0,D.tZ)(p.Z,{sx:{flexGrow:1},children:(0,D.BX)(h.Z,{sx:{display:"flex",gap:1,alignItems:"center"},children:[(0,D.tZ)(Za.Z,{placement:"top",title:(0,D.tZ)(pe.Z,{children:a("slotName.plume")}),children:(0,D.tZ)(B.QA,{fontSize:"inherit"})}),(0,D.tZ)(h.Z,{flexGrow:1,children:(0,D.BX)(M.Z,{color:"info",children:[(0,D.tZ)(B._B,Object.assign({},S.mX))," ",o.plume.atk]})})]})})]}),or.map((t=>{const n=r[t],s=i.x1[t].stats,d=(0,sr.X)([...s]);return(0,D.BX)(h.Z,{children:[(0,D.tZ)(je.Z,{}),(0,D.BX)(p.Z,{sx:{pt:1,pb:1},children:[(0,D.BX)(h.Z,{sx:{display:"flex",gap:1,alignItems:"center",pb:1},children:[(0,D.tZ)(Za.Z,{placement:"top",title:(0,D.tZ)(pe.Z,{children:a(`slotName.${t}`)}),children:(0,D.tZ)(h.Z,{lineHeight:0,children:(0,D.tZ)(Pa.Z,{slotKey:t,iconProps:{fontSize:"inherit"}})})}),(0,D.tZ)(h.Z,{flexGrow:1,children:(0,D.tZ)(M.Z,{color:"info",children:c[t]})})]}),(0,D.tZ)(Ce.ZP,{container:!0,spacing:1,children:s.map(((a,s)=>{const c=i.fR.find((e=>a.includes(e))),u=n.includes(a)?null!=c?c:"success":"secondary";return(0,D.tZ)(Ce.ZP,{item:!0,flexGrow:1,xs:s<3&&"goblet"!==t||"goblet"===t?4:void 0,children:(0,D.tZ)(Za.Z,{placement:"top",title:(0,D.tZ)(pe.Z,{children:(0,D.tZ)("strong",{children:(0,D.tZ)(Vn,{statKey:a})})}),disableInteractive:!0,children:(0,D.tZ)(g.Z,{fullWidth:!0,size:"small",color:u,sx:{height:"100%",pointerEvents:e?"none":void 0,cursor:e?"none":void 0},startIcon:(0,D.tZ)(P.C,{statKey:a}),onClick:()=>l({mainStatKeys:Object.assign({},r,{[t]:d(n,a)})}),children:o[t][a]})})},a)}))})]})]},t)}))]})}function dr({statFilters:e,setStatFilters:t,disabled:a=!1}){const n=(0,x.useCallback)(((a,n,i)=>{var r;const l=Object.assign({},e),s=JSON.stringify(n),o=n?[...e[s]]:void 0,c=JSON.stringify(a),d=[...null!=(r=e[c])?r:[]];void 0!==i&&o?d.push(o[i]):d.push({value:0,disabled:!1}),l[c]=d,void 0!==i&&o&&(o.splice(i,1),o.length?l[s]=o:delete l[s]),t(Object.assign({},l))}),[t,e]),i=(0,x.useCallback)(((a,n)=>{const i=Object.assign({},e),r=JSON.stringify(a),l=[...e[r]];l.splice(n,1),l.length?i[r]=l:delete i[r],t(Object.assign({},i))}),[t,e]),r=(0,x.useCallback)(((a,n,i)=>{const r=Object.assign({},e),l=JSON.stringify(a),s=[...e[l]];s[n]=Object.assign({},s[n],{value:i}),r[l]=s,t(Object.assign({},r))}),[t,e]),l=(0,x.useCallback)(((a,n,i)=>{const r=Object.assign({},e),l=JSON.stringify(a),s=[...e[l]];s[n]=Object.assign({},s[n],{disabled:i}),r[l]=s,t(Object.assign({},r))}),[t,e]);return(0,D.BX)(D.HY,{children:[Object.entries(e).flatMap((([e,t])=>null==t?void 0:t.map(((t,s)=>(0,D.tZ)(ur,{path:JSON.parse(e),setting:t,index:s,setTarget:n,delTarget:i,setValue:r,setDisabled:l,disabled:a},e+s))))),(0,D.tZ)(ur,{setTarget:n,delTarget:i,setValue:r,setDisabled:l,disabled:a})]})}function ur({path:e,setting:t,index:a,setTarget:n,delTarget:i,setValue:r,setDisabled:l,disabled:s}){var o;const{t:c}=(0,b.$G)("page_character_optimize"),{data:d}=(0,x.useContext)(j.R),u=(0,x.useCallback)((t=>e&&void 0!==a&&r(e,a,null!=t?t:0)),[r,e,a]),h={p:1,flexBasis:30,flexGrow:0,flexShrink:0},Z=(0,re.Hm)(d.getDisplay(),null!=e?e:[]),p="%"===(null==Z||null==(o=Z.info)?void 0:o.unit);return(0,D.BX)(xe.Z,{sx:{"& .MuiButtonGroup-grouped":{minWidth:24},width:"100%"},children:[!!t&&!!e&&void 0!==a&&(0,D.tZ)(g.Z,{sx:h,color:t.disabled?"secondary":"success",onClick:()=>l(e,a,!t.disabled),disabled:s,children:t.disabled?(0,D.tZ)(jt.Z,{}):(0,D.tZ)(Tt.Z,{})}),(0,D.tZ)(Ve,{showEmptyTargets:!0,optimizationTarget:e,setTarget:t=>n(t,e,a),defaultText:c("targetSelector.selectBuildTarget")}),(0,D.tZ)(ke.CC,{sx:{flexBasis:150,flexGrow:1},children:(0,D.tZ)(ke.ZP,{float:!0,disabled:!e||s,value:null==t?void 0:t.value,placeholder:"Stat Value",onChange:u,sx:{px:1},inputProps:{sx:{textAlign:"right"}},endAdornment:p?"%":void 0})}),!!e&&void 0!==a&&(0,D.tZ)(g.Z,{sx:h,color:"error",onClick:()=>i(e,a),disabled:s,children:(0,D.tZ)(ca.Z,{fontSize:"small"})})]})}let hr,Zr,pr=e=>e;function mr({disabled:e=!1}){const{t}=(0,b.$G)("page_character_optimize"),{character:{key:a}}=(0,x.useContext)(T.K),{buildSetting:{statFilters:n},buildSettingDispatch:i}=Ra(a),r=(0,x.useCallback)((e=>i({statFilters:e})),[i]);return(0,D.tZ)(h.Z,{children:(0,D.BX)(w.Z,{children:[(0,D.tZ)(p.Z,{sx:{display:"flex",gap:1,justifyContent:"space-between",flexDirection:"column"},children:(0,D.BX)(h.Z,{display:"flex",justifyContent:"space-between",children:[(0,D.tZ)(pe.Z,{sx:{fontWeight:"bold"},children:t(hr||(hr=pr`constraintFilter.title`))}),(0,D.tZ)(Se.Z,{title:(0,D.tZ)(pe.Z,{children:t(Zr||(Zr=pr`constraintFilter.tooltip`))})})]})}),(0,D.tZ)(je.Z,{}),(0,D.tZ)(h.Z,{display:"flex",flexDirection:"column",gap:.5,children:(0,D.tZ)(dr,{statFilters:n,setStatFilters:r,disabled:e})})]})})}const fr=(0,va.yY)((0,le.I8)({dyn:Object.assign({},K.qH.art,K.qH.artSet)})),gr={art:(0,le.K8)([...i.rW,...i._m],(e=>fr.dyn[e])),artSet:(0,le.vU)(K.qH.artSet,((e,t)=>fr.dyn[t]))};let xr,br,yr,vr,Cr,wr,kr,Sr=e=>e;const Br=new Audio("notification.mp3");function Xr(){var e,t;const{t:a}=(0,b.$G)("page_character_optimize"),{character:{key:r,compareData:l}}=(0,x.useContext)(T.K),{database:s}=(0,x.useContext)(Q.t),{setChartData:c,graphBuilds:d,setGraphBuilds:u}=(0,x.useContext)(U),{gender:Z}=(0,ae.Z)(),[m,f]=(0,x.useState)(!1),y=(0,x.useRef)(!1);(0,x.useEffect)((()=>{y.current=m}),[m]);const[v,C]=(0,x.useState)({type:"inactive",tested:0,failed:0,skipped:0,total:0}),k="inactive"!==v.type,[S,B]=(0,n.NW)(),[{threads:K=sa.gk},O]=(0,x.useState)(s.displayOptimize.get());(0,x.useEffect)((()=>s.displayOptimize.follow(((e,t)=>O(t)))),[s,O]);const P=K>sa.gk?sa.gk:K,E=(0,x.useCallback)((e=>s.displayOptimize.set({threads:e})),[s]),A=(0,te.Z)(r),I=(0,gt.Z)();(0,x.useEffect)((()=>{C({type:"inactive",tested:0,failed:0,skipped:0,total:0})}),[r]);const R=(0,x.useMemo)((()=>!s.arts.values.length),[s]),{buildSetting:G,buildSettingDispatch:$}=Ra(r),{plotBase:N,optimizationTarget:W,mainStatAssumptionLevel:q,allowPartial:H,maxBuildsToShow:Y,levelLow:J,levelHigh:ee}=G,{buildResult:{builds:ie,buildDate:re},buildResultDispatch:se}=Xi(r),oe=(0,ne.ZP)(r,q),{characterSheet:ce,target:de}=null!=(e=null==oe?void 0:oe[r])?e:{},ue=W&&(0,le.Hm)(null==de?void 0:de.getDisplay(),W),he=["xs","sm"].includes((0,n.JT)());(0,x.useEffect)((()=>s.arts.followAny(B)),[B,s]);const Ze=(0,x.useDeferredValue)(S),me=(0,x.useDeferredValue)(G),fe=(0,x.useMemo)((()=>{const{mainStatKeys:e,excludedLocations:t,artExclusion:a,levelLow:n,levelHigh:l,allowLocationsState:o,useExcludedArts:c}=Ze&&me;return s.arts.values.filter((s=>{if(!c&&a.includes(s.id))return!1;if(s.level<n)return!1;if(s.level>l)return!1;const d=e[s.slotKey];if(null!=d&&d.length&&!d.includes(s.mainStatKey))return!1;const u=(0,i.V7)(r),h="unequippedOnly"===o&&s.location&&s.location!==u,Z="customList"===o&&s.location&&s.location!==u&&t.includes(s.location);return!h&&!Z}))}),[s,r,Ze,me]),ge=(0,x.useMemo)((()=>(0,le.K8)(fe.map((({id:e})=>e)),(e=>!0))),[fe]),{levelTotal:be,allowListTotal:ye,excludedTotal:ve}=(0,x.useMemo)((()=>(0,Ka.A)({levelTotal:["in"],allowListTotal:["in"],excludedTotal:["in"]},(e=>Object.entries(s.arts.data).forEach((([t,a])=>{const{level:n,location:l}=a,{levelLow:s,levelHigh:o,excludedLocations:c,allowLocationsState:d,artExclusion:u}=Ze&&me;n>=s&&n<=o&&(e.levelTotal.in.total++,ge[t]&&e.levelTotal.in.current++);const h=(0,i.V7)(r),Z="all"===d&&l&&l!==h,p="customList"===d&&l&&l!==h&&!c.includes(l);(Z||p)&&(e.allowListTotal.in.total++,ge[t]&&e.allowListTotal.in.current++),u.includes(t)&&(e.excludedTotal.in.total++,ge[t]&&e.excludedTotal.in.current++)}))))),[r,s.arts.data,Ze,me,ge]),we=(0,x.useRef)(!0);(0,x.useEffect)((()=>{const e=()=>we.current=!0,t=()=>we.current=!1;return window.addEventListener("focus",e),window.addEventListener("blur",t),()=>{window.removeEventListener("focus",e),window.removeEventListener("blur",t)}}),[we]);const ke=(0,x.useRef)((()=>{}));(0,x.useEffect)((()=>()=>ke.current()),[]);const Be=function(){const[,e]=(0,x.useState)();return(0,x.useCallback)((t=>{e((()=>{throw t}))}),[])}(),Xe=(0,x.useCallback)((async()=>{var e,t,n;const{artSetExclusion:l,plotBase:o,statFilters:d,optimizationTarget:u,mainStatAssumptionLevel:h,allowPartial:p,maxBuildsToShow:m}=G;if(!r||!u)return;const f=function(e,t,a){const n={base:{},values:{flower:[],plume:[],goblet:[],circlet:[],sands:[]}},r=new Set;for(const l of e){const e=(0,An.Bv)(l.mainStatKey,l.rarity,Math.max(Math.min(t,i.F7[l.rarity]),l.level)),a={id:l.id,set:l.setKey,values:Object.assign({[l.setKey]:1,[l.mainStatKey]:l.mainStatKey.endsWith("_")?e/100:e},Object.fromEntries(l.substats.map((e=>[e.key,e.key.endsWith("_")?e.accurateValue/100:e.accurateValue]))))};delete a.values[""],n.values[l.slotKey].push(a),Object.keys(a.values).forEach((e=>r.add(e)))}if(n.base=(0,le.K8)([...r],(e=>0)),a)for(const i of Object.values(n.values))i.push({id:"",values:{}});return n}(fe,h,p),g=(0,ne.VF)(s,r,h,[]);if(!g)return;const x=null==(e=(0,xa.Qo)(g.teamData,Z,r)[r])?void 0:e.target.data[0];if(!x)return;Object.assign(x,(0,xa.b3)([x,gr]));const b=(0,le.Hm)(null!=(t=x.display)?t:{},u);if(!b)return;const v=b,w=Object.entries(d).flatMap((([e,t])=>t.filter((e=>!e.disabled)).map((t=>{var a,n;const i=(0,le.Hm)(null!=(a=x.display)?a:{},JSON.parse(e));return{value:i,minimum:"%"===(null==(n=i.info)?void 0:n.unit)?t.value/100:t.value}})))).filter((e=>e.value&&e.minimum>-1/0));c(void 0);const k=new Promise((e=>ke.current=e)),S=[...w.map((e=>e.value)),b],B=[...w.map((e=>e.minimum)),-1/0],X=o&&(0,le.Hm)(null!=(n=x.display)?n:{},o);X&&(S.push(X),B.push(-1/0));const _=(0,ba.tL)(S,x,(({path:[e]})=>"dyn"!==e)),T=X?_.pop():void 0,j={arts:f,optimizationTarget:_.pop(),exclusion:l,constraints:_.map(((e,t)=>({value:e,min:B[t]}))),topN:m,plotBase:T},K={tested:0,failed:0,skipped:0,total:0,startTime:performance.now()},O=setInterval((()=>C(Object.assign({type:"active"},K))),100),E=new Error;try{const e=new GOSolver(j,K,P);k.then((()=>e.cancel(E)));const t=await e.solve();if(e.cancel(),ke.current=()=>{},X){var M,D;const e=function(e){let t=.01,a=new Set(e.flatMap((e=>Object.values(e).map((e=>Math.round(e.plot/t))))));for(;a.size>1500;)t*=2,a=new Set([...a].map((e=>Math.round(e/2))));const n={};for(const i of e)for(const e of Object.values(i)){const a=Math.round(e.plot/t)*t;(!n[a]||n[a].value<e.value)&&(n[a]=e)}return n}(t.map((e=>e.plotData)));let a=Object.values(e);"%"===(null==(M=v.info)?void 0:M.unit)&&(a=a.map((({value:e,plot:t,artifactIds:a})=>({value:100*e,plot:t,artifactIds:a})))),"%"===(null==(D=X.info)?void 0:D.unit)&&(a=a.map((({value:e,plot:t,artifactIds:a})=>({value:e,plot:100*(null!=t?t:0),artifactIds:a})))),c({valueNode:v,plotNode:X,data:a})}const n=function(e,t){return e.flatMap((e=>e)).sort(((e,t)=>t.value-e.value)).slice(0,t)}(t.map((e=>e.builds)),m);0,se({builds:n.map((e=>e.artifactIds)),buildDate:Date.now()}),setTimeout((()=>{t&&y.current&&(Br.play(),we.current||setTimeout((()=>window.alert(a(xr||(xr=Sr`buildCompleted`)))),1))}),100)}catch(A){A!==E&&(console.log("Failed to load worker"),console.log(A),A instanceof Error&&Be(A)),ke.current(),K.tested=0,K.failed=0,K.skipped=0,K.total=0}finally{clearInterval(O),C(Object.assign({type:"inactive"},K,{finishTime:performance.now()}))}}),[G,r,fe,s,Z,c,P,se,a,Be]),_e=null!=(t=null==ce?void 0:ce.name)?t:"Character Name",Te=(0,x.useCallback)((e=>{$({plotBase:e}),c(void 0)}),[$,c]),Ke=(0,x.useMemo)((()=>de&&oe&&{data:de,teamData:oe}),[de,oe]),Oe=(0,D.tZ)(Ve,{optimizationTarget:W,setTarget:e=>$({optimizationTarget:e}),disabled:!!k}),Pe=(0,x.useCallback)((e=>(0,D.BX)(b.cC,{t:a,i18nKey:"graphBuildLabel",count:e+1,children:["Graph #",{count:e+1}]})),[a]),Ee=(0,x.useCallback)((e=>`#${e+1}`),[]);return(0,D.BX)(h.Z,{display:"flex",flexDirection:"column",gap:1,children:[R&&(0,D.tZ)(fa,{}),Ke&&(0,D.BX)(j.R.Provider,{value:Ke,children:[(0,D.BX)(Ce.ZP,{container:!0,spacing:1,children:[(0,D.BX)(Ce.ZP,{item:!0,xs:12,sm:6,lg:3,display:"flex",flexDirection:"column",gap:1,children:[(0,D.tZ)(h.Z,{children:(0,D.tZ)(pa.Z,{characterKey:r,onClickTeammate:I})}),(0,D.tZ)(_n,{})]}),(0,D.BX)(Ce.ZP,{item:!0,xs:12,sm:6,lg:4,display:"flex",flexDirection:"column",gap:1,children:[(0,D.BX)(w.Z,{children:[(0,D.BX)(p.Z,{sx:{display:"flex",gap:1},children:[(0,D.tZ)(pe.Z,{sx:{fontWeight:"bold"},children:a(br||(br=Sr`levelFilter`))}),(0,D.tZ)(M.Z,{color:"info",children:be.in})]}),(0,D.tZ)(je.Z,{}),(0,D.tZ)(p.Z,{children:(0,D.tZ)(ha.Z,{levelLow:J,levelHigh:ee,setLow:e=>$({levelLow:e}),setHigh:e=>$({levelHigh:e}),setBoth:(e,t)=>$({levelLow:e,levelHigh:t}),disabled:k})})]}),(0,D.BX)(w.Z,{children:[(0,D.tZ)(p.Z,{children:(0,D.tZ)(pe.Z,{sx:{fontWeight:"bold"},children:a(yr||(yr=Sr`mainStat.title`))})}),(0,D.tZ)(je.Z,{}),(0,D.tZ)(p.Z,{children:(0,D.BX)(h.Z,{display:"flex",alignItems:"center",gap:1,children:[(0,D.tZ)(Sn,{mainStatAssumptionLevel:q,setmainStatAssumptionLevel:e=>$({mainStatAssumptionLevel:e}),disabled:k}),(0,D.tZ)(Se.Z,{title:(0,D.BX)(h.Z,{children:[(0,D.tZ)(pe.Z,{variant:"h6",children:a(vr||(vr=Sr`mainStat.levelAssTooltip.title`))}),(0,D.tZ)(pe.Z,{children:a(Cr||(Cr=Sr`mainStat.levelAssTooltip.desc`))})]})})]})}),(0,D.tZ)(cr,{disabled:k,filteredArtIdMap:ge})]})]}),(0,D.BX)(Ce.ZP,{item:!0,xs:12,sm:6,lg:5,display:"flex",flexDirection:"column",gap:1,children:[(0,D.tZ)(yn,{disabled:k}),(0,D.tZ)(nr,{disabled:k,excludedTotal:ve.in}),(0,D.tZ)(g.Z,{fullWidth:!0,startIcon:H?(0,D.tZ)(Tt.Z,{}):(0,D.tZ)(jt.Z,{}),color:H?"success":"secondary",onClick:()=>$({allowPartial:!H}),disabled:k,children:a(wr||(wr=Sr`allowPartial`))}),(0,D.tZ)(Fa,{disabled:k,allowListTotal:ye.in}),(0,D.tZ)(mr,{disabled:k})]})]}),he&&Oe,(0,D.BX)(xe.Z,{children:[!he&&Oe,(0,D.BX)(L.Z,{disabled:k||!r,title:(0,D.BX)(b.cC,{t:a,i18nKey:"build",count:Y,children:[{count:Y}," Builds"]}),children:[(0,D.tZ)(X.Z,{children:(0,D.tZ)(pe.Z,{variant:"caption",color:"info.main",children:a("buildDropdownDesc")})}),(0,D.tZ)(je.Z,{}),sa.sY.map((e=>(0,D.tZ)(X.Z,{onClick:()=>$({maxBuildsToShow:e}),children:(0,D.BX)(b.cC,{t:a,i18nKey:"build",count:e,children:[{count:e}," Builds"]})},e)))]}),(0,D.BX)(L.Z,{disabled:k||!r,sx:{borderRadius:"4px 0px 0px 4px"},title:(0,D.BX)(b.cC,{t:a,i18nKey:"thread",count:P,children:[{count:P}," Threads"]}),children:[(0,D.tZ)(X.Z,{children:(0,D.tZ)(pe.Z,{variant:"caption",color:"info.main",children:a("threadDropdownDesc")})}),(0,D.tZ)(je.Z,{}),(0,le.w6)(1,sa.gk).reverse().map((e=>(0,D.tZ)(X.Z,{onClick:()=>E(e),children:(0,D.BX)(b.cC,{t:a,i18nKey:"thread",count:e,children:[{count:e}," Threads"]})},e)))]}),(0,D.tZ)(Za.Z,{placement:"top",title:a(kr||(kr=Sr`notifyTooltip`)),children:(0,D.tZ)(g.Z,{sx:{borderRadius:0},color:"warning",onClick:()=>f((e=>!e)),children:m?(0,D.tZ)(da.Z,{}):(0,D.tZ)(ua.Z,{})})}),(0,D.tZ)(Za.Z,{placement:"top",title:W?"":a("selectTargetFirst"),children:(0,D.tZ)("span",{children:(0,D.tZ)(g.Z,{disabled:!r||!W||!ue||ue.isEmpty,color:k?"error":"success",onClick:k?()=>ke.current():Xe,startIcon:k?(0,D.tZ)(oa.Z,{}):(0,D.tZ)(o.Z,{}),sx:{borderRadius:"0px 4px 4px 0px"},children:a(k?"generateButton.cancel":"generateButton.generateBuilds")})})})]}),!!r&&(0,D.tZ)(On,{status:v,characterName:_e,maxBuildsToShow:Y}),(0,D.tZ)(h.Z,{children:(0,D.tZ)(Gi,{disabled:k||!W,plotBase:N,setPlotBase:Te,showTooltip:!W})}),(0,D.tZ)(w.Z,{children:(0,D.BX)(p.Z,{children:[(0,D.BX)(h.Z,{display:"flex",alignItems:"center",gap:1,mb:1,children:[(0,D.tZ)(pe.Z,{sx:{flexGrow:1},children:ie?(0,D.BX)("span",{children:["Showing"," ",(0,D.tZ)("strong",{children:ie.length+(d?d.length:0)})," ","build generated for ",_e,"."," ",!!re&&(0,D.BX)("span",{children:["Build generated on:"," ",(0,D.tZ)("strong",{children:new Date(re).toLocaleString()})]})]}):(0,D.tZ)("span",{children:"Select a character to generate builds."})}),(0,D.tZ)(g.Z,{disabled:!ie.length,color:"error",onClick:()=>{u(void 0),se({builds:[],buildDate:0})},children:"Clear Builds"})]}),(0,D.BX)(Ce.ZP,{container:!0,display:"flex",spacing:1,children:[(0,D.tZ)(Ce.ZP,{item:!0,children:(0,D.tZ)(V,{size:"small"})}),(0,D.tZ)(Ce.ZP,{item:!0,children:(0,D.tZ)(F,{size:"small"})}),(0,D.tZ)(Ce.ZP,{item:!0,flexGrow:1}),(0,D.tZ)(Ce.ZP,{item:!0,children:(0,D.BX)(z.Z,{exclusive:!0,value:l,onChange:(e,t)=>A({compareData:t}),size:"small",children:[(0,D.tZ)(_.Z,{value:!1,disabled:!l,children:"Show new builds"}),(0,D.tZ)(_.Z,{value:!0,disabled:l,children:"Compare vs. equipped"})]})})]})]})}),(0,D.BX)(ga.Provider,{value:W,children:[d&&(0,D.tZ)(_r,{builds:d,characterKey:r,data:de,compareData:l,disabled:!!k,getLabel:Pe,setBuilds:u}),(0,D.tZ)(_r,{builds:ie,characterKey:r,data:de,compareData:l,disabled:!!k,getLabel:Ee})]})]})]})}function _r({builds:e,setBuilds:t,characterKey:a,data:n,compareData:i,disabled:r,getLabel:l}){const s=(0,x.useCallback)((a=>{if(t){const n=[...e];n.splice(a,1),t(n)}}),[e,t]);return(0,x.useMemo)((()=>(0,D.tZ)(x.Suspense,{fallback:(0,D.tZ)(Z.Z,{variant:"rectangular",width:"100%",height:600}),children:null==e?void 0:e.map(((e,o)=>a&&n&&(0,D.tZ)(jr,{characterKey:a,build:e,oldData:n,children:(0,D.tZ)(Tr,{index:o,label:l(o),build:e,compareData:i,disabled:r,deleteBuild:t?s:void 0})},o+e.join())))})),[e,a,n,i,r,l,s,t])}function Tr({index:e,label:t,build:a,compareData:n,disabled:i,deleteBuild:r}){const{t:l}=(0,b.$G)("page_character_optimize"),s=(0,y.TH)(),o=(0,y.s0)(),d=(0,x.useCallback)((()=>{const e=s.pathname.split("/");e.pop(),o(`${e.join("/")}/theorycraft`,{state:{build:a}})}),[o,a,s.pathname]);return(0,D.tZ)(ui,{label:t,compareBuild:n,disabled:i,extraButtonsLeft:(0,D.BX)(D.HY,{children:[(0,D.tZ)(g.Z,{color:"info",size:"small",startIcon:(0,D.tZ)(c.Z,{}),onClick:d,children:l("theorycraftButton")}),r&&(0,D.tZ)(g.Z,{color:"error",size:"small",startIcon:(0,D.tZ)(ca.Z,{}),onClick:()=>r(e),children:l("removeBuildButton")})]})})}function jr({children:e,characterKey:t,build:a,oldData:i}){const{database:r}=(0,x.useContext)(Q.t),{buildSetting:{mainStatAssumptionLevel:l}}=Ra(t),[s,o]=(0,n.NW)();(0,x.useEffect)((()=>r.arts.followAny((e=>a.includes(e)&&o()))),[r,a,o]);const c=(0,x.useMemo)((()=>s&&a.map((e=>r.arts.get(e))).filter((e=>e))),[s,a,r]),d=(0,ne.ZP)(t,l,c),u=(0,x.useMemo)((()=>{const e=null==d?void 0:d[t];if(e)return{data:e.target,teamData:d,oldData:i}}),[d,i,t]);return u?(0,D.tZ)(j.R.Provider,{value:u,children:e}):null}const Kr=a.p+"Character_Albedo_Card.5892308f446f759f.png",Or=a.p+"Character_Alhaitham_Card.390618cfb70f0e4e.jpg",Pr=a.p+"Character_Aloy_Card.b6b990337b74f55f.png",Er=a.p+"Character_Amber_Card.2830ac6d2ff3846d.jpg",Mr=a.p+"Character_Arataki_Itto_Card.e1e874752d65877c.jpg",Dr=a.p+"Character_Baizhu_Card.19f716d36f154360.jpg",Ar=a.p+"Character_Barbara_Card.f372476873df3b6d.jpg",Ir=a.p+"Character_Beidou_Card.916c73f4f4a3ca3c.jpg",Rr=a.p+"Character_Bennett_Card.25f8771de05532d0.jpg",Lr=a.p+"Character_Candace_Card.6353e91b7bcd4404.jpg",zr=a.p+"Character_Charlotte_Card.d62569d3d856b446.jpg",Gr=a.p+"Character_Chevreuse_Card.41e8f351217749ba.jpg",$r=a.p+"Character_Chongyun_Card.1770f1995289db9c.jpg",Nr=a.p+"Character_Collei_Card.aaa7e8dc2183674d.jpg",Wr=a.p+"Character_Cyno_Card.65e14ca6391b2f37.jpg",Fr=a.p+"Character_Dehya_Card.eeff4efcde0ab4f5.jpg",Vr=a.p+"Character_Diluc_Card.18a7a83ac9ce0b87.jpg",qr=a.p+"Character_Diona_Card.21bd261dfcfe1c21.png",Hr=a.p+"Character_Dori_Card.ab5ef6d6304aec80.jpg",Ur=a.p+"Character_Eula_Card.e680ce8ea2567c4f.png",Yr=a.p+"Character_Faruzan_Card.8e06d53607285885.jpg",Jr=a.p+"Character_Fischl_Card.d45651a83cfbca82.jpg",Qr=a.p+"Character_Freminet_Card.9d2a6e594423439d.jpg",el=a.p+"Character_Furina_Card.a50ca164f1c3f956.jpg",tl=a.p+"Character_Gaming_Card.6f5034fdf0bfc9e1.jpg",al=a.p+"Character_Ganyu_Card.5dc050fe16cea049.png",nl=a.p+"Character_Gorou_Card.50bf591a764d2242.png",il=a.p+"Character_Hu_Tao_Card.d087463aac3ba35f.png",rl=a.p+"Character_Jean_Card.36b2f258f4290f55.jpg",ll=a.p+"Character_Kaeya_Card.b2645bca5fa7a637.jpg",sl=a.p+"Character_Kaveh_Card.7f11be5aaf366a88.jpg",ol=a.p+"Character_Kamisato_Ayaka_Card.e481f78f6bb51a31.png",cl=a.p+"Character_Kamisato_Ayato_Card.c32d0bbba107a804.png",dl=a.p+"Character_Kazuha_Card.09ababa93ec3a3e2.png",ul=a.p+"Character_Keqing_Card.ed7c0168559732f6.jpg",hl=a.p+"Character_Kirara_Card.f5792590c4f5a97d.jpg",Zl=a.p+"Character_Klee_Card.e0ee4daa68e99a52.jpg",pl=a.p+"Character_Kujou_Sara_Card.1f934a5832be2b5c.jpg",ml=a.p+"Character_Kuki_Shinobu_Card.3247590264aa41ec.jpg",fl=a.p+"Character_Layla_Card.1e4a55ea008f4fa2.jpeg",gl=a.p+"Character_Lisa_Card.4966ba74ac03470a.jpg",xl=a.p+"Character_Lyney_Card.83574b5d5adf4c43.jpg",bl=a.p+"Character_Lynette_Card.1a7ba1c24c9aa9d3.jpg",yl=a.p+"Character_Mika_Card.280a1899f15cfea5.jpg",vl=a.p+"Character_Mona_Card.d14df945153b29c3.jpg",Cl=a.p+"Character_Nahida_Card.c01ab425bddc31ae.jpeg",wl=a.p+"Character_Navia_Card.2abe7fc6b3dfd08f.jpg",kl=a.p+"Character_Neuvillette_Card.d775e9330c010b45.jpg",Sl=a.p+"Character_Nilou_Card.13f5e94ed5181b37.jpg",Bl=a.p+"Character_Ningguang_Card.cd89f11944f1c9cd.jpg",Xl=a.p+"Character_Noelle_Card.394f26d7473fd2ad.jpg",_l=a.p+"Character_Qiqi_Card.8728d970279d46ac.jpg",Tl=a.p+"Character_Raiden_Shogun_Card.56a2190f00c137f3.png",jl=a.p+"Character_Razor_Card.1b116c57394d4b1b.jpg",Kl=a.p+"Character_Rosaria_Card.8267339e414b4b96.png",Ol=a.p+"Character_Sangonomiya_Kokomi_Card.843fc41e00f54a04.jpg",Pl=a.p+"Character_Sayu_Card.5d2a94faea5e0c8e.png",El=a.p+"Character_Shenhe_Card.883f751b234b9ec6.jpg",Ml=a.p+"Character_Shikanoin_Heizou_Card.e3c6c8b01018558e.png",Dl=a.p+"Character_Somnia_Card.36432f04e4174367.png",Al=a.p+"Character_Sucrose_Card.a5b72ffa09e14920.jpg",Il=a.p+"Character_Tartaglia_Card.daa075230d685675.png",Rl=a.p+"Character_Thoma_Card.8aaf239f62fe5ce8.jpg",Ll=a.p+"Character_Tighnari_Card.c59a95c5d6c8e80b.jpg",zl=a.p+"Character_Venti_Card.53c36f1f18e39e8c.jpg",Gl=a.p+"Character_Wanderer_Card.9280e378fab9bec7.jpg",$l=a.p+"Character_Wriothesley_Card.85c1fd9bd1edf599.jpg",Nl=a.p+"Character_Xiangling_Card.5693675f27b0f2d7.jpg",Wl=a.p+"Character_Xiao_Card.505ee35780a80258.jpg",Fl=a.p+"Character_Xingqiu_Card.7eb5998349f9541d.jpg",Vl=a.p+"Character_Xinyan_Card.592529410cb0ab30.jpg",ql=a.p+"Character_Xianyun_Card.3227ce640f90a84c.jpg",Hl=a.p+"Character_Yae_Miko_Card.4ad3e897b1e3a097.png",Ul=a.p+"Character_Yanfei_Card.0e3112d6ef574c1a.png",Yl=a.p+"Character_Yaoyao_Card.b1085e13b40477e1.jpg",Jl=a.p+"Character_Yelan_Card.3a483ca01484e384.jpg",Ql=a.p+"Character_Yoimiya_Card.cd7bc5df84521f72.png",es=a.p+"Character_Yun_Jin_Card.f980c03bc03f7f1d.jpg",ts=a.p+"Character_Zhongli_Card.34830d011897679b.png",as={Albedo:Kr,Alhaitham:Or,Aloy:Pr,Amber:Er,AratakiItto:Mr,Baizhu:Dr,Barbara:Ar,Beidou:Ir,Bennett:Rr,Candace:Lr,Charlotte:zr,Chevreuse:Gr,Chongyun:$r,Collei:Nr,Cyno:Wr,Dehya:Fr,Diluc:Vr,Diona:qr,Dori:Hr,Eula:Ur,Faruzan:Yr,Fischl:Jr,Freminet:Qr,Furina:el,Gaming:tl,Ganyu:al,Gorou:nl,HuTao:il,Jean:rl,KaedeharaKazuha:dl,Kaeya:ll,KamisatoAyaka:ol,KamisatoAyato:cl,Kaveh:sl,Keqing:ul,Kirara:hl,Klee:Zl,KujouSara:pl,KukiShinobu:ml,Layla:fl,Lisa:gl,Lyney:xl,Lynette:bl,Mika:yl,Mona:vl,Nahida:Cl,Navia:wl,Neuvillette:kl,Nilou:Sl,Ningguang:Bl,Noelle:Xl,Qiqi:_l,RaidenShogun:Tl,Razor:jl,Rosaria:Kl,SangonomiyaKokomi:Ol,Sayu:Pl,Shenhe:El,ShikanoinHeizou:Ml,Somnia:Dl,Sucrose:Al,Tartaglia:Il,Thoma:Rl,Tighnari:Ll,TravelerF:a.p+"Traveler_Female_Card.fa3a506cfdb64634.jpg",TravelerM:a.p+"Traveler_Male_Card.68e79e7eeb25b514.jpg",Venti:zl,Wanderer:Gl,Wriothesley:$l,Xiangling:Nl,Xianyun:ql,Xiao:Wl,Xingqiu:Fl,Xinyan:Vl,YaeMiko:Hl,Yanfei:Ul,Yaoyao:Yl,Yelan:Jl,Yoimiya:Ql,YunJin:es,Zhongli:ts};var ns=a(10483),is=a(16068),rs=a(66147),ls=a(21194),ss=a(36674),os=a(15132),cs=a(85469),ds=a(49810),us=a(86432),hs=a(71179),Zs=a(96580),ps=a(73501),ms=a(66146),fs=a(29687);let gs,xs=e=>e;function bs({artId:e,weaponId:t}){const{t:a}=(0,b.$G)("page_character"),[i,r,l]=(0,n.aV)(!1);return(0,D.BX)(D.HY,{children:[(0,D.tZ)(Be.Z,{open:i,onClose:l,containerProps:{maxWidth:"xl"},children:(0,D.tZ)(ys,{artId:e,weaponId:t,onHide:l})}),(0,D.tZ)(be.Z,{title:(0,D.tZ)(pe.Z,{children:a(gs||(gs=xs`tabEquip.compare`))}),placement:"top",arrow:!0,children:(0,D.tZ)(g.Z,{color:"info",size:"small",onClick:r,children:(0,D.tZ)(fs.Z,{})})})]})}function ys({artId:e,weaponId:t,onHide:a}){const{database:n}=(0,x.useContext)(Q.t),{character:{key:i,equippedArtifacts:r}}=(0,x.useContext)(T.K),{buildSetting:{mainStatAssumptionLevel:l}}=Ra(i),{data:s}=(0,x.useContext)(j.R),o=(0,x.useMemo)((()=>{const t=n.arts.get(null!=e?e:""),a=(0,le.vU)(r,((e,a)=>a===(null==t?void 0:t.slotKey)?t:n.arts.get(e)));return Object.values(a).filter((e=>e))}),[n,r,e]),c=(0,ne.ZP)(i,l,o,t?n.weapons.get(t):void 0),d=(0,x.useMemo)((()=>c&&{data:c[i].target,teamData:c,oldData:s}),[i,c,s]);return(0,D.tZ)(x.Suspense,{fallback:(0,D.tZ)(Z.Z,{variant:"rectangular",width:"100%",height:600}),children:d&&(0,D.tZ)(j.R.Provider,{value:d,children:(0,D.tZ)(ui,{compareBuild:!0,extraButtonsLeft:(0,D.BX)(D.HY,{children:[(0,D.tZ)(V,{size:"small"}),(0,D.tZ)(F,{size:"small"})]}),extraButtonsRight:(0,D.tZ)(g.Z,{size:"small",color:"error",onClick:a,children:(0,D.tZ)(oa.Z,{})})})})})}let vs,Cs=e=>e;const ws={xs:6,sm:6,md:9,lg:12,xl:12},ks=(0,x.lazy)((()=>Promise.resolve().then(a.bind(a,22537))));function Ss({onChangeId:e,slotKey:t,show:a,onClose:i}){const{t:r}=(0,b.$G)("page_character"),{t:l}=(0,b.$G)("artifact"),{database:s}=(0,x.useContext)(Q.t),o=(0,x.useCallback)((t=>{e(t),i()}),[e,i]),c=(0,x.useCallback)(((e,a)=>Object.assign({},e,a,{slotKeys:[t]})),[t]),[d,u]=(0,x.useReducer)(c,Object.assign({},(0,Ui.Af)(),{slotKeys:[t]})),[m,f]=(0,n.NW)();(0,x.useEffect)((()=>s.arts.followAny(f)),[s,f]);const g=(0,n.JT)(),y=ws[g],[v,w]=(0,x.useState)(0),S=(0,x.useRef)(null),B=(0,x.useMemo)((()=>(0,Ui.EM)()),[]),X=s.arts.values.filter((e=>e.slotKey===d.slotKeys[0])).length,_=(0,x.useMemo)((()=>{const e=(0,le.CZ)(d,B);return m&&s.arts.values.filter(e).map((e=>e.id))}),[m,s,B,d]),{artifactIdsToShow:T,numPages:j,currentPageIndex:K}=(0,x.useMemo)((()=>{const e=Math.ceil(_.length/y),t=(0,le.re)(v,0,e-1);return{artifactIdsToShow:_.slice(t*y,(t+1)*y),numPages:e,currentPageIndex:t}}),[_,v,y]),O=_.length!==X?`${_.length}/${X}`:`${X}`,P={count:j,page:K+1,onChange:(0,x.useCallback)(((e,t)=>{var a;null==(a=S.current)||a.scrollIntoView({behavior:"smooth"}),w(t-1)}),[w,S])},E={numShowing:T.length,total:O,t:l};return(0,D.tZ)(Be.Z,{open:a,onClose:i,containerProps:{maxWidth:"xl"},children:(0,D.BX)(C.Z,{children:[(0,D.BX)(p.Z,{sx:{py:1,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,D.BX)(pe.Z,{variant:"h6",children:[t?(0,D.tZ)(Ke.Z,{src:Oe.CL.slot[t]}):null," ",r(vs||(vs=Cs`tabEquip.swapArt`))]}),(0,D.tZ)(k.Z,{onClick:i})]}),(0,D.tZ)(je.Z,{}),(0,D.tZ)(p.Z,{children:(0,D.tZ)(x.Suspense,{fallback:(0,D.tZ)(Z.Z,{variant:"rectangular",width:"100%",height:200}),children:(0,D.tZ)(ks,{filterOption:d,filterOptionDispatch:u,filteredIds:_,disableSlotFilter:!0})})}),(0,D.tZ)(je.Z,{}),(0,D.BX)(p.Z,{children:[(0,D.tZ)(h.Z,{pb:1,display:"flex",justifyContent:"space-between",alignItems:"flex-end",flexWrap:"wrap",children:(0,D.tZ)(ms.Z,{paginationProps:P,showingTextProps:E})}),(0,D.tZ)(h.Z,{mt:1,children:(0,D.tZ)(x.Suspense,{fallback:(0,D.tZ)(Z.Z,{variant:"rectangular",width:"100%",height:300}),children:(0,D.tZ)(Ce.ZP,{container:!0,spacing:1,columns:{xs:2,md:3,lg:4},children:T.map((e=>(0,D.tZ)(Ce.ZP,{item:!0,xs:1,children:(0,D.tZ)(ii.Z,{artifactId:e,extraButtons:(0,D.tZ)(bs,{artId:e}),onClick:o})},e)))})})}),j>1&&(0,D.tZ)(p.Z,{children:(0,D.tZ)(h.Z,{display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",children:(0,D.tZ)(ms.Z,{paginationProps:P,showingTextProps:E})})})]})]})})}var Bs=a(92252),Xs=a(18571),_s=a(64262),Ts=a(54578),js=a(7794);let Ks,Os=e=>e;const Ps=(0,sr.X)([...i.U1]);function Es({onChangeId:e,weaponTypeKey:t,show:a,onClose:r}){const{t:l}=(0,b.$G)(["page_character","page_weapon","weaponNames_gen"]),{database:s}=(0,x.useContext)(Q.t),[o,c]=(0,x.useState)(!1),d=(0,x.useCallback)((t=>{e(t),r()}),[e,r]),[u,Z]=(0,x.useState)(""),m=(0,x.useCallback)((e=>{Z(s.weapons.new((0,js.xg)(e)))}),[s,Z]),f=(0,x.useCallback)((()=>Z("")),[]),[y,v]=(0,n.NW)();(0,x.useEffect)((()=>s.weapons.followAny(v)),[v,s]);const[w,S]=(0,x.useState)([5,4,3]),[B,X]=(0,x.useState)(""),T=(0,x.useDeferredValue)(B),j=(0,x.useMemo)((()=>{var e,a;return null!=(e=y&&s.weapons.values.filter((0,le.CZ)({weaponType:t,rarity:w,name:T},(0,Ts.Xg)())).sort((0,le.ef)(null!=(a=Ts.gd.level)?a:[],!1,(0,Ts.Sn)())).map((e=>e.id)))?e:[]}),[y,s,w,t,T]);return(0,D.tZ)(Be.Z,{open:a,onClose:r,children:(0,D.BX)(C.Z,{children:[(0,D.tZ)(x.Suspense,{fallback:!1,children:(0,D.tZ)(Xs.default,{show:o,onHide:()=>c(!1),onSelect:m,weaponTypeFilter:t})}),(0,D.tZ)(x.Suspense,{fallback:!1,children:(0,D.tZ)(_s.default,{weaponId:u,footer:!0,onClose:f})}),(0,D.tZ)(p.Z,{sx:{py:1},children:(0,D.BX)(Ce.ZP,{container:!0,children:[(0,D.tZ)(Ce.ZP,{item:!0,flexGrow:1,children:(0,D.BX)(pe.Z,{variant:"h6",children:[t?(0,D.tZ)(Ke.Z,{src:Oe.CL.weaponTypes[t]}):null," ",l(Ks||(Ks=Os`page_character:tabEquip.swapWeapon`))]})}),(0,D.tZ)(Ce.ZP,{item:!0,children:(0,D.tZ)(k.Z,{onClick:r})})]})}),(0,D.tZ)(je.Z,{}),(0,D.BX)(p.Z,{sx:{display:"flex",flexDirection:"column",gap:1},children:[(0,D.BX)(Ce.ZP,{container:!0,spacing:1,children:[(0,D.tZ)(Ce.ZP,{item:!0,children:(0,D.tZ)(z.Z,{sx:{height:"100%"},value:w,size:"small",children:i.U1.map((e=>(0,D.tZ)(_.Z,{value:e,onClick:()=>S(Ps(w,e)),children:(0,D.BX)(h.Z,{display:"flex",children:[(0,D.tZ)("strong",{children:e}),(0,D.tZ)(Ua.Z,{})]})},e)))})}),(0,D.tZ)(Ce.ZP,{item:!0,flexGrow:1,children:(0,D.tZ)(ve.Z,{autoFocus:!0,size:"small",value:B,onChange:e=>X(e.target.value),label:l("page_weapon:weaponName"),sx:{height:"100%"},InputProps:{sx:{height:"100%"}}})})]}),(0,D.tZ)(g.Z,{fullWidth:!0,onClick:()=>c(!0),color:"info",startIcon:(0,D.tZ)(Bs.Z,{}),children:l("page_weapon:addWeapon")}),(0,D.tZ)(Ce.ZP,{container:!0,spacing:1,children:j.map((e=>(0,D.tZ)(Ce.ZP,{item:!0,xs:6,sm:6,md:4,lg:3,children:(0,D.tZ)(ps.Z,{weaponId:e,onClick:d,extraButtons:(0,D.tZ)(bs,{weaponId:e})})},e)))})]})]})})}let Ms,Ds,As,Is,Rs,Ls,zs,Gs=e=>e;const $s=(0,x.lazy)((()=>Promise.resolve().then(a.bind(a,64262))));function Ns(){var e;const{character:{equippedWeapon:t,key:a},characterSheet:n}=(0,x.useContext)(T.K),{teamData:r,data:l}=(0,x.useContext)(j.R),s=null==(e=r[a])?void 0:e.weaponSheet,[o,c]=(0,x.useState)(""),d=(0,x.useCallback)((()=>c(t)),[t]),u=(0,x.useCallback)((()=>c("")),[]);(0,x.useEffect)((()=>{o&&o!==t&&c(t)}),[o,t]);const Z=(0,Ln.Z)(),p=(0,us.Z)(Z.breakpoints.up("lg")),m=(0,x.useMemo)((()=>s&&s.document.length>0&&(0,D.tZ)(w.Z,{children:(0,D.tZ)(h.Z,{p:1,children:(0,D.tZ)(Ya.Z,{sections:s.document})})})),[s]),{rvFilter:f}=(0,os.Z)(a),g=(0,x.useDeferredValue)(f),b=(0,x.useMemo)((()=>new Set(g)),[g]);return(0,D.BX)(h.Z,{children:[(0,D.tZ)(x.Suspense,{fallback:!1,children:(0,D.tZ)($s,{weaponId:o,footer:!0,onClose:u,extraButtons:(0,D.tZ)(Vs,{weaponTypeKey:n.weaponTypeKey})})}),(0,D.BX)(Ce.ZP,{container:!0,spacing:1,children:[p&&(0,D.BX)(Ce.ZP,{item:!0,xs:12,md:12,lg:3,xl:3,sx:{display:"flex",flexDirection:"column",gap:1},children:[m&&m,(0,D.tZ)(Hs,{})]}),(0,D.BX)(Ce.ZP,{item:!0,xs:12,md:12,lg:9,xl:9,container:!0,spacing:1,children:[(0,D.tZ)(Ce.ZP,{item:!0,xs:12,sm:6,md:4,display:"flex",flexDirection:"column",gap:1,children:(0,D.tZ)(ps.Z,{weaponId:t,onEdit:d,canEquip:!0,extraButtons:(0,D.tZ)(Fs,{weaponTypeKey:n.weaponTypeKey})})}),i.Ex.map((e=>{var t;return(0,D.tZ)(Ce.ZP,{item:!0,xs:12,sm:6,md:4,children:l.get(K.ri.art[e].id).value?(0,D.tZ)(ii.Z,{artifactId:null==(t=l.get(K.ri.art[e].id).value)?void 0:t.toString(),effFilter:b,extraButtons:(0,D.tZ)(qs,{slotKey:e}),editorProps:{},canEquip:!0}):(0,D.tZ)(Ws,{slotKey:e})},e)}))]}),!p&&(0,D.BX)(Ce.ZP,{item:!0,xs:12,md:12,xl:3,container:!0,spacing:1,children:[m&&(0,D.tZ)(Ce.ZP,{item:!0,xs:12,md:6,lg:4,children:m}),(0,D.tZ)(Ce.ZP,{item:!0,xs:12,md:6,lg:4,sx:{display:"flex",flexDirection:"column",gap:1},children:(0,D.tZ)(Hs,{})})]})]})]})}function Ws({slotKey:e}){const{character:{key:t}}=(0,x.useContext)(T.K),{database:a}=(0,x.useContext)(Q.t),[r,l,s]=(0,n.aV)(),{t:o}=(0,b.$G)("artifact");return(0,D.BX)(w.Z,{sx:{height:"100%",width:"100%",minHeight:300,display:"flex",flexDirection:"column"},children:[(0,D.tZ)(p.Z,{children:(0,D.BX)(pe.Z,{children:[(0,D.tZ)(Pa.Z,{iconProps:S.mX,slotKey:e})," ",o(`slotName.${e}`)]})}),(0,D.tZ)(je.Z,{}),(0,D.BX)(h.Z,{sx:{flexGrow:1,display:"flex",justifyContent:"center",alignItems:"center"},children:[(0,D.tZ)(Ss,{slotKey:e,show:r,onClose:s,onChangeId:e=>a.arts.set(e,{location:(0,i.V7)(t)})}),(0,D.tZ)(g.Z,{onClick:l,color:"info",sx:{borderRadius:"1em"},children:(0,D.tZ)(cs.Z,{sx:{height:100,width:100}})})]})]})}function Fs({weaponTypeKey:e}){const{t}=(0,b.$G)("page_character"),{character:{key:a}}=(0,x.useContext)(T.K),{database:r}=(0,x.useContext)(Q.t),[l,s,o]=(0,n.aV)();return(0,D.BX)(D.HY,{children:[(0,D.tZ)(be.Z,{title:(0,D.tZ)(pe.Z,{children:t(Ms||(Ms=Gs`tabEquip.swapWeapon`))}),placement:"top",arrow:!0,children:(0,D.tZ)(g.Z,{color:"info",size:"small",onClick:s,children:(0,D.tZ)(cs.Z,{})})}),(0,D.tZ)(Es,{weaponTypeKey:e,onChangeId:e=>r.weapons.set(e,{location:(0,i.V7)(a)}),show:l,onClose:o})]})}function Vs({weaponTypeKey:e}){const{t}=(0,b.$G)("page_character"),{character:{key:a}}=(0,x.useContext)(T.K),{database:r}=(0,x.useContext)(Q.t),[l,s,o]=(0,n.aV)();return(0,D.BX)(D.HY,{children:[(0,D.tZ)(g.Z,{color:"info",onClick:s,startIcon:(0,D.tZ)(cs.Z,{}),children:t(Ds||(Ds=Gs`tabEquip.swapWeapon`))}),(0,D.tZ)(Es,{weaponTypeKey:e,onChangeId:e=>r.weapons.set(e,{location:(0,i.V7)(a)}),show:l,onClose:o})]})}function qs({slotKey:e}){const{t}=(0,b.$G)("page_character"),{character:{key:a}}=(0,x.useContext)(T.K),{database:r}=(0,x.useContext)(Q.t),[l,s,o]=(0,n.aV)();return(0,D.BX)(D.HY,{children:[(0,D.tZ)(be.Z,{title:(0,D.tZ)(pe.Z,{children:t(As||(As=Gs`tabEquip.swapArt`))}),placement:"top",arrow:!0,children:(0,D.tZ)(g.Z,{color:"info",size:"small",onClick:s,children:(0,D.tZ)(cs.Z,{})})}),(0,D.tZ)(Ss,{slotKey:e,show:l,onClose:o,onChangeId:e=>r.arts.set(e,{location:(0,i.V7)(a)})})]})}function Hs(){const{t:e}=(0,b.$G)(["page_character","artifact"]),{database:t}=(0,x.useContext)(Q.t),{character:a,character:{key:r,equippedArtifacts:l}}=(0,x.useContext)(T.K),{data:s}=(0,x.useContext)(j.R),o=(0,x.useMemo)((()=>!!Object.values(l).filter((e=>e)).length),[l]),c=(0,x.useCallback)((()=>{a&&window.confirm("Do you want to move all currently equipped artifacts to inventory?")&&Object.values(l).forEach((e=>t.arts.set(e,{location:""})))}),[a,t,l]),d=(0,x.useMemo)((()=>(0,Pe.ND)(s)),[s]),{rvFilter:u}=(0,os.Z)(r),Z=(0,x.useCallback)((e=>t.charMeta.set(r,{rvFilter:e})),[t,r]),[m,f,y]=(0,n.aV)(),v=(0,x.useDeferredValue)(u),{rvField:k,rvmField:S}=(0,x.useMemo)((()=>{const{currentEfficiency:a,currentEfficiency_:n,maxEfficiency:r,maxEfficiency_:s}=Object.values(l).reduce(((e,a)=>{const n=t.arts.get(a);if(n){const{currentEfficiency:t,maxEfficiency:a}=Gn.Z.getArtifactEfficiency(n,new Set(v)),{currentEfficiency:r,maxEfficiency:l}=Gn.Z.getArtifactEfficiency(n,new Set(i._m));e.currentEfficiency=e.currentEfficiency+t,e.maxEfficiency=e.maxEfficiency+a,e.currentEfficiency_=e.currentEfficiency_+r,e.maxEfficiency_=e.maxEfficiency_+l}return e}),{currentEfficiency:0,currentEfficiency_:0,maxEfficiency:0,maxEfficiency_:0});return{rvField:{text:e(Is||(Is=Gs`artifact:editor.curSubEff`)),value:a-n?(0,D.BX)("span",{children:[(0,D.tZ)(Zs.Z,{value:a,max:4500,valid:!0})," /"," ",(0,D.tZ)(Zs.Z,{value:n,max:4500,valid:!0})]}):(0,D.tZ)(Zs.Z,{value:a,max:4500,valid:!0})},rvmField:{text:e(Rs||(Rs=Gs`artifact:editor.maxSubEff`)),canShow:()=>!!(n-s),value:r-s?(0,D.BX)("span",{children:[(0,D.tZ)(Zs.Z,{value:r,max:4500,valid:!0})," /"," ",(0,D.tZ)(Zs.Z,{value:s,max:4500,valid:!0})]}):(0,D.tZ)(Zs.Z,{value:r,max:4500,valid:!0})}}}),[e,v,l,t]);return(0,D.BX)(w.Z,{children:[o&&(0,D.tZ)(g.Z,{color:"error",onClick:c,fullWidth:!0,sx:{borderBottomRightRadius:0,borderBottomLeftRadius:0},children:e(Ls||(Ls=Gs`tabEquip.unequipArts`))}),(0,D.tZ)(h.Z,{p:1,children:(0,D.BX)(Te.Z,{spacing:1,children:[(0,D.BX)(C.Z,{children:[(0,D.tZ)(g.Z,{fullWidth:!0,color:"info",startIcon:(0,D.tZ)(ds.Z,{}),sx:{borderBottomLeftRadius:0,borderBottomRightRadius:0},onClick:f,children:"RV Filter"}),(0,D.tZ)(Be.Z,{open:m,onClose:y,children:(0,D.tZ)(C.Z,{children:(0,D.BX)(p.Z,{children:[(0,D.tZ)(pe.Z,{textAlign:"center",gutterBottom:!0,variant:"h6",children:e(zs||(zs=Gs`artifact:efficiencyFilter.title`))}),(0,D.tZ)(hs.Z,{selectedKeys:u,onChange:Z})]})})}),(0,D.BX)($e.lD,{children:[(0,D.tZ)($e.ms,{field:k,component:Xt.ZP}),(null==S||null==S.canShow?void 0:S.canShow(s))&&(0,D.tZ)($e.ms,{field:S,component:Xt.ZP})]})]}),d&&Object.entries(d).flatMap((([e,t])=>t.map((t=>(0,D.tZ)(Ja,{setKey:e,setNumKey:t},e+t)))))]})})]})}function Us(){const e=(0,x.useRef)(),t=(0,x.useCallback)((()=>{var t;return null==e||null==(t=e.current)||null==t.scrollIntoView?void 0:t.scrollIntoView({behavior:"smooth"})}),[e]);return(0,D.BX)(Te.Z,{spacing:1,children:[(0,D.tZ)(h.Z,{children:(0,D.BX)(Ce.ZP,{container:!0,spacing:1,sx:{justifyContent:"center"},children:[(0,D.tZ)(Ce.ZP,{item:!0,xs:8,sm:5,md:4,lg:2.3,children:(0,D.tZ)(Js,{})}),(0,D.BX)(Ce.ZP,{item:!0,xs:12,sm:7,md:8,lg:9.7,sx:{display:"flex",flexDirection:"column",gap:1},children:[(0,D.tZ)(Ys,{onClick:t}),(0,D.tZ)(w.Z,{sx:{flexGrow:1,p:1},children:(0,D.tZ)(Yn,{})})]})]})}),(0,D.tZ)(h.Z,{ref:e,children:(0,D.tZ)(Ns,{})})]})}function Ys({onClick:e}){const{character:{equippedWeapon:t}}=(0,x.useContext)(T.K),{data:a}=(0,x.useContext)(j.R);return(0,D.BX)(Ce.ZP,{container:!0,spacing:1,columns:{xs:2,sm:2,md:3,lg:6,xl:6},children:[(0,D.tZ)(Ce.ZP,{item:!0,xs:1,children:(0,D.tZ)(ai,{weaponId:t,BGComponent:w.Z,onClick:e})}),i.Ex.map((t=>{var n;return(0,D.tZ)(Ce.ZP,{item:!0,xs:1,children:(0,D.tZ)(Hn,{artifactId:null==(n=a.get(K.ri.art[t].id).value)?void 0:n.toString(),slotKey:t,BGComponent:w.Z,onClick:e})},t)}))]})}function Js(){const{silly:e}=(0,x.useContext)(Y.E),{characterSheet:t,character:{key:a,team:n}}=(0,x.useContext)(T.K),{gender:i}=(0,ae.Z)(),{data:r}=(0,x.useContext)(j.R),l=(0,te.Z)(a),s=(0,y.s0)(),o=r.get(K.ri.lvl).value,c=r.get(K.ri.asc).value,d=r.get(K.ri.constellation).value,u={auto:r.get(K.ri.total.auto).value,skill:r.get(K.ri.total.skill).value,burst:r.get(K.ri.total.burst).value},Z={auto:r.get(K.ri.total.autoBoost).value,skill:r.get(K.ri.total.skillBoost).value,burst:r.get(K.ri.total.burstBoost).value},p=(0,ns.V)(a,i),m=function(e,t){var a,n;switch(e){case"TravelerAnemo":case"TravelerDendro":case"TravelerElectro":case"TravelerGeo":case"TravelerHydro":return null!=(a=as[`Traveler${t}`])?a:"";default:return null!=(n=as[e])?n:""}}(a,i);return(0,D.BX)(w.Z,{sx:{height:"100%"},children:[e&&p?(0,D.tZ)(Qs,{src:p,level:o,ascension:c}):(0,D.tZ)(eo,{src:m,level:o,ascension:c}),(0,D.BX)(h.Z,{children:[(0,D.tZ)(Rn.Z,{sx:{p:1},onClick:()=>s("talent"),children:(0,D.tZ)(Ce.ZP,{container:!0,spacing:1,mt:-1,children:["auto","skill","burst"].map((e=>{var a;return(0,D.tZ)(Ce.ZP,{item:!0,xs:4,children:(0,D.tZ)(ls.Z,{badgeContent:u[e],color:Z[e]?"info":"secondary",overlap:"circular",anchorOrigin:{vertical:"bottom",horizontal:"right"},sx:{width:"100%",height:"100%","& > .MuiBadge-badge":{fontSize:"1.25em",padding:".25em .4em",borderRadius:".5em",lineHeight:1,height:"1.25em"}},children:(0,D.tZ)(h.Z,{component:"img",src:null==(a=t.getTalentOfKey(e))?void 0:a.img,width:"100%",height:"auto"})})},e)}))})}),(0,D.tZ)(pe.Z,{sx:{textAlign:"center",mt:1},variant:"h6",children:t.constellationName}),(0,D.tZ)(Ce.ZP,{container:!0,spacing:1,children:(0,re.w6)(1,6).map((e=>{var a;return(0,D.tZ)(Ce.ZP,{item:!0,xs:4,children:(0,D.tZ)(Rn.Z,{onClick:()=>l({constellation:e===d?e-1:e}),children:(0,D.tZ)(h.Z,{component:"img",src:null==(a=t.getTalentOfKey(`constellation${e}`))?void 0:a.img,sx:Object.assign({},d>=e?{}:{filter:"brightness(50%)"}),width:"100%",height:"auto"})})},e)}))}),(0,D.tZ)(Rn.Z,{sx:{p:1},onClick:()=>s("teambuffs"),children:(0,D.tZ)(Ce.ZP,{container:!0,columns:3,spacing:1,children:(0,re.w6)(0,2).map((e=>(0,D.tZ)(Ce.ZP,{item:!0,xs:1,height:"100%",children:n[e]?(0,D.tZ)(Ea.Z,{characterKey:n[e]}):(0,D.tZ)(Ea.D,{index:e})},e)))})})]})]})}function Qs({src:e,level:t,ascension:a}){const{characterSheet:n}=(0,x.useContext)(T.K);return(0,D.BX)(h.Z,{sx:{position:"relative"},children:[(0,D.tZ)(h.Z,{src:e,component:"img",width:"100%",height:"auto"}),(0,D.BX)(h.Z,{sx:{width:"100%",height:"100%"},children:[(0,D.tZ)(h.Z,{sx:{opacity:.85,width:"100%",display:"flex",justifyContent:"center",px:1},children:(0,D.tZ)(to,{})}),(0,D.tZ)(pe.Z,{variant:"h6",sx:{width:"100%",opacity:.75,textAlign:"center"},children:(0,D.tZ)(ss.q,{stars:n.rarity,colored:!0})}),(0,D.tZ)(no,{}),(0,D.tZ)(ao,{level:t,ascension:a})]})]})}function eo({src:e,level:t,ascension:a}){const{characterSheet:n}=(0,x.useContext)(T.K);return(0,D.BX)(h.Z,{sx:{position:"relative"},children:[(0,D.BX)(h.Z,{sx:{position:"absolute",width:"100%",height:"100%"},children:[(0,D.tZ)(pe.Z,{variant:"h6",sx:{position:"absolute",width:"100%",left:"50%",bottom:0,transform:"translate(-50%, -50%)",opacity:.75,textAlign:"center"},children:(0,D.tZ)(ss.q,{stars:n.rarity,colored:!0})}),(0,D.tZ)(h.Z,{sx:{position:"absolute",left:"50%",bottom:"7%",transform:"translate(-50%, -50%)",opacity:.85,width:"100%",display:"flex",justifyContent:"center",px:1},children:(0,D.tZ)(to,{})}),(0,D.tZ)(no,{}),(0,D.tZ)(ao,{level:t,ascension:a})]}),(0,D.tZ)(h.Z,{src:e,component:"img",width:"100%",height:"auto"})]})}function to(){var e;const{characterSheet:t}=(0,x.useContext)(T.K),a=t.elementKey;return(0,D.tZ)(ge.Z,{color:a,sx:{height:"auto"},label:(0,D.BX)(pe.Z,{variant:"h6",sx:{display:"flex",gap:1,alignItems:"center"},children:[(0,D.tZ)(P.Z,{ele:a}),(0,D.tZ)(h.Z,{sx:{whiteSpace:"normal",textAlign:"center"},children:t.name}),(0,D.tZ)(Ke.Z,{src:null==(e=Oe.CL.weaponTypes)?void 0:e[t.weaponTypeKey]})]})})}function ao({level:e,ascension:t}){return(0,D.tZ)(pe.Z,{sx:{p:1,position:"absolute",right:0,top:0,opacity:.8},children:(0,D.tZ)(M.Z,{children:(0,An.wQ)(e,t)})})}function no(){const{character:{key:e}}=(0,x.useContext)(T.K),{database:t}=(0,x.useContext)(Q.t),{favorite:a}=(0,os.Z)(e);return(0,D.tZ)(h.Z,{sx:{position:"absolute",left:0,top:0},children:(0,D.tZ)(Et.Z,{sx:{p:1},color:"error",onClick:()=>t.charMeta.set(e,{favorite:!a}),children:a?(0,D.tZ)(is.Z,{}):(0,D.tZ)(rs.Z,{})})})}const io={xs:12,sm:6,md:4};function ro(){const{t:e}=(0,b.$G)("sheet_gen"),{character:t,characterSheet:a}=(0,x.useContext)(T.K),{data:n}=(0,x.useContext)(j.R),r=(0,te.Z)(t.key),l=[["auto",e("talents.auto")],["skill",e("talents.skill")],["burst",e("talents.burst")]],s=[["passive1",e("unlockPassive1"),1],["passive2",e("unlockPassive2"),4],["passive3",e("unlockPassive3"),0]],o=n.get(K.ri.asc).value,c=n.get(K.ri.constellation).value,d=(0,Ln.Z)(),u=(0,us.Z)(d.breakpoints.up("lg")),Z=(0,x.useMemo)((()=>(0,re.w6)(1,i.o9).map((t=>(0,D.tZ)(so,{talentKey:`constellation${t}`,subtitle:e("constellationLvl",{level:t}),onClickTitle:()=>r({constellation:t===c?t-1:t})})))),[e,c,r]),p=(0,D.tZ)(L.Z,{fullWidth:!0,title:e("constellationLvl",{level:c}),color:"primary",sx:{borderRadius:0},children:(0,re.w6)(0,i.o9).map((t=>(0,D.tZ)(X.Z,{selected:c===t,disabled:c===t,onClick:()=>r({constellation:t}),children:e("constellationLvl",{level:t})},t)))});return(0,D.BX)(D.HY,{children:[(0,D.tZ)(lo,{}),(0,D.BX)(Ce.ZP,{container:!0,spacing:1,children:[u&&(0,D.BX)(Ce.ZP,{item:!0,xs:12,md:12,lg:3,sx:{display:"flex",flexDirection:"column",gap:1},children:[(0,D.tZ)(w.Z,{children:p}),Z.map(((e,t)=>(0,D.tZ)(h.Z,{sx:{opacity:c>=t+1?1:.5},children:e},t)))]}),(0,D.BX)(Ce.ZP,{item:!0,xs:12,md:12,lg:9,container:!0,spacing:1,children:[l.map((([e,t])=>(0,D.tZ)(Ce.ZP,Object.assign({item:!0},io,{children:(0,D.tZ)(so,{talentKey:e,subtitle:t})}),e))),!!a.getTalentOfKey("sprint")&&(0,D.tZ)(Ce.ZP,Object.assign({item:!0},io,{children:(0,D.tZ)(so,{talentKey:"sprint",subtitle:e("talents.altSprint")})})),!!a.getTalentOfKey("passive")&&(0,D.tZ)(Ce.ZP,Object.assign({item:!0},io,{children:(0,D.tZ)(so,{talentKey:"passive",subtitle:"Passive"})})),s.map((([e,t,n])=>{const i=o>=n;return a.getTalentOfKey(e)?(0,D.tZ)(Ce.ZP,Object.assign({item:!0,style:{opacity:i?1:.5}},io,{children:(0,D.tZ)(so,{talentKey:e,subtitle:t})}),e):null}))]}),!u&&(0,D.BX)(Ce.ZP,{item:!0,xs:12,md:12,lg:3,container:!0,spacing:1,children:[(0,D.tZ)(Ce.ZP,{item:!0,xs:12,children:(0,D.tZ)(w.Z,{children:p})}),Z.map(((e,t)=>(0,D.tZ)(Ce.ZP,Object.assign({item:!0,sx:{opacity:c>=t+1?1:.5}},io,{children:e}),t)))]})]})]})}function lo(){const{data:e}=(0,x.useContext)(j.R),t=e.getDisplay().reaction;return(0,D.tZ)(w.Z,{children:(0,D.tZ)(p.Z,{children:(0,D.tZ)(Ce.ZP,{container:!0,spacing:1,children:Object.entries(t).filter((([e,t])=>!t.isEmpty)).map((([e,t])=>(0,D.tZ)(Ce.ZP,{item:!0,children:(0,D.tZ)(C.Z,{children:(0,D.tZ)(p.Z,{sx:{p:1,"&:last-child":{pb:1}},children:(0,D.tZ)($e.JW,{node:t})})})},e)))})})})}function so({talentKey:e,subtitle:t,onClickTitle:a}){const{t:n}=(0,b.$G)("sheet_gen"),{character:{talent:r},characterSheet:l,characterDispatch:s}=(0,x.useContext)(T.K),{data:o}=(0,x.useContext)(j.R),c=(0,x.useCallback)((e=>(0,D.tZ)(Rn.Z,{onClick:a,children:e})),[a]),d=(0,x.useCallback)(((e,t)=>s({talent:Object.assign({},r,{[e]:t})})),[r,s]);let u=null;if(e in r){const t=o.get(K.ri.total[`${e}Boost`]).value,a=o.get(K.ri.total[e]).value,l=o.get(K.ri.asc).value;u=(0,D.tZ)(L.Z,{fullWidth:!0,title:n("talentLvl",{level:a}),color:t?"info":"primary",sx:{borderRadius:0},children:(0,re.w6)(1,i.zK[l]).map((a=>(0,D.tZ)(X.Z,{selected:r[e]===a,disabled:r[e]===a,onClick:()=>d(e,a),children:n("talentLvl",{level:a+t})},a)))})}const Z=l.getTalentOfKey(e);return(0,D.BX)(w.Z,{sx:{height:"100%"},children:[u,(0,D.BX)(p.Z,{children:[(0,D.tZ)(Wn.Z,{condition:!!a,wrapper:c,children:(0,D.BX)(Ce.ZP,{container:!0,sx:{flexWrap:"nowrap"},children:[(0,D.tZ)(Ce.ZP,{item:!0,children:(0,D.tZ)(h.Z,{component:"img",src:null==Z?void 0:Z.img,sx:{width:60,height:"auto"}})}),(0,D.BX)(Ce.ZP,{item:!0,flexGrow:1,sx:{pl:1},children:[(0,D.tZ)(pe.Z,{variant:"h6",children:null==Z?void 0:Z.name}),(0,D.tZ)(pe.Z,{variant:"subtitle1",children:t})]})]})}),null!=Z&&Z.sections?(0,D.tZ)(Ya.Z,{sections:Z.sections,hideDesc:!0,hideHeader:t=>{var a;const n=null==(a=t.header)?void 0:a.action;if(n&&"string"!=typeof n){return n.props.children.props.key18.includes(e)}return!1}}):null]})]})}var oo=a(88819),co=a(75958),uo=a(58606);let ho,Zo=e=>e;function po(){return(0,D.tZ)(h.Z,{display:"flex",flexDirection:"column",gap:1,alignItems:"stretch",children:(0,D.BX)(Ce.ZP,{container:!0,spacing:1,children:[(0,D.BX)(Ce.ZP,{item:!0,xs:12,md:6,lg:3,sx:{display:"flex",flexDirection:"column",gap:1},children:[(0,D.tZ)(mo,{}),(0,D.tZ)(fo,{})]}),(0,re.w6)(0,2).map((e=>(0,D.tZ)(Ce.ZP,{item:!0,xs:12,md:6,lg:3,children:(0,D.tZ)(go,{index:e})},e)))]})})}function mo(){var e,t,a;const{data:n,oldData:i}=(0,x.useContext)(j.R),r=n.getTeamBuff(),l=[];return Object.entries(null!=(e=r.total)?e:{}).forEach((([e,t])=>!t.isEmpty&&0!==t.value&&l.push([["total",e],t]))),Object.entries(null!=(t=r.premod)?t:{}).forEach((([e,t])=>!t.isEmpty&&0!==t.value&&l.push([["premod",e],t]))),Object.entries(null!=(a=r.enemy)?a:{}).forEach((([e,t])=>!t.isEmpty&&"number"==typeof t.value&&0!==t.value&&l.push([["enemy",e],t]))),l.length?(0,D.BX)(w.Z,{children:[(0,D.tZ)(p.Z,{children:(0,D.tZ)(pe.Z,{children:"Team Buffs"})}),(0,D.tZ)(je.Z,{}),(0,D.tZ)(p.Z,{children:(0,D.tZ)(Ce.ZP,{container:!0,children:l.map((([e,t])=>{var a;return t&&(0,D.tZ)(Ce.ZP,{item:!0,xs:12,children:(0,D.tZ)($e.JW,{node:t,oldValue:null==(a=(0,re.Hm)(null==i?void 0:i.getTeamBuff(),e))?void 0:a.value})},JSON.stringify(t.info))}))})})]}):null}function fo(){const{t:e}=(0,b.$G)("page_character"),{data:t}=(0,x.useContext)(j.R),{character:{team:a}}=(0,x.useContext)(T.K),n=a.reduce(((e,t)=>e+(t?1:0)),1);return(0,D.BX)(D.HY,{children:[(0,D.tZ)(w.Z,{children:(0,D.tZ)(ze.Z,{title:(0,D.BX)("span",{children:[e("tabTeambuff.team_reso")," ",(0,D.tZ)("strong",{children:(0,D.BX)(E.Z,{color:n>=4?"success":"warning",children:["(",n,"/4)"]})})," ",(0,D.tZ)(Se.L,{title:(0,D.tZ)(pe.Z,{children:e(ho||(ho=Zo`tabTeambuff.resonance_tip`))})})]}),titleTypographyProps:{variant:"subtitle2"}})}),uo.J.map(((e,a)=>(0,D.BX)(w.Z,{sx:{opacity:e.canShow(t)?1:.5},children:[(0,D.tZ)(ze.Z,{title:(0,D.BX)("span",{children:[e.name," ",(0,D.tZ)(Se.L,{title:(0,D.tZ)(pe.Z,{children:e.desc})})]}),action:e.icon,titleTypographyProps:{variant:"subtitle2"}}),e.canShow(t)&&(0,D.tZ)(je.Z,{}),e.canShow(t)&&(0,D.tZ)(p.Z,{children:(0,D.tZ)(Ya.Z,{sections:e.sections,teamBuffOnly:!0,hideDesc:!0})})]},a)))]})}function go({index:e}){const{teamData:t}=(0,x.useContext)(j.R),{t:a}=(0,b.$G)("page_character"),{character:n,character:{key:i},characterDispatch:r}=(0,x.useContext)(T.K),l=n.team[e],s=(0,x.useMemo)((()=>[i,...n.team].filter(((t,a)=>a-1!==e))),[n.team,i,e]),o=(0,gt.Z)(),c=(0,x.useCallback)((t=>r({type:"team",index:e,charKey:t})),[e,r]),d=t[l],u=(0,x.useMemo)((()=>{var e;return d&&{character:Object.assign({},d.character,{conditional:null!=(e=n.teamConditional[l])?e:{}}),characterSheet:d.characterSheet,characterDispatch:e=>{if(!l)return;if(!("conditional"in e))return;const{conditional:t}=e;t&&r({type:"teamConditional",teamMateKey:l,conditional:t})}}}),[n,l,d,r]),h=(0,x.useMemo)((()=>d&&{data:d.target,teamData:t}),[d,t]);return(0,D.BX)(w.Z,{sx:{overflow:"visible"},children:[(0,D.tZ)(vo,{characterKey:l,team:s,setChar:c,label:a("teammate",{count:e+1})}),l&&u&&(0,D.tZ)(T.K.Provider,{value:u,children:h&&(0,D.tZ)(j.R.Provider,{value:h,children:(0,D.tZ)(pa.Z,{characterKey:l,onClickHeader:o,artifactChildren:(0,D.tZ)(T.K.Provider,{value:u,children:(0,D.tZ)(j.R.Provider,{value:h,children:(0,D.tZ)(xo,{})})}),weaponChildren:(0,D.tZ)(T.K.Provider,{value:u,children:(0,D.tZ)(j.R.Provider,{value:h,children:(0,D.tZ)(bo,{})})}),characterChildren:(0,D.tZ)(T.K.Provider,{value:u,children:(0,D.tZ)(j.R.Provider,{value:h,children:(0,D.tZ)(yo,{})})}),isTeammateCard:!0})})})]})}function xo(){const{data:e}=(0,x.useContext)(j.R),t=(0,x.useMemo)((()=>Object.entries((0,Pe.ND)(e)).flatMap((([e,t])=>t.flatMap((t=>{var a;return null!=(a=(0,Pe.Sk)(e).setEffectDocument(t))?a:[]}))))),[e]);return t?(0,D.tZ)(Ya.Z,{sections:t,teamBuffOnly:!0}):null}function bo(){const{character:{key:e}}=(0,x.useContext)(T.K),{teamData:t}=(0,x.useContext)(j.R),a=t[e].weaponSheet;return a.document?(0,D.tZ)(Ya.Z,{sections:a.document,teamBuffOnly:!0}):null}function yo(){const{character:{key:e}}=(0,x.useContext)(T.K),{teamData:t}=(0,x.useContext)(j.R),a=t[e].characterSheet,n=Object.values(a.talent).flatMap((e=>e.sections));return n?(0,D.tZ)(Ya.Z,{sections:n,teamBuffOnly:!0}):null}function vo({characterKey:e,team:t,label:a,setChar:n,autoCompleteProps:r={}}){const{t:l}=(0,b.$G)(["sillyWisher_charNames","page_character","sheet_gen","charNames_gen"]),{database:s}=(0,x.useContext)(Q.t),{gender:o}=(0,ae.Z)(),{silly:c}=(0,x.useContext)(Y.E),d=(0,x.useCallback)(((e,t)=>{var a;return e.startsWith("Traveler")?`${l(`${t?"sillyWisher_charNames":"charNames_gen"}:${(0,i.Cs)(e,o)}`)} (${l(`sheet_gen:element.${null==(a=(0,J.m)(e,o))?void 0:a.elementKey}`)})`:l(`${t?"sillyWisher_charNames":"charNames_gen"}:${e}`)}),[l,o]),u=(0,x.useCallback)((e=>e?(0,D.tZ)(ft.Z,{characterKey:e}):(0,D.tZ)(oo.Z,{})),[]),h=(0,x.useCallback)((e=>s.charMeta.get(e).favorite),[s]),p=(0,x.useCallback)((({key:a})=>t.filter((t=>t&&t!==e)).includes(a)||a.startsWith("Traveler")&&t.some((e=>e.startsWith("Traveler")))),[t,e]),m=(0,x.useMemo)((()=>s.chars.keys.map((e=>({key:e,label:d(e,c),favorite:h(e),alternateNames:[d(e,!1)]}))).sort(((e,t)=>e.favorite&&!t.favorite?-1:!e.favorite&&t.favorite?1:e.label.localeCompare(t.label)))),[s.chars.keys,d,h,c]);return(0,D.tZ)(x.Suspense,{fallback:(0,D.tZ)(Z.Z,{variant:"text",width:100}),children:(0,D.tZ)(co._,Object.assign({size:"small",label:a,options:m,valueKey:e,onChange:e=>n(null!=e?e:""),getOptionDisabled:p,toImg:u},r))})}var Co=a(98885),wo=a(71076),ko=a(97183),So=a(83517),Bo=a(92679),Xo=a(13091),_o=a(35936),To=a(6060),jo=a(15694),Ko=a(5971),Oo=a(6480);const Po=(0,x.createContext)({});function Eo({slotKey:e,disabled:t=!1}){var a;const{charTC:{artifact:{slots:n}},setCharTC:r}=(0,x.useContext)(Po),{level:l,statKey:s,rarity:o}=n[e],c=i.yh[e],d=(0,x.useCallback)((t=>{r((a=>{const n=a.artifact.slots[e];a.artifact.slots[e]=Object.assign({},n,t)}))}),[r,e]),u=(0,x.useCallback)((e=>{var t;const a=null!=(t=i.F7[e])?t:0;d(l>a?{rarity:e,level:a}:{rarity:e})}),[l,d]);return(0,D.BX)(h.Z,{display:"flex",gap:1,justifyContent:"space-between",alignItems:"center",children:[(0,D.tZ)(Pa.Z,{slotKey:e}),(0,D.tZ)(C.Z,{sx:{height:"100%",minWidth:"5em",flexGrow:1,display:"flex"},children:1===c.length?(0,D.BX)(h.Z,{p:1,justifyContent:"center",alignItems:"center",width:"100%",display:"flex",gap:1,children:[(0,D.tZ)(P.C,{statKey:c[0],iconProps:S.mX})," ",Ot.ZP.getStr(c[0])]}):(0,D.tZ)(L.Z,{sx:{px:0},fullWidth:!0,title:(0,D.tZ)(Fn,{statKey:s}),color:null!=(a=Ot.ZP.getVariant(s))?a:"success",disabled:t,children:c.map((e=>(0,D.tZ)(X.Z,{disabled:s===e,onClick:()=>d({statKey:e}),children:(0,D.tZ)(Vn,{statKey:e})},e)))})}),(0,D.tZ)(L.Z,{sx:{px:0},title:(0,D.BX)(h.Z,{sx:{display:"flex",alignItems:"center"},children:[o," ",(0,D.tZ)(Ua.Z,{fontSize:"inherit"})]}),disabled:t,children:[5,4,3].map((e=>(0,D.tZ)(X.Z,{disabled:o===e,onClick:()=>u(e),children:(0,D.BX)(h.Z,{sx:{display:"flex",alignItems:"center"},children:[e," ",(0,D.tZ)(Ua.Z,{fontSize:"inherit"})]})},e)))}),(0,D.tZ)(ke.ZP,{startAdornment:"+",value:l,color:Gn.Z.levelVariant(l),onChange:e=>void 0!==e&&d({level:e}),sx:{borderRadius:1,pl:1,my:0,height:"100%"},inputProps:{sx:{pl:.5,width:"2em"},max:20,min:0},disabled:t}),(0,D.tZ)(C.Z,{sx:{height:"100%",minWidth:"4em"},children:(0,D.tZ)(h.Z,{p:1,textAlign:"center",children:`${(0,An.Jj)((0,An.Bv)(s,o,l),Ot.ZP.unit(s))}${Ot.ZP.unit(s)}`})})]})}var Mo=a(47712),Do=a(54675),Ao=a(69208);function Io(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var a=e[Symbol.toPrimitive];if(void 0!==a){var n=a.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}function Ro({setKey:e,remaining:t,disabled:a=!1}){const{charTC:{artifact:{sets:n}},setCharTC:i}=(0,x.useContext)(Po),r=n[e],l=(0,x.useCallback)((t=>{i((a=>{a.artifact.sets[e]=t}))}),[i,e]),s=(0,x.useCallback)((()=>{i((t=>{const a=t.artifact.sets,n=(0,Pt.Z)(a,[e].map(Io));t.artifact.sets=n}))}),[i,e]),o=(0,Pe.Sk)(e),c=(0,x.useMemo)((()=>r<4?[]:Object.keys(o.setEffects).filter((e=>{var t;return null==(t=o.setEffects[e])?void 0:t.document.some((e=>"states"in e))}))),[o,r]);return(0,D.BX)(w.Z,{children:[(0,D.BX)(h.Z,{display:"flex",children:[(0,D.tZ)(ri.Z,{artifactSheet:o,numInSet:r,children:(0,D.BX)(h.Z,{flexGrow:1,p:1,display:"flex",gap:1,alignItems:"center",children:[(0,D.tZ)(Ke.Z,{size:2,src:(0,Ee.jU)(e)}),(0,D.tZ)(h.Z,{children:o.setName}),(0,D.tZ)(Ao.Z,Object.assign({},S.mX))]})}),(0,D.BX)(xe.Z,{children:[(0,D.tZ)(L.Z,{size:"small",title:(0,D.BX)(h.Z,{whiteSpace:"nowrap",children:[r,"-set"]}),disabled:a,children:Object.keys(o.setEffects).map((e=>parseInt(e))).map((e=>(0,D.BX)(X.Z,{disabled:r===e||e>t+r,onClick:()=>l(e),children:[e,"-set"]},e)))}),(0,D.tZ)(g.Z,{color:"error",size:"small",onClick:s,disabled:a,children:(0,D.tZ)(Do.Z,{})})]})]}),!!c.length&&(0,D.tZ)(Te.Z,{spacing:1,sx:{p:1},children:c.map((t=>(0,D.tZ)(Ja,{setKey:e,setNumKey:parseInt(t),hideHeader:!0,conditionalsOnly:!0,disabled:a},t)))})]})}function Lo({disabled:e=!1}){const{charTC:{artifact:{sets:t}},setCharTC:a}=(0,x.useContext)(Po),n=(0,x.useCallback)((e=>{e&&a((t=>{t.artifact.sets[e]=parseInt(Object.keys((0,Pe.Sk)(e).setEffects)[0])}))}),[a]),i=5-Object.values(t).reduce(((e,t)=>e+t),0);return(0,D.BX)(Te.Z,{spacing:1,sx:{flexGrow:1},children:[Object.keys(t).map((t=>(0,D.tZ)(Ro,{setKey:t,remaining:i,disabled:e},t))),(0,D.tZ)(w.Z,{sx:{flexGrow:1,overflow:"visible"},children:(0,D.tZ)(Mo.Z,{artSetKey:"",setArtSetKey:n,label:"New Artifact Set",getOptionDisabled:({key:e})=>Object.keys(t).includes(e)||!e||Object.keys((0,Pe.Sk)(e).setEffects).every((e=>parseInt(e)>i)),disabled:e})})]})}function zo({disabled:e=!1}){return(0,D.BX)(Te.Z,{spacing:1,children:[(0,D.tZ)(w.Z,{sx:{p:1},children:(0,D.tZ)(Te.Z,{spacing:1,children:i.Ex.map((t=>(0,D.tZ)(Eo,{slotKey:t,disabled:e},t)))})}),(0,D.tZ)(x.Suspense,{fallback:(0,D.tZ)(Z.Z,{variant:"rectangular",width:"100%",height:200}),children:(0,D.tZ)(Lo,{disabled:e})})]})}var Go=a(38243),$o=a(8660);let No,Wo,Fo=e=>e;function Vo(e){const{artifact:{substats:{stats:t,rarity:a,type:n}}}=e;return Math.floor(Math.min(...Object.entries(t).map((([e,t])=>t/(0,An.U9)(e,a,n)))))}function qo(e){return Math.floor(Math.min(...Object.values(e.optimization.maxSubstats)))}function Ho({disabled:e=!1}){const{t}=(0,b.$G)("page_character"),{charTC:a,setCharTC:n}=(0,x.useContext)(Po),[r,l]=(0,x.useState)((()=>[Vo(a)])),[s,o]=(0,x.useState)((()=>[qo(a)])),[c]=r,[d]=s,u=(0,x.useDeferredValue)(r),Z=(0,Go.z9)();(0,x.useEffect)((()=>{Z||n((e=>{const{artifact:{substats:{stats:t,type:a,rarity:n}}}=e;e.artifact.substats.stats=(0,le.vU)(t,((t,i)=>{const r=t,l=(0,An.U9)(i,n,a),s=l*u[0],o=Math.round(r/l-u[0]);return e.optimization.distributedSubstats=(0,le.re)(e.optimization.distributedSubstats+o,0,45),s}))}))}),[n,u]);const p=(0,x.useDeferredValue)(s);(0,x.useEffect)((()=>{Z||n((e=>{e.optimization.maxSubstats=(0,le.vU)(e.optimization.maxSubstats,((e,t)=>p[0]))}))}),[n,p]);const m=5*(i.i0[a.artifact.substats.rarity].numUpgrades+1),f=(null!=c?c:-1e-4)>m;return(0,D.BX)(h.Z,{display:"flex",gap:1,justifyContent:"space-between",alignItems:"center",children:[(0,D.tZ)(C.Z,{sx:{px:2,flexGrow:1,display:"flex",gap:1,alignItems:"center",justifyContent:"center",overflow:"visible"},children:(0,D.tZ)(fi.ZP,{size:"small",value:null!=c?c:0,max:m,min:0,step:1,marks:!0,valueLabelDisplay:"auto",onChange:(e,t)=>l([t]),onChangeCommitted:(e,t)=>l([t]),disabled:e})}),(0,D.tZ)(ke.ZP,{color:c&&f?"warning":"primary",float:!0,startAdornment:(0,D.tZ)(h.Z,{sx:{whiteSpace:"nowrap"},children:t(No||(No=Fo`tabTheorycraft.all.rolls`))}),value:parseFloat((null!=c?c:0).toFixed(2)),onChange:e=>void 0!==e&&l([e]),sx:{borderRadius:1,px:1,my:0,height:"100%",width:"7em"},inputProps:{sx:{textAlign:"right",pr:.5},min:0,step:1},disabled:e}),(0,D.tZ)(ke.ZP,{value:null!=d?d:0,startAdornment:(0,D.tZ)(h.Z,{sx:{whiteSpace:"nowrap"},children:t(Wo||(Wo=Fo`tabTheorycraft.all.max`))}),onChange:e=>void 0!==e&&o([e]),color:(null!=d?d:0)>m?"warning":"primary",sx:{borderRadius:1,px:1,my:0,height:"100%",width:"6.5em"},inputProps:{sx:{textAlign:"right",pr:.5},min:0,step:1},disabled:e})]})}let Uo,Yo=e=>e;function Jo({statKey:e,disabled:t=!1}){const{t:a}=(0,b.$G)("page_character"),{charTC:{artifact:{slots:n,substats:{type:r,stats:l,rarity:s}},optimization:{maxSubstats:o}},setCharTC:c}=(0,x.useContext)(Po),d=Object.values(n).map((e=>e.statKey)),u=l[e],Z=(0,x.useCallback)((t=>{c((a=>{const n=a.artifact.substats.stats[e];a.artifact.substats.stats[e]=t;const i=Math.round((n-t)/(0,An.U9)(e,a.artifact.substats.rarity,a.artifact.substats.type));a.optimization.distributedSubstats=(0,le.re)(a.optimization.distributedSubstats+i,0,45)}))}),[c,e]),p=o[e],m=(0,x.useCallback)((t=>{c((a=>{a.optimization.maxSubstats[e]=t}))}),[c,e]),f=(0,An.U9)(e,s,r),[g,y]=(0,x.useState)((()=>u/f));(0,x.useEffect)((()=>y(u/f)),[u,f]);const v=Ot.ZP.unit(e),C=g*f,w=g*f/(0,An.U9)(e)*100,k=d.reduce(((t,a)=>t+(a===e?1:0)),0),S=(5-k)*(i.F7[s]/4+1),B=g-1e-4>S,X=(0,x.useCallback)((e=>Z(e*f)),[Z,f]);return(0,D.BX)(Te.Z,{spacing:.5,children:[(0,D.BX)(h.Z,{display:"flex",gap:1,justifyContent:"space-between",alignItems:"center",children:[(0,D.tZ)(ke.ZP,{color:C?"success":"primary",float:"%"===Ot.ZP.unit(e),endAdornment:Ot.ZP.unit(e)||(0,D.tZ)(h.Z,{width:"1em",component:"span"}),value:parseFloat(C.toFixed(2)),onChange:e=>void 0!==e&&Z(e),sx:{borderRadius:1,px:1,height:"100%",width:"5em"},inputProps:{sx:{textAlign:"right"},min:0},disabled:t}),(0,D.BX)(Go.s8,{sx:{p:.5,minWidth:"11em",flexGrow:1,display:"flex",gap:1,alignItems:"center",justifyContent:"center"},children:[(0,D.tZ)(P.C,{statKey:e,iconProps:{fontSize:"inherit"}}),Ot.ZP.getStr(e),Ot.ZP.unit(e)]}),(0,D.tZ)(ke.ZP,{color:u?B?"warning":"success":"primary",float:!0,startAdornment:(0,D.BX)(h.Z,{sx:{whiteSpace:"nowrap",width:"6em",display:"flex",justifyContent:"space-between"},children:[(0,D.BX)("span",{children:[(0,An.Jj)(f,v),v]}),(0,D.tZ)("span",{children:"x"})]}),value:parseFloat(g.toFixed(2)),onChange:e=>void 0!==e&&Z(e*f),sx:{borderRadius:1,px:1,my:0,height:"100%",width:"6.5em"},inputProps:{sx:{textAlign:"right",pr:.5},min:0,step:1},disabled:t}),(0,D.tZ)(Go.s8,{sx:{textAlign:"center",p:.5,minWidth:"6em"},children:(0,D.BX)(Go._w,{color:B?"warning":void 0,children:["RV: ",(0,D.BX)("strong",{children:[w.toFixed(),"%"]}),(0,D.tZ)(Go.eN,{title:(0,D.tZ)(pe.Z,{children:a(k?"tabTheorycraft.maxRollsMain":"tabTheorycraft.maxRolls",{value:S})}),placement:"top",children:(0,D.tZ)(Ao.Z,{fontSize:"inherit",sx:{verticalAlign:"-10%"}})})]})})]}),(0,D.BX)(h.Z,{display:"flex",gap:1,justifyContent:"space-between",alignItems:"center",children:[(0,D.tZ)(Go.s8,{sx:{px:2,flexGrow:1,display:"flex",gap:1,alignItems:"center",justifyContent:"center",overflow:"visible"},children:(0,D.tZ)(fi.ZP,{size:"small",value:g,max:Math.min(S,p),min:0,step:1,marks:!0,valueLabelDisplay:"auto",onChange:(e,t)=>y(t),onChangeCommitted:(e,t)=>X(t),disabled:t})}),(0,D.tZ)(ke.ZP,{value:p,startAdornment:a(Uo||(Uo=Yo`tabTheorycraft.substat.max`)),onChange:e=>void 0!==e&&m(e),color:g-1e-4>p?"error":p>S?"warning":"success",sx:{borderRadius:1,px:1,my:0,height:"100%",width:"6em"},inputProps:{sx:{textAlign:"right",pr:.5},min:0,step:1},disabled:t})]})]})}function Qo({maxTotalRolls:e,disabled:t=!1}){const{t:a}=(0,b.$G)("page_character"),{charTC:{artifact:{substats:{type:n,stats:r,rarity:l}}},setCharTC:s}=(0,x.useContext)(Po),o=(0,x.useCallback)((e=>{s((t=>{t.artifact.substats.type=e}))}),[s]),c=(0,x.useCallback)((e=>{s((t=>{t.artifact.substats.rarity=e}))}),[s]),d=100*Object.entries(r).reduce(((e,[t,a])=>e+a/(0,An.U9)(t)),0),u=Object.entries(r).reduce(((e,[t,a])=>e+a/(0,An.U9)(t,l,n)),0),{high:Z,numUpgrades:p}=i.i0[l],m=5*(Z+p);return(0,D.tZ)(Go.s8,{bgt:"light",sx:{p:1,height:"100%"},children:(0,D.BX)(Te.Z,{spacing:1,children:[(0,D.BX)(h.Z,{sx:{display:"flex",gap:1},children:[(0,D.tZ)(Go.PS,{sx:{flexGrow:1},title:a(`tabTheorycraft.substatType.${n}`),disabled:t,children:i.Ar.map((e=>(0,D.tZ)(X.Z,{disabled:n===e,onClick:()=>o(e),children:a(`tabTheorycraft.substatType.${e}`)},e)))}),(0,D.tZ)($o.Z,{rarity:l,onChange:e=>c(e),filter:e=>e!==l,disabled:t}),(0,D.tZ)(Go.eN,{title:(0,D.tZ)(pe.Z,{children:(0,D.BX)(b.cC,{t:a,i18nKey:"tabTheorycraft.maxTotalRolls",children:["The current build can only have a maximum of ",(0,D.tZ)("strong",{children:{value:e}})," rolls."]})}),placement:"top",children:(0,D.BX)(Go.s8,{sx:{textAlign:"center",py:.5,px:1,whiteSpace:"nowrap",display:"flex",gap:2,justifyContent:"flex-end",alignItems:"center",flexShrink:1},children:[(0,D.BX)(Go._w,{color:u>m?"error":void 0,children:["Rolls: ",(0,D.tZ)("strong",{children:u.toFixed(0)})]}),(0,D.BX)(Go._w,{color:u>m?"error":void 0,children:["RV: ",(0,D.BX)("strong",{children:[d.toFixed(),"%"]})]})]})})]}),(0,D.tZ)(Ho,{disabled:t}),Object.entries(r).map((([e])=>(0,D.tZ)(Jo,{statKey:e,disabled:t},e)))]})})}var ec=a(83993),tc=a(82056);let ac,nc,ic=e=>e;function rc({disabled:e}){const{t}=(0,b.$G)("page_character"),{charTC:{optimization:{minTotal:a}},setCharTC:n}=(0,x.useContext)(Po);return(0,D.BX)(Go.s8,{bgt:"light",children:[(0,D.tZ)(ze.Z,{titleTypographyProps:{variant:"body1",sx:{fontWeight:"bold"}},title:t(ac||(ac=ic`tabTheorycraft.constraint.title`))}),(0,D.tZ)(je.Z,{}),(0,D.tZ)(h.Z,{sx:{p:1},children:(0,D.BX)(Te.Z,{spacing:1,children:[Object.entries(a).map((([t,a])=>(0,D.tZ)(lc,{statKey:t,value:a,disabled:e},t))),(0,D.tZ)(Go.PS,{disabled:e,title:t(nc||(nc=ic`tabTheorycraft.constraint.add`)),children:sa.t1.map((e=>(0,D.BX)(X.Z,{disabled:Object.keys(a).includes(e),onClick:()=>n((t=>{t.optimization.minTotal[e]=0})),children:[(0,D.tZ)(ec.Z,{children:(0,D.tZ)(B.ej,{statKey:e})}),(0,D.tZ)(tc.Z,{children:(0,D.tZ)(Oo.w0,{statKey:e})})]},e)))})]})})]})}function lc({statKey:e,value:t,disabled:a}){const{setCharTC:n}=(0,x.useContext)(Po),i=(0,le.bf)(e)||" ";return(0,D.BX)(xe.Z,{size:"small",children:[(0,D.tZ)(Go.CC,{sx:{flexBasis:30,flexGrow:1},children:(0,D.tZ)(Go.aJ,{float:"%"===i,value:e?t:void 0,onChange:t=>e&&n((a=>{a.optimization.minTotal[e]=t})),endAdornment:(0,D.tZ)(h.Z,{width:"1em",component:"span",children:i}),startAdornment:(0,D.BX)(h.Z,{component:"span",sx:{whiteSpace:"nowrap"},children:[(0,D.tZ)(B.ej,{statKey:e,iconProps:{fontSize:"inherit",sx:{verticalAlign:"-10%",mr:1}}}),(0,D.tZ)(Oo.w0,{statKey:e})]}),disabled:!e||a,sx:{px:1},inputProps:{sx:{textAlign:"right"}}})}),!!e&&(0,D.tZ)(g.Z,{color:"error",disabled:a,size:"small",onClick:()=>n((t=>{delete t.optimization.minTotal[e]})),children:(0,D.tZ)(Do.Z,{})})]})}const sc=a.p+"gcsim.5cadfd805391f327.png",oc={def_:"def%",def:"def",hp:"hp",hp_:"hp%",atk:"atk",atk_:"atk%",enerRech_:"er",eleMas:"em",critRate_:"cr",critDMG_:"cd",heal_:"heal",pyro_dmg_:"pyro%",hydro_dmg_:"hydro%",cryo_dmg_:"cryo%",electro_dmg_:"electro%",anemo_dmg_:"anemo%",geo_dmg_:"geo%",dendro_dmg_:"dendro%",physical_dmg_:"phys%"};function cc({disabled:e}){const{t}=(0,b.$G)(["page_character","settings"]),[a,i,r]=(0,n.aV)(),{character:{key:l,level:s,ascension:o,constellation:c,talent:{auto:d,burst:u,skill:h}}}=(0,x.useContext)(T.K),{charTC:{weapon:{key:Z,level:m,ascension:f,refinement:y},artifact:{slots:v,substats:{stats:C},sets:w}}}=(0,x.useContext)(Po),k=l.toLowerCase(),S=Object.entries(w).map((([e,t])=>`${k} add set="${e.toLowerCase()}" count=${t};`)).join("\n"),B=Object.entries(v).map((([e,{level:t,statKey:a,rarity:n}])=>`${oc[a]}=${(0,An.Fx)(a,n,t)}`)).join(" "),X=Object.entries(C).map((([e,t])=>`${oc[e]}=${(0,le.YM)(t,e).toFixed(e.endsWith("_")?4:2)}`)).join(" "),_=`# Generated by Genshin Optimizer\n\n# Character\n${k} char lvl=${s}/${An.SJ[o]} cons=${c} talent=${d},${u},${h};\n\n# Weapon\n${k} add weapon="${Z.toLowerCase()}" refine=${y} lvl=${m}/${An.SJ[f]};\n\n# Artifact Set\n${S||"# No Artifact Sets"}\n\n# Main stats\n${k} add stats ${B};\n\n# Sub stats\n${k} add stats ${X};`;return(0,D.BX)(D.HY,{children:[(0,D.tZ)(g.Z,{onClick:i,startIcon:(0,D.tZ)(Ke.Z,{src:sc}),disabled:e,children:t("tabTheorycraft.gcsimDialog.title")}),(0,D.BX)(Xo.Z,{open:a,onClose:r,maxWidth:"lg",children:[(0,D.tZ)(_o.Z,{children:t("tabTheorycraft.gcsimDialog.title")}),(0,D.BX)(To.Z,{children:[(0,D.tZ)(jo.Z,{children:(0,D.BX)(b.cC,{t,i18nKey:"tabTheorycraft.gcsimDialog.content",children:["Import this build into"," ",(0,D.tZ)(ma.Z,{href:"https://gcsim.app/",target:"_blank",children:"gcsim"})," ","by copying the code below."]})}),(0,D.tZ)(Go.s8,{children:(0,D.tZ)(p.Z,{children:(0,D.tZ)(Go.dn,{text:_})})})]}),(0,D.tZ)(Ko.Z,{children:(0,D.tZ)(g.Z,{fullWidth:!0,color:"info",onClick:()=>navigator.clipboard.writeText(_).then((()=>alert(t("tabTheorycraft.gcsimDialog.copied")))).catch(console.error),startIcon:(0,D.tZ)(ce.Z,{}),children:(0,D.tZ)(b.cC,{t,i18nKey:"settings:DatabaseCard.button.copy"})})})]})]})}const dc=a.p+"kqm.539212b66c730fa6.png";function uc({action:e,disabled:t}){const{t:a}=(0,b.$G)(["page_character","ui"]),[i,r,l]=(0,n.aV)();return(0,D.BX)(D.HY,{children:[(0,D.tZ)(g.Z,{color:"keqing",onClick:r,startIcon:(0,D.tZ)(Ke.Z,{src:dc}),disabled:t,children:a("tabTheorycraft.kqmsDialog.kqmsBtn")}),(0,D.BX)(Xo.Z,{open:i,onClose:l,children:[(0,D.tZ)(_o.Z,{children:a("tabTheorycraft.kqmsDialog.title")}),(0,D.tZ)(To.Z,{children:(0,D.tZ)(jo.Z,{children:(0,D.BX)(b.cC,{t:a,i18nKey:"tabTheorycraft.kqmsDialog.content",children:["This will replace your current ",(0,D.tZ)("strong",{children:"substat setup"})," with one that adheres to the"," ",(0,D.tZ)(ma.Z,{href:"https://compendium.keqingmains.com/kqm-standards",target:"_blank",children:"KQM Standards"}),"."]})})}),(0,D.BX)(Ko.Z,{children:[(0,D.tZ)(g.Z,{onClick:l,color:"error",children:a("ui:close")}),(0,D.tZ)(g.Z,{color:"success",onClick:()=>{l(),e()},autoFocus:!0,children:a("tabTheorycraft.kqmsDialog.kqmsBtn")})]})]})]})}var hc=a(23128);const Zc=x.lazy((()=>Promise.resolve().then(a.bind(a,18571))));function pc({weaponTypeKey:e,disabled:t}){const{charTC:a,setCharTC:i}=(0,x.useContext)(Po),r=(0,x.useCallback)((e=>{i((t=>{t.weapon=Object.assign({},t.weapon,e)}))}),[i]),l=(0,x.useMemo)((()=>Object.assign({},a.weapon,{location:"",lock:!1,id:""})),[a]),{key:s,level:o=0,refinement:c=1,ascension:d=0}=l,u=(0,Me.ub)(s),[Z,p,m]=(0,n.aV)(),{data:f}=(0,x.useContext)(j.R),b=(0,x.useMemo)((()=>l&&(0,xa.mP)([u.data,(0,xa.v0)(l)])),[u,l]);return(0,D.BX)(w.Z,{sx:{p:1,mb:1},children:[(0,D.tZ)(Zc,{ascension:d,show:Z,onHide:m,onSelect:e=>r({key:e}),weaponTypeFilter:e}),(0,D.BX)(h.Z,{display:"flex",flexDirection:"column",gap:1,children:[(0,D.BX)(h.Z,{display:"flex",gap:1,children:[(0,D.tZ)(h.Z,{className:`grad-${u.rarity}star`,component:"img",src:(0,Oe.Aq)(l.key,d>=2),sx:{flexshrink:1,flexBasis:0,maxWidth:"30%",borderRadius:1}}),(0,D.BX)(Te.Z,{spacing:1,flexGrow:1,children:[(0,D.tZ)(g.Z,{fullWidth:!0,color:"info",sx:{flexGrow:1},onClick:p,disabled:t,children:(0,D.tZ)(h.Z,{sx:{maxWidth:"10em"},children:null==u?void 0:u.name})}),u.hasRefinement&&(0,D.tZ)(hc.Z,{disabled:t,refinement:c,setRefinement:e=>r({refinement:e})})]})]}),(0,D.tZ)(q.Z,{level:o,ascension:d,setBoth:r,useLow:!u.hasRefinement,disabled:t}),(0,D.BX)(C.Z,{children:[(0,D.tZ)(ze.Z,{title:"Main Stats",titleTypographyProps:{variant:"subtitle2"}}),(0,D.tZ)(je.Z,{}),b&&(0,D.tZ)($e.lD,{children:[K.ri.weapon.main,K.ri.weapon.sub,K.ri.weapon.sub2].map((e=>{const t=b.get(e);return t.isEmpty||!t.value?null:(0,D.tZ)($e.JW,{node:t,component:Xt.ZP},JSON.stringify(t.info))}))})]}),f&&(null==u?void 0:u.document)&&(0,D.tZ)(Ya.Z,{sections:u.document,disabled:t})]})]})}function mc(e,t,a){var n,r;const{artifact:{sets:l},optimization:{target:s,minTotal:o}}=a;if(!s)return{};const c=null==(n=e[t])?void 0:n.target.data[0];if(!c)return{};Object.assign(c,(0,xa.b3)([c,gr]));const d=(0,re.Hm)(null!=(r=c.display)?r:{},s);if(!d)return{};const u=Object.keys(o).map((e=>c.total[e]));let h=(0,ba.tL)([d,...u],c,(({path:[e]})=>"dyn"!==e));return h=(0,ya.uW)(h,(e=>{if("read"===e.operation&&"dyn"===e.path[0]){const t=l[e.path[1]];if(t)return(0,va.a9)(t);if(!i._m.includes(e.path[1]))return(0,va.a9)(0)}return e}),(e=>e)),h=(0,ba.tL)(h,{},(e=>!1)),{nodes:h}}function fc(e,t,a=20){return a-e.reduce(((e,[a,n])=>{var i;const r=5-(null!=(i=t[a])?i:0);return e+Math.min(n,r)}),0)}function gc(e){return Object.values(e).reduce(((e,{rarity:t,level:a})=>{const{high:n,low:r}=i.i0[t];return e+(a>=4?n:r)}),0)}function xc(e){const t={};return Object.values(e).forEach((({statKey:e})=>{var a;t[e]=(null!=(a=t[e])?a:0)+1}),0),t}function bc(e){const{artifact:{slots:t,substats:{stats:a},sets:n}}=e,i=(0,le.vU)(a,((e,t)=>(0,le.YM)(e,t)));return Object.values(t).forEach((({statKey:e,rarity:t,level:a})=>{var n;return i[e]=(null!=(n=i[e])?n:0)+(0,An.Fx)(e,t,a)})),{art:(0,le.vU)(i,((e,t)=>t.endsWith("_")?(0,va.aQ)(e):(0,va.a9)(e))),artSet:(0,le.vU)(n,(e=>(0,va.a9)(e)))}}function yc(e){const{weapon:{key:t,level:a,ascension:n,refinement:i}}=e;return{id:"",location:"",key:t,level:a,ascension:n,refinement:i,lock:!1}}let vc,Cc,wc,kc=e=>e;function Sc(){var e,t;const{t:n}=(0,b.$G)("page_character"),{database:r}=(0,x.useContext)(Q.t),{data:l}=(0,x.useContext)(j.R),{gender:s}=(0,ae.Z)(),{character:o,character:{key:c,compareData:d},characterSheet:u,characterDispatch:p}=(0,x.useContext)(T.K),m=function(e,t){const{database:a}=(0,x.useContext)(Q.t),[n,i]=(0,x.useState)((()=>a.charTCs.getWithInit(e,t)));return(0,x.useEffect)((()=>(i(a.charTCs.getWithInit(e,t)),a.charTCs.follow(e,((e,t,a)=>"update"===t&&i(a))))),[e,i,a,t]),n}(c,(0,js.mT)(u.weaponTypeKey)),f=(0,x.useCallback)((e=>{r.charTCs.set(c,e)}),[c,r]),v=(0,x.useMemo)((()=>({charTC:m,setCharTC:f})),[m,f]),C=(0,x.useCallback)((()=>{f((0,sa.Oh)((0,js.mT)(u.weaponTypeKey)))}),[f,u]),k=(0,x.useCallback)(((e,t)=>f((a=>{a.weapon.key=e.key,a.weapon.level=e.level,a.weapon.ascension=e.ascension,a.weapon.refinement=e.refinement;const n=a.artifact.substats.type;a.artifact=(0,sa.Oh)("DullBlade").artifact,a.artifact.substats.type=n;const i={};t.forEach((e=>{var t;if(!e)return;const{slotKey:n,setKey:r,substats:l,mainStatKey:s,level:o,rarity:c}=e;a.artifact.slots[n].level=o,a.artifact.slots[n].statKey=s,a.artifact.slots[n].rarity=c,i[r]=(null!=(t=i[r])?t:0)+1,l.forEach((e=>{var t;e.key&&(a.artifact.substats.stats[e.key]=(null!=(t=a.artifact.substats.stats[e.key])?t:0)+e.accurateValue)}))})),a.artifact.sets=Object.fromEntries(Object.entries(i).map((([e,t])=>[e,3===t?2:5===t?4:1!==t||e.startsWith("PrayersFor")?t:0])).filter((([,e])=>e)))}))),[f]),X=(0,y.TH)(),{build:K}=null!=(e=X.state)?e:{build:void 0};(0,x.useEffect)((()=>{if(!K)return;const e=r.weapons.get(o.equippedWeapon);k(e,K.map((e=>r.arts.get(e))))}),[K,r]);const O=(0,x.useCallback)((()=>{const e=r.weapons.get(o.equippedWeapon);k(e,Object.values(o.equippedArtifacts).map((e=>r.arts.get(e))).filter((e=>e)))}),[r,o.equippedArtifacts,o.equippedWeapon,k]),P=(0,x.useDeferredValue)(m),E=(0,x.useMemo)((()=>bc(P)),[P]),M=(0,x.useMemo)((()=>yc(P)),[P]),A=(0,ne.ZP)(c,0,E,M),{target:I}=null!=(t=null==A?void 0:A[c])?t:{},R=(0,x.useMemo)((()=>{if(A&&I)return{data:I,teamData:A}}),[I,A]),L=(0,x.useMemo)((()=>{if(R)return Object.assign({},R,{oldData:d?l:void 0})}),[R,d,l]),G=m.optimization.target,$=(0,x.useCallback)((e=>{const t=structuredClone(m);t.optimization.target=e,f(t)}),[m,f]),N=m.optimization.distributedSubstats,W=(0,x.useCallback)((e=>{f((t=>{t.optimization.distributedSubstats=e}))}),[f]),F=(0,x.useRef)(null);null===F.current&&(F.current=new Worker(new URL(a.p+a.u(789),a.b)));const[V,q]=(0,x.useState)((0,Co.Qe)()),H="active"===V.type,U=(0,x.useCallback)((()=>{F.current.terminate(),F.current=null,q((0,Co.Qe)())}),[F]),{minSubLines:Y,minOtherRolls:J}=(0,x.useMemo)((()=>function(e){const{artifact:{slots:t,substats:{stats:a,type:n,rarity:i}}}=e,r=(0,le.vU)(a,((e,t)=>Math.ceil(a[t]/(0,An.U9)(t,i,n)))),l=xc(t),s=gc(t);return{minSubLines:s,minOtherRolls:fc(Object.entries(r),l,s)}}(m)),[m]),ee=(0,x.useMemo)((()=>Object.values(m.artifact.slots).reduce(((e,{level:t,rarity:a})=>e+i.i0[a].high+Math.floor(t/4)),0)),[m]),{scalesWith:te}=(0,x.useMemo)((()=>{const{nodes:e}=mc(A,c,m),t=e?function(e){const t=new Set;return(0,ba.I3)(e,{},(e=>{const a=e.path[1];return t.add(a),a}),1),t}(e):new Set;return{nodes:e,scalesWith:t}}),[A,c,m]),ie=e=>{const t=(0,ne.o_)(r,c,0,s,bc(m),yc(m)),{nodes:a}=mc(t,c,m);F.current.postMessage({charTC:m,nodes:a}),q((e=>Object.assign({},e,{type:"active",startTime:performance.now(),finishTime:void 0}))),F.current.onmessage=({data:t})=>{const{resultType:a}=t;switch(a){case"total":q((e=>Object.assign({},e,{total:t.total})));break;case"count":q((e=>Object.assign({},e,{tested:t.tested,failed:t.failed})));break;case"finalize":{const{maxBuffer:a,distributed:n,tested:i,failed:r,skipped:l}=t;if(q((e=>Object.assign({},e,{type:"inactive",tested:i,failed:r,skipped:l,finishTime:performance.now()}))),!e){console.log({maxBuffer:a,distributed:n,tested:i,failed:r,skipped:l});break}f((e=>(e.artifact.substats.stats=(0,le.vU)(e.artifact.substats.stats,((e,t)=>{var n;return e+(0,le.yI)(null!=(n=a[t])?n:0,t)})),e.optimization.distributedSubstats=N-n,e)));break}}}},se=(0,x.useCallback)((()=>{f((e=>{e.artifact.substats.type="mid";const{artifact:{slots:t,substats:{stats:a,type:n,rarity:i}}}=e;e.optimization.distributedSubstats=20-(5===i?0:4===i?10:15),e.artifact.substats.stats=(0,le.vU)(a,((e,t)=>2*(0,An.U9)(t,i,n))),e.optimization.maxSubstats=(0,le.vU)(e.optimization.maxSubstats,((e,a)=>2+2*(5-Object.entries(t).filter((([e,{statKey:t}])=>t===a)).length)))}))}),[f]);return(0,D.tZ)(Po.Provider,{value:v,children:(0,D.BX)(Te.Z,{spacing:1,children:[(0,D.tZ)(w.Z,{children:(0,D.BX)(h.Z,{sx:{display:"flex",gap:1,p:1},children:[(0,D.BX)(h.Z,{sx:{flexGrow:1,display:"flex",gap:1},children:[(0,D.tZ)(Bc,{action:O,disabled:H}),(0,D.tZ)(Xc,{action:C,disabled:H}),(0,D.tZ)(uc,{action:se,disabled:H}),(0,D.tZ)(cc,{disabled:H})]}),(0,D.BX)(z.Z,{exclusive:!0,value:d,onChange:(e,t)=>p({compareData:t}),size:"small",children:[(0,D.tZ)(_.Z,{value:!1,disabled:!d,children:n(vc||(vc=kc`tabTheorycraft.compareToggle.tc`))}),(0,D.tZ)(_.Z,{value:!0,disabled:d,children:n(Cc||(Cc=kc`tabTheorycraft.compareToggle.equipped`))})]})]})}),R?(0,D.BX)(j.R.Provider,{value:R,children:[(0,D.tZ)(h.Z,{children:(0,D.BX)(Ce.ZP,{container:!0,spacing:1,sx:{justifyContent:"center"},children:[(0,D.BX)(Ce.ZP,{item:!0,sx:{flexGrow:-1,maxWidth:"350px"},children:[(0,D.tZ)(pc,{weaponTypeKey:u.weaponTypeKey,disabled:H}),(0,D.tZ)(rc,{disabled:H})]}),(0,D.tZ)(Ce.ZP,{item:!0,sx:{flexGrow:-1},children:(0,D.tZ)(zo,{disabled:H})}),(0,D.tZ)(Ce.ZP,{item:!0,sx:{flexGrow:1},children:(0,D.tZ)(Qo,{disabled:H,maxTotalRolls:ee})})]})}),(0,D.BX)(h.Z,{display:"flex",flexDirection:"column",gap:1,children:[J>0&&(0,D.tZ)(Bt.Z,{severity:"warning",variant:"filled",children:(0,D.BX)(b.cC,{t:n,i18nKey:"tabTheorycraft.feasibilityAlert",values:{minSubLines:Y,minOtherRolls:J},children:["The current substat distribution requires at least"," ",(0,D.tZ)("strong",{children:{minSubLines:Y}})," lines of substats. Need to assign ",(0,D.tZ)("strong",{children:{minOtherRolls:J}})," ","rolls to other substats for this solution to be feasible."]})}),(0,D.BX)(h.Z,{display:"flex",gap:1,children:[(0,D.tZ)(Ve,{disabled:H,optimizationTarget:G,setTarget:e=>$(e)}),(0,D.tZ)(ke.ZP,{value:N,disabled:!G||H,onChange:e=>void 0!==e&&W(e),endAdornment:"Substats",sx:{borderRadius:1,px:1,textWrap:"nowrap",flexShrink:1},inputProps:{sx:{textAlign:"right",px:1,width:"3em",minWidth:"3em"},min:0}}),H?(0,D.tZ)(g.Z,{onClick:U,color:"error",startIcon:(0,D.tZ)(Bo.Z,{}),children:"Cancel"}):(0,D.tZ)(g.Z,{onClick:()=>ie(!0),disabled:!G||!N||N>ee,color:"success",startIcon:(0,D.tZ)(So.Z,{}),children:n(wc||(wc=kc`tabTheorycraft.distribute`))})]}),re.r8&&(0,D.tZ)(g.Z,{onClick:()=>ie(!1),disabled:!G||H,children:"Log Optimized Substats"}),!!te.size&&(0,D.BX)(Bt.Z,{severity:"info",variant:"filled",children:[(0,D.BX)(b.cC,{t:n,i18nKey:"tabTheorycraft.optAlert.scalesWith",children:["The selected Optimization target and constraints scales with:"," "]}),[...te].map((e=>(0,D.BX)("strong",{children:[(0,D.tZ)(B.ej,{statKey:e,iconProps:S.mX}),(0,D.tZ)(Oo.w0,{statKey:e})]},e))).flatMap(((e,t,a)=>t===a.length-2?[e,(0,D.tZ)("span",{children:", and "},"and")]:t===a.length-1?e:[e,(0,D.tZ)("span",{children:", "},t)])),(0,D.tZ)(b.cC,{t:n,i18nKey:"tabTheorycraft.optAlert.distribute",children:". The solver will only distribute stats to these substats."})," ",J>0&&(0,D.tZ)(b.cC,{t:n,i18nKey:"tabTheorycraft.optAlert.feasibilty",children:"There may be additional leftover substats that should be distributed to non-scaling stats to ensure the solution is feasible."})]}),(0,D.tZ)(Co.g8,{status:V,characterKey:c,gender:s})]})]}):(0,D.tZ)(Z.Z,{variant:"rectangular",width:"100%",height:500}),(0,D.tZ)(w.Z,{sx:{flexGrow:1,p:1},children:(0,D.tZ)(ga.Provider,{value:G,children:L?(0,D.tZ)(j.R.Provider,{value:L,children:(0,D.tZ)(Yn,{})}):(0,D.tZ)(Z.Z,{variant:"rectangular",width:"100%",height:500})})})]})})}function Bc({action:e,disabled:t}){const{t:a}=(0,b.$G)(["page_character","ui"]),[i,r,l]=(0,n.aV)();return(0,D.BX)(D.HY,{children:[(0,D.tZ)(g.Z,{color:"info",onClick:r,startIcon:(0,D.tZ)(wo.Z,{}),disabled:t,children:a("tabTheorycraft.copyDialog.copyBtn")}),(0,D.BX)(Xo.Z,{open:i,onClose:l,children:[(0,D.tZ)(_o.Z,{children:a("tabTheorycraft.copyDialog.title")}),(0,D.tZ)(To.Z,{children:(0,D.tZ)(jo.Z,{children:a("tabTheorycraft.copyDialog.content")})}),(0,D.BX)(Ko.Z,{children:[(0,D.tZ)(g.Z,{onClick:l,color:"error",children:a("ui:close")}),(0,D.tZ)(g.Z,{color:"success",onClick:()=>{l(),e()},autoFocus:!0,children:a("tabTheorycraft.copyDialog.copyBtn")})]})]})]})}function Xc({action:e,disabled:t}){const{t:a}=(0,b.$G)(["page_character","ui"]),[i,r,l]=(0,n.aV)();return(0,D.BX)(D.HY,{children:[(0,D.tZ)(g.Z,{color:"error",onClick:r,startIcon:(0,D.tZ)(ko.Z,{}),disabled:t,children:a("ui:reset")}),(0,D.BX)(Xo.Z,{open:i,onClose:l,children:[(0,D.tZ)(_o.Z,{children:a("tabTheorycraft.resetDialog.title")}),(0,D.tZ)(To.Z,{children:(0,D.tZ)(jo.Z,{children:a("tabTheorycraft.resetDialog.content")})}),(0,D.BX)(Ko.Z,{children:[(0,D.tZ)(g.Z,{onClick:l,color:"error",children:a("ui:close")}),(0,D.tZ)(g.Z,{color:"success",onClick:()=>{l(),e()},autoFocus:!0,children:a("ui:reset")})]})]})]})}var _c=a(1856),Tc=a(5896),jc=a(81073),Kc=a(30840),Oc=a(15045);const Pc=[[1],[1,1,1,1],[1,2,3,4,3,2,1],[1,3,6,10,12,12,10,6,3,1],[1,4,10,20,31,40,44,40,31,20,10,4,1],[1,5,15,35,65,101,135,155,155,135,101,65,35,15,5,1]];function Ec(e,t){var a;if(e>=Pc.length)throw Error("Input to `quadrinomial` leaves expected range 0 <= n <= 5");return null!=(a=Pc[e][t])?a:0}function Mc(e){let t=1;e<0&&(t=-1);const a=1/(1+.3275911*(e=Math.abs(e)));return t*(1-((((1.061405429*a-1.453152027)*a+1.421413741)*a-.284496736)*a+.254829592)*a*Math.exp(-e*e))}const Dc=[1,1,2,6,24,120,720];function Ac(e){for(;e>=Dc.length;)Dc.push(Dc.length*Dc[Dc.length-1]);return Dc[e]}function Ic(e,t){var a,n,i,r,l;if(0!==e)for(let s=e;s>=0;s--)for(let o=e-s;o>=0;o--)for(let c=e-s-o;c>=0;c--){const d=e-s-o-c;t([s,o,c,d],(a=s)+(n=o)+(i=c)+(r=d)!==(l=e)?0:Ac(l)/Ac(a)/Ac(n)/Ac(i)/Ac(r)*4**-l)}else t([0,0,0,0],1)}function Rc(e,t,a){let n=!0;return(0,ya.aD)([e],(e=>{}),(e=>{const{operation:i}=e;if("read"===i){if("number"!==e.type||e.accu&&"add"!==e.accu)throw new Error(`Unsupported [${i}] node in zero_deriv`);t(e)===a&&(n=!1)}})),n}function Lc(e,t,a){const{operation:n}=e;switch(n){case"read":if("number"!==e.type||e.accu&&"add"!==e.accu)throw new Error(`Unsupported [${n}] node in d/dx`);return t(e)===a?(0,va.a9)(1):(0,va.a9)(0);case"const":return(0,va.a9)(0);case"res":if(!Rc(e,t,a))throw new Error(`[${n}] node takes only constant inputs. ${e}`);return(0,va.a9)(0);case"add":return(0,va.Sm)(...e.operands.map((e=>Lc(e,t,a))));case"mul":{const n=e.operands.map(((n,i)=>(0,va.WV)(Lc(n,t,a),...e.operands.filter(((e,t)=>t!==i)))));return(0,va.Sm)(...n)}case"sum_frac":{const n=e.operands[0],i=Lc(n,t,a),r=(0,va.Sm)(...e.operands.slice(1)),l=Lc(r,t,a),s=(0,va.WV)((0,va.Sm)(...e.operands),(0,va.Sm)(...e.operands)),o=(0,va.Sm)((0,va.WV)(r,i),(0,va.WV)(-1,n,l));return(0,va.F9)(o,(0,va.Sm)((0,va.WV)(-1,o),s))}case"min":case"max":{let i=Lc(e.operands[0],t,a);for(let r=1;r<e.operands.length;r++){const l=e.operands[r];if("min"===n){const n=(0,va.VV)(...e.operands.slice(0,r));i=(0,va.Lj)(l,n,i,Lc(l,t,a))}else if("max"===n){const n=(0,va.Fp)(...e.operands.slice(0,r));i=(0,va.Lj)(l,n,Lc(l,t,a),i)}}return i}case"threshold":{const[i,r,l,s]=e.operands;if(!Rc(i,t,a)||!Rc(r,t,a))throw new Error(`[${n}] node must branch on constant inputs. ${e}`);return(0,va.Lj)(i,r,Lc(l,t,a),Lc(s,t,a))}default:(0,re.UT)(n)}}function zc(e,t,a){if(t<1e-5)return e>a?{p:1,upAvg:e-a}:{p:0,upAvg:0};const n=(a-e)/Math.sqrt(t),i=(1-Mc(n/Math.sqrt(2)))/2,r=function(e,t,a){return void 0===t&&(t=0),void 0===a&&(a=1),a<=0?0:Math.exp(-(t-e)*(t-e)/a/2)/Math.sqrt(2*Math.PI*a)}(n),l=1/(n*n),s=n<5?r/i-n:(1-2*l*(1-l*(5+37*l)))/n;return{p:i,upAvg:Math.sqrt(t)*s}}const Gc=8.5,$c=18.375,Nc=4.515625;let Wc=function(e){return e[e.Fast=0]="Fast",e[e.Slow=1]="Slow",e[e.Exact=2]="Exact",e}({});const Fc={hp:6,atk:6,def:6,hp_:4,atk_:4,def_:4,eleMas:4,enerRech_:4,critRate_:3,critDMG_:3};function Vc(e,t=5){return qc(e,(0,An.U9)(e,t)/10)}function qc(e,t){return e.endsWith("_")?t/100:t}class UpOptCalculator{constructor(e,t,a,n){this.baseBuild=void 0,this.nodes=void 0,this.thresholds=void 0,this.calc4th=!1,this.skippableDerivatives=void 0,this.eval=void 0,this.artifacts=[],this.fixedIx=0,this.baseBuild=a,this.nodes=e,this.thresholds=t;const r=[];e.forEach((e=>{r.push(e,...i._m.map((t=>Lc(e,(e=>e.path[1]),t))))}));const l=(0,ba.tL)(r,{},(({path:[e]})=>"dyn"!==e)),s=(0,ba.I3)(l,{},(e=>e.path[1]),5);t[0]=s(Object.values(a))[0],this.skippableDerivatives=i._m.map((t=>e.every((e=>Rc(e,(e=>e.path[1]),t))))),this.eval=(t,n)=>{const r=Object.assign({},a,{[n]:{id:"",values:t}}),l=s(Object.values(r));return e.map(((e,t)=>{const a=t*(1+i._m.length);return{v:l[a],grads:i._m.map(((e,t)=>l[a+1+t]))}}))},n.forEach((e=>this._addArtifact(e)))}_addArtifact(e){const t=i.F7[e.rarity],a=(0,An.Bv)(e.mainStatKey,e.rarity,t);this.artifacts.push({id:e.id,rollsLeft:(0,An.NB)(e.level,e.rarity),slotKey:e.slotKey,mainStat:e.mainStatKey,subs:e.substats.map((({key:e})=>e)).filter((e=>""!==e)),values:Object.assign({[e.setKey]:1,[e.mainStatKey]:qc(e.mainStatKey,a)},Object.fromEntries(e.substats.filter((({key:e})=>""!==e)).map((e=>[e.key,qc(e.key,e.accurateValue)]))))})}calcFastAll(){function e(e){return e.result.p*e.result.upAvg}this.artifacts.forEach(((e,t)=>this.calcFast(t,this.calc4th))),this.artifacts.sort(((t,a)=>e(a)-e(t))),this.fixedIx=0}calcSlowToIndex(e,t=5){const a=this.artifacts.slice(0,this.fixedIx),n=this.artifacts.slice(this.fixedIx);function i(e){return e.result.p*e.result.upAvg}function r(e,t){if(i(e)>1e-5||i(t)>1e-5)return i(t)-i(e);const a=e.result.distr.gmm.reduce(((e,{phi:t,mu:a})=>e+t*a),0);return t.result.distr.gmm.reduce(((e,{phi:t,mu:a})=>e+t*a),0)-a}let l=0;const s=Math.min(e-this.fixedIx+t,n.length);do{for(;l<s;l++)this.calcSlow(this.fixedIx+l,this.calc4th);for(n.sort(r),this.artifacts=[...a,...n],l=0;l<s&&n[l].result.evalMode!==Wc.Fast;l++);}while(l<s)}_toResultFast(e){let t=0,a=0;const n=e.map((({prob:e,mu:n,cov:i})=>{const r=n.map(((e,t)=>zc(e,i[t],this.thresholds[t]))),l=Math.min(...r.map((({p:e})=>e))),s=Math.min(...r.slice(1).map((({p:e})=>e)));return t+=l*e,a+=l*e*r[0].upAvg,{phi:e,cp:s,mu:n[0],sig2:i[0]}})),i=n.map((({mu:e,sig2:t})=>e-4*Math.sqrt(t))),r=n.map((({mu:e,sig2:t})=>e+4*Math.sqrt(t)));return{p:t,upAvg:t<1e-6?0:a/t,distr:{gmm:n,lower:Math.min(...i),upper:Math.max(...r)},evalMode:Wc.Fast}}calcFast(e,t=!0){4===this.artifacts[e].subs.length&&(t=!1),t?this._calcFast4th(e):this._calcFast(e)}_calcFast(e){const{subs:t,slotKey:a,rollsLeft:n}=this.artifacts[e],r=n-(t.length<4?1:0),l=Object.assign({},this.artifacts[e].values);t.forEach((e=>{l[e]+=Gc*(r/4)*Vc(e)}));const s=this.eval(l,a).map((({v:e,grads:a})=>{const n=t.map((e=>a[i._m.indexOf(e)]*Vc(e))),l=n.reduce(((e,t)=>e+t),0),s=n.reduce(((e,t)=>e+t*t),0);return{mu:e,sig2:($c*s-Nc*l**2)*r}}));this.artifacts[e].result=this._toResultFast([{prob:1,mu:s.map((({mu:e})=>e)),cov:s.map((({sig2:e})=>e))}])}_calcFast4th(e){const{mainStat:t,subs:a,slotKey:n,rollsLeft:r}=this.artifacts[e],l=r-1,s=i._m.filter((e=>!a.includes(e)&&e!==t)),o=s.reduce(((e,t)=>e+Fc[t]),0),c=s.map((t=>{var r;const s=Fc[t]/o,c=Object.assign({},this.artifacts[e].values);a.forEach((e=>{c[e]+=Gc*(l/4)*Vc(e)})),c[t]=(null!=(r=c[t])?r:0)+Gc*(l/4+1)*Vc(t);const d=this.eval(c,n).map((({v:e,grads:n})=>{const r=a.map((e=>n[i._m.indexOf(e)]*Vc(e))),s=n[i._m.indexOf(t)]*Vc(t),o=r.reduce(((e,t)=>e+t),s),c=r.reduce(((e,t)=>e+t*t),s*s);return{mu:e,sig2:($c*c-Nc*o**2)*l+1.25*s*s}}));return{prob:s,mu:d.map((({mu:e})=>e)),cov:d.map((({sig2:e})=>e))}}));this.artifacts[e].result=this._toResultFast(c)}_toResultSlow(e){let t=0,a=0;const n=e.map((({prob:e,mu:n,cov:i})=>{const{p:r,upAvg:l,cp:s}=function(e,t,a){let n=1,i=1;for(let l=0;l<e.length;++l){if(t[l][l]<1e-5){if(e[l]<a[l])return{p:0,upAvg:0,cp:0};continue}const r=(1-Mc((a[l]-e[l])/Math.sqrt(t[l][l])/Math.sqrt(2)))/2;n*=r,0!==l&&(i*=r)}const{upAvg:r}=zc(e[0],t[0][0],a[0]);return{p:n,upAvg:r,cp:i}}(n,i,this.thresholds);return t+=e*r,a+=e*r*l,{phi:e,cp:s,mu:n[0],sig2:i[0][0]}})),i=n.map((({mu:e,sig2:t})=>e-4*Math.sqrt(t))),r=n.map((({mu:e,sig2:t})=>e+4*Math.sqrt(t)));return{p:t,upAvg:t<1e-6?0:a/t,distr:{gmm:n,lower:Math.min(...i,this.thresholds[0]),upper:Math.max(...r,this.thresholds[0])},evalMode:Wc.Slow}}calcSlow(e,t=!0){var a,n;(null==(a=this.artifacts[e].result)?void 0:a.evalMode)!==Wc.Slow&&(null==(n=this.artifacts[e].result)?void 0:n.evalMode)!==Wc.Exact&&(4===this.artifacts[e].subs.length&&(t=!1),t?this._calcSlow4th(e):this._calcSlow(e))}_calcSlow(e){const{subs:t,slotKey:a,rollsLeft:n}=this.artifacts[e],r=n-(t.length<4?1:0),l=[];Ic(r,((n,r)=>{const s=Object.assign({},this.artifacts[e].values);t.forEach(((e,t)=>{s[e]+=Gc*n[t]*Vc(e)}));const o=this.eval(s,a),c=o.map((({grads:e})=>t.map((t=>e[i._m.indexOf(t)]*Vc(t))))),d=o.map((e=>e.v)),u=c.map((e=>c.map((t=>e.reduce(((a,i,r)=>a+e[r]*t[r]*n[r]),0)))));l.push({prob:r,mu:d,cov:u})})),this.artifacts[e].result=this._toResultSlow(l)}_calcSlow4th(e){const{mainStat:t,subs:a,slotKey:n,rollsLeft:r}=this.artifacts[e],l=r-1,s=i._m.filter((e=>!a.includes(e)&&e!==t)),o=s.reduce(((e,t)=>e+Fc[t]),0),c=[];s.forEach((t=>{Ic(l,((r,l)=>{var s;l*=Fc[t]/o;const d=Object.assign({},this.artifacts[e].values);r[3]+=1,a.forEach(((e,t)=>{d[e]+=Gc*r[t]*Vc(e)})),d[t]=(null!=(s=d[t])?s:0)+Gc*r[3]*Vc(t);const u=this.eval(d,n),h=u.map((({grads:e})=>{const n=a.map((t=>e[i._m.indexOf(t)]*Vc(t)));return n.push(e[i._m.indexOf(t)]*Vc(t)),n})),Z=u.map((e=>e.v)),p=h.map((e=>h.map((t=>e.reduce(((a,n,i)=>a+e[i]*t[i]*r[i]),0)))));c.push({prob:l,mu:Z,cov:p})}))})),this.artifacts[e].result=this._toResultSlow(c)}_toResultExact(e){let t=0,a=0;const n=e.map((({prob:e,val:n})=>{if(n.every(((e,t)=>e>=this.thresholds[t])))return t+=e,a+=e*(n[0]-this.thresholds[0]),{phi:e,cp:1,mu:n[0],sig2:0};return{phi:e,cp:n.slice(1).every(((e,t)=>e>=this.thresholds[t]))?1:0,mu:n[0],sig2:0}})),i=n.map((({mu:e})=>e));return{p:t,upAvg:t<1e-6?0:a/t,distr:{gmm:n,lower:Math.min(...i),upper:Math.max(...i)},evalMode:Wc.Exact}}calcExact(e,t=!0){var a;(null==(a=this.artifacts[e].result)?void 0:a.evalMode)!==Wc.Exact&&(4===this.artifacts[e].subs.length&&(t=!1),t?this._calcExact4th(e):this._calcExact(e))}_calcExact(e){const{subs:t,slotKey:a,rollsLeft:n}=this.artifacts[e],r=n-(t.length<4?1:0),l=[];Ic(r,((n,r)=>{const s=Object.assign({},this.artifacts[e].values),o=n.map(((e,a)=>t[a]&&!this.skippableDerivatives[i._m.indexOf(t[a])]?(0,le.w6)(7*e,10*e):[NaN]));(0,le.Og)(...o).forEach((e=>{const i=Object.assign({},s);let o=1;for(let a=0;a<4;a++){var c;if(isNaN(e[a]))continue;const r=t[a],l=e[a],s=n[a];i[r]=(null!=(c=i[r])?c:0)+l*Vc(r);o*=4**-s*Ec(s,l-7*s)}l.push({prob:r*o,val:this.eval(i,a).map((e=>e.v))})}))})),this.artifacts[e].result=this._toResultExact(l)}_calcExact4th(e){const{mainStat:t,subs:a,slotKey:n,rollsLeft:r}=this.artifacts[e],l=r-1,s=i._m.filter((e=>!a.includes(e)&&e!==t)),o=s.reduce(((e,t)=>e+Fc[t]),0),c=[];s.forEach((t=>{const r=Fc[t]/o;Ic(l,((l,s)=>{const o=l.map(((e,n)=>3===n?(e+=1,this.skippableDerivatives[i._m.indexOf(t)]?[NaN]:(0,le.w6)(7*e,10*e)):a[n]&&!this.skippableDerivatives[i._m.indexOf(a[n])]?(0,le.w6)(7*e,10*e):[NaN]));(0,le.Og)(...o).forEach((i=>{const o=Object.assign({},this.artifacts[e].values);let d=1;for(let e=0;e<3;e++){var u;if(isNaN(i[e]))continue;const t=a[e],n=i[e],r=l[e];o[t]=(null!=(u=o[t])?u:0)+n*Vc(t);d*=4**-r*Ec(r,n-7*r)}if(!isNaN(i[3])){var h;const e=t,a=i[3],n=l[3]+1;o[e]=(null!=(h=o[e])?h:0)+a*Vc(e);d*=4**-n*Ec(n,a-7*n)}c.push({prob:r*s*d,val:this.eval(o,n).map((e=>e.v))})}))}))})),this.artifacts[e].result=this._toResultExact(c)}}function Hc(e){const t=qc(e.mainStatKey,(0,An.Bv)(e.mainStatKey,e.rarity,e.level)),a={id:e.id,slot:e.slotKey,level:e.level,rarity:e.rarity,values:Object.assign({[e.setKey]:1,[e.mainStatKey]:t},Object.fromEntries(e.substats.map((e=>[e.key,qc(e.key,e.accurateValue)])).filter((([,e])=>0!==e)))),subs:e.substats.reduce(((e,t)=>(""!==t.key&&e.push(t.key),e)),[])};return delete a.values[""],a}const Uc=50;function Yc(e){return(0,D.BX)(Ce.ZP,{container:!0,spacing:1,children:[(0,D.tZ)(Ce.ZP,{item:!0,xs:5,sm:4,md:4,lg:3,xl:3,children:(0,D.tZ)(ii.Z,{artifactId:e.upgradeOpt.id,editorProps:{}})}),(0,D.tZ)(Ce.ZP,{item:!0,xs:7,sm:8,md:8,lg:9,xl:9,children:(0,D.tZ)(Jc,Object.assign({},e))})]})}function Jc({upgradeOpt:e,thresholds:t,objMin:a,objMax:i,calcExactCallback:r}){const{database:l}=(0,x.useContext)(Q.t),s=l.arts.get(e.id);if(!s)throw new Error(`artifact ${e.id} not found.`);const o=t.length>1,c=(t,a)=>e.result.distr.gmm.reduce(((e,{phi:n,mu:i,sig2:r})=>{const l=Math.sqrt(r);if(l<.001)return t<=i&&i<a?n+e:e;return e+n*(Mc((i-t)/l)-Mc((i-a)/l))/2}),0),d=(t,a)=>e.result.distr.gmm.reduce(((e,{cp:n,phi:i,mu:r,sig2:l})=>{const s=Math.sqrt(l);if(s<.001)return t<=r&&r<a?n*i+e:e;return e+n*i*(Mc((r-t)/s)-Mc((r-a)/s))/2}),0),u=t[0],Z=(0,x.useCallback)((e=>100*(e-u)/u),[u]),m=(i-a)/Uc,f=(0,le.SX)(a,i,Uc,!1).flatMap((e=>[{x:Z(e),est:c(e,e+m),estCons:d(e,e+m)},{x:Z(e+m),est:c(e,e+m),estCons:d(e,e+m)}]));f.unshift({x:Z(a),est:0,estCons:0}),f.push({x:Z(i),est:0,estCons:0});const g=f.reduce(((e,{est:t})=>Math.max(e,t)),0),b=(u-a)/(i-a),y=e.result.p,v=e.result.upAvg,C=f,k=e.result.evalMode===Wc.Exact,S=(0,le.SX)(a,i,Uc,!1).reduce(((e,t)=>t<u+v?t:e)),B=d(S,S+m),X=(0,n.KS)();k||X(r,1e3);const _=(0,D.BX)("span",{children:["Prob. upgrade",k?"":" (est.)",":"," ",(0,D.BX)("strong",{children:[(100*y).toFixed(1),"%"]})]}),T=(0,D.BX)("span",{children:["Average increase",k?"":" (est.)",":"," ",(0,D.BX)("strong",{children:[v<=0?"":"+",(100*v/u).toFixed(1),"%"]})]});return(0,D.BX)(w.Z,{children:[(0,D.BX)(h.Z,{sx:{display:"flex",flexDirection:"row"},children:[(0,D.tZ)(p.Z,{sx:{flexGrow:1},children:(0,D.BX)(h.Z,{sx:{display:"flex",flexDirection:"row",gap:2},children:[(0,D.tZ)(pe.Z,{children:_}),(0,D.tZ)(pe.Z,{sx:{flexGrow:1},children:T}),(0,D.tZ)(pe.Z,{children:"Currently Equipped"})]})}),(0,D.tZ)(h.Z,{sx:{height:50,width:50},children:(0,D.tZ)(Qc,{slotKey:s.slotKey})})]}),(0,D.tZ)(p.Z,{children:(0,D.tZ)(gi.h,{width:"100%",aspect:2.5,children:(0,D.BX)(xi.c,{data:C,margin:{top:5,right:30,left:20,bottom:20},children:[(0,D.tZ)(yi.K,{dataKey:"x",type:"number",domain:["auto","auto"],allowDecimals:!1,tickFormatter:e=>`${e<=0?"":"+"}${e}%`,children:(0,D.tZ)(vi._,{value:"Relative Damage Potential",position:"insideBottom",style:{fill:"#eaebed"},offset:-10})}),(0,D.tZ)(Ci.B,{type:"number",domain:[0,g],tick:!1,children:(0,D.tZ)(vi._,{value:"Probability",position:"insideLeft",angle:-90,style:{fill:"#eaebed"}})}),(0,D.tZ)(ki.D,{verticalAlign:"top",height:36}),(0,D.tZ)("defs",{children:(0,D.BX)("linearGradient",{id:`splitOpacity${e.id}`,x1:"0",y1:"0",x2:b,y2:"0",children:[(0,D.tZ)("stop",{offset:1,stopColor:k?"#f17704":"orange",stopOpacity:0}),(0,D.tZ)("stop",{offset:0,stopColor:k?"#f17704":"orange",stopOpacity:1})]})}),(0,D.tZ)(Si.x,{dataKey:"dne",stroke:"red",name:"Current Damage"}),o&&(0,D.tZ)(jc.u,{type:"monotone",dataKey:"est",stroke:"grey",dot:!1,fill:"grey",legendType:"none",tooltipType:"none",opacity:.5,activeDot:!1}),(0,D.tZ)(jc.u,{type:"monotone",dataKey:"estCons",stroke:k?"#f17704":"orange",dot:!1,fill:`url(#splitOpacity${e.id})`,opacity:.5,name:k?`Exact${o?" Constrained":""} Distribution`:"Estimated Distribution",activeDot:!1}),(0,D.tZ)(Kc.d,{x:Z(u),stroke:"red",strokeDasharray:"3 3",name:"Current Damage"}),(0,D.tZ)(Oc.q,{x:Z(u+v),y:B/2,shape:(0,D.tZ)("circle",{radius:1,opacity:.5})}),(0,D.tZ)(wi.u,{content:(0,D.tZ)((({active:e})=>e?(0,D.BX)("div",{className:"custom-tooltip",children:[(0,D.tZ)("p",{className:"label"}),(0,D.tZ)("p",{className:"desc",children:_}),(0,D.tZ)("p",{className:"desc",children:T})]}):null),{}),cursor:!1})]})},e.id)})]})}function Qc({slotKey:e}){const{database:t}=(0,x.useContext)(Q.t),{data:a}=(0,x.useContext)(j.R),n=(0,x.useMemo)((()=>t.arts.get(a.get(K.ri.art[e].id).value)),[e,a,t]);return(0,D.tZ)(Ki.Z,{slotKey:e,artifactObj:n})}var ed=a(37214),td=a(83660);function ad(){var e;const{character:{key:t}}=(0,x.useContext)(T.K),{database:a}=(0,x.useContext)(Q.t),{gender:r}=(0,ae.Z)(),l=(0,gt.Z)(),s=(0,x.useMemo)((()=>!a.arts.values.length),[a]),{buildSetting:o,buildSettingDispatch:c}=Ra(t),{optimizationTarget:d,levelLow:u,levelHigh:m}=o,f=(0,ne.ZP)(t),{target:b}=null!=(e=null==f?void 0:f[t])?e:{},[y]=(0,n.NW)(),[,v]=(0,x.useState)(a.displayOptimize.get());(0,x.useEffect)((()=>a.displayOptimize.follow(((e,t)=>v(t)))),[a,v]);const C=(0,x.useDeferredValue)(y),k=(0,x.useDeferredValue)(o),S=(0,x.useMemo)((()=>{const{mainStatKeys:e,excludedLocations:n,artExclusion:r,levelLow:l,levelHigh:s,allowLocationsState:o,useExcludedArts:c}=C&&k;return a.arts.values.filter((a=>{if(!c&&r.includes(a.id))return!1;if(a.level<l)return!1;if(a.level>s)return!1;const d=e[a.slotKey];if(null!=d&&d.length&&!d.includes(a.mainStatKey))return!1;const u=(0,i.V7)(t),h="unequippedOnly"===o&&a.location&&a.location!==u,Z="customList"===o&&a.location&&a.location!==u&&n.includes(a.location);return!h&&!Z}))}),[a,t,C,k]),B=(0,x.useMemo)((()=>Object.fromEntries(S.map((({id:e})=>[e,!0])))),[S]),[X,_]=(0,x.useState)(void 0),[,K]=(0,n.NW)(),[O,P]=(0,x.useState)(!0),[E,M]=(0,x.useState)(!0),[A,I]=(0,x.useState)(!1),[R,L]=(0,x.useState)(0),{artifactsToShow:z,numPages:G,currentPageIndex:$,minObj0:N,maxObj0:W}=(0,x.useMemo)((()=>{if(!X)return{artifactsToShow:[],numPages:0,currentPageIndex:0,toShow:0,minObj0:0,maxObj0:0};const e=Math.ceil(X.artifacts.length/5),t=(0,le.re)(R,0,e-1),a=X.artifacts.slice(5*t,5*(t+1)),n=X.thresholds[0];return{artifactsToShow:a,numPages:e,currentPageIndex:t,minObj0:a.reduce(((e,t)=>Math.min(t.result.distr.lower,e)),n),maxObj0:a.reduce(((e,t)=>Math.max(t.result.distr.upper,e)),n)}}),[R,X]),q=(0,x.useCallback)(((e,t)=>{if(!X)return;const a=5*t;X.calcSlowToIndex(a),L(t-1)}),[X]),H=(0,x.useCallback)((async()=>{var e,n,l,s;const{statFilters:c,optimizationTarget:d,mainStatKeys:u,levelLow:h,levelHigh:Z,artSetExclusion:p}=o;if(!re.dG)return;if(!t||!d)return;const m=(0,ne.VF)(a,t,0,[]);if(!m)return;const f=null==(e=(0,xa.Qo)(m.teamData,r,t)[t])?void 0:e.target.data[0];if(!f)return;Object.assign(f,(0,xa.b3)([f,gr]));const g=(0,re.Hm)(null!=(n=f.display)?n:{},d);if(!g)return;_(void 0),L(0);const x=Object.entries(c).flatMap((([e,t])=>t.filter((e=>!e.disabled)).map((t=>{var a,n;const i=(0,re.Hm)(null!=(a=f.display)?a:{},JSON.parse(e));return{value:i,minimum:"%"===(null==(n=i.info)?void 0:n.unit)?t.value/100:t.value}})))),b=null!=(l=null==(s=a.chars.get(t))?void 0:s.equippedArtifacts)?l:{},y=Object.fromEntries(i.Ex.map((e=>{var t;const n=a.arts.get(null!=(t=b[e])?t:"");return[e,n?Hc(n):void 0]}))),v=Object.fromEntries(i.Ex.map((e=>{var t,n;const i=a.arts.get(null!=(t=b[e])?t:"");return[e,null!=(n=null==i?void 0:i.setKey)?n:""]})));const C=[g,...x.map((e=>e.value))],w=(0,ba.tL)(C,f,(({path:[e]})=>"dyn"!==e)),k=a.arts.values.filter((e=>5===e.rarity)).filter((function(e){const t=Object.assign({},v);t[e.slotKey]=e.setKey;const a={};if(i.Ex.forEach((e=>{var n;return a[t[e]]=(null!=(n=a[t[e]])?n:0)+1})),!Object.entries(a).every((([e,t])=>{if(!p[e])return!0;switch(t){case 0:case 1:return!0;case 2:case 3:return!p[e].includes(2);case 4:case 5:return!p[e].includes(4);default:throw Error("error in respectSetExclude: num > 5")}})))return!1;if(!p.rainbow)return!0;switch(Object.values(a).reduce(((e,t)=>e+t%2),0)){case 0:case 1:return!0;case 2:case 3:return!p.rainbow.includes(2);case 4:case 5:return!p.rainbow.includes(4);default:throw Error("error in respectSex: nRainbow > 5")}})).filter((e=>O||20!==e.level)).filter((e=>{var t,a;return!A||!(null!=(t=u[e.slotKey])&&t.length)||(null==(a=u[e.slotKey])?void 0:a.includes(e.mainStatKey))})).filter((e=>!A||h<=e.level&&e.level<=Z)),S=new UpOptCalculator(w,[-1/0,...x.map((e=>e.minimum))],y,k);S.calc4th=E,S.calcFastAll(),S.calcSlowToIndex(5),_(S)}),[o,t,a,r,O,A,E]),U=(0,x.useMemo)((()=>b&&f&&{data:b,teamData:f}),[b,f]),Y=G>1&&(0,D.tZ)(w.Z,{children:(0,D.tZ)(p.Z,{children:(0,D.BX)(Ce.ZP,{container:!0,children:[(0,D.tZ)(Ce.ZP,{item:!0,flexGrow:1,children:(0,D.tZ)(Tc.Z,{count:G,page:$+1,onChange:q})}),(0,D.tZ)(Ce.ZP,{item:!0,children:(0,D.tZ)(nd,{numShowing:z.length,total:null==X?void 0:X.artifacts.length})})]})})});return(0,D.BX)(h.Z,{display:"flex",flexDirection:"column",gap:1,children:[s&&(0,D.tZ)(fa,{}),U&&(0,D.tZ)(j.R.Provider,{value:U,children:(0,D.BX)(ed.Z,{spacing:1,children:[(0,D.BX)(Ce.ZP,{container:!0,spacing:1,children:[(0,D.BX)(Ce.ZP,{item:!0,xs:12,sm:6,lg:3,display:"flex",flexDirection:"column",gap:1,children:[(0,D.tZ)(h.Z,{children:(0,D.tZ)(pa.Z,{characterKey:t,onClickTeammate:l})}),(0,D.tZ)(_n,{})]}),(0,D.tZ)(Ce.ZP,{item:!0,xs:12,sm:6,lg:9,display:"flex",flexDirection:"column",gap:1,children:(0,D.BX)(Ce.ZP,{container:!0,spacing:1,children:[(0,D.BX)(Ce.ZP,{item:!0,lg:4,display:"flex",flexDirection:"column",gap:1,children:[(0,D.tZ)(w.Z,{children:(0,D.BX)(p.Z,{children:[(0,D.tZ)("span",{children:"Optimization Target: "}),(0,D.tZ)(Ve,{optimizationTarget:d,setTarget:e=>c({optimizationTarget:e}),disabled:!1})]})}),(0,D.tZ)(w.Z,{children:(0,D.tZ)(p.Z,{children:(0,D.tZ)(mr,{disabled:!1})})}),A&&(0,D.BX)(w.Z,{children:[(0,D.tZ)(p.Z,{sx:{py:1},children:"Artifact Level Filter"}),(0,D.tZ)(ha.Z,{levelLow:u,levelHigh:m,setLow:e=>c({levelLow:e}),setHigh:e=>c({levelHigh:e}),setBoth:(e,t)=>c({levelLow:e,levelHigh:t}),disabled:!1}),(0,D.tZ)(p.Z,{children:(0,D.tZ)(cr,{disabled:!1,filteredArtIdMap:B})})]})]}),(0,D.BX)(Ce.ZP,{item:!0,lg:8,display:"flex",flexDirection:"column",gap:1,children:[(0,D.tZ)(w.Z,{children:(0,D.tZ)(p.Z,{children:(0,D.tZ)(yn,{disabled:!1})})}),(0,D.tZ)(w.Z,{children:(0,D.tZ)(p.Z,{children:(0,D.BX)(Ce.ZP,{container:!0,spacing:1,children:[(0,D.tZ)(Ce.ZP,{item:!0,children:(0,D.tZ)(g.Z,{startIcon:O?(0,D.tZ)(Tt.Z,{}):(0,D.tZ)(jt.Z,{}),color:O?"success":"secondary",onClick:()=>P(!O),children:"show lvl 20"})}),(0,D.tZ)(Ce.ZP,{item:!0,children:(0,D.tZ)(g.Z,{startIcon:E?(0,D.tZ)(Tt.Z,{}):(0,D.tZ)(jt.Z,{}),color:E?"success":"secondary",onClick:()=>M(!E),children:"compute 4th sub"})}),(0,D.tZ)(Ce.ZP,{item:!0,children:(0,D.tZ)(g.Z,{startIcon:A?(0,D.tZ)(Tt.Z,{}):(0,D.tZ)(jt.Z,{}),color:A?"success":"secondary",onClick:()=>I(!A),children:"enable filters"})})]})})})]})]})})]}),(0,D.tZ)(w.Z,{children:(0,D.tZ)(p.Z,{children:(0,D.BX)(Ce.ZP,{container:!0,spacing:1,children:[(0,D.tZ)(Ce.ZP,{item:!0,children:(0,D.tZ)(g.Z,{disabled:!t||!d||!(0,re.Hm)(null==b?void 0:b.getDisplay(),d),color:t?"success":"warning",onClick:H,startIcon:(0,D.tZ)(_c.Z,{}),children:"Calc Upgrade Priority"})}),(0,D.tZ)(Ce.ZP,{item:!0,children:(0,D.tZ)(V,{size:"small"})}),(0,D.tZ)(Ce.ZP,{item:!0,children:(0,D.tZ)(F,{size:"small"})})]})})}),Y,s&&(0,D.tZ)(td.Z,{}),(0,D.tZ)(x.Suspense,{fallback:(0,D.tZ)(Z.Z,{variant:"rectangular",sx:{width:"100%",height:600,minHeight:5e3}}),children:z.map(((e,t)=>{var a;return(0,D.tZ)(h.Z,{children:(0,D.tZ)(Yc,{upgradeOpt:e,thresholds:null!=(a=null==X?void 0:X.thresholds)?a:[],objMax:W,objMin:N,calcExactCallback:()=>{const e=5*$+t;null==X||X.calcExact(e),K()}})},e.id)}))}),Y]})})]})}function nd({numShowing:e,total:t}){return(0,D.tZ)(pe.Z,{color:"text.secondary",children:(0,D.BX)(b.cC,{i18nKey:"showingNum",count:e,value:t,children:["Showing ",{count:e}," out of ",{value:t}," Artifacts"]})})}var id=a(51638);function rd(){const{character:e}=(0,x.useContext)(T.K),{key:t}=e,a=(0,gt.Z)();if(!t.startsWith("Traveler"))return null;const n=i.UB.find((e=>t.toLowerCase().includes(e)));return n?(0,D.tZ)(L.Z,{color:n,title:(0,D.tZ)("strong",{children:(0,id.el)(`element.${n}`)}),children:i.DZ.map((e=>(0,D.tZ)(X.Z,{selected:n===e,disabled:n===e,onClick:()=>a((0,i.vd)(e)),children:(0,D.tZ)("strong",{children:(0,D.tZ)(E.Z,{color:e,children:(0,id.el)(`element.${e}`)})})},e)))}):null}var ld=a(2247),sd=a(96608);function od(){const{t:e}=(0,b.$G)("ui"),{database:t}=(0,x.useContext)(Q.t),{character:a}=(0,x.useContext)(T.K),{key:n}=a,{gender:i}=(0,ae.Z)(),r=(0,x.useCallback)((()=>t.dbMeta.set({gender:"F"===i?"M":"F"})),[i,t]);return n.startsWith("Traveler")?(0,D.BX)(g.Z,{onClick:r,startIcon:"F"===i?(0,D.tZ)(ld.Z,{}):(0,D.tZ)(sd.Z,{}),children:[(0,D.tZ)("strong",{children:e(`gender.${i}`)})," "]}):null}let cd,dd=e=>e;function ud(){const e=(0,y.s0)(),{database:t}=(0,x.useContext)(Q.t),a=(0,x.useCallback)((()=>e("/characters")),[e]),{characterKey:n}=(0,y.UO)();return!t.chars.keys.includes(n)?(0,D.tZ)(y.Fg,{to:"/characters"}):(0,D.tZ)(h.Z,{my:1,display:"flex",flexDirection:"column",gap:1,children:(0,D.tZ)(x.Suspense,{fallback:(0,D.tZ)(Z.Z,{variant:"rectangular",width:"100%",height:1e3}),children:n&&(0,D.tZ)(hd,{characterKey:n,onClose:a},n)})})}function hd({characterKey:e,onClose:t}){var a,n,r;const{silly:l}=(0,x.useContext)(Y.E),s=(0,ee.Z)(e),{gender:o}=(0,ae.Z)(),c=(0,J.m)(e,o),d=(0,ne.ZP)(e),{target:u}=null!=(a=null==d?void 0:d[e])?a:{},{params:{tab:m="overview"}}=null!=(n=(0,y.bS)({path:"/characters/:charKey/:tab",end:!1}))?n:{params:{tab:"overview"}},{t:f}=(0,b.$G)(["sillyWisher_charNames","charNames_gen","page_character"]);(0,ie.Z)((0,x.useMemo)((()=>`${f(`${l?"sillyWisher_charNames":"charNames_gen"}:${(0,i.Cs)(e,o)}`)} - ${f(`page_character:tabs.${m}`)}`),[f,l,e,o,m]));const g=(0,te.Z)(null!=(r=null==s?void 0:s.key)?r:""),v=(0,x.useMemo)((()=>{if(d&&u)return{data:u,teamData:d,oldData:void 0}}),[u,d]),S=(0,x.useMemo)((()=>{if(s&&c)return{character:s,characterSheet:c,characterDispatch:g}}),[s,c,g]),[B,X]=(0,x.useState)(void 0),[_,K]=(0,x.useState)(),O=(0,x.useMemo)((()=>({chartData:B,setChartData:X,graphBuilds:_,setGraphBuilds:K})),[B,_]);return(0,x.useEffect)((()=>{X(void 0),K(void 0)}),[e]),(0,D.tZ)(C.Z,{children:v&&S&&O?(0,D.tZ)(T.K.Provider,{value:S,children:(0,D.tZ)(j.R.Provider,{value:v,children:(0,D.tZ)(U.Provider,{value:O,children:(0,D.tZ)(H.B,{children:(0,D.BX)(p.Z,{sx:{display:"flex",flexDirection:"column",gap:1},children:[(0,D.BX)(h.Z,{display:"flex",children:[(0,D.BX)(h.Z,{display:"flex",gap:1,flexWrap:"wrap",flexGrow:1,children:[(0,D.tZ)(bt,{}),(0,D.tZ)(rd,{}),(0,D.tZ)(od,{}),(0,D.tZ)(md,{}),(0,D.tZ)(rt,{}),(0,D.tZ)(fd,{})]}),!!t&&(0,D.tZ)(k.Z,{onClick:t})]}),(0,D.BX)(h.Z,{display:"flex",gap:1,flexWrap:"wrap",children:[s&&(0,D.tZ)(q.Z,{level:s.level,ascension:s.ascension,setBoth:g}),(0,D.tZ)(V,{size:"small"}),(0,D.tZ)(W,{}),(0,D.tZ)(F,{size:"small"})]}),(0,D.tZ)(w.Z,{children:(0,D.tZ)(pd,{tab:m})}),(0,D.tZ)(Zd,{}),(0,D.tZ)(w.Z,{children:(0,D.tZ)(pd,{tab:m})})]})})})})}):(0,D.tZ)(Z.Z,{variant:"rectangular",width:"100%",height:1e3})})}function Zd(){return(0,D.tZ)(x.Suspense,{fallback:(0,D.tZ)(Z.Z,{variant:"rectangular",width:"100%",height:500}),children:(0,D.BX)(y.Z5,{children:[(0,D.tZ)(y.AW,{index:!0,element:(0,D.tZ)(Us,{})}),(0,D.tZ)(y.AW,{path:"/talent",element:(0,D.tZ)(ro,{})}),(0,D.tZ)(y.AW,{path:"/teambuffs",element:(0,D.tZ)(po,{})}),(0,D.tZ)(y.AW,{path:"/optimize",element:(0,D.tZ)(Xr,{})}),(0,D.tZ)(y.AW,{path:"/theorycraft",element:(0,D.tZ)(Sc,{})}),re.dG&&(0,D.tZ)(y.AW,{path:"/upopt",element:(0,D.tZ)(ad,{})})]})})}function pd({tab:e}){const{t}=(0,b.$G)("page_character"),a=re.dG?{minWidth:"16.6%"}:{minWidth:"20%"};return(0,D.BX)(m.Z,{value:e,variant:"scrollable",allowScrollButtonsMobile:!0,sx:{"& .MuiTab-root:hover":{transition:"background-color 0.25s ease",backgroundColor:"rgba(255,255,255,0.1)"}},children:[(0,D.tZ)(f.Z,{sx:a,value:"overview",label:t("tabs.overview"),icon:(0,D.tZ)(r.Z,{}),component:v.rU,to:""}),(0,D.tZ)(f.Z,{sx:a,value:"talent",label:t("tabs.talent"),icon:(0,D.tZ)(l.Z,{}),component:v.rU,to:"talent"}),(0,D.tZ)(f.Z,{sx:a,value:"teambuffs",label:t("tabs.teambuffs"),icon:(0,D.tZ)(s.Z,{}),component:v.rU,to:"teambuffs"}),(0,D.tZ)(f.Z,{sx:a,value:"optimize",label:t("tabs.optimize"),icon:(0,D.tZ)(o.Z,{}),component:v.rU,to:"optimize"}),(0,D.tZ)(f.Z,{sx:a,value:"theorycraft",label:t("tabs.theorycraft"),icon:(0,D.tZ)(c.Z,{}),component:v.rU,to:"theorycraft"}),re.dG&&(0,D.tZ)(f.Z,{sx:a,value:"upopt",label:t("tabs.upgradeopt"),icon:(0,D.tZ)(o.Z,{}),component:v.rU,to:"upopt"})]})}function md(){const{t:e}=(0,b.$G)("page_character"),[t,a,i]=(0,n.aV)(),{character:{bonusStats:r}}=(0,x.useContext)(T.K),l=Object.keys(r).length;return(0,D.BX)(D.HY,{children:[(0,D.BX)(g.Z,{color:"info",startIcon:(0,D.tZ)(d.Z,{}),onClick:a,children:[e(cd||(cd=dd`addStats.title`)),!!l&&(0,D.tZ)(M.Z,{sx:{ml:1},color:"success",children:l})]}),(0,D.tZ)(Ht,{open:t,onClose:i})]})}function fd(){const{onModalOpen:e}=(0,x.useContext)(H.M);return(0,D.BX)(D.HY,{children:[(0,D.BX)(g.Z,{color:"info",startIcon:(0,D.tZ)(u.Z,{}),onClick:e,children:["Formulas ","&"," Calcs"]}),(0,D.tZ)(Ct,{})]})}}}]);