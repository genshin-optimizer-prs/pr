import{a as ne,g as oe,s as T,_ as k,r as f,u as se,ac as jt,ad as Lt,e as ie,U as _e,ae as Ot,af as Kt,j as w,f as H,h as le,ag as Ve,P as Wt,ah as Vt,ai as qt,aj as De,b as j,ak as Te,al as Gt,l as Ut,d as Ht,q as g,n,H as M,E as S,m as _,am as $e,N as I,an as Ft,Z as lt,ao as qe,X as K,L,G as z,ap as Jt,$ as Ie,F as ce,aq as Xt,ar as Qt,i as de,k as ue,as as ct,at as F,au as E,av as te,Y as re,S as Yt,aw as Zt,a2 as ze,ax as er,ay as tr,y as Ge,C as Ue,B as rr,az as dt,aA as ut,aB as he,aC as ar,ab as pt,V as ft,aD as nr,I as or,W as sr,aE as ir,aF as He,p as lr,aG as Ee,aH as mt,aI as cr,aJ as Fe,aK as dr,aL as ur,aM as pr,aN as fr,aO as mr,aP as hr,aQ as Je}from"./index-hSj3xyiV.js";import{d as gr,b as br,u as ht,S as we,C as vr,a as xr}from"./CharacterEditor-DB1M-B-F.js";import{u as yr,C as Cr}from"./useForceUpdate-CQK1tAy7.js";import{s as kr,t as Sr,w as $r,c as wr,l as Mr,r as Rr,a as _r,d as Dr}from"./index-CUQaFPlG.js";import{u as Tr}from"./useLightCone-ClRj-H7k.js";import{T as gt,d as Ir,M as ye,D as Ce}from"./DropdownButton-CFzuXPEg.js";import{G as zr,d as bt}from"./LocationAutocomplete-CrFEZFzu.js";import{C as vt}from"./CardActionArea-CIhSXMHi.js";import{u as Er,R as Pr,b as Ar,D as Br}from"./RelicCard-C_zJMAk0.js";import{I as Nr}from"./InfoTooltip-c1Wk3ydG.js";function jr(e){return ne("MuiCollapse",e)}oe("MuiCollapse",["root","horizontal","vertical","entered","hidden","wrapper","wrapperInner"]);const Lr=["addEndListener","children","className","collapsedSize","component","easing","in","onEnter","onEntered","onEntering","onExit","onExited","onExiting","orientation","style","timeout","TransitionComponent"],Or=e=>{const{orientation:t,classes:r}=e,a={root:["root",`${t}`],entered:["entered"],hidden:["hidden"],wrapper:["wrapper",`${t}`],wrapperInner:["wrapperInner",`${t}`]};return le(a,jr,r)},Kr=T("div",{name:"MuiCollapse",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:r}=e;return[t.root,t[r.orientation],r.state==="entered"&&t.entered,r.state==="exited"&&!r.in&&r.collapsedSize==="0px"&&t.hidden]}})(({theme:e,ownerState:t})=>k({height:0,overflow:"hidden",transition:e.transitions.create("height")},t.orientation==="horizontal"&&{height:"auto",width:0,transition:e.transitions.create("width")},t.state==="entered"&&k({height:"auto",overflow:"visible"},t.orientation==="horizontal"&&{width:"auto"}),t.state==="exited"&&!t.in&&t.collapsedSize==="0px"&&{visibility:"hidden"})),Wr=T("div",{name:"MuiCollapse",slot:"Wrapper",overridesResolver:(e,t)=>t.wrapper})(({ownerState:e})=>k({display:"flex",width:"100%"},e.orientation==="horizontal"&&{width:"auto",height:"100%"})),Vr=T("div",{name:"MuiCollapse",slot:"WrapperInner",overridesResolver:(e,t)=>t.wrapperInner})(({ownerState:e})=>k({width:"100%"},e.orientation==="horizontal"&&{width:"auto",height:"100%"})),xt=f.forwardRef(function(t,r){const a=se({props:t,name:"MuiCollapse"}),{addEndListener:o,children:s,className:i,collapsedSize:u="0px",component:c,easing:d,in:p,onEnter:l,onEntered:m,onEntering:h,onExit:b,onExited:v,onExiting:C,orientation:$="vertical",style:R,timeout:y=jt.standard,TransitionComponent:P=Lt}=a,X=ie(a,Lr),W=k({},a,{orientation:$,collapsedSize:u}),A=Or(W),Q=_e(),ke=Ot(),B=f.useRef(null),Y=f.useRef(),V=typeof u=="number"?`${u}px`:u,O=$==="horizontal",Z=O?"width":"height",fe=f.useRef(null),Tt=Kt(r,fe),q=x=>D=>{if(x){const N=fe.current;D===void 0?x(N):x(N,D)}},Se=()=>B.current?B.current[O?"clientWidth":"clientHeight"]:0,It=q((x,D)=>{B.current&&O&&(B.current.style.position="absolute"),x.style[Z]=V,l&&l(x,D)}),zt=q((x,D)=>{const N=Se();B.current&&O&&(B.current.style.position="");const{duration:ee,easing:me}=Ve({style:R,timeout:y,easing:d},{mode:"enter"});if(y==="auto"){const We=Q.transitions.getAutoHeightDuration(N);x.style.transitionDuration=`${We}ms`,Y.current=We}else x.style.transitionDuration=typeof ee=="string"?ee:`${ee}ms`;x.style[Z]=`${N}px`,x.style.transitionTimingFunction=me,h&&h(x,D)}),Et=q((x,D)=>{x.style[Z]="auto",m&&m(x,D)}),Pt=q(x=>{x.style[Z]=`${Se()}px`,b&&b(x)}),At=q(v),Bt=q(x=>{const D=Se(),{duration:N,easing:ee}=Ve({style:R,timeout:y,easing:d},{mode:"exit"});if(y==="auto"){const me=Q.transitions.getAutoHeightDuration(D);x.style.transitionDuration=`${me}ms`,Y.current=me}else x.style.transitionDuration=typeof N=="string"?N:`${N}ms`;x.style[Z]=V,x.style.transitionTimingFunction=ee,C&&C(x)}),Nt=x=>{y==="auto"&&ke.start(Y.current||0,x),o&&o(fe.current,x)};return w.jsx(P,k({in:p,onEnter:It,onEntered:Et,onEntering:zt,onExit:Pt,onExited:At,onExiting:Bt,addEndListener:Nt,nodeRef:fe,timeout:y==="auto"?null:y},X,{children:(x,D)=>w.jsx(Kr,k({as:c,className:H(A.root,i,{entered:A.entered,exited:!p&&V==="0px"&&A.hidden}[x]),style:k({[O?"minWidth":"minHeight"]:V},R),ref:Tt},D,{ownerState:k({},W,{state:x}),children:w.jsx(Wr,{ownerState:k({},W,{state:x}),className:A.wrapper,ref:B,children:w.jsx(Vr,{ownerState:k({},W,{state:x}),className:A.wrapperInner,children:s})})}))}))});xt.muiSupportAuto=!0;const yt=xt,qr=f.createContext({}),Ct=qr;function Gr(e){return ne("MuiAccordion",e)}const Ur=oe("MuiAccordion",["root","rounded","expanded","disabled","gutters","region"]),ge=Ur,Hr=["children","className","defaultExpanded","disabled","disableGutters","expanded","onChange","square","slots","slotProps","TransitionComponent","TransitionProps"],Fr=e=>{const{classes:t,square:r,expanded:a,disabled:o,disableGutters:s}=e;return le({root:["root",!r&&"rounded",a&&"expanded",o&&"disabled",!s&&"gutters"],region:["region"]},Gr,t)},Jr=T(Wt,{name:"MuiAccordion",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:r}=e;return[{[`& .${ge.region}`]:t.region},t.root,!r.square&&t.rounded,!r.disableGutters&&t.gutters]}})(({theme:e})=>{const t={duration:e.transitions.duration.shortest};return{position:"relative",transition:e.transitions.create(["margin"],t),overflowAnchor:"none","&::before":{position:"absolute",left:0,top:-1,right:0,height:1,content:'""',opacity:1,backgroundColor:(e.vars||e).palette.divider,transition:e.transitions.create(["opacity","background-color"],t)},"&:first-of-type":{"&::before":{display:"none"}},[`&.${ge.expanded}`]:{"&::before":{opacity:0},"&:first-of-type":{marginTop:0},"&:last-of-type":{marginBottom:0},"& + &":{"&::before":{display:"none"}}},[`&.${ge.disabled}`]:{backgroundColor:(e.vars||e).palette.action.disabledBackground}}},({theme:e})=>({variants:[{props:t=>!t.square,style:{borderRadius:0,"&:first-of-type":{borderTopLeftRadius:(e.vars||e).shape.borderRadius,borderTopRightRadius:(e.vars||e).shape.borderRadius},"&:last-of-type":{borderBottomLeftRadius:(e.vars||e).shape.borderRadius,borderBottomRightRadius:(e.vars||e).shape.borderRadius,"@supports (-ms-ime-align: auto)":{borderBottomLeftRadius:0,borderBottomRightRadius:0}}}},{props:t=>!t.disableGutters,style:{[`&.${ge.expanded}`]:{margin:"16px 0"}}}]})),Xr=f.forwardRef(function(t,r){const a=se({props:t,name:"MuiAccordion"}),{children:o,className:s,defaultExpanded:i=!1,disabled:u=!1,disableGutters:c=!1,expanded:d,onChange:p,square:l=!1,slots:m={},slotProps:h={},TransitionComponent:b,TransitionProps:v}=a,C=ie(a,Hr),[$,R]=Vt({controlled:d,default:i,name:"Accordion",state:"expanded"}),y=f.useCallback(O=>{R(!$),p&&p(O,!$)},[$,p,R]),[P,...X]=f.Children.toArray(o),W=f.useMemo(()=>({expanded:$,disabled:u,disableGutters:c,toggle:y}),[$,u,c,y]),A=k({},a,{square:l,disabled:u,disableGutters:c,expanded:$}),Q=Fr(A),ke=k({transition:b},m),B=k({transition:v},h),[Y,V]=Er("transition",{elementType:yt,externalForwardedProps:{slots:ke,slotProps:B},ownerState:A});return w.jsxs(Jr,k({className:H(Q.root,s),ref:r,ownerState:A,square:l},C,{children:[w.jsx(Ct.Provider,{value:W,children:P}),w.jsx(Y,k({in:$,timeout:"auto"},V,{children:w.jsx("div",{"aria-labelledby":P.props.id,id:P.props["aria-controls"],role:"region",className:Q.region,children:X})}))]}))}),Xe=Xr;function Qr(e){return ne("MuiAccordionDetails",e)}oe("MuiAccordionDetails",["root"]);const Yr=["className"],Zr=e=>{const{classes:t}=e;return le({root:["root"]},Qr,t)},ea=T("div",{name:"MuiAccordionDetails",slot:"Root",overridesResolver:(e,t)=>t.root})(({theme:e})=>({padding:e.spacing(1,2,2)})),ta=f.forwardRef(function(t,r){const a=se({props:t,name:"MuiAccordionDetails"}),{className:o}=a,s=ie(a,Yr),i=a,u=Zr(i);return w.jsx(ea,k({className:H(u.root,o),ref:r,ownerState:i},s))}),Qe=ta;function ra(e){return ne("MuiAccordionSummary",e)}const aa=oe("MuiAccordionSummary",["root","expanded","focusVisible","disabled","gutters","contentGutters","content","expandIconWrapper"]),G=aa,na=["children","className","expandIcon","focusVisibleClassName","onClick"],oa=e=>{const{classes:t,expanded:r,disabled:a,disableGutters:o}=e;return le({root:["root",r&&"expanded",a&&"disabled",!o&&"gutters"],focusVisible:["focusVisible"],content:["content",r&&"expanded",!o&&"contentGutters"],expandIconWrapper:["expandIconWrapper",r&&"expanded"]},ra,t)},sa=T(qt,{name:"MuiAccordionSummary",slot:"Root",overridesResolver:(e,t)=>t.root})(({theme:e})=>{const t={duration:e.transitions.duration.shortest};return{display:"flex",minHeight:48,padding:e.spacing(0,2),transition:e.transitions.create(["min-height","background-color"],t),[`&.${G.focusVisible}`]:{backgroundColor:(e.vars||e).palette.action.focus},[`&.${G.disabled}`]:{opacity:(e.vars||e).palette.action.disabledOpacity},[`&:hover:not(.${G.disabled})`]:{cursor:"pointer"},variants:[{props:r=>!r.disableGutters,style:{[`&.${G.expanded}`]:{minHeight:64}}}]}}),ia=T("div",{name:"MuiAccordionSummary",slot:"Content",overridesResolver:(e,t)=>t.content})(({theme:e})=>({display:"flex",flexGrow:1,margin:"12px 0",variants:[{props:t=>!t.disableGutters,style:{transition:e.transitions.create(["margin"],{duration:e.transitions.duration.shortest}),[`&.${G.expanded}`]:{margin:"20px 0"}}}]})),la=T("div",{name:"MuiAccordionSummary",slot:"ExpandIconWrapper",overridesResolver:(e,t)=>t.expandIconWrapper})(({theme:e})=>({display:"flex",color:(e.vars||e).palette.action.active,transform:"rotate(0deg)",transition:e.transitions.create("transform",{duration:e.transitions.duration.shortest}),[`&.${G.expanded}`]:{transform:"rotate(180deg)"}})),ca=f.forwardRef(function(t,r){const a=se({props:t,name:"MuiAccordionSummary"}),{children:o,className:s,expandIcon:i,focusVisibleClassName:u,onClick:c}=a,d=ie(a,na),{disabled:p=!1,disableGutters:l,expanded:m,toggle:h}=f.useContext(Ct),b=$=>{h&&h($),c&&c($)},v=k({},a,{expanded:m,disabled:p,disableGutters:l}),C=oa(v);return w.jsxs(sa,k({focusRipple:!1,disableRipple:!0,disabled:p,component:"div","aria-expanded":m,className:H(C.root,s),focusVisibleClassName:H(C.focusVisible,u),onClick:b,ref:r,ownerState:v},d,{children:[w.jsx(ia,{className:C.content,ownerState:v,children:o}),i&&w.jsx(la,{className:C.expandIconWrapper,ownerState:v,children:i})]}))}),Ye=ca;function da(e){return ne("MuiLinearProgress",e)}oe("MuiLinearProgress",["root","colorPrimary","colorSecondary","determinate","indeterminate","buffer","query","dashed","dashedColorPrimary","dashedColorSecondary","bar","barColorPrimary","barColorSecondary","bar1Indeterminate","bar1Determinate","bar1Buffer","bar2Indeterminate","bar2Buffer"]);const ua=["className","color","value","valueBuffer","variant"];let J=e=>e,Ze,et,tt,rt,at,nt;const Me=4,pa=De(Ze||(Ze=J`
  0% {
    left: -35%;
    right: 100%;
  }

  60% {
    left: 100%;
    right: -90%;
  }

  100% {
    left: 100%;
    right: -90%;
  }
`)),fa=De(et||(et=J`
  0% {
    left: -200%;
    right: 100%;
  }

  60% {
    left: 107%;
    right: -8%;
  }

  100% {
    left: 107%;
    right: -8%;
  }
`)),ma=De(tt||(tt=J`
  0% {
    opacity: 1;
    background-position: 0 -23px;
  }

  60% {
    opacity: 0;
    background-position: 0 -23px;
  }

  100% {
    opacity: 1;
    background-position: -200px -23px;
  }
`)),ha=e=>{const{classes:t,variant:r,color:a}=e,o={root:["root",`color${j(a)}`,r],dashed:["dashed",`dashedColor${j(a)}`],bar1:["bar",`barColor${j(a)}`,(r==="indeterminate"||r==="query")&&"bar1Indeterminate",r==="determinate"&&"bar1Determinate",r==="buffer"&&"bar1Buffer"],bar2:["bar",r!=="buffer"&&`barColor${j(a)}`,r==="buffer"&&`color${j(a)}`,(r==="indeterminate"||r==="query")&&"bar2Indeterminate",r==="buffer"&&"bar2Buffer"]};return le(o,da,t)},Pe=(e,t)=>t==="inherit"?"currentColor":e.vars?e.vars.palette.LinearProgress[`${t}Bg`]:e.palette.mode==="light"?Ut(e.palette[t].main,.62):Ht(e.palette[t].main,.5),ga=T("span",{name:"MuiLinearProgress",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:r}=e;return[t.root,t[`color${j(r.color)}`],t[r.variant]]}})(({ownerState:e,theme:t})=>k({position:"relative",overflow:"hidden",display:"block",height:4,zIndex:0,"@media print":{colorAdjust:"exact"},backgroundColor:Pe(t,e.color)},e.color==="inherit"&&e.variant!=="buffer"&&{backgroundColor:"none","&::before":{content:'""',position:"absolute",left:0,top:0,right:0,bottom:0,backgroundColor:"currentColor",opacity:.3}},e.variant==="buffer"&&{backgroundColor:"transparent"},e.variant==="query"&&{transform:"rotate(180deg)"})),ba=T("span",{name:"MuiLinearProgress",slot:"Dashed",overridesResolver:(e,t)=>{const{ownerState:r}=e;return[t.dashed,t[`dashedColor${j(r.color)}`]]}})(({ownerState:e,theme:t})=>{const r=Pe(t,e.color);return k({position:"absolute",marginTop:0,height:"100%",width:"100%"},e.color==="inherit"&&{opacity:.3},{backgroundImage:`radial-gradient(${r} 0%, ${r} 16%, transparent 42%)`,backgroundSize:"10px 10px",backgroundPosition:"0 -23px"})},Te(rt||(rt=J`
    animation: ${0} 3s infinite linear;
  `),ma)),va=T("span",{name:"MuiLinearProgress",slot:"Bar1",overridesResolver:(e,t)=>{const{ownerState:r}=e;return[t.bar,t[`barColor${j(r.color)}`],(r.variant==="indeterminate"||r.variant==="query")&&t.bar1Indeterminate,r.variant==="determinate"&&t.bar1Determinate,r.variant==="buffer"&&t.bar1Buffer]}})(({ownerState:e,theme:t})=>k({width:"100%",position:"absolute",left:0,bottom:0,top:0,transition:"transform 0.2s linear",transformOrigin:"left",backgroundColor:e.color==="inherit"?"currentColor":(t.vars||t).palette[e.color].main},e.variant==="determinate"&&{transition:`transform .${Me}s linear`},e.variant==="buffer"&&{zIndex:1,transition:`transform .${Me}s linear`}),({ownerState:e})=>(e.variant==="indeterminate"||e.variant==="query")&&Te(at||(at=J`
      width: auto;
      animation: ${0} 2.1s cubic-bezier(0.65, 0.815, 0.735, 0.395) infinite;
    `),pa)),xa=T("span",{name:"MuiLinearProgress",slot:"Bar2",overridesResolver:(e,t)=>{const{ownerState:r}=e;return[t.bar,t[`barColor${j(r.color)}`],(r.variant==="indeterminate"||r.variant==="query")&&t.bar2Indeterminate,r.variant==="buffer"&&t.bar2Buffer]}})(({ownerState:e,theme:t})=>k({width:"100%",position:"absolute",left:0,bottom:0,top:0,transition:"transform 0.2s linear",transformOrigin:"left"},e.variant!=="buffer"&&{backgroundColor:e.color==="inherit"?"currentColor":(t.vars||t).palette[e.color].main},e.color==="inherit"&&{opacity:.3},e.variant==="buffer"&&{backgroundColor:Pe(t,e.color),transition:`transform .${Me}s linear`}),({ownerState:e})=>(e.variant==="indeterminate"||e.variant==="query")&&Te(nt||(nt=J`
      width: auto;
      animation: ${0} 2.1s cubic-bezier(0.165, 0.84, 0.44, 1) 1.15s infinite;
    `),fa)),ya=f.forwardRef(function(t,r){const a=se({props:t,name:"MuiLinearProgress"}),{className:o,color:s="primary",value:i,valueBuffer:u,variant:c="indeterminate"}=a,d=ie(a,ua),p=k({},a,{color:s,variant:c}),l=ha(p),m=Gt(),h={},b={bar1:{},bar2:{}};if((c==="determinate"||c==="buffer")&&i!==void 0){h["aria-valuenow"]=Math.round(i),h["aria-valuemin"]=0,h["aria-valuemax"]=100;let v=i-100;m&&(v=-v),b.bar1.transform=`translateX(${v}%)`}if(c==="buffer"&&u!==void 0){let v=(u||0)-100;m&&(v=-v),b.bar2.transform=`translateX(${v}%)`}return w.jsxs(ga,k({className:H(l.root,o),ownerState:p,role:"progressbar"},h,{ref:r},d,{children:[c==="buffer"?w.jsx(ba,{className:l.dashed,ownerState:p}):null,w.jsx(va,{className:l.bar1,ownerState:p,style:b.bar1}),c==="determinate"?null:w.jsx(xa,{className:l.bar2,ownerState:p,style:b.bar2})]}))}),Ca=ya;function ka({avatar:e,title:t,action:r}){return g(S,{display:"flex",gap:1,p:2,alignItems:"center",children:[e,n(M,{variant:"subtitle1",sx:{flexGrow:1},children:t}),r&&n(M,{variant:"caption",children:r})]})}function Sa({condition:e,wrapper:t,falseWrapper:r,children:a}){return e?t(a):r?r(a):a}function $a({value:e,onChange:t,float:r=!1,...a}){const[o,s]=f.useState(e==null?void 0:e.toString()),{min:i,max:u}=(a==null?void 0:a.inputProps)??{};f.useEffect(()=>{s(e==null?void 0:e.toString())},[e]);const c=()=>{const l=r?parseFloat(o):parseInt(o);if(i!==void 0&&l<i){t(i),s(i.toString());return}if(u!==void 0&&l>u){t(u),s(u.toString());return}t(l)},d=l=>{const m=l.target.value;if(m.match(r?/[^0-9.-]/:/[^0-9-]/))return l.preventDefault();s(m)},p=l=>{l.target.select()};return n(gt,{value:o==null?void 0:o.toString(),onChange:d,onBlur:c,onFocus:p,onKeyDown:l=>l.key==="Enter"&&!a.multiline&&c(),...a,inputProps:{inputMode:"numeric",...a.inputProps??{}}})}function ot({value:e,onChange:t,...r}){const[a,o]=f.useState(e);f.useEffect(()=>{o(e)},[e]);const s=()=>t(a);return n(gt,{value:a,onChange:i=>o(i.target.value),onBlur:s,onKeyDown:i=>i.key==="Enter"&&!r.multiline&&s(),...r})}function wa(e){const{t}=_("ui"),r=$e({path:"/:page/*"}),a=t("pageTitle"),o=e??((r==null?void 0:r.params.page)&&t(`tabs.${r==null?void 0:r.params.page}`));f.useEffect(()=>{o?document.title=`${o} - ${a}`:document.title=a},[t,a,o])}function Ae(e,t){const[r,a]=yr(),o=f.useMemo(()=>r&&e.get(t),[r,e,t]);return f.useEffect(()=>e.follow(t,a),[e,t,a]),o}function Ma(e){const{database:t}=I();return Ae(t.builds,e??"")}function kt(e){const t=f.useMemo(()=>e||Ft(lt,()=>""),[e]),{database:r}=I(),[a,o]=f.useState(()=>qe(t,s=>r.relics.get(s)));return f.useEffect(()=>{o(qe(t,i=>r.relics.get(i)));const s=Object.values(t).map(i=>r.relics.follow(i,(u,c,d)=>{c==="update"&&o(p=>({...p,[d.slotKey]:d})),c==="remove"&&o(p=>({...p,[d.slotKey]:void 0}))}));return()=>s.forEach(i=>i())},[r,t]),a}function U(e){const{database:t}=I();return Ae(t.loadouts,e??"")}function St(e){const{database:t}=I();return Ae(t.teams,e)}function Ra({slot:e}){const{t}=_("relic");return n(L,{sx:{height:"100%"},children:g(K,{children:[g(M,{children:[t("slot"),": ",e]}),n(M,{children:t("empty")})]})})}function _a({build:e}){const t=kt(e);return n(z,{container:!0,columns:3,spacing:1,children:lt.map(r=>{const a=t[r];return n(z,{item:!0,xs:1,children:a?n(Pr,{relic:a}):n(Ra,{slot:r})},`${r}_${a==null?void 0:a.id}`)})})}function Da({charKey:e,setCharKey:t}){const{t:r}=_(["character","charNames_gen"]),{database:a}=I(),o=f.useCallback(u=>!!a.chars.get(u),[a.chars]),s=f.useCallback(u=>a.charMeta.get(u).favorite,[a.charMeta]),i=f.useMemo(()=>[{key:"",label:r("character:autocomplete.none")},...Jt.map(u=>({key:u,label:r(`charNames_gen:${u}`),favorite:s(u),color:o(u)?void 0:"secondary"}))],[o,s,r]);return n(f.Suspense,{fallback:n(Ie,{variant:"text",width:100}),children:n(zr,{options:i,toImg:()=>n(ce,{children:" "}),valueKey:e,onChange:u=>t(u??"")})})}const Ta={Arlan:Xt,RuanMei:Qt};var Be={},Ia=ue;Object.defineProperty(Be,"__esModule",{value:!0});var xe=Be.default=void 0,za=Ia(de()),Ea=w,Pa=(0,za.default)((0,Ea.jsx)("path",{d:"M12 12.75c1.63 0 3.07.39 4.24.9 1.08.48 1.76 1.56 1.76 2.73V18H6v-1.61c0-1.18.68-2.26 1.76-2.73 1.17-.52 2.61-.91 4.24-.91zM4 13c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2zm1.13 1.1c-.37-.06-.74-.1-1.13-.1-.99 0-1.93.21-2.78.58C.48 14.9 0 15.62 0 16.43V18h4.5v-1.61c0-.83.23-1.61.63-2.29zM20 13c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2zm4 3.43c0-.81-.48-1.53-1.22-1.85-.85-.37-1.79-.58-2.78-.58-.39 0-.76.04-1.13.1.4.68.63 1.46.63 2.29V18H24v-1.57zM12 6c1.66 0 3 1.34 3 3s-1.34 3-3 3-3-1.34-3-3 1.34-3 3-3z"}),"Groups");xe=Be.default=Pa;function Aa({document:e,bgt:t="normal",collapse:r=!1,setConditional:a}){switch(e.type){case"fields":return n(Ba,{fieldsDocument:e,bgt:t});case"text":return r?n(Na,{textDocument:e}):n($t,{textDocument:e});case"conditional":return n(ja,{conditional:e.conditional,setConditional:a,bgt:t});default:return null}}function Ba({fieldsDocument:e,bgt:t="normal"}){return g(L,{bgt:t,children:[e.header&&n(wt,{header:e.header,hideDivider:e.fields.length===0}),n(ct,{bgt:t,fields:e.fields})]})}function $t({textDocument:e}){const t=f.useContext(F);return t?n("div",{children:E(e.text,t)}):null}function Na({textDocument:e}){const[t,r]=f.useState(!1),[a,o]=f.useState(!1);return g(S,{sx:{position:"relative"},children:[!t&&n(S,{sx:{pointerEvents:"none",position:"absolute",mx:"auto",width:"100%",display:"flex",justifyContent:"center",height:"100%",alignItems:"flex-end",zIndex:"10",transition:"transform 0.3s ease",transform:a?"translate(0,-5px)":void 0},children:n(Ir,{})}),n(yt,{onMouseEnter:()=>o(!0),onMouseLeave:()=>o(!1),collapsedSize:55,onClick:()=>r(s=>!s),in:t,sx:{cursor:"pointer",position:"relative",maskImage:t?void 0:"linear-gradient(to bottom, black 0%, transparent 100%)","&:hover":{maskImage:t?void 0:"linear-gradient(to bottom, black 50%, transparent 100%)"}},children:n($t,{textDocument:e})})]})}function wt({header:e,hideDivider:t}){const{icon:r,text:a,additional:o}=e;return g(ce,{children:[n(ka,{avatar:r,title:a,action:o}),!t&&n(te,{})]})}function ja({conditional:e,bgt:t="normal",setConditional:r}){const{header:a,fields:o}=e;return g(L,{bgt:t,children:[!!a&&n(wt,{header:a}),n(La,{conditional:e,setConditional:r}),!!o&&n(ct,{bgt:t,fields:o})]})}function La({conditional:e,setConditional:t}){switch(e.metadata.type){case"bool":return n(Oa,{conditional:e,setConditional:t});case"list":return n(Ka,{conditional:e,setConditional:t});case"num":return n(Wa,{conditional:e,setConditional:t});default:return null}}function ae({children:e}){return e?n(Yt,{sx:{ml:1},children:e}):null}function Ne(e,t,r,a){return e.compute(Zt({et:"own",qt:"cond",sheet:t,q:r,src:a,dst:e.cache.tag.src},"max")).val}function Oa({conditional:e,setConditional:t}){const r=f.useContext(F),{label:a,badge:o}=e,{sheet:s,name:i}=e.metadata;if(!s||!i)throw new Error("metadata missing");if(!r)return null;const u="all",c=Ne(r,s,i,u),d=E(a,r,c),p=E(o,r,c);return g(re,{fullWidth:!0,size:"small",sx:{borderRadius:0},color:c?"success":"primary",onClick:()=>t(u,s,i,+!c),startIcon:c?n(gr,{}):n(br,{}),children:[d," ",n(ae,{children:p})]})}function Ka({conditional:e,setConditional:t}){const r=f.useContext(F),{label:a,badge:o}=e,{sheet:s,name:i,list:u}=e.metadata;if(!s||!i)throw new Error("metadata missing");if(!r)return null;const c="all",d=Ne(r,s,i,c);return g(Ce,{fullWidth:!0,size:"small",sx:{borderRadius:0},color:d?"success":"primary",title:g(ce,{children:[E(a,r,d)," ",n(ae,{children:E(o,r,d)})]}),children:[n(te,{}),["0",...u].map((p,l)=>g(ye,{onClick:()=>t(c,s,i,l),selected:d===l,disabled:d===l,children:[E(a,r,l),n(ae,{children:E(o,r,l)})]},p))]})}function Wa({conditional:e,setConditional:t}){const r=f.useContext(F),{label:a,badge:o}=e,{sheet:s,name:i,int_only:u,min:c,max:d}=e.metadata;if(!s||!i)throw new Error("metadata missing");if(!r)return null;const p="all",l=Ne(r,s,i,p),m=E(a,r,l),h=E(o,r,l);return typeof c>"u"||typeof d>"u"?n($a,{fullWidth:!0,float:!u,inputProps:{min:c,max:d},InputProps:{startAdornment:m&&n(S,{sx:{mr:1},children:m}),endAdornment:n(ae,{children:E(o,r,l)})},value:l,onChange:b=>t(p,s,i,b)}):g(S,{sx:{px:2},children:[(m||o)&&g(M,{display:"flex",justifyContent:"space-between",children:[m," ",n(ae,{children:h})]}),n(Va,{max:d,min:c,value:l,onChangeCommitted:(b,v)=>t(p,s,i,v),valueLabelDisplay:"auto"})]})}function Va(e){const[t,r]=f.useState(e.value);return n(Ar,{...e,onChange:(a,o)=>r(o),value:t})}function pe(){return f.useContext(F)}function Mt({optTarget:e,setOptTarget:t}){const{t:r}=_("optimize"),a=pe();return n(Ce,{title:`${r("optTarget")}${e?`: ${e.tag.name||e.tag.q}`:""}`,children:a==null?void 0:a.listFormulas(ze.listing.formulas).map((o,s)=>n(ye,{onClick:()=>t(o),children:o.tag.name||o.tag.q},`${s}_${o.tag.name||o.tag.q}`))})}function qa({statFilters:e,setStatFilters:t,disabled:r=!1}){const a=f.useCallback((c,d,p)=>{const l={...e},m=JSON.stringify(d),h=d?[...e[m]]:void 0,b=JSON.stringify(c),v=[...e[b]??[]];p!==void 0&&h?v.push(h[p]):v.push({minValue:0,maxValue:0,disabled:!1}),l[b]=v,p!==void 0&&h&&(h.splice(p,1),h.length?l[m]=h:delete l[m]),t({...l})},[t,e]),o=f.useCallback((c,d)=>{const p={...e},l=JSON.stringify(c),m=[...e[l]];m.splice(d,1),m.length?p[l]=m:delete p[l],t({...p})},[t,e]),s=f.useCallback((c,d,p)=>{const l={...e},m=JSON.stringify(c),h=[...e[m]];h[d]={...h[d],minValue:p},l[m]=h,t({...l})},[t,e]),i=f.useCallback((c,d,p)=>{const l={...e},m=JSON.stringify(c),h=[...e[m]];h[d]={...h[d],maxValue:p},l[m]=h,t({...l})},[t,e]),u=f.useCallback((c,d,p)=>{const l={...e},m=JSON.stringify(c),h=[...e[m]];h[d]={...h[d],disabled:p},l[m]=h,t({...l})},[t,e]);return g(ce,{children:[Object.entries(e).flatMap(([c,d])=>d==null?void 0:d.map((p,l)=>n(st,{path:JSON.parse(c),setting:p,index:l,setTarget:a,delTarget:o,setMinValue:s,setMaxValue:i,setDisabled:u,disabled:r},c+l))),n(st,{delTarget:o,setTarget:a,setMinValue:s,setMaxValue:i,setDisabled:u,disabled:r})]})}function st({path:e,setting:t,index:r,delTarget:a,setMinValue:o,setMaxValue:s,setDisabled:i,disabled:u}){const{t:c}=_("page_character_optimize"),d=f.useCallback(b=>e&&r!==void 0&&o(e,r,b??0),[o,e,r]),p=f.useCallback(b=>e&&r!==void 0&&s(e,r,b??1/0),[s,e,r]),[l,m]=f.useState(void 0),h={p:1,flexBasis:30,flexGrow:0,flexShrink:0};return g(rr,{sx:{"& .MuiButtonGroup-grouped":{minWidth:24},width:"100%"},children:[!!t&&!!e&&r!==void 0&&n(re,{sx:h,color:t.disabled?"secondary":"success",onClick:()=>i(e,r,!t.disabled),disabled:u,children:t.disabled?n(er,{}):n(tr,{})}),n(Ue,{sx:{flexBasis:150,flexGrow:1},children:n(Ge,{float:!0,disabled:!e||u,value:t==null?void 0:t.minValue,placeholder:c("buildConstraint.minStatValue"),onChange:d,sx:{px:1},inputProps:{sx:{"& + .MuiOutlinedInput-notchedOutline":{borderRadius:0},textAlign:"right"}}})}),n(Mt,{optTarget:l,setOptTarget:m}),n(Ue,{sx:{flexBasis:150,flexGrow:1},children:n(Ge,{float:!0,disabled:!e||u,value:t==null?void 0:t.maxValue,placeholder:c("buildConstraint.maxStatValue"),onChange:p,sx:{px:1},inputProps:{sx:{"& + .MuiOutlinedInput-notchedOutline":{borderRadius:0},textAlign:"left"}}})}),!!e&&r!==void 0&&n(re,{sx:h,color:"error",onClick:()=>a(e,r),disabled:u,children:n(Br,{fontSize:"small"})})]})}function Ga({disabled:e=!1}){const{t}=_("page_character_optimize"),[r,a]=f.useState({});return n(S,{children:g(L,{bgt:"light",children:[n(K,{sx:{display:"flex",gap:1,justifyContent:"space-between",flexDirection:"column"},children:g(S,{display:"flex",justifyContent:"space-between",children:[n(M,{sx:{fontWeight:"bold"},children:t`constraintFilter.title`}),n(Nr,{title:n(M,{children:t`constraintFilter.tooltip`})})]})}),n(te,{}),n(S,{display:"flex",flexDirection:"column",gap:.5,children:n(qa,{statFilters:r,setStatFilters:a,disabled:e})})]})})}function Ua({numWorkers:e,setNumWorkers:t}){const{t:r}=_("optimize"),a=navigator.hardwareConcurrency||8;return n(Ce,{title:`${r("numWorkers")}: ${e}`,children:dt(1,a).map(o=>n(ye,{onClick:()=>t(o),children:r("workers",{count:o})},o))})}function Ha({teamId:e,src:t,children:r}){var v,C,$,R;const a=St(e),o=U((v=a.loadoutMetadata[0])==null?void 0:v.loadoutId),s=U((C=a.loadoutMetadata[1])==null?void 0:C.loadoutId),i=U(($=a.loadoutMetadata[2])==null?void 0:$.loadoutId),u=U((R=a.loadoutMetadata[3])==null?void 0:R.loadoutId),c=f.useMemo(()=>{const y={all:"all"};return o&&(y[o.key]="0"),s&&(y[s.key]="1"),i&&(y[i.key]="2"),u&&(y[u.key]="3"),y},[o,s,i,u]),d=be(a.loadoutMetadata[0],c),p=be(a.loadoutMetadata[1],c),l=be(a.loadoutMetadata[2],c),m=be(a.loadoutMetadata[3],c),h=f.useMemo(()=>kr([...Sr(a.loadoutMetadata.map((y,P)=>y===void 0?void 0:ut[P]).filter(y=>!!y)),...d?ve(0,d):[],...p?ve(1,p):[],...l?ve(2,l):[],...m?ve(3,m):[],he.common.lvl.add(80),he.common.res.add(.1),he.common.isBroken.add(0),he.common.maxToughness.add(100),ar.common.critMode.add("avg")]),[d,p,l,m,a.loadoutMetadata]),b=f.useMemo(()=>(h==null?void 0:h.withTag({src:t}))??null,[h,t]);return n(F.Provider,{value:b,children:r})}function be(e,t){const r=U(e==null?void 0:e.loadoutId),a=ht(r==null?void 0:r.key),o=Ma(e==null?void 0:e.buildId),s=Tr(o==null?void 0:o.lightConeId),i=kt(o==null?void 0:o.relicIds),u=f.useMemo(()=>Object.fromEntries(Object.entries((r==null?void 0:r.conditional)??{}).map(([c,d])=>[t[c],d])),[r,t]);return f.useMemo(()=>({character:a,lightCone:s,relics:i,conditionals:u}),[a,s,u,i])}function ve(e,{character:t,lightCone:r,relics:a,conditionals:o}){return t?[...$r(`${e}`,...wr(t),...Mr(r),...Rr(Object.values(a).filter(s=>!!s).map(s=>({set:s.setKey,stats:[...s.substats.filter(({key:i})=>i!=="").map(i=>({key:i.key,value:i.accurateValue})),{key:s.mainStatKey,value:s.mainStatVal}]})))),..._r(`${e}`,o)]:[]}var je={},Fa=ue;Object.defineProperty(je,"__esModule",{value:!0});var Rt=je.default=void 0,Ja=Fa(de()),Xa=w,Qa=(0,Ja.default)((0,Xa.jsx)("path",{d:"M22 24H2v-4h20v4zM13.06 5.19l3.75 3.75L7.75 18H4v-3.75l9.06-9.06zm4.82 2.68-3.75-3.75 1.83-1.83c.39-.39 1.02-.39 1.41 0l2.34 2.34c.39.39.39 1.02 0 1.41l-1.83 1.83z"}),"BorderColor");Rt=je.default=Qa;var Le={},Ya=ue;Object.defineProperty(Le,"__esModule",{value:!0});var _t=Le.default=void 0,Za=Ya(de()),en=w,tn=(0,Za.default)((0,en.jsx)("path",{d:"M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"}),"Person");_t=Le.default=tn;function rn({teamId:e,charKey:t,tab:r=""}){const{t:a}=_("page_team"),o=pt(),{database:s}=I(),i=s.teams.get(e),{loadoutMetadata:u}=i,c=_e(),d=ft(c.breakpoints.down("md")),[p,l]=f.useState(!1),m=b=>{s.teams.set(e,{name:b})},h=b=>{s.teams.set(e,{description:b})};return g(S,{sx:()=>({borderBottom:"1px rgb(200,200,200,0.3) solid","& .MuiTab-root:hover":{transition:"background-color 0.25s ease",backgroundColor:"rgba(255,255,255,0.1)"},"& .Mui-selected":{color:"white !important"},"& .MuiTabs-indicator":{height:"4px",backgroundColor:"rgb(200,200,200,0.5)"}}),children:[n(vt,{onClick:()=>l(!0),children:n(nr,{placement:"top",title:g(S,{children:[g(S,{sx:{display:"flex",color:"info.light",gap:1},children:[n(Rt,{}),n(M,{children:n("strong",{children:a`team.editNameDesc`})})]}),!!i.description&&n(M,{children:i.description})]}),children:n(K,{sx:{display:"flex",justifyContent:"center","&:hover":{color:"info.light"}},children:g(M,{variant:"h5",sx:{display:"flex",gap:1,alignItems:"center",justifyContent:"center",textShadow:"#000 0 0 10px !important"},children:[n(xe,{}),i.name]})})})}),n(sr,{open:p,onClose:()=>l(!1),children:g(L,{children:[n(Cr,{title:a`team.editNameDesc`,avatar:n(xe,{}),titleTypographyProps:{variant:"h6"},action:n(or,{onClick:()=>l(!1),children:n(bt,{})})}),n(te,{}),n(K,{children:g(S,{display:"flex",flexDirection:"column",gap:2,sx:{mt:2},children:[n(ot,{label:a`team.name`,value:i.name,onChange:b=>m(b),autoFocus:!0}),n(ot,{label:a`team.desc`,value:i.description,onChange:b=>h(b),multiline:!0,minRows:4})]})})]})}),n(te,{}),g(ir,{variant:"fullWidth",value:t??"team",orientation:d?"vertical":"horizontal",children:[n(He,{icon:n(xe,{}),iconPosition:"start",value:"team",label:"Team Settings",onClick:()=>o(`/teams/${e}/`)}),u.map((b,v)=>{var $;const C=b&&(($=s.loadouts.get(b==null?void 0:b.loadoutId))==null?void 0:$.key);return n(He,{icon:n(_t,{}),iconPosition:"start",value:C??v,disabled:!u[v],label:C?n(M,{children:a(`charNames_gen:${C}`)}):`Character ${v+1}`,onClick:()=>C&&o(`/teams/${e}/${C}/${r}`)},v)})]})]})}function an({teamId:e}){const{database:t}=I(),r=t.teams.get(e);return g(S,{children:[e,r.loadoutMetadata.map((a,o)=>n(nn,{loadoutMetadataIndex:o,teamId:e},`${o}_${a==null?void 0:a.loadoutId}`))]})}function nn({loadoutMetadataIndex:e,teamId:t}){var u;const{database:r}=I(),a=r.teams.get(t),o=(u=a.loadoutMetadata[e])==null?void 0:u.loadoutId,s=r.loadouts.get(o);function i(c){if(c===""){r.teams.set(t,p=>p.loadoutMetadata[e]=void 0);return}r.chars.getOrCreate(c);const d=a.loadoutMetadata.findIndex(p=>{var l;return p&&((l=r.loadouts.get(p.loadoutId))==null?void 0:l.key)===c});if(d===-1){let p=r.loadouts.keys.find(l=>r.loadouts.get(l).key===c);p||(p=r.loadouts.new(c)),r.teams.set(t,l=>{l.loadoutMetadata[e]={loadoutId:p}})}else{if(d===e)return;const p=a.loadoutMetadata[d],l=a.loadoutMetadata[e];r.teams.set(t,m=>{m.loadoutMetadata[e]=p,m.loadoutMetadata[d]=l})}}return n(Da,{charKey:(s==null?void 0:s.key)??"",setCharKey:i})}var Oe={},on=ue;Object.defineProperty(Oe,"__esModule",{value:!0});var Re=Oe.default=void 0,sn=on(de()),ln=w,cn=(0,sn.default)((0,ln.jsx)("path",{d:"M16.59 8.59 12 13.17 7.41 8.59 6 10l6 6 6-6z"}),"ExpandMore");Re=Oe.default=cn;const dn=5e4;class un{constructor(t,r,a,o,s){this.calc=t,this.optTarget=r,this.relicsBySlot=a,this.numWorkers=o,this.setProgress=s,this.worker=new Worker(new URL(""+new URL("parentWorker-CAAYnoOP.js",import.meta.url).href,import.meta.url),{type:"module"})}async optimize(){return await new Promise((r,a)=>{this.worker.onmessage=({data:s})=>{switch(s.resultType){case"progress":this.setProgress(s.progress);break;case"done":r(s.buildResults);break;case"err":console.log(s),a();break}};const o={command:"start",relicsBySlot:this.relicsBySlot,detachedNodes:this.detachNodes(),numWorkers:this.numWorkers};this.worker.postMessage(o)})}async terminate(){const t={command:"terminate"};this.worker.postMessage(t),await new Promise((r,a)=>{this.worker.onmessage=({data:o})=>{switch(o.resultType){case"terminated":r();break;case"err":console.log(o),a();break}}}),this.worker.terminate()}detachNodes(){const t=new Set(lr);return Dr([this.optTarget],this.calc,a=>{if(a.src==="0"&&a.et==="own"){if(a.sheet==="dyn"&&a.qt==="premod")return{q:a.q};if(a.q==="count"&&t.has(a.sheet))return{q:a.sheet}}})}}var Ke={},pn=ue;Object.defineProperty(Ke,"__esModule",{value:!0});var Dt=Ke.default=void 0,fn=pn(de()),mn=w,hn=(0,fn.default)((0,mn.jsx)("path",{d:"m16 6 2.29 2.29-4.88 4.88-4-4L2 16.59 3.41 18l6-6 4 4 6.3-6.29L22 12V6z"}),"TrendingUp");Dt=Ke.default=hn;function gn(){const{t:e}=_("optimize"),{database:t}=I(),r=pe(),[a,o]=f.useState(8),[s,i]=f.useState(void 0),[u,c]=f.useState(void 0),d=f.useMemo(()=>t.relics.values.reduce((R,y)=>(R[y.slotKey].push(y),R),{head:[],hands:[],feet:[],body:[],sphere:[],rope:[]}),[t.relics.values]),p=Object.values(d).reduce((R,y)=>R*y.length,1),[l,m]=f.useState(void 0),[h,b]=f.useState(!1),v=f.useRef(()=>{});f.useEffect(()=>()=>v.current(),[]);const C=f.useCallback(async()=>{if(!u||!r)return;const R=new Promise(X=>v.current=X);i(void 0),b(!0);const y=new un(r,u,d,a,i);R.then(async()=>await y.terminate());const P=await y.optimize();await y.terminate(),v.current=()=>{},b(!1),m(P[0])},[r,a,u,d]),$=f.useCallback(()=>{v.current(),b(!1)},[v]);return n(L,{bgt:"dark",children:g(K,{children:[n(Ga,{}),g(we,{children:[n(M,{variant:"h5",children:e("optimize")}),g(S,{children:[n(Mt,{optTarget:u,setOptTarget:c}),n(Ua,{numWorkers:a,setNumWorkers:o}),n(re,{onClick:h?$:C,color:h?"error":"primary",startIcon:h?n(bt,{}):n(Dt,{}),children:e(h?"cancel":"optimize")})]}),s&&n(bn,{progress:s,totalPermutations:p}),l&&g(S,{children:[g(M,{children:["Best: ",l.value]}),n(_a,{build:l.ids})]})]})]})})}function bn({progress:e,totalPermutations:t}){const{t:r}=_("optimize");return g(S,{children:[g(M,{children:[r("totalProgress"),": ",e.numBuildsComputed.toLocaleString()," /"," ",t.toLocaleString()]}),g(M,{children:[r("buildsKept"),": ",e.numBuildsKept.toLocaleString()," /"," ",dn.toLocaleString()]}),n(Ca,{variant:"determinate",value:e.numBuildsComputed/t*100})]})}const vn={xs:12,sm:6,md:4};function xn(){const{loadout:{key:e}}=Ee(),t=pe(),{t:r}=_("sheet_gen"),a=[["basic",r("talents.basic")],["skill",r("talents.skill")],["ultimate",r("talents.ultimate")]],o=_e(),s=ft(o.breakpoints.up("lg")),i=Ta[e];if(!(!i||!t))return n(ce,{children:g(z,{container:!0,spacing:1,children:[s&&n(z,{item:!0,xs:12,md:12,lg:3,sx:{display:"flex",flexDirection:"column",gap:1},children:n(it,{})}),n(z,{item:!0,xs:12,md:12,lg:9,container:!0,spacing:1,children:a.map(([u,c])=>{const d=i[u];return d?n(z,{item:!0,...vn,children:n(yn,{talentKey:u,subtitle:c,sheetElement:d})},u):null})}),!s&&n(z,{item:!0,xs:12,md:12,lg:3,container:!0,spacing:1,children:n(z,{item:!0,xs:12,children:n(it,{})})})]})})}function yn({sheetElement:e,subtitle:t,onClickTitle:r}){const a=f.useCallback(c=>n(vt,{onClick:r,children:c}),[r]);let o=null;o=null;const{loadoutId:s}=f.useContext(mt),{database:i}=I(),u=f.useCallback((c,d,p,l)=>{i.loadouts.set(s,m=>(m=structuredClone(m),cr(m.conditional,[c,d,p],l),m))},[i,s]);return g(L,{bgt:"light",sx:{height:"100%"},children:[o,g(K,{children:[n(Sa,{condition:!!r,wrapper:a,children:g(z,{container:!0,sx:{flexWrap:"nowrap"},children:[n(z,{item:!0,children:n(S,{component:Fe?Fe:"img",src:e==null?void 0:e.img,sx:{width:60,height:"auto"}})}),g(z,{item:!0,flexGrow:1,sx:{pl:1},children:[n(M,{variant:"h6",children:e==null?void 0:e.name}),n(M,{variant:"subtitle1",children:t})]})]})}),e.documents.map((c,d)=>n(Aa,{document:c,collapse:!0,setConditional:u},d))]})]})}function it(){const{t:e}=_("sheet_gen"),t=pe();if(!t)return null;const r=t.compute(ze.char.eidolon).val;return n(Ce,{fullWidth:!0,title:e("constellationLvl",{level:r}),color:"primary",children:dt(0,dr).map(a=>n(ye,{selected:r===a,disabled:r===a,onClick:()=>{},children:e("constellationLvl",{level:a})},a))})}function Cn({tab:e}){const{loadout:{key:t}}=Ee(),{character:r}=ur(),a=pe(),[o,s]=f.useState(void 0);return g(S,{children:[e,n(vr,{characterKey:o,onClose:()=>s(void 0)}),n(xr,{character:r}),g(we,{gap:1,pt:1,children:[n(L,{bgt:"dark",children:g(K,{children:[n(re,{disabled:!t,onClick:()=>t&&s(t),children:"Edit Character"}),g(Xe,{children:[n(Ye,{expandIcon:n(Re,{}),children:"All target values, if sheet is created"}),n(Qe,{children:n(we,{children:a==null?void 0:a.listFormulas(ze.listing.formulas).map((i,u)=>{const c=a.compute(i),d=i.tag.name||i.tag.q;return g(S,{children:[g(M,{children:[d,": ",c.val]}),g(Xe,{children:[g(Ye,{expandIcon:n(Re,{}),children:["debug for ",d]}),n(Qe,{children:n(M,{component:"pre",children:JSON.stringify(a.toDebug().compute(i),void 0,2)})})]})]},`${d}${u}`)})})})]})]})}),n(xn,{}),n(gn,{})]})]})}const kn=n(Ie,{variant:"rectangular",width:"100%",height:1e3});function An(){const{database:e}=I(),{teamId:t}=pr(),r=!t||!e.teams.keys.includes(t);return f.useEffect(()=>{r||e.teams.set(t,{lastEdit:Date.now()})},[t,e.teams,r]),r?n(mr,{to:"/teams"}):n(S,{display:"flex",flexDirection:"column",gap:1,children:n(f.Suspense,{fallback:kn,children:t&&n(Sn,{teamId:t})})})}function Sn({teamId:e}){var b;const{database:t}=I(),r=pt(),a=St(e),{loadoutMetadata:o}=a,{params:{characterKey:s}}=$e({path:"/teams/:teamId/:characterKey",end:!1})??{params:{}},{params:{tab:i}}=$e({path:"/teams/:teamId/:characterKey/:tab"})??{params:{}},u=f.useMemo(()=>o.findIndex(v=>{var C;return(v==null?void 0:v.loadoutId)&&((C=t.loadouts.get(v.loadoutId))==null?void 0:C.key)===s}),[o,t.loadouts,s]),c=f.useMemo(()=>o[u],[o,u]);f.useEffect(()=>{window.scrollTo({top:0})},[]),f.useEffect(()=>{c||r("",{replace:!0})},[c,r]);const d=c==null?void 0:c.loadoutId,p=(b=t.loadouts.get(d))==null?void 0:b.key,{t:l}=_(["charNames_gen","page_character"]);wa(f.useMemo(()=>{const v=l(p?"charNames_gen:Character":"Team Settings"),C=i?l(`page_character:tabs.${i}`):p?l("Loadout/Build"):i;return`${a.name} - ${v}${C?` - ${C}`:""}`},[p,l,i,a.name]));const m=U(d??""),h=f.useMemo(()=>{if(!(!d||!m||!c))return{teamId:e,team:a,loadoutId:d,loadout:m,loadoutMetadatum:c}},[c,a,m,d,e]);return n(Ha,{teamId:e,src:ut[u],children:g(S,{sx:{display:"flex",gap:1,flexDirection:"column",mx:1,mt:2},children:[n(L,{children:n(rn,{teamId:e,charKey:p,tab:i})}),n(S,{children:h?n(mt.Provider,{value:h,children:n($n,{})}):n(an,{teamId:e})})]})})}function $n({tab:e}){const{loadout:{key:t}}=Ee(),r=ht(t),a=f.useMemo(()=>r&&{character:r},[r]);return a?n(fr.Provider,{value:a,children:n(hr,{children:n(Je,{path:":characterKey",children:n(Je,{path:"*",index:!0,element:n(Cn,{tab:e})})})})}):n(Ie,{variant:"rectangular",width:"100%",height:1e3})}export{An as default};
