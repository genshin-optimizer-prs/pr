import{u as U,b as H,e as t,Z as L,M as q,ag as J,n as d,p as o,C as Q,K as u,t as Z,B as X,J as v,R as Y,_ as D,h as ee,ah as ae,V as E}from"./index-020f1622.js";import{u as te,f as oe,s as ne,a as se,T as re,S as le}from"./StarDisplay-a4a8e677.js";import{W as pe,a as ie,b as ce,w as R,c as de,d as ue}from"./WeaponCard-06350e0c.js";import{g as k}from"./index-6f48a9bb.js";import{c as M}from"./totalUtils-299fb4cb.js";import{A as me}from"./ConditionalWrapper-002aba0a.js";import"./DropdownButton-84eb4f07.js";import"./ColoredText-86808015.js";import"./index-3f7a5aaf.js";import"./SqBadge-37465cda.js";import"./SolidToggleButtonGroup-3160a6a5.js";import"./useWeapon-72754c0d.js";import"./CardActionArea-6e6e5295.js";const he=Y.lazy(()=>D(()=>import("./WeaponSelectionModal-77c51bb0.js"),["./WeaponSelectionModal-77c51bb0.js","./index-020f1622.js","./index-0d3d68d5.css","./index-3f7a5aaf.js","./ColoredText-86808015.js","./SqBadge-37465cda.js","./Close-25258b80.js","./index-6f48a9bb.js","./totalUtils-299fb4cb.js","./StarDisplay-a4a8e677.js","./DropdownButton-84eb4f07.js","./WeaponCard-06350e0c.js","./SolidToggleButtonGroup-3160a6a5.js","./useWeapon-72754c0d.js","./ConditionalWrapper-002aba0a.js","./CardActionArea-6e6e5295.js"],import.meta.url)),we=t.lazy(()=>D(()=>import("./WeaponEditor-0d42325d.js").then(r=>r.e),["./WeaponEditor-0d42325d.js","./index-020f1622.js","./index-0d3d68d5.css","./index-3f7a5aaf.js","./ColoredText-86808015.js","./SqBadge-37465cda.js","./useWeapon-72754c0d.js","./StarDisplay-a4a8e677.js","./DropdownButton-84eb4f07.js","./Close-25258b80.js","./ConditionalWrapper-002aba0a.js","./DataContext-1515533c.js","./InfoTooltip-9975910f.js","./BootstrapTooltip-415d357a.js","./Groups-dc22b3fc.js","./index-6f48a9bb.js","./CardHeader-2d06a0e5.js"],import.meta.url)),fe={xs:1,sm:2,md:3,lg:3,xl:4},ge={xs:10,sm:12,md:24,lg:24,xl:24},ye=Object.keys(R);function Re(){const{t:r}=U(["page_weapon","ui","weaponNames_gen"]),a=H(),[i,A]=t.useState(a.displayWeapon.get());t.useEffect(()=>a.displayWeapon.follow((e,n)=>A(n)),[a]);const[P,S]=t.useState(!1),[T,b]=L();t.useEffect(()=>(q.send({hitType:"pageview",page:"/weapon"}),a.weapons.followAny((e,n)=>(n==="new"||n==="remove")&&b())),[b,a]);const j=te(),F=t.useCallback(async e=>{const n=a.weapons.get(e);if(!n)return;const l=r(`weaponNames_gen:${n.key}`);window.confirm(r("removeWeapon",{value:l}))&&(a.weapons.remove(e),i.editWeaponId===e&&a.displayWeapon.set({editWeaponId:""}))},[i.editWeaponId,a,r]),m=t.useCallback(e=>{a.displayWeapon.set({editWeaponId:e})},[a]),N=t.useCallback(e=>{m(a.weapons.new(J(e)))},[a,m]),[C,O]=t.useState(""),_=t.useDeferredValue(C),{sortType:h,ascending:w,weaponType:f,rarity:g}=i,{weaponIds:s,totalWeaponNum:y}=t.useMemo(()=>{const e=a.weapons.values,n=e.length,l=e.filter(oe({weaponType:f,rarity:g,name:_},de())).sort(ne(R[h]??[],w,ue())).map(p=>p.id);return T&&{weaponIds:l,totalWeaponNum:n}},[T,a,h,w,g,f,_]),{numShow:I,setTriggerElement:z}=se(ge[j],s.length),W=t.useMemo(()=>s.slice(0,I),[s,I]),B=s.length!==y?`${s.length}/${y}`:`${y}`,x=t.useCallback(()=>a.displayWeapon.set({editWeaponId:""}),[a]),{editWeaponId:c}=i;t.useEffect(()=>{c&&(a.weapons.get(c)||x())},[a,c,x]);const K=t.useMemo(()=>M(ee,e=>Object.entries(a.weapons.data).forEach(([n,l])=>{const p=k(l.key).weaponType;e[p].total++,s.includes(n)&&e[p].current++})),[a,s]),V=t.useMemo(()=>M(ae,e=>Object.entries(a.weapons.data).forEach(([n,l])=>{const p=k(l.key).rarity;e[p].total++,s.includes(n)&&e[p].current++})),[a,s]),$={numShowing:W.length,total:B,t:r,namespace:"page_weapon"},G={sortKeys:[...ye],value:h,onChange:e=>a.displayWeapon.set({sortType:e}),ascending:w,onChangeAsc:e=>a.displayWeapon.set({ascending:e})};return d(u,{my:1,display:"flex",flexDirection:"column",gap:1,children:[o(t.Suspense,{fallback:!1,children:o(he,{show:P,onHide:()=>S(!1),onSelect:N})}),o(t.Suspense,{fallback:!1,children:o(we,{weaponId:c,footer:!0,onClose:x})}),o(Z,{children:d(Q,{sx:{display:"flex",flexDirection:"column",gap:1},children:[d(u,{display:"flex",flexWrap:"wrap",gap:1,alignItems:"stretch",children:[o(pe,{onChange:e=>a.displayWeapon.set({weaponType:e}),value:f,totals:K,size:"small"}),o(ie,{sx:{height:"100%"},onChange:e=>a.displayWeapon.set({rarity:e}),value:g,totals:V,size:"small"}),o(u,{flexGrow:1}),o(re,{autoFocus:!0,size:"small",value:C,onChange:e=>O(e.target.value),label:r("weaponName"),sx:{height:"100%"},InputProps:{sx:{height:"100%"}}})]}),o(u,{display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",children:o(le,{showingTextProps:$,sortByButtonProps:G})})]})}),d(t.Suspense,{fallback:o(E,{variant:"rectangular",sx:{width:"100%",height:"100%",minHeight:500}}),children:[o(X,{fullWidth:!0,onClick:()=>S(!0),color:"info",startIcon:o(me,{}),children:r("page_weapon:addWeapon")}),o(v,{container:!0,spacing:1,columns:fe,children:W.map(e=>o(v,{item:!0,xs:1,children:o(ce,{weaponId:e,onDelete:F,onEdit:m,canEquip:!0})},e))})]}),s.length!==W.length&&o(E,{ref:e=>{e&&z(e)},sx:{borderRadius:1},variant:"rectangular",width:"100%",height:100})]})}export{Re as default};
