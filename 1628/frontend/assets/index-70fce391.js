import{u as Z,b as ee,e as t,X as ae,M as te,ae as oe,n as m,p as o,C as R,K as i,t as A,B as ne,J as j,R as se,_ as z,a0 as re,h as le,af as pe,U as ie}from"./index-158f0932.js";import{u as ce,P as N}from"./PageAndSortOptionSelect-862d1ff1.js";import{f as de,s as ue,T as me}from"./StarDisplay-bfc91ae8.js";import{W as fe,a as ge,w as B,b as we,c as he}from"./WeaponCard-1ab28a74.js";import{W as ye}from"./WeaponToggle-4d48f4cb.js";import{g as F}from"./index-8ec923a2.js";import{c as O}from"./totalUtils-138decb2.js";import{A as We}from"./LocationAutocomplete-406eb2ee.js";import"./DropdownButton-eed29567.js";import"./ColoredText-5d4f1526.js";import"./index-50fce377.js";import"./SqBadge-2b3e60d9.js";import"./useWeapon-e802802b.js";import"./CardActionArea-dc07d6b2.js";const xe=se.lazy(()=>z(()=>import("./WeaponSelectionModal-72431bcc.js"),["./WeaponSelectionModal-72431bcc.js","./index-158f0932.js","./index-49338cde.css","./index-50fce377.js","./ColoredText-5d4f1526.js","./SqBadge-2b3e60d9.js","./index-8ec923a2.js","./totalUtils-138decb2.js","./CloseButton-b5d5c14f.js","./StarDisplay-bfc91ae8.js","./DropdownButton-eed29567.js","./WeaponCard-1ab28a74.js","./useWeapon-e802802b.js","./LocationAutocomplete-406eb2ee.js","./PageAndSortOptionSelect-862d1ff1.js","./CardActionArea-dc07d6b2.js","./WeaponToggle-4d48f4cb.js"],import.meta.url)),Se=t.lazy(()=>z(()=>import("./WeaponEditor-9f60cfa5.js").then(l=>l.a),["./WeaponEditor-9f60cfa5.js","./index-158f0932.js","./index-49338cde.css","./index-50fce377.js","./ColoredText-5d4f1526.js","./SqBadge-2b3e60d9.js","./useWeapon-e802802b.js","./StarDisplay-bfc91ae8.js","./DropdownButton-eed29567.js","./LocationAutocomplete-406eb2ee.js","./PageAndSortOptionSelect-862d1ff1.js","./CloseButton-b5d5c14f.js","./FieldDisplay-c1c2e16e.js","./BootstrapTooltip-8457a112.js","./Groups-a99bba0c.js","./InfoTooltip-1c249f80.js","./LevelSelect-578a7fb6.js","./index-8ec923a2.js","./CardHeader-26bbb76f.js"],import.meta.url)),Te={xs:1,sm:2,md:3,lg:3,xl:4},Ie={xs:10,sm:12,md:24,lg:24,xl:24},Ce=Object.keys(B);function ze(){const{t:l}=Z(["page_weapon","ui","weaponNames_gen"]),a=ee(),[c,K]=t.useState(a.displayWeapon.get());t.useEffect(()=>a.displayWeapon.follow((e,n)=>K(n)),[a]);const[L,T]=t.useState(!1),[I,C]=ae(),f=t.useRef(null),[b,P]=t.useState(0);t.useEffect(()=>(te.send({hitType:"pageview",page:"/weapon"}),a.weapons.followAny((e,n)=>(n==="new"||n==="remove")&&C())),[C,a]);const U=ce(),d=Ie[U],V=t.useCallback(async e=>{const n=a.weapons.get(e);if(!n)return;const s=l(`weaponNames_gen:${n.key}`);window.confirm(l("removeWeapon",{value:s}))&&(a.weapons.remove(e),c.editWeaponId===e&&a.displayWeapon.set({editWeaponId:""}))},[c.editWeaponId,a,l]),g=t.useCallback(e=>{a.displayWeapon.set({editWeaponId:e})},[a]),$=t.useCallback(e=>{g(a.weapons.new(oe(e)))},[a,g]),[_,G]=t.useState(""),v=t.useDeferredValue(_),{sortType:w,ascending:h,weaponType:y,rarity:W}=c,{weaponIdList:r,totalWeaponNum:x}=t.useMemo(()=>{const e=a.weapons.values,n=e.length,s=e.filter(de({weaponType:y,rarity:W,name:v},we())).sort(ue(B[w]??[],h,he())).map(p=>p.id);return I&&{weaponIdList:s,totalWeaponNum:n}},[I,a,w,h,W,y,v]),{weaponIdsToShow:k,numPages:E,currentPageIndex:H}=t.useMemo(()=>{const e=Math.ceil(r.length/d),n=re(b,0,e-1);return{weaponIdsToShow:r.slice(n*d,(n+1)*d),numPages:e,currentPageIndex:n}},[r,b,d]),q=r.length!==x?`${r.length}/${x}`:`${x}`,J=t.useCallback((e,n)=>{var s;(s=f.current)==null||s.scrollIntoView({behavior:"smooth"}),P(n-1)},[P,f]),S=t.useCallback(()=>a.displayWeapon.set({editWeaponId:""}),[a]),{editWeaponId:u}=c;t.useEffect(()=>{u&&(a.weapons.get(u)||S())},[a,u,S]);const Q=t.useMemo(()=>O(le,e=>Object.entries(a.weapons.data).forEach(([n,s])=>{const p=F(s.key).weaponType;e[p].total++,r.includes(n)&&e[p].current++})),[a,r]),X=t.useMemo(()=>O(pe,e=>Object.entries(a.weapons.data).forEach(([n,s])=>{const p=F(s.key).rarity;e[p].total++,r.includes(n)&&e[p].current++})),[a,r]),M={count:E,page:H+1,onChange:J},D={numShowing:k.length,total:q,t:l,namespace:"page_weapon"},Y={sortKeys:[...Ce],value:w,onChange:e=>a.displayWeapon.set({sortType:e}),ascending:h,onChangeAsc:e=>a.displayWeapon.set({ascending:e})};return m(i,{my:1,display:"flex",flexDirection:"column",gap:1,children:[o(t.Suspense,{fallback:!1,children:o(xe,{show:L,onHide:()=>T(!1),onSelect:$})}),o(t.Suspense,{fallback:!1,children:o(Se,{weaponId:u,footer:!0,onClose:S})}),o(A,{ref:f,children:m(R,{sx:{display:"flex",flexDirection:"column",gap:1},children:[m(i,{display:"flex",flexWrap:"wrap",gap:1,alignItems:"stretch",children:[o(ye,{onChange:e=>a.displayWeapon.set({weaponType:e}),value:y,totals:Q,size:"small"}),o(fe,{sx:{height:"100%"},onChange:e=>a.displayWeapon.set({rarity:e}),value:W,totals:X,size:"small"}),o(i,{flexGrow:1}),o(me,{autoFocus:!0,size:"small",value:_,onChange:e=>G(e.target.value),label:l("weaponName"),sx:{height:"100%"},InputProps:{sx:{height:"100%"}}})]}),o(i,{display:"flex",justifyContent:"space-between",alignItems:"flex-end",flexWrap:"wrap",children:o(N,{paginationProps:M,showingTextProps:D,displaySort:!0,sortByButtonProps:Y})})]})}),m(t.Suspense,{fallback:o(ie,{variant:"rectangular",sx:{width:"100%",height:"100%",minHeight:500}}),children:[o(ne,{fullWidth:!0,onClick:()=>T(!0),color:"info",startIcon:o(We,{}),children:l("page_weapon:addWeapon")}),o(j,{container:!0,spacing:1,columns:Te,children:k.map(e=>o(j,{item:!0,xs:1,children:o(ge,{weaponId:e,onDelete:V,onEdit:g,canEquip:!0})},e))})]}),E>1&&o(A,{children:o(R,{children:o(i,{display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",children:o(N,{paginationProps:M,showingTextProps:D})})})})]})}export{ze as default};
