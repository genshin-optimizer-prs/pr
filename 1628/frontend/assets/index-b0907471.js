import{b as B,aE as G,ag as L,e as r,aF as he,u as pe,a9 as ue,X as me,M as de,n as y,p as t,C as j,J as i,K as b,t as F,B as _,U as ge,a0 as fe,h as ye,f as Ce,aG as xe}from"./index-158f0932.js";import{u as we,P as R}from"./PageAndSortOptionSelect-862d1ff1.js";import{f as Te,s as be,T as Se}from"./StarDisplay-bfc91ae8.js";import{d as $,C as ke}from"./TeamCard-010eafdd.js";import{E as Ke,C as ve,c as O,a as Pe,b as Me,d as We,e as De}from"./CharacterRarityToggle-a2e6af3b.js";import{W as Ee}from"./WeaponToggle-4d48f4cb.js";import{g as A}from"./index-50fce377.js";import{g as Ie}from"./index-8ec923a2.js";import{c as S}from"./totalUtils-138decb2.js";import"./DropdownButton-eed29567.js";import"./ColoredText-5d4f1526.js";import"./BootstrapTooltip-8457a112.js";import"./SqBadge-2b3e60d9.js";import"./FieldDisplay-c1c2e16e.js";import"./Groups-a99bba0c.js";import"./index-99c5df9f.js";import"./Artifact-800b231c.js";import"./SlotIcon-953d547e.js";import"./useWeapon-e802802b.js";import"./CardActionArea-dc07d6b2.js";import"./CloseButton-b5d5c14f.js";import"./LevelSelect-578a7fb6.js";import"./Trans-7afc7735.js";function Ne(){const e=B(),h=G(),{params:{tab:l=""}}=L({path:"/characters/:charKey/:tab",end:!1})??{params:{tab:""}};return r.useCallback(p=>{const u=e.chars.get(p);let m=l;u||(e.chars.getWithInitWeapon(p),m=""),h(`/characters/${p}/${m}`)},[h,e,l])}const je={xs:1,sm:2,md:3,lg:4,xl:4},Fe={xs:10,sm:16,md:24,lg:32,xl:32},_e=Object.keys(O);function oa(){const e=B(),h=G(),{params:{characterKey:l}}=L({path:"/characters/:characterKey",end:!1})??{params:{}},C=r.useMemo(()=>l?he(l)?(e.chars.get(l)||e.chars.getWithInitWeapon(l),l):(h("/characters"),null):null,[l,h,e]),{t:p}=pe(["page_character","sillyWisher_charNames","charNames_gen"]),{silly:u}=r.useContext(ue),[m,k]=r.useState(()=>e.displayCharacter.get());r.useEffect(()=>e.displayCharacter.follow((a,s)=>k(s)),[e,k]);const[K,z]=r.useState(""),v=r.useDeferredValue(K),x=r.useRef(null),U=r.useCallback((a,s)=>{var o;(o=x.current)==null||o.scrollIntoView({behavior:"smooth"}),e.displayCharacter.set({pageIndex:s-1})},[e,x]),V=we(),d=Fe[V],[H,w]=r.useState(!1),[q,g]=me();r.useEffect(()=>(de.send({hitType:"pageview",page:"/characters"}),e.chars.followAny((a,s)=>(s==="new"||s==="remove")&&g())),[g,e]),r.useEffect(()=>e.charMeta.followAny(a=>g()),[g,e]);const J=Ne(),P=r.useDeferredValue(m),M=r.useDeferredValue(q),{charKeyList:n,totalCharNum:T}=r.useMemo(()=>{const s=e.chars.keys.length,{element:o,weaponType:c,rarity:f,sortType:ce,ascending:le}=P,ie=e.chars.keys.filter(Te({element:o,weaponType:c,rarity:f,name:v},Pe(e,u))).sort(be(O[ce]??[],le,Me(e,u),["new","favorite"]));return M&&{charKeyList:ie,totalCharNum:s}},[e,P,v,u,M]),{weaponType:Q,element:X,rarity:Y,sortType:Z,ascending:ee,pageIndex:W=0}=m,{charKeyListToShow:D,numPages:E,currentPageIndex:ae}=r.useMemo(()=>{const a=Math.ceil(n.length/d),s=fe(W,0,a-1);return{charKeyListToShow:n.slice(s*d,(s+1)*d),numPages:a,currentPageIndex:s}},[n,W,d]),te=n.length!==T?`${n.length}/${T}`:`${T}`,re=r.useMemo(()=>S(ye,a=>Object.entries(e.chars.data).forEach(([s,o])=>{const c=e.weapons.get(o.equippedWeapon);if(!c)return;const f=Ie(c.key).weaponType;a[f].total++,n.includes(s)&&a[f].current++})),[e,n]),se=r.useMemo(()=>S(Ce,a=>Object.entries(e.chars.data).forEach(([s,o])=>{const c=A(o.key,e.gender).elementKey;a[c].total++,n.includes(s)&&a[c].current++})),[e,n]),ne=r.useMemo(()=>S(xe,a=>Object.entries(e.chars.data).forEach(([s,o])=>{const c=A(o.key,e.gender).rarity;a[c].total++,n.includes(s)&&a[c].current++})),[e,n]),I={count:E,page:ae+1,onChange:U},N={numShowing:D.length,total:te,t:p,namespace:"page_character"},oe={sortKeys:[..._e],value:Z,onChange:a=>e.displayCharacter.set({sortType:a}),ascending:ee,onChangeAsc:a=>e.displayCharacter.set({ascending:a})};return y(b,{my:1,display:"flex",flexDirection:"column",gap:1,children:[C&&t(We,{characterKey:C,onClose:()=>h("/characters")}),t(r.Suspense,{fallback:!1,children:t(De,{newFirst:!0,show:H,onHide:()=>w(!1),onSelect:J})}),t(F,{ref:x,children:y(j,{sx:{display:"flex",flexDirection:"column",gap:1},children:[y(i,{container:!0,spacing:1,children:[t(i,{item:!0,children:t(Ee,{sx:{height:"100%"},onChange:a=>e.displayCharacter.set({weaponType:a}),value:Q,totals:re,size:"small"})}),t(i,{item:!0,children:t(Ke,{sx:{height:"100%"},onChange:a=>e.displayCharacter.set({element:a}),value:X,totals:se,size:"small"})}),t(i,{item:!0,children:t(ve,{sx:{height:"100%"},onChange:a=>e.displayCharacter.set({rarity:a}),value:Y,totals:ne,size:"small"})}),t(i,{item:!0,flexGrow:1}),t(i,{item:!0,children:t(Se,{autoFocus:!0,value:K,onChange:a=>z(a.target.value),label:p("characterName"),size:"small",sx:{height:"100%"},InputProps:{sx:{height:"100%"}}})})]}),t(b,{display:"flex",justifyContent:"space-between",alignItems:"flex-end",flexWrap:"wrap",children:t(R,{paginationProps:I,showingTextProps:N,displaySort:!0,sortByButtonProps:oe})})]})}),t(_,{fullWidth:!0,onClick:()=>w(!0),color:"info",startIcon:t($,{}),children:p`addNew`}),t(r.Suspense,{fallback:t(ge,{variant:"rectangular",sx:{width:"100%",height:"100%",minHeight:5e3}}),children:t(i,{container:!0,spacing:1,columns:je,children:D.map(a=>t(i,{item:!0,xs:1,children:t(ke,{characterKey:a,onClick:()=>h(`${a}`),hideStats:!0})},a))})}),E>1&&t(F,{children:y(j,{sx:{display:"flex",flexDirection:"row",gap:1},children:[t(_,{onClick:()=>w(!0),color:"info",sx:{minWidth:0},children:t($,{})}),t(b,{display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",flexGrow:1,children:t(R,{paginationProps:I,showingTextProps:N})})]})})]})}export{oa as default};
