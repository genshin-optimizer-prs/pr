import{u as J,b as Q,e as t,X,M as Y,ae as Z,n as d,p as o,C as ee,K as m,t as ae,B as te,J as D,R as oe,_ as N,h as ne,af as se,U as R}from"./index-2255b4d0.js";import{u as re,f as le,s as ie,a as pe,T as ce,S as ue}from"./StarDisplay-6fcc0ff2.js";import{W as de,a as me,w as O,b as fe,c as he}from"./WeaponCard-2c61b179.js";import{W as we}from"./WeaponToggle-a54cd9bb.js";import{g as A}from"./index-10fa9bd9.js";import{c as P}from"./totalUtils-9f227dd8.js";import{A as ge}from"./LocationAutocomplete-45def65c.js";import"./DropdownButton-a9bd17ce.js";import"./ColoredText-eaf11f9d.js";import"./index-7ad2ccf5.js";import"./SqBadge-10cb9cc4.js";import"./SolidToggleButtonGroup-cf60f7c1.js";import"./useWeapon-f51a3007.js";import"./CardActionArea-b393fa84.js";import"./Autocomplete-b0c91ebe.js";const ye=oe.lazy(()=>N(()=>import("./WeaponSelectionModal-e0998fa3.js"),["./WeaponSelectionModal-e0998fa3.js","./index-2255b4d0.js","./index-d1d4f6b8.css","./index-7ad2ccf5.js","./ColoredText-eaf11f9d.js","./SqBadge-10cb9cc4.js","./index-10fa9bd9.js","./totalUtils-9f227dd8.js","./CloseButton-f15d0edc.js","./StarDisplay-6fcc0ff2.js","./DropdownButton-a9bd17ce.js","./WeaponCard-2c61b179.js","./SolidToggleButtonGroup-cf60f7c1.js","./useWeapon-f51a3007.js","./LocationAutocomplete-45def65c.js","./Autocomplete-b0c91ebe.js","./CardActionArea-b393fa84.js","./WeaponToggle-a54cd9bb.js"],import.meta.url)),We=t.lazy(()=>N(()=>import("./WeaponEditor-24c7993a.js").then(r=>r.a),["./WeaponEditor-24c7993a.js","./index-2255b4d0.js","./index-d1d4f6b8.css","./index-7ad2ccf5.js","./ColoredText-eaf11f9d.js","./SqBadge-10cb9cc4.js","./useWeapon-f51a3007.js","./StarDisplay-6fcc0ff2.js","./DropdownButton-a9bd17ce.js","./LocationAutocomplete-45def65c.js","./Autocomplete-b0c91ebe.js","./CloseButton-f15d0edc.js","./FieldDisplay-ea5654c7.js","./BootstrapTooltip-f859d89e.js","./Groups-04f0c93c.js","./InfoTooltip-4dbc4857.js","./LevelSelect-eb4ed77f.js","./index-10fa9bd9.js","./CardHeader-7f70dc07.js"],import.meta.url)),Se={xs:1,sm:2,md:3,lg:3,xl:4},b={xs:10,sm:12,md:24,lg:24,xl:24},xe=Object.keys(O);function Fe(){const{t:r}=J(["page_weapon","ui","weaponNames_gen"]),a=Q(),[c,j]=t.useState(a.displayWeapon.get());t.useEffect(()=>a.displayWeapon.follow((e,n)=>j(n)),[a]);const[F,C]=t.useState(!1),[_,E]=X();t.useEffect(()=>(Y.send({hitType:"pageview",page:"/weapon"}),a.weapons.followAny((e,n)=>(n==="new"||n==="remove")&&E())),[E,a]);const p=re(),z=t.useCallback(async e=>{const n=a.weapons.get(e);if(!n)return;const l=r(`weaponNames_gen:${n.key}`);window.confirm(r("removeWeapon",{value:l}))&&(a.weapons.remove(e),c.editWeaponId===e&&a.displayWeapon.set({editWeaponId:""}))},[c.editWeaponId,a,r]),f=t.useCallback(e=>{a.displayWeapon.set({editWeaponId:e})},[a]),B=t.useCallback(e=>{f(a.weapons.new(Z(e)))},[a,f]),[I,K]=t.useState(""),v=t.useDeferredValue(I),{sortType:h,ascending:w,weaponType:g,rarity:y}=c,{weaponIds:s,totalWeaponNum:W}=t.useMemo(()=>{const e=a.weapons.values,n=e.length,l=e.filter(le({weaponType:g,rarity:y,name:v},fe())).sort(ie(O[h]??[],w,he())).map(i=>i.id);return _&&{weaponIds:l,totalWeaponNum:n}},[_,a,h,w,y,g,v]),[S,k]=t.useState(b[p]);t.useEffect(()=>{s&&k(b[p])},[s,p]);const[U,$]=t.useState(),M=pe(U)&&S<s.length;t.useEffect(()=>{M&&k(e=>e+b[p])},[M,p]);const x=t.useMemo(()=>s.slice(0,S),[s,S]),G=s.length!==W?`${s.length}/${W}`:`${W}`,T=t.useCallback(()=>a.displayWeapon.set({editWeaponId:""}),[a]),{editWeaponId:u}=c;t.useEffect(()=>{u&&(a.weapons.get(u)||T())},[a,u,T]);const V=t.useMemo(()=>P(ne,e=>Object.entries(a.weapons.data).forEach(([n,l])=>{const i=A(l.key).weaponType;e[i].total++,s.includes(n)&&e[i].current++})),[a,s]),H=t.useMemo(()=>P(se,e=>Object.entries(a.weapons.data).forEach(([n,l])=>{const i=A(l.key).rarity;e[i].total++,s.includes(n)&&e[i].current++})),[a,s]),L={numShowing:x.length,total:G,t:r,namespace:"page_weapon"},q={sortKeys:[...xe],value:h,onChange:e=>a.displayWeapon.set({sortType:e}),ascending:w,onChangeAsc:e=>a.displayWeapon.set({ascending:e})};return d(m,{my:1,display:"flex",flexDirection:"column",gap:1,children:[o(t.Suspense,{fallback:!1,children:o(ye,{show:F,onHide:()=>C(!1),onSelect:B})}),o(t.Suspense,{fallback:!1,children:o(We,{weaponId:u,footer:!0,onClose:T})}),o(ae,{children:d(ee,{sx:{display:"flex",flexDirection:"column",gap:1},children:[d(m,{display:"flex",flexWrap:"wrap",gap:1,alignItems:"stretch",children:[o(we,{onChange:e=>a.displayWeapon.set({weaponType:e}),value:g,totals:V,size:"small"}),o(de,{sx:{height:"100%"},onChange:e=>a.displayWeapon.set({rarity:e}),value:y,totals:H,size:"small"}),o(m,{flexGrow:1}),o(ce,{autoFocus:!0,size:"small",value:I,onChange:e=>K(e.target.value),label:r("weaponName"),sx:{height:"100%"},InputProps:{sx:{height:"100%"}}})]}),o(m,{display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",children:o(ue,{showingTextProps:L,sortByButtonProps:q})})]})}),d(t.Suspense,{fallback:o(R,{variant:"rectangular",sx:{width:"100%",height:"100%",minHeight:500}}),children:[o(te,{fullWidth:!0,onClick:()=>C(!0),color:"info",startIcon:o(ge,{}),children:r("page_weapon:addWeapon")}),o(D,{container:!0,spacing:1,columns:Se,children:x.map(e=>o(D,{item:!0,xs:1,children:o(me,{weaponId:e,onDelete:z,onEdit:f,canEquip:!0})},e))})]}),s.length!==x.length&&o(R,{ref:e=>{e&&$(e)},sx:{borderRadius:1},variant:"rectangular",width:"100%",height:100})]})}export{Fe as default};
