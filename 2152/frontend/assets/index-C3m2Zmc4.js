import{b as D,c8 as N,d as r,bX as Y,c9 as ee,u as ae,aK as te,al as re,ac as se,V as ne,ao as ce,ap as oe,aQ as C,aq as le,p as w,q as t,s as ie,U as o,aT as he,ca as ue,cb as de,b3 as pe,B as M,au as ge,w as ye,ar as fe,Z as me,a2 as W,cc as Ce,cd as j,ce as we,cf as Te,k as xe,h as Se,f as be,e as ke,bA as ve,cg as Ke,ch as Ee}from"./index-D5XI5r89.js";import{C as Me}from"./CharacterEditor-B2YwTLrY.js";import"./TeamCard-DrWe1fSt.js";import"./Settings-Dfca-zCR.js";function We(){const a=D(),l=N();return r.useCallback(u=>{a.chars.get(u)||a.chars.getWithInitWeapon(u),l(`/characters/${u}`)},[l,a])}const De={xs:1,sm:2,md:3,lg:4,xl:4},Ne={xs:5,sm:8,md:9,lg:12,xl:12},je=Object.keys(j);function Be(){const a=D(),l=N(),{params:{characterKey:i}}=Y({path:"/characters/:characterKey",end:!1})??{params:{}},u=r.useMemo(()=>i?ee(i)?(a.chars.get(i)||a.chars.getWithInitWeapon(i),i):(l("/characters"),null):null,[i,l,a]),{t:d}=ae(["page_character","sillyWisher_charNames","charNames_gen"]),{silly:y}=r.useContext(te),[T,x]=r.useState(()=>a.displayCharacter.get());r.useEffect(()=>a.displayCharacter.follow((e,n)=>x(n)),[a,x]);const[S,F]=r.useState(""),b=r.useDeferredValue(S),A=re(),[I,k]=r.useState(!1),[_,p]=se();r.useEffect(()=>(ne.send({hitType:"pageview",page:"/characters"}),a.chars.followAny((e,n)=>(n==="new"||n==="remove")&&p())),[p,a]),r.useEffect(()=>a.charMeta.followAny(e=>p()),[p,a]);const B=We(),v=r.useDeferredValue(T),K=r.useDeferredValue(_),{charKeys:s,totalCharNum:f}=r.useMemo(()=>{const n=a.chars.keys.length,{element:h,weaponType:c,rarity:g,sortType:Z,ascending:J}=v,L=a.chars.keys.filter(ce({element:h,weaponType:c,rarity:g,name:b},we(a,y))).sort(oe(j[Z]??[],J,Te(a,y),["new","favorite"]));return K&&{charKeys:L,totalCharNum:n}},[a,v,b,y,K]),{weaponType:O,element:P,rarity:R,sortType:$,ascending:z}=T,U=r.useMemo(()=>C(Se,e=>Object.entries(a.chars.data).forEach(([n,h])=>{const c=a.weapons.get(h.equippedWeapon);if(!c)return;const g=xe(c.key).weaponType;e[g].total++,s.includes(n)&&e[g].current++})),[a,s]),V=r.useMemo(()=>C(ke,e=>Object.entries(a.chars.data).forEach(([n,h])=>{const c=be(h.key);e[c].total++,s.includes(n)&&e[c].current++})),[a,s]),q=r.useMemo(()=>C(Ke,e=>Object.entries(a.chars.data).forEach(([n,h])=>{const c=ve(h.key).rarity;e[c].total++,s.includes(n)&&e[c].current++})),[a,s]),{numShow:E,setTriggerElement:G}=le(Ne[A],s.length),m=r.useMemo(()=>s.slice(0,E),[s,E]),H=s.length!==f?`${s.length}/${f}`:`${f}`,Q={numShowing:m.length,total:H,t:d,namespace:"page_character"},X={sortKeys:[...je],value:$,onChange:e=>a.displayCharacter.set({sortType:e}),ascending:z,onChangeAsc:e=>a.displayCharacter.set({ascending:e})};return w(M,{display:"flex",flexDirection:"column",gap:1,children:[u&&t(Me,{characterKey:u,onClose:()=>l("/characters")}),t(r.Suspense,{fallback:!1,children:t(Ee,{newFirst:!0,show:I,onHide:()=>k(!1),onSelect:B})}),t(ye,{children:w(ie,{sx:{display:"flex",flexDirection:"column",gap:1},children:[w(o,{container:!0,spacing:1,children:[t(o,{item:!0,children:t(he,{sx:{height:"100%"},onChange:e=>a.displayCharacter.set({weaponType:e}),value:O,totals:U,size:"small"})}),t(o,{item:!0,children:t(ue,{sx:{height:"100%"},onChange:e=>a.displayCharacter.set({element:e}),value:P,totals:V,size:"small"})}),t(o,{item:!0,children:t(de,{sx:{height:"100%"},onChange:e=>a.displayCharacter.set({rarity:e}),value:R,totals:q,size:"small"})}),t(o,{item:!0,flexGrow:1}),t(o,{item:!0,children:t(pe,{autoFocus:!0,value:S,onChange:e=>F(e.target.value),label:d("characterName"),size:"small",sx:{height:"100%"},InputProps:{sx:{height:"100%"}}})})]}),t(M,{display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",children:t(ge,{showingTextProps:Q,sortByButtonProps:X})})]})}),t(me,{fullWidth:!0,onClick:()=>k(!0),color:"info",startIcon:t(fe,{}),children:d`addNew`}),t(r.Suspense,{fallback:t(W,{variant:"rectangular",sx:{width:"100%",height:"100%",minHeight:5e3}}),children:t(o,{container:!0,spacing:1,columns:De,children:m.map(e=>t(o,{item:!0,xs:1,children:t(Ce,{characterKey:e,onClick:()=>l(`${e}`),hideStats:!0})},e))})}),s.length!==m.length&&t(W,{ref:e=>{e&&G(e)},sx:{borderRadius:1},variant:"rectangular",width:"100%",height:100})]})}export{Be as default};
