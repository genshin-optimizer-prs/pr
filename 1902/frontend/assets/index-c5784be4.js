import{u as z,b as G,d as n,af as H,Y as V,aq as X,aS as Y,as as Q,at as Z,au as J,aT as v,p as d,q as t,s as L,X as u,aU as ee,aV as ae,aW as ne,ax as te,y as se,av as oe,B as le,W as E,aX as re,aY as _,aZ as pe,a_ as ie,k as M,h as ce,a$ as de,b0 as ue,b1 as we,a5 as D}from"./index-a9216e56.js";const ge={xs:1,sm:2,md:3,lg:3,xl:4},he={xs:10,sm:12,md:24,lg:24,xl:24},fe=Object.keys(_);function ye(){const{t:p}=z(["page_weapon","ui","weaponNames_gen"]),a=G(),[i,j]=n.useState(a.displayWeapon.get());n.useEffect(()=>a.displayWeapon.follow((e,s)=>j(s)),[a]);const[F,S]=n.useState(!1),[T,b]=H();n.useEffect(()=>(V.send({hitType:"pageview",page:"/weapon"}),a.weapons.followAny((e,s)=>(s==="new"||s==="remove")&&b())),[b,a]);const N=X(),B=n.useCallback(async e=>{const s=a.weapons.get(e);if(!s)return;const l=p(`weaponNames_gen:${s.key}`);window.confirm(p("removeWeapon",{value:l}))&&(a.weapons.remove(e),i.editWeaponId===e&&a.displayWeapon.set({editWeaponId:""}))},[i.editWeaponId,a,p]),w=n.useCallback(e=>{a.displayWeapon.set({editWeaponId:e})},[a]),P=n.useCallback(e=>{w(a.weapons.new(Y(e)))},[a,w]),[C,R]=n.useState(""),k=n.useDeferredValue(C),{sortType:g,ascending:h,weaponType:f,rarity:m}=i,{weaponIds:o,totalWeaponNum:y}=n.useMemo(()=>{const e=a.weapons.values,s=e.length,l=e.filter(Q({weaponType:f,rarity:m,name:k},pe())).sort(Z(_[g]??[],h,ie())).map(r=>r.id);return T&&{weaponIds:l,totalWeaponNum:s}},[T,a,g,h,m,f,k]),{numShow:I,setTriggerElement:$}=J(he[N],o.length),W=n.useMemo(()=>o.slice(0,I),[o,I]),A=o.length!==y?`${o.length}/${y}`:`${y}`,x=n.useCallback(()=>a.displayWeapon.set({editWeaponId:""}),[a]),{editWeaponId:c}=i;n.useEffect(()=>{c&&(a.weapons.get(c)||x())},[a,c,x]);const K=n.useMemo(()=>v(ce,e=>Object.entries(a.weapons.data).forEach(([s,l])=>{const r=M(l.key).weaponType;e[r].total++,o.includes(s)&&e[r].current++})),[a,o]),O=n.useMemo(()=>v(de,e=>Object.entries(a.weapons.data).forEach(([s,l])=>{const r=M(l.key).rarity;e[r].total++,o.includes(s)&&e[r].current++})),[a,o]),U={numShowing:W.length,total:A,t:p,namespace:"page_weapon"},q={sortKeys:[...fe],value:g,onChange:e=>a.displayWeapon.set({sortType:e}),ascending:h,onChangeAsc:e=>a.displayWeapon.set({ascending:e})};return d(u,{my:1,display:"flex",flexDirection:"column",gap:1,children:[t(n.Suspense,{fallback:!1,children:t(ue,{show:F,onHide:()=>S(!1),onSelect:P})}),t(n.Suspense,{fallback:!1,children:t(we,{weaponId:c,footer:!0,onClose:x})}),t(se,{children:d(L,{sx:{display:"flex",flexDirection:"column",gap:1},children:[d(u,{display:"flex",flexWrap:"wrap",gap:1,alignItems:"stretch",children:[t(ee,{onChange:e=>a.displayWeapon.set({weaponType:e}),value:f,totals:K,size:"small"}),t(ae,{sx:{height:"100%"},onChange:e=>a.displayWeapon.set({rarity:e}),value:m,totals:O,size:"small"}),t(u,{flexGrow:1}),t(ne,{autoFocus:!0,size:"small",value:C,onChange:e=>R(e.target.value),label:p("weaponName"),sx:{height:"100%"},InputProps:{sx:{height:"100%"}}})]}),t(u,{display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",children:t(te,{showingTextProps:U,sortByButtonProps:q})})]})}),d(n.Suspense,{fallback:t(D,{variant:"rectangular",sx:{width:"100%",height:"100%",minHeight:500}}),children:[t(le,{fullWidth:!0,onClick:()=>S(!0),color:"info",startIcon:t(oe,{}),children:p("page_weapon:addWeapon")}),t(E,{container:!0,spacing:1,columns:ge,children:W.map(e=>t(E,{item:!0,xs:1,children:t(re,{weaponId:e,onDelete:B,onEdit:w,canEquip:!0})},e))})]}),o.length!==W.length&&t(D,{ref:e=>{e&&$(e)},sx:{borderRadius:1},variant:"rectangular",width:"100%",height:100})]})}export{ye as default};
