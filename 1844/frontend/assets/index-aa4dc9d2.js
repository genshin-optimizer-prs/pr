import{e as o,p as e,n as w,aH as Q,aI as z,V as M,aJ as R,aK as V,q as B,u as W,ab as Y,b as J,d as Z,ar as X,aL as E,Z as ee,aE as ae,Q as te,aM as re,K as $,J as P,C as A,Y as F,B as _,D as se,T as oe,aN as ne,aO as le}from"./index-e273c919.js";import{T as O,A as ie,C as ce,f as me,s as ue,u as he,a as de,S as pe}from"./StarDisplay-adc000c2.js";import{a as fe,T as ge,d as ye}from"./TeamCard-9361fdcf.js";import{d as L}from"./Upload-2110f212.js";import{M as Ce}from"./DropdownButton-427fb801.js";import{g as Te}from"./index-b9e34857.js";import{b as we}from"./totalUtils-7ea2c13d.js";import{C as xe}from"./StatIcon-8aafdaf2.js";import"./ColoredText-cba430ce.js";import"./BootstrapTooltip-393e9945.js";import"./DataContext-15668e19.js";import"./Artifact-d68bdb4b.js";import"./SqBadge-388cde89.js";import"./index-bdee665d.js";import"./SlotIcon-81dc1ef1.js";import"./useWeapon-5b7e0a32.js";import"./index-c12f6ffe.js";import"./CardActionArea-5a3ed66a.js";function ve({options:m,valueKeys:a,label:d,onChange:u,toImg:p,toExItemLabel:C,toExLabel:l,chipProps:f,...y}){const b=o.useMemo(()=>a.map(n=>m.find(t=>t.key===n)).filter(n=>n),[m,a]);return e(ie,{autoHighlight:!0,options:m,multiple:!0,disableCloseOnSelect:!0,value:b,onChange:(n,t,i)=>i==="clear"?u([]):t!==null&&u(t.map(c=>c.key)),isOptionEqualToValue:(n,t)=>n.key===t.key,renderInput:n=>e(O,{...n,label:d,inputProps:{...n.inputProps,autoComplete:"new-password"},color:a.length?"success":"primary"}),renderOption:(n,t)=>w(Ce,{value:t.key,...n,children:[e(Q,{children:p(t.key)}),e(z,{children:e(o.Suspense,{fallback:e(M,{variant:"text",width:100}),children:w(R,{color:t.color,sx:{display:"flex",gap:1},children:[a.includes(t.key)?e("strong",{children:t.label}):e("span",{children:t.label}),C==null?void 0:C(t.key)]})})}),!!t.favorite&&e(fe,{})]}),renderTags:(n,t)=>n.map(({key:i,label:c,color:T},x)=>V(B,{...f,...t({index:x}),key:`${x}${i}${c}`,icon:p(i),label:l?w("span",{children:[c," ",l(i)]}):c,color:T})),filterOptions:(n,{inputValue:t})=>n.filter(i=>{var c;return i.key.toLowerCase().includes(t.toLowerCase())||i.label.toLowerCase().includes(t.toLowerCase())||((c=i.alternateNames)==null?void 0:c.some(T=>T.toLowerCase().includes(t.toLowerCase())))}),...y})}function Se({teamIds:m,charKeys:a,setCharKey:d,acProps:u}){const{t:p}=W(["sillyWisher_charNames","charNames_gen"]),{silly:C}=o.useContext(Y),l=J(),{gender:f}=Z(),y=o.useCallback(r=>l.charMeta.get(r).favorite,[l.charMeta]),b=o.useCallback(r=>e(ce,{characterKey:r}),[]),n=o.useCallback((r,h)=>p(`${h?"sillyWisher_charNames":"charNames_gen"}:${X(r,f)}`),[f,p]),t=o.useCallback(r=>Te(r,f).elementKey??void 0,[f]),i=o.useMemo(()=>l.chars.keys,[l]),{characterTeamTotal:c}=o.useMemo(()=>we({characterTeamTotal:i},h=>{l.teams.values.forEach(g=>{const{loadoutData:v}=g;v.filter(E).forEach(({teamCharId:D})=>{const k=l.teamChars.get(D);if(!k)return;const I=k.key;h.characterTeamTotal[I].total++})}),m.forEach(g=>{const v=l.teams.get(g);if(!v)return;const{loadoutData:D}=v;D.filter(E).forEach(({teamCharId:k})=>{const I=l.teamChars.get(k);if(!I)return;const K=I.key;h.characterTeamTotal[K].current++})})}),[l,i,m]),T=o.useCallback(r=>e("strong",{children:c[r]}),[c]),x=o.useCallback(r=>e(B,{size:"small",label:c[r]}),[c]),N=o.useMemo(()=>i.map(r=>({key:r,label:n(r,C),favorite:y(r),color:t(r)})).sort((r,h)=>r.favorite&&!h.favorite?-1:!r.favorite&&h.favorite?1:r.label.localeCompare(h.label)),[C,n,t,y,i]);return e(o.Suspense,{fallback:e(M,{variant:"text",width:100}),children:e(ve,{label:"Characters",options:N,toImg:b,valueKeys:a,onChange:r=>d(r),toExLabel:T,toExItemLabel:x,chipProps:{variant:"outlined"},...u})})}function be(){return{name:m=>m.name??"",lastEdit:m=>m.lastEdit??0}}const ke={name:["name","lastEdit"],lastEdit:["lastEdit"]};function Ie(m){return{charKeys:(a,d)=>{var l;if(!d.length)return!0;const u=(l=m.teams.get(a))==null?void 0:l.loadoutData.filter(E),p=u==null?void 0:u.map(({teamCharId:f})=>{var y;return(y=m.teamChars.get(f))==null?void 0:y.key}).filter(E);return d.every(f=>p==null?void 0:p.includes(f))},name:(a,d)=>{var u;return!d||!!((u=m.teams.get(a))!=null&&u.name.toLowerCase().includes(d.toLowerCase()))}}}const De={xs:1,sm:2,md:3,lg:3,xl:3},Ke={xs:6,sm:12,md:18,lg:24,xl:24};function Qe(){const{t:m}=W(["page_teams","sillyWisher_charNames","charNames_gen"]),a=J(),[d,u]=ee(),p=ae();o.useEffect(()=>a.teams.followAny((s,S)=>(S==="new"||S==="remove"||S==="update")&&u()),[u,a]);const C=()=>{const s=a.teams.new();p(s)},[l,f,y]=te(),[b,n]=o.useState(""),t=()=>{try{const s=JSON.parse(b);a.teams.import(s)||window.alert("Data verification failed."),y()}catch(s){window.alert(`Data Import failed. ${s}`);return}},i=re(a.displayTeam),{sortType:c,ascending:T,charKeys:x}=i,[N,r]=o.useState(i.searchTerm),h=o.useDeferredValue(N);o.useEffect(()=>{a.displayTeam.set({searchTerm:h})},[a,h]);const{teamIds:g,totalTeamNum:v}=o.useMemo(()=>{const s=a.teams.keys.length,S=a.teams.keys.filter(me({charKeys:x,name:h},Ie(a))).sort((U,q)=>ue(ke[c],T,be())(a.teams.get(U),a.teams.get(q)));return d&&{teamIds:S,totalTeamNum:s}},[d,a,x,h,c,T]),D=he(),{numShow:k,setTriggerElement:I}=de(Ke[D],g.length),K=o.useMemo(()=>g.slice(0,k),[g,k]),j=g.length!==v?`${g.length}/${v}`:`${v}`,G={numShowing:K.length,total:j,t:m,namespace:"page_teams"},H={sortKeys:[...le],value:c,onChange:s=>a.displayTeam.set({sortType:s}),ascending:T,onChangeAsc:s=>a.displayTeam.set({ascending:s})};return w($,{my:1,display:"flex",flexDirection:"column",gap:1,children:[e(F,{children:w(A,{sx:{display:"flex",flexDirection:"column",gap:1},children:[w($,{display:"flex",gap:1,alignItems:"stretch",children:[e(Se,{teamIds:g,charKeys:x,setCharKey:s=>a.displayTeam.set({charKeys:s}),acProps:{sx:{flexGrow:1}}}),e(O,{autoFocus:!0,value:N,onChange:s=>r(s.target.value),label:"Team Name",sx:{height:"100%",flexGrow:1},InputProps:{sx:{height:"100%"}}})]}),e($,{display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",children:e(pe,{showingTextProps:G,sortByButtonProps:H})})]})}),w($,{sx:{display:"flex",gap:1},children:[e(_,{fullWidth:!0,onClick:C,color:"info",startIcon:e(ye,{}),children:"Add Team"}),e(ne,{open:l,onClose:y,children:w(F,{children:[e(xe,{title:"Import Team"}),e(se,{}),w(A,{sx:{display:"flex",flexDirection:"column",gap:2},children:[e(oe,{children:"Import a team in JSON form below."}),e(O,{fullWidth:!0,label:"JSON Data",placeholder:"Paste your Team JSON here",value:b,onChange:s=>n(s.target.value),multiline:!0,rows:4}),e(_,{startIcon:e(L,{}),disabled:!b,onClick:t,children:"Import"})]})]})}),e(_,{fullWidth:!0,onClick:f,color:"info",startIcon:e(L,{}),children:"Import Team"})]}),e(o.Suspense,{fallback:e(M,{variant:"rectangular",sx:{width:"100%",height:"100%",minHeight:5e3}}),children:e(P,{container:!0,spacing:1,columns:De,children:K.map(s=>e(P,{item:!0,xs:1,children:e(o.Suspense,{fallback:e(M,{variant:"rectangular",width:"100%",height:150}),children:e(ge,{teamId:s,bgt:"light",onClick:S=>p(`${s}${S?`/${S}`:""}`),hoverCard:!0})})},s))})}),g.length!==K.length&&e(M,{ref:s=>{s&&I(s)},sx:{borderRadius:1},variant:"rectangular",width:"100%",height:100})]})}export{Qe as default};
