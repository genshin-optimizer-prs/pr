import{a as Y,g as Z,s as D,_ as C,r as m,u as ee,as as yt,at as kt,e as te,a8 as Je,au as $t,m as Mt,j as $,f as V,h as oe,av as Pe,P as St,i as wt,aw as Rt,ax as ve,b as N,ay as xe,x as Tt,l as Dt,d as Pt,B as r,D as _,az as me,a4 as P,aA as _t,ad as Fe,aB as _e,K as x,Z as R,ab as q,a1 as G,Y as Ee,aC as Et,ae as Ce,G as Xe,c as It,aD as ye,ah as Qe,ai as Ye,aE as At,aF as Nt,ac as le,R as Ie,Q as Ae,L as Bt,W as S,aG as fe,aH as zt,aI as Ze,aJ as ne,aK as jt,aL as Lt,z as ke,A as $e,ar as et,a9 as Ot,aM as Wt,aN as pe,I as Kt,aa as Vt,aO as qt,aP as Ne,aQ as Gt,F as Ut,aR as tt,aS as Ht,aT as Jt,aU as Ft,aV as Xt,aW as Qt,aX as Yt,aY as Be}from"./index-DKT1XKB6.js";import{u as ot,S as he,C as Zt,a as eo}from"./CharacterEditor-CBP3P2kZ.js";import{u as to,C as oo}from"./useForceUpdate-BeRA36vD.js";import{s as ao,t as ro,w as no,c as so,l as io,r as co,a as lo,d as uo}from"./index-DiND5WK4.js";import{u as po}from"./useLightCone-CiTvoJvn.js";import{T as mo,M as at,D as rt}from"./DropdownButton-BEHPTQJD.js";import{G as fo,d as nt}from"./LocationAutocomplete-Bg5iwxik.js";import{C as ho}from"./CardActionArea-egBHZQgE.js";import{u as go,R as bo}from"./RelicCard-Ddlhl96E.js";import{I as vo}from"./InfoTooltip-C9-hutZL.js";function xo(e){return Y("MuiCollapse",e)}Z("MuiCollapse",["root","horizontal","vertical","entered","hidden","wrapper","wrapperInner"]);const Co=["addEndListener","children","className","collapsedSize","component","easing","in","onEnter","onEntered","onEntering","onExit","onExited","onExiting","orientation","style","timeout","TransitionComponent"],yo=e=>{const{orientation:t,classes:o}=e,a={root:["root",`${t}`],entered:["entered"],hidden:["hidden"],wrapper:["wrapper",`${t}`],wrapperInner:["wrapperInner",`${t}`]};return oe(a,xo,o)},ko=D("div",{name:"MuiCollapse",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:o}=e;return[t.root,t[o.orientation],o.state==="entered"&&t.entered,o.state==="exited"&&!o.in&&o.collapsedSize==="0px"&&t.hidden]}})(({theme:e,ownerState:t})=>C({height:0,overflow:"hidden",transition:e.transitions.create("height")},t.orientation==="horizontal"&&{height:"auto",width:0,transition:e.transitions.create("width")},t.state==="entered"&&C({height:"auto",overflow:"visible"},t.orientation==="horizontal"&&{width:"auto"}),t.state==="exited"&&!t.in&&t.collapsedSize==="0px"&&{visibility:"hidden"})),$o=D("div",{name:"MuiCollapse",slot:"Wrapper",overridesResolver:(e,t)=>t.wrapper})(({ownerState:e})=>C({display:"flex",width:"100%"},e.orientation==="horizontal"&&{width:"auto",height:"100%"})),Mo=D("div",{name:"MuiCollapse",slot:"WrapperInner",overridesResolver:(e,t)=>t.wrapperInner})(({ownerState:e})=>C({width:"100%"},e.orientation==="horizontal"&&{width:"auto",height:"100%"})),st=m.forwardRef(function(t,o){const a=ee({props:t,name:"MuiCollapse"}),{addEndListener:n,children:s,className:d,collapsedSize:c="0px",component:u,easing:p,in:i,onEnter:l,onEntered:h,onEntering:f,onExit:b,onExited:g,onExiting:y,orientation:k="vertical",style:w,timeout:M=yt.standard,TransitionComponent:B=kt}=a,H=te(a,Co),j=C({},a,{orientation:k,collapsedSize:c}),E=yo(j),J=Je(),de=$t(),I=m.useRef(null),F=m.useRef(),L=typeof c=="number"?`${c}px`:c,z=k==="horizontal",X=z?"width":"height",ae=m.useRef(null),mt=Mt(o,ae),O=v=>T=>{if(v){const A=ae.current;T===void 0?v(A):v(A,T)}},ue=()=>I.current?I.current[z?"clientWidth":"clientHeight"]:0,ft=O((v,T)=>{I.current&&z&&(I.current.style.position="absolute"),v.style[X]=L,l&&l(v,T)}),ht=O((v,T)=>{const A=ue();I.current&&z&&(I.current.style.position="");const{duration:Q,easing:re}=Pe({style:w,timeout:M,easing:p},{mode:"enter"});if(M==="auto"){const De=J.transitions.getAutoHeightDuration(A);v.style.transitionDuration=`${De}ms`,F.current=De}else v.style.transitionDuration=typeof Q=="string"?Q:`${Q}ms`;v.style[X]=`${A}px`,v.style.transitionTimingFunction=re,f&&f(v,T)}),gt=O((v,T)=>{v.style[X]="auto",h&&h(v,T)}),bt=O(v=>{v.style[X]=`${ue()}px`,b&&b(v)}),vt=O(g),xt=O(v=>{const T=ue(),{duration:A,easing:Q}=Pe({style:w,timeout:M,easing:p},{mode:"exit"});if(M==="auto"){const re=J.transitions.getAutoHeightDuration(T);v.style.transitionDuration=`${re}ms`,F.current=re}else v.style.transitionDuration=typeof A=="string"?A:`${A}ms`;v.style[X]=L,v.style.transitionTimingFunction=Q,y&&y(v)}),Ct=v=>{M==="auto"&&de.start(F.current||0,v),n&&n(ae.current,v)};return $.jsx(B,C({in:i,onEnter:ft,onEntered:gt,onEntering:ht,onExit:bt,onExited:vt,onExiting:xt,addEndListener:Ct,nodeRef:ae,timeout:M==="auto"?null:M},H,{children:(v,T)=>$.jsx(ko,C({as:u,className:V(E.root,d,{entered:E.entered,exited:!i&&L==="0px"&&E.hidden}[v]),style:C({[z?"minWidth":"minHeight"]:L},w),ref:mt},T,{ownerState:C({},j,{state:v}),children:$.jsx($o,{ownerState:C({},j,{state:v}),className:E.wrapper,ref:I,children:$.jsx(Mo,{ownerState:C({},j,{state:v}),className:E.wrapperInner,children:s})})}))}))});st.muiSupportAuto=!0;const So=st,wo=m.createContext({}),it=wo;function Ro(e){return Y("MuiAccordion",e)}const To=Z("MuiAccordion",["root","rounded","expanded","disabled","gutters","region"]),se=To,Do=["children","className","defaultExpanded","disabled","disableGutters","expanded","onChange","square","slots","slotProps","TransitionComponent","TransitionProps"],Po=e=>{const{classes:t,square:o,expanded:a,disabled:n,disableGutters:s}=e;return oe({root:["root",!o&&"rounded",a&&"expanded",n&&"disabled",!s&&"gutters"],region:["region"]},Ro,t)},_o=D(St,{name:"MuiAccordion",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:o}=e;return[{[`& .${se.region}`]:t.region},t.root,!o.square&&t.rounded,!o.disableGutters&&t.gutters]}})(({theme:e})=>{const t={duration:e.transitions.duration.shortest};return{position:"relative",transition:e.transitions.create(["margin"],t),overflowAnchor:"none","&::before":{position:"absolute",left:0,top:-1,right:0,height:1,content:'""',opacity:1,backgroundColor:(e.vars||e).palette.divider,transition:e.transitions.create(["opacity","background-color"],t)},"&:first-of-type":{"&::before":{display:"none"}},[`&.${se.expanded}`]:{"&::before":{opacity:0},"&:first-of-type":{marginTop:0},"&:last-of-type":{marginBottom:0},"& + &":{"&::before":{display:"none"}}},[`&.${se.disabled}`]:{backgroundColor:(e.vars||e).palette.action.disabledBackground}}},({theme:e})=>({variants:[{props:t=>!t.square,style:{borderRadius:0,"&:first-of-type":{borderTopLeftRadius:(e.vars||e).shape.borderRadius,borderTopRightRadius:(e.vars||e).shape.borderRadius},"&:last-of-type":{borderBottomLeftRadius:(e.vars||e).shape.borderRadius,borderBottomRightRadius:(e.vars||e).shape.borderRadius,"@supports (-ms-ime-align: auto)":{borderBottomLeftRadius:0,borderBottomRightRadius:0}}}},{props:t=>!t.disableGutters,style:{[`&.${se.expanded}`]:{margin:"16px 0"}}}]})),Eo=m.forwardRef(function(t,o){const a=ee({props:t,name:"MuiAccordion"}),{children:n,className:s,defaultExpanded:d=!1,disabled:c=!1,disableGutters:u=!1,expanded:p,onChange:i,square:l=!1,slots:h={},slotProps:f={},TransitionComponent:b,TransitionProps:g}=a,y=te(a,Do),[k,w]=wt({controlled:p,default:d,name:"Accordion",state:"expanded"}),M=m.useCallback(z=>{w(!k),i&&i(z,!k)},[k,i,w]),[B,...H]=m.Children.toArray(n),j=m.useMemo(()=>({expanded:k,disabled:c,disableGutters:u,toggle:M}),[k,c,u,M]),E=C({},a,{square:l,disabled:c,disableGutters:u,expanded:k}),J=Po(E),de=C({transition:b},h),I=C({transition:g},f),[F,L]=go("transition",{elementType:So,externalForwardedProps:{slots:de,slotProps:I},ownerState:E});return $.jsxs(_o,C({className:V(J.root,s),ref:o,ownerState:E,square:l},y,{children:[$.jsx(it.Provider,{value:j,children:B}),$.jsx(F,C({in:k,timeout:"auto"},L,{children:$.jsx("div",{"aria-labelledby":B.props.id,id:B.props["aria-controls"],role:"region",className:J.region,children:H})}))]}))}),ze=Eo;function Io(e){return Y("MuiAccordionDetails",e)}Z("MuiAccordionDetails",["root"]);const Ao=["className"],No=e=>{const{classes:t}=e;return oe({root:["root"]},Io,t)},Bo=D("div",{name:"MuiAccordionDetails",slot:"Root",overridesResolver:(e,t)=>t.root})(({theme:e})=>({padding:e.spacing(1,2,2)})),zo=m.forwardRef(function(t,o){const a=ee({props:t,name:"MuiAccordionDetails"}),{className:n}=a,s=te(a,Ao),d=a,c=No(d);return $.jsx(Bo,C({className:V(c.root,n),ref:o,ownerState:d},s))}),je=zo;function jo(e){return Y("MuiAccordionSummary",e)}const Lo=Z("MuiAccordionSummary",["root","expanded","focusVisible","disabled","gutters","contentGutters","content","expandIconWrapper"]),W=Lo,Oo=["children","className","expandIcon","focusVisibleClassName","onClick"],Wo=e=>{const{classes:t,expanded:o,disabled:a,disableGutters:n}=e;return oe({root:["root",o&&"expanded",a&&"disabled",!n&&"gutters"],focusVisible:["focusVisible"],content:["content",o&&"expanded",!n&&"contentGutters"],expandIconWrapper:["expandIconWrapper",o&&"expanded"]},jo,t)},Ko=D(Rt,{name:"MuiAccordionSummary",slot:"Root",overridesResolver:(e,t)=>t.root})(({theme:e})=>{const t={duration:e.transitions.duration.shortest};return{display:"flex",minHeight:48,padding:e.spacing(0,2),transition:e.transitions.create(["min-height","background-color"],t),[`&.${W.focusVisible}`]:{backgroundColor:(e.vars||e).palette.action.focus},[`&.${W.disabled}`]:{opacity:(e.vars||e).palette.action.disabledOpacity},[`&:hover:not(.${W.disabled})`]:{cursor:"pointer"},variants:[{props:o=>!o.disableGutters,style:{[`&.${W.expanded}`]:{minHeight:64}}}]}}),Vo=D("div",{name:"MuiAccordionSummary",slot:"Content",overridesResolver:(e,t)=>t.content})(({theme:e})=>({display:"flex",flexGrow:1,margin:"12px 0",variants:[{props:t=>!t.disableGutters,style:{transition:e.transitions.create(["margin"],{duration:e.transitions.duration.shortest}),[`&.${W.expanded}`]:{margin:"20px 0"}}}]})),qo=D("div",{name:"MuiAccordionSummary",slot:"ExpandIconWrapper",overridesResolver:(e,t)=>t.expandIconWrapper})(({theme:e})=>({display:"flex",color:(e.vars||e).palette.action.active,transform:"rotate(0deg)",transition:e.transitions.create("transform",{duration:e.transitions.duration.shortest}),[`&.${W.expanded}`]:{transform:"rotate(180deg)"}})),Go=m.forwardRef(function(t,o){const a=ee({props:t,name:"MuiAccordionSummary"}),{children:n,className:s,expandIcon:d,focusVisibleClassName:c,onClick:u}=a,p=te(a,Oo),{disabled:i=!1,disableGutters:l,expanded:h,toggle:f}=m.useContext(it),b=k=>{f&&f(k),u&&u(k)},g=C({},a,{expanded:h,disabled:i,disableGutters:l}),y=Wo(g);return $.jsxs(Ko,C({focusRipple:!1,disableRipple:!0,disabled:i,component:"div","aria-expanded":h,className:V(y.root,s),focusVisibleClassName:V(y.focusVisible,c),onClick:b,ref:o,ownerState:g},p,{children:[$.jsx(Vo,{className:y.content,ownerState:g,children:n}),d&&$.jsx(qo,{className:y.expandIconWrapper,ownerState:g,children:d})]}))}),Le=Go;function Uo(e){return Y("MuiLinearProgress",e)}Z("MuiLinearProgress",["root","colorPrimary","colorSecondary","determinate","indeterminate","buffer","query","dashed","dashedColorPrimary","dashedColorSecondary","bar","barColorPrimary","barColorSecondary","bar1Indeterminate","bar1Determinate","bar1Buffer","bar2Indeterminate","bar2Buffer"]);const Ho=["className","color","value","valueBuffer","variant"];let U=e=>e,Oe,We,Ke,Ve,qe,Ge;const ge=4,Jo=ve(Oe||(Oe=U`
  0% {
    left: -35%;
    right: 100%;
  }

  60% {
    left: 100%;
    right: -90%;
  }

  100% {
    left: 100%;
    right: -90%;
  }
`)),Fo=ve(We||(We=U`
  0% {
    left: -200%;
    right: 100%;
  }

  60% {
    left: 107%;
    right: -8%;
  }

  100% {
    left: 107%;
    right: -8%;
  }
`)),Xo=ve(Ke||(Ke=U`
  0% {
    opacity: 1;
    background-position: 0 -23px;
  }

  60% {
    opacity: 0;
    background-position: 0 -23px;
  }

  100% {
    opacity: 1;
    background-position: -200px -23px;
  }
`)),Qo=e=>{const{classes:t,variant:o,color:a}=e,n={root:["root",`color${N(a)}`,o],dashed:["dashed",`dashedColor${N(a)}`],bar1:["bar",`barColor${N(a)}`,(o==="indeterminate"||o==="query")&&"bar1Indeterminate",o==="determinate"&&"bar1Determinate",o==="buffer"&&"bar1Buffer"],bar2:["bar",o!=="buffer"&&`barColor${N(a)}`,o==="buffer"&&`color${N(a)}`,(o==="indeterminate"||o==="query")&&"bar2Indeterminate",o==="buffer"&&"bar2Buffer"]};return oe(n,Uo,t)},Me=(e,t)=>t==="inherit"?"currentColor":e.vars?e.vars.palette.LinearProgress[`${t}Bg`]:e.palette.mode==="light"?Dt(e.palette[t].main,.62):Pt(e.palette[t].main,.5),Yo=D("span",{name:"MuiLinearProgress",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:o}=e;return[t.root,t[`color${N(o.color)}`],t[o.variant]]}})(({ownerState:e,theme:t})=>C({position:"relative",overflow:"hidden",display:"block",height:4,zIndex:0,"@media print":{colorAdjust:"exact"},backgroundColor:Me(t,e.color)},e.color==="inherit"&&e.variant!=="buffer"&&{backgroundColor:"none","&::before":{content:'""',position:"absolute",left:0,top:0,right:0,bottom:0,backgroundColor:"currentColor",opacity:.3}},e.variant==="buffer"&&{backgroundColor:"transparent"},e.variant==="query"&&{transform:"rotate(180deg)"})),Zo=D("span",{name:"MuiLinearProgress",slot:"Dashed",overridesResolver:(e,t)=>{const{ownerState:o}=e;return[t.dashed,t[`dashedColor${N(o.color)}`]]}})(({ownerState:e,theme:t})=>{const o=Me(t,e.color);return C({position:"absolute",marginTop:0,height:"100%",width:"100%"},e.color==="inherit"&&{opacity:.3},{backgroundImage:`radial-gradient(${o} 0%, ${o} 16%, transparent 42%)`,backgroundSize:"10px 10px",backgroundPosition:"0 -23px"})},xe(Ve||(Ve=U`
    animation: ${0} 3s infinite linear;
  `),Xo)),ea=D("span",{name:"MuiLinearProgress",slot:"Bar1",overridesResolver:(e,t)=>{const{ownerState:o}=e;return[t.bar,t[`barColor${N(o.color)}`],(o.variant==="indeterminate"||o.variant==="query")&&t.bar1Indeterminate,o.variant==="determinate"&&t.bar1Determinate,o.variant==="buffer"&&t.bar1Buffer]}})(({ownerState:e,theme:t})=>C({width:"100%",position:"absolute",left:0,bottom:0,top:0,transition:"transform 0.2s linear",transformOrigin:"left",backgroundColor:e.color==="inherit"?"currentColor":(t.vars||t).palette[e.color].main},e.variant==="determinate"&&{transition:`transform .${ge}s linear`},e.variant==="buffer"&&{zIndex:1,transition:`transform .${ge}s linear`}),({ownerState:e})=>(e.variant==="indeterminate"||e.variant==="query")&&xe(qe||(qe=U`
      width: auto;
      animation: ${0} 2.1s cubic-bezier(0.65, 0.815, 0.735, 0.395) infinite;
    `),Jo)),ta=D("span",{name:"MuiLinearProgress",slot:"Bar2",overridesResolver:(e,t)=>{const{ownerState:o}=e;return[t.bar,t[`barColor${N(o.color)}`],(o.variant==="indeterminate"||o.variant==="query")&&t.bar2Indeterminate,o.variant==="buffer"&&t.bar2Buffer]}})(({ownerState:e,theme:t})=>C({width:"100%",position:"absolute",left:0,bottom:0,top:0,transition:"transform 0.2s linear",transformOrigin:"left"},e.variant!=="buffer"&&{backgroundColor:e.color==="inherit"?"currentColor":(t.vars||t).palette[e.color].main},e.color==="inherit"&&{opacity:.3},e.variant==="buffer"&&{backgroundColor:Me(t,e.color),transition:`transform .${ge}s linear`}),({ownerState:e})=>(e.variant==="indeterminate"||e.variant==="query")&&xe(Ge||(Ge=U`
      width: auto;
      animation: ${0} 2.1s cubic-bezier(0.165, 0.84, 0.44, 1) 1.15s infinite;
    `),Fo)),oa=m.forwardRef(function(t,o){const a=ee({props:t,name:"MuiLinearProgress"}),{className:n,color:s="primary",value:d,valueBuffer:c,variant:u="indeterminate"}=a,p=te(a,Ho),i=C({},a,{color:s,variant:u}),l=Qo(i),h=Tt(),f={},b={bar1:{},bar2:{}};if((u==="determinate"||u==="buffer")&&d!==void 0){f["aria-valuenow"]=Math.round(d),f["aria-valuemin"]=0,f["aria-valuemax"]=100;let g=d-100;h&&(g=-g),b.bar1.transform=`translateX(${g}%)`}if(u==="buffer"&&c!==void 0){let g=(c||0)-100;h&&(g=-g),b.bar2.transform=`translateX(${g}%)`}return $.jsxs(Yo,C({className:V(l.root,n),ownerState:i,role:"progressbar"},f,{ref:o},p,{children:[u==="buffer"?$.jsx(Zo,{className:l.dashed,ownerState:i}):null,$.jsx(ea,{className:l.bar1,ownerState:i,style:b.bar1}),u==="determinate"?null:$.jsx(ta,{className:l.bar2,ownerState:i,style:b.bar2})]}))}),aa=oa;function Ue({value:e,onChange:t,...o}){const[a,n]=m.useState(e);m.useEffect(()=>{n(e)},[e]);const s=()=>t(a);return r(mo,{value:a,onChange:d=>n(d.target.value),onBlur:s,onKeyDown:d=>d.key==="Enter"&&!o.multiline&&s(),...o})}function ra(e){const{t}=_("ui"),o=me({path:"/:page/*"}),a=t("pageTitle"),n=e??((o==null?void 0:o.params.page)&&t(`tabs.${o==null?void 0:o.params.page}`));m.useEffect(()=>{n?document.title=`${n} - ${a}`:document.title=a},[t,a,n])}function Se(e,t){const[o,a]=to(),n=m.useMemo(()=>o&&e.get(t),[o,e,t]);return m.useEffect(()=>e.follow(t,a),[e,t,a]),n}function na(e){const{database:t}=P();return Se(t.builds,e??"")}function ct(e){const t=m.useMemo(()=>e||_t(Fe,()=>""),[e]),{database:o}=P(),[a,n]=m.useState(()=>_e(t,s=>o.relics.get(s)));return m.useEffect(()=>{n(_e(t,d=>o.relics.get(d)));const s=Object.values(t).map(d=>o.relics.follow(d,(c,u,p)=>{u==="update"&&n(i=>({...i,[p.slotKey]:p})),u==="remove"&&n(i=>({...i,[p.slotKey]:void 0}))}));return()=>s.forEach(d=>d())},[o,t]),a}function K(e){const{database:t}=P();return Se(t.loadouts,e??"")}function lt(e){const{database:t}=P();return Se(t.teams,e)}function sa({slot:e}){const{t}=_("relic");return r(G,{sx:{height:"100%"},children:x(q,{children:[x(R,{children:[t("slot"),": ",e]}),r(R,{children:t("empty")})]})})}function ia({build:e}){const t=ct(e);return r(Ee,{container:!0,columns:3,spacing:1,children:Fe.map(o=>{const a=t[o];return r(Ee,{item:!0,xs:1,children:a?r(bo,{relic:a}):r(sa,{slot:o})},`${o}_${a==null?void 0:a.id}`)})})}function ca({charKey:e,setCharKey:t}){const{t:o}=_(["character","charNames_gen"]),{database:a}=P(),n=m.useCallback(c=>!!a.chars.get(c),[a.chars]),s=m.useCallback(c=>a.charMeta.get(c).favorite,[a.charMeta]),d=m.useMemo(()=>[{key:"",label:o("character:autocomplete.none")},...Et.map(c=>({key:c,label:o(`charNames_gen:${c}`),favorite:s(c),color:n(c)?void 0:"secondary"}))],[n,s,o]);return r(m.Suspense,{fallback:r(Ce,{variant:"text",width:100}),children:r(fo,{options:d,toImg:()=>r(Xe,{children:" "}),valueKey:e,onChange:c=>t(c??"")})})}const la=It($.jsx("path",{d:"M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zm2.46-7.12 1.41-1.41L12 12.59l2.12-2.12 1.41 1.41L13.41 14l2.12 2.12-1.41 1.41L12 15.41l-2.12 2.12-1.41-1.41L10.59 14l-2.13-2.12zM15.5 4l-1-1h-5l-1 1H5v2h14V4z"}),"DeleteForever");function dt({optTarget:e,setOptTarget:t}){const{t:o}=_("optimize"),{calc:a}=ye(),n=Qe(Ye,{et:"self",src:"0"});return r(rt,{title:`${o("optTarget")}${e?`: ${e.tag.name||e.tag.q}`:""}`,children:a==null?void 0:a.listFormulas(n.listing.formulas).map((s,d)=>r(at,{onClick:()=>t(s),children:s.tag.name||s.tag.q},`${d}_${s.tag.name||s.tag.q}`))})}function da({statFilters:e,setStatFilters:t,disabled:o=!1}){const a=m.useCallback((u,p,i)=>{const l={...e},h=JSON.stringify(p),f=p?[...e[h]]:void 0,b=JSON.stringify(u),g=[...e[b]??[]];i!==void 0&&f?g.push(f[i]):g.push({minValue:0,maxValue:0,disabled:!1}),l[b]=g,i!==void 0&&f&&(f.splice(i,1),f.length?l[h]=f:delete l[h]),t({...l})},[t,e]),n=m.useCallback((u,p)=>{const i={...e},l=JSON.stringify(u),h=[...e[l]];h.splice(p,1),h.length?i[l]=h:delete i[l],t({...i})},[t,e]),s=m.useCallback((u,p,i)=>{const l={...e},h=JSON.stringify(u),f=[...e[h]];f[p]={...f[p],minValue:i},l[h]=f,t({...l})},[t,e]),d=m.useCallback((u,p,i)=>{const l={...e},h=JSON.stringify(u),f=[...e[h]];f[p]={...f[p],maxValue:i},l[h]=f,t({...l})},[t,e]),c=m.useCallback((u,p,i)=>{const l={...e},h=JSON.stringify(u),f=[...e[h]];f[p]={...f[p],disabled:i},l[h]=f,t({...l})},[t,e]);return x(Xe,{children:[Object.entries(e).flatMap(([u,p])=>p==null?void 0:p.map((i,l)=>r(He,{path:JSON.parse(u),setting:i,index:l,setTarget:a,delTarget:n,setMinValue:s,setMaxValue:d,setDisabled:c,disabled:o},u+l))),r(He,{delTarget:n,setTarget:a,setMinValue:s,setMaxValue:d,setDisabled:c,disabled:o})]})}function He({path:e,setting:t,index:o,delTarget:a,setMinValue:n,setMaxValue:s,setDisabled:d,disabled:c}){const{t:u}=_("page_character_optimize"),p=m.useCallback(b=>e&&o!==void 0&&n(e,o,b??0),[n,e,o]),i=m.useCallback(b=>e&&o!==void 0&&s(e,o,b??1/0),[s,e,o]),[l,h]=m.useState(void 0),f={p:1,flexBasis:30,flexGrow:0,flexShrink:0};return x(Bt,{sx:{"& .MuiButtonGroup-grouped":{minWidth:24},width:"100%"},children:[!!t&&!!e&&o!==void 0&&r(le,{sx:f,color:t.disabled?"secondary":"success",onClick:()=>d(e,o,!t.disabled),disabled:c,children:t.disabled?r(At,{}):r(Nt,{})}),r(Ae,{sx:{flexBasis:150,flexGrow:1},children:r(Ie,{float:!0,disabled:!e||c,value:t==null?void 0:t.minValue,placeholder:u("buildConstraint.minStatValue"),onChange:p,sx:{px:1},inputProps:{sx:{"& + .MuiOutlinedInput-notchedOutline":{borderRadius:0},textAlign:"right"}}})}),r(dt,{optTarget:l,setOptTarget:h}),r(Ae,{sx:{flexBasis:150,flexGrow:1},children:r(Ie,{float:!0,disabled:!e||c,value:t==null?void 0:t.maxValue,placeholder:u("buildConstraint.maxStatValue"),onChange:i,sx:{px:1},inputProps:{sx:{"& + .MuiOutlinedInput-notchedOutline":{borderRadius:0},textAlign:"left"}}})}),!!e&&o!==void 0&&r(le,{sx:f,color:"error",onClick:()=>a(e,o),disabled:c,children:r(la,{fontSize:"small"})})]})}function ua({disabled:e=!1}){const{t}=_("page_character_optimize"),[o,a]=m.useState({});return r(S,{children:x(G,{bgt:"light",children:[r(q,{sx:{display:"flex",gap:1,justifyContent:"space-between",flexDirection:"column"},children:x(S,{display:"flex",justifyContent:"space-between",children:[r(R,{sx:{fontWeight:"bold"},children:t`constraintFilter.title`}),r(vo,{title:r(R,{children:t`constraintFilter.tooltip`})})]})}),r(fe,{}),r(S,{display:"flex",flexDirection:"column",gap:.5,children:r(da,{statFilters:o,setStatFilters:a,disabled:e})})]})})}function pa({numWorkers:e,setNumWorkers:t}){const{t:o}=_("optimize"),a=navigator.hardwareConcurrency||8;return r(rt,{title:`${o("numWorkers")}: ${e}`,children:zt(1,a).map(n=>r(at,{onClick:()=>t(n),children:o("workers",{count:n})},n))})}function ma({teamId:e,children:t}){var f,b,g,y;const o=lt(e),a=K((f=o.loadoutMetadata[0])==null?void 0:f.loadoutId),n=K((b=o.loadoutMetadata[1])==null?void 0:b.loadoutId),s=K((g=o.loadoutMetadata[2])==null?void 0:g.loadoutId),d=K((y=o.loadoutMetadata[3])==null?void 0:y.loadoutId),c={all:"all"};a&&(c[a.key]="0"),n&&(c[n.key]="1"),s&&(c[s.key]="2"),d&&(c[d.key]="3");const u=ie(o.loadoutMetadata[0],c),p=ie(o.loadoutMetadata[1],c),i=ie(o.loadoutMetadata[2],c),l=ie(o.loadoutMetadata[3],c),h=m.useMemo(()=>({calc:ao([...ro(o.loadoutMetadata.map((k,w)=>k===void 0?void 0:Ze[w]).filter(k=>!!k)),...u?ce(0,u):[],...p?ce(1,p):[],...i?ce(2,i):[],...l?ce(3,l):[],ne.common.lvl.add(80),ne.common.res.add(.1),ne.common.isBroken.add(0),ne.common.maxToughness.add(100),jt.common.critMode.add("avg")])}),[u,p,i,l,o.loadoutMetadata]);return r(Lt.Provider,{value:h,children:t})}function ie(e,t){const o=K(e==null?void 0:e.loadoutId),a=ot(o==null?void 0:o.key),n=na(e==null?void 0:e.buildId),s=po(n==null?void 0:n.lightConeId),d=ct(n==null?void 0:n.relicIds),c=o==null?void 0:o.conditional,u=Object.fromEntries(Object.entries(c??{}).map(([p,i])=>[t[p],i]));return{character:a,lightCone:s,relics:d,conditionals:u}}function ce(e,{character:t,lightCone:o,relics:a,conditionals:n}){return t?[...no(`${e}`,...so(t),...io(o),...co(Object.values(a).filter(s=>!!s).map(s=>({set:s.setKey,stats:[...s.substats.filter(({key:d})=>d!=="").map(d=>({key:d.key,value:d.accurateValue})),{key:s.mainStatKey,value:s.mainStatVal}]})))),...lo(`${e}`,n)]:[]}var we={},fa=$e;Object.defineProperty(we,"__esModule",{value:!0});var ut=we.default=void 0,ha=fa(ke()),ga=$,ba=(0,ha.default)((0,ga.jsx)("path",{d:"M22 24H2v-4h20v4zM13.06 5.19l3.75 3.75L7.75 18H4v-3.75l9.06-9.06zm4.82 2.68-3.75-3.75 1.83-1.83c.39-.39 1.02-.39 1.41 0l2.34 2.34c.39.39.39 1.02 0 1.41l-1.83 1.83z"}),"BorderColor");ut=we.default=ba;function va({teamId:e,charKey:t,tab:o=""}){const{t:a}=_("page_team"),n=et(),{database:s}=P(),d=s.teams.get(e),{loadoutMetadata:c}=d,u=Je(),p=Ot(u.breakpoints.down("md")),[i,l]=m.useState(!1),h=b=>{s.teams.set(e,{name:b})},f=b=>{s.teams.set(e,{description:b})};return x(S,{sx:()=>({borderBottom:"1px rgb(200,200,200,0.3) solid","& .MuiTab-root:hover":{transition:"background-color 0.25s ease",backgroundColor:"rgba(255,255,255,0.1)"},"& .Mui-selected":{color:"white !important"},"& .MuiTabs-indicator":{height:"4px",backgroundColor:"rgb(200,200,200,0.5)"}}),children:[r(ho,{onClick:()=>l(!0),children:r(Wt,{placement:"top",title:x(S,{children:[x(S,{sx:{display:"flex",color:"info.light",gap:1},children:[r(ut,{}),r(R,{children:r("strong",{children:a`team.editNameDesc`})})]}),!!d.description&&r(R,{children:d.description})]}),children:r(q,{sx:{display:"flex",justifyContent:"center","&:hover":{color:"info.light"}},children:x(R,{variant:"h5",sx:{display:"flex",gap:1,alignItems:"center",justifyContent:"center",textShadow:"#000 0 0 10px !important"},children:[r(pe,{}),d.name]})})})}),r(Vt,{open:i,onClose:()=>l(!1),children:x(G,{children:[r(oo,{title:a`team.editNameDesc`,avatar:r(pe,{}),titleTypographyProps:{variant:"h6"},action:r(Kt,{onClick:()=>l(!1),children:r(nt,{})})}),r(fe,{}),r(q,{children:x(S,{display:"flex",flexDirection:"column",gap:2,sx:{mt:2},children:[r(Ue,{label:a`team.name`,value:d.name,onChange:b=>h(b),autoFocus:!0}),r(Ue,{label:a`team.desc`,value:d.description,onChange:b=>f(b),multiline:!0,minRows:4})]})})]})}),r(fe,{}),x(qt,{variant:"fullWidth",value:t??"team",orientation:p?"vertical":"horizontal",children:[r(Ne,{icon:r(pe,{}),iconPosition:"start",value:"team",label:"Team Settings",onClick:()=>n(`/teams/${e}/`)}),c.map((b,g)=>{var k;const y=b&&((k=s.loadouts.get(b==null?void 0:b.loadoutId))==null?void 0:k.key);return r(Ne,{icon:r(Gt,{}),iconPosition:"start",value:y??g,disabled:!c[g],label:y?r(R,{children:a(`charNames_gen:${y}`)}):`Character ${g+1}`,onClick:()=>y&&n(`/teams/${e}/${y}/${o}`)},g)})]})]})}function xa({teamId:e}){const{database:t}=P(),o=t.teams.get(e);return x(S,{children:[e,o.loadoutMetadata.map((a,n)=>r(Ca,{loadoutMetadataIndex:n,teamId:e},`${n}_${a==null?void 0:a.loadoutId}`))]})}function Ca({loadoutMetadataIndex:e,teamId:t}){var c;const{database:o}=P(),a=o.teams.get(t),n=(c=a.loadoutMetadata[e])==null?void 0:c.loadoutId,s=o.loadouts.get(n);function d(u){if(u===""){o.teams.set(t,i=>i.loadoutMetadata[e]=void 0);return}o.chars.getOrCreate(u);const p=a.loadoutMetadata.findIndex(i=>{var l;return i&&((l=o.loadouts.get(i.loadoutId))==null?void 0:l.key)===u});if(p===-1){let i=o.loadouts.keys.find(l=>o.loadouts.get(l).key===u);i||(i=o.loadouts.new(u)),o.teams.set(t,l=>{l.loadoutMetadata[e]={loadoutId:i}})}else{if(p===e)return;const i=a.loadoutMetadata[p],l=a.loadoutMetadata[e];o.teams.set(t,h=>{h.loadoutMetadata[e]=i,h.loadoutMetadata[p]=l})}}return r(ca,{charKey:(s==null?void 0:s.key)??"",setCharKey:d})}var Re={},ya=$e;Object.defineProperty(Re,"__esModule",{value:!0});var be=Re.default=void 0,ka=ya(ke()),$a=$,Ma=(0,ka.default)((0,$a.jsx)("path",{d:"M16.59 8.59 12 13.17 7.41 8.59 6 10l6 6 6-6z"}),"ExpandMore");be=Re.default=Ma;const Sa=5e4;class wa{constructor(t,o,a,n,s){this.calc=t,this.optTarget=o,this.relicsBySlot=a,this.numWorkers=n,this.setProgress=s,this.worker=new Worker(new URL(""+new URL("parentWorker-CE4m1G7S.js",import.meta.url).href,import.meta.url),{type:"module"})}async optimize(){return await new Promise((o,a)=>{this.worker.onmessage=({data:s})=>{switch(s.resultType){case"progress":this.setProgress(s.progress);break;case"done":o(s.buildResults);break;case"err":console.log(s),a();break}};const n={command:"start",relicsBySlot:this.relicsBySlot,detachedNodes:this.detachNodes(),numWorkers:this.numWorkers};this.worker.postMessage(n)})}async terminate(){const t={command:"terminate"};this.worker.postMessage(t),await new Promise((o,a)=>{this.worker.onmessage=({data:n})=>{switch(n.resultType){case"terminated":o();break;case"err":console.log(n),a();break}}}),this.worker.terminate()}detachNodes(){const t=new Set(Ut);return uo([this.optTarget],this.calc,a=>{if(a.src==="0"&&a.et==="self"){if(a.sheet==="dyn"&&a.qt==="premod")return{q:a.q};if(a.q==="count"&&t.has(a.sheet))return{q:a.sheet}}})}}var Te={},Ra=$e;Object.defineProperty(Te,"__esModule",{value:!0});var pt=Te.default=void 0,Ta=Ra(ke()),Da=$,Pa=(0,Ta.default)((0,Da.jsx)("path",{d:"m16 6 2.29 2.29-4.88 4.88-4-4L2 16.59 3.41 18l6-6 4 4 6.3-6.29L22 12V6z"}),"TrendingUp");pt=Te.default=Pa;function _a(){const{t:e}=_("optimize"),{database:t}=P(),{calc:o}=ye(),[a,n]=m.useState(8),[s,d]=m.useState(void 0),[c,u]=m.useState(void 0),p=m.useMemo(()=>t.relics.values.reduce((w,M)=>(w[M.slotKey].push(M),w),{head:[],hand:[],feet:[],body:[],sphere:[],rope:[]}),[t.relics.values]),i=Object.values(p).reduce((w,M)=>w*M.length,1),[l,h]=m.useState(void 0),[f,b]=m.useState(!1),g=m.useRef(()=>{});m.useEffect(()=>()=>g.current(),[]);const y=m.useCallback(async()=>{if(!c||!o)return;const w=new Promise(H=>g.current=H);d(void 0),b(!0);const M=new wa(o,c,p,a,d);w.then(async()=>await M.terminate());const B=await M.optimize();await M.terminate(),g.current=()=>{},b(!1),h(B[0])},[o,a,c,p]),k=m.useCallback(()=>{g.current(),b(!1)},[g]);return r(G,{bgt:"dark",children:x(q,{children:[r(ua,{}),x(he,{children:[r(R,{variant:"h5",children:e("optimize")}),x(S,{children:[r(dt,{optTarget:c,setOptTarget:u}),r(pa,{numWorkers:a,setNumWorkers:n}),r(le,{onClick:f?k:y,color:f?"error":"primary",startIcon:f?r(nt,{}):r(pt,{}),children:e(f?"cancel":"optimize")})]}),s&&r(Ea,{progress:s,totalPermutations:i}),l&&x(S,{children:[x(R,{children:["Best: ",l.value]}),r(ia,{build:l.ids})]})]})]})})}function Ea({progress:e,totalPermutations:t}){const{t:o}=_("optimize");return x(S,{children:[x(R,{children:[o("totalProgress"),": ",e.numBuildsComputed.toLocaleString()," /"," ",t.toLocaleString()]}),x(R,{children:[o("buildsKept"),": ",e.numBuildsKept.toLocaleString()," /"," ",Sa.toLocaleString()]}),r(aa,{variant:"determinate",value:e.numBuildsComputed/t*100})]})}function Ia({tab:e}){const{team:t,loadout:{key:o}}=tt(),{database:a}=P(),{character:n}=Ht(),{calc:s}=ye(),[d,c]=m.useState(void 0),u=t.loadoutMetadata.findIndex(i=>{var l;return((l=a.loadouts.get(i==null?void 0:i.loadoutId))==null?void 0:l.key)===o}),p=Qe(Ye,{et:"self",src:Ze[u]});return x(S,{children:[e,r(Zt,{characterKey:d,onClose:()=>c(void 0)}),r(eo,{character:n}),x(he,{gap:1,pt:1,children:[r(G,{bgt:"dark",children:x(q,{children:[r(le,{disabled:!o,onClick:()=>o&&c(o),children:"Edit Character"}),x(ze,{children:[r(Le,{expandIcon:r(be,{}),children:"All target values, if sheet is created"}),r(je,{children:r(he,{children:s==null?void 0:s.listFormulas(p.listing.formulas).map((i,l)=>{const h=s.compute(i),f=i.tag.name||i.tag.q;return x(S,{children:[x(R,{children:[f,": ",h.val]}),x(ze,{children:[x(Le,{expandIcon:r(be,{}),children:["debug for ",f]}),r(je,{children:r(R,{component:"pre",children:JSON.stringify(s.toDebug().compute(i),void 0,2)})})]})]},`${f}${l}`)})})})]})]})}),r(_a,{})]})]})}const Aa=r(Ce,{variant:"rectangular",width:"100%",height:1e3});function Ha(){const{database:e}=P(),{teamId:t}=Jt(),o=!t||!e.teams.keys.includes(t);return m.useEffect(()=>{o||e.teams.set(t,{lastEdit:Date.now()})},[t,e.teams,o]),o?r(Qt,{to:"/teams"}):r(S,{display:"flex",flexDirection:"column",gap:1,children:r(m.Suspense,{fallback:Aa,children:t&&r(Na,{teamId:t})})})}function Na({teamId:e}){var f;const{database:t}=P(),o=et(),a=lt(e),{loadoutMetadata:n}=a,{params:{characterKey:s}}=me({path:"/teams/:teamId/:characterKey",end:!1})??{params:{}},{params:{tab:d}}=me({path:"/teams/:teamId/:characterKey/:tab"})??{params:{}},c=m.useMemo(()=>n.find(g=>{var y;return(g==null?void 0:g.loadoutId)&&((y=t.loadouts.get(g.loadoutId))==null?void 0:y.key)===s}),[n,t.loadouts,s]);m.useEffect(()=>{window.scrollTo({top:0})},[]),m.useEffect(()=>{c||o("",{replace:!0})},[c,o]);const u=c==null?void 0:c.loadoutId,p=(f=t.loadouts.get(u))==null?void 0:f.key,{t:i}=_(["charNames_gen","page_character"]);ra(m.useMemo(()=>{const b=i(p?"charNames_gen:Character":"Team Settings"),g=d?i(`page_character:tabs.${d}`):p?i("Loadout/Build"):d;return`${a.name} - ${b}${g?` - ${g}`:""}`},[p,i,d,a.name]));const l=K(u??""),h=m.useMemo(()=>{if(!(!u||!l||!c))return{teamId:e,team:a,loadoutId:u,loadout:l,loadoutMetadatum:c}},[c,a,l,u,e]);return r(ma,{teamId:e,children:x(S,{sx:{display:"flex",gap:1,flexDirection:"column",mx:1,mt:2},children:[r(G,{children:r(va,{teamId:e,charKey:p,tab:d})}),r(S,{children:h?r(Ft.Provider,{value:h,children:r(Ba,{})}):r(xa,{teamId:e})})]})})}function Ba({tab:e}){const{loadout:{key:t}}=tt(),o=ot(t),a=m.useMemo(()=>o&&{character:o},[o]);return a?r(Xt.Provider,{value:a,children:r(Yt,{children:r(Be,{path:":characterKey",children:r(Be,{path:"*",index:!0,element:r(Ia,{tab:e})})})})}):r(Ce,{variant:"rectangular",width:"100%",height:1e3})}export{Ha as default};
