import{a as Z,g as ee,s as _,_ as y,r as m,u as te,as as Dt,at as Tt,e as oe,a8 as Ce,au as _t,m as Pt,j as $,f as U,h as re,av as Le,P as It,i as At,aw as Nt,ax as ke,b as B,ay as $e,x as zt,l as Bt,d as Et,K as v,B as r,Z as w,W as S,D,az as be,a4 as P,aA as Lt,ad as rt,aB as je,ab as O,a1 as E,Y as I,aC as jt,ae as Se,G as me,c as Ot,aD as Wt,aE as Kt,aF as ue,aG as at,ah as Me,ai as we,aH as Vt,aI as qt,ac as pe,R as Oe,Q as We,L as Gt,aJ as nt,aK as st,aL as ie,aM as Ut,z as Re,A as De,ar as it,a9 as lt,aN as Ht,aO as ge,I as Jt,aa as Ft,aP as Xt,aQ as Ke,aR as Qt,F as Yt,aS as Te,aT as Ve,aU as Zt,aV as eo,aW as to,aX as oo,aY as ro,aZ as ao,a_ as no,a$ as so,b0 as qe}from"./index-B74mG63j.js";import{u as ct,S as ve,C as io,a as lo}from"./CharacterEditor-al2cD558.js";import{u as co,C as uo}from"./useForceUpdate-p4S8D62X.js";import{s as po,t as mo,w as fo,c as ho,l as go,r as bo,a as vo,d as xo}from"./index-jii3Wnp5.js";import{u as yo}from"./useLightCone-D1atmCCJ.js";import{T as Co,d as ko,M as _e,D as Pe}from"./DropdownButton-BzAfyZwk.js";import{G as $o,d as dt}from"./LocationAutocomplete-C8AB-l3n.js";import{C as ut}from"./CardActionArea-CNRnH8Bu.js";import{u as So,R as Mo}from"./RelicCard-CJV5AdrX.js";import{I as wo}from"./InfoTooltip-Cg8HEtfY.js";function Ro(e){return Z("MuiCollapse",e)}ee("MuiCollapse",["root","horizontal","vertical","entered","hidden","wrapper","wrapperInner"]);const Do=["addEndListener","children","className","collapsedSize","component","easing","in","onEnter","onEntered","onEntering","onExit","onExited","onExiting","orientation","style","timeout","TransitionComponent"],To=e=>{const{orientation:t,classes:o}=e,a={root:["root",`${t}`],entered:["entered"],hidden:["hidden"],wrapper:["wrapper",`${t}`],wrapperInner:["wrapperInner",`${t}`]};return re(a,Ro,o)},_o=_("div",{name:"MuiCollapse",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:o}=e;return[t.root,t[o.orientation],o.state==="entered"&&t.entered,o.state==="exited"&&!o.in&&o.collapsedSize==="0px"&&t.hidden]}})(({theme:e,ownerState:t})=>y({height:0,overflow:"hidden",transition:e.transitions.create("height")},t.orientation==="horizontal"&&{height:"auto",width:0,transition:e.transitions.create("width")},t.state==="entered"&&y({height:"auto",overflow:"visible"},t.orientation==="horizontal"&&{width:"auto"}),t.state==="exited"&&!t.in&&t.collapsedSize==="0px"&&{visibility:"hidden"})),Po=_("div",{name:"MuiCollapse",slot:"Wrapper",overridesResolver:(e,t)=>t.wrapper})(({ownerState:e})=>y({display:"flex",width:"100%"},e.orientation==="horizontal"&&{width:"auto",height:"100%"})),Io=_("div",{name:"MuiCollapse",slot:"WrapperInner",overridesResolver:(e,t)=>t.wrapperInner})(({ownerState:e})=>y({width:"100%"},e.orientation==="horizontal"&&{width:"auto",height:"100%"})),pt=m.forwardRef(function(t,o){const a=te({props:t,name:"MuiCollapse"}),{addEndListener:n,children:s,className:c,collapsedSize:l="0px",component:u,easing:p,in:i,onEnter:d,onEntered:h,onEntering:f,onExit:b,onExited:g,onExiting:C,orientation:k="vertical",style:R,timeout:M=Dt.standard,TransitionComponent:L=Tt}=a,J=oe(a,Do),W=y({},a,{orientation:k,collapsedSize:l}),A=To(W),F=Ce(),fe=_t(),N=m.useRef(null),X=m.useRef(),K=typeof l=="number"?`${l}px`:l,j=k==="horizontal",Q=j?"width":"height",ne=m.useRef(null),yt=Pt(o,ne),V=x=>T=>{if(x){const z=ne.current;T===void 0?x(z):x(z,T)}},he=()=>N.current?N.current[j?"clientWidth":"clientHeight"]:0,Ct=V((x,T)=>{N.current&&j&&(N.current.style.position="absolute"),x.style[Q]=K,d&&d(x,T)}),kt=V((x,T)=>{const z=he();N.current&&j&&(N.current.style.position="");const{duration:Y,easing:se}=Le({style:R,timeout:M,easing:p},{mode:"enter"});if(M==="auto"){const Ee=F.transitions.getAutoHeightDuration(z);x.style.transitionDuration=`${Ee}ms`,X.current=Ee}else x.style.transitionDuration=typeof Y=="string"?Y:`${Y}ms`;x.style[Q]=`${z}px`,x.style.transitionTimingFunction=se,f&&f(x,T)}),$t=V((x,T)=>{x.style[Q]="auto",h&&h(x,T)}),St=V(x=>{x.style[Q]=`${he()}px`,b&&b(x)}),Mt=V(g),wt=V(x=>{const T=he(),{duration:z,easing:Y}=Le({style:R,timeout:M,easing:p},{mode:"exit"});if(M==="auto"){const se=F.transitions.getAutoHeightDuration(T);x.style.transitionDuration=`${se}ms`,X.current=se}else x.style.transitionDuration=typeof z=="string"?z:`${z}ms`;x.style[Q]=K,x.style.transitionTimingFunction=Y,C&&C(x)}),Rt=x=>{M==="auto"&&fe.start(X.current||0,x),n&&n(ne.current,x)};return $.jsx(L,y({in:i,onEnter:Ct,onEntered:$t,onEntering:kt,onExit:St,onExited:Mt,onExiting:wt,addEndListener:Rt,nodeRef:ne,timeout:M==="auto"?null:M},J,{children:(x,T)=>$.jsx(_o,y({as:u,className:U(A.root,c,{entered:A.entered,exited:!i&&K==="0px"&&A.hidden}[x]),style:y({[j?"minWidth":"minHeight"]:K},R),ref:yt},T,{ownerState:y({},W,{state:x}),children:$.jsx(Po,{ownerState:y({},W,{state:x}),className:A.wrapper,ref:N,children:$.jsx(Io,{ownerState:y({},W,{state:x}),className:A.wrapperInner,children:s})})}))}))});pt.muiSupportAuto=!0;const mt=pt,Ao=m.createContext({}),ft=Ao;function No(e){return Z("MuiAccordion",e)}const zo=ee("MuiAccordion",["root","rounded","expanded","disabled","gutters","region"]),le=zo,Bo=["children","className","defaultExpanded","disabled","disableGutters","expanded","onChange","square","slots","slotProps","TransitionComponent","TransitionProps"],Eo=e=>{const{classes:t,square:o,expanded:a,disabled:n,disableGutters:s}=e;return re({root:["root",!o&&"rounded",a&&"expanded",n&&"disabled",!s&&"gutters"],region:["region"]},No,t)},Lo=_(It,{name:"MuiAccordion",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:o}=e;return[{[`& .${le.region}`]:t.region},t.root,!o.square&&t.rounded,!o.disableGutters&&t.gutters]}})(({theme:e})=>{const t={duration:e.transitions.duration.shortest};return{position:"relative",transition:e.transitions.create(["margin"],t),overflowAnchor:"none","&::before":{position:"absolute",left:0,top:-1,right:0,height:1,content:'""',opacity:1,backgroundColor:(e.vars||e).palette.divider,transition:e.transitions.create(["opacity","background-color"],t)},"&:first-of-type":{"&::before":{display:"none"}},[`&.${le.expanded}`]:{"&::before":{opacity:0},"&:first-of-type":{marginTop:0},"&:last-of-type":{marginBottom:0},"& + &":{"&::before":{display:"none"}}},[`&.${le.disabled}`]:{backgroundColor:(e.vars||e).palette.action.disabledBackground}}},({theme:e})=>({variants:[{props:t=>!t.square,style:{borderRadius:0,"&:first-of-type":{borderTopLeftRadius:(e.vars||e).shape.borderRadius,borderTopRightRadius:(e.vars||e).shape.borderRadius},"&:last-of-type":{borderBottomLeftRadius:(e.vars||e).shape.borderRadius,borderBottomRightRadius:(e.vars||e).shape.borderRadius,"@supports (-ms-ime-align: auto)":{borderBottomLeftRadius:0,borderBottomRightRadius:0}}}},{props:t=>!t.disableGutters,style:{[`&.${le.expanded}`]:{margin:"16px 0"}}}]})),jo=m.forwardRef(function(t,o){const a=te({props:t,name:"MuiAccordion"}),{children:n,className:s,defaultExpanded:c=!1,disabled:l=!1,disableGutters:u=!1,expanded:p,onChange:i,square:d=!1,slots:h={},slotProps:f={},TransitionComponent:b,TransitionProps:g}=a,C=oe(a,Bo),[k,R]=At({controlled:p,default:c,name:"Accordion",state:"expanded"}),M=m.useCallback(j=>{R(!k),i&&i(j,!k)},[k,i,R]),[L,...J]=m.Children.toArray(n),W=m.useMemo(()=>({expanded:k,disabled:l,disableGutters:u,toggle:M}),[k,l,u,M]),A=y({},a,{square:d,disabled:l,disableGutters:u,expanded:k}),F=Eo(A),fe=y({transition:b},h),N=y({transition:g},f),[X,K]=So("transition",{elementType:mt,externalForwardedProps:{slots:fe,slotProps:N},ownerState:A});return $.jsxs(Lo,y({className:U(F.root,s),ref:o,ownerState:A,square:d},C,{children:[$.jsx(ft.Provider,{value:W,children:L}),$.jsx(X,y({in:k,timeout:"auto"},K,{children:$.jsx("div",{"aria-labelledby":L.props.id,id:L.props["aria-controls"],role:"region",className:F.region,children:J})}))]}))}),Ge=jo;function Oo(e){return Z("MuiAccordionDetails",e)}ee("MuiAccordionDetails",["root"]);const Wo=["className"],Ko=e=>{const{classes:t}=e;return re({root:["root"]},Oo,t)},Vo=_("div",{name:"MuiAccordionDetails",slot:"Root",overridesResolver:(e,t)=>t.root})(({theme:e})=>({padding:e.spacing(1,2,2)})),qo=m.forwardRef(function(t,o){const a=te({props:t,name:"MuiAccordionDetails"}),{className:n}=a,s=oe(a,Wo),c=a,l=Ko(c);return $.jsx(Vo,y({className:U(l.root,n),ref:o,ownerState:c},s))}),Ue=qo;function Go(e){return Z("MuiAccordionSummary",e)}const Uo=ee("MuiAccordionSummary",["root","expanded","focusVisible","disabled","gutters","contentGutters","content","expandIconWrapper"]),q=Uo,Ho=["children","className","expandIcon","focusVisibleClassName","onClick"],Jo=e=>{const{classes:t,expanded:o,disabled:a,disableGutters:n}=e;return re({root:["root",o&&"expanded",a&&"disabled",!n&&"gutters"],focusVisible:["focusVisible"],content:["content",o&&"expanded",!n&&"contentGutters"],expandIconWrapper:["expandIconWrapper",o&&"expanded"]},Go,t)},Fo=_(Nt,{name:"MuiAccordionSummary",slot:"Root",overridesResolver:(e,t)=>t.root})(({theme:e})=>{const t={duration:e.transitions.duration.shortest};return{display:"flex",minHeight:48,padding:e.spacing(0,2),transition:e.transitions.create(["min-height","background-color"],t),[`&.${q.focusVisible}`]:{backgroundColor:(e.vars||e).palette.action.focus},[`&.${q.disabled}`]:{opacity:(e.vars||e).palette.action.disabledOpacity},[`&:hover:not(.${q.disabled})`]:{cursor:"pointer"},variants:[{props:o=>!o.disableGutters,style:{[`&.${q.expanded}`]:{minHeight:64}}}]}}),Xo=_("div",{name:"MuiAccordionSummary",slot:"Content",overridesResolver:(e,t)=>t.content})(({theme:e})=>({display:"flex",flexGrow:1,margin:"12px 0",variants:[{props:t=>!t.disableGutters,style:{transition:e.transitions.create(["margin"],{duration:e.transitions.duration.shortest}),[`&.${q.expanded}`]:{margin:"20px 0"}}}]})),Qo=_("div",{name:"MuiAccordionSummary",slot:"ExpandIconWrapper",overridesResolver:(e,t)=>t.expandIconWrapper})(({theme:e})=>({display:"flex",color:(e.vars||e).palette.action.active,transform:"rotate(0deg)",transition:e.transitions.create("transform",{duration:e.transitions.duration.shortest}),[`&.${q.expanded}`]:{transform:"rotate(180deg)"}})),Yo=m.forwardRef(function(t,o){const a=te({props:t,name:"MuiAccordionSummary"}),{children:n,className:s,expandIcon:c,focusVisibleClassName:l,onClick:u}=a,p=oe(a,Ho),{disabled:i=!1,disableGutters:d,expanded:h,toggle:f}=m.useContext(ft),b=k=>{f&&f(k),u&&u(k)},g=y({},a,{expanded:h,disabled:i,disableGutters:d}),C=Jo(g);return $.jsxs(Fo,y({focusRipple:!1,disableRipple:!0,disabled:i,component:"div","aria-expanded":h,className:U(C.root,s),focusVisibleClassName:U(C.focusVisible,l),onClick:b,ref:o,ownerState:g},p,{children:[$.jsx(Xo,{className:C.content,ownerState:g,children:n}),c&&$.jsx(Qo,{className:C.expandIconWrapper,ownerState:g,children:c})]}))}),He=Yo;function Zo(e){return Z("MuiLinearProgress",e)}ee("MuiLinearProgress",["root","colorPrimary","colorSecondary","determinate","indeterminate","buffer","query","dashed","dashedColorPrimary","dashedColorSecondary","bar","barColorPrimary","barColorSecondary","bar1Indeterminate","bar1Determinate","bar1Buffer","bar2Indeterminate","bar2Buffer"]);const er=["className","color","value","valueBuffer","variant"];let H=e=>e,Je,Fe,Xe,Qe,Ye,Ze;const xe=4,tr=ke(Je||(Je=H`
  0% {
    left: -35%;
    right: 100%;
  }

  60% {
    left: 100%;
    right: -90%;
  }

  100% {
    left: 100%;
    right: -90%;
  }
`)),or=ke(Fe||(Fe=H`
  0% {
    left: -200%;
    right: 100%;
  }

  60% {
    left: 107%;
    right: -8%;
  }

  100% {
    left: 107%;
    right: -8%;
  }
`)),rr=ke(Xe||(Xe=H`
  0% {
    opacity: 1;
    background-position: 0 -23px;
  }

  60% {
    opacity: 0;
    background-position: 0 -23px;
  }

  100% {
    opacity: 1;
    background-position: -200px -23px;
  }
`)),ar=e=>{const{classes:t,variant:o,color:a}=e,n={root:["root",`color${B(a)}`,o],dashed:["dashed",`dashedColor${B(a)}`],bar1:["bar",`barColor${B(a)}`,(o==="indeterminate"||o==="query")&&"bar1Indeterminate",o==="determinate"&&"bar1Determinate",o==="buffer"&&"bar1Buffer"],bar2:["bar",o!=="buffer"&&`barColor${B(a)}`,o==="buffer"&&`color${B(a)}`,(o==="indeterminate"||o==="query")&&"bar2Indeterminate",o==="buffer"&&"bar2Buffer"]};return re(n,Zo,t)},Ie=(e,t)=>t==="inherit"?"currentColor":e.vars?e.vars.palette.LinearProgress[`${t}Bg`]:e.palette.mode==="light"?Bt(e.palette[t].main,.62):Et(e.palette[t].main,.5),nr=_("span",{name:"MuiLinearProgress",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:o}=e;return[t.root,t[`color${B(o.color)}`],t[o.variant]]}})(({ownerState:e,theme:t})=>y({position:"relative",overflow:"hidden",display:"block",height:4,zIndex:0,"@media print":{colorAdjust:"exact"},backgroundColor:Ie(t,e.color)},e.color==="inherit"&&e.variant!=="buffer"&&{backgroundColor:"none","&::before":{content:'""',position:"absolute",left:0,top:0,right:0,bottom:0,backgroundColor:"currentColor",opacity:.3}},e.variant==="buffer"&&{backgroundColor:"transparent"},e.variant==="query"&&{transform:"rotate(180deg)"})),sr=_("span",{name:"MuiLinearProgress",slot:"Dashed",overridesResolver:(e,t)=>{const{ownerState:o}=e;return[t.dashed,t[`dashedColor${B(o.color)}`]]}})(({ownerState:e,theme:t})=>{const o=Ie(t,e.color);return y({position:"absolute",marginTop:0,height:"100%",width:"100%"},e.color==="inherit"&&{opacity:.3},{backgroundImage:`radial-gradient(${o} 0%, ${o} 16%, transparent 42%)`,backgroundSize:"10px 10px",backgroundPosition:"0 -23px"})},$e(Qe||(Qe=H`
    animation: ${0} 3s infinite linear;
  `),rr)),ir=_("span",{name:"MuiLinearProgress",slot:"Bar1",overridesResolver:(e,t)=>{const{ownerState:o}=e;return[t.bar,t[`barColor${B(o.color)}`],(o.variant==="indeterminate"||o.variant==="query")&&t.bar1Indeterminate,o.variant==="determinate"&&t.bar1Determinate,o.variant==="buffer"&&t.bar1Buffer]}})(({ownerState:e,theme:t})=>y({width:"100%",position:"absolute",left:0,bottom:0,top:0,transition:"transform 0.2s linear",transformOrigin:"left",backgroundColor:e.color==="inherit"?"currentColor":(t.vars||t).palette[e.color].main},e.variant==="determinate"&&{transition:`transform .${xe}s linear`},e.variant==="buffer"&&{zIndex:1,transition:`transform .${xe}s linear`}),({ownerState:e})=>(e.variant==="indeterminate"||e.variant==="query")&&$e(Ye||(Ye=H`
      width: auto;
      animation: ${0} 2.1s cubic-bezier(0.65, 0.815, 0.735, 0.395) infinite;
    `),tr)),lr=_("span",{name:"MuiLinearProgress",slot:"Bar2",overridesResolver:(e,t)=>{const{ownerState:o}=e;return[t.bar,t[`barColor${B(o.color)}`],(o.variant==="indeterminate"||o.variant==="query")&&t.bar2Indeterminate,o.variant==="buffer"&&t.bar2Buffer]}})(({ownerState:e,theme:t})=>y({width:"100%",position:"absolute",left:0,bottom:0,top:0,transition:"transform 0.2s linear",transformOrigin:"left"},e.variant!=="buffer"&&{backgroundColor:e.color==="inherit"?"currentColor":(t.vars||t).palette[e.color].main},e.color==="inherit"&&{opacity:.3},e.variant==="buffer"&&{backgroundColor:Ie(t,e.color),transition:`transform .${xe}s linear`}),({ownerState:e})=>(e.variant==="indeterminate"||e.variant==="query")&&$e(Ze||(Ze=H`
      width: auto;
      animation: ${0} 2.1s cubic-bezier(0.165, 0.84, 0.44, 1) 1.15s infinite;
    `),or)),cr=m.forwardRef(function(t,o){const a=te({props:t,name:"MuiLinearProgress"}),{className:n,color:s="primary",value:c,valueBuffer:l,variant:u="indeterminate"}=a,p=oe(a,er),i=y({},a,{color:s,variant:u}),d=ar(i),h=zt(),f={},b={bar1:{},bar2:{}};if((u==="determinate"||u==="buffer")&&c!==void 0){f["aria-valuenow"]=Math.round(c),f["aria-valuemin"]=0,f["aria-valuemax"]=100;let g=c-100;h&&(g=-g),b.bar1.transform=`translateX(${g}%)`}if(u==="buffer"&&l!==void 0){let g=(l||0)-100;h&&(g=-g),b.bar2.transform=`translateX(${g}%)`}return $.jsxs(nr,y({className:U(d.root,n),ownerState:i,role:"progressbar"},f,{ref:o},p,{children:[u==="buffer"?$.jsx(sr,{className:d.dashed,ownerState:i}):null,$.jsx(ir,{className:d.bar1,ownerState:i,style:b.bar1}),u==="determinate"?null:$.jsx(lr,{className:d.bar2,ownerState:i,style:b.bar2})]}))}),dr=cr;function ur({avatar:e,title:t,action:o}){return v(S,{display:"flex",gap:1,p:2,alignItems:"center",children:[e,r(w,{variant:"subtitle1",sx:{flexGrow:1},children:t}),o&&r(w,{variant:"caption",children:o})]})}function pr({condition:e,wrapper:t,falseWrapper:o,children:a}){return e?t(a):o?o(a):a}function et({value:e,onChange:t,...o}){const[a,n]=m.useState(e);m.useEffect(()=>{n(e)},[e]);const s=()=>t(a);return r(Co,{value:a,onChange:c=>n(c.target.value),onBlur:s,onKeyDown:c=>c.key==="Enter"&&!o.multiline&&s(),...o})}function mr(e){const{t}=D("ui"),o=be({path:"/:page/*"}),a=t("pageTitle"),n=e??((o==null?void 0:o.params.page)&&t(`tabs.${o==null?void 0:o.params.page}`));m.useEffect(()=>{n?document.title=`${n} - ${a}`:document.title=a},[t,a,n])}function Ae(e,t){const[o,a]=co(),n=m.useMemo(()=>o&&e.get(t),[o,e,t]);return m.useEffect(()=>e.follow(t,a),[e,t,a]),n}function fr(e){const{database:t}=P();return Ae(t.builds,e??"")}function ht(e){const t=m.useMemo(()=>e||Lt(rt,()=>""),[e]),{database:o}=P(),[a,n]=m.useState(()=>je(t,s=>o.relics.get(s)));return m.useEffect(()=>{n(je(t,c=>o.relics.get(c)));const s=Object.values(t).map(c=>o.relics.follow(c,(l,u,p)=>{u==="update"&&n(i=>({...i,[p.slotKey]:p})),u==="remove"&&n(i=>({...i,[p.slotKey]:void 0}))}));return()=>s.forEach(c=>c())},[o,t]),a}function G(e){const{database:t}=P();return Ae(t.loadouts,e??"")}function gt(e){const{database:t}=P();return Ae(t.teams,e)}function hr({slot:e}){const{t}=D("relic");return r(E,{sx:{height:"100%"},children:v(O,{children:[v(w,{children:[t("slot"),": ",e]}),r(w,{children:t("empty")})]})})}function gr({build:e}){const t=ht(e);return r(I,{container:!0,columns:3,spacing:1,children:rt.map(o=>{const a=t[o];return r(I,{item:!0,xs:1,children:a?r(Mo,{relic:a}):r(hr,{slot:o})},`${o}_${a==null?void 0:a.id}`)})})}function br({charKey:e,setCharKey:t}){const{t:o}=D(["character","charNames_gen"]),{database:a}=P(),n=m.useCallback(l=>!!a.chars.get(l),[a.chars]),s=m.useCallback(l=>a.charMeta.get(l).favorite,[a.charMeta]),c=m.useMemo(()=>[{key:"",label:o("character:autocomplete.none")},...jt.map(l=>({key:l,label:o(`charNames_gen:${l}`),favorite:s(l),color:n(l)?void 0:"secondary"}))],[n,s,o]);return r(m.Suspense,{fallback:r(Se,{variant:"text",width:100}),children:r($o,{options:c,toImg:()=>r(me,{children:" "}),valueKey:e,onChange:l=>t(l??"")})})}const vr=Ot($.jsx("path",{d:"M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zm2.46-7.12 1.41-1.41L12 12.59l2.12-2.12 1.41 1.41L13.41 14l2.12 2.12-1.41 1.41L12 15.41l-2.12 2.12-1.41-1.41L10.59 14l-2.13-2.12zM15.5 4l-1-1h-5l-1 1H5v2h14V4z"}),"DeleteForever"),xr={RuanMei:Wt};function yr({document:e,bgt:t="normal",collapse:o=!1}){switch(e.type){case"fields":return r(Cr,{fieldsDocument:e,bgt:t});case"text":return o?r($r,{textDocument:e}):r(kr,{textDocument:e});case"conditional":return null;default:return null}}function Cr({fieldsDocument:e,bgt:t="normal"}){return v(E,{bgt:t,children:[e.header&&r(Sr,{header:e.header,hideDivider:e.fields.length===0}),r(Kt,{bgt:t,fields:e.fields})]})}function kr({textDocument:e}){return r("div",{children:e.text})}function $r({textDocument:e}){const[t,o]=m.useState(!1),[a,n]=m.useState(!1);return v(S,{sx:{position:"relative"},children:[!t&&r(S,{sx:{pointerEvents:"none",position:"absolute",mx:"auto",width:"100%",display:"flex",justifyContent:"center",height:"100%",alignItems:"flex-end",zIndex:"10",transition:"transform 0.3s ease",transform:a?"translate(0,-5px)":void 0},children:r(ko,{})}),r(mt,{onMouseEnter:()=>n(!0),onMouseLeave:()=>n(!1),collapsedSize:55,onClick:()=>o(s=>!s),in:t,sx:{cursor:"pointer",position:"relative",maskImage:t?void 0:"linear-gradient(to bottom, black 0%, transparent 100%)","&:hover":{maskImage:t?void 0:"linear-gradient(to bottom, black 50%, transparent 100%)"}},children:r("div",{children:e.text})})]})}function Sr({header:e,hideDivider:t}){const{icon:o,text:a,additional:n}=e;return v(me,{children:[r(ur,{avatar:o,title:a,action:n}),!t&&r(ue,{})]})}function ae(){return m.useContext(at)}function bt({optTarget:e,setOptTarget:t}){const{t:o}=D("optimize"),a=ae(),n=Me(we,{et:"self",src:"0"});return r(Pe,{title:`${o("optTarget")}${e?`: ${e.tag.name||e.tag.q}`:""}`,children:a==null?void 0:a.listFormulas(n.listing.formulas).map((s,c)=>r(_e,{onClick:()=>t(s),children:s.tag.name||s.tag.q},`${c}_${s.tag.name||s.tag.q}`))})}function Mr({statFilters:e,setStatFilters:t,disabled:o=!1}){const a=m.useCallback((u,p,i)=>{const d={...e},h=JSON.stringify(p),f=p?[...e[h]]:void 0,b=JSON.stringify(u),g=[...e[b]??[]];i!==void 0&&f?g.push(f[i]):g.push({minValue:0,maxValue:0,disabled:!1}),d[b]=g,i!==void 0&&f&&(f.splice(i,1),f.length?d[h]=f:delete d[h]),t({...d})},[t,e]),n=m.useCallback((u,p)=>{const i={...e},d=JSON.stringify(u),h=[...e[d]];h.splice(p,1),h.length?i[d]=h:delete i[d],t({...i})},[t,e]),s=m.useCallback((u,p,i)=>{const d={...e},h=JSON.stringify(u),f=[...e[h]];f[p]={...f[p],minValue:i},d[h]=f,t({...d})},[t,e]),c=m.useCallback((u,p,i)=>{const d={...e},h=JSON.stringify(u),f=[...e[h]];f[p]={...f[p],maxValue:i},d[h]=f,t({...d})},[t,e]),l=m.useCallback((u,p,i)=>{const d={...e},h=JSON.stringify(u),f=[...e[h]];f[p]={...f[p],disabled:i},d[h]=f,t({...d})},[t,e]);return v(me,{children:[Object.entries(e).flatMap(([u,p])=>p==null?void 0:p.map((i,d)=>r(tt,{path:JSON.parse(u),setting:i,index:d,setTarget:a,delTarget:n,setMinValue:s,setMaxValue:c,setDisabled:l,disabled:o},u+d))),r(tt,{delTarget:n,setTarget:a,setMinValue:s,setMaxValue:c,setDisabled:l,disabled:o})]})}function tt({path:e,setting:t,index:o,delTarget:a,setMinValue:n,setMaxValue:s,setDisabled:c,disabled:l}){const{t:u}=D("page_character_optimize"),p=m.useCallback(b=>e&&o!==void 0&&n(e,o,b??0),[n,e,o]),i=m.useCallback(b=>e&&o!==void 0&&s(e,o,b??1/0),[s,e,o]),[d,h]=m.useState(void 0),f={p:1,flexBasis:30,flexGrow:0,flexShrink:0};return v(Gt,{sx:{"& .MuiButtonGroup-grouped":{minWidth:24},width:"100%"},children:[!!t&&!!e&&o!==void 0&&r(pe,{sx:f,color:t.disabled?"secondary":"success",onClick:()=>c(e,o,!t.disabled),disabled:l,children:t.disabled?r(Vt,{}):r(qt,{})}),r(We,{sx:{flexBasis:150,flexGrow:1},children:r(Oe,{float:!0,disabled:!e||l,value:t==null?void 0:t.minValue,placeholder:u("buildConstraint.minStatValue"),onChange:p,sx:{px:1},inputProps:{sx:{"& + .MuiOutlinedInput-notchedOutline":{borderRadius:0},textAlign:"right"}}})}),r(bt,{optTarget:d,setOptTarget:h}),r(We,{sx:{flexBasis:150,flexGrow:1},children:r(Oe,{float:!0,disabled:!e||l,value:t==null?void 0:t.maxValue,placeholder:u("buildConstraint.maxStatValue"),onChange:i,sx:{px:1},inputProps:{sx:{"& + .MuiOutlinedInput-notchedOutline":{borderRadius:0},textAlign:"left"}}})}),!!e&&o!==void 0&&r(pe,{sx:f,color:"error",onClick:()=>a(e,o),disabled:l,children:r(vr,{fontSize:"small"})})]})}function wr({disabled:e=!1}){const{t}=D("page_character_optimize"),[o,a]=m.useState({});return r(S,{children:v(E,{bgt:"light",children:[r(O,{sx:{display:"flex",gap:1,justifyContent:"space-between",flexDirection:"column"},children:v(S,{display:"flex",justifyContent:"space-between",children:[r(w,{sx:{fontWeight:"bold"},children:t`constraintFilter.title`}),r(wo,{title:r(w,{children:t`constraintFilter.tooltip`})})]})}),r(ue,{}),r(S,{display:"flex",flexDirection:"column",gap:.5,children:r(Mr,{statFilters:o,setStatFilters:a,disabled:e})})]})})}function Rr({numWorkers:e,setNumWorkers:t}){const{t:o}=D("optimize"),a=navigator.hardwareConcurrency||8;return r(Pe,{title:`${o("numWorkers")}: ${e}`,children:nt(1,a).map(n=>r(_e,{onClick:()=>t(n),children:o("workers",{count:n})},n))})}function Dr({teamId:e,children:t}){var f,b,g,C;const o=gt(e),a=G((f=o.loadoutMetadata[0])==null?void 0:f.loadoutId),n=G((b=o.loadoutMetadata[1])==null?void 0:b.loadoutId),s=G((g=o.loadoutMetadata[2])==null?void 0:g.loadoutId),c=G((C=o.loadoutMetadata[3])==null?void 0:C.loadoutId),l={all:"all"};a&&(l[a.key]="0"),n&&(l[n.key]="1"),s&&(l[s.key]="2"),c&&(l[c.key]="3");const u=ce(o.loadoutMetadata[0],l),p=ce(o.loadoutMetadata[1],l),i=ce(o.loadoutMetadata[2],l),d=ce(o.loadoutMetadata[3],l),h=m.useMemo(()=>po([...mo(o.loadoutMetadata.map((k,R)=>k===void 0?void 0:st[R]).filter(k=>!!k)),...u?de(0,u):[],...p?de(1,p):[],...i?de(2,i):[],...d?de(3,d):[],ie.common.lvl.add(80),ie.common.res.add(.1),ie.common.isBroken.add(0),ie.common.maxToughness.add(100),Ut.common.critMode.add("avg")]),[u,p,i,d,o.loadoutMetadata]);return r(at.Provider,{value:h,children:t})}function ce(e,t){const o=G(e==null?void 0:e.loadoutId),a=ct(o==null?void 0:o.key),n=fr(e==null?void 0:e.buildId),s=yo(n==null?void 0:n.lightConeId),c=ht(n==null?void 0:n.relicIds),l=o==null?void 0:o.conditional,u=Object.fromEntries(Object.entries(l??{}).map(([p,i])=>[t[p],i]));return{character:a,lightCone:s,relics:c,conditionals:u}}function de(e,{character:t,lightCone:o,relics:a,conditionals:n}){return t?[...fo(`${e}`,...ho(t),...go(o),...bo(Object.values(a).filter(s=>!!s).map(s=>({set:s.setKey,stats:[...s.substats.filter(({key:c})=>c!=="").map(c=>({key:c.key,value:c.accurateValue})),{key:s.mainStatKey,value:s.mainStatVal}]})))),...vo(`${e}`,n)]:[]}var Ne={},Tr=De;Object.defineProperty(Ne,"__esModule",{value:!0});var vt=Ne.default=void 0,_r=Tr(Re()),Pr=$,Ir=(0,_r.default)((0,Pr.jsx)("path",{d:"M22 24H2v-4h20v4zM13.06 5.19l3.75 3.75L7.75 18H4v-3.75l9.06-9.06zm4.82 2.68-3.75-3.75 1.83-1.83c.39-.39 1.02-.39 1.41 0l2.34 2.34c.39.39.39 1.02 0 1.41l-1.83 1.83z"}),"BorderColor");vt=Ne.default=Ir;function Ar({teamId:e,charKey:t,tab:o=""}){const{t:a}=D("page_team"),n=it(),{database:s}=P(),c=s.teams.get(e),{loadoutMetadata:l}=c,u=Ce(),p=lt(u.breakpoints.down("md")),[i,d]=m.useState(!1),h=b=>{s.teams.set(e,{name:b})},f=b=>{s.teams.set(e,{description:b})};return v(S,{sx:()=>({borderBottom:"1px rgb(200,200,200,0.3) solid","& .MuiTab-root:hover":{transition:"background-color 0.25s ease",backgroundColor:"rgba(255,255,255,0.1)"},"& .Mui-selected":{color:"white !important"},"& .MuiTabs-indicator":{height:"4px",backgroundColor:"rgb(200,200,200,0.5)"}}),children:[r(ut,{onClick:()=>d(!0),children:r(Ht,{placement:"top",title:v(S,{children:[v(S,{sx:{display:"flex",color:"info.light",gap:1},children:[r(vt,{}),r(w,{children:r("strong",{children:a`team.editNameDesc`})})]}),!!c.description&&r(w,{children:c.description})]}),children:r(O,{sx:{display:"flex",justifyContent:"center","&:hover":{color:"info.light"}},children:v(w,{variant:"h5",sx:{display:"flex",gap:1,alignItems:"center",justifyContent:"center",textShadow:"#000 0 0 10px !important"},children:[r(ge,{}),c.name]})})})}),r(Ft,{open:i,onClose:()=>d(!1),children:v(E,{children:[r(uo,{title:a`team.editNameDesc`,avatar:r(ge,{}),titleTypographyProps:{variant:"h6"},action:r(Jt,{onClick:()=>d(!1),children:r(dt,{})})}),r(ue,{}),r(O,{children:v(S,{display:"flex",flexDirection:"column",gap:2,sx:{mt:2},children:[r(et,{label:a`team.name`,value:c.name,onChange:b=>h(b),autoFocus:!0}),r(et,{label:a`team.desc`,value:c.description,onChange:b=>f(b),multiline:!0,minRows:4})]})})]})}),r(ue,{}),v(Xt,{variant:"fullWidth",value:t??"team",orientation:p?"vertical":"horizontal",children:[r(Ke,{icon:r(ge,{}),iconPosition:"start",value:"team",label:"Team Settings",onClick:()=>n(`/teams/${e}/`)}),l.map((b,g)=>{var k;const C=b&&((k=s.loadouts.get(b==null?void 0:b.loadoutId))==null?void 0:k.key);return r(Ke,{icon:r(Qt,{}),iconPosition:"start",value:C??g,disabled:!l[g],label:C?r(w,{children:a(`charNames_gen:${C}`)}):`Character ${g+1}`,onClick:()=>C&&n(`/teams/${e}/${C}/${o}`)},g)})]})]})}function Nr({teamId:e}){const{database:t}=P(),o=t.teams.get(e);return v(S,{children:[e,o.loadoutMetadata.map((a,n)=>r(zr,{loadoutMetadataIndex:n,teamId:e},`${n}_${a==null?void 0:a.loadoutId}`))]})}function zr({loadoutMetadataIndex:e,teamId:t}){var l;const{database:o}=P(),a=o.teams.get(t),n=(l=a.loadoutMetadata[e])==null?void 0:l.loadoutId,s=o.loadouts.get(n);function c(u){if(u===""){o.teams.set(t,i=>i.loadoutMetadata[e]=void 0);return}o.chars.getOrCreate(u);const p=a.loadoutMetadata.findIndex(i=>{var d;return i&&((d=o.loadouts.get(i.loadoutId))==null?void 0:d.key)===u});if(p===-1){let i=o.loadouts.keys.find(d=>o.loadouts.get(d).key===u);i||(i=o.loadouts.new(u)),o.teams.set(t,d=>{d.loadoutMetadata[e]={loadoutId:i}})}else{if(p===e)return;const i=a.loadoutMetadata[p],d=a.loadoutMetadata[e];o.teams.set(t,h=>{h.loadoutMetadata[e]=i,h.loadoutMetadata[p]=d})}}return r(br,{charKey:(s==null?void 0:s.key)??"",setCharKey:c})}var ze={},Br=De;Object.defineProperty(ze,"__esModule",{value:!0});var ye=ze.default=void 0,Er=Br(Re()),Lr=$,jr=(0,Er.default)((0,Lr.jsx)("path",{d:"M16.59 8.59 12 13.17 7.41 8.59 6 10l6 6 6-6z"}),"ExpandMore");ye=ze.default=jr;const Or=5e4;class Wr{constructor(t,o,a,n,s){this.calc=t,this.optTarget=o,this.relicsBySlot=a,this.numWorkers=n,this.setProgress=s,this.worker=new Worker(new URL(""+new URL("parentWorker-CAAYnoOP.js",import.meta.url).href,import.meta.url),{type:"module"})}async optimize(){return await new Promise((o,a)=>{this.worker.onmessage=({data:s})=>{switch(s.resultType){case"progress":this.setProgress(s.progress);break;case"done":o(s.buildResults);break;case"err":console.log(s),a();break}};const n={command:"start",relicsBySlot:this.relicsBySlot,detachedNodes:this.detachNodes(),numWorkers:this.numWorkers};this.worker.postMessage(n)})}async terminate(){const t={command:"terminate"};this.worker.postMessage(t),await new Promise((o,a)=>{this.worker.onmessage=({data:n})=>{switch(n.resultType){case"terminated":o();break;case"err":console.log(n),a();break}}}),this.worker.terminate()}detachNodes(){const t=new Set(Yt);return xo([this.optTarget],this.calc,a=>{if(a.src==="0"&&a.et==="self"){if(a.sheet==="dyn"&&a.qt==="premod")return{q:a.q};if(a.q==="count"&&t.has(a.sheet))return{q:a.sheet}}})}}var Be={},Kr=De;Object.defineProperty(Be,"__esModule",{value:!0});var xt=Be.default=void 0,Vr=Kr(Re()),qr=$,Gr=(0,Vr.default)((0,qr.jsx)("path",{d:"m16 6 2.29 2.29-4.88 4.88-4-4L2 16.59 3.41 18l6-6 4 4 6.3-6.29L22 12V6z"}),"TrendingUp");xt=Be.default=Gr;function Ur(){const{t:e}=D("optimize"),{database:t}=P(),o=ae(),[a,n]=m.useState(8),[s,c]=m.useState(void 0),[l,u]=m.useState(void 0),p=m.useMemo(()=>t.relics.values.reduce((R,M)=>(R[M.slotKey].push(M),R),{head:[],hands:[],feet:[],body:[],sphere:[],rope:[]}),[t.relics.values]),i=Object.values(p).reduce((R,M)=>R*M.length,1),[d,h]=m.useState(void 0),[f,b]=m.useState(!1),g=m.useRef(()=>{});m.useEffect(()=>()=>g.current(),[]);const C=m.useCallback(async()=>{if(!l||!o)return;const R=new Promise(J=>g.current=J);c(void 0),b(!0);const M=new Wr(o,l,p,a,c);R.then(async()=>await M.terminate());const L=await M.optimize();await M.terminate(),g.current=()=>{},b(!1),h(L[0])},[o,a,l,p]),k=m.useCallback(()=>{g.current(),b(!1)},[g]);return r(E,{bgt:"dark",children:v(O,{children:[r(wr,{}),v(ve,{children:[r(w,{variant:"h5",children:e("optimize")}),v(S,{children:[r(bt,{optTarget:l,setOptTarget:u}),r(Rr,{numWorkers:a,setNumWorkers:n}),r(pe,{onClick:f?k:C,color:f?"error":"primary",startIcon:f?r(dt,{}):r(xt,{}),children:e(f?"cancel":"optimize")})]}),s&&r(Hr,{progress:s,totalPermutations:i}),d&&v(S,{children:[v(w,{children:["Best: ",d.value]}),r(gr,{build:d.ids})]})]})]})})}function Hr({progress:e,totalPermutations:t}){const{t:o}=D("optimize");return v(S,{children:[v(w,{children:[o("totalProgress"),": ",e.numBuildsComputed.toLocaleString()," /"," ",t.toLocaleString()]}),v(w,{children:[o("buildsKept"),": ",e.numBuildsKept.toLocaleString()," /"," ",Or.toLocaleString()]}),r(dr,{variant:"determinate",value:e.numBuildsComputed/t*100})]})}const Jr={xs:12,sm:6,md:4};function Fr(){const{loadout:{key:e}}=Te(),t=ae(),{t:o}=D("sheet_gen"),a=[["basic",o("talents.basic")],["skill",o("talents.skill")],["ultimate",o("talents.ultimate")]],n=Ce(),s=lt(n.breakpoints.up("lg")),c=xr[e];if(console.log({characterSheet:c,calc:t}),!(!c||!t))return r(me,{children:v(I,{container:!0,spacing:1,children:[s&&r(I,{item:!0,xs:12,md:12,lg:3,sx:{display:"flex",flexDirection:"column",gap:1},children:r(ot,{})}),r(I,{item:!0,xs:12,md:12,lg:9,container:!0,spacing:1,children:a.map(([l,u])=>{const p=c[l];return p?r(I,{item:!0,...Jr,children:r(Xr,{talentKey:l,subtitle:u,sheetElement:p})},l):null})}),!s&&r(I,{item:!0,xs:12,md:12,lg:3,container:!0,spacing:1,children:r(I,{item:!0,xs:12,children:r(ot,{})})})]})})}function Xr({sheetElement:e,subtitle:t,onClickTitle:o}){const a=m.useCallback(s=>r(ut,{onClick:o,children:s}),[o]);let n=null;return n=null,v(E,{bgt:"light",sx:{height:"100%"},children:[n,v(O,{children:[r(pr,{condition:!!o,wrapper:a,children:v(I,{container:!0,sx:{flexWrap:"nowrap"},children:[r(I,{item:!0,children:r(S,{component:Ve?Ve:"img",src:e==null?void 0:e.img,sx:{width:60,height:"auto"}})}),v(I,{item:!0,flexGrow:1,sx:{pl:1},children:[r(w,{variant:"h6",children:e==null?void 0:e.name}),r(w,{variant:"subtitle1",children:t})]})]})}),e.documents.map((s,c)=>r(yr,{document:s,collapse:!0},c))]})]})}function ot(){const{t:e}=D("sheet_gen"),t=ae();if(!t)return null;const o=Me(we,{et:"self",src:"0"}),a=t.compute(o.char.eidolon).val;return r(Pe,{fullWidth:!0,title:e("constellationLvl",{level:a}),color:"primary",children:nt(0,Zt).map(n=>r(_e,{selected:a===n,disabled:a===n,onClick:()=>{},children:e("constellationLvl",{level:n})},n))})}function Qr({tab:e}){const{team:t,loadout:{key:o}}=Te(),{database:a}=P(),{character:n}=eo(),s=ae(),[c,l]=m.useState(void 0),u=t.loadoutMetadata.findIndex(i=>{var d;return((d=a.loadouts.get(i==null?void 0:i.loadoutId))==null?void 0:d.key)===o}),p=Me(we,{et:"self",src:st[u]});return r(to.Provider,{value:p,children:v(S,{children:[e,r(io,{characterKey:c,onClose:()=>l(void 0)}),r(lo,{character:n}),v(ve,{gap:1,pt:1,children:[r(E,{bgt:"dark",children:v(O,{children:[r(pe,{disabled:!o,onClick:()=>o&&l(o),children:"Edit Character"}),v(Ge,{children:[r(He,{expandIcon:r(ye,{}),children:"All target values, if sheet is created"}),r(Ue,{children:r(ve,{children:s==null?void 0:s.listFormulas(p.listing.formulas).map((i,d)=>{const h=s.compute(i),f=i.tag.name||i.tag.q;return v(S,{children:[v(w,{children:[f,": ",h.val]}),v(Ge,{children:[v(He,{expandIcon:r(ye,{}),children:["debug for ",f]}),r(Ue,{children:r(w,{component:"pre",children:JSON.stringify(s.toDebug().compute(i),void 0,2)})})]})]},`${f}${d}`)})})})]})]})}),r(Fr,{}),r(Ur,{})]})]})})}const Yr=r(Se,{variant:"rectangular",width:"100%",height:1e3});function ua(){const{database:e}=P(),{teamId:t}=oo(),o=!t||!e.teams.keys.includes(t);return m.useEffect(()=>{o||e.teams.set(t,{lastEdit:Date.now()})},[t,e.teams,o]),o?r(no,{to:"/teams"}):r(S,{display:"flex",flexDirection:"column",gap:1,children:r(m.Suspense,{fallback:Yr,children:t&&r(Zr,{teamId:t})})})}function Zr({teamId:e}){var f;const{database:t}=P(),o=it(),a=gt(e),{loadoutMetadata:n}=a,{params:{characterKey:s}}=be({path:"/teams/:teamId/:characterKey",end:!1})??{params:{}},{params:{tab:c}}=be({path:"/teams/:teamId/:characterKey/:tab"})??{params:{}},l=m.useMemo(()=>n.find(g=>{var C;return(g==null?void 0:g.loadoutId)&&((C=t.loadouts.get(g.loadoutId))==null?void 0:C.key)===s}),[n,t.loadouts,s]);m.useEffect(()=>{window.scrollTo({top:0})},[]),m.useEffect(()=>{l||o("",{replace:!0})},[l,o]);const u=l==null?void 0:l.loadoutId,p=(f=t.loadouts.get(u))==null?void 0:f.key,{t:i}=D(["charNames_gen","page_character"]);mr(m.useMemo(()=>{const b=i(p?"charNames_gen:Character":"Team Settings"),g=c?i(`page_character:tabs.${c}`):p?i("Loadout/Build"):c;return`${a.name} - ${b}${g?` - ${g}`:""}`},[p,i,c,a.name]));const d=G(u??""),h=m.useMemo(()=>{if(!(!u||!d||!l))return{teamId:e,team:a,loadoutId:u,loadout:d,loadoutMetadatum:l}},[l,a,d,u,e]);return r(Dr,{teamId:e,children:v(S,{sx:{display:"flex",gap:1,flexDirection:"column",mx:1,mt:2},children:[r(E,{children:r(Ar,{teamId:e,charKey:p,tab:c})}),r(S,{children:h?r(ro.Provider,{value:h,children:r(ea,{})}):r(Nr,{teamId:e})})]})})}function ea({tab:e}){const{loadout:{key:t}}=Te(),o=ct(t),a=m.useMemo(()=>o&&{character:o},[o]);return a?r(ao.Provider,{value:a,children:r(so,{children:r(qe,{path:":characterKey",children:r(qe,{path:"*",index:!0,element:r(Qr,{tab:e})})})})}):r(Se,{variant:"rectangular",width:"100%",height:1e3})}export{ua as default};
